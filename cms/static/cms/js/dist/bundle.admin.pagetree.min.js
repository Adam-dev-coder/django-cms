/*
    THIS FILE HAS BEEN MANUALLY PATCHED UNTIL PR #1342 GETS RELEASED
    https://github.com/vakata/jstree/pull/1342/files
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],c=e("script:last").attr("src"),l=window.document,h=l.createElement("LI");h.setAttribute("role","treeitem"),i=l.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=l.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=l.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"3.2.1",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(l).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(s){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(s){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return i!==!0||this.length?(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||i===!0)&&(n=a||!1),null!==n&&n!==t?!1:void 0}),null!==n&&n!==t?n:this):!1},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(t){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(l.selection&&l.selection.empty)l.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(i){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return e.target.tagName&&"input"===e.target.tagName.toLowerCase()?!0:void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==l.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget),i&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus());break;case 38:t.preventDefault(),i=this.get_prev_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0],i&&e(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:t.preventDefault(),i=this.get_next_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),i=this._firstChild(this.get_container_ul()[0]),i&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(l.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(l).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(s){return!1}},get_path:function(t,i,r){if(t=t.parents?t:this.get_node(t),!t||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&-1!==r.className.indexOf("jstree-node")?e(r):!1},get_parent:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.parent:!1},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):e&&e.length?e.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(t=this.get_node(t),!t)return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,r=0,s=t.children_d.length;s>r;r++){for(n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[n]].children_d,t.children_d[r]);this._model.data[t.children_d[r]].state.selected&&(o=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[r])),delete this._model.data[t.children_d[r]]}t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&!o&&r&&r.length&&!r.hasClass("jstree-leaf")&&r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i){var r,s,n=!0,a=function(){this._load_nodes(e,t,!0)},o=this._model.data,d=[];for(r=0,s=e.length;s>r;r++)!o[e[r]]||(o[e[r]].state.loaded||o[e[r]].state.failed)&&i||(this.is_loading(e[r])||this.load_node(e[r],a),n=!1);if(n){for(r=0,s=e.length;s>r;r++)o[e[r]]&&o[e[r]].state.loaded&&d.push(e[r]);t&&!t.done&&(t.call(this,d),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){r===!1&&i.call(this,!1),this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){e=this.get_node(e),e&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,c=[],l=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){s=this._parse_model_from_html(e(i),d,_.parents.concat()),s&&(c.push(s),l.push(s),h[s].children_d.length&&(l=l.concat(h[s].children_d)))},this)),_.children=c,_.children_d=l,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(l);this.trigger("model",{nodes:l,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&(i=i.d,"string"==typeof i&&(i=JSON.parse(i))),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],c=[],l=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),c={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(c.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),(c.icon===t||null===c.icon||""===c.icon)&&(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(c.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(c.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(c.li_attr[s]=e.li_attr[s]);if(c.li_attr.id||(c.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(c.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(c.state.loaded=!1,c.children=[],c.children_d=[]),g[c.id]=c,s=0,n=c.children.length;n>s;s++)a=m(g[c.children[s]],c.id,r),o=g[a],c.children_d.push(a),o.children_d.length&&(c.children_d=c.children_d.concat(o.children_d));return delete e.data,delete e.children,g[c.id].original=e,c.state.selected&&l.push(c.id),c.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,c=!1;do c="j"+_+"_"+ ++u;while(g[c]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),(d.icon===t||null===d.icon||""===d.icon)&&(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&l.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),c.push(i),g[i].children_d.length&&(c=c.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(c);n={cnt:u,mod:g,sel:p,par:o,dpc:c,add:l}}else{for(r=0,s=a.length;s>r;r++)i=v(a[r],o,f.parents.concat()),i&&(d.push(i),c.push(i),g[i].children_d.length&&(c=c.concat(g[i].children_d)));for(f.children=d,f.children_d=c,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(c);n={cnt:u,mod:g,sel:p,par:o,dpc:c,add:l}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){if(this._cnt=t.cnt,this._model.data=t.mod,i){var s,n,a=t.add,o=t.sel,d=this._data.core.selected.slice(),c=this._model.data;if(o.length!==d.length||e.vakata.array_unique(o.concat(d)).length!==o.length){for(s=0,n=o.length;n>s;s++)-1===e.inArray(o[s],a)&&-1===e.inArray(o[s],d)&&(c[o[s]].state.selected=!1);for(s=0,n=d.length;n>s;s++)-1===e.inArray(d[s],o)&&(c[d[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(c){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,c,l=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),i.length?(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString()))):!0}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=d.hasClass("jstree-themeicon-hidden")?!1:d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),(h.icon===t||null===h.icon||""===h.icon)&&(h.icon=!0),d=i.children("ul").children("li");do c="j"+this._id+"_"+ ++this._cnt;while(l[c]);return h.id=h.li_attr.id?h.li_attr.id.toString():c,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),h.a_attr["class"]&&(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),l[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),c=this._model.data,l=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in l)l.hasOwnProperty(s)&&(h.state[s]=l[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),(h.icon===t||null===h.icon||""===h.icon)&&(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(h.state.loaded=!1,h.children=[],h.children_d=[]),c[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(c[h.children[s]],h.id,r),o=c[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,c[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,c=!1,l=this._model.data,h=this._model.default_state;do c="j"+this._id+"_"+ ++this._cnt;while(l[c]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),(d.icon===t||null===d.icon||""===d.icon)&&(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=l[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,l[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=l.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)t=this.redraw_node(s[i],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==l.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=l;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,c=!1,_=!1,u=!1,g="",f=l,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=l.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):l.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),
i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===l.activeElement,t.remove();else if(i=!0,!r){if(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===a||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(c in n.li_attr)if(n.li_attr.hasOwnProperty(c)){if("id"===c)continue;"class"!==c?t.setAttribute(c,n.li_attr[c]):g+=n.li_attr[c]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),c=0,_=n.children.length;_>c;c++)if(!p[n.children[c]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(c=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==c))for(c++,_=p[n.parent].children.length;_>c&&(p[p[n.parent].children[c]].state.hidden||(x=p[n.parent].children[c]),x===n.id);c++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&n.icon!==!0||n.icon===!1)&&(n.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+n.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",c=0,_=n.children.length;_>c;c++)u.appendChild(this.redraw_node(n.children[c],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),c=0,_=a.childNodes.length;_>c;c++)if(a.childNodes[c]&&a.childNodes[c].className&&-1!==a.childNodes[c].className.indexOf("jstree-children")){v=a.childNodes[c];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):r?r.call(this,e,!1):!1}):(r&&r.call(this,i,!1),!1)):!1},_open_to:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?this.is_closed(i)?!1:(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),o.length&&(r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove())),i.state.opened=!1,this.trigger("close_node",{node:i}),void(r&&o.length||this.trigger("after_close",{node:i}))):!1},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t})):!1},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t})):!1},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))):!1},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))):!1},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return e=this.get_node(e,!0),e&&e.length&&e.children(".jstree-hovered").length?(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)})):!1},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s})))):!1},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r})))):!1},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.selected:!1},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return e.isEmptyObject(i)?(i=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t,i){this._data.core.state=i===!0?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i=[],r=[];this._data.core.selected.concat([]);r.push(t.id),t.state.opened===!0&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,i){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var r,s,n=this._model.data;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i).children(".jstree-anchor").attr("id",i+"_anchor").end().attr("aria-labelledby",i+"_anchor"),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,!0},get_text:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.text:!1},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0):!1},get_json:function(t,i,r){if(t=this.get_node(t||e.jstree.root),!t)return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:i&&i.no_data?!1:e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),i=this.get_node(i),!i)return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,c,l;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,i.id,i.parents.concat()),!r)return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),c=0,l=i.parents.length;l>c;c++)this._model.data[i.parents[c]].children_d=this._model.data[i.parents[c]].children_d.concat(d);for(r=o,o=[],c=0,l=i.children.length;l>c;c++)o[c>=s?c+1:c]=i.children[c];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(t){var i,r,s,n,a,o,d,c,l,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),c=0,l=a.length;l>c;c++){for(o=0,d=t.parents.length;d>o;o++)n=e.inArray(a[c],this._model.data[t.parents[o]].children_d),-1!==n&&(this._model.data[t.parents[o]].children_d=e.vakata.array_remove(this._model.data[t.parents[o]].children_d,n));this._model.data[a[c]].state.selected&&(h=!0,n=e.inArray(a[c],this._data.core.selected),-1!==n&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,n)))}for(this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),c=0,l=a.length;l>c;c++)delete this._model.data[a[c]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||n&&n.is_multi||(i.id!==r.id||"copy_node"===t)&&e.inArray(i.id,r.children)!==s&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(a.functions[t]===!1||a.functions[t]===!0)?(a.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),a.functions[t]):o===!1||e.isFunction(o)&&o.call(this,t,i,r,s,n)===!1||o&&o[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var c,l,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(c=0,l=i.length;l>c;c++)(m=this.move_node(i[c],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return(m=this.copy_node(i,r,s,n,a,!1,d))?(g&&g.delete_node(i),m):!1;switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);(h===e.jstree.root||u.id===e.jstree.root)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var c,l,h,_,u,g,f,p,m,v,j;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(c=0,l=i.length;l>c;c++)(_=this.copy_node(i[c],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),j=!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i,!f)return!1;if(f.id===!0&&delete f.id,f=this._parse_model_from_json(f,m.id,m.parents.concat()),!f)return!1;for(_=this.get_node(f),i&&i.state&&i.state.loaded===!1&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="move_node",void this.trigger("cut",{node:t})):!1},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t})):!1},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return a!==!1&&n!==!1},paste:function(e,t){return e=this.get_node(e),e&&a&&a.match(/^(copy_node|move_node)$/)&&n?(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1)):!1},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,c,l,h,_,u=!1;return(t=this.get_node(t))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(_=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),_.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=_.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,c=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=e("<input />",{value:d,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),l=n.val(),h=this.settings.core.force_text;""===l&&(l=d),c.remove(),o.replaceWith(a),o.remove(),d=h?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,h?e("<div></div>").text(l).text():e("<div></div>").append(e.parseHTML(l)).html()),s||this.set_text(t,d),this._data.core.focused=_.id,setTimeout(e.proxy(function(){var e=this.get_node(_.id,!0);e.length&&(this._data.core.focused=_.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,_,s,u)},this),keydown:function(e){var t=e.which;27===t&&(u=!0,this.value=d),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){l.width(Math.min(c.text("pW"+this.value).width(),n))},keypress:function(e){return 13===e.which?!1:void 0}}),h={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(l),a.replaceWith(o),c.css(h),void l.css(h).width(Math.min(c.text("pW"+l[0].value).width(),n))[0].select()):!1},set_theme:function(t,i){if(!t)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),
this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(o=i.icon,i.icon=r===!0||null===r||r===t||""===r?!0:r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),r===!1?this.hide_icon(i):r===!0||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),o===!1&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),o===!1&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),o===!1&&this.show_icon(i)),!0):!1},get_icon:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.icon:!1},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(s=this.get_node(t,!0),t.icon=s.length?s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t,i){var r=e.slice((i||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,r),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=l.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,c=this._model.data,l=c[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(l.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)c[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(c[h[s]].state[g?"selected":"checked"]){for(a=0,o=c[h[s]].children_d.length;o>a;a++)c[c[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(c[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=l.children_d.length;n>s;s++)c[l.children_d[s]].children.length||_.push(c[l.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(l=c[_[a]];l&&l.id!==e.jstree.root;){for(r=0,s=0,n=l.children.length;n>s;s++)r+=c[l.children[s]].state[g?"selected":"checked"];if(r!==n)break;l.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(l.id),d=this.get_node(l,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,c=this.get_node(o.parent),l=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection;if(-1!==h.indexOf("down"))for(this._data[_?"core":"checkbox"].selected=e.vakata.array_unique(this._data[_?"core":"checkbox"].selected.concat(o.children_d)),r=0,s=o.children_d.length;s>r;r++)a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;c&&c.id!==e.jstree.root;){for(n=0,r=0,s=c.children.length;s>r;r++)n+=d[c.children[r]].state[_?"selected":"checked"];if(n!==s)break;c.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(c.id),a=this.get_node(c,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}-1!==h.indexOf("down")&&l.length&&l.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)n=o[a.children_d[r]],n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection;if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[c?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[c?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),n=this.get_node(a.parents[r],!0),n&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(n=[],r=0,s=this._data[c?"core":"checkbox"].selected.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[r],a.parents)||n.push(this._data[c?"core":"checkbox"].selected[r]);this._data[c?"core":"checkbox"].selected=e.vakata.array_unique(n),-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,c=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[c?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[c?"selected":"checked"];if(!(s>0&&n===s))break;o.state[c?"selected":"checked"]=!0,this._data[c?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(c?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,c=i.old_parent,l=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(c);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=l;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,c=this._data[d?"core":"checkbox"].selected,l=[],h=this;for(i=0,r=c.length;r>i;i++)if(o[c[i]]&&o[c[i]].parents)for(s=0,n=o[c[i]].parents.length;n>s;s++)a[o[c[i]].parents[s]]===t&&o[c[i]].parents[s]!==e.jstree.root&&(a[o[c[i]].parents[s]]=!0,l.push(o[c[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,c=h.get_node(this);if(c.state.loaded){for(i=0,r=c.children_d.length;r>i;i++)if(d=o[c.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,l.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,l.push(d.parents[s]))}else if(c.original&&c.original.state&&c.original.state.undetermined&&c.original.state.undetermined===!0)for(a[c.id]===t&&c.id!==e.jstree.root&&(a[c.id]=!0,l.push(c.id)),s=0,n=c.parents.length;n>s;s++)a[c.parents[s]]===t&&c.parents[s]!==e.jstree.root&&(a[c.parents[s]]=!0,l.push(c.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=l.length;r>i;i++)o[l[i]].state[d?"selected":"checked"]||(c=this.get_node(l[i],!0),c&&c.length&&c.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,c=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),c=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(c.className+=" jstree-checkbox-disabled"),d.insertBefore(c,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||t.state[n?"selected":"checked"]===!0||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t})))):!1},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t})))):!1},this.activate_node=function(t,i){return e(i.target).hasClass("jstree-checkbox-disabled")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):this.is_disabled(t)?!1:(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):(t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.checked:!1)},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a,o;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(o=this.get_node(t),o&&o.state.loaded))for(s=0,n=o.children_d.length;n>s;s++)this._model.data[o.children_d[s]].state.checked&&(a=!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,o.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(l).on("context_hide.vakata.jstree",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(i=this.get_node(i),!i||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),c=!1,l=!1;(a.show_at_node||r===t||s===t)&&(c=d.offset(),r=c.left,s=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),l=a.items,e.isFunction(l)&&(l=l.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(l)&&this._show_contextmenu(i,r,s,l)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(l).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(l).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return t=i.items[t],t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:i.reference,element:i.element}))&&t.action?t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}}):!1},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return r?(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(r._disabled===!0||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0),s&&(n+=s)),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0))):!0}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10?n:!1},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left+i.outerWidth(),n=i.offset().top,a=r.width(),o=r.height(),d=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[s-(a+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[s+a+10>d?"addClass":"removeClass"]("vakata-context-right"),n+o+10>c&&r.css("bottom","-1px"),r.show()}},show:function(r,s,n){var a,o,d,c,l,h,_,u,g=!0;switch(i.element&&i.element.length&&i.element.width(""),g){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,c=i.position_y,l=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth(),d<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20)),d+l+20>_&&(d=_-(l+20)),c+h+20>u&&(c=u-(h+20)),i.element.css({left:d,top:c}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(l).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1},e.jstree.plugins.dnd=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){
if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);return this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type)&&(this.settings.dnd.is_draggable===!0||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))?(this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},e(function(){var t=!1,i=!1,r=!1,s=!1,n=e('<div id="jstree-marker">&#160;</div>').hide();e(l).on("dnd_start.vakata.jstree",function(e,i){t=!1,r=!1,i&&i.data&&i.data.jstree&&n.appendTo("body")}).on("dnd_move.vakata.jstree",function(a,o){if(s&&clearTimeout(s),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){r=o.event;var d,c,l,h,_,u,g,f,p,m,v,j,y,k,x=e.jstree.reference(o.event.target),b=!1,w=!1,C=!1;if(x&&x._data&&x._data.dnd)if(n.attr("class","jstree-"+x.get_theme()+(x.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+x.get_theme()+" jstree-"+x.get_theme()+"-"+x.get_theme_variant()+" "+(x.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==x.element[0]&&o.event.target!==x.get_container_ul()[0]||0!==x.get_container_ul().children().length){if(b=x.settings.dnd.large_drop_target?e(o.event.target).closest(".jstree-node").children(".jstree-anchor"):e(o.event.target).closest(".jstree-anchor"),b&&b.length&&b.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(w=b.offset(),C=o.event.pageY-w.top,l=b.outerHeight(),u=l/3>C?["b","i","a"]:C>l-l/3?["a","i","b"]:C>l/2?["i","a","b"]:["i","b","a"],e.each(u,function(r,a){switch(a){case"b":d=w.left-6,c=w.top,h=x.get_parent(b),_=b.parent().index();break;case"i":y=x.settings.dnd.inside_pos,k=x.get_node(b.parent()),d=w.left-2,c=w.top+l/2+1,h=k.id,_="first"===y?0:"last"===y?k.children.length:Math.min(y,k.children.length);break;case"a":d=w.left-6,c=w.top+l,h=x.get_parent(b),_=b.parent().index()+1}for(g=!0,f=0,p=o.data.nodes.length;p>f;f++)if(m=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",v=_,"move_node"===m&&"a"===a&&o.data.origin&&o.data.origin===x&&h===x.get_parent(o.data.nodes[f])&&(j=x.get_node(h),v>e.inArray(o.data.nodes[f],j.children)&&(v-=1)),g=g&&(x&&x.settings&&x.settings.dnd&&x.settings.dnd.check_while_dragging===!1||x.check(m,o.data.origin&&o.data.origin!==x?o.data.origin.get_node(o.data.nodes[f]):o.data.nodes[f],h,v,{dnd:!0,ref:x.get_node(b.parent()),pos:a,origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==x,is_foreign:!o.data.origin})),!g){x&&x.last_error&&(i=x.last_error());break}return"i"===a&&b.parent().is(".jstree-closed")&&x.settings.dnd.open_timeout&&(s=setTimeout(function(e,t){return function(){e.open_node(t)}}(x,b),x.settings.dnd.open_timeout)),g?(t={ins:x,par:h,pos:"i"!==a||"last"!==y||0!==_||x.is_loaded(k)?_:"last"},n.css({left:d+"px",top:c+"px"}).show(),o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),i={},u=!0,!1):void 0}),u===!0))return}else{for(g=!0,f=0,p=o.data.nodes.length;p>f&&(g=g&&x.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==x?o.data.origin.get_node(o.data.nodes[f]):o.data.nodes[f],e.jstree.root,"last",{dnd:!0,ref:x.get_node(e.jstree.root),pos:"i",origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==x,is_foreign:!o.data.origin}),g);f++);if(g)return t={ins:x,par:e.jstree.root,pos:"last"},n.hide(),void o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.hide()}}).on("dnd_scroll.vakata.jstree",function(e,i){i&&i.data&&i.data.jstree&&(n.hide(),t=!1,r=!1,i.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(a,o){if(s&&clearTimeout(s),o&&o.data&&o.data.jstree){n.hide().detach();var d,c,l=[];if(t){for(d=0,c=o.data.nodes.length;c>d;d++)l[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](l,t.par,t.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&i&&i.error&&"check"===i.error&&(d=d.jstree(!0),d&&d.settings.core.error.call(this,i));r=!1,t=!1}}).on("keyup.jstree keydown.jstree",function(t,i){i=e.vakata.dnd._get(),i&&i.data&&i.data.jstree&&(i.helper.find(".jstree-copy").first()[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),r&&(r.metaKey=t.metaKey,r.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",r)))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,i){var r=e.vakata.dnd._get();r.event=i,e(l).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(l).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(l).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(i){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(i===!0)return!1;var r=t.scroll_e.scrollTop(),s=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(r+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(s+t.scroll_l*e.vakata.dnd.settings.scroll_speed),(r!==t.scroll_e.scrollTop()||s!==t.scroll_e.scrollLeft())&&e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(i,r,s){"touchstart"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=l.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{i.currentTarget.unselectable="on",i.currentTarget.onselectstart=function(){return!1},i.currentTarget.style&&(i.currentTarget.style.MozUserSelect="none")}catch(n){}return t.init_x=i.pageX,t.init_y=i.pageY,t.data=r,t.is_down=!0,t.element=i.currentTarget,t.target=i.target,t.is_touch="touchstart"===i.type,s!==!1&&(t.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(l).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(l).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(i){if("touchmove"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=l.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(i.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(i.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",i)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,c=!1,h=!1,_=!1,u=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-i.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),i.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-i.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),i.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l?(t.scroll_e=e(this),!1):void 0}),t.scroll_e||(r=e(l),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),c=r.scrollTop(),h=r.scrollLeft(),n>a&&i.pageY-c<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),n>a&&a-(i.pageY-c)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),o>d&&i.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),o>d&&d-(i.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=r)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(_=parseInt(i.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(i.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+t.helper_w>o&&(u=o-(t.helper_w+2)),t.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",i),!1}},stop:function(i){if("touchend"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=l.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",i);else if("touchend"===i.type&&i.target===t.target){var r=setTimeout(function(){e(i.target).click()},100);e(i.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this._data.massload={}},this._load_nodes=function(t,r,s){var n=this.settings.massload;return s&&!e.isEmptyObject(this._data.massload)?i._load_nodes.call(this,t,r,s):e.isFunction(n)?n.call(this,t,e.proxy(function(e){if(e)for(var n in e)e.hasOwnProperty(n)&&(this._data.massload[n]=e[n]);i._load_nodes.call(this,t,r,s)},this)):"object"==typeof n&&n&&n.url?(n=e.extend(!0,{},n),e.isFunction(n.url)&&(n.url=n.url.call(this,t)),e.isFunction(n.data)&&(n.data=n.data.call(this,t)),e.ajax(n).done(e.proxy(function(e,n,a){if(e)for(var o in e)e.hasOwnProperty(o)&&(this._data.massload[o]=e[o]);i._load_nodes.call(this,t,r,s)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s)},this))):i._load_nodes.call(this,t,r,s)},this._load_node=function(t,r){var s=this._data.massload[t.id];return s?this["string"==typeof s?"_append_html_data":"_append_json_data"](t,"string"==typeof s?e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}):s,function(e){r.call(this,e),delete this._data.massload[t.id]}):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n=this._model.data,a=[];for(r=0,s=i.res.length;s>r;r++)n[i.res[r]]&&!n[i.res[r]].state.hidden&&(a.push(i.res[r]),a=a.concat(n[i.res[r]].parents),this._data.search.smc&&(a=a.concat(n[i.res[r]].children_d)));a=e.vakata.array_remove_item(e.vakata.array_unique(a),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(a)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&this.show_node(this._data.search.hdn)},this))},this.search=function(i,r,s,n,a,o){if(i===!1||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,c,l=this.settings.search,h=l.ajax?l.ajax:!1,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=l.show_only_matches),o===t&&(o=l.show_only_matches_children),!r&&h!==!1)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)},!0)},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)},!0)},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:l.case_sensitive,fuzzy:l.fuzzy}),e.each(_[n?n:e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&(!l.search_leaves_only||r.state.loaded&&0===r.children.length)&&(l.search_callback&&l.search_callback.call(this,i,r)||!l.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,c=f.length;c>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&this.open_node(f[d],null,0)===!0&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments),t&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),r.fuzzy!==!1&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,c=r.distance,l=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return c?i+r/c:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,c,_,u,g,f,p,m,v=e.length,j=l,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),y=e.lastIndexOf(t,d+h),-1!==y&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(c=0,_=k;_>c;)a(i,d+_)<=j?c=_:k=_,_=Math.floor((k-c)/2+c);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],0===i?p[o]=(p[o+1]<<1|1)&m:p[o]=(p[o+1]<<1|1)&m|((u[o+1]|u[o])<<1|1)|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},i===!0?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if(t=this.get_node(t),t&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var u=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){u&&clearTimeout(u),u=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(i){return!1}return t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl?!1:(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),t?(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0):!1)},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"default":{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types["default"])for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types["default"])s.types["default"].hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types["default"][a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a=this._model.data,o=r.nodes,d=this.settings.types,c="default";for(s=0,n=o.length;n>s;s++)c="default",a[o[s]].original&&a[o[s]].original.type&&d[a[o[s]].original.type]&&(c=a[o[s]].original.type),a[o[s]].data&&a[o[s]].data.jstree&&a[o[s]].data.jstree.type&&d[a[o[s]].data.jstree.type]&&(c=a[o[s]].data.jstree.type),a[o[s]].type=c,a[o[s]].icon===!0&&d[c].icon!==t&&(a[o[s]].icon=d[c].icon);a[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},c=r.get_json.call(this,t,d,s);if(c===!1)return!1;if(e.isArray(c))for(n=0,a=c.length;a>n;n++)c[n].type=c[n].id&&o[c[n].id]&&o[c[n].id].type?o[c[n].id].type:"default",i&&i.no_id&&(delete c[n].id,c[n].li_attr&&c[n].li_attr.id&&delete c[n].li_attr.id,c[n].a_attr&&c[n].a_attr.id&&delete c[n].a_attr.id);else c.type=c.id&&o[c.id]&&o[c.id].type?o[c.id].type:"default",i&&i.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(r.check.call(this,i,s,n,a,o)===!1)return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,c,l,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(_&&s.children_d&&s.parents){for(c=0,l=0,h=s.children_d.length;h>l;l++)c=Math.max(c,_[s.children_d[l]].parents.length);c=c-s.parents.length+1}(0>=c||c===t)&&(c=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;n=this.get_node(n.parent),d=this.get_rules(n),c++}while(n)}}return!0},this.get_rules=function(e){if(e=this.get_node(e),!e)return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return t=this.get_node(t),t?i?e.extend({type:t.type},this.settings.types[t.type]):t.type:!1},this.set_type=function(i,r){var s,n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}return s=this.settings.types,i=this.get_node(i),s[r]&&i?(o=i.type,d=this.get_icon(i),i.type=r,(d===!0||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon!==t?s[r].icon:!0),!0):!1}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(r.check.call(this,t,i,s,n,a)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s),!s||!s.children)return!0;var o,d,c="rename_node"===t?n:i.text,l=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)l.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(c=c.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(c,l)||i.text&&i.text[h?"toString":"toLowerCase"]()===c,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"create_node":return o=-1===e.inArray(c,l),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"copy_node":return o=-1===e.inArray(c,l),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(c,l),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),i=this.get_node(i),!i)return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,c,l,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(c=d=this.get_string("New node"),l=[],h=0,_=i.children.length;_>h;h++)l.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?c:c.toLowerCase(),l);)c=f.call(this,d,++h).toString();s.text=c}return r.create_node.call(this,i,s,n,a,o)}};var g=l.createElement("DIV");if(g.setAttribute("unselectable","on"),g.setAttribute("role","presentation"),g.className="jstree-wholerow",g.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)s=this.get_node(t.selected[i],!0),s&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=g.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},l.registerElement&&Object&&Object.create){var f=Object.create(HTMLElement.prototype);f.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{l.registerElement("vakata-jstree",{prototype:f})}catch(p){}}}});
/*
 * http://github.com/deitch/jstree-grid
 *
 * This plugin handles adding a grid to a tree to display additional data
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Works only with jstree version >= 3.0.0
 *
 * $Date: 2015-11-29 $
 * $Revision:  3.4.2 $
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,i,r,s,d,n=/^\s*$/g,a=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,o=function(e){return(e||"").replace(a,"\\$&")},l="data-jstreegrid",h="_DATA_",c=24,p=!1,g="jsgrid_",u="_col",f=10,v=function(e,t){return e.find("div["+l+"='"+t+"']")},m=!1,j=null,_=0,w=0;s=/<\/?[^>]+>/gi,r=function(t,i){var r,s,d,n;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?n=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),d=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),d.appendTo(r),r.appendTo(e("body")),n=s.width()||c,d.detach(),r.remove(),i._gridSettings.indent=n),n},d=function(e,t){var i,r=e.get_node(t),s=r.children;return i=!s||s.length<=0||!r.state.opened?t:d(e,s[s.length-1])},t=function(e,t){var i,s,d=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,s=d-i*r(e,t),d},i=function(e,t,i){var r,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),n=i.settings.grid.columns[0];r="",n.title&&(n.title===h?r=i.get_text(t):t.attr(n.title)&&(r=t.attr(n.title))),r=r.replace(s,""),r&&d.attr("title",r)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(t,r){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,d=s.parent(),n=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,stateful:r.stateful,indent:0},a=n.columns,o=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){o=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=o,this.rootid=s.attr("id");var l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var h=parseFloat(navigator.appVersion.split("MSIE")[1]);8>h&&(n.defaultConf.display="inline",n.defaultConf.zoom="1")}for(p||(p=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(d),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<a.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+o+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){this.get_node(t||"#",!0);return '',!1},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)v(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&v(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,v(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,v(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;v(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;v(this.gridWrapper,r).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)v(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell-regular").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&v(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",e.proxy(function(e,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?v(i,t).remove():i.find("div.jstree-grid-cell-regular").remove()},this._prepare_headers=function(){var t,i,r,s,d,n,a,o,l,h,c=this._gridSettings,p=c.columns||[],g=c.columnWidth,u=c.resizable||!1,v=c.isThemeroller,x=v?"themeroller":"regular",y=!1,C=this.gridparent,b=this.rootid,W=c.defaultConf,S=0,z=0;for(this.parent=C,i=0;i<p.length;i++)d=p[i].headerClass||"",n=p[i].columnClass||"",a=p[i].header||"",a&&(y=!0),s=c.stateful&&localStorage["jstree-root-"+b+"-column-"+i]?localStorage["jstree-root-"+b+"-column-"+i]:p[i].width||g,S=v?7:10,"auto"!==s&&"string"!=typeof s&&(s-=S),o=0===i?3:0,r=this.midWrapper.children("div.jstree-grid-column-"+i),l=e("<div></div>").css(W).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+i+" "+(v?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+x+" "+d+" "+n).html(a),l.addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+x),l.prependTo(r),z+=l.outerWidth(),h=e("<div class='jstree-grid-separator jstree-grid-separator-"+x+(v?" ui-widget-header":"")+(u?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(l),r.width(s),r.css("min-width",s),r.css("max-width",s);l.addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+x),void 0===p[p.length-1].width&&(z-=s,r.css({width:"auto"}),l.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),y?c.header=t:e("div.jstree-grid-header").hide(),!this.bound&&u&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,d,n;m&&(n=j.prevAll(".jstree-grid-column").length,d=j.closest(".jstree-grid-wrapper").find(".jstree"),t=e.jstree.reference(d),i=t.settings.grid.columns,s=j.parent().children("div.jstree-grid-column"),(isNaN(n)||0>n)&&(t._gridSettings.treeWidthDiff=d.find("ins:eq(0)").width()+d.find("a:eq(0)").width()-t._gridSettings.columns[0].width),r=t._gridSettings.columns[n].width=parseFloat(j.css("width")),m=!1,j=null,d.trigger("resize_column.jstree-grid",[n,r]))}).mousemove(function(e){if(m){w=e.pageX;var t,i,r,s=w-_;0!==s&&(t=j.width(),i=parseFloat(j.css("width")),i||(i=j.innerWidth()),s=0>s?Math.max(s,-t):s,r=i+s,(s>0||t>0)&&r>f&&(j.width(r+"px"),j.css("min-width",r+"px"),j.css("max-width",r+"px"),_=w))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return m=!0,_=t.pageX,j=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),d=s.closest("div.jstree-grid-column"),n=parseFloat(d.css("width")),a=0,o=d.prevAll(".jstree-grid-column").length,l=d.width();d.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>a&&(a=t)}),i=a-n,i=0>i?Math.max(i,-l):i,r=n+i+"px",d.width(r),d.css("min-width",r),d.css("max-width",r),e(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[o,r])}))},this.redraw_node=function(e,t,i,s){return e=r.redraw_node.call(this,e,t,i,s),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),r.refresh.apply(this,arguments)},this.set_id=function(e,t){var i;e&&(i=e.id);var s=r.set_id.apply(this,arguments);if(s&&void 0!==i){var d,n=this.gridWrapper,a=[i];for(e&&e.children_d&&(a=a.concat(e.children_d)),d=0;d<a.length;d++)v(n,a[d]).attr(l,e.id).attr("id",g+e.id+u+(d+1)).removeClass(g+i+u).addClass(g+e.id+u)}return s},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)v(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,d,n=e(),a=t.children||[];for(d=0;d<a.length;d++)s=g+o(a[d])+u+i,r[s]&&t.state.opened&&(n=n.add(r[s]).add(this.getHoldingCells(this.get_node(a[d]),i,r)));return n},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,d=this.element.width(),n=t.data[i.value],a=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=e("<input />",{value:n,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=o.val();""===e||e===n?e=n:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:n}),this._prepare_grid(this.get_node(t,!0))),o.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=n),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){o.width(Math.min(a.text("pW"+this.value).width(),d))},keypress:function(e){return 13===e.which?!1:void 0}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(o),o.css(l).width(Math.min(a.text("pW"+o[0].value).width(),d))[0].select()},this._prepare_grid=function(t){var r,a,h,c,p,f,m,j,_,w,x,y,C,b,W,S,z,k,T,A,P,F,V,q,D,L,M,N,I,B=this._gridSettings,H=B.treeClass,E=this,U=B.columns||[],X=B.isThemeroller,$=this.element,Q=this.rootid,Y=X?"themeroller":"regular",G=this.get_node(t),J=B.columnWidth,K=B.defaultConf,O=function(t,i,r,s,d){return function(d){i.children(".jstree-anchor").trigger("click.jstree",d),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}},R=function(t,i,r,s,d){return function(t){B.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=d.get_node(i);E._edit(r,s,t.target)}}}))}},Z=function(e,t){return function(){t.hover_node(e)}},ee=function(e,t){return function(){t.dehover_node(e)}},te=this.midWrapper,ie=G.id,re=this.get_node(G.parent).children,se=jQuery.inArray(ie,re),de=this.holdingCells,ne=!1;if(r=e(t),_=r.children("a"),1===_.length){for(I=!G.state.opened,S=g+o(ie)+u,z="#"===G.parent?null:G.parent,_.addClass(H),i(_,r,E),w=_,c=0;c<U.length;c++)this.treecol!==c&&(D=U[c],N=te.children("div:eq("+c+")"),f=D.cellClass||"",m=D.wideCellClass||"",j=D.columnClass||"",N.addClass(j),p=void 0!==D.value&&null!==D.value?"function"==typeof D.value?D.value(G):null!==G.data&&void 0!==G.data&&void 0!==G.data[D.value]?G.data[D.value]:"":"","function"==typeof D.format&&(p=D.format(p)),D.images?(h=D.images[p]||D.images["default"],h&&(L="*"===h[0]?'<span class="'+h.substr(1)+'"></span>':'<img src="'+h+'">')):L=p,(void 0===L||null===L||n.test(L))&&(L="&nbsp;"),x=D.valueClass&&null!==G.data&&void 0!==G.data?G.data[D.valueClass]||"":"",x&&D.valueClassPrefix&&""!==D.valueClassPrefix&&(x=D.valueClassPrefix+x),y=D.wideValueClass&&null!==G.data&&void 0!==G.data?G.data[D.wideValueClass]||"":"",y&&D.wideValueClassPrefix&&""!==D.wideValueClassPrefix&&(y=D.wideValueClassPrefix+y),W=D.title&&null!==G.data&&void 0!==G.data?G.data[D.title]||"":"",W=W.replace(s,""),b=7,a=D.width||J,"auto"!==a&&(a=M||a-b),w=v(N,ie),(!w||w.length<1)&&(w=e("<div></div>"),e("<span></span>").appendTo(w),w.attr("id",S+c),w.addClass(S),w.attr(l,ie)),A=0>=se?G.parent:d(this,re[se-1]),T=v(N,A),F=se>=re.length-1?"NULL":re[se+1],P=v(N,F),q=G.children&&G.children.length>0?G.children[0]:"NULL",V=v(N,q),k=v(N,z),z?(k&&k.length>0?(T&&T.length>0?w.insertAfter(T):V&&V.length>0?w.insertBefore(V):P&&P.length>0?w.insertBefore(P):w.insertAfter(k),ne=!0):ne=!1,de[S+c]=w):(T&&T.length>0?w.insertAfter(T):V&&V.length>0?w.insertBefore(V):P&&P.length>0?w.insertBefore(P):w.appendTo(N),ne=!0),ne&&w.after(this.getHoldingCells(G,c,de)),C=w.children("span"),C.addClass(f+" "+x).html(L),w=w.css(K).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+Q+" jstree-grid-cell-"+Y+" "+m+" "+y+(X?" ui-state-default":"")).addClass("jstree-grid-col-"+c),w.click(O($,r,p,D,this)),w.on("contextmenu",R($,r,p,D,this)),w.hover(Z(r,this),ee(r,this)),W&&C.attr("title",W));w.addClass("jstree-grid-cell-last"+(X?" ui-state-default":"")),void 0===U[U.length-1].width&&w.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});
/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
var CMS = window.CMS || {};

// #############################################################################
// MODAL
(function ($) {
    'use strict';

    /**
     * The pagetree is loaded via `/admin/cms/page` and has a custom admin
     * templates stored within `templates/admin/cms/page/tree`.
     *
     * @class PageTree
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.PageTree = new CMS.Class({
        // TODO add mechanics to set the home page
        initialize: function initialize(options) {
            // options are loaded from the pagetree html node
            this.options = $('.js-cms-pagetree').data('json');
            this.options = $.extend(true, {}, this.options, options);

            // states and events
            this.click = 'click.cms.pagetree';
            this.cache = {
                id: null,
                target: null,
                type: ''
            };
            this.successTimer = 1000;

            // elements
            this._setupUI();
            this._events();

            // cancel if pagtree is not available
            if (!$.isEmptyObject(this.options)) {
                this._setup();
            }
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var pagetree = $('.cms-pagetree');
            this.ui = {
                container: pagetree,
                document: $(document),
                tree: pagetree.find('.js-cms-pagetree'),
                dialog: $('.js-cms-tree-dialog'),
                siteForm: $('.js-cms-pagetree-site-form')
            };
        },

        /**
         * Setting up the jstree and the related columns.
         *
         * @method _setup
         * @private
         */
        _setup: function _setup() {
            var that = this;
            var columns = [];
            var obj = {
                language: this.options.lang.code,
                openNodes: []
            };
            var data = false;

            // make sure that ajax request send the csrf token
            CMS.API.Helpers.csrf(this.options.csrf);

            // setup column headings
            $.each(this.options.columns, function (index, obj) {
                if (obj.key === '') {
                    // the first row is already populated, to avoid overwrites
                    // just leave the "key" param empty
                    columns.push({
                        header: obj.title,
                        width: obj.width || '1%',
                        wideCellClass: obj.cls
                    });
                } else {
                    columns.push({
                        header: obj.title,
                        value: function (node) {
                            // it needs to have the "colde" format and not "col-de"
                            // as jstree will convert "col-de" to "colde"
                            // also we strip dashes, in case language code contains it
                            // e.g. zh-hans, zh-cn etc
                            if (node.data) {
                                return node.data['col' + obj.key.replace('-', '')];
                            } else {
                                return '';
                            }
                        },
                        width: obj.width || '1%',
                        wideCellClass: obj.cls
                    });
                }
            });

            // prepare data
            if (!this.options.filtered) {
                data = {
                    url: this.options.urls.tree,
                    data: function (node) {
                        // '#' is rendered if its the root node, there we only
                        // care about `obj.openNodes`, in the following case
                        // we are requesting a specific node
                        if (node.id !== '#') {
                            obj.pageId = that._storeNodeId(node.data.id);
                        } else {
                            obj.pageId = null;
                        }

                        // we need to store the opened items inside the localstorage
                        // as we have to load the pagetree with the previous opened
                        // state
                        obj.openNodes = that._getStoredNodeIds();

                        // we need to set the site id to get the correct tree
                        obj.site = that.options.site;

                        return obj;
                    }
                };
            }

            // bind options to the jstree instance
            this.ui.tree.jstree({
                core: {
                    // disable open/close animations
                    animation: 0,
                    // core setting to allow actions
                    check_callback: function () {
                        // cancel dragging when filtering is active by setting `false`
                        return (that.options.filtered) ? false : true;
                    },
                    // https://www.jstree.com/api/#/?f=$.jstree.defaults.core.data
                    data: data,
                    // strings used within jstree that are called using `get_string`
                    strings: {
                        'Loading ...': this.options.lang.loading,
                        'New node': this.options.lang.newNode,
                        'nodes': this.options.lang.nodes
                    },
                    error: function (error) {
                        that.showError(error.reason);
                    },
                    themes: {
                        name: 'django-cms'
                    },
                    // disable the multi selection of nodes for now
                    multiple: false
                },
                // activate drag and drop plugin
                plugins : ['dnd', 'search', 'grid'],
                // https://www.jstree.com/api/#/?f=$.jstree.defaults.dnd
                dnd: {
                    inside_pos: 'last',
                    // disable the multi selection of nodes for now
                    drag_selection: false,
                    // disable dragging if filtered
                    is_draggable: function () {
                        return (that.options.filtered) ? false : true;
                    },
                    // disable CMD/CTRL copy
                    copy: false
                },
                // https://github.com/deitch/jstree-grid
                grid: {
                    // columns are provided from base.html options
                    width: '100%',
                    columns: columns
                }
            });
        },

        /**
         * Sets up all the event handlers, such as opening and moving.
         *
         * @method _events
         * @private
         */
        _events: function _events() {
            var that = this;

            // set events for the nodeId updates
            this.ui.tree.on('after_close.jstree', function (e, el) {
                that._removeNodeId(el.node.data.id);
            });
            this.ui.tree.on('after_open.jstree', function (e, el) {
                that._storeNodeId(el.node.data.id);
                that._checkHelpers();
            });

            // store moved position node
            this.ui.tree.on('move_node.jstree copy_node.jstree', function (e, obj) {
                if (!that.cache.type || that.cache.type === 'cut') {
                    that._moveNode(that._getNodePosition(obj)).done(function () {
                        var instance = that.ui.tree.jstree(true);

                        instance._hide_grid(instance.get_node(obj.parent));
                        if (obj.parent === '#') {
                            instance.refresh();
                        } else {
                            // have to refresh parent, because refresh only
                            // refreshes children of the node, never the node itself
                            instance.refresh_node(obj.parent);
                        }
                    });
                } else {
                    that._copyNode(obj);
                }
                // we need to open the parent node if we trigger an element
                // if not already opened
                that.ui.tree.jstree('open_node', obj.parent);
            });

            // set event for cut and paste
            this.ui.container.on(this.click, '.js-cms-tree-item-cut', function (e) {
                e.preventDefault();
                that._cutOrCopy({ type: 'cut', element: $(this) });
            });

            // set event for cut and paste
            this.ui.container.on(this.click, '.js-cms-tree-item-copy', function (e) {
                e.preventDefault();
                that._cutOrCopy({ type: 'copy', element: $(this) });
            });

            // attach events to paste
            this.ui.container.on(this.click, '.cms-tree-item-helpers a', function (e) {
                e.preventDefault();
                that._paste(e);
            });

            // advanced settings link handling
            this.ui.container.on(this.click, '.js-cms-tree-advanced-settings', function (e) {
                if (e.shiftKey) {
                    e.preventDefault();
                    window.location.href = $(this).data('url');
                }
            });

            // add events for error reload (messagelist)
            this.ui.document.on(this.click, '.messagelist .cms-tree-reload', function (e) {
                e.preventDefault();
                that._reloadHelper();
            });

            // propagnate the sites dropdown to the hidden sites form
            this.ui.container.find('.js-cms-pagetree-site-trigger').on(this.click, function (e) {
                e.preventDefault();
                // prevent if parent is active
                if ($(this).parent().hasClass('active')) {
                    return false;
                }
                that.ui.siteForm.find('select')
                    .val($(this).data().id).end().submit();
            });

            // additional event handlers
            this._setFilter();
            this._setTooltips();
            this._setSearch();

            // make sure ajax post requests are working
            this._setAjaxPost('.js-cms-tree-item-menu a');
            this._setAjaxPost('.js-cms-tree-lang-trigger');
        },

        /**
         * Helper to process the cut and copy events.
         *
         * @method _cutOrCopy
         * @param {Object} [opts]
         * @param {Number} [opts.type] either 'cut' or 'copy'
         * @param {Number} [opts.element] originated trigger element
         * @private
         */
        _cutOrCopy: function _cutOrCopy(obj) {
            // prevent actions if you try to copy a page with an apphook
            if (obj.type === 'copy' && obj.element.data().apphook) {
                this.showError(this.options.lang.apphook);
                return false;
            }

            var jsTreeId = this._getNodeId(obj.element.closest('.jstree-grid-cell'));
            // resets if we click again
            if (this.cache.type === obj.type && jsTreeId === this.cache.id) {
                this.cache.type = null;
                this._hideHelpers();
            } else {
                // we need to cache the node and type so `_showHelpers`
                // will trigger the correct behaviour
                this.cache.target = obj.element;
                this.cache.type = obj.type;
                this.cache.id = jsTreeId;
                this._showHelpers();
                this._checkHelpers();
            }
        },

        /**
         * Helper to process the paste event.
         *
         * @method _paste
         * @private
         * @return {Object} event originated event handler
         */
        _paste: function _paste(event) {
            // hide helpers after we picked one
            this._hideHelpers();

            var copyFromId = this._getNodeId(this.cache.target);
            var copyToId = this._getNodeId($(event.currentTarget));

            // copyToId contains `jstree-1`, assign to root
            if (copyToId.indexOf('jstree-1') > -1) {
                copyToId = '#';
            }

            if (this.cache.type === 'cut') {
                this.ui.tree.jstree('cut', copyFromId);
            } else {
                this.ui.tree.jstree('copy', copyFromId);
            }

            this.ui.tree.jstree('paste', copyToId, 'last');
            this.cache.type = null;
            this.cache.target = null;
        },

        /**
         * Retreives a list of nodes from local storage.
         *
         * @method _getStoredNodeIds
         * @private
         * @return {Array} list of ids
         */
        _getStoredNodeIds: function _getStoredNodeIds() {
            return CMS.settings.pagetree || [];
        },

        /**
         * Stores a node in local storage.
         *
         * @method _storeNodeId
         * @private
         * @param {String} id to be stored
         * @return {String} id that has been stored
         */
        _storeNodeId: function _storeNodeId(id) {
            var number = id;
            var storage = this._getStoredNodeIds();

            // store value only if it isn't there yet
            if (storage.indexOf(number) === -1) {
                storage.push(number);
            }

            CMS.settings.pagetree = storage;
            CMS.API.Helpers.setSettings(CMS.settings);

            return number;
        },

        /**
         * Removes a node in local storage.
         *
         * @method _removeNodeId
         * @private
         * @param {String} id to be stored
         * @return {String} id that has been removed
         */
        _removeNodeId: function _removeNodeId(id) {
            var number = id;
            var storage = this._getStoredNodeIds();
            var index = storage.indexOf(number);

            // remove given id from storage
            if (index !== -1) {
                storage.splice(index, 1);
            }

            CMS.settings.pagetree = storage;
            CMS.API.Helpers.setSettings(CMS.settings);

            return number;
        },

        /**
         * Moves a node after drag & drop.
         *
         * @method _moveNode
         * @param {Object} [opts]
         * @param {Number} [opts.id] current element id for url matching
         * @param {Number} [opts.target] target sibling or parent
         * @param {Number} [opts.position] either `left`, `right` or `last-child`
         * @returns {$.Deferred} ajax request object
         * @private
         */
        _moveNode: function _moveNode(obj) {
            var that = this;
            obj.site = that.options.site;

            return $.ajax({
                method: 'post',
                url: that.options.urls.move.replace('{id}', obj.id),
                data: obj
            }).done(function () {
                that._showSuccess(obj.id);
            }).fail(function (error) {
                that.showError(error.statusText);
            });
        },

        /**
         * Copies a node into the selected node.
         *
         * @method _copyNode
         * @param {String} copyFromId element to be cut
         * @param {String} copyToId destination to inject
         * @private
         */
        _copyNode: function _copyNode(obj) {
            var that = this;
            var node = that._getNodePosition(obj);
            var data = {
                site: this.options.site,
                // we need to refer to the original item here, as the copied
                // node will have no data attributes stored at it (not a clone)
                id: obj.original.data.id,
                position: node.position
            };

            // if there is no target provided, the node lands in root
            if (node.target) {
                data.target = node.target;
            }

            // we need to load a dialog first, to check if permissions should
            // be copied or not
            $.ajax({
                method: 'post',
                url: that.options.urls.copyPermission.replace('{id}', data.id),
                data: data
            // the dialog is loaded via the ajax respons originating from
            // `templates/admin/cms/page/tree/copy_premissions.html`
            }).done(function (dialog) {
                that.ui.dialog.append(dialog);
            }).fail(function (error) {
                that.showError(error.statusText);
            });

            // attach events to the permission dialog
            this.ui.dialog.off(this.click, '.cancel').on(this.click, '.cancel', function (e) {
                e.preventDefault();
                // remove just copied node
                that.ui.tree.jstree('delete_node', obj.node.id);
                $('.js-cms-dialog').remove();
                $('.js-cms-dialog-dimmer').remove();
            }).off(this.click, '.submit').on(this.click, '.submit', function (e) {
                e.preventDefault();
                var formData = $(this).closest('form').serialize().split('&');
                // loop through form data and attach to obj
                for (var i = 0; i < formData.length; i++) {
                    data[formData[i].split('=')[0]] = formData[i].split('=')[1];
                }
                // send the real ajax request for copying the plugin
                $.ajax({
                    method: 'post',
                    url: that.options.urls.copy.replace('{id}', data.id),
                    data: data
                }).done(function () {
                    that._reloadHelper();
                }).fail(function (error) {
                    that.showError(error.statusText);
                });
            });
        },

        /**
         * Returns element from any sub nodes.
         *
         * @method _getElement
         * @private
         * @param {jQuery} el jQuery node form where to search
         * @return {String|Boolean} jsTree node element id
         */
        _getNodeId: function _getElement(el) {
            var cls = el.closest('.jstree-grid-cell').attr('class');

            return (cls) ? cls.replace(/.*jsgrid_(.+?)_col.*/, '$1') : false;
        },

        /**
         * Gets the new node position after moving.
         *
         * @method _getNodePosition
         * @private
         * @param {Object} obj jstree move object
         * @return {Object} evaluated object with params
         */
        _getNodePosition: function _getNodePosition(obj) {
            var data = {};
            var node = this.ui.tree.jstree('get_node', obj.node.parent);

            data.position = obj.position;

            // jstree indicates no parent with `#`, in this case we do not
            // need to set the target attribute at all
            if (obj.parent !== '#') {
                data.target = node.data.id;
            }

            // some functions like copy create a new element with a new id,
            // in this case we need to set `data.id` manually
            if (obj.node && obj.node.data) {
                data.id = obj.node.data.id;
            }

            return data;
        },

        /**
         * Handles filter button display (Filter: Off).
         *
         * @method _setFilter
         * @private
         */
        _setFilter: function _setFilter() {
            var that = this;
            var trigger = $('.js-cms-tree-filter-trigger');
            var container = $('.js-cms-tree-filter-container');

            trigger.on(this.click, function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();

                container.toggleClass('hidden');

                that.ui.document.one(that.click, function () {
                    container.addClass('hidden');
                });
            });

            container.on(that.click, function (e) {
                e.stopImmediatePropagation();
            });

            // attach event for site filtering
            $('.js-cms-tree-search-site select').on('change', function () {
                $(this).closest('form').submit();
            });
        },

        /**
         * Sets up general tooltips that can have a list of links or content.
         *
         * @method _setTooltips
         * @private
         */
        _setTooltips: function _setTooltips() {
            var that = this;
            var triggerCls = '.js-cms-tree-tooltip-trigger';
            var containerCls = '.js-cms-tree-tooltip-container';
            var triggers;
            var containers;
            var index;

            // attach event to the trigger
            this.ui.container.on(this.click, triggerCls, function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();

                triggers = $(triggerCls);
                containers = $(containerCls);
                index = triggers.index(this);

                // cancel if opened tooltip is triggered again
                if (containers.eq(index).is(':visible')) {
                    containers.removeClass('cms-tree-tooltip-container-open');
                    return false;
                }

                // otherwise show the dropdown
                containers
                    .removeClass('cms-tree-tooltip-container-open')
                    .eq(index)
                    .addClass('cms-tree-tooltip-container-open');

                that.ui.document.one(that.click, function () {
                    containers.removeClass('cms-tree-tooltip-container-open');
                });
            });

            // stop propagnation on the element
            this.ui.container.on(this.click, containerCls, function (e) {
                e.stopImmediatePropagation();
            });
        },

        /**
         * Triggers the links `href` as ajax post request.
         *
         * @method _setAjaxPost
         * @private
         * @param {jQuery} trigger jQuery link target
         */
        _setAjaxPost: function _setAjaxPost(trigger) {
            var that = this;

            this.ui.container.on(this.click, trigger, function (e) {
                e.preventDefault();
                $.ajax({
                    method: 'post',
                    url: $(this).attr('href')
                }).done(function () {
                    if (window.self !== window.top) {
                        // if we're in the sideframe we have to actually
                        // check if we are publishing a page we're currently in
                        // because if the slug did change we would need to
                        // redirect to that new slug
                        // Problem here is that in case of the apphooked page
                        // the model and pk are empty and reloadBrowser doesn't really
                        // do anything - so here we specifically force the data
                        // to be the data about the page and not the model
                        var parent = (window.parent ? window.parent : window);
                        var data = {
                            // FIXME shouldn't be hardcoded
                            model: 'cms.page',
                            pk: parent.CMS.config.request.page_id
                        };
                        CMS.API.Helpers.reloadBrowser(false, false, true, data);
                    } else {
                        // otherwise simply reload the page
                        that._reloadHelper();
                    }
                }).fail(function (error) {
                    that.showError(error.statusText);
                });
            });
        },

        /**
         * Sets events for the search on the header.
         *
         * @method _setSearch
         * @private
         */
        _setSearch: function () {
            var fakeForm = this.ui.container.find('.cms-pagetree-header-search');
            var realForm = this.ui.container.find('.cms-pagetree-header-search-copy form');
            var fakeField = fakeForm.find('.cms-pagetree-header-search-field');
            var realField = realForm.find('#searchbar');

            // prepopulate
            fakeField.val(realField.val());

            // event
            fakeForm.on('submit', function (e) {
                e.preventDefault();
                realForm.find('#searchbar')
                    .val(fakeField.val())
                    .end()
                    .submit();
            });
        },

        /**
         * Shows paste helpers.
         *
         * @method _showHelpers
         * @private
         */
        _showHelpers: function _showHelpers() {
            // helpers are generated on the fly, so we need to reference
            // them every single time
            $('.cms-tree-item-helpers').removeClass('cms-hidden');
        },

        /**
         * Hides paste helpers.
         *
         * @method _hideHelpers
         * @private
         */
        _hideHelpers: function _hideHelpers() {
            // helpers are generated on the fly, so we need to reference
            // them every single time
            $('.cms-tree-item-helpers').addClass('cms-hidden');
            this.cache.id = null;
        },

        /**
         * Checks the current state of the helpers after `after_open.jstree`
         * or `_cutOrCopy` is triggered.
         *
         * @method _checkHelpers
         * @private
         */
        _checkHelpers: function _checkHelpers() {
            if (this.cache.type && this.cache.id) {
                this._showHelpers(this.cache.type);
            }

            // hide cut element and it's descendants' paste helpers if it is visible
            if (this.cache.type === 'cut' && this.cache.target) {
                var descendantIds = this.ui.tree.jstree(true).get_node(this.cache.id).children_d;

                [this.cache.id].concat(descendantIds).forEach(function (id) {
                    $('.jsgrid_' + id + '_col .cms-tree-item-helpers')
                        .addClass('cms-hidden');
                });
            }
        },

        /**
         * Shows success message on node after successful action.
         *
         * @method _showSuccess
         * @param {Number} id id of the element to add the success class
         * @private
         */
        _showSuccess: function _showSuccess(id) {
            var element = this.ui.tree.find('li[data-id="' + id + '"]');
            element.addClass('cms-tree-node-success');
            setTimeout(function () {
                element.removeClass('cms-tree-node-success');
            }, this.successTimer);
            // hide elements
            this._hideHelpers();
        },

        /**
         * Checks if we should reload the iframe or entire window. For this we
         * need to skip `CMS.API.Helpers.reloadBrowser();`.
         *
         * @method _reloadHelper
         * @private
         */
        _reloadHelper: function _reloadHelper() {
            if (window.self !== window.top) {
                window.location.reload();
            } else {
                CMS.API.Helpers.reloadBrowser();
            }
        },

        /**
         * Displays an error within the django UI.
         *
         * @method showError
         * @param {String} message string message to display
         */
        showError: function showError(message) {
            var messages = $('.messagelist');
            var breadcrumb = $('.breadcrumbs');
            var reload = this.options.lang.reload;
            var tpl = '' +
                '<ul class="messagelist">' +
                '   <li class="error">' +
                '       {msg} ' +
                '       <a href="#reload" class="cms-tree-reload"> ' + reload + ' </a>' +
                '   </li>' +
                '</ul>';
            var msg = tpl.replace('{msg}', '<strong>' + this.options.lang.error + '</strong> ' + message);

            messages.length ? messages.replaceWith(msg) : breadcrumb.after(msg);
        }

    });

    // shorthand for jQuery(document).ready();
    $(function () {
        // load cms settings beforehand
        // have to set toolbar to "expanded" by default
        // otherwise initialization will be incorrect when you
        // go first to pages and then to normal page
        CMS.config = {
            settings: {
                toolbar: 'expanded'
            },
            urls: {
                settings: $('.js-cms-pagetree').data('settings-url')
            }
        };
        CMS.settings = CMS.API.Helpers.getSettings();
        // autoload the pagetree
        new CMS.PageTree();
    });

})(CMS.$);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzdHJlZS5taW4uanMiLCJqc3RyZWUuZ3JpZC5taW4uanMiLCJjbXMucGFnZXRyZWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYnVuZGxlLmFkbWluLnBhZ2V0cmVlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gICAgVEhJUyBGSUxFIEhBUyBCRUVOIE1BTlVBTExZIFBBVENIRUQgVU5USUwgUFIgIzEzNDIgR0VUUyBSRUxFQVNFRFxuICAgIGh0dHBzOi8vZ2l0aHViLmNvbS92YWthdGEvanN0cmVlL3B1bGwvMTM0Mi9maWxlc1xuICovXG4hZnVuY3Rpb24oZSl7XCJ1c2Ugc3RyaWN0XCI7XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXCJqcXVlcnlcIl0sZSk6XCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9ZShyZXF1aXJlKFwianF1ZXJ5XCIpKTplKGpRdWVyeSl9KGZ1bmN0aW9uKGUsdCl7XCJ1c2Ugc3RyaWN0XCI7aWYoIWUuanN0cmVlKXt2YXIgaSxyLHM9MCxuPSExLGE9ITEsbz0hMSxkPVtdLGM9ZShcInNjcmlwdDpsYXN0XCIpLmF0dHIoXCJzcmNcIiksbD13aW5kb3cuZG9jdW1lbnQsaD1sLmNyZWF0ZUVsZW1lbnQoXCJMSVwiKTtoLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInRyZWVpdGVtXCIpLGk9bC5jcmVhdGVFbGVtZW50KFwiSVwiKSxpLmNsYXNzTmFtZT1cImpzdHJlZS1pY29uIGpzdHJlZS1vY2xcIixpLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxoLmFwcGVuZENoaWxkKGkpLGk9bC5jcmVhdGVFbGVtZW50KFwiQVwiKSxpLmNsYXNzTmFtZT1cImpzdHJlZS1hbmNob3JcIixpLnNldEF0dHJpYnV0ZShcImhyZWZcIixcIiNcIiksaS5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLFwiLTFcIikscj1sLmNyZWF0ZUVsZW1lbnQoXCJJXCIpLHIuY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLXRoZW1laWNvblwiLHIuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGkuYXBwZW5kQ2hpbGQociksaC5hcHBlbmRDaGlsZChpKSxpPXI9bnVsbCxlLmpzdHJlZT17dmVyc2lvbjpcIjMuMi4xXCIsZGVmYXVsdHM6e3BsdWdpbnM6W119LHBsdWdpbnM6e30scGF0aDpjJiYtMSE9PWMuaW5kZXhPZihcIi9cIik/Yy5yZXBsYWNlKC9cXC9bXlxcL10rJC8sXCJcIik6XCJcIixpZHJlZ2V4Oi9bXFxcXDomIV58KClcXFtcXF08PkAqJyt+I1wiOy4sPVxcLSBcXC8ke30lP2BdL2cscm9vdDpcIiNcIn0sZS5qc3RyZWUuY3JlYXRlPWZ1bmN0aW9uKHQsaSl7dmFyIHI9bmV3IGUuanN0cmVlLmNvcmUoKytzKSxuPWk7cmV0dXJuIGk9ZS5leHRlbmQoITAse30sZS5qc3RyZWUuZGVmYXVsdHMsaSksbiYmbi5wbHVnaW5zJiYoaS5wbHVnaW5zPW4ucGx1Z2lucyksZS5lYWNoKGkucGx1Z2lucyxmdW5jdGlvbihlLHQpe1wiY29yZVwiIT09ZSYmKHI9ci5wbHVnaW4odCxpW3RdKSl9KSxlKHQpLmRhdGEoXCJqc3RyZWVcIixyKSxyLmluaXQodCxpKSxyfSxlLmpzdHJlZS5kZXN0cm95PWZ1bmN0aW9uKCl7ZShcIi5qc3RyZWU6anN0cmVlXCIpLmpzdHJlZShcImRlc3Ryb3lcIiksZShsKS5vZmYoXCIuanN0cmVlXCIpfSxlLmpzdHJlZS5jb3JlPWZ1bmN0aW9uKGUpe3RoaXMuX2lkPWUsdGhpcy5fY250PTAsdGhpcy5fd3JrPW51bGwsdGhpcy5fZGF0YT17Y29yZTp7dGhlbWVzOntuYW1lOiExLGRvdHM6ITEsaWNvbnM6ITF9LHNlbGVjdGVkOltdLGxhc3RfZXJyb3I6e30sd29ya2luZzohMSx3b3JrZXJfcXVldWU6W10sZm9jdXNlZDpudWxsfX19LGUuanN0cmVlLnJlZmVyZW5jZT1mdW5jdGlvbih0KXt2YXIgaT1udWxsLHI9bnVsbDtpZighdHx8IXQuaWR8fHQudGFnTmFtZSYmdC5ub2RlVHlwZXx8KHQ9dC5pZCksIXJ8fCFyLmxlbmd0aCl0cnl7cj1lKHQpfWNhdGNoKHMpe31pZighcnx8IXIubGVuZ3RoKXRyeXtyPWUoXCIjXCIrdC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIikpfWNhdGNoKHMpe31yZXR1cm4gciYmci5sZW5ndGgmJihyPXIuY2xvc2VzdChcIi5qc3RyZWVcIikpLmxlbmd0aCYmKHI9ci5kYXRhKFwianN0cmVlXCIpKT9pPXI6ZShcIi5qc3RyZWVcIikuZWFjaChmdW5jdGlvbigpe3ZhciByPWUodGhpcykuZGF0YShcImpzdHJlZVwiKTtyZXR1cm4gciYmci5fbW9kZWwuZGF0YVt0XT8oaT1yLCExKTp2b2lkIDB9KSxpfSxlLmZuLmpzdHJlZT1mdW5jdGlvbihpKXt2YXIgcj1cInN0cmluZ1wiPT10eXBlb2YgaSxzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxuPW51bGw7cmV0dXJuIGkhPT0hMHx8dGhpcy5sZW5ndGg/KHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBhPWUuanN0cmVlLnJlZmVyZW5jZSh0aGlzKSxvPXImJmE/YVtpXTpudWxsO3JldHVybiBuPXImJm8/by5hcHBseShhLHMpOm51bGwsYXx8cnx8aSE9PXQmJiFlLmlzUGxhaW5PYmplY3QoaSl8fGUuanN0cmVlLmNyZWF0ZSh0aGlzLGkpLChhJiYhcnx8aT09PSEwKSYmKG49YXx8ITEpLG51bGwhPT1uJiZuIT09dD8hMTp2b2lkIDB9KSxudWxsIT09biYmbiE9PXQ/bjp0aGlzKTohMX0sZS5leHByW1wiOlwiXS5qc3RyZWU9ZS5leHByLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbihpKXtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuIGUoaSkuaGFzQ2xhc3MoXCJqc3RyZWVcIikmJmUoaSkuZGF0YShcImpzdHJlZVwiKSE9PXR9fSksZS5qc3RyZWUuZGVmYXVsdHMuY29yZT17ZGF0YTohMSxzdHJpbmdzOiExLGNoZWNrX2NhbGxiYWNrOiExLGVycm9yOmUubm9vcCxhbmltYXRpb246MjAwLG11bHRpcGxlOiEwLHRoZW1lczp7bmFtZTohMSx1cmw6ITEsZGlyOiExLGRvdHM6ITAsaWNvbnM6ITAsc3RyaXBlczohMSx2YXJpYW50OiExLHJlc3BvbnNpdmU6ITF9LGV4cGFuZF9zZWxlY3RlZF9vbmxvYWQ6ITAsd29ya2VyOiEwLGZvcmNlX3RleHQ6ITEsZGJsY2xpY2tfdG9nZ2xlOiEwfSxlLmpzdHJlZS5jb3JlLnByb3RvdHlwZT17cGx1Z2luOmZ1bmN0aW9uKHQsaSl7dmFyIHI9ZS5qc3RyZWUucGx1Z2luc1t0XTtyZXR1cm4gcj8odGhpcy5fZGF0YVt0XT17fSxyLnByb3RvdHlwZT10aGlzLG5ldyByKGksdGhpcykpOnRoaXN9LGluaXQ6ZnVuY3Rpb24odCxpKXt0aGlzLl9tb2RlbD17ZGF0YTp7fSxjaGFuZ2VkOltdLGZvcmNlX2Z1bGxfcmVkcmF3OiExLHJlZHJhd190aW1lb3V0OiExLGRlZmF1bHRfc3RhdGU6e2xvYWRlZDohMCxvcGVuZWQ6ITEsc2VsZWN0ZWQ6ITEsZGlzYWJsZWQ6ITF9fSx0aGlzLl9tb2RlbC5kYXRhW2UuanN0cmVlLnJvb3RdPXtpZDplLmpzdHJlZS5yb290LHBhcmVudDpudWxsLHBhcmVudHM6W10sY2hpbGRyZW46W10sY2hpbGRyZW5fZDpbXSxzdGF0ZTp7bG9hZGVkOiExfX0sdGhpcy5lbGVtZW50PWUodCkuYWRkQ2xhc3MoXCJqc3RyZWUganN0cmVlLVwiK3RoaXMuX2lkKSx0aGlzLnNldHRpbmdzPWksdGhpcy5fZGF0YS5jb3JlLnJlYWR5PSExLHRoaXMuX2RhdGEuY29yZS5sb2FkZWQ9ITEsdGhpcy5fZGF0YS5jb3JlLnJ0bD1cInJ0bFwiPT09dGhpcy5lbGVtZW50LmNzcyhcImRpcmVjdGlvblwiKSx0aGlzLmVsZW1lbnRbdGhpcy5fZGF0YS5jb3JlLnJ0bD9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcImpzdHJlZS1ydGxcIiksdGhpcy5lbGVtZW50LmF0dHIoXCJyb2xlXCIsXCJ0cmVlXCIpLHRoaXMuc2V0dGluZ3MuY29yZS5tdWx0aXBsZSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLW11bHRpc2VsZWN0YWJsZVwiLCEwKSx0aGlzLmVsZW1lbnQuYXR0cihcInRhYmluZGV4XCIpfHx0aGlzLmVsZW1lbnQuYXR0cihcInRhYmluZGV4XCIsXCIwXCIpLHRoaXMuYmluZCgpLHRoaXMudHJpZ2dlcihcImluaXRcIiksdGhpcy5fZGF0YS5jb3JlLm9yaWdpbmFsX2NvbnRhaW5lcl9odG1sPXRoaXMuZWxlbWVudC5maW5kKFwiID4gdWwgPiBsaVwiKS5jbG9uZSghMCksdGhpcy5fZGF0YS5jb3JlLm9yaWdpbmFsX2NvbnRhaW5lcl9odG1sLmZpbmQoXCJsaVwiKS5hZGRCYWNrKCkuY29udGVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMz09PXRoaXMubm9kZVR5cGUmJighdGhpcy5ub2RlVmFsdWV8fC9eXFxzKyQvLnRlc3QodGhpcy5ub2RlVmFsdWUpKX0pLnJlbW92ZSgpLHRoaXMuZWxlbWVudC5odG1sKFwiPHVsIGNsYXNzPSdqc3RyZWUtY29udGFpbmVyLXVsIGpzdHJlZS1jaGlsZHJlbicgcm9sZT0nZ3JvdXAnPjxsaSBpZD0nalwiK3RoaXMuX2lkK1wiX2xvYWRpbmcnIGNsYXNzPSdqc3RyZWUtaW5pdGlhbC1ub2RlIGpzdHJlZS1sb2FkaW5nIGpzdHJlZS1sZWFmIGpzdHJlZS1sYXN0JyByb2xlPSd0cmVlLWl0ZW0nPjxpIGNsYXNzPSdqc3RyZWUtaWNvbiBqc3RyZWUtb2NsJz48L2k+PGEgY2xhc3M9J2pzdHJlZS1hbmNob3InIGhyZWY9JyMnPjxpIGNsYXNzPSdqc3RyZWUtaWNvbiBqc3RyZWUtdGhlbWVpY29uLWhpZGRlbic+PC9pPlwiK3RoaXMuZ2V0X3N0cmluZyhcIkxvYWRpbmcgLi4uXCIpK1wiPC9hPjwvbGk+PC91bD5cIiksdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIixcImpcIit0aGlzLl9pZCtcIl9sb2FkaW5nXCIpLHRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQ9dGhpcy5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oXCJsaVwiKS5maXJzdCgpLmhlaWdodCgpfHwyNCx0aGlzLnRyaWdnZXIoXCJsb2FkaW5nXCIpLHRoaXMubG9hZF9ub2RlKGUuanN0cmVlLnJvb3QpfSxkZXN0cm95OmZ1bmN0aW9uKGUpe2lmKHRoaXMuX3dyayl0cnl7d2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodGhpcy5fd3JrKSx0aGlzLl93cms9bnVsbH1jYXRjaCh0KXt9ZXx8dGhpcy5lbGVtZW50LmVtcHR5KCksdGhpcy50ZWFyZG93bigpfSx0ZWFyZG93bjpmdW5jdGlvbigpe3RoaXMudW5iaW5kKCksdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwianN0cmVlXCIpLnJlbW92ZURhdGEoXCJqc3RyZWVcIikuZmluZChcIltjbGFzc149J2pzdHJlZSddXCIpLmFkZEJhY2soKS5hdHRyKFwiY2xhc3NcIixmdW5jdGlvbigpe3JldHVybiB0aGlzLmNsYXNzTmFtZS5yZXBsYWNlKC9qc3RyZWVbXiBdKnwkL2dpLFwiXCIpfSksdGhpcy5lbGVtZW50PW51bGx9LGJpbmQ6ZnVuY3Rpb24oKXt2YXIgdD1cIlwiLGk9bnVsbCxyPTA7dGhpcy5lbGVtZW50Lm9uKFwiZGJsY2xpY2suanN0cmVlXCIsZnVuY3Rpb24oZSl7aWYoZS50YXJnZXQudGFnTmFtZSYmXCJpbnB1dFwiPT09ZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKXJldHVybiEwO2lmKGwuc2VsZWN0aW9uJiZsLnNlbGVjdGlvbi5lbXB0eSlsLnNlbGVjdGlvbi5lbXB0eSgpO2Vsc2UgaWYod2luZG93LmdldFNlbGVjdGlvbil7dmFyIHQ9d2luZG93LmdldFNlbGVjdGlvbigpO3RyeXt0LnJlbW92ZUFsbFJhbmdlcygpLHQuY29sbGFwc2UoKX1jYXRjaChpKXt9fX0pLm9uKFwibW91c2Vkb3duLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSl7ZS50YXJnZXQ9PT10aGlzLmVsZW1lbnRbMF0mJihlLnByZXZlbnREZWZhdWx0KCkscj0rbmV3IERhdGUpfSx0aGlzKSkub24oXCJtb3VzZWRvd24uanN0cmVlXCIsXCIuanN0cmVlLW9jbFwiLGZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKX0pLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLW9jbFwiLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy50b2dnbGVfbm9kZShlLnRhcmdldCl9LHRoaXMpKS5vbihcImRibGNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKGUpe3JldHVybiBlLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1lLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk/ITA6dm9pZCh0aGlzLnNldHRpbmdzLmNvcmUuZGJsY2xpY2tfdG9nZ2xlJiZ0aGlzLnRvZ2dsZV9ub2RlKGUudGFyZ2V0KSl9LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKHQpe3QucHJldmVudERlZmF1bHQoKSx0LmN1cnJlbnRUYXJnZXQhPT1sLmFjdGl2ZUVsZW1lbnQmJmUodC5jdXJyZW50VGFyZ2V0KS5mb2N1cygpLHRoaXMuYWN0aXZhdGVfbm9kZSh0LmN1cnJlbnRUYXJnZXQsdCl9LHRoaXMpKS5vbihcImtleWRvd24uanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24odCl7aWYodC50YXJnZXQudGFnTmFtZSYmXCJpbnB1dFwiPT09dC50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpKXJldHVybiEwO2lmKDMyIT09dC53aGljaCYmMTMhPT10LndoaWNoJiYodC5zaGlmdEtleXx8dC5jdHJsS2V5fHx0LmFsdEtleXx8dC5tZXRhS2V5KSlyZXR1cm4hMDt2YXIgaT1udWxsO3N3aXRjaCh0aGlzLl9kYXRhLmNvcmUucnRsJiYoMzc9PT10LndoaWNoP3Qud2hpY2g9Mzk6Mzk9PT10LndoaWNoJiYodC53aGljaD0zNykpLHQud2hpY2gpe2Nhc2UgMzI6dC5jdHJsS2V5JiYodC50eXBlPVwiY2xpY2tcIixlKHQuY3VycmVudFRhcmdldCkudHJpZ2dlcih0KSk7YnJlYWs7Y2FzZSAxMzp0LnR5cGU9XCJjbGlja1wiLGUodC5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKHQpO2JyZWFrO2Nhc2UgMzc6dC5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuaXNfb3Blbih0LmN1cnJlbnRUYXJnZXQpP3RoaXMuY2xvc2Vfbm9kZSh0LmN1cnJlbnRUYXJnZXQpOihpPXRoaXMuZ2V0X3BhcmVudCh0LmN1cnJlbnRUYXJnZXQpLGkmJmkuaWQhPT1lLmpzdHJlZS5yb290JiZ0aGlzLmdldF9ub2RlKGksITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSk7YnJlYWs7Y2FzZSAzODp0LnByZXZlbnREZWZhdWx0KCksaT10aGlzLmdldF9wcmV2X2RvbSh0LmN1cnJlbnRUYXJnZXQpLGkmJmkubGVuZ3RoJiZpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTticmVhaztjYXNlIDM5OnQucHJldmVudERlZmF1bHQoKSx0aGlzLmlzX2Nsb3NlZCh0LmN1cnJlbnRUYXJnZXQpP3RoaXMub3Blbl9ub2RlKHQuY3VycmVudFRhcmdldCxmdW5jdGlvbihlKXt0aGlzLmdldF9ub2RlKGUsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKX0pOnRoaXMuaXNfb3Blbih0LmN1cnJlbnRUYXJnZXQpJiYoaT10aGlzLmdldF9ub2RlKHQuY3VycmVudFRhcmdldCwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdLGkmJmUodGhpcy5fZmlyc3RDaGlsZChpKSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpKTticmVhaztjYXNlIDQwOnQucHJldmVudERlZmF1bHQoKSxpPXRoaXMuZ2V0X25leHRfZG9tKHQuY3VycmVudFRhcmdldCksaSYmaS5sZW5ndGgmJmkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpO2JyZWFrO2Nhc2UgMTA2OnRoaXMub3Blbl9hbGwoKTticmVhaztjYXNlIDM2OnQucHJldmVudERlZmF1bHQoKSxpPXRoaXMuX2ZpcnN0Q2hpbGQodGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0pLGkmJmUoaSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maWx0ZXIoXCI6dmlzaWJsZVwiKS5mb2N1cygpO2JyZWFrO2Nhc2UgMzU6dC5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1hbmNob3JcIikuZmlsdGVyKFwiOnZpc2libGVcIikubGFzdCgpLmZvY3VzKCl9fSx0aGlzKSkub24oXCJsb2FkX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe2kuc3RhdHVzJiYoaS5ub2RlLmlkIT09ZS5qc3RyZWUucm9vdHx8dGhpcy5fZGF0YS5jb3JlLmxvYWRlZHx8KHRoaXMuX2RhdGEuY29yZS5sb2FkZWQ9ITAsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkuaWQpLHRoaXMudHJpZ2dlcihcImxvYWRlZFwiKSksdGhpcy5fZGF0YS5jb3JlLnJlYWR5fHxzZXRUaW1lb3V0KGUucHJveHkoZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1lbnQmJiF0aGlzLmdldF9jb250YWluZXJfdWwoKS5maW5kKFwiLmpzdHJlZS1sb2FkaW5nXCIpLmxlbmd0aCl7aWYodGhpcy5fZGF0YS5jb3JlLnJlYWR5PSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGgpe2lmKHRoaXMuc2V0dGluZ3MuY29yZS5leHBhbmRfc2VsZWN0ZWRfb25sb2FkKXt2YXIgdCxpLHI9W107Zm9yKHQ9MCxpPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7aT50O3QrKylyPXIuY29uY2F0KHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW3RdXS5wYXJlbnRzKTtmb3Iocj1lLnZha2F0YS5hcnJheV91bmlxdWUociksdD0wLGk9ci5sZW5ndGg7aT50O3QrKyl0aGlzLm9wZW5fbm9kZShyW3RdLCExLDApfXRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwicmVhZHlcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KX10aGlzLnRyaWdnZXIoXCJyZWFkeVwiKX19LHRoaXMpLDApKX0sdGhpcykpLm9uKFwia2V5cHJlc3MuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihyKXtpZihyLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1yLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aSYmY2xlYXJUaW1lb3V0KGkpLGk9c2V0VGltZW91dChmdW5jdGlvbigpe3Q9XCJcIn0sNTAwKTt2YXIgcz1TdHJpbmcuZnJvbUNoYXJDb2RlKHIud2hpY2gpLnRvTG93ZXJDYXNlKCksbj10aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLGE9bi5pbmRleChsLmFjdGl2ZUVsZW1lbnQpfHwwLG89ITE7aWYodCs9cyx0Lmxlbmd0aD4xKXtpZihuLnNsaWNlKGEpLmVhY2goZS5wcm94eShmdW5jdGlvbihpLHIpe3JldHVybiAwPT09ZShyKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHQpPyhlKHIpLmZvY3VzKCksbz0hMCwhMSk6dm9pZCAwfSx0aGlzKSksbylyZXR1cm47aWYobi5zbGljZSgwLGEpLmVhY2goZS5wcm94eShmdW5jdGlvbihpLHIpe3JldHVybiAwPT09ZShyKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHQpPyhlKHIpLmZvY3VzKCksbz0hMCwhMSk6dm9pZCAwfSx0aGlzKSksbylyZXR1cm59aWYobmV3IFJlZ0V4cChcIl5cIitzLnJlcGxhY2UoL1stXFwvXFxcXF4kKis/LigpfFtcXF17fV0vZyxcIlxcXFwkJlwiKStcIiskXCIpLnRlc3QodCkpe2lmKG4uc2xpY2UoYSsxKS5lYWNoKGUucHJveHkoZnVuY3Rpb24odCxpKXtyZXR1cm4gZShpKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCk9PT1zPyhlKGkpLmZvY3VzKCksbz0hMCwhMSk6dm9pZCAwfSx0aGlzKSksbylyZXR1cm47aWYobi5zbGljZSgwLGErMSkuZWFjaChlLnByb3h5KGZ1bmN0aW9uKHQsaSl7cmV0dXJuIGUoaSkudGV4dCgpLnRvTG93ZXJDYXNlKCkuY2hhckF0KDApPT09cz8oZShpKS5mb2N1cygpLG89ITAsITEpOnZvaWQgMH0sdGhpcykpLG8pcmV0dXJufX0sdGhpcykpLm9uKFwiaW5pdC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lczt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM9ZS5kb3RzLHRoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz1lLnN0cmlwZXMsdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz1lLmljb25zLHRoaXMuc2V0X3RoZW1lKGUubmFtZXx8XCJkZWZhdWx0XCIsZS51cmwpLHRoaXMuc2V0X3RoZW1lX3ZhcmlhbnQoZS52YXJpYW50KX0sdGhpcykpLm9uKFwibG9hZGluZy5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dGhpc1t0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM/XCJzaG93X2RvdHNcIjpcImhpZGVfZG90c1wiXSgpLHRoaXNbdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz9cInNob3dfaWNvbnNcIjpcImhpZGVfaWNvbnNcIl0oKSx0aGlzW3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz9cInNob3dfc3RyaXBlc1wiOlwiaGlkZV9zdHJpcGVzXCJdKCl9LHRoaXMpKS5vbihcImJsdXIuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24odCl7dGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCxlKHQuY3VycmVudFRhcmdldCkuZmlsdGVyKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLm1vdXNlbGVhdmUoKSx0aGlzLmVsZW1lbnQuYXR0cihcInRhYmluZGV4XCIsXCIwXCIpfSx0aGlzKSkub24oXCJmb2N1cy5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZS5wcm94eShmdW5jdGlvbih0KXt2YXIgaT10aGlzLmdldF9ub2RlKHQuY3VycmVudFRhcmdldCk7aSYmaS5pZCYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPWkuaWQpLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLm5vdCh0LmN1cnJlbnRUYXJnZXQpLm1vdXNlbGVhdmUoKSxlKHQuY3VycmVudFRhcmdldCkubW91c2VlbnRlcigpLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIi0xXCIpfSx0aGlzKSkub24oXCJmb2N1cy5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7aWYoK25ldyBEYXRlLXI+NTAwJiYhdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQpe3I9MDt2YXIgZT10aGlzLmdldF9ub2RlKHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIpLCEwKTtlJiZlLmZpbmQoXCI+IC5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCl9fSx0aGlzKSkub24oXCJtb3VzZWVudGVyLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKGUpe3RoaXMuaG92ZXJfbm9kZShlLmN1cnJlbnRUYXJnZXQpfSx0aGlzKSkub24oXCJtb3VzZWxlYXZlLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKGUpe3RoaXMuZGVob3Zlcl9ub2RlKGUuY3VycmVudFRhcmdldCl9LHRoaXMpKX0sdW5iaW5kOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9mZihcIi5qc3RyZWVcIiksZShsKS5vZmYoXCIuanN0cmVlLVwiK3RoaXMuX2lkKX0sdHJpZ2dlcjpmdW5jdGlvbihlLHQpe3R8fCh0PXt9KSx0Lmluc3RhbmNlPXRoaXMsdGhpcy5lbGVtZW50LnRyaWdnZXJIYW5kbGVyKGUucmVwbGFjZShcIi5qc3RyZWVcIixcIlwiKStcIi5qc3RyZWVcIix0KX0sZ2V0X2NvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LGdldF9jb250YWluZXJfdWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5maXJzdCgpfSxnZXRfc3RyaW5nOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuc2V0dGluZ3MuY29yZS5zdHJpbmdzO3JldHVybiBlLmlzRnVuY3Rpb24oaSk/aS5jYWxsKHRoaXMsdCk6aSYmaVt0XT9pW3RdOnR9LF9maXJzdENoaWxkOmZ1bmN0aW9uKGUpe2ZvcihlPWU/ZS5maXJzdENoaWxkOm51bGw7bnVsbCE9PWUmJjEhPT1lLm5vZGVUeXBlOyllPWUubmV4dFNpYmxpbmc7cmV0dXJuIGV9LF9uZXh0U2libGluZzpmdW5jdGlvbihlKXtmb3IoZT1lP2UubmV4dFNpYmxpbmc6bnVsbDtudWxsIT09ZSYmMSE9PWUubm9kZVR5cGU7KWU9ZS5uZXh0U2libGluZztyZXR1cm4gZX0sX3ByZXZpb3VzU2libGluZzpmdW5jdGlvbihlKXtmb3IoZT1lP2UucHJldmlvdXNTaWJsaW5nOm51bGw7bnVsbCE9PWUmJjEhPT1lLm5vZGVUeXBlOyllPWUucHJldmlvdXNTaWJsaW5nO3JldHVybiBlfSxnZXRfbm9kZTpmdW5jdGlvbih0LGkpe3QmJnQuaWQmJih0PXQuaWQpO3ZhciByO3RyeXtpZih0aGlzLl9tb2RlbC5kYXRhW3RdKXQ9dGhpcy5fbW9kZWwuZGF0YVt0XTtlbHNlIGlmKFwic3RyaW5nXCI9PXR5cGVvZiB0JiZ0aGlzLl9tb2RlbC5kYXRhW3QucmVwbGFjZSgvXiMvLFwiXCIpXSl0PXRoaXMuX21vZGVsLmRhdGFbdC5yZXBsYWNlKC9eIy8sXCJcIildO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIHQmJihyPWUoXCIjXCIrdC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KSkubGVuZ3RoJiZ0aGlzLl9tb2RlbC5kYXRhW3IuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildKXQ9dGhpcy5fbW9kZWwuZGF0YVtyLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuYXR0cihcImlkXCIpXTtlbHNlIGlmKChyPWUodCx0aGlzLmVsZW1lbnQpKS5sZW5ndGgmJnRoaXMuX21vZGVsLmRhdGFbci5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV0pdD10aGlzLl9tb2RlbC5kYXRhW3IuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildO2Vsc2V7aWYoIShyPWUodCx0aGlzLmVsZW1lbnQpKS5sZW5ndGh8fCFyLmhhc0NsYXNzKFwianN0cmVlXCIpKXJldHVybiExO3Q9dGhpcy5fbW9kZWwuZGF0YVtlLmpzdHJlZS5yb290XX1yZXR1cm4gaSYmKHQ9dC5pZD09PWUuanN0cmVlLnJvb3Q/dGhpcy5lbGVtZW50OmUoXCIjXCIrdC5pZC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KSksdH1jYXRjaChzKXtyZXR1cm4hMX19LGdldF9wYXRoOmZ1bmN0aW9uKHQsaSxyKXtpZih0PXQucGFyZW50cz90OnRoaXMuZ2V0X25vZGUodCksIXR8fHQuaWQ9PT1lLmpzdHJlZS5yb290fHwhdC5wYXJlbnRzKXJldHVybiExO3ZhciBzLG4sYT1bXTtmb3IoYS5wdXNoKHI/dC5pZDp0LnRleHQpLHM9MCxuPXQucGFyZW50cy5sZW5ndGg7bj5zO3MrKylhLnB1c2gocj90LnBhcmVudHNbc106dGhpcy5nZXRfdGV4dCh0LnBhcmVudHNbc10pKTtyZXR1cm4gYT1hLnJldmVyc2UoKS5zbGljZSgxKSxpP2Euam9pbihpKTphfSxnZXRfbmV4dF9kb206ZnVuY3Rpb24odCxpKXt2YXIgcjtpZih0PXRoaXMuZ2V0X25vZGUodCwhMCksdFswXT09PXRoaXMuZWxlbWVudFswXSl7Zm9yKHI9dGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSk7ciYmMD09PXIub2Zmc2V0SGVpZ2h0OylyPXRoaXMuX25leHRTaWJsaW5nKHIpO3JldHVybiByP2Uocik6ITF9aWYoIXR8fCF0Lmxlbmd0aClyZXR1cm4hMTtpZihpKXtyPXRbMF07ZG8gcj10aGlzLl9uZXh0U2libGluZyhyKTt3aGlsZShyJiYwPT09ci5vZmZzZXRIZWlnaHQpO3JldHVybiByP2Uocik6ITF9aWYodC5oYXNDbGFzcyhcImpzdHJlZS1vcGVuXCIpKXtmb3Iocj10aGlzLl9maXJzdENoaWxkKHQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKTtyJiYwPT09ci5vZmZzZXRIZWlnaHQ7KXI9dGhpcy5fbmV4dFNpYmxpbmcocik7aWYobnVsbCE9PXIpcmV0dXJuIGUocil9cj10WzBdO2RvIHI9dGhpcy5fbmV4dFNpYmxpbmcocik7d2hpbGUociYmMD09PXIub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gbnVsbCE9PXI/ZShyKTp0LnBhcmVudHNVbnRpbChcIi5qc3RyZWVcIixcIi5qc3RyZWUtbm9kZVwiKS5uZXh0QWxsKFwiLmpzdHJlZS1ub2RlOnZpc2libGVcIikuZmlyc3QoKX0sZ2V0X3ByZXZfZG9tOmZ1bmN0aW9uKHQsaSl7dmFyIHI7aWYodD10aGlzLmdldF9ub2RlKHQsITApLHRbMF09PT10aGlzLmVsZW1lbnRbMF0pe2ZvcihyPXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdLmxhc3RDaGlsZDtyJiYwPT09ci5vZmZzZXRIZWlnaHQ7KXI9dGhpcy5fcHJldmlvdXNTaWJsaW5nKHIpO3JldHVybiByP2Uocik6ITF9aWYoIXR8fCF0Lmxlbmd0aClyZXR1cm4hMTtpZihpKXtyPXRbMF07ZG8gcj10aGlzLl9wcmV2aW91c1NpYmxpbmcocik7d2hpbGUociYmMD09PXIub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gcj9lKHIpOiExfXI9dFswXTtkbyByPXRoaXMuX3ByZXZpb3VzU2libGluZyhyKTt3aGlsZShyJiYwPT09ci5vZmZzZXRIZWlnaHQpO2lmKG51bGwhPT1yKXtmb3IodD1lKHIpO3QuaGFzQ2xhc3MoXCJqc3RyZWUtb3BlblwiKTspdD10LmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5maXJzdCgpLmNoaWxkcmVuKFwiLmpzdHJlZS1ub2RlOnZpc2libGU6bGFzdFwiKTtyZXR1cm4gdH1yZXR1cm4gcj10WzBdLnBhcmVudE5vZGUucGFyZW50Tm9kZSxyJiZyLmNsYXNzTmFtZSYmLTEhPT1yLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLW5vZGVcIik/ZShyKTohMX0sZ2V0X3BhcmVudDpmdW5jdGlvbih0KXtyZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290P3QucGFyZW50OiExfSxnZXRfY2hpbGRyZW5fZG9tOmZ1bmN0aW9uKGUpe3JldHVybiBlPXRoaXMuZ2V0X25vZGUoZSwhMCksZVswXT09PXRoaXMuZWxlbWVudFswXT90aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZVwiKTplJiZlLmxlbmd0aD9lLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZVwiKTohMX0saXNfcGFyZW50OmZ1bmN0aW9uKGUpe3JldHVybiBlPXRoaXMuZ2V0X25vZGUoZSksZSYmKGUuc3RhdGUubG9hZGVkPT09ITF8fGUuY2hpbGRyZW4ubGVuZ3RoPjApfSxpc19sb2FkZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9dGhpcy5nZXRfbm9kZShlKSxlJiZlLnN0YXRlLmxvYWRlZH0saXNfbG9hZGluZzpmdW5jdGlvbihlKXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUpLGUmJmUuc3RhdGUmJmUuc3RhdGUubG9hZGluZ30saXNfb3BlbjpmdW5jdGlvbihlKXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUpLGUmJmUuc3RhdGUub3BlbmVkfSxpc19jbG9zZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9dGhpcy5nZXRfbm9kZShlKSxlJiZ0aGlzLmlzX3BhcmVudChlKSYmIWUuc3RhdGUub3BlbmVkfSxpc19sZWFmOmZ1bmN0aW9uKGUpe3JldHVybiF0aGlzLmlzX3BhcmVudChlKX0sbG9hZF9ub2RlOmZ1bmN0aW9uKHQsaSl7dmFyIHIscyxuLGEsbztpZihlLmlzQXJyYXkodCkpcmV0dXJuIHRoaXMuX2xvYWRfbm9kZXModC5zbGljZSgpLGkpLCEwO2lmKHQ9dGhpcy5nZXRfbm9kZSh0KSwhdClyZXR1cm4gaSYmaS5jYWxsKHRoaXMsdCwhMSksITE7aWYodC5zdGF0ZS5sb2FkZWQpe2Zvcih0LnN0YXRlLmxvYWRlZD0hMSxyPTAscz10LmNoaWxkcmVuX2QubGVuZ3RoO3M+cjtyKyspe2ZvcihuPTAsYT10LnBhcmVudHMubGVuZ3RoO2E+bjtuKyspdGhpcy5fbW9kZWwuZGF0YVt0LnBhcmVudHNbbl1dLmNoaWxkcmVuX2Q9ZS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fbW9kZWwuZGF0YVt0LnBhcmVudHNbbl1dLmNoaWxkcmVuX2QsdC5jaGlsZHJlbl9kW3JdKTt0aGlzLl9tb2RlbC5kYXRhW3QuY2hpbGRyZW5fZFtyXV0uc3RhdGUuc2VsZWN0ZWQmJihvPSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1lLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsdC5jaGlsZHJlbl9kW3JdKSksZGVsZXRlIHRoaXMuX21vZGVsLmRhdGFbdC5jaGlsZHJlbl9kW3JdXX10LmNoaWxkcmVuPVtdLHQuY2hpbGRyZW5fZD1bXSxvJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImxvYWRfbm9kZVwiLG5vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KX1yZXR1cm4gdC5zdGF0ZS5mYWlsZWQ9ITEsdC5zdGF0ZS5sb2FkaW5nPSEwLHRoaXMuZ2V0X25vZGUodCwhMCkuYWRkQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITApLHRoaXMuX2xvYWRfbm9kZSh0LGUucHJveHkoZnVuY3Rpb24oZSl7dD10aGlzLl9tb2RlbC5kYXRhW3QuaWRdLHQuc3RhdGUubG9hZGluZz0hMSx0LnN0YXRlLmxvYWRlZD1lLHQuc3RhdGUuZmFpbGVkPSF0LnN0YXRlLmxvYWRlZDt2YXIgcj10aGlzLmdldF9ub2RlKHQsITApLHM9MCxuPTAsYT10aGlzLl9tb2RlbC5kYXRhLG89ITE7Zm9yKHM9MCxuPXQuY2hpbGRyZW4ubGVuZ3RoO24+cztzKyspaWYoYVt0LmNoaWxkcmVuW3NdXSYmIWFbdC5jaGlsZHJlbltzXV0uc3RhdGUuaGlkZGVuKXtvPSEwO2JyZWFrfXQuc3RhdGUubG9hZGVkJiYhbyYmciYmci5sZW5ndGgmJiFyLmhhc0NsYXNzKFwianN0cmVlLWxlYWZcIikmJnIucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xvc2VkIGpzdHJlZS1vcGVuXCIpLmFkZENsYXNzKFwianN0cmVlLWxlYWZcIiksci5yZW1vdmVDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMSksdGhpcy50cmlnZ2VyKFwibG9hZF9ub2RlXCIse25vZGU6dCxzdGF0dXM6ZX0pLGkmJmkuY2FsbCh0aGlzLHQsZSl9LHRoaXMpKSwhMH0sX2xvYWRfbm9kZXM6ZnVuY3Rpb24oZSx0LGkpe3ZhciByLHMsbj0hMCxhPWZ1bmN0aW9uKCl7dGhpcy5fbG9hZF9ub2RlcyhlLHQsITApfSxvPXRoaXMuX21vZGVsLmRhdGEsZD1bXTtmb3Iocj0wLHM9ZS5sZW5ndGg7cz5yO3IrKykhb1tlW3JdXXx8KG9bZVtyXV0uc3RhdGUubG9hZGVkfHxvW2Vbcl1dLnN0YXRlLmZhaWxlZCkmJml8fCh0aGlzLmlzX2xvYWRpbmcoZVtyXSl8fHRoaXMubG9hZF9ub2RlKGVbcl0sYSksbj0hMSk7aWYobil7Zm9yKHI9MCxzPWUubGVuZ3RoO3M+cjtyKyspb1tlW3JdXSYmb1tlW3JdXS5zdGF0ZS5sb2FkZWQmJmQucHVzaChlW3JdKTt0JiYhdC5kb25lJiYodC5jYWxsKHRoaXMsZCksdC5kb25lPSEwKX19LGxvYWRfYWxsOmZ1bmN0aW9uKHQsaSl7aWYodHx8KHQ9ZS5qc3RyZWUucm9vdCksdD10aGlzLmdldF9ub2RlKHQpLCF0KXJldHVybiExO3ZhciByLHMsbj1bXSxhPXRoaXMuX21vZGVsLmRhdGEsbz1hW3QuaWRdLmNoaWxkcmVuX2Q7Zm9yKHQuc3RhdGUmJiF0LnN0YXRlLmxvYWRlZCYmbi5wdXNoKHQuaWQpLHI9MCxzPW8ubGVuZ3RoO3M+cjtyKyspYVtvW3JdXSYmYVtvW3JdXS5zdGF0ZSYmIWFbb1tyXV0uc3RhdGUubG9hZGVkJiZuLnB1c2gob1tyXSk7bi5sZW5ndGg/dGhpcy5fbG9hZF9ub2RlcyhuLGZ1bmN0aW9uKCl7dGhpcy5sb2FkX2FsbCh0LGkpfSk6KGkmJmkuY2FsbCh0aGlzLHQpLHRoaXMudHJpZ2dlcihcImxvYWRfYWxsXCIse25vZGU6dH0pKX0sX2xvYWRfbm9kZTpmdW5jdGlvbih0LGkpe3ZhciByLHM9dGhpcy5zZXR0aW5ncy5jb3JlLmRhdGE7cmV0dXJuIHM/ZS5pc0Z1bmN0aW9uKHMpP3MuY2FsbCh0aGlzLHQsZS5wcm94eShmdW5jdGlvbihyKXtyPT09ITEmJmkuY2FsbCh0aGlzLCExKSx0aGlzW1wic3RyaW5nXCI9PXR5cGVvZiByP1wiX2FwcGVuZF9odG1sX2RhdGFcIjpcIl9hcHBlbmRfanNvbl9kYXRhXCJdKHQsXCJzdHJpbmdcIj09dHlwZW9mIHI/ZShlLnBhcnNlSFRNTChyKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDMhPT10aGlzLm5vZGVUeXBlfSk6cixmdW5jdGlvbihlKXtpLmNhbGwodGhpcyxlKX0pfSx0aGlzKSk6XCJvYmplY3RcIj09dHlwZW9mIHM/cy51cmw/KHM9ZS5leHRlbmQoITAse30scyksZS5pc0Z1bmN0aW9uKHMudXJsKSYmKHMudXJsPXMudXJsLmNhbGwodGhpcyx0KSksZS5pc0Z1bmN0aW9uKHMuZGF0YSkmJihzLmRhdGE9cy5kYXRhLmNhbGwodGhpcyx0KSksZS5hamF4KHMpLmRvbmUoZS5wcm94eShmdW5jdGlvbihyLHMsbil7dmFyIGE9bi5nZXRSZXNwb25zZUhlYWRlcihcIkNvbnRlbnQtVHlwZVwiKTtyZXR1cm4gYSYmLTEhPT1hLmluZGV4T2YoXCJqc29uXCIpfHxcIm9iamVjdFwiPT10eXBlb2Ygcj90aGlzLl9hcHBlbmRfanNvbl9kYXRhKHQscixmdW5jdGlvbihlKXtpLmNhbGwodGhpcyxlKX0pOmEmJi0xIT09YS5pbmRleE9mKFwiaHRtbFwiKXx8XCJzdHJpbmdcIj09dHlwZW9mIHI/dGhpcy5fYXBwZW5kX2h0bWxfZGF0YSh0LGUoZS5wYXJzZUhUTUwocikpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pLGZ1bmN0aW9uKGUpe2kuY2FsbCh0aGlzLGUpfSk6KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImFqYXhcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA0XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOnQuaWQseGhyOm59KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksaS5jYWxsKHRoaXMsITEpKX0sdGhpcykpLmZhaWwoZS5wcm94eShmdW5jdGlvbihlKXtpLmNhbGwodGhpcywhMSksdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiYWpheFwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDRcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6dC5pZCx4aHI6ZX0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKX0sdGhpcykpKToocj1lLmlzQXJyYXkocyl8fGUuaXNQbGFpbk9iamVjdChzKT9KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHMpKTpzLHQuaWQ9PT1lLmpzdHJlZS5yb290P3RoaXMuX2FwcGVuZF9qc29uX2RhdGEodCxyLGZ1bmN0aW9uKGUpe2kuY2FsbCh0aGlzLGUpfSk6KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcIm5vZGF0YVwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDVcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6dC5pZH0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSxpLmNhbGwodGhpcywhMSkpKTpcInN0cmluZ1wiPT10eXBlb2Ygcz90LmlkPT09ZS5qc3RyZWUucm9vdD90aGlzLl9hcHBlbmRfaHRtbF9kYXRhKHQsZShlLnBhcnNlSFRNTChzKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDMhPT10aGlzLm5vZGVUeXBlfSksZnVuY3Rpb24oZSl7aS5jYWxsKHRoaXMsZSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwibm9kYXRhXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNlwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDp0LmlkfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLGkuY2FsbCh0aGlzLCExKSk6aS5jYWxsKHRoaXMsITEpOnQuaWQ9PT1lLmpzdHJlZS5yb290P3RoaXMuX2FwcGVuZF9odG1sX2RhdGEodCx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWwuY2xvbmUoITApLGZ1bmN0aW9uKGUpe2kuY2FsbCh0aGlzLGUpfSk6aS5jYWxsKHRoaXMsITEpfSxfbm9kZV9jaGFuZ2VkOmZ1bmN0aW9uKGUpe2U9dGhpcy5nZXRfbm9kZShlKSxlJiZ0aGlzLl9tb2RlbC5jaGFuZ2VkLnB1c2goZS5pZCl9LF9hcHBlbmRfaHRtbF9kYXRhOmZ1bmN0aW9uKHQsaSxyKXt0PXRoaXMuZ2V0X25vZGUodCksdC5jaGlsZHJlbj1bXSx0LmNoaWxkcmVuX2Q9W107dmFyIHMsbixhLG89aS5pcyhcInVsXCIpP2kuY2hpbGRyZW4oKTppLGQ9dC5pZCxjPVtdLGw9W10saD10aGlzLl9tb2RlbC5kYXRhLF89aFtkXSx1PXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7Zm9yKG8uZWFjaChlLnByb3h5KGZ1bmN0aW9uKHQsaSl7cz10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2h0bWwoZShpKSxkLF8ucGFyZW50cy5jb25jYXQoKSkscyYmKGMucHVzaChzKSxsLnB1c2gocyksaFtzXS5jaGlsZHJlbl9kLmxlbmd0aCYmKGw9bC5jb25jYXQoaFtzXS5jaGlsZHJlbl9kKSkpfSx0aGlzKSksXy5jaGlsZHJlbj1jLF8uY2hpbGRyZW5fZD1sLG49MCxhPV8ucGFyZW50cy5sZW5ndGg7YT5uO24rKyloW18ucGFyZW50c1tuXV0uY2hpbGRyZW5fZD1oW18ucGFyZW50c1tuXV0uY2hpbGRyZW5fZC5jb25jYXQobCk7dGhpcy50cmlnZ2VyKFwibW9kZWxcIix7bm9kZXM6bCxwYXJlbnQ6ZH0pLGQhPT1lLmpzdHJlZS5yb290Pyh0aGlzLl9ub2RlX2NoYW5nZWQoZCksdGhpcy5yZWRyYXcoKSk6KHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmNoaWxkcmVuKFwiLmpzdHJlZS1pbml0aWFsLW5vZGVcIikucmVtb3ZlKCksdGhpcy5yZWRyYXcoITApKSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoIT09dSYmdGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJtb2RlbFwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pLHIuY2FsbCh0aGlzLCEwKX0sX2FwcGVuZF9qc29uX2RhdGE6ZnVuY3Rpb24odCxpLHIscyl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7dD10aGlzLmdldF9ub2RlKHQpLHQuY2hpbGRyZW49W10sdC5jaGlsZHJlbl9kPVtdLGkuZCYmKGk9aS5kLFwic3RyaW5nXCI9PXR5cGVvZiBpJiYoaT1KU09OLnBhcnNlKGkpKSksZS5pc0FycmF5KGkpfHwoaT1baV0pO3ZhciBuPW51bGwsYT17ZGY6dGhpcy5fbW9kZWwuZGVmYXVsdF9zdGF0ZSxkYXQ6aSxwYXI6dC5pZCxtOnRoaXMuX21vZGVsLmRhdGEsdF9pZDp0aGlzLl9pZCx0X2NudDp0aGlzLl9jbnQsc2VsOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0sbz1mdW5jdGlvbihlLHQpe2UuZGF0YSYmKGU9ZS5kYXRhKTt2YXIgaSxyLHMsbixhPWUuZGF0LG89ZS5wYXIsZD1bXSxjPVtdLGw9W10saD1lLmRmLF89ZS50X2lkLHU9ZS50X2NudCxnPWUubSxmPWdbb10scD1lLnNlbCxtPWZ1bmN0aW9uKGUsaSxyKXtyPXI/ci5jb25jYXQoKTpbXSxpJiZyLnVuc2hpZnQoaSk7dmFyIHMsbixhLG8sZD1lLmlkLnRvU3RyaW5nKCksYz17aWQ6ZCx0ZXh0OmUudGV4dHx8XCJcIixpY29uOmUuaWNvbiE9PXQ/ZS5pY29uOiEwLHBhcmVudDppLHBhcmVudHM6cixjaGlsZHJlbjplLmNoaWxkcmVufHxbXSxjaGlsZHJlbl9kOmUuY2hpbGRyZW5fZHx8W10sZGF0YTplLmRhdGEsc3RhdGU6e30sbGlfYXR0cjp7aWQ6ITF9LGFfYXR0cjp7aHJlZjpcIiNcIn0sb3JpZ2luYWw6ITF9O2ZvcihzIGluIGgpaC5oYXNPd25Qcm9wZXJ0eShzKSYmKGMuc3RhdGVbc109aFtzXSk7aWYoZSYmZS5kYXRhJiZlLmRhdGEuanN0cmVlJiZlLmRhdGEuanN0cmVlLmljb24mJihjLmljb249ZS5kYXRhLmpzdHJlZS5pY29uKSwoYy5pY29uPT09dHx8bnVsbD09PWMuaWNvbnx8XCJcIj09PWMuaWNvbikmJihjLmljb249ITApLGUmJmUuZGF0YSYmKGMuZGF0YT1lLmRhdGEsZS5kYXRhLmpzdHJlZSkpZm9yKHMgaW4gZS5kYXRhLmpzdHJlZSllLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KHMpJiYoYy5zdGF0ZVtzXT1lLmRhdGEuanN0cmVlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5zdGF0ZSlmb3IocyBpbiBlLnN0YXRlKWUuc3RhdGUuaGFzT3duUHJvcGVydHkocykmJihjLnN0YXRlW3NdPWUuc3RhdGVbc10pO2lmKGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmxpX2F0dHIpZm9yKHMgaW4gZS5saV9hdHRyKWUubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGMubGlfYXR0cltzXT1lLmxpX2F0dHJbc10pO2lmKGMubGlfYXR0ci5pZHx8KGMubGlfYXR0ci5pZD1kKSxlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5hX2F0dHIpZm9yKHMgaW4gZS5hX2F0dHIpZS5hX2F0dHIuaGFzT3duUHJvcGVydHkocykmJihjLmFfYXR0cltzXT1lLmFfYXR0cltzXSk7Zm9yKGUmJmUuY2hpbGRyZW4mJmUuY2hpbGRyZW49PT0hMCYmKGMuc3RhdGUubG9hZGVkPSExLGMuY2hpbGRyZW49W10sYy5jaGlsZHJlbl9kPVtdKSxnW2MuaWRdPWMscz0wLG49Yy5jaGlsZHJlbi5sZW5ndGg7bj5zO3MrKylhPW0oZ1tjLmNoaWxkcmVuW3NdXSxjLmlkLHIpLG89Z1thXSxjLmNoaWxkcmVuX2QucHVzaChhKSxvLmNoaWxkcmVuX2QubGVuZ3RoJiYoYy5jaGlsZHJlbl9kPWMuY2hpbGRyZW5fZC5jb25jYXQoby5jaGlsZHJlbl9kKSk7cmV0dXJuIGRlbGV0ZSBlLmRhdGEsZGVsZXRlIGUuY2hpbGRyZW4sZ1tjLmlkXS5vcmlnaW5hbD1lLGMuc3RhdGUuc2VsZWN0ZWQmJmwucHVzaChjLmlkKSxjLmlkfSx2PWZ1bmN0aW9uKGUsaSxyKXtyPXI/ci5jb25jYXQoKTpbXSxpJiZyLnVuc2hpZnQoaSk7dmFyIHMsbixhLG8sZCxjPSExO2RvIGM9XCJqXCIrXytcIl9cIisgKyt1O3doaWxlKGdbY10pO2Q9e2lkOiExLHRleHQ6XCJzdHJpbmdcIj09dHlwZW9mIGU/ZTpcIlwiLGljb246XCJvYmplY3RcIj09dHlwZW9mIGUmJmUuaWNvbiE9PXQ/ZS5pY29uOiEwLHBhcmVudDppLHBhcmVudHM6cixjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKHMgaW4gaCloLmhhc093blByb3BlcnR5KHMpJiYoZC5zdGF0ZVtzXT1oW3NdKTtpZihlJiZlLmlkJiYoZC5pZD1lLmlkLnRvU3RyaW5nKCkpLGUmJmUudGV4dCYmKGQudGV4dD1lLnRleHQpLGUmJmUuZGF0YSYmZS5kYXRhLmpzdHJlZSYmZS5kYXRhLmpzdHJlZS5pY29uJiYoZC5pY29uPWUuZGF0YS5qc3RyZWUuaWNvbiksKGQuaWNvbj09PXR8fG51bGw9PT1kLmljb258fFwiXCI9PT1kLmljb24pJiYoZC5pY29uPSEwKSxlJiZlLmRhdGEmJihkLmRhdGE9ZS5kYXRhLGUuZGF0YS5qc3RyZWUpKWZvcihzIGluIGUuZGF0YS5qc3RyZWUpZS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShzKSYmKGQuc3RhdGVbc109ZS5kYXRhLmpzdHJlZVtzXSk7aWYoZSYmXCJvYmplY3RcIj09dHlwZW9mIGUuc3RhdGUpZm9yKHMgaW4gZS5zdGF0ZSllLnN0YXRlLmhhc093blByb3BlcnR5KHMpJiYoZC5zdGF0ZVtzXT1lLnN0YXRlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5saV9hdHRyKWZvcihzIGluIGUubGlfYXR0cillLmxpX2F0dHIuaGFzT3duUHJvcGVydHkocykmJihkLmxpX2F0dHJbc109ZS5saV9hdHRyW3NdKTtpZihkLmxpX2F0dHIuaWQmJiFkLmlkJiYoZC5pZD1kLmxpX2F0dHIuaWQudG9TdHJpbmcoKSksZC5pZHx8KGQuaWQ9YyksZC5saV9hdHRyLmlkfHwoZC5saV9hdHRyLmlkPWQuaWQpLGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmFfYXR0cilmb3IocyBpbiBlLmFfYXR0cillLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGQuYV9hdHRyW3NdPWUuYV9hdHRyW3NdKTtpZihlJiZlLmNoaWxkcmVuJiZlLmNoaWxkcmVuLmxlbmd0aCl7Zm9yKHM9MCxuPWUuY2hpbGRyZW4ubGVuZ3RoO24+cztzKyspYT12KGUuY2hpbGRyZW5bc10sZC5pZCxyKSxvPWdbYV0sZC5jaGlsZHJlbi5wdXNoKGEpLG8uY2hpbGRyZW5fZC5sZW5ndGgmJihkLmNoaWxkcmVuX2Q9ZC5jaGlsZHJlbl9kLmNvbmNhdChvLmNoaWxkcmVuX2QpKTtkLmNoaWxkcmVuX2Q9ZC5jaGlsZHJlbl9kLmNvbmNhdChkLmNoaWxkcmVuKX1yZXR1cm4gZSYmZS5jaGlsZHJlbiYmZS5jaGlsZHJlbj09PSEwJiYoZC5zdGF0ZS5sb2FkZWQ9ITEsZC5jaGlsZHJlbj1bXSxkLmNoaWxkcmVuX2Q9W10pLGRlbGV0ZSBlLmRhdGEsZGVsZXRlIGUuY2hpbGRyZW4sZC5vcmlnaW5hbD1lLGdbZC5pZF09ZCxkLnN0YXRlLnNlbGVjdGVkJiZsLnB1c2goZC5pZCksZC5pZH07aWYoYS5sZW5ndGgmJmFbMF0uaWQhPT10JiZhWzBdLnBhcmVudCE9PXQpe2ZvcihyPTAscz1hLmxlbmd0aDtzPnI7cisrKWFbcl0uY2hpbGRyZW58fChhW3JdLmNoaWxkcmVuPVtdKSxnW2Fbcl0uaWQudG9TdHJpbmcoKV09YVtyXTtmb3Iocj0wLHM9YS5sZW5ndGg7cz5yO3IrKylnW2Fbcl0ucGFyZW50LnRvU3RyaW5nKCldLmNoaWxkcmVuLnB1c2goYVtyXS5pZC50b1N0cmluZygpKSxmLmNoaWxkcmVuX2QucHVzaChhW3JdLmlkLnRvU3RyaW5nKCkpO2ZvcihyPTAscz1mLmNoaWxkcmVuLmxlbmd0aDtzPnI7cisrKWk9bShnW2YuY2hpbGRyZW5bcl1dLG8sZi5wYXJlbnRzLmNvbmNhdCgpKSxjLnB1c2goaSksZ1tpXS5jaGlsZHJlbl9kLmxlbmd0aCYmKGM9Yy5jb25jYXQoZ1tpXS5jaGlsZHJlbl9kKSk7Zm9yKHI9MCxzPWYucGFyZW50cy5sZW5ndGg7cz5yO3IrKylnW2YucGFyZW50c1tyXV0uY2hpbGRyZW5fZD1nW2YucGFyZW50c1tyXV0uY2hpbGRyZW5fZC5jb25jYXQoYyk7bj17Y250OnUsbW9kOmcsc2VsOnAscGFyOm8sZHBjOmMsYWRkOmx9fWVsc2V7Zm9yKHI9MCxzPWEubGVuZ3RoO3M+cjtyKyspaT12KGFbcl0sbyxmLnBhcmVudHMuY29uY2F0KCkpLGkmJihkLnB1c2goaSksYy5wdXNoKGkpLGdbaV0uY2hpbGRyZW5fZC5sZW5ndGgmJihjPWMuY29uY2F0KGdbaV0uY2hpbGRyZW5fZCkpKTtmb3IoZi5jaGlsZHJlbj1kLGYuY2hpbGRyZW5fZD1jLHI9MCxzPWYucGFyZW50cy5sZW5ndGg7cz5yO3IrKylnW2YucGFyZW50c1tyXV0uY2hpbGRyZW5fZD1nW2YucGFyZW50c1tyXV0uY2hpbGRyZW5fZC5jb25jYXQoYyk7bj17Y250OnUsbW9kOmcsc2VsOnAscGFyOm8sZHBjOmMsYWRkOmx9fXJldHVyblwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cuZG9jdW1lbnQ/bjp2b2lkIHBvc3RNZXNzYWdlKG4pfSxkPWZ1bmN0aW9uKHQsaSl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7aWYodGhpcy5fY250PXQuY250LHRoaXMuX21vZGVsLmRhdGE9dC5tb2QsaSl7dmFyIHMsbixhPXQuYWRkLG89dC5zZWwsZD10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuc2xpY2UoKSxjPXRoaXMuX21vZGVsLmRhdGE7aWYoby5sZW5ndGghPT1kLmxlbmd0aHx8ZS52YWthdGEuYXJyYXlfdW5pcXVlKG8uY29uY2F0KGQpKS5sZW5ndGghPT1vLmxlbmd0aCl7Zm9yKHM9MCxuPW8ubGVuZ3RoO24+cztzKyspLTE9PT1lLmluQXJyYXkob1tzXSxhKSYmLTE9PT1lLmluQXJyYXkob1tzXSxkKSYmKGNbb1tzXV0uc3RhdGUuc2VsZWN0ZWQ9ITEpO2ZvcihzPTAsbj1kLmxlbmd0aDtuPnM7cysrKS0xPT09ZS5pbkFycmF5KGRbc10sbykmJihjW2Rbc11dLnN0YXRlLnNlbGVjdGVkPSEwKX19dC5hZGQubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQodC5hZGQpKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2Rlczp0LmRwYyxwYXJlbnQ6dC5wYXJ9KSx0LnBhciE9PWUuanN0cmVlLnJvb3Q/KHRoaXMuX25vZGVfY2hhbmdlZCh0LnBhciksdGhpcy5yZWRyYXcoKSk6dGhpcy5yZWRyYXcoITApLHQuYWRkLmxlbmd0aCYmdGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJtb2RlbFwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pLHIuY2FsbCh0aGlzLCEwKX19O2lmKHRoaXMuc2V0dGluZ3MuY29yZS53b3JrZXImJndpbmRvdy5CbG9iJiZ3aW5kb3cuVVJMJiZ3aW5kb3cuV29ya2VyKXRyeXtudWxsPT09dGhpcy5fd3JrJiYodGhpcy5fd3JrPXdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyB3aW5kb3cuQmxvYihbXCJzZWxmLm9ubWVzc2FnZSA9IFwiK28udG9TdHJpbmcoKV0se3R5cGU6XCJ0ZXh0L2phdmFzY3JpcHRcIn0pKSksIXRoaXMuX2RhdGEuY29yZS53b3JraW5nfHxzPyh0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMCxuPW5ldyB3aW5kb3cuV29ya2VyKHRoaXMuX3dyayksbi5vbm1lc3NhZ2U9ZS5wcm94eShmdW5jdGlvbihlKXtkLmNhbGwodGhpcyxlLmRhdGEsITApO3RyeXtuLnRlcm1pbmF0ZSgpLG49bnVsbH1jYXRjaCh0KXt9dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5sZW5ndGg/dGhpcy5fYXBwZW5kX2pzb25fZGF0YS5hcHBseSh0aGlzLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUuc2hpZnQoKSk6dGhpcy5fZGF0YS5jb3JlLndvcmtpbmc9ITF9LHRoaXMpLGEucGFyP24ucG9zdE1lc3NhZ2UoYSk6dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5sZW5ndGg/dGhpcy5fYXBwZW5kX2pzb25fZGF0YS5hcHBseSh0aGlzLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUuc2hpZnQoKSk6dGhpcy5fZGF0YS5jb3JlLndvcmtpbmc9ITEpOnRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUucHVzaChbdCxpLHIsITBdKX1jYXRjaChjKXtkLmNhbGwodGhpcyxvKGEpLCExKSx0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMX1lbHNlIGQuY2FsbCh0aGlzLG8oYSksITEpfX0sX3BhcnNlX21vZGVsX2Zyb21faHRtbDpmdW5jdGlvbihpLHIscyl7cz1zP1tdLmNvbmNhdChzKTpbXSxyJiZzLnVuc2hpZnQocik7dmFyIG4sYSxvLGQsYyxsPXRoaXMuX21vZGVsLmRhdGEsaD17aWQ6ITEsdGV4dDohMSxpY29uOiEwLHBhcmVudDpyLHBhcmVudHM6cyxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKG8gaW4gdGhpcy5fbW9kZWwuZGVmYXVsdF9zdGF0ZSl0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLmhhc093blByb3BlcnR5KG8pJiYoaC5zdGF0ZVtvXT10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlW29dKTtpZihkPWUudmFrYXRhLmF0dHJpYnV0ZXMoaSwhMCksZS5lYWNoKGQsZnVuY3Rpb24odCxpKXtyZXR1cm4gaT1lLnRyaW0oaSksaS5sZW5ndGg/KGgubGlfYXR0clt0XT1pLHZvaWQoXCJpZFwiPT09dCYmKGguaWQ9aS50b1N0cmluZygpKSkpOiEwfSksZD1pLmNoaWxkcmVuKFwiYVwiKS5maXJzdCgpLGQubGVuZ3RoJiYoZD1lLnZha2F0YS5hdHRyaWJ1dGVzKGQsITApLGUuZWFjaChkLGZ1bmN0aW9uKHQsaSl7aT1lLnRyaW0oaSksaS5sZW5ndGgmJihoLmFfYXR0clt0XT1pKX0pKSxkPWkuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCkubGVuZ3RoP2kuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCkuY2xvbmUoKTppLmNsb25lKCksZC5jaGlsZHJlbihcImlucywgaSwgdWxcIikucmVtb3ZlKCksZD1kLmh0bWwoKSxkPWUoXCI8ZGl2IC8+XCIpLmh0bWwoZCksaC50ZXh0PXRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0P2QudGV4dCgpOmQuaHRtbCgpLGQ9aS5kYXRhKCksaC5kYXRhPWQ/ZS5leHRlbmQoITAse30sZCk6bnVsbCxoLnN0YXRlLm9wZW5lZD1pLmhhc0NsYXNzKFwianN0cmVlLW9wZW5cIiksaC5zdGF0ZS5zZWxlY3RlZD1pLmNoaWxkcmVuKFwiYVwiKS5oYXNDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLGguc3RhdGUuZGlzYWJsZWQ9aS5jaGlsZHJlbihcImFcIikuaGFzQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIiksaC5kYXRhJiZoLmRhdGEuanN0cmVlKWZvcihvIGluIGguZGF0YS5qc3RyZWUpaC5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShvKSYmKGguc3RhdGVbb109aC5kYXRhLmpzdHJlZVtvXSk7ZD1pLmNoaWxkcmVuKFwiYVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLGQubGVuZ3RoJiYoaC5pY29uPWQuaGFzQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKT8hMTpkLmF0dHIoXCJyZWxcIikpLGguc3RhdGUuaWNvbiE9PXQmJihoLmljb249aC5zdGF0ZS5pY29uKSwoaC5pY29uPT09dHx8bnVsbD09PWguaWNvbnx8XCJcIj09PWguaWNvbikmJihoLmljb249ITApLGQ9aS5jaGlsZHJlbihcInVsXCIpLmNoaWxkcmVuKFwibGlcIik7ZG8gYz1cImpcIit0aGlzLl9pZCtcIl9cIisgKyt0aGlzLl9jbnQ7d2hpbGUobFtjXSk7cmV0dXJuIGguaWQ9aC5saV9hdHRyLmlkP2gubGlfYXR0ci5pZC50b1N0cmluZygpOmMsZC5sZW5ndGg/KGQuZWFjaChlLnByb3h5KGZ1bmN0aW9uKHQsaSl7bj10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2h0bWwoZShpKSxoLmlkLHMpLGE9dGhpcy5fbW9kZWwuZGF0YVtuXSxoLmNoaWxkcmVuLnB1c2gobiksYS5jaGlsZHJlbl9kLmxlbmd0aCYmKGguY2hpbGRyZW5fZD1oLmNoaWxkcmVuX2QuY29uY2F0KGEuY2hpbGRyZW5fZCkpfSx0aGlzKSksaC5jaGlsZHJlbl9kPWguY2hpbGRyZW5fZC5jb25jYXQoaC5jaGlsZHJlbikpOmkuaGFzQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpJiYoaC5zdGF0ZS5sb2FkZWQ9ITEpLGgubGlfYXR0cltcImNsYXNzXCJdJiYoaC5saV9hdHRyW1wiY2xhc3NcIl09aC5saV9hdHRyW1wiY2xhc3NcIl0ucmVwbGFjZShcImpzdHJlZS1jbG9zZWRcIixcIlwiKS5yZXBsYWNlKFwianN0cmVlLW9wZW5cIixcIlwiKSksaC5hX2F0dHJbXCJjbGFzc1wiXSYmKGguYV9hdHRyW1wiY2xhc3NcIl09aC5hX2F0dHJbXCJjbGFzc1wiXS5yZXBsYWNlKFwianN0cmVlLWNsaWNrZWRcIixcIlwiKS5yZXBsYWNlKFwianN0cmVlLWRpc2FibGVkXCIsXCJcIikpLGxbaC5pZF09aCxoLnN0YXRlLnNlbGVjdGVkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQucHVzaChoLmlkKSxoLmlkfSxfcGFyc2VfbW9kZWxfZnJvbV9mbGF0X2pzb246ZnVuY3Rpb24oZSxpLHIpe3I9cj9yLmNvbmNhdCgpOltdLGkmJnIudW5zaGlmdChpKTt2YXIgcyxuLGEsbyxkPWUuaWQudG9TdHJpbmcoKSxjPXRoaXMuX21vZGVsLmRhdGEsbD10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLGg9e2lkOmQsdGV4dDplLnRleHR8fFwiXCIsaWNvbjplLmljb24hPT10P2UuaWNvbjohMCxwYXJlbnQ6aSxwYXJlbnRzOnIsY2hpbGRyZW46ZS5jaGlsZHJlbnx8W10sY2hpbGRyZW5fZDplLmNoaWxkcmVuX2R8fFtdLGRhdGE6ZS5kYXRhLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IocyBpbiBsKWwuaGFzT3duUHJvcGVydHkocykmJihoLnN0YXRlW3NdPWxbc10pO2lmKGUmJmUuZGF0YSYmZS5kYXRhLmpzdHJlZSYmZS5kYXRhLmpzdHJlZS5pY29uJiYoaC5pY29uPWUuZGF0YS5qc3RyZWUuaWNvbiksKGguaWNvbj09PXR8fG51bGw9PT1oLmljb258fFwiXCI9PT1oLmljb24pJiYoaC5pY29uPSEwKSxlJiZlLmRhdGEmJihoLmRhdGE9ZS5kYXRhLGUuZGF0YS5qc3RyZWUpKWZvcihzIGluIGUuZGF0YS5qc3RyZWUpZS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShzKSYmKGguc3RhdGVbc109ZS5kYXRhLmpzdHJlZVtzXSk7aWYoZSYmXCJvYmplY3RcIj09dHlwZW9mIGUuc3RhdGUpZm9yKHMgaW4gZS5zdGF0ZSllLnN0YXRlLmhhc093blByb3BlcnR5KHMpJiYoaC5zdGF0ZVtzXT1lLnN0YXRlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5saV9hdHRyKWZvcihzIGluIGUubGlfYXR0cillLmxpX2F0dHIuaGFzT3duUHJvcGVydHkocykmJihoLmxpX2F0dHJbc109ZS5saV9hdHRyW3NdKTtpZihoLmxpX2F0dHIuaWR8fChoLmxpX2F0dHIuaWQ9ZCksZSYmXCJvYmplY3RcIj09dHlwZW9mIGUuYV9hdHRyKWZvcihzIGluIGUuYV9hdHRyKWUuYV9hdHRyLmhhc093blByb3BlcnR5KHMpJiYoaC5hX2F0dHJbc109ZS5hX2F0dHJbc10pO2ZvcihlJiZlLmNoaWxkcmVuJiZlLmNoaWxkcmVuPT09ITAmJihoLnN0YXRlLmxvYWRlZD0hMSxoLmNoaWxkcmVuPVtdLGguY2hpbGRyZW5fZD1bXSksY1toLmlkXT1oLHM9MCxuPWguY2hpbGRyZW4ubGVuZ3RoO24+cztzKyspYT10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2ZsYXRfanNvbihjW2guY2hpbGRyZW5bc11dLGguaWQsciksbz1jW2FdLGguY2hpbGRyZW5fZC5wdXNoKGEpLG8uY2hpbGRyZW5fZC5sZW5ndGgmJihoLmNoaWxkcmVuX2Q9aC5jaGlsZHJlbl9kLmNvbmNhdChvLmNoaWxkcmVuX2QpKTtyZXR1cm4gZGVsZXRlIGUuZGF0YSxkZWxldGUgZS5jaGlsZHJlbixjW2guaWRdLm9yaWdpbmFsPWUsaC5zdGF0ZS5zZWxlY3RlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2goaC5pZCksaC5pZH0sX3BhcnNlX21vZGVsX2Zyb21fanNvbjpmdW5jdGlvbihlLGkscil7cj1yP3IuY29uY2F0KCk6W10saSYmci51bnNoaWZ0KGkpO3ZhciBzLG4sYSxvLGQsYz0hMSxsPXRoaXMuX21vZGVsLmRhdGEsaD10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlO2RvIGM9XCJqXCIrdGhpcy5faWQrXCJfXCIrICsrdGhpcy5fY250O3doaWxlKGxbY10pO2Q9e2lkOiExLHRleHQ6XCJzdHJpbmdcIj09dHlwZW9mIGU/ZTpcIlwiLGljb246XCJvYmplY3RcIj09dHlwZW9mIGUmJmUuaWNvbiE9PXQ/ZS5pY29uOiEwLHBhcmVudDppLHBhcmVudHM6cixjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKHMgaW4gaCloLmhhc093blByb3BlcnR5KHMpJiYoZC5zdGF0ZVtzXT1oW3NdKTtpZihlJiZlLmlkJiYoZC5pZD1lLmlkLnRvU3RyaW5nKCkpLGUmJmUudGV4dCYmKGQudGV4dD1lLnRleHQpLGUmJmUuZGF0YSYmZS5kYXRhLmpzdHJlZSYmZS5kYXRhLmpzdHJlZS5pY29uJiYoZC5pY29uPWUuZGF0YS5qc3RyZWUuaWNvbiksKGQuaWNvbj09PXR8fG51bGw9PT1kLmljb258fFwiXCI9PT1kLmljb24pJiYoZC5pY29uPSEwKSxlJiZlLmRhdGEmJihkLmRhdGE9ZS5kYXRhLGUuZGF0YS5qc3RyZWUpKWZvcihzIGluIGUuZGF0YS5qc3RyZWUpZS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShzKSYmKGQuc3RhdGVbc109ZS5kYXRhLmpzdHJlZVtzXSk7aWYoZSYmXCJvYmplY3RcIj09dHlwZW9mIGUuc3RhdGUpZm9yKHMgaW4gZS5zdGF0ZSllLnN0YXRlLmhhc093blByb3BlcnR5KHMpJiYoZC5zdGF0ZVtzXT1lLnN0YXRlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5saV9hdHRyKWZvcihzIGluIGUubGlfYXR0cillLmxpX2F0dHIuaGFzT3duUHJvcGVydHkocykmJihkLmxpX2F0dHJbc109ZS5saV9hdHRyW3NdKTtpZihkLmxpX2F0dHIuaWQmJiFkLmlkJiYoZC5pZD1kLmxpX2F0dHIuaWQudG9TdHJpbmcoKSksZC5pZHx8KGQuaWQ9YyksZC5saV9hdHRyLmlkfHwoZC5saV9hdHRyLmlkPWQuaWQpLGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmFfYXR0cilmb3IocyBpbiBlLmFfYXR0cillLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGQuYV9hdHRyW3NdPWUuYV9hdHRyW3NdKTtpZihlJiZlLmNoaWxkcmVuJiZlLmNoaWxkcmVuLmxlbmd0aCl7Zm9yKHM9MCxuPWUuY2hpbGRyZW4ubGVuZ3RoO24+cztzKyspYT10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24oZS5jaGlsZHJlbltzXSxkLmlkLHIpLG89bFthXSxkLmNoaWxkcmVuLnB1c2goYSksby5jaGlsZHJlbl9kLmxlbmd0aCYmKGQuY2hpbGRyZW5fZD1kLmNoaWxkcmVuX2QuY29uY2F0KG8uY2hpbGRyZW5fZCkpO2QuY2hpbGRyZW5fZD1kLmNoaWxkcmVuX2QuY29uY2F0KGQuY2hpbGRyZW4pfXJldHVybiBlJiZlLmNoaWxkcmVuJiZlLmNoaWxkcmVuPT09ITAmJihkLnN0YXRlLmxvYWRlZD0hMSxkLmNoaWxkcmVuPVtdLGQuY2hpbGRyZW5fZD1bXSksZGVsZXRlIGUuZGF0YSxkZWxldGUgZS5jaGlsZHJlbixkLm9yaWdpbmFsPWUsbFtkLmlkXT1kLGQuc3RhdGUuc2VsZWN0ZWQmJnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGQuaWQpLGQuaWR9LF9yZWRyYXc6ZnVuY3Rpb24oKXt2YXIgdCxpLHIscz10aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz90aGlzLl9tb2RlbC5kYXRhW2UuanN0cmVlLnJvb3RdLmNoaWxkcmVuLmNvbmNhdChbXSk6dGhpcy5fbW9kZWwuY2hhbmdlZC5jb25jYXQoW10pLG49bC5jcmVhdGVFbGVtZW50KFwiVUxcIiksYT10aGlzLl9kYXRhLmNvcmUuZm9jdXNlZDtmb3IoaT0wLHI9cy5sZW5ndGg7cj5pO2krKyl0PXRoaXMucmVkcmF3X25vZGUoc1tpXSwhMCx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyksdCYmdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXcmJm4uYXBwZW5kQ2hpbGQodCk7dGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXcmJihuLmNsYXNzTmFtZT10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWUsbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSx0aGlzLmVsZW1lbnQuZW1wdHkoKS5hcHBlbmQobikpLG51bGwhPT1hJiYodD10aGlzLmdldF9ub2RlKGEsITApLHQmJnQubGVuZ3RoJiZ0LmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIilbMF0hPT1sLmFjdGl2ZUVsZW1lbnQ/dC5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk6dGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITEsdGhpcy5fbW9kZWwuY2hhbmdlZD1bXSx0aGlzLnRyaWdnZXIoXCJyZWRyYXdcIix7bm9kZXM6c30pfSxyZWRyYXc6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwKSx0aGlzLl9yZWRyYXcoKX0sZHJhd19jaGlsZHJlbjpmdW5jdGlvbih0KXt2YXIgaT10aGlzLmdldF9ub2RlKHQpLHI9ITEscz0hMSxuPSExLGE9bDtpZighaSlyZXR1cm4hMTtpZihpLmlkPT09ZS5qc3RyZWUucm9vdClyZXR1cm4gdGhpcy5yZWRyYXcoITApO2lmKHQ9dGhpcy5nZXRfbm9kZSh0LCEwKSwhdHx8IXQubGVuZ3RoKXJldHVybiExO2lmKHQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnJlbW92ZSgpLHQ9dFswXSxpLmNoaWxkcmVuLmxlbmd0aCYmaS5zdGF0ZS5sb2FkZWQpe2ZvcihuPWEuY3JlYXRlRWxlbWVudChcIlVMXCIpLG4uc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiZ3JvdXBcIiksbi5jbGFzc05hbWU9XCJqc3RyZWUtY2hpbGRyZW5cIixyPTAscz1pLmNoaWxkcmVuLmxlbmd0aDtzPnI7cisrKW4uYXBwZW5kQ2hpbGQodGhpcy5yZWRyYXdfbm9kZShpLmNoaWxkcmVuW3JdLCEwLCEwKSk7dC5hcHBlbmRDaGlsZChuKX19LHJlZHJhd19ub2RlOmZ1bmN0aW9uKHQsaSxyLHMpe3ZhciBuPXRoaXMuZ2V0X25vZGUodCksYT0hMSxvPSExLGQ9ITEsYz0hMSxfPSExLHU9ITEsZz1cIlwiLGY9bCxwPXRoaXMuX21vZGVsLmRhdGEsbT0hMSx2PW51bGwsaj0wLHk9MCxrPSExLHg9ITE7aWYoIW4pcmV0dXJuITE7aWYobi5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuIHRoaXMucmVkcmF3KCEwKTtpZihpPWl8fDA9PT1uLmNoaWxkcmVuLmxlbmd0aCx0PWwucXVlcnlTZWxlY3Rvcj90aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcihcIiNcIisoLTEhPT1cIjAxMjM0NTY3ODlcIi5pbmRleE9mKG4uaWRbMF0pP1wiXFxcXDNcIituLmlkWzBdK1wiIFwiK24uaWQuc3Vic3RyKDEpLnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKTpuLmlkLnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSkpOmwuZ2V0RWxlbWVudEJ5SWQobi5pZCkpdD1lKHQpLHJ8fChhPXQucGFyZW50KCkucGFyZW50KClbMF0sYT09PXRoaXMuZWxlbWVudFswXSYmKGE9bnVsbCksbz10LmluZGV4KCkpLGl8fCFuLmNoaWxkcmVuLmxlbmd0aHx8dC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikubGVuZ3RofHwoaT0hMCksXG5pfHwoZD10LmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKVswXSksbT10LmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIilbMF09PT1sLmFjdGl2ZUVsZW1lbnQsdC5yZW1vdmUoKTtlbHNlIGlmKGk9ITAsIXIpe2lmKGE9bi5wYXJlbnQhPT1lLmpzdHJlZS5yb290P2UoXCIjXCIrbi5wYXJlbnQucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpLHRoaXMuZWxlbWVudClbMF06bnVsbCwhKG51bGw9PT1hfHxhJiZwW24ucGFyZW50XS5zdGF0ZS5vcGVuZWQpKXJldHVybiExO289ZS5pbkFycmF5KG4uaWQsbnVsbD09PWE/cFtlLmpzdHJlZS5yb290XS5jaGlsZHJlbjpwW24ucGFyZW50XS5jaGlsZHJlbil9dD1oLmNsb25lTm9kZSghMCksZz1cImpzdHJlZS1ub2RlIFwiO2ZvcihjIGluIG4ubGlfYXR0cilpZihuLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoYykpe2lmKFwiaWRcIj09PWMpY29udGludWU7XCJjbGFzc1wiIT09Yz90LnNldEF0dHJpYnV0ZShjLG4ubGlfYXR0cltjXSk6Zys9bi5saV9hdHRyW2NdfWZvcihuLmFfYXR0ci5pZHx8KG4uYV9hdHRyLmlkPW4uaWQrXCJfYW5jaG9yXCIpLHQuc2V0QXR0cmlidXRlKFwiYXJpYS1zZWxlY3RlZFwiLCEhbi5zdGF0ZS5zZWxlY3RlZCksdC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxldmVsXCIsbi5wYXJlbnRzLmxlbmd0aCksdC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsbGVkYnlcIixuLmFfYXR0ci5pZCksbi5zdGF0ZS5kaXNhYmxlZCYmdC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWRpc2FibGVkXCIsITApLGM9MCxfPW4uY2hpbGRyZW4ubGVuZ3RoO18+YztjKyspaWYoIXBbbi5jaGlsZHJlbltjXV0uc3RhdGUuaGlkZGVuKXtrPSEwO2JyZWFrfWlmKG51bGwhPT1uLnBhcmVudCYmcFtuLnBhcmVudF0mJiFuLnN0YXRlLmhpZGRlbiYmKGM9ZS5pbkFycmF5KG4uaWQscFtuLnBhcmVudF0uY2hpbGRyZW4pLHg9bi5pZCwtMSE9PWMpKWZvcihjKyssXz1wW24ucGFyZW50XS5jaGlsZHJlbi5sZW5ndGg7Xz5jJiYocFtwW24ucGFyZW50XS5jaGlsZHJlbltjXV0uc3RhdGUuaGlkZGVufHwoeD1wW24ucGFyZW50XS5jaGlsZHJlbltjXSkseD09PW4uaWQpO2MrKyk7bi5zdGF0ZS5oaWRkZW4mJihnKz1cIiBqc3RyZWUtaGlkZGVuXCIpLG4uc3RhdGUubG9hZGVkJiYhaz9nKz1cIiBqc3RyZWUtbGVhZlwiOihnKz1uLnN0YXRlLm9wZW5lZCYmbi5zdGF0ZS5sb2FkZWQ/XCIganN0cmVlLW9wZW5cIjpcIiBqc3RyZWUtY2xvc2VkXCIsdC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWV4cGFuZGVkXCIsbi5zdGF0ZS5vcGVuZWQmJm4uc3RhdGUubG9hZGVkKSkseD09PW4uaWQmJihnKz1cIiBqc3RyZWUtbGFzdFwiKSx0LmlkPW4uaWQsdC5jbGFzc05hbWU9ZyxnPShuLnN0YXRlLnNlbGVjdGVkP1wiIGpzdHJlZS1jbGlja2VkXCI6XCJcIikrKG4uc3RhdGUuZGlzYWJsZWQ/XCIganN0cmVlLWRpc2FibGVkXCI6XCJcIik7Zm9yKF8gaW4gbi5hX2F0dHIpaWYobi5hX2F0dHIuaGFzT3duUHJvcGVydHkoXykpe2lmKFwiaHJlZlwiPT09XyYmXCIjXCI9PT1uLmFfYXR0cltfXSljb250aW51ZTtcImNsYXNzXCIhPT1fP3QuY2hpbGROb2Rlc1sxXS5zZXRBdHRyaWJ1dGUoXyxuLmFfYXR0cltfXSk6Zys9XCIgXCIrbi5hX2F0dHJbX119aWYoZy5sZW5ndGgmJih0LmNoaWxkTm9kZXNbMV0uY2xhc3NOYW1lPVwianN0cmVlLWFuY2hvciBcIitnKSwobi5pY29uJiZuLmljb24hPT0hMHx8bi5pY29uPT09ITEpJiYobi5pY29uPT09ITE/dC5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiOi0xPT09bi5pY29uLmluZGV4T2YoXCIvXCIpJiYtMT09PW4uaWNvbi5pbmRleE9mKFwiLlwiKT90LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIFwiK24uaWNvbitcIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiOih0LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2U9XCJ1cmwoXCIrbi5pY29uK1wiKVwiLHQuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbj1cImNlbnRlciBjZW50ZXJcIix0LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kU2l6ZT1cImF1dG9cIix0LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIGpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpKSx0aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dD90LmNoaWxkTm9kZXNbMV0uYXBwZW5kQ2hpbGQoZi5jcmVhdGVUZXh0Tm9kZShuLnRleHQpKTp0LmNoaWxkTm9kZXNbMV0uaW5uZXJIVE1MKz1uLnRleHQsaSYmbi5jaGlsZHJlbi5sZW5ndGgmJihuLnN0YXRlLm9wZW5lZHx8cykmJm4uc3RhdGUubG9hZGVkKXtmb3IodT1mLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSx1LnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLHUuY2xhc3NOYW1lPVwianN0cmVlLWNoaWxkcmVuXCIsYz0wLF89bi5jaGlsZHJlbi5sZW5ndGg7Xz5jO2MrKyl1LmFwcGVuZENoaWxkKHRoaXMucmVkcmF3X25vZGUobi5jaGlsZHJlbltjXSxpLCEwKSk7dC5hcHBlbmRDaGlsZCh1KX1pZihkJiZ0LmFwcGVuZENoaWxkKGQpLCFyKXtmb3IoYXx8KGE9dGhpcy5lbGVtZW50WzBdKSxjPTAsXz1hLmNoaWxkTm9kZXMubGVuZ3RoO18+YztjKyspaWYoYS5jaGlsZE5vZGVzW2NdJiZhLmNoaWxkTm9kZXNbY10uY2xhc3NOYW1lJiYtMSE9PWEuY2hpbGROb2Rlc1tjXS5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1jaGlsZHJlblwiKSl7dj1hLmNoaWxkTm9kZXNbY107YnJlYWt9dnx8KHY9Zi5jcmVhdGVFbGVtZW50KFwiVUxcIiksdi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSx2LmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGEuYXBwZW5kQ2hpbGQodikpLGE9dixvPGEuY2hpbGROb2Rlcy5sZW5ndGg/YS5pbnNlcnRCZWZvcmUodCxhLmNoaWxkTm9kZXNbb10pOmEuYXBwZW5kQ2hpbGQodCksbSYmKGo9dGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcCx5PXRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0LHQuY2hpbGROb2Rlc1sxXS5mb2N1cygpLHRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3A9aix0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdD15KX1yZXR1cm4gbi5zdGF0ZS5vcGVuZWQmJiFuLnN0YXRlLmxvYWRlZCYmKG4uc3RhdGUub3BlbmVkPSExLHNldFRpbWVvdXQoZS5wcm94eShmdW5jdGlvbigpe3RoaXMub3Blbl9ub2RlKG4uaWQsITEsMCl9LHRoaXMpLDApKSx0fSxvcGVuX25vZGU6ZnVuY3Rpb24oaSxyLHMpe3ZhciBuLGEsbyxkO2lmKGUuaXNBcnJheShpKSl7Zm9yKGk9aS5zbGljZSgpLG49MCxhPWkubGVuZ3RoO2E+bjtuKyspdGhpcy5vcGVuX25vZGUoaVtuXSxyLHMpO3JldHVybiEwfXJldHVybiBpPXRoaXMuZ2V0X25vZGUoaSksaSYmaS5pZCE9PWUuanN0cmVlLnJvb3Q/KHM9cz09PXQ/dGhpcy5zZXR0aW5ncy5jb3JlLmFuaW1hdGlvbjpzLHRoaXMuaXNfY2xvc2VkKGkpP3RoaXMuaXNfbG9hZGVkKGkpPyhvPXRoaXMuZ2V0X25vZGUoaSwhMCksZD10aGlzLG8ubGVuZ3RoJiYocyYmby5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikubGVuZ3RoJiZvLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKSxpLmNoaWxkcmVuLmxlbmd0aCYmIXRoaXMuX2ZpcnN0Q2hpbGQoby5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pJiZ0aGlzLmRyYXdfY2hpbGRyZW4oaSkscz8odGhpcy50cmlnZ2VyKFwiYmVmb3JlX29wZW5cIix7bm9kZTppfSksby5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKS5lbmQoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikuYWRkQ2xhc3MoXCJqc3RyZWUtb3BlblwiKS5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuc3RvcCghMCwhMCkuc2xpZGVEb3duKHMsZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9XCJcIixkLnRyaWdnZXIoXCJhZnRlcl9vcGVuXCIse25vZGU6aX0pfSkpOih0aGlzLnRyaWdnZXIoXCJiZWZvcmVfb3BlblwiLHtub2RlOml9KSxvWzBdLmNsYXNzTmFtZT1vWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwianN0cmVlLWNsb3NlZFwiLFwianN0cmVlLW9wZW5cIiksb1swXS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWV4cGFuZGVkXCIsITApKSksaS5zdGF0ZS5vcGVuZWQ9ITAsciYmci5jYWxsKHRoaXMsaSwhMCksby5sZW5ndGh8fHRoaXMudHJpZ2dlcihcImJlZm9yZV9vcGVuXCIse25vZGU6aX0pLHRoaXMudHJpZ2dlcihcIm9wZW5fbm9kZVwiLHtub2RlOml9KSxzJiZvLmxlbmd0aHx8dGhpcy50cmlnZ2VyKFwiYWZ0ZXJfb3BlblwiLHtub2RlOml9KSwhMCk6dGhpcy5pc19sb2FkaW5nKGkpP3NldFRpbWVvdXQoZS5wcm94eShmdW5jdGlvbigpe3RoaXMub3Blbl9ub2RlKGkscixzKX0sdGhpcyksNTAwKTp2b2lkIHRoaXMubG9hZF9ub2RlKGksZnVuY3Rpb24oZSx0KXtyZXR1cm4gdD90aGlzLm9wZW5fbm9kZShlLHIscyk6cj9yLmNhbGwodGhpcyxlLCExKTohMX0pOihyJiZyLmNhbGwodGhpcyxpLCExKSwhMSkpOiExfSxfb3Blbl90bzpmdW5jdGlvbih0KXtpZih0PXRoaXMuZ2V0X25vZGUodCksIXR8fHQuaWQ9PT1lLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBpLHIscz10LnBhcmVudHM7Zm9yKGk9MCxyPXMubGVuZ3RoO3I+aTtpKz0xKWkhPT1lLmpzdHJlZS5yb290JiZ0aGlzLm9wZW5fbm9kZShzW2ldLCExLDApO3JldHVybiBlKFwiI1wiK3QuaWQucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpLHRoaXMuZWxlbWVudCl9LGNsb3NlX25vZGU6ZnVuY3Rpb24oaSxyKXt2YXIgcyxuLGEsbztpZihlLmlzQXJyYXkoaSkpe2ZvcihpPWkuc2xpY2UoKSxzPTAsbj1pLmxlbmd0aDtuPnM7cysrKXRoaXMuY2xvc2Vfbm9kZShpW3NdLHIpO3JldHVybiEwfXJldHVybiBpPXRoaXMuZ2V0X25vZGUoaSksaSYmaS5pZCE9PWUuanN0cmVlLnJvb3Q/dGhpcy5pc19jbG9zZWQoaSk/ITE6KHI9cj09PXQ/dGhpcy5zZXR0aW5ncy5jb3JlLmFuaW1hdGlvbjpyLGE9dGhpcyxvPXRoaXMuZ2V0X25vZGUoaSwhMCksby5sZW5ndGgmJihyP28uY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmF0dHIoXCJzdHlsZVwiLFwiZGlzcGxheTpibG9jayAhaW1wb3J0YW50XCIpLmVuZCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW9wZW5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKS5zbGlkZVVwKHIsZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9XCJcIixvLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5yZW1vdmUoKSxhLnRyaWdnZXIoXCJhZnRlcl9jbG9zZVwiLHtub2RlOml9KX0pOihvWzBdLmNsYXNzTmFtZT1vWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwianN0cmVlLW9wZW5cIixcImpzdHJlZS1jbG9zZWRcIiksby5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikucmVtb3ZlKCkpKSxpLnN0YXRlLm9wZW5lZD0hMSx0aGlzLnRyaWdnZXIoXCJjbG9zZV9ub2RlXCIse25vZGU6aX0pLHZvaWQociYmby5sZW5ndGh8fHRoaXMudHJpZ2dlcihcImFmdGVyX2Nsb3NlXCIse25vZGU6aX0pKSk6ITF9LHRvZ2dsZV9ub2RlOmZ1bmN0aW9uKHQpe3ZhciBpLHI7aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksaT0wLHI9dC5sZW5ndGg7cj5pO2krKyl0aGlzLnRvZ2dsZV9ub2RlKHRbaV0pO3JldHVybiEwfXJldHVybiB0aGlzLmlzX2Nsb3NlZCh0KT90aGlzLm9wZW5fbm9kZSh0KTp0aGlzLmlzX29wZW4odCk/dGhpcy5jbG9zZV9ub2RlKHQpOnZvaWQgMH0sb3Blbl9hbGw6ZnVuY3Rpb24odCxpLHIpe2lmKHR8fCh0PWUuanN0cmVlLnJvb3QpLHQ9dGhpcy5nZXRfbm9kZSh0KSwhdClyZXR1cm4hMTt2YXIgcyxuLGEsbz10LmlkPT09ZS5qc3RyZWUucm9vdD90aGlzLmdldF9jb250YWluZXJfdWwoKTp0aGlzLmdldF9ub2RlKHQsITApO2lmKCFvLmxlbmd0aCl7Zm9yKHM9MCxuPXQuY2hpbGRyZW5fZC5sZW5ndGg7bj5zO3MrKyl0aGlzLmlzX2Nsb3NlZCh0aGlzLl9tb2RlbC5kYXRhW3QuY2hpbGRyZW5fZFtzXV0pJiYodGhpcy5fbW9kZWwuZGF0YVt0LmNoaWxkcmVuX2Rbc11dLnN0YXRlLm9wZW5lZD0hMCk7cmV0dXJuIHRoaXMudHJpZ2dlcihcIm9wZW5fYWxsXCIse25vZGU6dH0pfXI9cnx8byxhPXRoaXMsbz10aGlzLmlzX2Nsb3NlZCh0KT9vLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5hZGRCYWNrKCk6by5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIiksby5lYWNoKGZ1bmN0aW9uKCl7YS5vcGVuX25vZGUodGhpcyxmdW5jdGlvbihlLHQpe3QmJnRoaXMuaXNfcGFyZW50KGUpJiZ0aGlzLm9wZW5fYWxsKGUsaSxyKX0saXx8MCl9KSwwPT09ci5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIikubGVuZ3RoJiZ0aGlzLnRyaWdnZXIoXCJvcGVuX2FsbFwiLHtub2RlOnRoaXMuZ2V0X25vZGUocil9KX0sY2xvc2VfYWxsOmZ1bmN0aW9uKHQsaSl7aWYodHx8KHQ9ZS5qc3RyZWUucm9vdCksdD10aGlzLmdldF9ub2RlKHQpLCF0KXJldHVybiExO3ZhciByLHMsbj10LmlkPT09ZS5qc3RyZWUucm9vdD90aGlzLmdldF9jb250YWluZXJfdWwoKTp0aGlzLmdldF9ub2RlKHQsITApLGE9dGhpcztmb3Iobi5sZW5ndGgmJihuPXRoaXMuaXNfb3Blbih0KT9uLmZpbmQoXCIuanN0cmVlLW9wZW5cIikuYWRkQmFjaygpOm4uZmluZChcIi5qc3RyZWUtb3BlblwiKSxlKG4uZ2V0KCkucmV2ZXJzZSgpKS5lYWNoKGZ1bmN0aW9uKCl7YS5jbG9zZV9ub2RlKHRoaXMsaXx8MCl9KSkscj0wLHM9dC5jaGlsZHJlbl9kLmxlbmd0aDtzPnI7cisrKXRoaXMuX21vZGVsLmRhdGFbdC5jaGlsZHJlbl9kW3JdXS5zdGF0ZS5vcGVuZWQ9ITE7dGhpcy50cmlnZ2VyKFwiY2xvc2VfYWxsXCIse25vZGU6dH0pfSxpc19kaXNhYmxlZDpmdW5jdGlvbihlKXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUpLGUmJmUuc3RhdGUmJmUuc3RhdGUuZGlzYWJsZWR9LGVuYWJsZV9ub2RlOmZ1bmN0aW9uKHQpe3ZhciBpLHI7aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksaT0wLHI9dC5sZW5ndGg7cj5pO2krKyl0aGlzLmVuYWJsZV9ub2RlKHRbaV0pO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KHQuc3RhdGUuZGlzYWJsZWQ9ITEsdGhpcy5nZXRfbm9kZSh0LCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWRpc2FibGVkXCIpLmF0dHIoXCJhcmlhLWRpc2FibGVkXCIsITEpLHZvaWQgdGhpcy50cmlnZ2VyKFwiZW5hYmxlX25vZGVcIix7bm9kZTp0fSkpOiExfSxkaXNhYmxlX25vZGU6ZnVuY3Rpb24odCl7dmFyIGkscjtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxpPTAscj10Lmxlbmd0aDtyPmk7aSsrKXRoaXMuZGlzYWJsZV9ub2RlKHRbaV0pO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KHQuc3RhdGUuZGlzYWJsZWQ9ITAsdGhpcy5nZXRfbm9kZSh0LCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLWRpc2FibGVkXCIpLmF0dHIoXCJhcmlhLWRpc2FibGVkXCIsITApLHZvaWQgdGhpcy50cmlnZ2VyKFwiZGlzYWJsZV9ub2RlXCIse25vZGU6dH0pKTohMX0saGlkZV9ub2RlOmZ1bmN0aW9uKHQsaSl7dmFyIHIscztpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxyPTAscz10Lmxlbmd0aDtzPnI7cisrKXRoaXMuaGlkZV9ub2RlKHRbcl0sITApO3JldHVybiB0aGlzLnJlZHJhdygpLCEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/dm9pZCh0LnN0YXRlLmhpZGRlbnx8KHQuc3RhdGUuaGlkZGVuPSEwLHRoaXMuX25vZGVfY2hhbmdlZCh0LnBhcmVudCksaXx8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJoaWRlX25vZGVcIix7bm9kZTp0fSkpKTohMX0sc2hvd19ub2RlOmZ1bmN0aW9uKHQsaSl7dmFyIHIscztpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxyPTAscz10Lmxlbmd0aDtzPnI7cisrKXRoaXMuc2hvd19ub2RlKHRbcl0sITApO3JldHVybiB0aGlzLnJlZHJhdygpLCEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/dm9pZCh0LnN0YXRlLmhpZGRlbiYmKHQuc3RhdGUuaGlkZGVuPSExLHRoaXMuX25vZGVfY2hhbmdlZCh0LnBhcmVudCksaXx8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJzaG93X25vZGVcIix7bm9kZTp0fSkpKTohMX0saGlkZV9hbGw6ZnVuY3Rpb24odCl7dmFyIGkscj10aGlzLl9tb2RlbC5kYXRhLHM9W107Zm9yKGkgaW4gcilyLmhhc093blByb3BlcnR5KGkpJiZpIT09ZS5qc3RyZWUucm9vdCYmIXJbaV0uc3RhdGUuaGlkZGVuJiYocltpXS5zdGF0ZS5oaWRkZW49ITAscy5wdXNoKGkpKTtyZXR1cm4gdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITAsdHx8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJoaWRlX2FsbFwiLHtub2RlczpzfSksc30sc2hvd19hbGw6ZnVuY3Rpb24odCl7dmFyIGkscj10aGlzLl9tb2RlbC5kYXRhLHM9W107Zm9yKGkgaW4gcilyLmhhc093blByb3BlcnR5KGkpJiZpIT09ZS5qc3RyZWUucm9vdCYmcltpXS5zdGF0ZS5oaWRkZW4mJihyW2ldLnN0YXRlLmhpZGRlbj0hMSxzLnB1c2goaSkpO3JldHVybiB0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCx0fHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcInNob3dfYWxsXCIse25vZGVzOnN9KSxzfSxhY3RpdmF0ZV9ub2RlOmZ1bmN0aW9uKGUsaSl7aWYodGhpcy5pc19kaXNhYmxlZChlKSlyZXR1cm4hMTtpZihpJiZcIm9iamVjdFwiPT10eXBlb2YgaXx8KGk9e30pLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5pZCE9PXQ/dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkKTpudWxsLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQmJiF0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLnN0YXRlLnNlbGVjdGVkJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD1udWxsKSwhdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCYmKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aC0xXSkpLHRoaXMuc2V0dGluZ3MuY29yZS5tdWx0aXBsZSYmKGkubWV0YUtleXx8aS5jdHJsS2V5fHxpLnNoaWZ0S2V5KSYmKCFpLnNoaWZ0S2V5fHx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLmdldF9wYXJlbnQoZSkmJnRoaXMuZ2V0X3BhcmVudChlKT09PXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQucGFyZW50KSlpZihpLnNoaWZ0S2V5KXt2YXIgcixzLG49dGhpcy5nZXRfbm9kZShlKS5pZCxhPXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuaWQsbz10aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQucGFyZW50KS5jaGlsZHJlbixkPSExO2ZvcihyPTAscz1vLmxlbmd0aDtzPnI7cis9MSlvW3JdPT09biYmKGQ9IWQpLG9bcl09PT1hJiYoZD0hZCksdGhpcy5pc19kaXNhYmxlZChvW3JdKXx8IWQmJm9bcl0hPT1uJiZvW3JdIT09YT90aGlzLmRlc2VsZWN0X25vZGUob1tyXSwhMCxpKTp0aGlzLnNlbGVjdF9ub2RlKG9bcl0sITAsITEsaSk7dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJzZWxlY3Rfbm9kZVwiLG5vZGU6dGhpcy5nZXRfbm9kZShlKSxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6aX0pfWVsc2UgdGhpcy5pc19zZWxlY3RlZChlKT90aGlzLmRlc2VsZWN0X25vZGUoZSwhMSxpKTp0aGlzLnNlbGVjdF9ub2RlKGUsITEsITEsaSk7ZWxzZSF0aGlzLnNldHRpbmdzLmNvcmUubXVsdGlwbGUmJihpLm1ldGFLZXl8fGkuY3RybEtleXx8aS5zaGlmdEtleSkmJnRoaXMuaXNfc2VsZWN0ZWQoZSk/dGhpcy5kZXNlbGVjdF9ub2RlKGUsITEsaSk6KHRoaXMuZGVzZWxlY3RfYWxsKCEwKSx0aGlzLnNlbGVjdF9ub2RlKGUsITEsITEsaSksdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLmdldF9ub2RlKGUpKTt0aGlzLnRyaWdnZXIoXCJhY3RpdmF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShlKSxldmVudDppfSl9LGhvdmVyX25vZGU6ZnVuY3Rpb24oZSl7aWYoZT10aGlzLmdldF9ub2RlKGUsITApLCFlfHwhZS5sZW5ndGh8fGUuY2hpbGRyZW4oXCIuanN0cmVlLWhvdmVyZWRcIikubGVuZ3RoKXJldHVybiExO3ZhciB0PXRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLGk9dGhpcy5lbGVtZW50O3QmJnQubGVuZ3RoJiZ0aGlzLmRlaG92ZXJfbm9kZSh0KSxlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKSx0aGlzLnRyaWdnZXIoXCJob3Zlcl9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShlKX0pLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtpLmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIixlWzBdLmlkKX0sMCl9LGRlaG92ZXJfbm9kZTpmdW5jdGlvbihlKXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUsITApLGUmJmUubGVuZ3RoJiZlLmNoaWxkcmVuKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLmxlbmd0aD8oZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIiksdm9pZCB0aGlzLnRyaWdnZXIoXCJkZWhvdmVyX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGUpfSkpOiExfSxzZWxlY3Rfbm9kZTpmdW5jdGlvbih0LGkscixzKXt2YXIgbixhLG87aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksYT0wLG89dC5sZW5ndGg7bz5hO2ErKyl0aGlzLnNlbGVjdF9ub2RlKHRbYV0saSxyLHMpO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KG49dGhpcy5nZXRfbm9kZSh0LCEwKSx2b2lkKHQuc3RhdGUuc2VsZWN0ZWR8fCh0LnN0YXRlLnNlbGVjdGVkPSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKHQuaWQpLHJ8fChuPXRoaXMuX29wZW5fdG8odCkpLG4mJm4ubGVuZ3RoJiZuLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJzZWxlY3Rfbm9kZVwiLHtub2RlOnQsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OnN9KSxpfHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9ub2RlXCIsbm9kZTp0LHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxldmVudDpzfSkpKSk6ITF9LGRlc2VsZWN0X25vZGU6ZnVuY3Rpb24odCxpLHIpe3ZhciBzLG4sYTtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxzPTAsbj10Lmxlbmd0aDtuPnM7cysrKXRoaXMuZGVzZWxlY3Rfbm9kZSh0W3NdLGkscik7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8oYT10aGlzLmdldF9ub2RlKHQsITApLHZvaWQodC5zdGF0ZS5zZWxlY3RlZCYmKHQuc3RhdGUuc2VsZWN0ZWQ9ITEsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCx0LmlkKSxhLmxlbmd0aCYmYS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksdGhpcy50cmlnZ2VyKFwiZGVzZWxlY3Rfbm9kZVwiLHtub2RlOnQsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OnJ9KSxpfHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImRlc2VsZWN0X25vZGVcIixub2RlOnQsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OnJ9KSkpKTohMX0sc2VsZWN0X2FsbDpmdW5jdGlvbih0KXt2YXIgaSxyLHM9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChbXSk7Zm9yKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD10aGlzLl9tb2RlbC5kYXRhW2UuanN0cmVlLnJvb3RdLmNoaWxkcmVuX2QuY29uY2F0KCksaT0wLHI9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtyPmk7aSsrKXRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2ldXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2ldXS5zdGF0ZS5zZWxlY3RlZD0hMCk7dGhpcy5yZWRyYXcoITApLHRoaXMudHJpZ2dlcihcInNlbGVjdF9hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksdHx8dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJzZWxlY3RfYWxsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG9sZF9zZWxlY3Rpb246c30pfSxkZXNlbGVjdF9hbGw6ZnVuY3Rpb24oZSl7dmFyIHQsaSxyPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoW10pO2Zvcih0PTAsaT10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoO2k+dDt0KyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbdF1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbdF1dLnN0YXRlLnNlbGVjdGVkPSExKTt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9W10sdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNsaWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKS5wYXJlbnQoKS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKSx0aGlzLnRyaWdnZXIoXCJkZXNlbGVjdF9hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG5vZGU6cn0pLGV8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVzZWxlY3RfYWxsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG9sZF9zZWxlY3Rpb246cn0pfSxpc19zZWxlY3RlZDpmdW5jdGlvbih0KXtyZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290P3Quc3RhdGUuc2VsZWN0ZWQ6ITF9LGdldF9zZWxlY3RlZDpmdW5jdGlvbih0KXtyZXR1cm4gdD9lLm1hcCh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZS5wcm94eShmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShlKX0sdGhpcykpOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5zbGljZSgpfSxnZXRfdG9wX3NlbGVjdGVkOmZ1bmN0aW9uKHQpe3ZhciBpLHIscyxuLGE9dGhpcy5nZXRfc2VsZWN0ZWQoITApLG89e307Zm9yKGk9MCxyPWEubGVuZ3RoO3I+aTtpKyspb1thW2ldLmlkXT1hW2ldO2ZvcihpPTAscj1hLmxlbmd0aDtyPmk7aSsrKWZvcihzPTAsbj1hW2ldLmNoaWxkcmVuX2QubGVuZ3RoO24+cztzKyspb1thW2ldLmNoaWxkcmVuX2Rbc11dJiZkZWxldGUgb1thW2ldLmNoaWxkcmVuX2Rbc11dO2E9W107Zm9yKGkgaW4gbylvLmhhc093blByb3BlcnR5KGkpJiZhLnB1c2goaSk7cmV0dXJuIHQ/ZS5tYXAoYSxlLnByb3h5KGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmdldF9ub2RlKGUpfSx0aGlzKSk6YX0sZ2V0X2JvdHRvbV9zZWxlY3RlZDpmdW5jdGlvbih0KXt2YXIgaSxyLHM9dGhpcy5nZXRfc2VsZWN0ZWQoITApLG49W107Zm9yKGk9MCxyPXMubGVuZ3RoO3I+aTtpKyspc1tpXS5jaGlsZHJlbi5sZW5ndGh8fG4ucHVzaChzW2ldLmlkKTtyZXR1cm4gdD9lLm1hcChuLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoZSl9LHRoaXMpKTpufSxnZXRfc3RhdGU6ZnVuY3Rpb24oKXt2YXIgdCxpPXtjb3JlOntvcGVuOltdLHNjcm9sbDp7bGVmdDp0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdCgpLHRvcDp0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKCl9LHNlbGVjdGVkOltdfX07Zm9yKHQgaW4gdGhpcy5fbW9kZWwuZGF0YSl0aGlzLl9tb2RlbC5kYXRhLmhhc093blByb3BlcnR5KHQpJiZ0IT09ZS5qc3RyZWUucm9vdCYmKHRoaXMuX21vZGVsLmRhdGFbdF0uc3RhdGUub3BlbmVkJiZpLmNvcmUub3Blbi5wdXNoKHQpLHRoaXMuX21vZGVsLmRhdGFbdF0uc3RhdGUuc2VsZWN0ZWQmJmkuY29yZS5zZWxlY3RlZC5wdXNoKHQpKTtyZXR1cm4gaX0sc2V0X3N0YXRlOmZ1bmN0aW9uKGkscil7aWYoaSl7aWYoaS5jb3JlKXt2YXIgcyxuO2lmKGkuY29yZS5vcGVuKXJldHVybiBlLmlzQXJyYXkoaS5jb3JlLm9wZW4pJiZpLmNvcmUub3Blbi5sZW5ndGg/dGhpcy5fbG9hZF9ub2RlcyhpLmNvcmUub3BlbixmdW5jdGlvbihlKXt0aGlzLm9wZW5fbm9kZShlLCExLDApLGRlbGV0ZSBpLmNvcmUub3Blbix0aGlzLnNldF9zdGF0ZShpLHIpfSwhMCk6KGRlbGV0ZSBpLmNvcmUub3Blbix0aGlzLnNldF9zdGF0ZShpLHIpKSwhMTtpZihpLmNvcmUuc2Nyb2xsKXJldHVybiBpLmNvcmUuc2Nyb2xsJiZpLmNvcmUuc2Nyb2xsLmxlZnQhPT10JiZ0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdChpLmNvcmUuc2Nyb2xsLmxlZnQpLGkuY29yZS5zY3JvbGwmJmkuY29yZS5zY3JvbGwudG9wIT09dCYmdGhpcy5lbGVtZW50LnNjcm9sbFRvcChpLmNvcmUuc2Nyb2xsLnRvcCksZGVsZXRlIGkuY29yZS5zY3JvbGwsdGhpcy5zZXRfc3RhdGUoaSxyKSwhMTtpZihpLmNvcmUuc2VsZWN0ZWQpcmV0dXJuIHM9dGhpcyx0aGlzLmRlc2VsZWN0X2FsbCgpLGUuZWFjaChpLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oZSx0KXtzLnNlbGVjdF9ub2RlKHQsITEsITApfSksZGVsZXRlIGkuY29yZS5zZWxlY3RlZCx0aGlzLnNldF9zdGF0ZShpLHIpLCExO2ZvcihuIGluIGkpaS5oYXNPd25Qcm9wZXJ0eShuKSYmXCJjb3JlXCIhPT1uJiYtMT09PWUuaW5BcnJheShuLHRoaXMuc2V0dGluZ3MucGx1Z2lucykmJmRlbGV0ZSBpW25dO2lmKGUuaXNFbXB0eU9iamVjdChpLmNvcmUpKXJldHVybiBkZWxldGUgaS5jb3JlLHRoaXMuc2V0X3N0YXRlKGksciksITF9cmV0dXJuIGUuaXNFbXB0eU9iamVjdChpKT8oaT1udWxsLHImJnIuY2FsbCh0aGlzKSx0aGlzLnRyaWdnZXIoXCJzZXRfc3RhdGVcIiksITEpOiEwfXJldHVybiExfSxyZWZyZXNoOmZ1bmN0aW9uKHQsaSl7dGhpcy5fZGF0YS5jb3JlLnN0YXRlPWk9PT0hMD97fTp0aGlzLmdldF9zdGF0ZSgpLGkmJmUuaXNGdW5jdGlvbihpKSYmKHRoaXMuX2RhdGEuY29yZS5zdGF0ZT1pLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUuc3RhdGUpKSx0aGlzLl9jbnQ9MCx0aGlzLl9tb2RlbC5kYXRhPXt9LHRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF09e2lkOmUuanN0cmVlLnJvb3QscGFyZW50Om51bGwscGFyZW50czpbXSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLHN0YXRlOntsb2FkZWQ6ITF9fSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9W10sdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD1udWxsLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW51bGw7dmFyIHI9dGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0uY2xhc3NOYW1lO3R8fCh0aGlzLmVsZW1lbnQuaHRtbChcIjx1bCBjbGFzcz0nXCIrcitcIicgcm9sZT0nZ3JvdXAnPjxsaSBjbGFzcz0nanN0cmVlLWluaXRpYWwtbm9kZSBqc3RyZWUtbG9hZGluZyBqc3RyZWUtbGVhZiBqc3RyZWUtbGFzdCcgcm9sZT0ndHJlZWl0ZW0nIGlkPSdqXCIrdGhpcy5faWQrXCJfbG9hZGluZyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS1vY2wnPjwvaT48YSBjbGFzcz0nanN0cmVlLWFuY2hvcicgaHJlZj0nIyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb24taGlkZGVuJz48L2k+XCIrdGhpcy5nZXRfc3RyaW5nKFwiTG9hZGluZyAuLi5cIikrXCI8L2E+PC9saT48L3VsPlwiKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFwialwiK3RoaXMuX2lkK1wiX2xvYWRpbmdcIikpLHRoaXMubG9hZF9ub2RlKGUuanN0cmVlLnJvb3QsZnVuY3Rpb24odCxpKXtpJiYodGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0uY2xhc3NOYW1lPXIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkuaWQpLHRoaXMuc2V0X3N0YXRlKGUuZXh0ZW5kKCEwLHt9LHRoaXMuX2RhdGEuY29yZS5zdGF0ZSksZnVuY3Rpb24oKXt0aGlzLnRyaWdnZXIoXCJyZWZyZXNoXCIpfSkpLHRoaXMuX2RhdGEuY29yZS5zdGF0ZT1udWxsfSl9LHJlZnJlc2hfbm9kZTpmdW5jdGlvbih0KXtpZih0PXRoaXMuZ2V0X25vZGUodCksIXR8fHQuaWQ9PT1lLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBpPVtdLHI9W107dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChbXSk7ci5wdXNoKHQuaWQpLHQuc3RhdGUub3BlbmVkPT09ITAmJmkucHVzaCh0LmlkKSx0aGlzLmdldF9ub2RlKHQsITApLmZpbmQoXCIuanN0cmVlLW9wZW5cIikuZWFjaChmdW5jdGlvbigpe2kucHVzaCh0aGlzLmlkKX0pLHRoaXMuX2xvYWRfbm9kZXMocixlLnByb3h5KGZ1bmN0aW9uKGUpe3RoaXMub3Blbl9ub2RlKGksITEsMCksdGhpcy5zZWxlY3Rfbm9kZSh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQpLHRoaXMudHJpZ2dlcihcInJlZnJlc2hfbm9kZVwiLHtub2RlOnQsbm9kZXM6ZX0pfSx0aGlzKSl9LHNldF9pZDpmdW5jdGlvbih0LGkpe2lmKHQ9dGhpcy5nZXRfbm9kZSh0KSwhdHx8dC5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIHIscyxuPXRoaXMuX21vZGVsLmRhdGE7Zm9yKGk9aS50b1N0cmluZygpLG5bdC5wYXJlbnRdLmNoaWxkcmVuW2UuaW5BcnJheSh0LmlkLG5bdC5wYXJlbnRdLmNoaWxkcmVuKV09aSxyPTAscz10LnBhcmVudHMubGVuZ3RoO3M+cjtyKyspblt0LnBhcmVudHNbcl1dLmNoaWxkcmVuX2RbZS5pbkFycmF5KHQuaWQsblt0LnBhcmVudHNbcl1dLmNoaWxkcmVuX2QpXT1pO2ZvcihyPTAscz10LmNoaWxkcmVuLmxlbmd0aDtzPnI7cisrKW5bdC5jaGlsZHJlbltyXV0ucGFyZW50PWk7Zm9yKHI9MCxzPXQuY2hpbGRyZW5fZC5sZW5ndGg7cz5yO3IrKyluW3QuY2hpbGRyZW5fZFtyXV0ucGFyZW50c1tlLmluQXJyYXkodC5pZCxuW3QuY2hpbGRyZW5fZFtyXV0ucGFyZW50cyldPWk7cmV0dXJuIHI9ZS5pbkFycmF5KHQuaWQsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkKSwtMSE9PXImJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbcl09aSkscj10aGlzLmdldF9ub2RlKHQuaWQsITApLHImJihyLmF0dHIoXCJpZFwiLGkpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYXR0cihcImlkXCIsaStcIl9hbmNob3JcIikuZW5kKCkuYXR0cihcImFyaWEtbGFiZWxsZWRieVwiLGkrXCJfYW5jaG9yXCIpLHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIpPT09dC5pZCYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIixpKSksZGVsZXRlIG5bdC5pZF0sdC5pZD1pLHQubGlfYXR0ci5pZD1pLG5baV09dCwhMH0sZ2V0X3RleHQ6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD90LnRleHQ6ITF9LHNldF90ZXh0OmZ1bmN0aW9uKHQsaSl7dmFyIHIscztpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxyPTAscz10Lmxlbmd0aDtzPnI7cisrKXRoaXMuc2V0X3RleHQodFtyXSxpKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290Pyh0LnRleHQ9aSx0aGlzLmdldF9ub2RlKHQsITApLmxlbmd0aCYmdGhpcy5yZWRyYXdfbm9kZSh0LmlkKSx0aGlzLnRyaWdnZXIoXCJzZXRfdGV4dFwiLHtvYmo6dCx0ZXh0Oml9KSwhMCk6ITF9LGdldF9qc29uOmZ1bmN0aW9uKHQsaSxyKXtpZih0PXRoaXMuZ2V0X25vZGUodHx8ZS5qc3RyZWUucm9vdCksIXQpcmV0dXJuITE7aSYmaS5mbGF0JiYhciYmKHI9W10pO3ZhciBzLG4sYT17aWQ6dC5pZCx0ZXh0OnQudGV4dCxpY29uOnRoaXMuZ2V0X2ljb24odCksbGlfYXR0cjplLmV4dGVuZCghMCx7fSx0LmxpX2F0dHIpLGFfYXR0cjplLmV4dGVuZCghMCx7fSx0LmFfYXR0ciksc3RhdGU6e30sZGF0YTppJiZpLm5vX2RhdGE/ITE6ZS5leHRlbmQoITAse30sdC5kYXRhKX07aWYoaSYmaS5mbGF0P2EucGFyZW50PXQucGFyZW50OmEuY2hpbGRyZW49W10sIWl8fCFpLm5vX3N0YXRlKWZvcihzIGluIHQuc3RhdGUpdC5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShzKSYmKGEuc3RhdGVbc109dC5zdGF0ZVtzXSk7aWYoaSYmaS5ub19pZCYmKGRlbGV0ZSBhLmlkLGEubGlfYXR0ciYmYS5saV9hdHRyLmlkJiZkZWxldGUgYS5saV9hdHRyLmlkLGEuYV9hdHRyJiZhLmFfYXR0ci5pZCYmZGVsZXRlIGEuYV9hdHRyLmlkKSxpJiZpLmZsYXQmJnQuaWQhPT1lLmpzdHJlZS5yb290JiZyLnB1c2goYSksIWl8fCFpLm5vX2NoaWxkcmVuKWZvcihzPTAsbj10LmNoaWxkcmVuLmxlbmd0aDtuPnM7cysrKWkmJmkuZmxhdD90aGlzLmdldF9qc29uKHQuY2hpbGRyZW5bc10saSxyKTphLmNoaWxkcmVuLnB1c2godGhpcy5nZXRfanNvbih0LmNoaWxkcmVuW3NdLGkpKTtyZXR1cm4gaSYmaS5mbGF0P3I6dC5pZD09PWUuanN0cmVlLnJvb3Q/YS5jaGlsZHJlbjphfSxjcmVhdGVfbm9kZTpmdW5jdGlvbihpLHIscyxuLGEpe2lmKG51bGw9PT1pJiYoaT1lLmpzdHJlZS5yb290KSxpPXRoaXMuZ2V0X25vZGUoaSksIWkpcmV0dXJuITE7aWYocz1zPT09dD9cImxhc3RcIjpzLCFzLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmIWEmJiF0aGlzLmlzX2xvYWRlZChpKSlyZXR1cm4gdGhpcy5sb2FkX25vZGUoaSxmdW5jdGlvbigpe3RoaXMuY3JlYXRlX25vZGUoaSxyLHMsbiwhMCl9KTtyfHwocj17dGV4dDp0aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKX0pLFwic3RyaW5nXCI9PXR5cGVvZiByJiYocj17dGV4dDpyfSksci50ZXh0PT09dCYmKHIudGV4dD10aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKSk7dmFyIG8sZCxjLGw7c3dpdGNoKGkuaWQ9PT1lLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PXMmJihzPVwiZmlyc3RcIiksXCJhZnRlclwiPT09cyYmKHM9XCJsYXN0XCIpKSxzKXtjYXNlXCJiZWZvcmVcIjpvPXRoaXMuZ2V0X25vZGUoaS5wYXJlbnQpLHM9ZS5pbkFycmF5KGkuaWQsby5jaGlsZHJlbiksaT1vO2JyZWFrO2Nhc2VcImFmdGVyXCI6bz10aGlzLmdldF9ub2RlKGkucGFyZW50KSxzPWUuaW5BcnJheShpLmlkLG8uY2hpbGRyZW4pKzEsaT1vO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6cz0wO2JyZWFrO2Nhc2VcImxhc3RcIjpzPWkuY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6c3x8KHM9MCl9aWYocz5pLmNoaWxkcmVuLmxlbmd0aCYmKHM9aS5jaGlsZHJlbi5sZW5ndGgpLHIuaWR8fChyLmlkPSEwKSwhdGhpcy5jaGVjayhcImNyZWF0ZV9ub2RlXCIscixpLHMpKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtpZihyLmlkPT09ITAmJmRlbGV0ZSByLmlkLHI9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9qc29uKHIsaS5pZCxpLnBhcmVudHMuY29uY2F0KCkpLCFyKXJldHVybiExO2ZvcihvPXRoaXMuZ2V0X25vZGUociksZD1bXSxkLnB1c2gociksZD1kLmNvbmNhdChvLmNoaWxkcmVuX2QpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmQscGFyZW50OmkuaWR9KSxpLmNoaWxkcmVuX2Q9aS5jaGlsZHJlbl9kLmNvbmNhdChkKSxjPTAsbD1pLnBhcmVudHMubGVuZ3RoO2w+YztjKyspdGhpcy5fbW9kZWwuZGF0YVtpLnBhcmVudHNbY11dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtpLnBhcmVudHNbY11dLmNoaWxkcmVuX2QuY29uY2F0KGQpO2ZvcihyPW8sbz1bXSxjPTAsbD1pLmNoaWxkcmVuLmxlbmd0aDtsPmM7YysrKW9bYz49cz9jKzE6Y109aS5jaGlsZHJlbltjXTtyZXR1cm4gb1tzXT1yLmlkLGkuY2hpbGRyZW49byx0aGlzLnJlZHJhd19ub2RlKGksITApLG4mJm4uY2FsbCh0aGlzLHRoaXMuZ2V0X25vZGUocikpLHRoaXMudHJpZ2dlcihcImNyZWF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShyKSxwYXJlbnQ6aS5pZCxwb3NpdGlvbjpzfSksci5pZH0scmVuYW1lX25vZGU6ZnVuY3Rpb24odCxpKXt2YXIgcixzLG47aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCkscj0wLHM9dC5sZW5ndGg7cz5yO3IrKyl0aGlzLnJlbmFtZV9ub2RlKHRbcl0saSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8obj10LnRleHQsdGhpcy5jaGVjayhcInJlbmFtZV9ub2RlXCIsdCx0aGlzLmdldF9wYXJlbnQodCksaSk/KHRoaXMuc2V0X3RleHQodCxpKSx0aGlzLnRyaWdnZXIoXCJyZW5hbWVfbm9kZVwiLHtub2RlOnQsdGV4dDppLG9sZDpufSksITApOih0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMSkpOiExfSxkZWxldGVfbm9kZTpmdW5jdGlvbih0KXt2YXIgaSxyLHMsbixhLG8sZCxjLGwsaCxfLHU7aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksaT0wLHI9dC5sZW5ndGg7cj5pO2krKyl0aGlzLmRlbGV0ZV9ub2RlKHRbaV0pO3JldHVybiEwfWlmKHQ9dGhpcy5nZXRfbm9kZSh0KSwhdHx8dC5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7aWYocz10aGlzLmdldF9ub2RlKHQucGFyZW50KSxuPWUuaW5BcnJheSh0LmlkLHMuY2hpbGRyZW4pLGg9ITEsIXRoaXMuY2hlY2soXCJkZWxldGVfbm9kZVwiLHQscyxuKSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7Zm9yKC0xIT09biYmKHMuY2hpbGRyZW49ZS52YWthdGEuYXJyYXlfcmVtb3ZlKHMuY2hpbGRyZW4sbikpLGE9dC5jaGlsZHJlbl9kLmNvbmNhdChbXSksYS5wdXNoKHQuaWQpLGM9MCxsPWEubGVuZ3RoO2w+YztjKyspe2ZvcihvPTAsZD10LnBhcmVudHMubGVuZ3RoO2Q+bztvKyspbj1lLmluQXJyYXkoYVtjXSx0aGlzLl9tb2RlbC5kYXRhW3QucGFyZW50c1tvXV0uY2hpbGRyZW5fZCksLTEhPT1uJiYodGhpcy5fbW9kZWwuZGF0YVt0LnBhcmVudHNbb11dLmNoaWxkcmVuX2Q9ZS52YWthdGEuYXJyYXlfcmVtb3ZlKHRoaXMuX21vZGVsLmRhdGFbdC5wYXJlbnRzW29dXS5jaGlsZHJlbl9kLG4pKTt0aGlzLl9tb2RlbC5kYXRhW2FbY11dLnN0YXRlLnNlbGVjdGVkJiYoaD0hMCxuPWUuaW5BcnJheShhW2NdLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCksLTEhPT1uJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3JlbW92ZSh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsbikpKX1mb3IodGhpcy50cmlnZ2VyKFwiZGVsZXRlX25vZGVcIix7bm9kZTp0LHBhcmVudDpzLmlkfSksaCYmdGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJkZWxldGVfbm9kZVwiLG5vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQscGFyZW50OnMuaWR9KSxjPTAsbD1hLmxlbmd0aDtsPmM7YysrKWRlbGV0ZSB0aGlzLl9tb2RlbC5kYXRhW2FbY11dO3JldHVybi0xIT09ZS5pbkFycmF5KHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkLGEpJiYodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCxfPXRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3AsdT10aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdCxzLmlkPT09ZS5qc3RyZWUucm9vdD90aGlzLmdldF9ub2RlKHRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF0uY2hpbGRyZW5bMF0sITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTp0aGlzLmdldF9ub2RlKHMsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsVG9wPV8sdGhpcy5lbGVtZW50WzBdLnNjcm9sbExlZnQ9dSksdGhpcy5yZWRyYXdfbm9kZShzLCEwKSwhMH0sY2hlY2s6ZnVuY3Rpb24odCxpLHIscyxuKXtpPWkmJmkuaWQ/aTp0aGlzLmdldF9ub2RlKGkpLHI9ciYmci5pZD9yOnRoaXMuZ2V0X25vZGUocik7dmFyIGE9dC5tYXRjaCgvXm1vdmVfbm9kZXxjb3B5X25vZGV8Y3JlYXRlX25vZGUkL2kpP3I6aSxvPXRoaXMuc2V0dGluZ3MuY29yZS5jaGVja19jYWxsYmFjaztyZXR1cm5cIm1vdmVfbm9kZVwiIT09dCYmXCJjb3B5X25vZGVcIiE9PXR8fG4mJm4uaXNfbXVsdGl8fChpLmlkIT09ci5pZHx8XCJjb3B5X25vZGVcIj09PXQpJiZlLmluQXJyYXkoaS5pZCxyLmNoaWxkcmVuKSE9PXMmJi0xPT09ZS5pbkFycmF5KHIuaWQsaS5jaGlsZHJlbl9kKT8oYSYmYS5kYXRhJiYoYT1hLmRhdGEpLGEmJmEuZnVuY3Rpb25zJiYoYS5mdW5jdGlvbnNbdF09PT0hMXx8YS5mdW5jdGlvbnNbdF09PT0hMCk/KGEuZnVuY3Rpb25zW3RdPT09ITEmJih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDJcIixyZWFzb246XCJOb2RlIGRhdGEgcHJldmVudHMgZnVuY3Rpb246IFwiK3QsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOnQscG9zOnMsb2JqOmkmJmkuaWQ/aS5pZDohMSxwYXI6ciYmci5pZD9yLmlkOiExfSl9KSxhLmZ1bmN0aW9uc1t0XSk6bz09PSExfHxlLmlzRnVuY3Rpb24obykmJm8uY2FsbCh0aGlzLHQsaSxyLHMsbik9PT0hMXx8byYmb1t0XT09PSExPyh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDNcIixyZWFzb246XCJVc2VyIGNvbmZpZyBmb3IgY29yZS5jaGVja19jYWxsYmFjayBwcmV2ZW50cyBmdW5jdGlvbjogXCIrdCxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6dCxwb3M6cyxvYmo6aSYmaS5pZD9pLmlkOiExLHBhcjpyJiZyLmlkP3IuaWQ6ITF9KX0sITEpOiEwKToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAxXCIscmVhc29uOlwiTW92aW5nIHBhcmVudCBpbnNpZGUgY2hpbGRcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6dCxwb3M6cyxvYmo6aSYmaS5pZD9pLmlkOiExLHBhcjpyJiZyLmlkP3IuaWQ6ITF9KX0sITEpfSxsYXN0X2Vycm9yOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yfSxtb3ZlX25vZGU6ZnVuY3Rpb24oaSxyLHMsbixhLG8sZCl7dmFyIGMsbCxoLF8sdSxnLGYscCxtLHYsaix5LGsseDtpZihyPXRoaXMuZ2V0X25vZGUocikscz1zPT09dD8wOnMsIXIpcmV0dXJuITE7aWYoIXMudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhYSYmIXRoaXMuaXNfbG9hZGVkKHIpKXJldHVybiB0aGlzLmxvYWRfbm9kZShyLGZ1bmN0aW9uKCl7dGhpcy5tb3ZlX25vZGUoaSxyLHMsbiwhMCwhMSxkKX0pO2lmKGUuaXNBcnJheShpKSl7aWYoMSE9PWkubGVuZ3RoKXtmb3IoYz0wLGw9aS5sZW5ndGg7bD5jO2MrKykobT10aGlzLm1vdmVfbm9kZShpW2NdLHIscyxuLGEsITEsZCkpJiYocj1tLHM9XCJhZnRlclwiKTtyZXR1cm4gdGhpcy5yZWRyYXcoKSwhMH1pPWlbMF19aWYoaT1pJiZpLmlkP2k6dGhpcy5nZXRfbm9kZShpKSwhaXx8aS5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7aWYoaD0oaS5wYXJlbnR8fGUuanN0cmVlLnJvb3QpLnRvU3RyaW5nKCksdT1zLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmci5pZCE9PWUuanN0cmVlLnJvb3Q/dGhpcy5nZXRfbm9kZShyLnBhcmVudCk6cixnPWQ/ZDp0aGlzLl9tb2RlbC5kYXRhW2kuaWRdP3RoaXM6ZS5qc3RyZWUucmVmZXJlbmNlKGkuaWQpLGY9IWd8fCFnLl9pZHx8dGhpcy5faWQhPT1nLl9pZCxfPWcmJmcuX2lkJiZoJiZnLl9tb2RlbC5kYXRhW2hdJiZnLl9tb2RlbC5kYXRhW2hdLmNoaWxkcmVuP2UuaW5BcnJheShpLmlkLGcuX21vZGVsLmRhdGFbaF0uY2hpbGRyZW4pOi0xLGcmJmcuX2lkJiYoaT1nLl9tb2RlbC5kYXRhW2kuaWRdKSxmKXJldHVybihtPXRoaXMuY29weV9ub2RlKGkscixzLG4sYSwhMSxkKSk/KGcmJmcuZGVsZXRlX25vZGUoaSksbSk6ITE7c3dpdGNoKHIuaWQ9PT1lLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PXMmJihzPVwiZmlyc3RcIiksXCJhZnRlclwiPT09cyYmKHM9XCJsYXN0XCIpKSxzKXtjYXNlXCJiZWZvcmVcIjpzPWUuaW5BcnJheShyLmlkLHUuY2hpbGRyZW4pO2JyZWFrO2Nhc2VcImFmdGVyXCI6cz1lLmluQXJyYXkoci5pZCx1LmNoaWxkcmVuKSsxO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6cz0wO2JyZWFrO2Nhc2VcImxhc3RcIjpzPXUuY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6c3x8KHM9MCl9aWYocz51LmNoaWxkcmVuLmxlbmd0aCYmKHM9dS5jaGlsZHJlbi5sZW5ndGgpLCF0aGlzLmNoZWNrKFwibW92ZV9ub2RlXCIsaSx1LHMse2NvcmU6ITAsb3JpZ2luOmQsaXNfbXVsdGk6ZyYmZy5faWQmJmcuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohZ3x8IWcuX2lkfSkpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKGkucGFyZW50PT09dS5pZCl7Zm9yKHA9dS5jaGlsZHJlbi5jb25jYXQoKSxtPWUuaW5BcnJheShpLmlkLHApLC0xIT09bSYmKHA9ZS52YWthdGEuYXJyYXlfcmVtb3ZlKHAsbSkscz5tJiZzLS0pLG09W10sdj0wLGo9cC5sZW5ndGg7aj52O3YrKyltW3Y+PXM/disxOnZdPXBbdl07bVtzXT1pLmlkLHUuY2hpbGRyZW49bSx0aGlzLl9ub2RlX2NoYW5nZWQodS5pZCksdGhpcy5yZWRyYXcodS5pZD09PWUuanN0cmVlLnJvb3QpfWVsc2V7Zm9yKG09aS5jaGlsZHJlbl9kLmNvbmNhdCgpLG0ucHVzaChpLmlkKSx2PTAsaj1pLnBhcmVudHMubGVuZ3RoO2o+djt2Kyspe2ZvcihwPVtdLHg9Zy5fbW9kZWwuZGF0YVtpLnBhcmVudHNbdl1dLmNoaWxkcmVuX2QseT0wLGs9eC5sZW5ndGg7az55O3krKyktMT09PWUuaW5BcnJheSh4W3ldLG0pJiZwLnB1c2goeFt5XSk7Zy5fbW9kZWwuZGF0YVtpLnBhcmVudHNbdl1dLmNoaWxkcmVuX2Q9cH1mb3IoZy5fbW9kZWwuZGF0YVtoXS5jaGlsZHJlbj1lLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbShnLl9tb2RlbC5kYXRhW2hdLmNoaWxkcmVuLGkuaWQpLHY9MCxqPXUucGFyZW50cy5sZW5ndGg7aj52O3YrKyl0aGlzLl9tb2RlbC5kYXRhW3UucGFyZW50c1t2XV0uY2hpbGRyZW5fZD10aGlzLl9tb2RlbC5kYXRhW3UucGFyZW50c1t2XV0uY2hpbGRyZW5fZC5jb25jYXQobSk7Zm9yKHA9W10sdj0wLGo9dS5jaGlsZHJlbi5sZW5ndGg7aj52O3YrKylwW3Y+PXM/disxOnZdPXUuY2hpbGRyZW5bdl07Zm9yKHBbc109aS5pZCx1LmNoaWxkcmVuPXAsdS5jaGlsZHJlbl9kLnB1c2goaS5pZCksdS5jaGlsZHJlbl9kPXUuY2hpbGRyZW5fZC5jb25jYXQoaS5jaGlsZHJlbl9kKSxpLnBhcmVudD11LmlkLG09dS5wYXJlbnRzLmNvbmNhdCgpLG0udW5zaGlmdCh1LmlkKSx4PWkucGFyZW50cy5sZW5ndGgsaS5wYXJlbnRzPW0sbT1tLmNvbmNhdCgpLHY9MCxqPWkuY2hpbGRyZW5fZC5sZW5ndGg7aj52O3YrKyl0aGlzLl9tb2RlbC5kYXRhW2kuY2hpbGRyZW5fZFt2XV0ucGFyZW50cz10aGlzLl9tb2RlbC5kYXRhW2kuY2hpbGRyZW5fZFt2XV0ucGFyZW50cy5zbGljZSgwLC0xKngpLEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHRoaXMuX21vZGVsLmRhdGFbaS5jaGlsZHJlbl9kW3ZdXS5wYXJlbnRzLG0pOyhoPT09ZS5qc3RyZWUucm9vdHx8dS5pZD09PWUuanN0cmVlLnJvb3QpJiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3fHwodGhpcy5fbm9kZV9jaGFuZ2VkKGgpLHRoaXMuX25vZGVfY2hhbmdlZCh1LmlkKSksb3x8dGhpcy5yZWRyYXcoKX1yZXR1cm4gbiYmbi5jYWxsKHRoaXMsaSx1LHMpLHRoaXMudHJpZ2dlcihcIm1vdmVfbm9kZVwiLHtub2RlOmkscGFyZW50OnUuaWQscG9zaXRpb246cyxvbGRfcGFyZW50Omgsb2xkX3Bvc2l0aW9uOl8saXNfbXVsdGk6ZyYmZy5faWQmJmcuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohZ3x8IWcuX2lkLG9sZF9pbnN0YW5jZTpnLG5ld19pbnN0YW5jZTp0aGlzfSksaS5pZH0sY29weV9ub2RlOmZ1bmN0aW9uKGkscixzLG4sYSxvLGQpe3ZhciBjLGwsaCxfLHUsZyxmLHAsbSx2LGo7aWYocj10aGlzLmdldF9ub2RlKHIpLHM9cz09PXQ/MDpzLCFyKXJldHVybiExO2lmKCFzLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmIWEmJiF0aGlzLmlzX2xvYWRlZChyKSlyZXR1cm4gdGhpcy5sb2FkX25vZGUocixmdW5jdGlvbigpe3RoaXMuY29weV9ub2RlKGkscixzLG4sITAsITEsZCl9KTtpZihlLmlzQXJyYXkoaSkpe2lmKDEhPT1pLmxlbmd0aCl7Zm9yKGM9MCxsPWkubGVuZ3RoO2w+YztjKyspKF89dGhpcy5jb3B5X25vZGUoaVtjXSxyLHMsbixhLCEwLGQpKSYmKHI9XyxzPVwiYWZ0ZXJcIik7cmV0dXJuIHRoaXMucmVkcmF3KCksITB9aT1pWzBdfWlmKGk9aSYmaS5pZD9pOnRoaXMuZ2V0X25vZGUoaSksIWl8fGkuaWQ9PT1lLmpzdHJlZS5yb290KXJldHVybiExO3N3aXRjaChwPShpLnBhcmVudHx8ZS5qc3RyZWUucm9vdCkudG9TdHJpbmcoKSxtPXMudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiZyLmlkIT09ZS5qc3RyZWUucm9vdD90aGlzLmdldF9ub2RlKHIucGFyZW50KTpyLHY9ZD9kOnRoaXMuX21vZGVsLmRhdGFbaS5pZF0/dGhpczplLmpzdHJlZS5yZWZlcmVuY2UoaS5pZCksaj0hdnx8IXYuX2lkfHx0aGlzLl9pZCE9PXYuX2lkLHYmJnYuX2lkJiYoaT12Ll9tb2RlbC5kYXRhW2kuaWRdKSxyLmlkPT09ZS5qc3RyZWUucm9vdCYmKFwiYmVmb3JlXCI9PT1zJiYocz1cImZpcnN0XCIpLFwiYWZ0ZXJcIj09PXMmJihzPVwibGFzdFwiKSkscyl7Y2FzZVwiYmVmb3JlXCI6cz1lLmluQXJyYXkoci5pZCxtLmNoaWxkcmVuKTticmVhaztjYXNlXCJhZnRlclwiOnM9ZS5pbkFycmF5KHIuaWQsbS5jaGlsZHJlbikrMTticmVhaztjYXNlXCJpbnNpZGVcIjpjYXNlXCJmaXJzdFwiOnM9MDticmVhaztjYXNlXCJsYXN0XCI6cz1tLmNoaWxkcmVuLmxlbmd0aDticmVhaztkZWZhdWx0OnN8fChzPTApfWlmKHM+bS5jaGlsZHJlbi5sZW5ndGgmJihzPW0uY2hpbGRyZW4ubGVuZ3RoKSwhdGhpcy5jaGVjayhcImNvcHlfbm9kZVwiLGksbSxzLHtjb3JlOiEwLG9yaWdpbjpkLGlzX211bHRpOnYmJnYuX2lkJiZ2Ll9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IXZ8fCF2Ll9pZH0pKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtpZihmPXY/di5nZXRfanNvbihpLHtub19pZDohMCxub19kYXRhOiEwLG5vX3N0YXRlOiEwfSk6aSwhZilyZXR1cm4hMTtpZihmLmlkPT09ITAmJmRlbGV0ZSBmLmlkLGY9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9qc29uKGYsbS5pZCxtLnBhcmVudHMuY29uY2F0KCkpLCFmKXJldHVybiExO2ZvcihfPXRoaXMuZ2V0X25vZGUoZiksaSYmaS5zdGF0ZSYmaS5zdGF0ZS5sb2FkZWQ9PT0hMSYmKF8uc3RhdGUubG9hZGVkPSExKSxoPVtdLGgucHVzaChmKSxoPWguY29uY2F0KF8uY2hpbGRyZW5fZCksdGhpcy50cmlnZ2VyKFwibW9kZWxcIix7bm9kZXM6aCxwYXJlbnQ6bS5pZH0pLHU9MCxnPW0ucGFyZW50cy5sZW5ndGg7Zz51O3UrKyl0aGlzLl9tb2RlbC5kYXRhW20ucGFyZW50c1t1XV0uY2hpbGRyZW5fZD10aGlzLl9tb2RlbC5kYXRhW20ucGFyZW50c1t1XV0uY2hpbGRyZW5fZC5jb25jYXQoaCk7Zm9yKGg9W10sdT0wLGc9bS5jaGlsZHJlbi5sZW5ndGg7Zz51O3UrKyloW3U+PXM/dSsxOnVdPW0uY2hpbGRyZW5bdV07cmV0dXJuIGhbc109Xy5pZCxtLmNoaWxkcmVuPWgsbS5jaGlsZHJlbl9kLnB1c2goXy5pZCksbS5jaGlsZHJlbl9kPW0uY2hpbGRyZW5fZC5jb25jYXQoXy5jaGlsZHJlbl9kKSxtLmlkPT09ZS5qc3RyZWUucm9vdCYmKHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwKSx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhd3x8dGhpcy5fbm9kZV9jaGFuZ2VkKG0uaWQpLG98fHRoaXMucmVkcmF3KG0uaWQ9PT1lLmpzdHJlZS5yb290KSxuJiZuLmNhbGwodGhpcyxfLG0scyksdGhpcy50cmlnZ2VyKFwiY29weV9ub2RlXCIse25vZGU6XyxvcmlnaW5hbDppLHBhcmVudDptLmlkLHBvc2l0aW9uOnMsb2xkX3BhcmVudDpwLG9sZF9wb3NpdGlvbjp2JiZ2Ll9pZCYmcCYmdi5fbW9kZWwuZGF0YVtwXSYmdi5fbW9kZWwuZGF0YVtwXS5jaGlsZHJlbj9lLmluQXJyYXkoaS5pZCx2Ll9tb2RlbC5kYXRhW3BdLmNoaWxkcmVuKTotMSxpc19tdWx0aTp2JiZ2Ll9pZCYmdi5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiF2fHwhdi5faWQsb2xkX2luc3RhbmNlOnYsbmV3X2luc3RhbmNlOnRoaXN9KSxfLmlkfSxjdXQ6ZnVuY3Rpb24odCl7aWYodHx8KHQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdCgpKSxlLmlzQXJyYXkodCl8fCh0PVt0XSksIXQubGVuZ3RoKXJldHVybiExO3ZhciBpLHIscyxkPVtdO2ZvcihyPTAscz10Lmxlbmd0aDtzPnI7cisrKWk9dGhpcy5nZXRfbm9kZSh0W3JdKSxpJiZpLmlkJiZpLmlkIT09ZS5qc3RyZWUucm9vdCYmZC5wdXNoKGkpO3JldHVybiBkLmxlbmd0aD8obj1kLG89dGhpcyxhPVwibW92ZV9ub2RlXCIsdm9pZCB0aGlzLnRyaWdnZXIoXCJjdXRcIix7bm9kZTp0fSkpOiExfSxjb3B5OmZ1bmN0aW9uKHQpe2lmKHR8fCh0PXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoKSksZS5pc0FycmF5KHQpfHwodD1bdF0pLCF0Lmxlbmd0aClyZXR1cm4hMTt2YXIgaSxyLHMsZD1bXTtmb3Iocj0wLHM9dC5sZW5ndGg7cz5yO3IrKylpPXRoaXMuZ2V0X25vZGUodFtyXSksaSYmaS5pZCYmaS5pZCE9PWUuanN0cmVlLnJvb3QmJmQucHVzaChpKTtyZXR1cm4gZC5sZW5ndGg/KG49ZCxvPXRoaXMsYT1cImNvcHlfbm9kZVwiLHZvaWQgdGhpcy50cmlnZ2VyKFwiY29weVwiLHtub2RlOnR9KSk6ITF9LGdldF9idWZmZXI6ZnVuY3Rpb24oKXtyZXR1cm57bW9kZTphLG5vZGU6bixpbnN0Om99fSxjYW5fcGFzdGU6ZnVuY3Rpb24oKXtyZXR1cm4gYSE9PSExJiZuIT09ITF9LHBhc3RlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU9dGhpcy5nZXRfbm9kZShlKSxlJiZhJiZhLm1hdGNoKC9eKGNvcHlfbm9kZXxtb3ZlX25vZGUpJC8pJiZuPyh0aGlzW2FdKG4sZSx0LCExLCExLCExLG8pJiZ0aGlzLnRyaWdnZXIoXCJwYXN0ZVwiLHtwYXJlbnQ6ZS5pZCxub2RlOm4sbW9kZTphfSksbj0hMSxhPSExLHZvaWQobz0hMSkpOiExfSxjbGVhcl9idWZmZXI6ZnVuY3Rpb24oKXtuPSExLGE9ITEsbz0hMSx0aGlzLnRyaWdnZXIoXCJjbGVhcl9idWZmZXJcIil9LGVkaXQ6ZnVuY3Rpb24odCxpLHIpe3ZhciBzLG4sYSxvLGQsYyxsLGgsXyx1PSExO3JldHVybih0PXRoaXMuZ2V0X25vZGUodCkpP3RoaXMuc2V0dGluZ3MuY29yZS5jaGVja19jYWxsYmFjaz09PSExPyh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDdcIixyZWFzb246XCJDb3VsZCBub3QgZWRpdCBub2RlIGJlY2F1c2Ugb2YgY2hlY2tfY2FsbGJhY2tcIn0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITEpOihfPXQsaT1cInN0cmluZ1wiPT10eXBlb2YgaT9pOnQudGV4dCx0aGlzLnNldF90ZXh0KHQsXCJcIiksdD10aGlzLl9vcGVuX3RvKHQpLF8udGV4dD1pLHM9dGhpcy5fZGF0YS5jb3JlLnJ0bCxuPXRoaXMuZWxlbWVudC53aWR0aCgpLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPV8uaWQsYT10LmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSxvPWUoXCI8c3Bhbj5cIiksZD1pLGM9ZShcIjxkaXYgLz5cIix7Y3NzOntwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiLTIwMHB4XCIsbGVmdDpzP1wiMHB4XCI6XCItMTAwMHB4XCIsdmlzaWJpbGl0eTpcImhpZGRlblwifX0pLmFwcGVuZFRvKFwiYm9keVwiKSxsPWUoXCI8aW5wdXQgLz5cIix7dmFsdWU6ZCxcImNsYXNzXCI6XCJqc3RyZWUtcmVuYW1lLWlucHV0XCIsY3NzOntwYWRkaW5nOlwiMFwiLGJvcmRlcjpcIjFweCBzb2xpZCBzaWx2ZXJcIixcImJveC1zaXppbmdcIjpcImJvcmRlci1ib3hcIixkaXNwbGF5OlwiaW5saW5lLWJsb2NrXCIsaGVpZ2h0OnRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQrXCJweFwiLGxpbmVIZWlnaHQ6dGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCtcInB4XCIsd2lkdGg6XCIxNTBweFwifSxibHVyOmUucHJveHkoZnVuY3Rpb24oaSl7aS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSxpLnByZXZlbnREZWZhdWx0KCk7dmFyIHMsbj1vLmNoaWxkcmVuKFwiLmpzdHJlZS1yZW5hbWUtaW5wdXRcIiksbD1uLnZhbCgpLGg9dGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQ7XCJcIj09PWwmJihsPWQpLGMucmVtb3ZlKCksby5yZXBsYWNlV2l0aChhKSxvLnJlbW92ZSgpLGQ9aD9kOmUoXCI8ZGl2PjwvZGl2PlwiKS5hcHBlbmQoZS5wYXJzZUhUTUwoZCkpLmh0bWwoKSx0aGlzLnNldF90ZXh0KHQsZCkscz0hIXRoaXMucmVuYW1lX25vZGUodCxoP2UoXCI8ZGl2PjwvZGl2PlwiKS50ZXh0KGwpLnRleHQoKTplKFwiPGRpdj48L2Rpdj5cIikuYXBwZW5kKGUucGFyc2VIVE1MKGwpKS5odG1sKCkpLHN8fHRoaXMuc2V0X3RleHQodCxkKSx0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1fLmlkLHNldFRpbWVvdXQoZS5wcm94eShmdW5jdGlvbigpe3ZhciBlPXRoaXMuZ2V0X25vZGUoXy5pZCwhMCk7ZS5sZW5ndGgmJih0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1fLmlkLGUuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpKX0sdGhpcyksMCksciYmci5jYWxsKHRoaXMsXyxzLHUpfSx0aGlzKSxrZXlkb3duOmZ1bmN0aW9uKGUpe3ZhciB0PWUud2hpY2g7Mjc9PT10JiYodT0hMCx0aGlzLnZhbHVlPWQpLCgyNz09PXR8fDEzPT09dHx8Mzc9PT10fHwzOD09PXR8fDM5PT09dHx8NDA9PT10fHwzMj09PXQpJiZlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLCgyNz09PXR8fDEzPT09dCkmJihlLnByZXZlbnREZWZhdWx0KCksdGhpcy5ibHVyKCkpfSxjbGljazpmdW5jdGlvbihlKXtlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfSxtb3VzZWRvd246ZnVuY3Rpb24oZSl7ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKX0sa2V5dXA6ZnVuY3Rpb24oZSl7bC53aWR0aChNYXRoLm1pbihjLnRleHQoXCJwV1wiK3RoaXMudmFsdWUpLndpZHRoKCksbikpfSxrZXlwcmVzczpmdW5jdGlvbihlKXtyZXR1cm4gMTM9PT1lLndoaWNoPyExOnZvaWQgMH19KSxoPXtmb250RmFtaWx5OmEuY3NzKFwiZm9udEZhbWlseVwiKXx8XCJcIixmb250U2l6ZTphLmNzcyhcImZvbnRTaXplXCIpfHxcIlwiLGZvbnRXZWlnaHQ6YS5jc3MoXCJmb250V2VpZ2h0XCIpfHxcIlwiLGZvbnRTdHlsZTphLmNzcyhcImZvbnRTdHlsZVwiKXx8XCJcIixmb250U3RyZXRjaDphLmNzcyhcImZvbnRTdHJldGNoXCIpfHxcIlwiLGZvbnRWYXJpYW50OmEuY3NzKFwiZm9udFZhcmlhbnRcIil8fFwiXCIsbGV0dGVyU3BhY2luZzphLmNzcyhcImxldHRlclNwYWNpbmdcIil8fFwiXCIsd29yZFNwYWNpbmc6YS5jc3MoXCJ3b3JkU3BhY2luZ1wiKXx8XCJcIn0sby5hdHRyKFwiY2xhc3NcIixhLmF0dHIoXCJjbGFzc1wiKSkuYXBwZW5kKGEuY29udGVudHMoKS5jbG9uZSgpKS5hcHBlbmQobCksYS5yZXBsYWNlV2l0aChvKSxjLmNzcyhoKSx2b2lkIGwuY3NzKGgpLndpZHRoKE1hdGgubWluKGMudGV4dChcInBXXCIrbFswXS52YWx1ZSkud2lkdGgoKSxuKSlbMF0uc2VsZWN0KCkpOiExfSxzZXRfdGhlbWU6ZnVuY3Rpb24odCxpKXtpZighdClyZXR1cm4hMTtpZihpPT09ITApe3ZhciByPXRoaXMuc2V0dGluZ3MuY29yZS50aGVtZXMuZGlyO3J8fChyPWUuanN0cmVlLnBhdGgrXCIvdGhlbWVzXCIpLGk9citcIi9cIit0K1wiL3N0eWxlLmNzc1wifWkmJi0xPT09ZS5pbkFycmF5KGksZCkmJihlKFwiaGVhZFwiKS5hcHBlbmQoJzxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiJytpKydcIiB0eXBlPVwidGV4dC9jc3NcIiAvPicpLGQucHVzaChpKSksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lKSxcbnRoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZT10LHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1cIit0KSx0aGlzLmVsZW1lbnRbdGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lcy5yZXNwb25zaXZlP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLVwiK3QrXCItcmVzcG9uc2l2ZVwiKSx0aGlzLnRyaWdnZXIoXCJzZXRfdGhlbWVcIix7dGhlbWU6dH0pfSxnZXRfdGhlbWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lfSxzZXRfdGhlbWVfdmFyaWFudDpmdW5jdGlvbihlKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImpzdHJlZS1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWUrXCItXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50KSx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQ9ZSxlJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJqc3RyZWUtXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lK1wiLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudCl9LGdldF90aGVtZV92YXJpYW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudH0sc2hvd19zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLXN0cmlwZWRcIil9LGhpZGVfc3RyaXBlczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1zdHJpcGVkXCIpfSx0b2dnbGVfc3RyaXBlczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz90aGlzLmhpZGVfc3RyaXBlcygpOnRoaXMuc2hvd19zdHJpcGVzKCl9LHNob3dfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz0hMCx0aGlzLmdldF9jb250YWluZXJfdWwoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1uby1kb3RzXCIpfSxoaWRlX2RvdHM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM9ITEsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkuYWRkQ2xhc3MoXCJqc3RyZWUtbm8tZG90c1wiKX0sdG9nZ2xlX2RvdHM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM/dGhpcy5oaWRlX2RvdHMoKTp0aGlzLnNob3dfZG90cygpfSxzaG93X2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz0hMCx0aGlzLmdldF9jb250YWluZXJfdWwoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1uby1pY29uc1wiKX0saGlkZV9pY29uczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuaWNvbnM9ITEsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkuYWRkQ2xhc3MoXCJqc3RyZWUtbm8taWNvbnNcIil9LHRvZ2dsZV9pY29uczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuaWNvbnM/dGhpcy5oaWRlX2ljb25zKCk6dGhpcy5zaG93X2ljb25zKCl9LHNldF9pY29uOmZ1bmN0aW9uKGkscil7dmFyIHMsbixhLG87aWYoZS5pc0FycmF5KGkpKXtmb3IoaT1pLnNsaWNlKCkscz0wLG49aS5sZW5ndGg7bj5zO3MrKyl0aGlzLnNldF9pY29uKGlbc10scik7cmV0dXJuITB9cmV0dXJuIGk9dGhpcy5nZXRfbm9kZShpKSxpJiZpLmlkIT09ZS5qc3RyZWUucm9vdD8obz1pLmljb24saS5pY29uPXI9PT0hMHx8bnVsbD09PXJ8fHI9PT10fHxcIlwiPT09cj8hMDpyLGE9dGhpcy5nZXRfbm9kZShpLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikscj09PSExP3RoaXMuaGlkZV9pY29uKGkpOnI9PT0hMHx8bnVsbD09PXJ8fHI9PT10fHxcIlwiPT09cj8oYS5yZW1vdmVDbGFzcyhcImpzdHJlZS10aGVtZWljb24tY3VzdG9tIFwiK28pLmNzcyhcImJhY2tncm91bmRcIixcIlwiKS5yZW1vdmVBdHRyKFwicmVsXCIpLG89PT0hMSYmdGhpcy5zaG93X2ljb24oaSkpOi0xPT09ci5pbmRleE9mKFwiL1wiKSYmLTE9PT1yLmluZGV4T2YoXCIuXCIpPyhhLnJlbW92ZUNsYXNzKG8pLmNzcyhcImJhY2tncm91bmRcIixcIlwiKSxhLmFkZENsYXNzKHIrXCIganN0cmVlLXRoZW1laWNvbi1jdXN0b21cIikuYXR0cihcInJlbFwiLHIpLG89PT0hMSYmdGhpcy5zaG93X2ljb24oaSkpOihhLnJlbW92ZUNsYXNzKG8pLmNzcyhcImJhY2tncm91bmRcIixcIlwiKSxhLmFkZENsYXNzKFwianN0cmVlLXRoZW1laWNvbi1jdXN0b21cIikuY3NzKFwiYmFja2dyb3VuZFwiLFwidXJsKCdcIityK1wiJykgY2VudGVyIGNlbnRlciBuby1yZXBlYXRcIikuYXR0cihcInJlbFwiLHIpLG89PT0hMSYmdGhpcy5zaG93X2ljb24oaSkpLCEwKTohMX0sZ2V0X2ljb246ZnVuY3Rpb24odCl7cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD90Lmljb246ITF9LGhpZGVfaWNvbjpmdW5jdGlvbih0KXt2YXIgaSxyO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLGk9MCxyPXQubGVuZ3RoO3I+aTtpKyspdGhpcy5oaWRlX2ljb24odFtpXSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0IT09ZS5qc3RyZWUucm9vdD8odC5pY29uPSExLHRoaXMuZ2V0X25vZGUodCwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLmFkZENsYXNzKFwianN0cmVlLXRoZW1laWNvbi1oaWRkZW5cIiksITApOiExfSxzaG93X2ljb246ZnVuY3Rpb24odCl7dmFyIGkscixzO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLGk9MCxyPXQubGVuZ3RoO3I+aTtpKyspdGhpcy5zaG93X2ljb24odFtpXSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0IT09ZS5qc3RyZWUucm9vdD8ocz10aGlzLmdldF9ub2RlKHQsITApLHQuaWNvbj1zLmxlbmd0aD9zLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKS5hdHRyKFwicmVsXCIpOiEwLHQuaWNvbnx8KHQuaWNvbj0hMCkscy5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKSwhMCk6ITF9fSxlLnZha2F0YT17fSxlLnZha2F0YS5hdHRyaWJ1dGVzPWZ1bmN0aW9uKHQsaSl7dD1lKHQpWzBdO3ZhciByPWk/e306W107cmV0dXJuIHQmJnQuYXR0cmlidXRlcyYmZS5lYWNoKHQuYXR0cmlidXRlcyxmdW5jdGlvbih0LHMpey0xPT09ZS5pbkFycmF5KHMubmFtZS50b0xvd2VyQ2FzZSgpLFtcInN0eWxlXCIsXCJjb250ZW50ZWRpdGFibGVcIixcImhhc2ZvY3VzXCIsXCJ0YWJpbmRleFwiXSkmJm51bGwhPT1zLnZhbHVlJiZcIlwiIT09ZS50cmltKHMudmFsdWUpJiYoaT9yW3MubmFtZV09cy52YWx1ZTpyLnB1c2gocy5uYW1lKSl9KSxyfSxlLnZha2F0YS5hcnJheV91bmlxdWU9ZnVuY3Rpb24oZSl7dmFyIGkscixzPVtdLG49e307Zm9yKGk9MCxyPWUubGVuZ3RoO3I+aTtpKyspbltlW2ldXT09PXQmJihzLnB1c2goZVtpXSksbltlW2ldXT0hMCk7cmV0dXJuIHN9LGUudmFrYXRhLmFycmF5X3JlbW92ZT1mdW5jdGlvbihlLHQsaSl7dmFyIHI9ZS5zbGljZSgoaXx8dCkrMXx8ZS5sZW5ndGgpO3JldHVybiBlLmxlbmd0aD0wPnQ/ZS5sZW5ndGgrdDp0LGUucHVzaC5hcHBseShlLHIpLGV9LGUudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtPWZ1bmN0aW9uKHQsaSl7dmFyIHI9ZS5pbkFycmF5KGksdCk7cmV0dXJuLTEhPT1yP2UudmFrYXRhLmFycmF5X3JlbW92ZSh0LHIpOnR9LGUuanN0cmVlLnBsdWdpbnMuY2hhbmdlZD1mdW5jdGlvbihlLHQpe3ZhciBpPVtdO3RoaXMudHJpZ2dlcj1mdW5jdGlvbihlLHIpe3ZhciBzLG47aWYocnx8KHI9e30pLFwiY2hhbmdlZFwiPT09ZS5yZXBsYWNlKFwiLmpzdHJlZVwiLFwiXCIpKXtyLmNoYW5nZWQ9e3NlbGVjdGVkOltdLGRlc2VsZWN0ZWQ6W119O3ZhciBhPXt9O2ZvcihzPTAsbj1pLmxlbmd0aDtuPnM7cysrKWFbaVtzXV09MTtmb3Iocz0wLG49ci5zZWxlY3RlZC5sZW5ndGg7bj5zO3MrKylhW3Iuc2VsZWN0ZWRbc11dP2Fbci5zZWxlY3RlZFtzXV09MjpyLmNoYW5nZWQuc2VsZWN0ZWQucHVzaChyLnNlbGVjdGVkW3NdKTtmb3Iocz0wLG49aS5sZW5ndGg7bj5zO3MrKykxPT09YVtpW3NdXSYmci5jaGFuZ2VkLmRlc2VsZWN0ZWQucHVzaChpW3NdKTtpPXIuc2VsZWN0ZWQuc2xpY2UoKX10LnRyaWdnZXIuY2FsbCh0aGlzLGUscil9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihlLHIpe3JldHVybiBpPVtdLHQucmVmcmVzaC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fTt2YXIgXz1sLmNyZWF0ZUVsZW1lbnQoXCJJXCIpO18uY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLWNoZWNrYm94XCIsXy5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksZS5qc3RyZWUuZGVmYXVsdHMuY2hlY2tib3g9e3Zpc2libGU6ITAsdGhyZWVfc3RhdGU6ITAsd2hvbGVfbm9kZTohMCxrZWVwX3NlbGVjdGVkX3N0eWxlOiEwLGNhc2NhZGU6XCJcIix0aWVfc2VsZWN0aW9uOiEwfSxlLmpzdHJlZS5wbHVnaW5zLmNoZWNrYm94PWZ1bmN0aW9uKGkscil7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ci5iaW5kLmNhbGwodGhpcyksdGhpcy5fZGF0YS5jaGVja2JveC51dG89ITEsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRocmVlX3N0YXRlJiYodGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlPVwidXArZG93bit1bmRldGVybWluZWRcIiksdGhpcy5lbGVtZW50Lm9uKFwiaW5pdC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jaGVja2JveC52aXNpYmxlPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudmlzaWJsZSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LmtlZXBfc2VsZWN0ZWRfc3R5bGV8fHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1uby1jbGlja2VkXCIpLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LXNlbGVjdGlvblwiKX0sdGhpcykpLm9uKFwibG9hZGluZy5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dGhpc1t0aGlzLl9kYXRhLmNoZWNrYm94LnZpc2libGU/XCJzaG93X2NoZWNrYm94ZXNcIjpcImhpZGVfY2hlY2tib3hlc1wiXSgpfSx0aGlzKSksLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVuZGV0ZXJtaW5lZFwiKSYmdGhpcy5lbGVtZW50Lm9uKFwiY2hhbmdlZC5qc3RyZWUgdW5jaGVja19ub2RlLmpzdHJlZSBjaGVja19ub2RlLmpzdHJlZSB1bmNoZWNrX2FsbC5qc3RyZWUgY2hlY2tfYWxsLmpzdHJlZSBtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUgcmVkcmF3LmpzdHJlZSBvcGVuX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY2hlY2tib3gudXRvJiZjbGVhclRpbWVvdXQodGhpcy5fZGF0YS5jaGVja2JveC51dG8pLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPXNldFRpbWVvdXQoZS5wcm94eSh0aGlzLl91bmRldGVybWluZWQsdGhpcyksNTApfSx0aGlzKSksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHx0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dmFyIGkscixzPXRoaXMuX21vZGVsLmRhdGEsbj0oc1t0LnBhcmVudF0sdC5ub2Rlcyk7Zm9yKGk9MCxyPW4ubGVuZ3RoO3I+aTtpKyspc1tuW2ldXS5zdGF0ZS5jaGVja2VkPXNbbltpXV0uc3RhdGUuY2hlY2tlZHx8c1tuW2ldXS5vcmlnaW5hbCYmc1tuW2ldXS5vcmlnaW5hbC5zdGF0ZSYmc1tuW2ldXS5vcmlnaW5hbC5zdGF0ZS5jaGVja2VkLHNbbltpXV0uc3RhdGUuY2hlY2tlZCYmdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5wdXNoKG5baV0pfSx0aGlzKSksKC0xIT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1cFwiKXx8LTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcImRvd25cIikpJiZ0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7dmFyIHIscyxuLGEsbyxkLGM9dGhpcy5fbW9kZWwuZGF0YSxsPWNbaS5wYXJlbnRdLGg9aS5ub2RlcyxfPVtdLHU9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLGc9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uO2lmKC0xIT09dS5pbmRleE9mKFwiZG93blwiKSlpZihsLnN0YXRlW2c/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKHM9MCxuPWgubGVuZ3RoO24+cztzKyspY1toW3NdXS5zdGF0ZVtnP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITA7dGhpcy5fZGF0YVtnP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9dGhpcy5fZGF0YVtnP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQuY29uY2F0KGgpfWVsc2UgZm9yKHM9MCxuPWgubGVuZ3RoO24+cztzKyspaWYoY1toW3NdXS5zdGF0ZVtnP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl0pe2ZvcihhPTAsbz1jW2hbc11dLmNoaWxkcmVuX2QubGVuZ3RoO28+YTthKyspY1tjW2hbc11dLmNoaWxkcmVuX2RbYV1dLnN0YXRlW2c/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMDt0aGlzLl9kYXRhW2c/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD10aGlzLl9kYXRhW2c/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5jb25jYXQoY1toW3NdXS5jaGlsZHJlbl9kKX1pZigtMSE9PXUuaW5kZXhPZihcInVwXCIpKXtmb3Iocz0wLG49bC5jaGlsZHJlbl9kLmxlbmd0aDtuPnM7cysrKWNbbC5jaGlsZHJlbl9kW3NdXS5jaGlsZHJlbi5sZW5ndGh8fF8ucHVzaChjW2wuY2hpbGRyZW5fZFtzXV0ucGFyZW50KTtmb3IoXz1lLnZha2F0YS5hcnJheV91bmlxdWUoXyksYT0wLG89Xy5sZW5ndGg7bz5hO2ErKylmb3IobD1jW19bYV1dO2wmJmwuaWQhPT1lLmpzdHJlZS5yb290Oyl7Zm9yKHI9MCxzPTAsbj1sLmNoaWxkcmVuLmxlbmd0aDtuPnM7cysrKXIrPWNbbC5jaGlsZHJlbltzXV0uc3RhdGVbZz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKHIhPT1uKWJyZWFrO2wuc3RhdGVbZz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLHRoaXMuX2RhdGFbZz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLnB1c2gobC5pZCksZD10aGlzLmdldF9ub2RlKGwsITApLGQmJmQubGVuZ3RoJiZkLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoZz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSxsPXRoaXMuZ2V0X25vZGUobC5wYXJlbnQpfX10aGlzLl9kYXRhW2c/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1lLnZha2F0YS5hcnJheV91bmlxdWUodGhpcy5fZGF0YVtnP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQpfSx0aGlzKSkub24odGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP1wic2VsZWN0X25vZGUuanN0cmVlXCI6XCJjaGVja19ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24odCxpKXt2YXIgcixzLG4sYSxvPWkubm9kZSxkPXRoaXMuX21vZGVsLmRhdGEsYz10aGlzLmdldF9ub2RlKG8ucGFyZW50KSxsPXRoaXMuZ2V0X25vZGUobywhMCksaD10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUsXz10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoLTEhPT1oLmluZGV4T2YoXCJkb3duXCIpKWZvcih0aGlzLl9kYXRhW18/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1lLnZha2F0YS5hcnJheV91bmlxdWUodGhpcy5fZGF0YVtfP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQuY29uY2F0KG8uY2hpbGRyZW5fZCkpLHI9MCxzPW8uY2hpbGRyZW5fZC5sZW5ndGg7cz5yO3IrKylhPWRbby5jaGlsZHJlbl9kW3JdXSxhLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCxhJiZhLm9yaWdpbmFsJiZhLm9yaWdpbmFsLnN0YXRlJiZhLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGEub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKTtpZigtMSE9PWguaW5kZXhPZihcInVwXCIpKWZvcig7YyYmYy5pZCE9PWUuanN0cmVlLnJvb3Q7KXtmb3Iobj0wLHI9MCxzPWMuY2hpbGRyZW4ubGVuZ3RoO3M+cjtyKyspbis9ZFtjLmNoaWxkcmVuW3JdXS5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYobiE9PXMpYnJlYWs7Yy5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVtfP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChjLmlkKSxhPXRoaXMuZ2V0X25vZGUoYywhMCksYSYmYS5sZW5ndGgmJmEuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhfP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGM9dGhpcy5nZXRfbm9kZShjLnBhcmVudCl9LTEhPT1oLmluZGV4T2YoXCJkb3duXCIpJiZsLmxlbmd0aCYmbC5maW5kKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKS5wYXJlbnQoKS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKX0sdGhpcykpLm9uKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj9cImRlc2VsZWN0X2FsbC5qc3RyZWVcIjpcInVuY2hlY2tfYWxsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24odCxpKXt2YXIgcixzLG4sYT10aGlzLmdldF9ub2RlKGUuanN0cmVlLnJvb3QpLG89dGhpcy5fbW9kZWwuZGF0YTtmb3Iocj0wLHM9YS5jaGlsZHJlbl9kLmxlbmd0aDtzPnI7cisrKW49b1thLmNoaWxkcmVuX2Rbcl1dLG4mJm4ub3JpZ2luYWwmJm4ub3JpZ2luYWwuc3RhdGUmJm4ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYobi5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpfSx0aGlzKSkub24odGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP1wiZGVzZWxlY3Rfbm9kZS5qc3RyZWVcIjpcInVuY2hlY2tfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7dmFyIHIscyxuLGE9aS5ub2RlLG89dGhpcy5nZXRfbm9kZShhLCEwKSxkPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxjPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjtpZihhJiZhLm9yaWdpbmFsJiZhLm9yaWdpbmFsLnN0YXRlJiZhLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGEub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKSwtMSE9PWQuaW5kZXhPZihcImRvd25cIikpZm9yKHI9MCxzPWEuY2hpbGRyZW5fZC5sZW5ndGg7cz5yO3IrKyluPXRoaXMuX21vZGVsLmRhdGFbYS5jaGlsZHJlbl9kW3JdXSxuLnN0YXRlW2M/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSxuJiZuLm9yaWdpbmFsJiZuLm9yaWdpbmFsLnN0YXRlJiZuLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKG4ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKTtpZigtMSE9PWQuaW5kZXhPZihcInVwXCIpKWZvcihyPTAscz1hLnBhcmVudHMubGVuZ3RoO3M+cjtyKyspbj10aGlzLl9tb2RlbC5kYXRhW2EucGFyZW50c1tyXV0sbi5zdGF0ZVtjP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITEsbiYmbi5vcmlnaW5hbCYmbi5vcmlnaW5hbC5zdGF0ZSYmbi5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihuLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSksbj10aGlzLmdldF9ub2RlKGEucGFyZW50c1tyXSwhMCksbiYmbi5sZW5ndGgmJm4uYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhjP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpO2ZvcihuPVtdLHI9MCxzPXRoaXMuX2RhdGFbYz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLmxlbmd0aDtzPnI7cisrKS0xIT09ZC5pbmRleE9mKFwiZG93blwiKSYmLTEhPT1lLmluQXJyYXkodGhpcy5fZGF0YVtjP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWRbcl0sYS5jaGlsZHJlbl9kKXx8LTEhPT1kLmluZGV4T2YoXCJ1cFwiKSYmLTEhPT1lLmluQXJyYXkodGhpcy5fZGF0YVtjP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWRbcl0sYS5wYXJlbnRzKXx8bi5wdXNoKHRoaXMuX2RhdGFbYz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkW3JdKTt0aGlzLl9kYXRhW2M/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1lLnZha2F0YS5hcnJheV91bmlxdWUobiksLTEhPT1kLmluZGV4T2YoXCJkb3duXCIpJiZvLmxlbmd0aCYmby5maW5kKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoYz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKS5wYXJlbnQoKS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKX0sdGhpcykpLC0xIT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1cFwiKSYmdGhpcy5lbGVtZW50Lm9uKFwiZGVsZXRlX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe2Zvcih2YXIgcixzLG4sYSxvPXRoaXMuZ2V0X25vZGUoaS5wYXJlbnQpLGQ9dGhpcy5fbW9kZWwuZGF0YSxjPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjtvJiZvLmlkIT09ZS5qc3RyZWUucm9vdCYmIW8uc3RhdGVbYz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdOyl7Zm9yKG49MCxyPTAscz1vLmNoaWxkcmVuLmxlbmd0aDtzPnI7cisrKW4rPWRbby5jaGlsZHJlbltyXV0uc3RhdGVbYz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKCEocz4wJiZuPT09cykpYnJlYWs7by5zdGF0ZVtjP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVtjP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChvLmlkKSxhPXRoaXMuZ2V0X25vZGUobywhMCksYSYmYS5sZW5ndGgmJmEuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhjP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLG89dGhpcy5nZXRfbm9kZShvLnBhcmVudCl9fSx0aGlzKSkub24oXCJtb3ZlX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe3ZhciByLHMsbixhLG8sZD1pLmlzX211bHRpLGM9aS5vbGRfcGFyZW50LGw9dGhpcy5nZXRfbm9kZShpLnBhcmVudCksaD10aGlzLl9tb2RlbC5kYXRhLF89dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uO2lmKCFkKWZvcihyPXRoaXMuZ2V0X25vZGUoYyk7ciYmci5pZCE9PWUuanN0cmVlLnJvb3QmJiFyLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXTspe2ZvcihzPTAsbj0wLGE9ci5jaGlsZHJlbi5sZW5ndGg7YT5uO24rKylzKz1oW3IuY2hpbGRyZW5bbl1dLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXTtpZighKGE+MCYmcz09PWEpKWJyZWFrO3Iuc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLHRoaXMuX2RhdGFbXz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLnB1c2goci5pZCksbz10aGlzLmdldF9ub2RlKHIsITApLG8mJm8ubGVuZ3RoJiZvLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSxyPXRoaXMuZ2V0X25vZGUoci5wYXJlbnQpfWZvcihyPWw7ciYmci5pZCE9PWUuanN0cmVlLnJvb3Q7KXtmb3Iocz0wLG49MCxhPXIuY2hpbGRyZW4ubGVuZ3RoO2E+bjtuKyspcys9aFtyLmNoaWxkcmVuW25dXS5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYocz09PWEpci5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl18fChyLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW18/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKHIuaWQpLG89dGhpcy5nZXRfbm9kZShyLCEwKSxvJiZvLmxlbmd0aCYmby5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKF8/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikpO2Vsc2V7aWYoIXIuc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKWJyZWFrO3Iuc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSExLHRoaXMuX2RhdGFbXz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGFbXz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLHIuaWQpLG89dGhpcy5nZXRfbm9kZShyLCEwKSxvJiZvLmxlbmd0aCYmby5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKF8/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIil9cj10aGlzLmdldF9ub2RlKHIucGFyZW50KX19LHRoaXMpKX0sdGhpcy5fdW5kZXRlcm1pbmVkPWZ1bmN0aW9uKCl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7dmFyIGkscixzLG4sYT17fSxvPXRoaXMuX21vZGVsLmRhdGEsZD10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24sYz10aGlzLl9kYXRhW2Q/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxsPVtdLGg9dGhpcztmb3IoaT0wLHI9Yy5sZW5ndGg7cj5pO2krKylpZihvW2NbaV1dJiZvW2NbaV1dLnBhcmVudHMpZm9yKHM9MCxuPW9bY1tpXV0ucGFyZW50cy5sZW5ndGg7bj5zO3MrKylhW29bY1tpXV0ucGFyZW50c1tzXV09PT10JiZvW2NbaV1dLnBhcmVudHNbc10hPT1lLmpzdHJlZS5yb290JiYoYVtvW2NbaV1dLnBhcmVudHNbc11dPSEwLGwucHVzaChvW2NbaV1dLnBhcmVudHNbc10pKTtmb3IodGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5ub3QoXCI6aGFzKC5qc3RyZWUtY2hpbGRyZW4pXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgZCxjPWguZ2V0X25vZGUodGhpcyk7aWYoYy5zdGF0ZS5sb2FkZWQpe2ZvcihpPTAscj1jLmNoaWxkcmVuX2QubGVuZ3RoO3I+aTtpKyspaWYoZD1vW2MuY2hpbGRyZW5fZFtpXV0sIWQuc3RhdGUubG9hZGVkJiZkLm9yaWdpbmFsJiZkLm9yaWdpbmFsLnN0YXRlJiZkLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmZC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9PT0hMClmb3IoYVtkLmlkXT09PXQmJmQuaWQhPT1lLmpzdHJlZS5yb290JiYoYVtkLmlkXT0hMCxsLnB1c2goZC5pZCkpLHM9MCxuPWQucGFyZW50cy5sZW5ndGg7bj5zO3MrKylhW2QucGFyZW50c1tzXV09PT10JiZkLnBhcmVudHNbc10hPT1lLmpzdHJlZS5yb290JiYoYVtkLnBhcmVudHNbc11dPSEwLGwucHVzaChkLnBhcmVudHNbc10pKX1lbHNlIGlmKGMub3JpZ2luYWwmJmMub3JpZ2luYWwuc3RhdGUmJmMub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiZjLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD09PSEwKWZvcihhW2MuaWRdPT09dCYmYy5pZCE9PWUuanN0cmVlLnJvb3QmJihhW2MuaWRdPSEwLGwucHVzaChjLmlkKSkscz0wLG49Yy5wYXJlbnRzLmxlbmd0aDtuPnM7cysrKWFbYy5wYXJlbnRzW3NdXT09PXQmJmMucGFyZW50c1tzXSE9PWUuanN0cmVlLnJvb3QmJihhW2MucGFyZW50c1tzXV09ITAsbC5wdXNoKGMucGFyZW50c1tzXSkpfSksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLXVuZGV0ZXJtaW5lZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS11bmRldGVybWluZWRcIiksaT0wLHI9bC5sZW5ndGg7cj5pO2krKylvW2xbaV1dLnN0YXRlW2Q/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXXx8KGM9dGhpcy5nZXRfbm9kZShsW2ldLCEwKSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5hZGRDbGFzcyhcImpzdHJlZS11bmRldGVybWluZWRcIikpfX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbih0LGkscyxuKXtpZih0PXIucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpKXt2YXIgYSxvLGQ9bnVsbCxjPW51bGw7Zm9yKGE9MCxvPXQuY2hpbGROb2Rlcy5sZW5ndGg7bz5hO2ErKylpZih0LmNoaWxkTm9kZXNbYV0mJnQuY2hpbGROb2Rlc1thXS5jbGFzc05hbWUmJi0xIT09dC5jaGlsZE5vZGVzW2FdLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7ZD10LmNoaWxkTm9kZXNbYV07YnJlYWt9ZCYmKCF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJnRoaXMuX21vZGVsLmRhdGFbdC5pZF0uc3RhdGUuY2hlY2tlZCYmKGQuY2xhc3NOYW1lKz1cIiBqc3RyZWUtY2hlY2tlZFwiKSxjPV8uY2xvbmVOb2RlKCExKSx0aGlzLl9tb2RlbC5kYXRhW3QuaWRdLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkJiYoYy5jbGFzc05hbWUrPVwiIGpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSxkLmluc2VydEJlZm9yZShjLGQuY2hpbGROb2Rlc1swXSkpfXJldHVybiBzfHwtMT09PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwidW5kZXRlcm1pbmVkXCIpfHwodGhpcy5fZGF0YS5jaGVja2JveC51dG8mJmNsZWFyVGltZW91dCh0aGlzLl9kYXRhLmNoZWNrYm94LnV0byksdGhpcy5fZGF0YS5jaGVja2JveC51dG89c2V0VGltZW91dChlLnByb3h5KHRoaXMuX3VuZGV0ZXJtaW5lZCx0aGlzKSw1MCkpLHR9LHRoaXMuc2hvd19jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWNoZWNrYm94ZXNcIil9LHRoaXMuaGlkZV9jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWNoZWNrYm94ZXNcIil9LHRoaXMudG9nZ2xlX2NoZWNrYm94ZXM9ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmNoZWNrYm94ZXM/dGhpcy5oaWRlX2NoZWNrYm94ZXMoKTp0aGlzLnNob3dfY2hlY2tib3hlcygpfSx0aGlzLmlzX3VuZGV0ZXJtaW5lZD1mdW5jdGlvbih0KXt0PXRoaXMuZ2V0X25vZGUodCk7dmFyIGkscixzPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxuPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbixhPXRoaXMuX2RhdGFbbj9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLG89dGhpcy5fbW9kZWwuZGF0YTtpZighdHx8dC5zdGF0ZVtuP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09PT0hMHx8LTE9PT1zLmluZGV4T2YoXCJ1bmRldGVybWluZWRcIil8fC0xPT09cy5pbmRleE9mKFwiZG93blwiKSYmLTE9PT1zLmluZGV4T2YoXCJ1cFwiKSlyZXR1cm4hMTtpZighdC5zdGF0ZS5sb2FkZWQmJnQub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPT09ITApcmV0dXJuITA7Zm9yKGk9MCxyPXQuY2hpbGRyZW5fZC5sZW5ndGg7cj5pO2krKylpZigtMSE9PWUuaW5BcnJheSh0LmNoaWxkcmVuX2RbaV0sYSl8fCFvW3QuY2hpbGRyZW5fZFtpXV0uc3RhdGUubG9hZGVkJiZvW3QuY2hpbGRyZW5fZFtpXV0ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkKXJldHVybiEwO3JldHVybiExfSx0aGlzLmRpc2FibGVfY2hlY2tib3g9ZnVuY3Rpb24odCl7dmFyIGkscixzO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLGk9MCxyPXQubGVuZ3RoO3I+aTtpKyspdGhpcy5kaXNhYmxlX2NoZWNrYm94KHRbaV0pO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KHM9dGhpcy5nZXRfbm9kZSh0LCEwKSx2b2lkKHQuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWR8fCh0LnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkPSEwLHMmJnMubGVuZ3RoJiZzLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLHRoaXMudHJpZ2dlcihcImRpc2FibGVfY2hlY2tib3hcIix7bm9kZTp0fSkpKSk6ITF9LHRoaXMuZW5hYmxlX2NoZWNrYm94PWZ1bmN0aW9uKHQpe3ZhciBpLHIscztpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxpPTAscj10Lmxlbmd0aDtyPmk7aSsrKXRoaXMuZW5hYmxlX2NoZWNrYm94KHRbaV0pO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KHM9dGhpcy5nZXRfbm9kZSh0LCEwKSx2b2lkKHQuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWQmJih0LnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkPSExLHMmJnMubGVuZ3RoJiZzLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLHRoaXMudHJpZ2dlcihcImVuYWJsZV9jaGVja2JveFwiLHtub2RlOnR9KSkpKTohMX0sdGhpcy5hY3RpdmF0ZV9ub2RlPWZ1bmN0aW9uKHQsaSl7cmV0dXJuIGUoaS50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpPyExOih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJih0aGlzLnNldHRpbmdzLmNoZWNrYm94Lndob2xlX25vZGV8fGUoaS50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94XCIpKSYmKGkuY3RybEtleT0hMCksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHwhdGhpcy5zZXR0aW5ncy5jaGVja2JveC53aG9sZV9ub2RlJiYhZShpLnRhcmdldCkuaGFzQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3hcIik/ci5hY3RpdmF0ZV9ub2RlLmNhbGwodGhpcyx0LGkpOnRoaXMuaXNfZGlzYWJsZWQodCk/ITE6KHRoaXMuaXNfY2hlY2tlZCh0KT90aGlzLnVuY2hlY2tfbm9kZSh0LGkpOnRoaXMuY2hlY2tfbm9kZSh0LGkpLHZvaWQgdGhpcy50cmlnZ2VyKFwiYWN0aXZhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUodCl9KSkpfSx0aGlzLmNoZWNrX25vZGU9ZnVuY3Rpb24odCxpKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuc2VsZWN0X25vZGUodCwhMSwhMCxpKTt2YXIgcixzLG47aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCkscz0wLG49dC5sZW5ndGg7bj5zO3MrKyl0aGlzLmNoZWNrX25vZGUodFtzXSxpKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290PyhyPXRoaXMuZ2V0X25vZGUodCwhMCksdm9pZCh0LnN0YXRlLmNoZWNrZWR8fCh0LnN0YXRlLmNoZWNrZWQ9ITAsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5wdXNoKHQuaWQpLHImJnIubGVuZ3RoJiZyLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJjaGVja19ub2RlXCIse25vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGV2ZW50Oml9KSkpKTohMX0sdGhpcy51bmNoZWNrX25vZGU9ZnVuY3Rpb24odCxpKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZGVzZWxlY3Rfbm9kZSh0LCExLGkpO3ZhciByLHMsbjtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxyPTAscz10Lmxlbmd0aDtzPnI7cisrKXRoaXMudW5jaGVja19ub2RlKHRbcl0saSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8obj10aGlzLmdldF9ub2RlKHQsITApLHZvaWQodC5zdGF0ZS5jaGVja2VkJiYodC5zdGF0ZS5jaGVja2VkPSExLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9ZS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCx0LmlkKSxuLmxlbmd0aCYmbi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrZWRcIiksdGhpcy50cmlnZ2VyKFwidW5jaGVja19ub2RlXCIse25vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGV2ZW50Oml9KSkpKTohMX0sdGhpcy5jaGVja19hbGw9ZnVuY3Rpb24oKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuc2VsZWN0X2FsbCgpO3ZhciB0LGk7dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5jb25jYXQoW10pO2Zvcih0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPXRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF0uY2hpbGRyZW5fZC5jb25jYXQoKSx0PTAsaT10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmxlbmd0aDtpPnQ7dCsrKXRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFt0XV0mJih0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbdF1dLnN0YXRlLmNoZWNrZWQ9ITApO3RoaXMucmVkcmF3KCEwKSx0aGlzLnRyaWdnZXIoXCJjaGVja19hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZH0pfSx0aGlzLnVuY2hlY2tfYWxsPWZ1bmN0aW9uKCl7aWYodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXJldHVybiB0aGlzLmRlc2VsZWN0X2FsbCgpO3ZhciBlLHQsaT10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmNvbmNhdChbXSk7Zm9yKGU9MCx0PXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQubGVuZ3RoO3Q+ZTtlKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2VdXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFtlXV0uc3RhdGUuY2hlY2tlZD0hMSk7dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtY2hlY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jaGVja2VkXCIpLHRoaXMudHJpZ2dlcihcInVuY2hlY2tfYWxsXCIse3NlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsbm9kZTppfSl9LHRoaXMuaXNfY2hlY2tlZD1mdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP3RoaXMuaXNfc2VsZWN0ZWQodCk6KHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD90LnN0YXRlLmNoZWNrZWQ6ITEpfSx0aGlzLmdldF9jaGVja2VkPWZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/dGhpcy5nZXRfc2VsZWN0ZWQodCk6dD9lLm1hcCh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoZSl9LHRoaXMpKTp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkfSx0aGlzLmdldF90b3BfY2hlY2tlZD1mdW5jdGlvbih0KXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZ2V0X3RvcF9zZWxlY3RlZCh0KTt2YXIgaSxyLHMsbixhPXRoaXMuZ2V0X2NoZWNrZWQoITApLG89e307Zm9yKGk9MCxyPWEubGVuZ3RoO3I+aTtpKyspb1thW2ldLmlkXT1hW2ldO2ZvcihpPTAscj1hLmxlbmd0aDtyPmk7aSsrKWZvcihzPTAsbj1hW2ldLmNoaWxkcmVuX2QubGVuZ3RoO24+cztzKyspb1thW2ldLmNoaWxkcmVuX2Rbc11dJiZkZWxldGUgb1thW2ldLmNoaWxkcmVuX2Rbc11dO2E9W107Zm9yKGkgaW4gbylvLmhhc093blByb3BlcnR5KGkpJiZhLnB1c2goaSk7cmV0dXJuIHQ/ZS5tYXAoYSxlLnByb3h5KGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmdldF9ub2RlKGUpfSx0aGlzKSk6YX0sdGhpcy5nZXRfYm90dG9tX2NoZWNrZWQ9ZnVuY3Rpb24odCl7aWYodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXJldHVybiB0aGlzLmdldF9ib3R0b21fc2VsZWN0ZWQodCk7dmFyIGkscixzPXRoaXMuZ2V0X2NoZWNrZWQoITApLG49W107Zm9yKGk9MCxyPXMubGVuZ3RoO3I+aTtpKyspc1tpXS5jaGlsZHJlbi5sZW5ndGh8fG4ucHVzaChzW2ldLmlkKTtyZXR1cm4gdD9lLm1hcChuLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoZSl9LHRoaXMpKTpufSx0aGlzLmxvYWRfbm9kZT1mdW5jdGlvbih0LGkpe3ZhciBzLG4sYSxvO2lmKCFlLmlzQXJyYXkodCkmJiF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJihvPXRoaXMuZ2V0X25vZGUodCksbyYmby5zdGF0ZS5sb2FkZWQpKWZvcihzPTAsbj1vLmNoaWxkcmVuX2QubGVuZ3RoO24+cztzKyspdGhpcy5fbW9kZWwuZGF0YVtvLmNoaWxkcmVuX2Rbc11dLnN0YXRlLmNoZWNrZWQmJihhPSEwLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9ZS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxvLmNoaWxkcmVuX2Rbc10pKTtyZXR1cm4gci5sb2FkX25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx0aGlzLmdldF9zdGF0ZT1mdW5jdGlvbigpe3ZhciBlPXIuZ2V0X3N0YXRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP2U6KGUuY2hlY2tib3g9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5zbGljZSgpLGUpfSx0aGlzLnNldF9zdGF0ZT1mdW5jdGlvbih0LGkpe3ZhciBzPXIuc2V0X3N0YXRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihzJiZ0LmNoZWNrYm94KXtpZighdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXt0aGlzLnVuY2hlY2tfYWxsKCk7dmFyIG49dGhpcztlLmVhY2godC5jaGVja2JveCxmdW5jdGlvbihlLHQpe24uY2hlY2tfbm9kZSh0KX0pfXJldHVybiBkZWxldGUgdC5jaGVja2JveCx0aGlzLnNldF9zdGF0ZSh0LGkpLCExfXJldHVybiBzfSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHwodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSksci5yZWZyZXNoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19LGUuanN0cmVlLmRlZmF1bHRzLmNvbmRpdGlvbmFsc2VsZWN0PWZ1bmN0aW9uKCl7cmV0dXJuITB9LGUuanN0cmVlLnBsdWdpbnMuY29uZGl0aW9uYWxzZWxlY3Q9ZnVuY3Rpb24oZSx0KXt0aGlzLmFjdGl2YXRlX25vZGU9ZnVuY3Rpb24oZSxpKXt0aGlzLnNldHRpbmdzLmNvbmRpdGlvbmFsc2VsZWN0LmNhbGwodGhpcyx0aGlzLmdldF9ub2RlKGUpLGkpJiZ0LmFjdGl2YXRlX25vZGUuY2FsbCh0aGlzLGUsaSl9fSxlLmpzdHJlZS5kZWZhdWx0cy5jb250ZXh0bWVudT17c2VsZWN0X25vZGU6ITAsc2hvd19hdF9ub2RlOiEwLGl0ZW1zOmZ1bmN0aW9uKHQsaSl7cmV0dXJue2NyZWF0ZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxzZXBhcmF0b3JfYWZ0ZXI6ITAsX2Rpc2FibGVkOiExLGxhYmVsOlwiQ3JlYXRlXCIsYWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkscj1pLmdldF9ub2RlKHQucmVmZXJlbmNlKTtpLmNyZWF0ZV9ub2RlKHIse30sXCJsYXN0XCIsZnVuY3Rpb24oZSl7c2V0VGltZW91dChmdW5jdGlvbigpe2kuZWRpdChlKX0sMCl9KX19LHJlbmFtZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsX2Rpc2FibGVkOiExLGxhYmVsOlwiUmVuYW1lXCIsYWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkscj1pLmdldF9ub2RlKHQucmVmZXJlbmNlKTtpLmVkaXQocil9fSxyZW1vdmU6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsX2Rpc2FibGVkOiExLGxhYmVsOlwiRGVsZXRlXCIsYWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkscj1pLmdldF9ub2RlKHQucmVmZXJlbmNlKTtpLmlzX3NlbGVjdGVkKHIpP2kuZGVsZXRlX25vZGUoaS5nZXRfc2VsZWN0ZWQoKSk6aS5kZWxldGVfbm9kZShyKX19LGNjcDp7c2VwYXJhdG9yX2JlZm9yZTohMCxpY29uOiExLHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIkVkaXRcIixhY3Rpb246ITEsc3VibWVudTp7Y3V0OntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIkN1dFwiLGFjdGlvbjpmdW5jdGlvbih0KXt2YXIgaT1lLmpzdHJlZS5yZWZlcmVuY2UodC5yZWZlcmVuY2UpLHI9aS5nZXRfbm9kZSh0LnJlZmVyZW5jZSk7aS5pc19zZWxlY3RlZChyKT9pLmN1dChpLmdldF90b3Bfc2VsZWN0ZWQoKSk6aS5jdXQocil9fSxjb3B5OntzZXBhcmF0b3JfYmVmb3JlOiExLGljb246ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiQ29weVwiLGFjdGlvbjpmdW5jdGlvbih0KXt2YXIgaT1lLmpzdHJlZS5yZWZlcmVuY2UodC5yZWZlcmVuY2UpLHI9aS5nZXRfbm9kZSh0LnJlZmVyZW5jZSk7aS5pc19zZWxlY3RlZChyKT9pLmNvcHkoaS5nZXRfdG9wX3NlbGVjdGVkKCkpOmkuY29weShyKX19LHBhc3RlOntzZXBhcmF0b3JfYmVmb3JlOiExLGljb246ITEsX2Rpc2FibGVkOmZ1bmN0aW9uKHQpe3JldHVybiFlLmpzdHJlZS5yZWZlcmVuY2UodC5yZWZlcmVuY2UpLmNhbl9wYXN0ZSgpfSxzZXBhcmF0b3JfYWZ0ZXI6ITEsbGFiZWw6XCJQYXN0ZVwiLGFjdGlvbjpmdW5jdGlvbih0KXt2YXIgaT1lLmpzdHJlZS5yZWZlcmVuY2UodC5yZWZlcmVuY2UpLHI9aS5nZXRfbm9kZSh0LnJlZmVyZW5jZSk7aS5wYXN0ZShyKX19fX19fX0sZS5qc3RyZWUucGx1Z2lucy5jb250ZXh0bWVudT1mdW5jdGlvbihpLHIpe3RoaXMuYmluZD1mdW5jdGlvbigpe3IuYmluZC5jYWxsKHRoaXMpO3ZhciB0LGkscz0wLG49bnVsbDt0aGlzLmVsZW1lbnQub24oXCJjb250ZXh0bWVudS5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe2UucHJldmVudERlZmF1bHQoKSxzPWUuY3RybEtleT8rbmV3IERhdGU6MCwodHx8bikmJihzPStuZXcgRGF0ZSsxZTQpLG4mJmNsZWFyVGltZW91dChuKSx0aGlzLmlzX2xvYWRpbmcoZS5jdXJyZW50VGFyZ2V0KXx8dGhpcy5zaG93X2NvbnRleHRtZW51KGUuY3VycmVudFRhcmdldCxlLnBhZ2VYLGUucGFnZVksZSl9LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKHQpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZSYmKCFzfHwrbmV3IERhdGUtcz4yNTApJiZlLnZha2F0YS5jb250ZXh0LmhpZGUoKSxzPTB9LHRoaXMpKS5vbihcInRvdWNoc3RhcnQuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGZ1bmN0aW9uKHIpe3Iub3JpZ2luYWxFdmVudCYmci5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZyLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJih0PXIucGFnZVgsaT1yLnBhZ2VZLG49c2V0VGltZW91dChmdW5jdGlvbigpe2Uoci5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKFwiY29udGV4dG1lbnVcIiwhMCl9LDc1MCkpfSkub24oXCJ0b3VjaG1vdmUudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGUpe24mJmUub3JpZ2luYWxFdmVudCYmZS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZlLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihNYXRoLmFicyh0LWUucGFnZVgpPjUwfHxNYXRoLmFicyhpLWUucGFnZVkpPjUwKSYmY2xlYXJUaW1lb3V0KG4pfSkub24oXCJ0b3VjaGVuZC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oZSl7biYmY2xlYXJUaW1lb3V0KG4pfSksZShsKS5vbihcImNvbnRleHRfaGlkZS52YWthdGEuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZT0hMX0sdGhpcykpfSx0aGlzLnRlYXJkb3duPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlJiZlLnZha2F0YS5jb250ZXh0LmhpZGUoKSxyLnRlYXJkb3duLmNhbGwodGhpcyl9LHRoaXMuc2hvd19jb250ZXh0bWVudT1mdW5jdGlvbihpLHIscyxuKXtpZihpPXRoaXMuZ2V0X25vZGUoaSksIWl8fGkuaWQ9PT1lLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBhPXRoaXMuc2V0dGluZ3MuY29udGV4dG1lbnUsbz10aGlzLmdldF9ub2RlKGksITApLGQ9by5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLGM9ITEsbD0hMTsoYS5zaG93X2F0X25vZGV8fHI9PT10fHxzPT09dCkmJihjPWQub2Zmc2V0KCkscj1jLmxlZnQscz1jLnRvcCt0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0KSx0aGlzLnNldHRpbmdzLmNvbnRleHRtZW51LnNlbGVjdF9ub2RlJiYhdGhpcy5pc19zZWxlY3RlZChpKSYmdGhpcy5hY3RpdmF0ZV9ub2RlKGksbiksbD1hLml0ZW1zLGUuaXNGdW5jdGlvbihsKSYmKGw9bC5jYWxsKHRoaXMsaSxlLnByb3h5KGZ1bmN0aW9uKGUpe3RoaXMuX3Nob3dfY29udGV4dG1lbnUoaSxyLHMsZSl9LHRoaXMpKSksZS5pc1BsYWluT2JqZWN0KGwpJiZ0aGlzLl9zaG93X2NvbnRleHRtZW51KGkscixzLGwpfSx0aGlzLl9zaG93X2NvbnRleHRtZW51PWZ1bmN0aW9uKHQsaSxyLHMpe3ZhciBuPXRoaXMuZ2V0X25vZGUodCwhMCksYT1uLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIik7ZShsKS5vbmUoXCJjb250ZXh0X3Nob3cudmFrYXRhLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24odCxpKXt2YXIgcj1cImpzdHJlZS1jb250ZXh0bWVudSBqc3RyZWUtXCIrdGhpcy5nZXRfdGhlbWUoKStcIi1jb250ZXh0bWVudVwiO2UoaS5lbGVtZW50KS5hZGRDbGFzcyhyKX0sdGhpcykpLHRoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZT0hMCxlLnZha2F0YS5jb250ZXh0LnNob3coYSx7eDppLHk6cn0scyksdGhpcy50cmlnZ2VyKFwic2hvd19jb250ZXh0bWVudVwiLHtub2RlOnQseDppLHk6cn0pfX0sZnVuY3Rpb24oZSl7dmFyIHQ9ITEsaT17ZWxlbWVudDohMSxyZWZlcmVuY2U6ITEscG9zaXRpb25feDowLHBvc2l0aW9uX3k6MCxpdGVtczpbXSxodG1sOlwiXCIsaXNfdmlzaWJsZTohMX07ZS52YWthdGEuY29udGV4dD17c2V0dGluZ3M6e2hpZGVfb25tb3VzZWxlYXZlOjAsaWNvbnM6ITB9LF90cmlnZ2VyOmZ1bmN0aW9uKHQpe2UobCkudHJpZ2dlckhhbmRsZXIoXCJjb250ZXh0X1wiK3QrXCIudmFrYXRhXCIse3JlZmVyZW5jZTppLnJlZmVyZW5jZSxlbGVtZW50OmkuZWxlbWVudCxwb3NpdGlvbjp7eDppLnBvc2l0aW9uX3gseTppLnBvc2l0aW9uX3l9fSl9LF9leGVjdXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0PWkuaXRlbXNbdF0sdCYmKCF0Ll9kaXNhYmxlZHx8ZS5pc0Z1bmN0aW9uKHQuX2Rpc2FibGVkKSYmIXQuX2Rpc2FibGVkKHtpdGVtOnQscmVmZXJlbmNlOmkucmVmZXJlbmNlLGVsZW1lbnQ6aS5lbGVtZW50fSkpJiZ0LmFjdGlvbj90LmFjdGlvbi5jYWxsKG51bGwse2l0ZW06dCxyZWZlcmVuY2U6aS5yZWZlcmVuY2UsZWxlbWVudDppLmVsZW1lbnQscG9zaXRpb246e3g6aS5wb3NpdGlvbl94LHk6aS5wb3NpdGlvbl95fX0pOiExfSxfcGFyc2U6ZnVuY3Rpb24odCxyKXtpZighdClyZXR1cm4hMTtyfHwoaS5odG1sPVwiXCIsaS5pdGVtcz1bXSk7dmFyIHMsbj1cIlwiLGE9ITE7cmV0dXJuIHImJihuKz1cIjx1bD5cIiksZS5lYWNoKHQsZnVuY3Rpb24odCxyKXtyZXR1cm4gcj8oaS5pdGVtcy5wdXNoKHIpLCFhJiZyLnNlcGFyYXRvcl9iZWZvcmUmJihuKz1cIjxsaSBjbGFzcz0ndmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yJz48YSBocmVmPScjJyBcIisoZS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5pY29ucz9cIlwiOidzdHlsZT1cIm1hcmdpbi1sZWZ0OjBweDtcIicpK1wiPiYjMTYwOzwvYT48L2xpPlwiKSxhPSExLG4rPVwiPGxpIGNsYXNzPSdcIisoci5fY2xhc3N8fFwiXCIpKyhyLl9kaXNhYmxlZD09PSEwfHxlLmlzRnVuY3Rpb24oci5fZGlzYWJsZWQpJiZyLl9kaXNhYmxlZCh7aXRlbTpyLHJlZmVyZW5jZTppLnJlZmVyZW5jZSxlbGVtZW50OmkuZWxlbWVudH0pP1wiIHZha2F0YS1jb250ZXh0bWVudS1kaXNhYmxlZCBcIjpcIlwiKStcIicgXCIrKHIuc2hvcnRjdXQ/XCIgZGF0YS1zaG9ydGN1dD0nXCIrci5zaG9ydGN1dCtcIicgXCI6XCJcIikrXCI+XCIsbis9XCI8YSBocmVmPScjJyByZWw9J1wiKyhpLml0ZW1zLmxlbmd0aC0xKStcIic+XCIsZS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5pY29ucyYmKG4rPVwiPGkgXCIsci5pY29uJiYobis9LTEhPT1yLmljb24uaW5kZXhPZihcIi9cIil8fC0xIT09ci5pY29uLmluZGV4T2YoXCIuXCIpP1wiIHN0eWxlPSdiYWNrZ3JvdW5kOnVybChcXFwiXCIrci5pY29uK1wiXFxcIikgY2VudGVyIGNlbnRlciBuby1yZXBlYXQnIFwiOlwiIGNsYXNzPSdcIityLmljb24rXCInIFwiKSxuKz1cIj48L2k+PHNwYW4gY2xhc3M9J3Zha2F0YS1jb250ZXh0bWVudS1zZXAnPiYjMTYwOzwvc3Bhbj5cIiksbis9KGUuaXNGdW5jdGlvbihyLmxhYmVsKT9yLmxhYmVsKHtpdGVtOnQscmVmZXJlbmNlOmkucmVmZXJlbmNlLGVsZW1lbnQ6aS5lbGVtZW50fSk6ci5sYWJlbCkrKHIuc2hvcnRjdXQ/JyA8c3BhbiBjbGFzcz1cInZha2F0YS1jb250ZXh0bWVudS1zaG9ydGN1dCB2YWthdGEtY29udGV4dG1lbnUtc2hvcnRjdXQtJytyLnNob3J0Y3V0KydcIj4nKyhyLnNob3J0Y3V0X2xhYmVsfHxcIlwiKStcIjwvc3Bhbj5cIjpcIlwiKStcIjwvYT5cIixyLnN1Ym1lbnUmJihzPWUudmFrYXRhLmNvbnRleHQuX3BhcnNlKHIuc3VibWVudSwhMCkscyYmKG4rPXMpKSxuKz1cIjwvbGk+XCIsdm9pZChyLnNlcGFyYXRvcl9hZnRlciYmKG4rPVwiPGxpIGNsYXNzPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InPjxhIGhyZWY9JyMnIFwiKyhlLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zP1wiXCI6J3N0eWxlPVwibWFyZ2luLWxlZnQ6MHB4O1wiJykrXCI+JiMxNjA7PC9hPjwvbGk+XCIsYT0hMCkpKTohMH0pLG49bi5yZXBsYWNlKC88bGkgY2xhc3NcXD0ndmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yJ1xcPjxcXC9saVxcPiQvLFwiXCIpLHImJihuKz1cIjwvdWw+XCIpLHJ8fChpLmh0bWw9bixlLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwicGFyc2VcIikpLG4ubGVuZ3RoPjEwP246ITF9LF9zaG93X3N1Ym1lbnU6ZnVuY3Rpb24oaSl7aWYoaT1lKGkpLGkubGVuZ3RoJiZpLmNoaWxkcmVuKFwidWxcIikubGVuZ3RoKXt2YXIgcj1pLmNoaWxkcmVuKFwidWxcIikscz1pLm9mZnNldCgpLmxlZnQraS5vdXRlcldpZHRoKCksbj1pLm9mZnNldCgpLnRvcCxhPXIud2lkdGgoKSxvPXIuaGVpZ2h0KCksZD1lKHdpbmRvdykud2lkdGgoKStlKHdpbmRvdykuc2Nyb2xsTGVmdCgpLGM9ZSh3aW5kb3cpLmhlaWdodCgpK2Uod2luZG93KS5zY3JvbGxUb3AoKTt0P2lbcy0oYSsxMCtpLm91dGVyV2lkdGgoKSk8MD9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInZha2F0YS1jb250ZXh0LWxlZnRcIik6aVtzK2ErMTA+ZD9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInZha2F0YS1jb250ZXh0LXJpZ2h0XCIpLG4rbysxMD5jJiZyLmNzcyhcImJvdHRvbVwiLFwiLTFweFwiKSxyLnNob3coKX19LHNob3c6ZnVuY3Rpb24ocixzLG4pe3ZhciBhLG8sZCxjLGwsaCxfLHUsZz0hMDtzd2l0Y2goaS5lbGVtZW50JiZpLmVsZW1lbnQubGVuZ3RoJiZpLmVsZW1lbnQud2lkdGgoXCJcIiksZyl7Y2FzZSFzJiYhcjpyZXR1cm4hMTtjYXNlISFzJiYhIXI6aS5yZWZlcmVuY2U9cixpLnBvc2l0aW9uX3g9cy54LGkucG9zaXRpb25feT1zLnk7YnJlYWs7Y2FzZSFzJiYhIXI6aS5yZWZlcmVuY2U9cixhPXIub2Zmc2V0KCksaS5wb3NpdGlvbl94PWEubGVmdCtyLm91dGVySGVpZ2h0KCksaS5wb3NpdGlvbl95PWEudG9wO2JyZWFrO2Nhc2UhIXMmJiFyOmkucG9zaXRpb25feD1zLngsaS5wb3NpdGlvbl95PXMueX1yJiYhbiYmZShyKS5kYXRhKFwidmFrYXRhX2NvbnRleHRtZW51XCIpJiYobj1lKHIpLmRhdGEoXCJ2YWthdGFfY29udGV4dG1lbnVcIikpLGUudmFrYXRhLmNvbnRleHQuX3BhcnNlKG4pJiZpLmVsZW1lbnQuaHRtbChpLmh0bWwpLGkuaXRlbXMubGVuZ3RoJiYoaS5lbGVtZW50LmFwcGVuZFRvKFwiYm9keVwiKSxvPWkuZWxlbWVudCxkPWkucG9zaXRpb25feCxjPWkucG9zaXRpb25feSxsPW8ud2lkdGgoKSxoPW8uaGVpZ2h0KCksXz1lKHdpbmRvdykud2lkdGgoKStlKHdpbmRvdykuc2Nyb2xsTGVmdCgpLHU9ZSh3aW5kb3cpLmhlaWdodCgpK2Uod2luZG93KS5zY3JvbGxUb3AoKSx0JiYoZC09by5vdXRlcldpZHRoKCktZShyKS5vdXRlcldpZHRoKCksZDxlKHdpbmRvdykuc2Nyb2xsTGVmdCgpKzIwJiYoZD1lKHdpbmRvdykuc2Nyb2xsTGVmdCgpKzIwKSksZCtsKzIwPl8mJihkPV8tKGwrMjApKSxjK2grMjA+dSYmKGM9dS0oaCsyMCkpLGkuZWxlbWVudC5jc3Moe2xlZnQ6ZCx0b3A6Y30pLnNob3coKS5maW5kKFwiYVwiKS5maXJzdCgpLmZvY3VzKCkucGFyZW50KCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxpLmlzX3Zpc2libGU9ITAsZS52YWthdGEuY29udGV4dC5fdHJpZ2dlcihcInNob3dcIikpfSxoaWRlOmZ1bmN0aW9uKCl7aS5pc192aXNpYmxlJiYoaS5lbGVtZW50LmhpZGUoKS5maW5kKFwidWxcIikuaGlkZSgpLmVuZCgpLmZpbmQoXCI6Zm9jdXNcIikuYmx1cigpLmVuZCgpLmRldGFjaCgpLGkuaXNfdmlzaWJsZT0hMSxlLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwiaGlkZVwiKSl9fSxlKGZ1bmN0aW9uKCl7dD1cInJ0bFwiPT09ZShcImJvZHlcIikuY3NzKFwiZGlyZWN0aW9uXCIpO3ZhciByPSExO2kuZWxlbWVudD1lKFwiPHVsIGNsYXNzPSd2YWthdGEtY29udGV4dCc+PC91bD5cIiksaS5lbGVtZW50Lm9uKFwibW91c2VlbnRlclwiLFwibGlcIixmdW5jdGlvbih0KXt0LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGUuY29udGFpbnModGhpcyx0LnJlbGF0ZWRUYXJnZXQpfHwociYmY2xlYXJUaW1lb3V0KHIpLGkuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuZW5kKCksZSh0aGlzKS5zaWJsaW5ncygpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCkuZW5kKCkucGFyZW50c1VudGlsKFwiLnZha2F0YS1jb250ZXh0XCIsXCJsaVwiKS5hZGRCYWNrKCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxlLnZha2F0YS5jb250ZXh0Ll9zaG93X3N1Ym1lbnUodGhpcykpfSkub24oXCJtb3VzZWxlYXZlXCIsXCJsaVwiLGZ1bmN0aW9uKHQpe2UuY29udGFpbnModGhpcyx0LnJlbGF0ZWRUYXJnZXQpfHxlKHRoaXMpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikuYWRkQmFjaygpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIil9KS5vbihcIm1vdXNlbGVhdmVcIixmdW5jdGlvbih0KXtlKHRoaXMpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxlLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmhpZGVfb25tb3VzZWxlYXZlJiYocj1zZXRUaW1lb3V0KGZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe2UudmFrYXRhLmNvbnRleHQuaGlkZSgpfX0odGhpcyksZS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5oaWRlX29ubW91c2VsZWF2ZSkpfSkub24oXCJjbGlja1wiLFwiYVwiLGZ1bmN0aW9uKHQpe3QucHJldmVudERlZmF1bHQoKSxlKHRoaXMpLmJsdXIoKS5wYXJlbnQoKS5oYXNDbGFzcyhcInZha2F0YS1jb250ZXh0LWRpc2FibGVkXCIpfHxlLnZha2F0YS5jb250ZXh0Ll9leGVjdXRlKGUodGhpcykuYXR0cihcInJlbFwiKSk9PT0hMXx8ZS52YWthdGEuY29udGV4dC5oaWRlKCl9KS5vbihcImtleWRvd25cIixcImFcIixmdW5jdGlvbih0KXt2YXIgcj1udWxsO3N3aXRjaCh0LndoaWNoKXtjYXNlIDEzOmNhc2UgMzI6dC50eXBlPVwibW91c2V1cFwiLHQucHJldmVudERlZmF1bHQoKSxlKHQuY3VycmVudFRhcmdldCkudHJpZ2dlcih0KTticmVhaztjYXNlIDM3OmkuaXNfdmlzaWJsZSYmKGkuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmxhc3QoKS5jbG9zZXN0KFwibGlcIikuZmlyc3QoKS5maW5kKFwidWxcIikuaGlkZSgpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5lbmQoKS5lbmQoKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSx0LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHQucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSAzODppLmlzX3Zpc2libGUmJihyPWkuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikucHJldkFsbChcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpLHIubGVuZ3RofHwocj1pLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5sYXN0KCkpLHIuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSx0LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHQucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSAzOTppLmlzX3Zpc2libGUmJihpLmVsZW1lbnQuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5sYXN0KCkuY2hpbGRyZW4oXCJ1bFwiKS5zaG93KCkuY2hpbGRyZW4oXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5maXJzdCgpLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuY2hpbGRyZW4oXCJhXCIpLmZvY3VzKCksdC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSx0LnByZXZlbnREZWZhdWx0KCkpO2JyZWFrO2Nhc2UgNDA6aS5pc192aXNpYmxlJiYocj1pLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLm5leHRBbGwoXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikuZmlyc3QoKSxyLmxlbmd0aHx8KHI9aS5lbGVtZW50LmZpbmQoXCJ1bDp2aXNpYmxlXCIpLmFkZEJhY2soKS5sYXN0KCkuY2hpbGRyZW4oXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikuZmlyc3QoKSksci5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLHQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdC5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDI3OmUudmFrYXRhLmNvbnRleHQuaGlkZSgpLHQucHJldmVudERlZmF1bHQoKX19KS5vbihcImtleWRvd25cIixmdW5jdGlvbihlKXtlLnByZXZlbnREZWZhdWx0KCk7dmFyIHQ9aS5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHRtZW51LXNob3J0Y3V0LVwiK2Uud2hpY2gpLnBhcmVudCgpO3QucGFyZW50KCkubm90KFwiLnZha2F0YS1jb250ZXh0LWRpc2FibGVkXCIpJiZ0LmNsaWNrKCl9KSxlKGwpLm9uKFwibW91c2Vkb3duLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbih0KXtpLmlzX3Zpc2libGUmJiFlLmNvbnRhaW5zKGkuZWxlbWVudFswXSx0LnRhcmdldCkmJmUudmFrYXRhLmNvbnRleHQuaGlkZSgpfSkub24oXCJjb250ZXh0X3Nob3cudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGUscil7aS5lbGVtZW50LmZpbmQoXCJsaTpoYXModWwpXCIpLmNoaWxkcmVuKFwiYVwiKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LXBhcmVudFwiKSx0JiZpLmVsZW1lbnQuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ydGxcIikuY3NzKFwiZGlyZWN0aW9uXCIsXCJydGxcIiksaS5lbGVtZW50LmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCl9KX0pfShlKSxlLmpzdHJlZS5kZWZhdWx0cy5kbmQ9e2NvcHk6ITAsb3Blbl90aW1lb3V0OjUwMCxpc19kcmFnZ2FibGU6ITAsY2hlY2tfd2hpbGVfZHJhZ2dpbmc6ITAsYWx3YXlzX2NvcHk6ITEsaW5zaWRlX3BvczowLGRyYWdfc2VsZWN0aW9uOiEwLHRvdWNoOiEwLGxhcmdlX2Ryb3BfdGFyZ2V0OiExLGxhcmdlX2RyYWdfdGFyZ2V0OiExfSxlLmpzdHJlZS5wbHVnaW5zLmRuZD1mdW5jdGlvbih0LGkpe3RoaXMuYmluZD1mdW5jdGlvbigpe2kuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcIm1vdXNlZG93bi5qc3RyZWUgdG91Y2hzdGFydC5qc3RyZWVcIix0aGlzLnNldHRpbmdzLmRuZC5sYXJnZV9kcmFnX3RhcmdldD9cIi5qc3RyZWUtbm9kZVwiOlwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKHQpe1xuaWYodGhpcy5zZXR0aW5ncy5kbmQubGFyZ2VfZHJhZ190YXJnZXQmJmUodC50YXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIilbMF0hPT10LmN1cnJlbnRUYXJnZXQpcmV0dXJuITA7aWYoXCJ0b3VjaHN0YXJ0XCI9PT10LnR5cGUmJighdGhpcy5zZXR0aW5ncy5kbmQudG91Y2h8fFwic2VsZWN0ZWRcIj09PXRoaXMuc2V0dGluZ3MuZG5kLnRvdWNoJiYhZSh0LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5oYXNDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpKSlyZXR1cm4hMDt2YXIgaT10aGlzLmdldF9ub2RlKHQudGFyZ2V0KSxyPXRoaXMuaXNfc2VsZWN0ZWQoaSkmJnRoaXMuc2V0dGluZ3MuZG5kLmRyYWdfc2VsZWN0aW9uP3RoaXMuZ2V0X3RvcF9zZWxlY3RlZCgpLmxlbmd0aDoxLHM9cj4xP3IrXCIgXCIrdGhpcy5nZXRfc3RyaW5nKFwibm9kZXNcIik6dGhpcy5nZXRfdGV4dCh0LmN1cnJlbnRUYXJnZXQpO3JldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dCYmKHM9ZS52YWthdGEuaHRtbC5lc2NhcGUocykpLGkmJmkuaWQmJmkuaWQhPT1lLmpzdHJlZS5yb290JiYoMT09PXQud2hpY2h8fFwidG91Y2hzdGFydFwiPT09dC50eXBlKSYmKHRoaXMuc2V0dGluZ3MuZG5kLmlzX2RyYWdnYWJsZT09PSEwfHxlLmlzRnVuY3Rpb24odGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlKSYmdGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlLmNhbGwodGhpcyxyPjE/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCEwKTpbaV0sdCkpPyh0aGlzLmVsZW1lbnQudHJpZ2dlcihcIm1vdXNlZG93bi5qc3RyZWVcIiksZS52YWthdGEuZG5kLnN0YXJ0KHQse2pzdHJlZTohMCxvcmlnaW46dGhpcyxvYmo6dGhpcy5nZXRfbm9kZShpLCEwKSxub2RlczpyPjE/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCk6W2kuaWRdfSwnPGRpdiBpZD1cImpzdHJlZS1kbmRcIiBjbGFzcz1cImpzdHJlZS0nK3RoaXMuZ2V0X3RoZW1lKCkrXCIganN0cmVlLVwiK3RoaXMuZ2V0X3RoZW1lKCkrXCItXCIrdGhpcy5nZXRfdGhlbWVfdmFyaWFudCgpK1wiIFwiKyh0aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikrJ1wiPjxpIGNsYXNzPVwianN0cmVlLWljb24ganN0cmVlLWVyXCI+PC9pPicrcysnPGlucyBjbGFzcz1cImpzdHJlZS1jb3B5XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+KzwvaW5zPjwvZGl2PicpKTp2b2lkIDB9LHRoaXMpKX19LGUoZnVuY3Rpb24oKXt2YXIgdD0hMSxpPSExLHI9ITEscz0hMSxuPWUoJzxkaXYgaWQ9XCJqc3RyZWUtbWFya2VyXCI+JiMxNjA7PC9kaXY+JykuaGlkZSgpO2UobCkub24oXCJkbmRfc3RhcnQudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGUsaSl7dD0hMSxyPSExLGkmJmkuZGF0YSYmaS5kYXRhLmpzdHJlZSYmbi5hcHBlbmRUbyhcImJvZHlcIil9KS5vbihcImRuZF9tb3ZlLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhLG8pe2lmKHMmJmNsZWFyVGltZW91dChzKSxvJiZvLmRhdGEmJm8uZGF0YS5qc3RyZWUmJighby5ldmVudC50YXJnZXQuaWR8fFwianN0cmVlLW1hcmtlclwiIT09by5ldmVudC50YXJnZXQuaWQpKXtyPW8uZXZlbnQ7dmFyIGQsYyxsLGgsXyx1LGcsZixwLG0sdixqLHksayx4PWUuanN0cmVlLnJlZmVyZW5jZShvLmV2ZW50LnRhcmdldCksYj0hMSx3PSExLEM9ITE7aWYoeCYmeC5fZGF0YSYmeC5fZGF0YS5kbmQpaWYobi5hdHRyKFwiY2xhc3NcIixcImpzdHJlZS1cIit4LmdldF90aGVtZSgpKyh4LnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikpLG8uaGVscGVyLmNoaWxkcmVuKCkuYXR0cihcImNsYXNzXCIsXCJqc3RyZWUtXCIreC5nZXRfdGhlbWUoKStcIiBqc3RyZWUtXCIreC5nZXRfdGhlbWUoKStcIi1cIit4LmdldF90aGVtZV92YXJpYW50KCkrXCIgXCIrKHguc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSkuZmluZChcIi5qc3RyZWUtY29weVwiKS5maXJzdCgpW28uZGF0YS5vcmlnaW4mJihvLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8by5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKG8uZXZlbnQubWV0YUtleXx8by5ldmVudC5jdHJsS2V5KSk/XCJzaG93XCI6XCJoaWRlXCJdKCksby5ldmVudC50YXJnZXQhPT14LmVsZW1lbnRbMF0mJm8uZXZlbnQudGFyZ2V0IT09eC5nZXRfY29udGFpbmVyX3VsKClbMF18fDAhPT14LmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbigpLmxlbmd0aCl7aWYoYj14LnNldHRpbmdzLmRuZC5sYXJnZV9kcm9wX3RhcmdldD9lKG8uZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIik6ZShvLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtYW5jaG9yXCIpLGImJmIubGVuZ3RoJiZiLnBhcmVudCgpLmlzKFwiLmpzdHJlZS1jbG9zZWQsIC5qc3RyZWUtb3BlbiwgLmpzdHJlZS1sZWFmXCIpJiYodz1iLm9mZnNldCgpLEM9by5ldmVudC5wYWdlWS13LnRvcCxsPWIub3V0ZXJIZWlnaHQoKSx1PWwvMz5DP1tcImJcIixcImlcIixcImFcIl06Qz5sLWwvMz9bXCJhXCIsXCJpXCIsXCJiXCJdOkM+bC8yP1tcImlcIixcImFcIixcImJcIl06W1wiaVwiLFwiYlwiLFwiYVwiXSxlLmVhY2godSxmdW5jdGlvbihyLGEpe3N3aXRjaChhKXtjYXNlXCJiXCI6ZD13LmxlZnQtNixjPXcudG9wLGg9eC5nZXRfcGFyZW50KGIpLF89Yi5wYXJlbnQoKS5pbmRleCgpO2JyZWFrO2Nhc2VcImlcIjp5PXguc2V0dGluZ3MuZG5kLmluc2lkZV9wb3Msaz14LmdldF9ub2RlKGIucGFyZW50KCkpLGQ9dy5sZWZ0LTIsYz13LnRvcCtsLzIrMSxoPWsuaWQsXz1cImZpcnN0XCI9PT15PzA6XCJsYXN0XCI9PT15P2suY2hpbGRyZW4ubGVuZ3RoOk1hdGgubWluKHksay5jaGlsZHJlbi5sZW5ndGgpO2JyZWFrO2Nhc2VcImFcIjpkPXcubGVmdC02LGM9dy50b3ArbCxoPXguZ2V0X3BhcmVudChiKSxfPWIucGFyZW50KCkuaW5kZXgoKSsxfWZvcihnPSEwLGY9MCxwPW8uZGF0YS5ub2Rlcy5sZW5ndGg7cD5mO2YrKylpZihtPW8uZGF0YS5vcmlnaW4mJihvLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8by5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKG8uZXZlbnQubWV0YUtleXx8by5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiLHY9XyxcIm1vdmVfbm9kZVwiPT09bSYmXCJhXCI9PT1hJiZvLmRhdGEub3JpZ2luJiZvLmRhdGEub3JpZ2luPT09eCYmaD09PXguZ2V0X3BhcmVudChvLmRhdGEubm9kZXNbZl0pJiYoaj14LmdldF9ub2RlKGgpLHY+ZS5pbkFycmF5KG8uZGF0YS5ub2Rlc1tmXSxqLmNoaWxkcmVuKSYmKHYtPTEpKSxnPWcmJih4JiZ4LnNldHRpbmdzJiZ4LnNldHRpbmdzLmRuZCYmeC5zZXR0aW5ncy5kbmQuY2hlY2tfd2hpbGVfZHJhZ2dpbmc9PT0hMXx8eC5jaGVjayhtLG8uZGF0YS5vcmlnaW4mJm8uZGF0YS5vcmlnaW4hPT14P28uZGF0YS5vcmlnaW4uZ2V0X25vZGUoby5kYXRhLm5vZGVzW2ZdKTpvLmRhdGEubm9kZXNbZl0saCx2LHtkbmQ6ITAscmVmOnguZ2V0X25vZGUoYi5wYXJlbnQoKSkscG9zOmEsb3JpZ2luOm8uZGF0YS5vcmlnaW4saXNfbXVsdGk6by5kYXRhLm9yaWdpbiYmby5kYXRhLm9yaWdpbiE9PXgsaXNfZm9yZWlnbjohby5kYXRhLm9yaWdpbn0pKSwhZyl7eCYmeC5sYXN0X2Vycm9yJiYoaT14Lmxhc3RfZXJyb3IoKSk7YnJlYWt9cmV0dXJuXCJpXCI9PT1hJiZiLnBhcmVudCgpLmlzKFwiLmpzdHJlZS1jbG9zZWRcIikmJnguc2V0dGluZ3MuZG5kLm9wZW5fdGltZW91dCYmKHM9c2V0VGltZW91dChmdW5jdGlvbihlLHQpe3JldHVybiBmdW5jdGlvbigpe2Uub3Blbl9ub2RlKHQpfX0oeCxiKSx4LnNldHRpbmdzLmRuZC5vcGVuX3RpbWVvdXQpKSxnPyh0PXtpbnM6eCxwYXI6aCxwb3M6XCJpXCIhPT1hfHxcImxhc3RcIiE9PXl8fDAhPT1ffHx4LmlzX2xvYWRlZChrKT9fOlwibGFzdFwifSxuLmNzcyh7bGVmdDpkK1wicHhcIix0b3A6YytcInB4XCJ9KS5zaG93KCksby5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5maXJzdCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWVyXCIpLmFkZENsYXNzKFwianN0cmVlLW9rXCIpLGk9e30sdT0hMCwhMSk6dm9pZCAwfSksdT09PSEwKSlyZXR1cm59ZWxzZXtmb3IoZz0hMCxmPTAscD1vLmRhdGEubm9kZXMubGVuZ3RoO3A+ZiYmKGc9ZyYmeC5jaGVjayhvLmRhdGEub3JpZ2luJiYoby5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fG8uZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihvLmV2ZW50Lm1ldGFLZXl8fG8uZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIixvLmRhdGEub3JpZ2luJiZvLmRhdGEub3JpZ2luIT09eD9vLmRhdGEub3JpZ2luLmdldF9ub2RlKG8uZGF0YS5ub2Rlc1tmXSk6by5kYXRhLm5vZGVzW2ZdLGUuanN0cmVlLnJvb3QsXCJsYXN0XCIse2RuZDohMCxyZWY6eC5nZXRfbm9kZShlLmpzdHJlZS5yb290KSxwb3M6XCJpXCIsb3JpZ2luOm8uZGF0YS5vcmlnaW4saXNfbXVsdGk6by5kYXRhLm9yaWdpbiYmby5kYXRhLm9yaWdpbiE9PXgsaXNfZm9yZWlnbjohby5kYXRhLm9yaWdpbn0pLGcpO2YrKyk7aWYoZylyZXR1cm4gdD17aW5zOngscGFyOmUuanN0cmVlLnJvb3QscG9zOlwibGFzdFwifSxuLmhpZGUoKSx2b2lkIG8uaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1lclwiKS5hZGRDbGFzcyhcImpzdHJlZS1va1wiKX10PSExLG8uaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb2tcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZXJcIiksbi5oaWRlKCl9fSkub24oXCJkbmRfc2Nyb2xsLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihlLGkpe2kmJmkuZGF0YSYmaS5kYXRhLmpzdHJlZSYmKG4uaGlkZSgpLHQ9ITEscj0hMSxpLmhlbHBlci5maW5kKFwiLmpzdHJlZS1pY29uXCIpLmZpcnN0KCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb2tcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZXJcIikpfSkub24oXCJkbmRfc3RvcC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSxvKXtpZihzJiZjbGVhclRpbWVvdXQocyksbyYmby5kYXRhJiZvLmRhdGEuanN0cmVlKXtuLmhpZGUoKS5kZXRhY2goKTt2YXIgZCxjLGw9W107aWYodCl7Zm9yKGQ9MCxjPW8uZGF0YS5ub2Rlcy5sZW5ndGg7Yz5kO2QrKylsW2RdPW8uZGF0YS5vcmlnaW4/by5kYXRhLm9yaWdpbi5nZXRfbm9kZShvLmRhdGEubm9kZXNbZF0pOm8uZGF0YS5ub2Rlc1tkXTt0Lmluc1tvLmRhdGEub3JpZ2luJiYoby5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fG8uZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihvLmV2ZW50Lm1ldGFLZXl8fG8uZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIl0obCx0LnBhcix0LnBvcywhMSwhMSwhMSxvLmRhdGEub3JpZ2luKX1lbHNlIGQ9ZShvLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWVcIiksZC5sZW5ndGgmJmkmJmkuZXJyb3ImJlwiY2hlY2tcIj09PWkuZXJyb3ImJihkPWQuanN0cmVlKCEwKSxkJiZkLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLGkpKTtyPSExLHQ9ITF9fSkub24oXCJrZXl1cC5qc3RyZWUga2V5ZG93bi5qc3RyZWVcIixmdW5jdGlvbih0LGkpe2k9ZS52YWthdGEuZG5kLl9nZXQoKSxpJiZpLmRhdGEmJmkuZGF0YS5qc3RyZWUmJihpLmhlbHBlci5maW5kKFwiLmpzdHJlZS1jb3B5XCIpLmZpcnN0KClbaS5kYXRhLm9yaWdpbiYmKGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYodC5tZXRhS2V5fHx0LmN0cmxLZXkpKT9cInNob3dcIjpcImhpZGVcIl0oKSxyJiYoci5tZXRhS2V5PXQubWV0YUtleSxyLmN0cmxLZXk9dC5jdHJsS2V5LGUudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixyKSkpfSl9KSxmdW5jdGlvbihlKXtlLnZha2F0YS5odG1sPXtkaXY6ZShcIjxkaXYgLz5cIiksZXNjYXBlOmZ1bmN0aW9uKHQpe3JldHVybiBlLnZha2F0YS5odG1sLmRpdi50ZXh0KHQpLmh0bWwoKX0sc3RyaXA6ZnVuY3Rpb24odCl7cmV0dXJuIGUudmFrYXRhLmh0bWwuZGl2LmVtcHR5KCkuYXBwZW5kKGUucGFyc2VIVE1MKHQpKS50ZXh0KCl9fTt2YXIgdD17ZWxlbWVudDohMSx0YXJnZXQ6ITEsaXNfZG93bjohMSxpc19kcmFnOiExLGhlbHBlcjohMSxoZWxwZXJfdzowLGRhdGE6ITEsaW5pdF94OjAsaW5pdF95OjAsc2Nyb2xsX2w6MCxzY3JvbGxfdDowLHNjcm9sbF9lOiExLHNjcm9sbF9pOiExLGlzX3RvdWNoOiExfTtlLnZha2F0YS5kbmQ9e3NldHRpbmdzOntzY3JvbGxfc3BlZWQ6MTAsc2Nyb2xsX3Byb3hpbWl0eToyMCxoZWxwZXJfbGVmdDo1LGhlbHBlcl90b3A6MTAsdGhyZXNob2xkOjUsdGhyZXNob2xkX3RvdWNoOjUwfSxfdHJpZ2dlcjpmdW5jdGlvbih0LGkpe3ZhciByPWUudmFrYXRhLmRuZC5fZ2V0KCk7ci5ldmVudD1pLGUobCkudHJpZ2dlckhhbmRsZXIoXCJkbmRfXCIrdCtcIi52YWthdGFcIixyKX0sX2dldDpmdW5jdGlvbigpe3JldHVybntkYXRhOnQuZGF0YSxlbGVtZW50OnQuZWxlbWVudCxoZWxwZXI6dC5oZWxwZXJ9fSxfY2xlYW46ZnVuY3Rpb24oKXt0LmhlbHBlciYmdC5oZWxwZXIucmVtb3ZlKCksdC5zY3JvbGxfaSYmKGNsZWFySW50ZXJ2YWwodC5zY3JvbGxfaSksdC5zY3JvbGxfaT0hMSksdD17ZWxlbWVudDohMSx0YXJnZXQ6ITEsaXNfZG93bjohMSxpc19kcmFnOiExLGhlbHBlcjohMSxoZWxwZXJfdzowLGRhdGE6ITEsaW5pdF94OjAsaW5pdF95OjAsc2Nyb2xsX2w6MCxzY3JvbGxfdDowLHNjcm9sbF9lOiExLHNjcm9sbF9pOiExLGlzX3RvdWNoOiExfSxlKGwpLm9mZihcIm1vdXNlbW92ZS52YWthdGEuanN0cmVlIHRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsZS52YWthdGEuZG5kLmRyYWcpLGUobCkub2ZmKFwibW91c2V1cC52YWthdGEuanN0cmVlIHRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixlLnZha2F0YS5kbmQuc3RvcCl9LF9zY3JvbGw6ZnVuY3Rpb24oaSl7aWYoIXQuc2Nyb2xsX2V8fCF0LnNjcm9sbF9sJiYhdC5zY3JvbGxfdClyZXR1cm4gdC5zY3JvbGxfaSYmKGNsZWFySW50ZXJ2YWwodC5zY3JvbGxfaSksdC5zY3JvbGxfaT0hMSksITE7aWYoIXQuc2Nyb2xsX2kpcmV0dXJuIHQuc2Nyb2xsX2k9c2V0SW50ZXJ2YWwoZS52YWthdGEuZG5kLl9zY3JvbGwsMTAwKSwhMTtpZihpPT09ITApcmV0dXJuITE7dmFyIHI9dC5zY3JvbGxfZS5zY3JvbGxUb3AoKSxzPXQuc2Nyb2xsX2Uuc2Nyb2xsTGVmdCgpO3Quc2Nyb2xsX2Uuc2Nyb2xsVG9wKHIrdC5zY3JvbGxfdCplLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3NwZWVkKSx0LnNjcm9sbF9lLnNjcm9sbExlZnQocyt0LnNjcm9sbF9sKmUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfc3BlZWQpLChyIT09dC5zY3JvbGxfZS5zY3JvbGxUb3AoKXx8cyE9PXQuc2Nyb2xsX2Uuc2Nyb2xsTGVmdCgpKSYmZS52YWthdGEuZG5kLl90cmlnZ2VyKFwic2Nyb2xsXCIsdC5zY3JvbGxfZSl9LHN0YXJ0OmZ1bmN0aW9uKGkscixzKXtcInRvdWNoc3RhcnRcIj09PWkudHlwZSYmaS5vcmlnaW5hbEV2ZW50JiZpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGkucGFnZVg9aS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGkucGFnZVk9aS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGkudGFyZ2V0PWwuZWxlbWVudEZyb21Qb2ludChpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSx0LmlzX2RyYWcmJmUudmFrYXRhLmRuZC5zdG9wKHt9KTt0cnl7aS5jdXJyZW50VGFyZ2V0LnVuc2VsZWN0YWJsZT1cIm9uXCIsaS5jdXJyZW50VGFyZ2V0Lm9uc2VsZWN0c3RhcnQ9ZnVuY3Rpb24oKXtyZXR1cm4hMX0saS5jdXJyZW50VGFyZ2V0LnN0eWxlJiYoaS5jdXJyZW50VGFyZ2V0LnN0eWxlLk1velVzZXJTZWxlY3Q9XCJub25lXCIpfWNhdGNoKG4pe31yZXR1cm4gdC5pbml0X3g9aS5wYWdlWCx0LmluaXRfeT1pLnBhZ2VZLHQuZGF0YT1yLHQuaXNfZG93bj0hMCx0LmVsZW1lbnQ9aS5jdXJyZW50VGFyZ2V0LHQudGFyZ2V0PWkudGFyZ2V0LHQuaXNfdG91Y2g9XCJ0b3VjaHN0YXJ0XCI9PT1pLnR5cGUscyE9PSExJiYodC5oZWxwZXI9ZShcIjxkaXYgaWQ9J3Zha2F0YS1kbmQnPjwvZGl2PlwiKS5odG1sKHMpLmNzcyh7ZGlzcGxheTpcImJsb2NrXCIsbWFyZ2luOlwiMFwiLHBhZGRpbmc6XCIwXCIscG9zaXRpb246XCJhYnNvbHV0ZVwiLHRvcDpcIi0yMDAwcHhcIixsaW5lSGVpZ2h0OlwiMTZweFwiLHpJbmRleDpcIjEwMDAwXCJ9KSksZShsKS5vbihcIm1vdXNlbW92ZS52YWthdGEuanN0cmVlIHRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsZS52YWthdGEuZG5kLmRyYWcpLGUobCkub24oXCJtb3VzZXVwLnZha2F0YS5qc3RyZWUgdG91Y2hlbmQudmFrYXRhLmpzdHJlZVwiLGUudmFrYXRhLmRuZC5zdG9wKSwhMX0sZHJhZzpmdW5jdGlvbihpKXtpZihcInRvdWNobW92ZVwiPT09aS50eXBlJiZpLm9yaWdpbmFsRXZlbnQmJmkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcyYmaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdJiYoaS5wYWdlWD1pLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgsaS5wYWdlWT1pLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVksaS50YXJnZXQ9bC5lbGVtZW50RnJvbVBvaW50KGkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWC13aW5kb3cucGFnZVhPZmZzZXQsaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLXdpbmRvdy5wYWdlWU9mZnNldCkpLHQuaXNfZG93bil7aWYoIXQuaXNfZHJhZyl7aWYoIShNYXRoLmFicyhpLnBhZ2VYLXQuaW5pdF94KT4odC5pc190b3VjaD9lLnZha2F0YS5kbmQuc2V0dGluZ3MudGhyZXNob2xkX3RvdWNoOmUudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGQpfHxNYXRoLmFicyhpLnBhZ2VZLXQuaW5pdF95KT4odC5pc190b3VjaD9lLnZha2F0YS5kbmQuc2V0dGluZ3MudGhyZXNob2xkX3RvdWNoOmUudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGQpKSlyZXR1cm47dC5oZWxwZXImJih0LmhlbHBlci5hcHBlbmRUbyhcImJvZHlcIiksdC5oZWxwZXJfdz10LmhlbHBlci5vdXRlcldpZHRoKCkpLHQuaXNfZHJhZz0hMCxlLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJzdGFydFwiLGkpfXZhciByPSExLHM9ITEsbj0hMSxhPSExLG89ITEsZD0hMSxjPSExLGg9ITEsXz0hMSx1PSExO3JldHVybiB0LnNjcm9sbF90PTAsdC5zY3JvbGxfbD0wLHQuc2Nyb2xsX2U9ITEsZShlKGkudGFyZ2V0KS5wYXJlbnRzVW50aWwoXCJib2R5XCIpLmFkZEJhY2soKS5nZXQoKS5yZXZlcnNlKCkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybi9eYXV0b3xzY3JvbGwkLy50ZXN0KGUodGhpcykuY3NzKFwib3ZlcmZsb3dcIikpJiYodGhpcy5zY3JvbGxIZWlnaHQ+dGhpcy5vZmZzZXRIZWlnaHR8fHRoaXMuc2Nyb2xsV2lkdGg+dGhpcy5vZmZzZXRXaWR0aCl9KS5lYWNoKGZ1bmN0aW9uKCl7dmFyIHI9ZSh0aGlzKSxzPXIub2Zmc2V0KCk7cmV0dXJuIHRoaXMuc2Nyb2xsSGVpZ2h0PnRoaXMub2Zmc2V0SGVpZ2h0JiYocy50b3Arci5oZWlnaHQoKS1pLnBhZ2VZPGUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYodC5zY3JvbGxfdD0xKSxpLnBhZ2VZLXMudG9wPGUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYodC5zY3JvbGxfdD0tMSkpLHRoaXMuc2Nyb2xsV2lkdGg+dGhpcy5vZmZzZXRXaWR0aCYmKHMubGVmdCtyLndpZHRoKCktaS5wYWdlWDxlLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKHQuc2Nyb2xsX2w9MSksaS5wYWdlWC1zLmxlZnQ8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF9sPS0xKSksdC5zY3JvbGxfdHx8dC5zY3JvbGxfbD8odC5zY3JvbGxfZT1lKHRoaXMpLCExKTp2b2lkIDB9KSx0LnNjcm9sbF9lfHwocj1lKGwpLHM9ZSh3aW5kb3cpLG49ci5oZWlnaHQoKSxhPXMuaGVpZ2h0KCksbz1yLndpZHRoKCksZD1zLndpZHRoKCksYz1yLnNjcm9sbFRvcCgpLGg9ci5zY3JvbGxMZWZ0KCksbj5hJiZpLnBhZ2VZLWM8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF90PS0xKSxuPmEmJmEtKGkucGFnZVktYyk8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF90PTEpLG8+ZCYmaS5wYWdlWC1oPGUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYodC5zY3JvbGxfbD0tMSksbz5kJiZkLShpLnBhZ2VYLWgpPGUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYodC5zY3JvbGxfbD0xKSwodC5zY3JvbGxfdHx8dC5zY3JvbGxfbCkmJih0LnNjcm9sbF9lPXIpKSx0LnNjcm9sbF9lJiZlLnZha2F0YS5kbmQuX3Njcm9sbCghMCksdC5oZWxwZXImJihfPXBhcnNlSW50KGkucGFnZVkrZS52YWthdGEuZG5kLnNldHRpbmdzLmhlbHBlcl90b3AsMTApLHU9cGFyc2VJbnQoaS5wYWdlWCtlLnZha2F0YS5kbmQuc2V0dGluZ3MuaGVscGVyX2xlZnQsMTApLG4mJl8rMjU+biYmKF89bi01MCksbyYmdSt0LmhlbHBlcl93Pm8mJih1PW8tKHQuaGVscGVyX3crMikpLHQuaGVscGVyLmNzcyh7bGVmdDp1K1wicHhcIix0b3A6XytcInB4XCJ9KSksZS52YWthdGEuZG5kLl90cmlnZ2VyKFwibW92ZVwiLGkpLCExfX0sc3RvcDpmdW5jdGlvbihpKXtpZihcInRvdWNoZW5kXCI9PT1pLnR5cGUmJmkub3JpZ2luYWxFdmVudCYmaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihpLnBhZ2VYPWkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxpLnBhZ2VZPWkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxpLnRhcmdldD1sLmVsZW1lbnRGcm9tUG9pbnQoaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLXdpbmRvdy5wYWdlWE9mZnNldCxpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVktd2luZG93LnBhZ2VZT2Zmc2V0KSksdC5pc19kcmFnKWUudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0b3BcIixpKTtlbHNlIGlmKFwidG91Y2hlbmRcIj09PWkudHlwZSYmaS50YXJnZXQ9PT10LnRhcmdldCl7dmFyIHI9c2V0VGltZW91dChmdW5jdGlvbigpe2UoaS50YXJnZXQpLmNsaWNrKCl9LDEwMCk7ZShpLnRhcmdldCkub25lKFwiY2xpY2tcIixmdW5jdGlvbigpe3ImJmNsZWFyVGltZW91dChyKX0pfXJldHVybiBlLnZha2F0YS5kbmQuX2NsZWFuKCksITF9fX0oZSksZS5qc3RyZWUuZGVmYXVsdHMubWFzc2xvYWQ9bnVsbCxlLmpzdHJlZS5wbHVnaW5zLm1hc3Nsb2FkPWZ1bmN0aW9uKHQsaSl7dGhpcy5pbml0PWZ1bmN0aW9uKGUsdCl7aS5pbml0LmNhbGwodGhpcyxlLHQpLHRoaXMuX2RhdGEubWFzc2xvYWQ9e319LHRoaXMuX2xvYWRfbm9kZXM9ZnVuY3Rpb24odCxyLHMpe3ZhciBuPXRoaXMuc2V0dGluZ3MubWFzc2xvYWQ7cmV0dXJuIHMmJiFlLmlzRW1wdHlPYmplY3QodGhpcy5fZGF0YS5tYXNzbG9hZCk/aS5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsdCxyLHMpOmUuaXNGdW5jdGlvbihuKT9uLmNhbGwodGhpcyx0LGUucHJveHkoZnVuY3Rpb24oZSl7aWYoZSlmb3IodmFyIG4gaW4gZSllLmhhc093blByb3BlcnR5KG4pJiYodGhpcy5fZGF0YS5tYXNzbG9hZFtuXT1lW25dKTtpLl9sb2FkX25vZGVzLmNhbGwodGhpcyx0LHIscyl9LHRoaXMpKTpcIm9iamVjdFwiPT10eXBlb2YgbiYmbiYmbi51cmw/KG49ZS5leHRlbmQoITAse30sbiksZS5pc0Z1bmN0aW9uKG4udXJsKSYmKG4udXJsPW4udXJsLmNhbGwodGhpcyx0KSksZS5pc0Z1bmN0aW9uKG4uZGF0YSkmJihuLmRhdGE9bi5kYXRhLmNhbGwodGhpcyx0KSksZS5hamF4KG4pLmRvbmUoZS5wcm94eShmdW5jdGlvbihlLG4sYSl7aWYoZSlmb3IodmFyIG8gaW4gZSllLmhhc093blByb3BlcnR5KG8pJiYodGhpcy5fZGF0YS5tYXNzbG9hZFtvXT1lW29dKTtpLl9sb2FkX25vZGVzLmNhbGwodGhpcyx0LHIscyl9LHRoaXMpKS5mYWlsKGUucHJveHkoZnVuY3Rpb24oZSl7aS5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsdCxyLHMpfSx0aGlzKSkpOmkuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLHQscixzKX0sdGhpcy5fbG9hZF9ub2RlPWZ1bmN0aW9uKHQscil7dmFyIHM9dGhpcy5fZGF0YS5tYXNzbG9hZFt0LmlkXTtyZXR1cm4gcz90aGlzW1wic3RyaW5nXCI9PXR5cGVvZiBzP1wiX2FwcGVuZF9odG1sX2RhdGFcIjpcIl9hcHBlbmRfanNvbl9kYXRhXCJdKHQsXCJzdHJpbmdcIj09dHlwZW9mIHM/ZShlLnBhcnNlSFRNTChzKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDMhPT10aGlzLm5vZGVUeXBlfSk6cyxmdW5jdGlvbihlKXtyLmNhbGwodGhpcyxlKSxkZWxldGUgdGhpcy5fZGF0YS5tYXNzbG9hZFt0LmlkXX0pOmkuX2xvYWRfbm9kZS5jYWxsKHRoaXMsdCxyKX19LGUuanN0cmVlLmRlZmF1bHRzLnNlYXJjaD17YWpheDohMSxmdXp6eTohMSxjYXNlX3NlbnNpdGl2ZTohMSxzaG93X29ubHlfbWF0Y2hlczohMSxzaG93X29ubHlfbWF0Y2hlc19jaGlsZHJlbjohMSxjbG9zZV9vcGVuZWRfb25jbGVhcjohMCxzZWFyY2hfbGVhdmVzX29ubHk6ITEsc2VhcmNoX2NhbGxiYWNrOiExfSxlLmpzdHJlZS5wbHVnaW5zLnNlYXJjaD1mdW5jdGlvbihpLHIpe3RoaXMuYmluZD1mdW5jdGlvbigpe3IuYmluZC5jYWxsKHRoaXMpLHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1cIlwiLHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1lKCksdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5zb209ITEsdGhpcy5fZGF0YS5zZWFyY2guc21jPSExLHRoaXMuX2RhdGEuc2VhcmNoLmhkbj1bXSx0aGlzLmVsZW1lbnQub24oXCJzZWFyY2guanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe2lmKHRoaXMuX2RhdGEuc2VhcmNoLnNvbSYmaS5yZXMubGVuZ3RoKXt2YXIgcixzLG49dGhpcy5fbW9kZWwuZGF0YSxhPVtdO2ZvcihyPTAscz1pLnJlcy5sZW5ndGg7cz5yO3IrKyluW2kucmVzW3JdXSYmIW5baS5yZXNbcl1dLnN0YXRlLmhpZGRlbiYmKGEucHVzaChpLnJlc1tyXSksYT1hLmNvbmNhdChuW2kucmVzW3JdXS5wYXJlbnRzKSx0aGlzLl9kYXRhLnNlYXJjaC5zbWMmJihhPWEuY29uY2F0KG5baS5yZXNbcl1dLmNoaWxkcmVuX2QpKSk7YT1lLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbShlLnZha2F0YS5hcnJheV91bmlxdWUoYSksZS5qc3RyZWUucm9vdCksdGhpcy5fZGF0YS5zZWFyY2guaGRuPXRoaXMuaGlkZV9hbGwoITApLHRoaXMuc2hvd19ub2RlKGEpfX0sdGhpcykpLm9uKFwiY2xlYXJfc2VhcmNoLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLl9kYXRhLnNlYXJjaC5zb20mJnQucmVzLmxlbmd0aCYmdGhpcy5zaG93X25vZGUodGhpcy5fZGF0YS5zZWFyY2guaGRuKX0sdGhpcykpfSx0aGlzLnNlYXJjaD1mdW5jdGlvbihpLHIscyxuLGEsbyl7aWYoaT09PSExfHxcIlwiPT09ZS50cmltKGkudG9TdHJpbmcoKSkpcmV0dXJuIHRoaXMuY2xlYXJfc2VhcmNoKCk7bj10aGlzLmdldF9ub2RlKG4pLG49biYmbi5pZD9uLmlkOm51bGwsaT1pLnRvU3RyaW5nKCk7dmFyIGQsYyxsPXRoaXMuc2V0dGluZ3Muc2VhcmNoLGg9bC5hamF4P2wuYWpheDohMSxfPXRoaXMuX21vZGVsLmRhdGEsdT1udWxsLGc9W10sZj1bXTtpZih0aGlzLl9kYXRhLnNlYXJjaC5yZXMubGVuZ3RoJiYhYSYmdGhpcy5jbGVhcl9zZWFyY2goKSxzPT09dCYmKHM9bC5zaG93X29ubHlfbWF0Y2hlcyksbz09PXQmJihvPWwuc2hvd19vbmx5X21hdGNoZXNfY2hpbGRyZW4pLCFyJiZoIT09ITEpcmV0dXJuIGUuaXNGdW5jdGlvbihoKT9oLmNhbGwodGhpcyxpLGUucHJveHkoZnVuY3Rpb24odCl7dCYmdC5kJiYodD10LmQpLHRoaXMuX2xvYWRfbm9kZXMoZS5pc0FycmF5KHQpP2UudmFrYXRhLmFycmF5X3VuaXF1ZSh0KTpbXSxmdW5jdGlvbigpe3RoaXMuc2VhcmNoKGksITAscyxuLGEpfSwhMCl9LHRoaXMpLG4pOihoPWUuZXh0ZW5kKHt9LGgpLGguZGF0YXx8KGguZGF0YT17fSksaC5kYXRhLnN0cj1pLG4mJihoLmRhdGEuaW5zaWRlPW4pLGUuYWpheChoKS5mYWlsKGUucHJveHkoZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwic2VhcmNoXCIsaWQ6XCJzZWFyY2hfMDFcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBzZWFyY2ggcGFyZW50c1wiLGRhdGE6SlNPTi5zdHJpbmdpZnkoaCl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpfSx0aGlzKSkuZG9uZShlLnByb3h5KGZ1bmN0aW9uKHQpe3QmJnQuZCYmKHQ9dC5kKSx0aGlzLl9sb2FkX25vZGVzKGUuaXNBcnJheSh0KT9lLnZha2F0YS5hcnJheV91bmlxdWUodCk6W10sZnVuY3Rpb24oKXt0aGlzLnNlYXJjaChpLCEwLHMsbixhKX0sITApfSx0aGlzKSkpO2lmKGF8fCh0aGlzLl9kYXRhLnNlYXJjaC5zdHI9aSx0aGlzLl9kYXRhLnNlYXJjaC5kb209ZSgpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guc29tPXMsdGhpcy5fZGF0YS5zZWFyY2guc21jPW8pLHU9bmV3IGUudmFrYXRhLnNlYXJjaChpLCEwLHtjYXNlU2Vuc2l0aXZlOmwuY2FzZV9zZW5zaXRpdmUsZnV6enk6bC5mdXp6eX0pLGUuZWFjaChfW24/bjplLmpzdHJlZS5yb290XS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGUsdCl7dmFyIHI9X1t0XTtyLnRleHQmJighbC5zZWFyY2hfbGVhdmVzX29ubHl8fHIuc3RhdGUubG9hZGVkJiYwPT09ci5jaGlsZHJlbi5sZW5ndGgpJiYobC5zZWFyY2hfY2FsbGJhY2smJmwuc2VhcmNoX2NhbGxiYWNrLmNhbGwodGhpcyxpLHIpfHwhbC5zZWFyY2hfY2FsbGJhY2smJnUuc2VhcmNoKHIudGV4dCkuaXNNYXRjaCkmJihnLnB1c2godCksZj1mLmNvbmNhdChyLnBhcmVudHMpKX0pLGcubGVuZ3RoKXtmb3IoZj1lLnZha2F0YS5hcnJheV91bmlxdWUoZiksZD0wLGM9Zi5sZW5ndGg7Yz5kO2QrKylmW2RdIT09ZS5qc3RyZWUucm9vdCYmX1tmW2RdXSYmdGhpcy5vcGVuX25vZGUoZltkXSxudWxsLDApPT09ITAmJnRoaXMuX2RhdGEuc2VhcmNoLm9wbi5wdXNoKGZbZF0pO2E/KHRoaXMuX2RhdGEuc2VhcmNoLmRvbT10aGlzLl9kYXRhLnNlYXJjaC5kb20uYWRkKGUodGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjXCIrZS5tYXAoZyxmdW5jdGlvbih0KXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YodFswXSk/XCJcXFxcM1wiK3RbMF0rXCIgXCIrdC5zdWJzdHIoMSkucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOnQucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpKSx0aGlzLl9kYXRhLnNlYXJjaC5yZXM9ZS52YWthdGEuYXJyYXlfdW5pcXVlKHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5jb25jYXQoZykpKToodGhpcy5fZGF0YS5zZWFyY2guZG9tPWUodGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjXCIrZS5tYXAoZyxmdW5jdGlvbih0KXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YodFswXSk/XCJcXFxcM1wiK3RbMF0rXCIgXCIrdC5zdWJzdHIoMSkucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOnQucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1nKSx0aGlzLl9kYXRhLnNlYXJjaC5kb20uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1zZWFyY2hcIil9dGhpcy50cmlnZ2VyKFwic2VhcmNoXCIse25vZGVzOnRoaXMuX2RhdGEuc2VhcmNoLmRvbSxzdHI6aSxyZXM6dGhpcy5fZGF0YS5zZWFyY2gucmVzLHNob3dfb25seV9tYXRjaGVzOnN9KX0sdGhpcy5jbGVhcl9zZWFyY2g9ZnVuY3Rpb24oKXt0aGlzLnNldHRpbmdzLnNlYXJjaC5jbG9zZV9vcGVuZWRfb25jbGVhciYmdGhpcy5jbG9zZV9ub2RlKHRoaXMuX2RhdGEuc2VhcmNoLm9wbiwwKSx0aGlzLnRyaWdnZXIoXCJjbGVhcl9zZWFyY2hcIix7bm9kZXM6dGhpcy5fZGF0YS5zZWFyY2guZG9tLHN0cjp0aGlzLl9kYXRhLnNlYXJjaC5zdHIscmVzOnRoaXMuX2RhdGEuc2VhcmNoLnJlc30pLHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5sZW5ndGgmJih0aGlzLl9kYXRhLnNlYXJjaC5kb209ZSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIitlLm1hcCh0aGlzLl9kYXRhLnNlYXJjaC5yZXMsZnVuY3Rpb24odCl7cmV0dXJuLTEhPT1cIjAxMjM0NTY3ODlcIi5pbmRleE9mKHRbMF0pP1wiXFxcXDNcIit0WzBdK1wiIFwiK3Quc3Vic3RyKDEpLnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKTp0LnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKX0pLmpvaW4oXCIsICNcIikpKSx0aGlzLl9kYXRhLnNlYXJjaC5kb20uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1zZWFyY2hcIikpLHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1cIlwiLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guZG9tPWUoKX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbih0LGkscyxuKXtpZih0PXIucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpLHQmJi0xIT09ZS5pbkFycmF5KHQuaWQsdGhpcy5fZGF0YS5zZWFyY2gucmVzKSl7dmFyIGEsbyxkPW51bGw7Zm9yKGE9MCxvPXQuY2hpbGROb2Rlcy5sZW5ndGg7bz5hO2ErKylpZih0LmNoaWxkTm9kZXNbYV0mJnQuY2hpbGROb2Rlc1thXS5jbGFzc05hbWUmJi0xIT09dC5jaGlsZE5vZGVzW2FdLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7ZD10LmNoaWxkTm9kZXNbYV07YnJlYWt9ZCYmKGQuY2xhc3NOYW1lKz1cIiBqc3RyZWUtc2VhcmNoXCIpfXJldHVybiB0fX0sZnVuY3Rpb24oZSl7ZS52YWthdGEuc2VhcmNoPWZ1bmN0aW9uKHQsaSxyKXtyPXJ8fHt9LHI9ZS5leHRlbmQoe30sZS52YWthdGEuc2VhcmNoLmRlZmF1bHRzLHIpLHIuZnV6enkhPT0hMSYmKHIuZnV6enk9ITApLHQ9ci5jYXNlU2Vuc2l0aXZlP3Q6dC50b0xvd2VyQ2FzZSgpO3ZhciBzLG4sYSxvLGQ9ci5sb2NhdGlvbixjPXIuZGlzdGFuY2UsbD1yLnRocmVzaG9sZCxoPXQubGVuZ3RoO3JldHVybiBoPjMyJiYoci5mdXp6eT0hMSksci5mdXp6eSYmKHM9MTw8aC0xLG49ZnVuY3Rpb24oKXt2YXIgZT17fSxpPTA7Zm9yKGk9MDtoPmk7aSsrKWVbdC5jaGFyQXQoaSldPTA7Zm9yKGk9MDtoPmk7aSsrKWVbdC5jaGFyQXQoaSldfD0xPDxoLWktMTtyZXR1cm4gZX0oKSxhPWZ1bmN0aW9uKGUsdCl7dmFyIGk9ZS9oLHI9TWF0aC5hYnMoZC10KTtyZXR1cm4gYz9pK3IvYzpyPzE6aX0pLG89ZnVuY3Rpb24oZSl7aWYoZT1yLmNhc2VTZW5zaXRpdmU/ZTplLnRvTG93ZXJDYXNlKCksdD09PWV8fC0xIT09ZS5pbmRleE9mKHQpKXJldHVybntpc01hdGNoOiEwLHNjb3JlOjB9O2lmKCFyLmZ1enp5KXJldHVybntpc01hdGNoOiExLHNjb3JlOjF9O3ZhciBpLG8sYyxfLHUsZyxmLHAsbSx2PWUubGVuZ3RoLGo9bCx5PWUuaW5kZXhPZih0LGQpLGs9aCt2LHg9MSxiPVtdO2ZvcigtMSE9PXkmJihqPU1hdGgubWluKGEoMCx5KSxqKSx5PWUubGFzdEluZGV4T2YodCxkK2gpLC0xIT09eSYmKGo9TWF0aC5taW4oYSgwLHkpLGopKSkseT0tMSxpPTA7aD5pO2krKyl7Zm9yKGM9MCxfPWs7Xz5jOylhKGksZCtfKTw9aj9jPV86az1fLF89TWF0aC5mbG9vcigoay1jKS8yK2MpO2ZvcihrPV8sZz1NYXRoLm1heCgxLGQtXysxKSxmPU1hdGgubWluKGQrXyx2KStoLHA9bmV3IEFycmF5KGYrMikscFtmKzFdPSgxPDxpKS0xLG89ZjtvPj1nO28tLSlpZihtPW5bZS5jaGFyQXQoby0xKV0sMD09PWk/cFtvXT0ocFtvKzFdPDwxfDEpJm06cFtvXT0ocFtvKzFdPDwxfDEpJm18KCh1W28rMV18dVtvXSk8PDF8MSl8dVtvKzFdLHBbb10mcyYmKHg9YShpLG8tMSksaj49eCkpe2lmKGo9eCx5PW8tMSxiLnB1c2goeSksISh5PmQpKWJyZWFrO2c9TWF0aC5tYXgoMSwyKmQteSl9aWYoYShpKzEsZCk+ailicmVhazt1PXB9cmV0dXJue2lzTWF0Y2g6eT49MCxzY29yZTp4fX0saT09PSEwP3tzZWFyY2g6b306byhpKX0sZS52YWthdGEuc2VhcmNoLmRlZmF1bHRzPXtsb2NhdGlvbjowLGRpc3RhbmNlOjEwMCx0aHJlc2hvbGQ6LjYsZnV6enk6ITEsY2FzZVNlbnNpdGl2ZTohMX19KGUpLGUuanN0cmVlLmRlZmF1bHRzLnNvcnQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5nZXRfdGV4dChlKT50aGlzLmdldF90ZXh0KHQpPzE6LTF9LGUuanN0cmVlLnBsdWdpbnMuc29ydD1mdW5jdGlvbih0LGkpe3RoaXMuYmluZD1mdW5jdGlvbigpe2kuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLnNvcnQodC5wYXJlbnQsITApfSx0aGlzKSkub24oXCJyZW5hbWVfbm9kZS5qc3RyZWUgY3JlYXRlX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3RoaXMuc29ydCh0LnBhcmVudHx8dC5ub2RlLnBhcmVudCwhMSksdGhpcy5yZWRyYXdfbm9kZSh0LnBhcmVudHx8dC5ub2RlLnBhcmVudCwhMCl9LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWUgY29weV9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLnNvcnQodC5wYXJlbnQsITEpLHRoaXMucmVkcmF3X25vZGUodC5wYXJlbnQsITApfSx0aGlzKSl9LHRoaXMuc29ydD1mdW5jdGlvbih0LGkpe3ZhciByLHM7aWYodD10aGlzLmdldF9ub2RlKHQpLHQmJnQuY2hpbGRyZW4mJnQuY2hpbGRyZW4ubGVuZ3RoJiYodC5jaGlsZHJlbi5zb3J0KGUucHJveHkodGhpcy5zZXR0aW5ncy5zb3J0LHRoaXMpKSxpKSlmb3Iocj0wLHM9dC5jaGlsZHJlbl9kLmxlbmd0aDtzPnI7cisrKXRoaXMuc29ydCh0LmNoaWxkcmVuX2Rbcl0sITEpfX07dmFyIHU9ITE7ZS5qc3RyZWUuZGVmYXVsdHMuc3RhdGU9e2tleTpcImpzdHJlZVwiLGV2ZW50czpcImNoYW5nZWQuanN0cmVlIG9wZW5fbm9kZS5qc3RyZWUgY2xvc2Vfbm9kZS5qc3RyZWUgY2hlY2tfbm9kZS5qc3RyZWUgdW5jaGVja19ub2RlLmpzdHJlZVwiLHR0bDohMSxmaWx0ZXI6ITF9LGUuanN0cmVlLnBsdWdpbnMuc3RhdGU9ZnVuY3Rpb24odCxpKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtpLmJpbmQuY2FsbCh0aGlzKTt2YXIgdD1lLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9uKHRoaXMuc2V0dGluZ3Muc3RhdGUuZXZlbnRzLGUucHJveHkoZnVuY3Rpb24oKXt1JiZjbGVhclRpbWVvdXQodSksdT1zZXRUaW1lb3V0KGUucHJveHkoZnVuY3Rpb24oKXt0aGlzLnNhdmVfc3RhdGUoKX0sdGhpcyksMTAwKX0sdGhpcykpLHRoaXMudHJpZ2dlcihcInN0YXRlX3JlYWR5XCIpfSx0aGlzKTt0aGlzLmVsZW1lbnQub24oXCJyZWFkeS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsaSl7dGhpcy5lbGVtZW50Lm9uZShcInJlc3RvcmVfc3RhdGUuanN0cmVlXCIsdCksdGhpcy5yZXN0b3JlX3N0YXRlKCl8fHQoKX0sdGhpcykpfSx0aGlzLnNhdmVfc3RhdGU9ZnVuY3Rpb24oKXt2YXIgdD17c3RhdGU6dGhpcy5nZXRfc3RhdGUoKSx0dGw6dGhpcy5zZXR0aW5ncy5zdGF0ZS50dGwsc2VjOituZXcgRGF0ZX07ZS52YWthdGEuc3RvcmFnZS5zZXQodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXksSlNPTi5zdHJpbmdpZnkodCkpfSx0aGlzLnJlc3RvcmVfc3RhdGU9ZnVuY3Rpb24oKXt2YXIgdD1lLnZha2F0YS5zdG9yYWdlLmdldCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSk7aWYodCl0cnl7dD1KU09OLnBhcnNlKHQpfWNhdGNoKGkpe3JldHVybiExfXJldHVybiB0JiZ0LnR0bCYmdC5zZWMmJituZXcgRGF0ZS10LnNlYz50LnR0bD8hMToodCYmdC5zdGF0ZSYmKHQ9dC5zdGF0ZSksdCYmZS5pc0Z1bmN0aW9uKHRoaXMuc2V0dGluZ3Muc3RhdGUuZmlsdGVyKSYmKHQ9dGhpcy5zZXR0aW5ncy5zdGF0ZS5maWx0ZXIuY2FsbCh0aGlzLHQpKSx0Pyh0aGlzLmVsZW1lbnQub25lKFwic2V0X3N0YXRlLmpzdHJlZVwiLGZ1bmN0aW9uKGkscil7ci5pbnN0YW5jZS50cmlnZ2VyKFwicmVzdG9yZV9zdGF0ZVwiLHtzdGF0ZTplLmV4dGVuZCghMCx7fSx0KX0pfSksdGhpcy5zZXRfc3RhdGUodCksITApOiExKX0sdGhpcy5jbGVhcl9zdGF0ZT1mdW5jdGlvbigpe3JldHVybiBlLnZha2F0YS5zdG9yYWdlLmRlbCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSl9fSxmdW5jdGlvbihlLHQpe2UudmFrYXRhLnN0b3JhZ2U9e3NldDpmdW5jdGlvbihlLHQpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oZSx0KX0sZ2V0OmZ1bmN0aW9uKGUpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oZSl9LGRlbDpmdW5jdGlvbihlKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGUpfX19KGUpLGUuanN0cmVlLmRlZmF1bHRzLnR5cGVzPXtcImRlZmF1bHRcIjp7fX0sZS5qc3RyZWUuZGVmYXVsdHMudHlwZXNbZS5qc3RyZWUucm9vdF09e30sZS5qc3RyZWUucGx1Z2lucy50eXBlcz1mdW5jdGlvbihpLHIpe3RoaXMuaW5pdD1mdW5jdGlvbihpLHMpe3ZhciBuLGE7aWYocyYmcy50eXBlcyYmcy50eXBlc1tcImRlZmF1bHRcIl0pZm9yKG4gaW4gcy50eXBlcylpZihcImRlZmF1bHRcIiE9PW4mJm4hPT1lLmpzdHJlZS5yb290JiZzLnR5cGVzLmhhc093blByb3BlcnR5KG4pKWZvcihhIGluIHMudHlwZXNbXCJkZWZhdWx0XCJdKXMudHlwZXNbXCJkZWZhdWx0XCJdLmhhc093blByb3BlcnR5KGEpJiZzLnR5cGVzW25dW2FdPT09dCYmKHMudHlwZXNbbl1bYV09cy50eXBlc1tcImRlZmF1bHRcIl1bYV0pO3IuaW5pdC5jYWxsKHRoaXMsaSxzKSx0aGlzLl9tb2RlbC5kYXRhW2UuanN0cmVlLnJvb3RdLnR5cGU9ZS5qc3RyZWUucm9vdH0sdGhpcy5yZWZyZXNoPWZ1bmN0aW9uKHQsaSl7ci5yZWZyZXNoLmNhbGwodGhpcyx0LGkpLHRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF0udHlwZT1lLmpzdHJlZS5yb290fSx0aGlzLmJpbmQ9ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGkscil7dmFyIHMsbixhPXRoaXMuX21vZGVsLmRhdGEsbz1yLm5vZGVzLGQ9dGhpcy5zZXR0aW5ncy50eXBlcyxjPVwiZGVmYXVsdFwiO2ZvcihzPTAsbj1vLmxlbmd0aDtuPnM7cysrKWM9XCJkZWZhdWx0XCIsYVtvW3NdXS5vcmlnaW5hbCYmYVtvW3NdXS5vcmlnaW5hbC50eXBlJiZkW2Fbb1tzXV0ub3JpZ2luYWwudHlwZV0mJihjPWFbb1tzXV0ub3JpZ2luYWwudHlwZSksYVtvW3NdXS5kYXRhJiZhW29bc11dLmRhdGEuanN0cmVlJiZhW29bc11dLmRhdGEuanN0cmVlLnR5cGUmJmRbYVtvW3NdXS5kYXRhLmpzdHJlZS50eXBlXSYmKGM9YVtvW3NdXS5kYXRhLmpzdHJlZS50eXBlKSxhW29bc11dLnR5cGU9YyxhW29bc11dLmljb249PT0hMCYmZFtjXS5pY29uIT09dCYmKGFbb1tzXV0uaWNvbj1kW2NdLmljb24pO2FbZS5qc3RyZWUucm9vdF0udHlwZT1lLmpzdHJlZS5yb290fSx0aGlzKSksci5iaW5kLmNhbGwodGhpcyl9LHRoaXMuZ2V0X2pzb249ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGEsbz10aGlzLl9tb2RlbC5kYXRhLGQ9aT9lLmV4dGVuZCghMCx7fSxpLHtub19pZDohMX0pOnt9LGM9ci5nZXRfanNvbi5jYWxsKHRoaXMsdCxkLHMpO2lmKGM9PT0hMSlyZXR1cm4hMTtpZihlLmlzQXJyYXkoYykpZm9yKG49MCxhPWMubGVuZ3RoO2E+bjtuKyspY1tuXS50eXBlPWNbbl0uaWQmJm9bY1tuXS5pZF0mJm9bY1tuXS5pZF0udHlwZT9vW2Nbbl0uaWRdLnR5cGU6XCJkZWZhdWx0XCIsaSYmaS5ub19pZCYmKGRlbGV0ZSBjW25dLmlkLGNbbl0ubGlfYXR0ciYmY1tuXS5saV9hdHRyLmlkJiZkZWxldGUgY1tuXS5saV9hdHRyLmlkLGNbbl0uYV9hdHRyJiZjW25dLmFfYXR0ci5pZCYmZGVsZXRlIGNbbl0uYV9hdHRyLmlkKTtlbHNlIGMudHlwZT1jLmlkJiZvW2MuaWRdJiZvW2MuaWRdLnR5cGU/b1tjLmlkXS50eXBlOlwiZGVmYXVsdFwiLGkmJmkubm9faWQmJihjPXRoaXMuX2RlbGV0ZV9pZHMoYykpO3JldHVybiBjfSx0aGlzLl9kZWxldGVfaWRzPWZ1bmN0aW9uKHQpe2lmKGUuaXNBcnJheSh0KSl7Zm9yKHZhciBpPTAscj10Lmxlbmd0aDtyPmk7aSsrKXRbaV09dGhpcy5fZGVsZXRlX2lkcyh0W2ldKTtyZXR1cm4gdH1yZXR1cm4gZGVsZXRlIHQuaWQsdC5saV9hdHRyJiZ0LmxpX2F0dHIuaWQmJmRlbGV0ZSB0LmxpX2F0dHIuaWQsdC5hX2F0dHImJnQuYV9hdHRyLmlkJiZkZWxldGUgdC5hX2F0dHIuaWQsdC5jaGlsZHJlbiYmZS5pc0FycmF5KHQuY2hpbGRyZW4pJiYodC5jaGlsZHJlbj10aGlzLl9kZWxldGVfaWRzKHQuY2hpbGRyZW4pKSx0fSx0aGlzLmNoZWNrPWZ1bmN0aW9uKGkscyxuLGEsbyl7aWYoci5jaGVjay5jYWxsKHRoaXMsaSxzLG4sYSxvKT09PSExKXJldHVybiExO3M9cyYmcy5pZD9zOnRoaXMuZ2V0X25vZGUocyksbj1uJiZuLmlkP246dGhpcy5nZXRfbm9kZShuKTt2YXIgZCxjLGwsaCxfPXMmJnMuaWQ/byYmby5vcmlnaW4/by5vcmlnaW46ZS5qc3RyZWUucmVmZXJlbmNlKHMuaWQpOm51bGw7c3dpdGNoKF89XyYmXy5fbW9kZWwmJl8uX21vZGVsLmRhdGE/Xy5fbW9kZWwuZGF0YTpudWxsLGkpe2Nhc2VcImNyZWF0ZV9ub2RlXCI6Y2FzZVwibW92ZV9ub2RlXCI6Y2FzZVwiY29weV9ub2RlXCI6aWYoXCJtb3ZlX25vZGVcIiE9PWl8fC0xPT09ZS5pbkFycmF5KHMuaWQsbi5jaGlsZHJlbikpe2lmKGQ9dGhpcy5nZXRfcnVsZXMobiksZC5tYXhfY2hpbGRyZW4hPT10JiYtMSE9PWQubWF4X2NoaWxkcmVuJiZkLm1heF9jaGlsZHJlbj09PW4uY2hpbGRyZW4ubGVuZ3RoKXJldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInR5cGVzXCIsaWQ6XCJ0eXBlc18wMVwiLHJlYXNvbjpcIm1heF9jaGlsZHJlbiBwcmV2ZW50cyBmdW5jdGlvbjogXCIraSxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6aSxwb3M6YSxvYmo6cyYmcy5pZD9zLmlkOiExLHBhcjpuJiZuLmlkP24uaWQ6ITF9KX0sITE7aWYoZC52YWxpZF9jaGlsZHJlbiE9PXQmJi0xIT09ZC52YWxpZF9jaGlsZHJlbiYmLTE9PT1lLmluQXJyYXkocy50eXBlfHxcImRlZmF1bHRcIixkLnZhbGlkX2NoaWxkcmVuKSlyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ0eXBlc1wiLGlkOlwidHlwZXNfMDJcIixyZWFzb246XCJ2YWxpZF9jaGlsZHJlbiBwcmV2ZW50cyBmdW5jdGlvbjogXCIraSxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6aSxwb3M6YSxvYmo6cyYmcy5pZD9zLmlkOiExLHBhcjpuJiZuLmlkP24uaWQ6ITF9KX0sITE7aWYoXyYmcy5jaGlsZHJlbl9kJiZzLnBhcmVudHMpe2ZvcihjPTAsbD0wLGg9cy5jaGlsZHJlbl9kLmxlbmd0aDtoPmw7bCsrKWM9TWF0aC5tYXgoYyxfW3MuY2hpbGRyZW5fZFtsXV0ucGFyZW50cy5sZW5ndGgpO2M9Yy1zLnBhcmVudHMubGVuZ3RoKzF9KDA+PWN8fGM9PT10KSYmKGM9MSk7ZG97aWYoZC5tYXhfZGVwdGghPT10JiYtMSE9PWQubWF4X2RlcHRoJiZkLm1heF9kZXB0aDxjKXJldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInR5cGVzXCIsaWQ6XCJ0eXBlc18wM1wiLHJlYXNvbjpcIm1heF9kZXB0aCBwcmV2ZW50cyBmdW5jdGlvbjogXCIraSxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6aSxwb3M6YSxvYmo6cyYmcy5pZD9zLmlkOiExLHBhcjpuJiZuLmlkP24uaWQ6ITF9KX0sITE7bj10aGlzLmdldF9ub2RlKG4ucGFyZW50KSxkPXRoaXMuZ2V0X3J1bGVzKG4pLGMrK313aGlsZShuKX19cmV0dXJuITB9LHRoaXMuZ2V0X3J1bGVzPWZ1bmN0aW9uKGUpe2lmKGU9dGhpcy5nZXRfbm9kZShlKSwhZSlyZXR1cm4hMTt2YXIgaT10aGlzLmdldF90eXBlKGUsITApO3JldHVybiBpLm1heF9kZXB0aD09PXQmJihpLm1heF9kZXB0aD0tMSksaS5tYXhfY2hpbGRyZW49PT10JiYoaS5tYXhfY2hpbGRyZW49LTEpLGkudmFsaWRfY2hpbGRyZW49PT10JiYoaS52YWxpZF9jaGlsZHJlbj0tMSksaX0sdGhpcy5nZXRfdHlwZT1mdW5jdGlvbih0LGkpe3JldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdD9pP2UuZXh0ZW5kKHt0eXBlOnQudHlwZX0sdGhpcy5zZXR0aW5ncy50eXBlc1t0LnR5cGVdKTp0LnR5cGU6ITF9LHRoaXMuc2V0X3R5cGU9ZnVuY3Rpb24oaSxyKXt2YXIgcyxuLGEsbyxkO2lmKGUuaXNBcnJheShpKSl7Zm9yKGk9aS5zbGljZSgpLG49MCxhPWkubGVuZ3RoO2E+bjtuKyspdGhpcy5zZXRfdHlwZShpW25dLHIpO3JldHVybiEwfXJldHVybiBzPXRoaXMuc2V0dGluZ3MudHlwZXMsaT10aGlzLmdldF9ub2RlKGkpLHNbcl0mJmk/KG89aS50eXBlLGQ9dGhpcy5nZXRfaWNvbihpKSxpLnR5cGU9ciwoZD09PSEwfHxzW29dJiZzW29dLmljb24hPT10JiZkPT09c1tvXS5pY29uKSYmdGhpcy5zZXRfaWNvbihpLHNbcl0uaWNvbiE9PXQ/c1tyXS5pY29uOiEwKSwhMCk6ITF9fSxlLmpzdHJlZS5kZWZhdWx0cy51bmlxdWU9e2Nhc2Vfc2Vuc2l0aXZlOiExLGR1cGxpY2F0ZTpmdW5jdGlvbihlLHQpe3JldHVybiBlK1wiIChcIit0K1wiKVwifX0sZS5qc3RyZWUucGx1Z2lucy51bmlxdWU9ZnVuY3Rpb24oaSxyKXt0aGlzLmNoZWNrPWZ1bmN0aW9uKHQsaSxzLG4sYSl7aWYoci5jaGVjay5jYWxsKHRoaXMsdCxpLHMsbixhKT09PSExKXJldHVybiExO2lmKGk9aSYmaS5pZD9pOnRoaXMuZ2V0X25vZGUoaSkscz1zJiZzLmlkP3M6dGhpcy5nZXRfbm9kZShzKSwhc3x8IXMuY2hpbGRyZW4pcmV0dXJuITA7dmFyIG8sZCxjPVwicmVuYW1lX25vZGVcIj09PXQ/bjppLnRleHQsbD1bXSxoPXRoaXMuc2V0dGluZ3MudW5pcXVlLmNhc2Vfc2Vuc2l0aXZlLF89dGhpcy5fbW9kZWwuZGF0YTtmb3Iobz0wLGQ9cy5jaGlsZHJlbi5sZW5ndGg7ZD5vO28rKylsLnB1c2goaD9fW3MuY2hpbGRyZW5bb11dLnRleHQ6X1tzLmNoaWxkcmVuW29dXS50ZXh0LnRvTG93ZXJDYXNlKCkpO3N3aXRjaChofHwoYz1jLnRvTG93ZXJDYXNlKCkpLHQpe2Nhc2VcImRlbGV0ZV9ub2RlXCI6cmV0dXJuITA7Y2FzZVwicmVuYW1lX25vZGVcIjpyZXR1cm4gbz0tMT09PWUuaW5BcnJheShjLGwpfHxpLnRleHQmJmkudGV4dFtoP1widG9TdHJpbmdcIjpcInRvTG93ZXJDYXNlXCJdKCk9PT1jLG98fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzAxXCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2MrXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK3QsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOnQscG9zOm4sb2JqOmkmJmkuaWQ/aS5pZDohMSxwYXI6cyYmcy5pZD9zLmlkOiExfSl9KSxvO2Nhc2VcImNyZWF0ZV9ub2RlXCI6cmV0dXJuIG89LTE9PT1lLmluQXJyYXkoYyxsKSxvfHwodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ1bmlxdWVcIixpZDpcInVuaXF1ZV8wNFwiLHJlYXNvbjpcIkNoaWxkIHdpdGggbmFtZSBcIitjK1wiIGFscmVhZHkgZXhpc3RzLiBQcmV2ZW50aW5nOiBcIit0LGRhdGE6SlNPTi5zdHJpbmdpZnkoe2Noazp0LHBvczpuLG9iajppJiZpLmlkP2kuaWQ6ITEscGFyOnMmJnMuaWQ/cy5pZDohMX0pfSksbztjYXNlXCJjb3B5X25vZGVcIjpyZXR1cm4gbz0tMT09PWUuaW5BcnJheShjLGwpLG98fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzAyXCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2MrXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK3QsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOnQscG9zOm4sb2JqOmkmJmkuaWQ/aS5pZDohMSxwYXI6cyYmcy5pZD9zLmlkOiExfSl9KSxvO2Nhc2VcIm1vdmVfbm9kZVwiOnJldHVybiBvPWkucGFyZW50PT09cy5pZCYmKCFhfHwhYS5pc19tdWx0aSl8fC0xPT09ZS5pbkFycmF5KGMsbCksb3x8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDNcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIrYytcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrdCxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6dCxwb3M6bixvYmo6aSYmaS5pZD9pLmlkOiExLHBhcjpzJiZzLmlkP3MuaWQ6ITF9KX0pLG99cmV0dXJuITB9LHRoaXMuY3JlYXRlX25vZGU9ZnVuY3Rpb24oaSxzLG4sYSxvKXtpZighc3x8cy50ZXh0PT09dCl7aWYobnVsbD09PWkmJihpPWUuanN0cmVlLnJvb3QpLGk9dGhpcy5nZXRfbm9kZShpKSwhaSlyZXR1cm4gci5jcmVhdGVfbm9kZS5jYWxsKHRoaXMsaSxzLG4sYSxvKTtpZihuPW49PT10P1wibGFzdFwiOm4sIW4udG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhbyYmIXRoaXMuaXNfbG9hZGVkKGkpKXJldHVybiByLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxpLHMsbixhLG8pO3N8fChzPXt9KTt2YXIgZCxjLGwsaCxfLHU9dGhpcy5fbW9kZWwuZGF0YSxnPXRoaXMuc2V0dGluZ3MudW5pcXVlLmNhc2Vfc2Vuc2l0aXZlLGY9dGhpcy5zZXR0aW5ncy51bmlxdWUuZHVwbGljYXRlO2ZvcihjPWQ9dGhpcy5nZXRfc3RyaW5nKFwiTmV3IG5vZGVcIiksbD1bXSxoPTAsXz1pLmNoaWxkcmVuLmxlbmd0aDtfPmg7aCsrKWwucHVzaChnP3VbaS5jaGlsZHJlbltoXV0udGV4dDp1W2kuY2hpbGRyZW5baF1dLnRleHQudG9Mb3dlckNhc2UoKSk7Zm9yKGg9MTstMSE9PWUuaW5BcnJheShnP2M6Yy50b0xvd2VyQ2FzZSgpLGwpOyljPWYuY2FsbCh0aGlzLGQsKytoKS50b1N0cmluZygpO3MudGV4dD1jfXJldHVybiByLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxpLHMsbixhLG8pfX07dmFyIGc9bC5jcmVhdGVFbGVtZW50KFwiRElWXCIpO2lmKGcuc2V0QXR0cmlidXRlKFwidW5zZWxlY3RhYmxlXCIsXCJvblwiKSxnLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxnLmNsYXNzTmFtZT1cImpzdHJlZS13aG9sZXJvd1wiLGcuaW5uZXJIVE1MPVwiJiMxNjA7XCIsZS5qc3RyZWUucGx1Z2lucy53aG9sZXJvdz1mdW5jdGlvbih0LGkpe3RoaXMuYmluZD1mdW5jdGlvbigpe2kuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcInJlYWR5LmpzdHJlZSBzZXRfc3RhdGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbigpe3RoaXMuaGlkZV9kb3RzKCl9LHRoaXMpKS5vbihcImluaXQuanN0cmVlIGxvYWRpbmcuanN0cmVlIHJlYWR5LmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oKXt0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS13aG9sZXJvdy11bFwiKX0sdGhpcykpLm9uKFwiZGVzZWxlY3RfYWxsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpfSx0aGlzKSkub24oXCJjaGFuZ2VkLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpO3ZhciBpLHIscz0hMTtmb3IoaT0wLHI9dC5zZWxlY3RlZC5sZW5ndGg7cj5pO2krKylzPXRoaXMuZ2V0X25vZGUodC5zZWxlY3RlZFtpXSwhMCkscyYmcy5sZW5ndGgmJnMuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcIm9wZW5fbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dGhpcy5nZXRfbm9kZSh0Lm5vZGUsITApLmZpbmQoXCIuanN0cmVlLWNsaWNrZWRcIikucGFyZW50KCkuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImhvdmVyX25vZGUuanN0cmVlIGRlaG92ZXJfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7XCJob3Zlcl9ub2RlXCI9PT1lLnR5cGUmJnRoaXMuaXNfZGlzYWJsZWQodC5ub2RlKXx8dGhpcy5nZXRfbm9kZSh0Lm5vZGUsITApLmNoaWxkcmVuKFwiLmpzdHJlZS13aG9sZXJvd1wiKVtcImhvdmVyX25vZGVcIj09PWUudHlwZT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcImpzdHJlZS13aG9sZXJvdy1ob3ZlcmVkXCIpfSx0aGlzKSkub24oXCJjb250ZXh0bWVudS5qc3RyZWVcIixcIi5qc3RyZWUtd2hvbGVyb3dcIixlLnByb3h5KGZ1bmN0aW9uKHQpe3QucHJldmVudERlZmF1bHQoKTt2YXIgaT1lLkV2ZW50KFwiY29udGV4dG1lbnVcIix7bWV0YUtleTp0Lm1ldGFLZXksY3RybEtleTp0LmN0cmxLZXksYWx0S2V5OnQuYWx0S2V5LHNoaWZ0S2V5OnQuc2hpZnRLZXkscGFnZVg6dC5wYWdlWCxwYWdlWTp0LnBhZ2VZfSk7ZSh0LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoaSl9LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvd1wiLGZ1bmN0aW9uKHQpe3Quc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7dmFyIGk9ZS5FdmVudChcImNsaWNrXCIse21ldGFLZXk6dC5tZXRhS2V5LGN0cmxLZXk6dC5jdHJsS2V5LGFsdEtleTp0LmFsdEtleSxzaGlmdEtleTp0LnNoaWZ0S2V5fSk7ZSh0LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoaSkuZm9jdXMoKX0pLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWxlYWYgPiAuanN0cmVlLW9jbFwiLGUucHJveHkoZnVuY3Rpb24odCl7dC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTt2YXIgaT1lLkV2ZW50KFwiY2xpY2tcIix7bWV0YUtleTp0Lm1ldGFLZXksY3RybEtleTp0LmN0cmxLZXksYWx0S2V5OnQuYWx0S2V5LHNoaWZ0S2V5OnQuc2hpZnRLZXl9KTtlKHQuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihpKS5mb2N1cygpfSx0aGlzKSkub24oXCJtb3VzZW92ZXIuanN0cmVlXCIsXCIuanN0cmVlLXdob2xlcm93LCAuanN0cmVlLWljb25cIixlLnByb3h5KGZ1bmN0aW9uKGUpe3JldHVybiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHRoaXMuaXNfZGlzYWJsZWQoZS5jdXJyZW50VGFyZ2V0KXx8dGhpcy5ob3Zlcl9ub2RlKGUuY3VycmVudFRhcmdldCksITF9LHRoaXMpKS5vbihcIm1vdXNlbGVhdmUuanN0cmVlXCIsXCIuanN0cmVlLW5vZGVcIixlLnByb3h5KGZ1bmN0aW9uKGUpe3RoaXMuZGVob3Zlcl9ub2RlKGUuY3VycmVudFRhcmdldCl9LHRoaXMpKX0sdGhpcy50ZWFyZG93bj1mdW5jdGlvbigpe3RoaXMuc2V0dGluZ3Mud2hvbGVyb3cmJnRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvd1wiKS5yZW1vdmUoKSxpLnRlYXJkb3duLmNhbGwodGhpcyl9LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24odCxyLHMsbil7aWYodD1pLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl7dmFyIGE9Zy5jbG9uZU5vZGUoITApOy0xIT09ZS5pbkFycmF5KHQuaWQsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkKSYmKGEuY2xhc3NOYW1lKz1cIiBqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKSx0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCYmdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9PT10LmlkJiYoYS5jbGFzc05hbWUrPVwiIGpzdHJlZS13aG9sZXJvdy1ob3ZlcmVkXCIpLHQuaW5zZXJ0QmVmb3JlKGEsdC5jaGlsZE5vZGVzWzBdKX1yZXR1cm4gdH19LGwucmVnaXN0ZXJFbGVtZW50JiZPYmplY3QmJk9iamVjdC5jcmVhdGUpe3ZhciBmPU9iamVjdC5jcmVhdGUoSFRNTEVsZW1lbnQucHJvdG90eXBlKTtmLmNyZWF0ZWRDYWxsYmFjaz1mdW5jdGlvbigpe3ZhciB0LGk9e2NvcmU6e30scGx1Z2luczpbXX07Zm9yKHQgaW4gZS5qc3RyZWUucGx1Z2lucyllLmpzdHJlZS5wbHVnaW5zLmhhc093blByb3BlcnR5KHQpJiZ0aGlzLmF0dHJpYnV0ZXNbdF0mJihpLnBsdWdpbnMucHVzaCh0KSx0aGlzLmdldEF0dHJpYnV0ZSh0KSYmSlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZSh0KSkmJihpW3RdPUpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUodCkpKSk7Zm9yKHQgaW4gZS5qc3RyZWUuZGVmYXVsdHMuY29yZSllLmpzdHJlZS5kZWZhdWx0cy5jb3JlLmhhc093blByb3BlcnR5KHQpJiZ0aGlzLmF0dHJpYnV0ZXNbdF0mJihpLmNvcmVbdF09SlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZSh0KSl8fHRoaXMuZ2V0QXR0cmlidXRlKHQpKTtlKHRoaXMpLmpzdHJlZShpKX07dHJ5e2wucmVnaXN0ZXJFbGVtZW50KFwidmFrYXRhLWpzdHJlZVwiLHtwcm90b3R5cGU6Zn0pfWNhdGNoKHApe319fX0pOyIsIi8qXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9kZWl0Y2gvanN0cmVlLWdyaWRcbiAqXG4gKiBUaGlzIHBsdWdpbiBoYW5kbGVzIGFkZGluZyBhIGdyaWQgdG8gYSB0cmVlIHRvIGRpc3BsYXkgYWRkaXRpb25hbCBkYXRhXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlOlxuICogICBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICpcbiAqIFdvcmtzIG9ubHkgd2l0aCBqc3RyZWUgdmVyc2lvbiA+PSAzLjAuMFxuICpcbiAqICREYXRlOiAyMDE1LTExLTI5ICRcbiAqICRSZXZpc2lvbjogIDMuNC4yICRcbiAqL1xuIWZ1bmN0aW9uKGUpe1wiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wianF1ZXJ5XCIsXCJqc3RyZWVcIl0sZSk6ZShqUXVlcnkpfShmdW5jdGlvbihlKXt2YXIgdCxpLHIscyxkLG49L15cXHMqJC9nLGE9L1tcXFxcOiYhXnwoKVxcW1xcXTw+QConK34jXCI7LD0gXFwvJHt9JV0vZyxvPWZ1bmN0aW9uKGUpe3JldHVybihlfHxcIlwiKS5yZXBsYWNlKGEsXCJcXFxcJCZcIil9LGw9XCJkYXRhLWpzdHJlZWdyaWRcIixoPVwiX0RBVEFfXCIsYz0yNCxwPSExLGc9XCJqc2dyaWRfXCIsdT1cIl9jb2xcIixmPTEwLHY9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5maW5kKFwiZGl2W1wiK2wrXCI9J1wiK3QrXCInXVwiKX0sbT0hMSxqPW51bGwsXz0wLHc9MDtzPS88XFwvP1tePl0rPi9naSxyPWZ1bmN0aW9uKHQsaSl7dmFyIHIscyxkLG47cmV0dXJuIGkuX2dyaWRTZXR0aW5ncz1pLl9ncmlkU2V0dGluZ3N8fHt9LGkuX2dyaWRTZXR0aW5ncy5pbmRlbnQ+MD9uPWkuX2dyaWRTZXR0aW5ncy5pbmRlbnQ6KHI9ZShcIjxkaXY+PC9kaXY+XCIpLHM9dC5wcmV2KFwiaVwiKSxkPXMucGFyZW50KCksci5hZGRDbGFzcyhpLmdldF9ub2RlKFwiI1wiLCEwKS5hdHRyKFwiY2xhc3NcIikpLGQuYXBwZW5kVG8ociksci5hcHBlbmRUbyhlKFwiYm9keVwiKSksbj1zLndpZHRoKCl8fGMsZC5kZXRhY2goKSxyLnJlbW92ZSgpLGkuX2dyaWRTZXR0aW5ncy5pbmRlbnQ9biksbn0sZD1mdW5jdGlvbihlLHQpe3ZhciBpLHI9ZS5nZXRfbm9kZSh0KSxzPXIuY2hpbGRyZW47cmV0dXJuIGk9IXN8fHMubGVuZ3RoPD0wfHwhci5zdGF0ZS5vcGVuZWQ/dDpkKGUsc1tzLmxlbmd0aC0xXSl9LHQ9ZnVuY3Rpb24oZSx0KXt2YXIgaSxzLGQ9cGFyc2VJbnQodC5zZXR0aW5ncy5ncmlkLmNvbHVtbnNbMF0ud2lkdGgsMTApK3BhcnNlSW50KHQuX2dyaWRTZXR0aW5ncy50cmVlV2lkdGhEaWZmLDEwKTtyZXR1cm4gaT10LmdldF9ub2RlKGUpLnBhcmVudHMubGVuZ3RoLHM9ZC1pKnIoZSx0KSxkfSxpPWZ1bmN0aW9uKGUsdCxpKXt2YXIgcixkPVwiYVwiPT09ZS5nZXQoMCkudGFnTmFtZS50b0xvd2VyQ2FzZSgpP2U6ZS5jaGlsZHJlbihcImFcIiksbj1pLnNldHRpbmdzLmdyaWQuY29sdW1uc1swXTtyPVwiXCIsbi50aXRsZSYmKG4udGl0bGU9PT1oP3I9aS5nZXRfdGV4dCh0KTp0LmF0dHIobi50aXRsZSkmJihyPXQuYXR0cihuLnRpdGxlKSkpLHI9ci5yZXBsYWNlKHMsXCJcIiksciYmZC5hdHRyKFwidGl0bGVcIixyKX0sZS5qc3RyZWUuZGVmYXVsdHMuZ3JpZD17d2lkdGg6XCJhdXRvXCJ9LGUuanN0cmVlLnBsdWdpbnMuZ3JpZD1mdW5jdGlvbih0LHIpe3RoaXMuX2luaXRpYWxpemU9ZnVuY3Rpb24oKXtpZighdGhpcy5faW5pdGlhbGl6ZWQpe3ZhciB0LGkscj10aGlzLnNldHRpbmdzLmdyaWR8fHt9LHM9dGhpcy5lbGVtZW50LGQ9cy5wYXJlbnQoKSxuPXRoaXMuX2dyaWRTZXR0aW5ncz17Y29sdW1uczpyLmNvbHVtbnN8fFtdLHRyZWVDbGFzczpcImpzdHJlZS1ncmlkLWNvbC0wXCIsY29udGV4dDpyLmNvbnRleHRtZW51fHwhMSxjb2x1bW5XaWR0aDpyLmNvbHVtbldpZHRoLGRlZmF1bHRDb25mOntcIipkaXNwbGF5XCI6XCJpbmxpbmVcIixcIiorZGlzcGxheVwiOlwiaW5saW5lXCJ9LGlzVGhlbWVyb2xsZXI6ISF0aGlzLl9kYXRhLnRoZW1lcm9sbGVyLHRyZWVXaWR0aERpZmY6MCxyZXNpemFibGU6ci5yZXNpemFibGUsc3RhdGVmdWw6ci5zdGF0ZWZ1bCxpbmRlbnQ6MH0sYT1uLmNvbHVtbnMsbz0wO2ZvcihpPTA7aTxyLmNvbHVtbnMubGVuZ3RoO2krKylpZihyLmNvbHVtbnNbaV0udHJlZSl7bz1pO2JyZWFrfXRoaXMudW5pcT1NYXRoLmNlaWwoMWUzKk1hdGgucmFuZG9tKCkpLHRoaXMudHJlZWNvbD1vLHRoaXMucm9vdGlkPXMuYXR0cihcImlkXCIpO3ZhciBsPS9tc2llLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7aWYobCl7dmFyIGg9cGFyc2VGbG9hdChuYXZpZ2F0b3IuYXBwVmVyc2lvbi5zcGxpdChcIk1TSUVcIilbMV0pOzg+aCYmKG4uZGVmYXVsdENvbmYuZGlzcGxheT1cImlubGluZVwiLG4uZGVmYXVsdENvbmYuem9vbT1cIjFcIil9Zm9yKHB8fChwPSEwLHQ9W1wiLmpzdHJlZS1ncmlkLWNlbGwge3ZlcnRpY2FsLWFsaWduOiB0b3A7IG92ZXJmbG93OmhpZGRlbjttYXJnaW4tbGVmdDowO3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOiAxMDAlO3BhZGRpbmctbGVmdDo3cHg7d2hpdGUtc3BhY2U6IG5vd3JhcDt9XCIsXCIuanN0cmVlLWdyaWQtY2VsbCBzcGFuIHttYXJnaW4tcmlnaHQ6MHB4O21hcmdpbi1yaWdodDowcHg7KmRpc3BsYXk6aW5saW5lOyorZGlzcGxheTppbmxpbmU7d2hpdGUtc3BhY2U6IG5vd3JhcDt9XCIsXCIuanN0cmVlLWdyaWQtc2VwYXJhdG9yIHtwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjA7IHJpZ2h0OjA7IGhlaWdodDoyNHB4OyBtYXJnaW4tbGVmdDogLTJweDsgYm9yZGVyLXdpZHRoOiAwIDJweCAwIDA7ICpkaXNwbGF5OmlubGluZTsgKitkaXNwbGF5OmlubGluZTsgbWFyZ2luLXJpZ2h0OjBweDt3aWR0aDowcHg7fVwiLFwiLmpzdHJlZS1ncmlkLWhlYWRlci1jZWxsIHtvdmVyZmxvdzogaGlkZGVuOyB3aGl0ZS1zcGFjZTogbm93cmFwO3BhZGRpbmc6IDFweCAzcHggMnB4IDVweDt9XCIsXCIuanN0cmVlLWdyaWQtaGVhZGVyLXRoZW1lcm9sbGVyIHtib3JkZXI6IDA7IHBhZGRpbmc6IDFweCAzcHg7fVwiLFwiLmpzdHJlZS1ncmlkLWhlYWRlci1yZWd1bGFyIHtwb3NpdGlvbjpyZWxhdGl2ZTsgYmFja2dyb3VuZC1jb2xvcjogI0VCRjNGRDt9XCIsXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvciB7Y3Vyc29yOiBjb2wtcmVzaXplOyB3aWR0aDogMnB4O31cIixcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3ItcmVndWxhciB7Ym9yZGVyLWNvbG9yOiAjZDBkMGQwOyBib3JkZXItc3R5bGU6IHNvbGlkO31cIixcIi5qc3RyZWUtZ3JpZC1jZWxsLXRoZW1lcm9sbGVyIHtib3JkZXI6IG5vbmUgIWltcG9ydGFudDsgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQgIWltcG9ydGFudDt9XCIsXCIuanN0cmVlLWdyaWQtd3JhcHBlciB7d2lkdGg6IDEwMCU7IG92ZXJmbG93LXg6IGF1dG87fVwiLFwiLmpzdHJlZS1ncmlkLW1pZHdyYXBwZXIge2Rpc3BsYXk6IHRhYmxlLXJvdzsgb3ZlcmZsb3c6IHZpc2libGU7fVwiLFwiLmpzdHJlZS1ncmlkLXdpZHRoLWF1dG8ge3dpZHRoOmF1dG87ZGlzcGxheTpibG9jazt9XCIsXCIuanN0cmVlLWdyaWQtY29sdW1uIHtkaXNwbGF5OiB0YWJsZS1jZWxsOyBvdmVyZmxvdzogaGlkZGVuO31cIixcIi5qc3RyZWUtZ3JpZC1jb2wtMCB7d2lkdGg6IDEwMCU7fVwiXSxlKCc8c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+Jyt0LmpvaW4oXCJcXG5cIikrXCI8L3N0eWxlPlwiKS5hcHBlbmRUbyhcImhlYWRcIikpLHRoaXMuZ3JpZFdyYXBwZXI9ZShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwianN0cmVlLWdyaWQtd3JhcHBlclwiKS5hcHBlbmRUbyhkKSx0aGlzLm1pZFdyYXBwZXI9ZShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwianN0cmVlLWdyaWQtbWlkd3JhcHBlclwiKS5hcHBlbmRUbyh0aGlzLmdyaWRXcmFwcGVyKSxyLndpZHRoJiZ0aGlzLmdyaWRXcmFwcGVyLndpZHRoKHIud2lkdGgpLGk9MDtpPGEubGVuZ3RoO2krKyllKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jb2x1bW4ganN0cmVlLWdyaWQtY29sdW1uLVwiK2krXCIganN0cmVlLWdyaWQtY29sdW1uLXJvb3QtXCIrdGhpcy5yb290aWQpLmFwcGVuZFRvKHRoaXMubWlkV3JhcHBlcik7dGhpcy5taWRXcmFwcGVyLmNoaWxkcmVuKFwiZGl2OmVxKFwiK28rXCIpXCIpLmFwcGVuZChzKSxzLmFkZENsYXNzKFwianN0cmVlLWdyaWQtY2VsbFwiKSx0aGlzLl9pbml0aWFsaXplZD0hMH19LHRoaXMuaW5pdD1mdW5jdGlvbihlLHQpe3IuaW5pdC5jYWxsKHRoaXMsZSx0KSx0aGlzLl9pbml0aWFsaXplKCl9LHRoaXMuYmluZD1mdW5jdGlvbigpe3IuYmluZC5jYWxsKHRoaXMpLHRoaXMuX2luaXRpYWxpemUoKSx0aGlzLmVsZW1lbnQub24oXCJtb3ZlX25vZGUuanN0cmVlIGNyZWF0ZV9ub2RlLmpzdHJlZSBjbGVhbl9ub2RlLmpzdHJlZSBjaGFuZ2Vfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dGhpcy5nZXRfbm9kZSh0fHxcIiNcIiwhMCk7cmV0dXJuICcnLCExfSx0aGlzKSkub24oXCJkZWxldGVfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7aWYodm9pZCAwIT09dC5ub2RlLmlkKXt2YXIgaSxyPXRoaXMuZ3JpZFdyYXBwZXIscz1bdC5ub2RlLmlkXTtmb3IodC5ub2RlJiZ0Lm5vZGUuY2hpbGRyZW5fZCYmKHM9cy5jb25jYXQodC5ub2RlLmNoaWxkcmVuX2QpKSxpPTA7aTxzLmxlbmd0aDtpKyspdihyLHNbaV0pLnJlbW92ZSgpfX0sdGhpcykpLm9uKFwiY2xvc2Vfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dGhpcy5faGlkZV9ncmlkKHQubm9kZSl9LHRoaXMpKS5vbihcIm9wZW5fbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7fSx0aGlzKSkub24oXCJsb2FkX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe30sdGhpcykpLm9uKFwibG9hZGVkLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy5fcHJlcGFyZV9oZWFkZXJzKCksdGhpcy5lbGVtZW50LnRyaWdnZXIoXCJsb2FkZWRfZ3JpZC5qc3RyZWVcIil9LHRoaXMpKS5vbihcInJlYWR5LmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24odCxpKXt2YXIgcj10aGlzLmVsZW1lbnQuZmluZChcImxpIGE6Zmlyc3RcIikub3V0ZXJIZWlnaHQoKTtlKCc8c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+ZGl2LmpzdHJlZS1ncmlkLWNlbGwtcm9vdC0nK3RoaXMucm9vdGlkK1wiIHtsaW5lLWhlaWdodDogXCIrcitcInB4fTwvc3R5bGU+XCIpLmFwcGVuZFRvKFwiaGVhZFwiKSx0aGlzLmdyaWRXcmFwcGVyLmFkZENsYXNzKHRoaXMuZWxlbWVudC5hdHRyKFwiY2xhc3NcIikpfSx0aGlzKSkub24oXCJtb3ZlX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe3ZhciByPWkubmV3X2luc3RhbmNlLmVsZW1lbnQ7ci5maW5kKFwibGkgPiBhXCIpLmVhY2goZS5wcm94eShmdW5jdGlvbihlLHQpe30sdGhpcykpfSx0aGlzKSkub24oXCJob3Zlcl9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0LGkpe3ZhciByPXQubm9kZS5pZDtudWxsIT09dGhpcy5faG92ZXJfbm9kZSYmdm9pZCAwIT09dGhpcy5faG92ZXJfbm9kZSYmdih0aGlzLmdyaWRXcmFwcGVyLHRoaXMuX2hvdmVyX25vZGUpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIiksdGhpcy5faG92ZXJfbm9kZT1yLHYodGhpcy5ncmlkV3JhcHBlcixyKS5hZGRDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpfSx0aGlzKSkub24oXCJkZWhvdmVyX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQsaSl7dmFyIHI9dC5ub2RlLmlkO3RoaXMuX2hvdmVyX25vZGU9bnVsbCx2KHRoaXMuZ3JpZFdyYXBwZXIscikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKX0sdGhpcykpLm9uKFwic2VsZWN0X25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQsaSl7dmFyIHI9dC5ub2RlLmlkO3YodGhpcy5ncmlkV3JhcHBlcixyKS5hZGRDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLHRoaXMuZ2V0X25vZGUodC5ub2RlLmlkLCEwKS5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jZWxsXCIpLmFkZENsYXNzKFwianN0cmVlLWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImRlc2VsZWN0X25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQsaSl7dmFyIHI9dC5ub2RlLmlkO3YodGhpcy5ncmlkV3JhcHBlcixyKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpfSx0aGlzKSkub24oXCJkZXNlbGVjdF9hbGwuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQsaSl7dmFyIHIscz10Lm5vZGV8fFtdO2ZvcihyPTA7cjxzLmxlbmd0aDtyKyspdih0aGlzLmdyaWRXcmFwcGVyLHNbcl0pLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIil9LHRoaXMpKS5vbihcInNlYXJjaC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dmFyIGk9dGhpcy5ncmlkV3JhcHBlcjtyZXR1cm4gdGhpcy5fZGF0YS5zZWFyY2guc29tJiZ0Lm5vZGVzLmxlbmd0aCYmKGkuZmluZChcImRpdi5qc3RyZWUtZ3JpZC1jZWxsLXJlZ3VsYXJcIikuaGlkZSgpLHQubm9kZXMuYWRkKHQubm9kZXMucGFyZW50c1VudGlsKFwiLmpzdHJlZVwiKSkuZmlsdGVyKFwiLmpzdHJlZS1ub2RlXCIpLmVhY2goZnVuY3Rpb24oZSx0KXt2YXIgcj10LmlkO3ImJnYoaSxyKS5zaG93KCl9KSksITB9LHRoaXMpKS5vbihcImNsZWFyX3NlYXJjaC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZ3JpZFdyYXBwZXIuZmluZChcImRpdi5qc3RyZWUtZ3JpZC1jZWxsXCIpLnNob3coKSwhMH0sdGhpcykpLHRoaXMuX2dyaWRTZXR0aW5ncy5pc1RoZW1lcm9sbGVyJiZ0aGlzLmVsZW1lbnQub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dC5yc2x0Lm9iai5jaGlsZHJlbihcImFcIikubmV4dEFsbChcImRpdlwiKS5hZGRDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKX0sdGhpcykpLm9uKFwiZGVzZWxlY3Rfbm9kZS5qc3RyZWUgZGVzZWxlY3RfYWxsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0LnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpfSx0aGlzKSkub24oXCJob3Zlcl9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0LnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9LHRoaXMpKS5vbihcImRlaG92ZXJfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dC5yc2x0Lm9iai5jaGlsZHJlbihcImFcIikubmV4dEFsbChcImRpdlwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpfSx0aGlzKSksdGhpcy5fZ3JpZFNldHRpbmdzLnN0YXRlZnVsJiZ0aGlzLmVsZW1lbnQub24oXCJyZXNpemVfY29sdW1uLmpzdHJlZS1ncmlkXCIsZS5wcm94eShmdW5jdGlvbihlLHQsaSl7bG9jYWxTdG9yYWdlW1wianN0cmVlLXJvb3QtXCIrdGhpcy5yb290aWQrXCItY29sdW1uLVwiK3RdPWl9LHRoaXMpKX0sdGhpcy50ZWFyZG93bj1mdW5jdGlvbigpe3ZhciBlPXRoaXMuZ3JpZFdyYXBwZXIsdD10aGlzLmVsZW1lbnQsaT1lLnBhcmVudCgpO3QuZGV0YWNoKCksZS5yZW1vdmUoKSxpLmFwcGVuZCh0KSxyLnRlYXJkb3duLmNhbGwodGhpcyl9LHRoaXMuX2NsZWFuX2dyaWQ9ZnVuY3Rpb24oZSx0KXt2YXIgaT10aGlzLmdyaWRXcmFwcGVyO2U/dihpLHQpLnJlbW92ZSgpOmkuZmluZChcImRpdi5qc3RyZWUtZ3JpZC1jZWxsLXJlZ3VsYXJcIikucmVtb3ZlKCl9LHRoaXMuX3ByZXBhcmVfaGVhZGVycz1mdW5jdGlvbigpe3ZhciB0LGkscixzLGQsbixhLG8sbCxoLGM9dGhpcy5fZ3JpZFNldHRpbmdzLHA9Yy5jb2x1bW5zfHxbXSxnPWMuY29sdW1uV2lkdGgsdT1jLnJlc2l6YWJsZXx8ITEsdj1jLmlzVGhlbWVyb2xsZXIseD12P1widGhlbWVyb2xsZXJcIjpcInJlZ3VsYXJcIix5PSExLEM9dGhpcy5ncmlkcGFyZW50LGI9dGhpcy5yb290aWQsVz1jLmRlZmF1bHRDb25mLFM9MCx6PTA7Zm9yKHRoaXMucGFyZW50PUMsaT0wO2k8cC5sZW5ndGg7aSsrKWQ9cFtpXS5oZWFkZXJDbGFzc3x8XCJcIixuPXBbaV0uY29sdW1uQ2xhc3N8fFwiXCIsYT1wW2ldLmhlYWRlcnx8XCJcIixhJiYoeT0hMCkscz1jLnN0YXRlZnVsJiZsb2NhbFN0b3JhZ2VbXCJqc3RyZWUtcm9vdC1cIitiK1wiLWNvbHVtbi1cIitpXT9sb2NhbFN0b3JhZ2VbXCJqc3RyZWUtcm9vdC1cIitiK1wiLWNvbHVtbi1cIitpXTpwW2ldLndpZHRofHxnLFM9dj83OjEwLFwiYXV0b1wiIT09cyYmXCJzdHJpbmdcIiE9dHlwZW9mIHMmJihzLT1TKSxvPTA9PT1pPzM6MCxyPXRoaXMubWlkV3JhcHBlci5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW4tXCIraSksbD1lKFwiPGRpdj48L2Rpdj5cIikuY3NzKFcpLmNzcyh7XCJtYXJnaW4tbGVmdFwiOm99KS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWRpdi1cIit0aGlzLnVuaXErXCItXCIraStcIiBcIisodj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCIganN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1jZWxsIGpzdHJlZS1ncmlkLWhlYWRlci1cIit4K1wiIFwiK2QrXCIgXCIrbikuaHRtbChhKSxsLmFkZENsYXNzKCh2P1widWktd2lkZ2V0LWhlYWRlciBcIjpcIlwiKStcImpzdHJlZS1ncmlkLWhlYWRlciBqc3RyZWUtZ3JpZC1oZWFkZXItXCIreCksbC5wcmVwZW5kVG8ocikseis9bC5vdXRlcldpZHRoKCksaD1lKFwiPGRpdiBjbGFzcz0nanN0cmVlLWdyaWQtc2VwYXJhdG9yIGpzdHJlZS1ncmlkLXNlcGFyYXRvci1cIit4Kyh2P1wiIHVpLXdpZGdldC1oZWFkZXJcIjpcIlwiKSsodT9cIiBqc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCI6XCJcIikrXCInPiZuYnNwOzwvZGl2PlwiKS5hcHBlbmRUbyhsKSxyLndpZHRoKHMpLHIuY3NzKFwibWluLXdpZHRoXCIscyksci5jc3MoXCJtYXgtd2lkdGhcIixzKTtsLmFkZENsYXNzKCh2P1widWktd2lkZ2V0LWhlYWRlciBcIjpcIlwiKStcImpzdHJlZS1ncmlkLWhlYWRlciBqc3RyZWUtZ3JpZC1oZWFkZXItbGFzdCBqc3RyZWUtZ3JpZC1oZWFkZXItXCIreCksdm9pZCAwPT09cFtwLmxlbmd0aC0xXS53aWR0aCYmKHotPXMsci5jc3Moe3dpZHRoOlwiYXV0b1wifSksbC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdpZHRoLWF1dG9cIikubmV4dChcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3JcIikucmVtb3ZlKCkpLHk/Yy5oZWFkZXI9dDplKFwiZGl2LmpzdHJlZS1ncmlkLWhlYWRlclwiKS5oaWRlKCksIXRoaXMuYm91bmQmJnUmJih0aGlzLmJvdW5kPSEwLGUoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24oKXt2YXIgdCxpLHIscyxkLG47bSYmKG49ai5wcmV2QWxsKFwiLmpzdHJlZS1ncmlkLWNvbHVtblwiKS5sZW5ndGgsZD1qLmNsb3Nlc3QoXCIuanN0cmVlLWdyaWQtd3JhcHBlclwiKS5maW5kKFwiLmpzdHJlZVwiKSx0PWUuanN0cmVlLnJlZmVyZW5jZShkKSxpPXQuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zLHM9ai5wYXJlbnQoKS5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIiksKGlzTmFOKG4pfHwwPm4pJiYodC5fZ3JpZFNldHRpbmdzLnRyZWVXaWR0aERpZmY9ZC5maW5kKFwiaW5zOmVxKDApXCIpLndpZHRoKCkrZC5maW5kKFwiYTplcSgwKVwiKS53aWR0aCgpLXQuX2dyaWRTZXR0aW5ncy5jb2x1bW5zWzBdLndpZHRoKSxyPXQuX2dyaWRTZXR0aW5ncy5jb2x1bW5zW25dLndpZHRoPXBhcnNlRmxvYXQoai5jc3MoXCJ3aWR0aFwiKSksbT0hMSxqPW51bGwsZC50cmlnZ2VyKFwicmVzaXplX2NvbHVtbi5qc3RyZWUtZ3JpZFwiLFtuLHJdKSl9KS5tb3VzZW1vdmUoZnVuY3Rpb24oZSl7aWYobSl7dz1lLnBhZ2VYO3ZhciB0LGkscixzPXctXzswIT09cyYmKHQ9ai53aWR0aCgpLGk9cGFyc2VGbG9hdChqLmNzcyhcIndpZHRoXCIpKSxpfHwoaT1qLmlubmVyV2lkdGgoKSkscz0wPnM/TWF0aC5tYXgocywtdCk6cyxyPWkrcywocz4wfHx0PjApJiZyPmYmJihqLndpZHRoKHIrXCJweFwiKSxqLmNzcyhcIm1pbi13aWR0aFwiLHIrXCJweFwiKSxqLmNzcyhcIm1heC13aWR0aFwiLHIrXCJweFwiKSxfPXcpKX19KSx0aGlzLmdyaWRXcmFwcGVyLm9uKFwic2VsZWN0c3RhcnRcIixcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsZnVuY3Rpb24oKXtyZXR1cm4hMX0pLm9uKFwibW91c2Vkb3duXCIsXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiLGZ1bmN0aW9uKHQpe3JldHVybiBtPSEwLF89dC5wYWdlWCxqPWUodGhpcykuY2xvc2VzdChcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIiksITF9KS5vbihcImRibGNsaWNrXCIsXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiLGZ1bmN0aW9uKHQpe3ZhciBpLHIscz1lKHRoaXMpLGQ9cy5jbG9zZXN0KFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKSxuPXBhcnNlRmxvYXQoZC5jc3MoXCJ3aWR0aFwiKSksYT0wLG89ZC5wcmV2QWxsKFwiLmpzdHJlZS1ncmlkLWNvbHVtblwiKS5sZW5ndGgsbD1kLndpZHRoKCk7ZC5maW5kKFwiLmpzdHJlZS1ncmlkLWNlbGxcIikuZWFjaChmdW5jdGlvbigpe3ZhciB0LGk9ZSh0aGlzKTtpLmNzcyhcInBvc2l0aW9uXCIsXCJhYnNvbHV0ZVwiKSxpLmNzcyhcIndpZHRoXCIsXCJhdXRvXCIpLHQ9aS5vdXRlcldpZHRoKCksaS5jc3MoXCJwb3NpdGlvblwiLFwicmVsYXRpdmVcIiksdD5hJiYoYT10KX0pLGk9YS1uLGk9MD5pP01hdGgubWF4KGksLWwpOmkscj1uK2krXCJweFwiLGQud2lkdGgociksZC5jc3MoXCJtaW4td2lkdGhcIixyKSxkLmNzcyhcIm1heC13aWR0aFwiLHIpLGUodGhpcykuY2xvc2VzdChcIi5qc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmZpbmQoXCIuanN0cmVlXCIpLnRyaWdnZXIoXCJyZXNpemVfY29sdW1uLmpzdHJlZS1ncmlkXCIsW28scl0pfSkpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGUsdCxpLHMpe3JldHVybiBlPXIucmVkcmF3X25vZGUuY2FsbCh0aGlzLGUsdCxpLHMpLGUmJnRoaXMuX3ByZXBhcmVfZ3JpZChlKSxlfSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY2xlYW5fZ3JpZCgpLHIucmVmcmVzaC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHRoaXMuc2V0X2lkPWZ1bmN0aW9uKGUsdCl7dmFyIGk7ZSYmKGk9ZS5pZCk7dmFyIHM9ci5zZXRfaWQuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKHMmJnZvaWQgMCE9PWkpe3ZhciBkLG49dGhpcy5ncmlkV3JhcHBlcixhPVtpXTtmb3IoZSYmZS5jaGlsZHJlbl9kJiYoYT1hLmNvbmNhdChlLmNoaWxkcmVuX2QpKSxkPTA7ZDxhLmxlbmd0aDtkKyspdihuLGFbZF0pLmF0dHIobCxlLmlkKS5hdHRyKFwiaWRcIixnK2UuaWQrdSsoZCsxKSkucmVtb3ZlQ2xhc3MoZytpK3UpLmFkZENsYXNzKGcrZS5pZCt1KX1yZXR1cm4gc30sdGhpcy5faGlkZV9ncmlkPWZ1bmN0aW9uKGUpe3ZhciB0LGk9ZSYmZS5jaGlsZHJlbl9kP2UuY2hpbGRyZW5fZDpbXTtmb3IodD0wO3Q8aS5sZW5ndGg7dCsrKXYodGhpcy5ncmlkV3JhcHBlcixpW3RdKS5yZW1vdmUoKX0sdGhpcy5ob2xkaW5nQ2VsbHM9e30sdGhpcy5nZXRIb2xkaW5nQ2VsbHM9ZnVuY3Rpb24odCxpLHIpe3ZhciBzLGQsbj1lKCksYT10LmNoaWxkcmVufHxbXTtmb3IoZD0wO2Q8YS5sZW5ndGg7ZCsrKXM9ZytvKGFbZF0pK3UraSxyW3NdJiZ0LnN0YXRlLm9wZW5lZCYmKG49bi5hZGQocltzXSkuYWRkKHRoaXMuZ2V0SG9sZGluZ0NlbGxzKHRoaXMuZ2V0X25vZGUoYVtkXSksaSxyKSkpO3JldHVybiBufSx0aGlzLl9lZGl0PWZ1bmN0aW9uKHQsaSxyKXtpZighdClyZXR1cm4hMTtpZighcilyZXR1cm4hMTtyPWUociksXCJkaXZcIj09PXIucHJvcChcInRhZ05hbWVcIikudG9Mb3dlckNhc2UoKSYmKHI9ci5jaGlsZHJlbihcInNwYW46Zmlyc3RcIikpO3ZhciBzPXRoaXMuX2RhdGEuY29yZS5ydGwsZD10aGlzLmVsZW1lbnQud2lkdGgoKSxuPXQuZGF0YVtpLnZhbHVlXSxhPWUoXCI8ZGl2IC8+XCIse2Nzczp7cG9zaXRpb246XCJhYnNvbHV0ZVwiLHRvcDpcIi0yMDBweFwiLGxlZnQ6cz9cIjBweFwiOlwiLTEwMDBweFwiLHZpc2liaWxpdHk6XCJoaWRkZW5cIn19KS5hcHBlbmRUbyhcImJvZHlcIiksbz1lKFwiPGlucHV0IC8+XCIse3ZhbHVlOm4sXCJjbGFzc1wiOlwianN0cmVlLXJlbmFtZS1pbnB1dFwiLGNzczp7cGFkZGluZzpcIjBcIixib3JkZXI6XCIxcHggc29saWQgc2lsdmVyXCIsXCJib3gtc2l6aW5nXCI6XCJib3JkZXItYm94XCIsZGlzcGxheTpcImlubGluZS1ibG9ja1wiLGhlaWdodDp0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0K1wicHhcIixsaW5lSGVpZ2h0OnRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQrXCJweFwiLHdpZHRoOlwiMTUwcHhcIn0sYmx1cjplLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGU9by52YWwoKTtcIlwiPT09ZXx8ZT09PW4/ZT1uOih0LmRhdGFbaS52YWx1ZV09ZSx0aGlzLmVsZW1lbnQudHJpZ2dlcihcInVwZGF0ZV9jZWxsLmpzdHJlZS1ncmlkXCIse25vZGU6dCxjb2w6aS52YWx1ZSx2YWx1ZTplLG9sZDpufSksdGhpcy5fcHJlcGFyZV9ncmlkKHRoaXMuZ2V0X25vZGUodCwhMCkpKSxvLnJlbW92ZSgpLHIuc2hvdygpfSx0aGlzKSxrZXlkb3duOmZ1bmN0aW9uKGUpe3ZhciB0PWUud2hpY2g7Mjc9PT10JiYodGhpcy52YWx1ZT1uKSwoMjc9PT10fHwxMz09PXR8fDM3PT09dHx8Mzg9PT10fHwzOT09PXR8fDQwPT09dHx8MzI9PT10KSYmZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwoMjc9PT10fHwxMz09PXQpJiYoZS5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuYmx1cigpKX0sY2xpY2s6ZnVuY3Rpb24oZSl7ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKX0sbW91c2Vkb3duOmZ1bmN0aW9uKGUpe2Uuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9LGtleXVwOmZ1bmN0aW9uKGUpe28ud2lkdGgoTWF0aC5taW4oYS50ZXh0KFwicFdcIit0aGlzLnZhbHVlKS53aWR0aCgpLGQpKX0sa2V5cHJlc3M6ZnVuY3Rpb24oZSl7cmV0dXJuIDEzPT09ZS53aGljaD8hMTp2b2lkIDB9fSksbD17Zm9udEZhbWlseTpyLmNzcyhcImZvbnRGYW1pbHlcIil8fFwiXCIsZm9udFNpemU6ci5jc3MoXCJmb250U2l6ZVwiKXx8XCJcIixmb250V2VpZ2h0OnIuY3NzKFwiZm9udFdlaWdodFwiKXx8XCJcIixmb250U3R5bGU6ci5jc3MoXCJmb250U3R5bGVcIil8fFwiXCIsZm9udFN0cmV0Y2g6ci5jc3MoXCJmb250U3RyZXRjaFwiKXx8XCJcIixmb250VmFyaWFudDpyLmNzcyhcImZvbnRWYXJpYW50XCIpfHxcIlwiLGxldHRlclNwYWNpbmc6ci5jc3MoXCJsZXR0ZXJTcGFjaW5nXCIpfHxcIlwiLHdvcmRTcGFjaW5nOnIuY3NzKFwid29yZFNwYWNpbmdcIil8fFwiXCJ9O3IuaGlkZSgpLHIucGFyZW50KCkuYXBwZW5kKG8pLG8uY3NzKGwpLndpZHRoKE1hdGgubWluKGEudGV4dChcInBXXCIrb1swXS52YWx1ZSkud2lkdGgoKSxkKSlbMF0uc2VsZWN0KCl9LHRoaXMuX3ByZXBhcmVfZ3JpZD1mdW5jdGlvbih0KXt2YXIgcixhLGgsYyxwLGYsbSxqLF8sdyx4LHksQyxiLFcsUyx6LGssVCxBLFAsRixWLHEsRCxMLE0sTixJLEI9dGhpcy5fZ3JpZFNldHRpbmdzLEg9Qi50cmVlQ2xhc3MsRT10aGlzLFU9Qi5jb2x1bW5zfHxbXSxYPUIuaXNUaGVtZXJvbGxlciwkPXRoaXMuZWxlbWVudCxRPXRoaXMucm9vdGlkLFk9WD9cInRoZW1lcm9sbGVyXCI6XCJyZWd1bGFyXCIsRz10aGlzLmdldF9ub2RlKHQpLEo9Qi5jb2x1bW5XaWR0aCxLPUIuZGVmYXVsdENvbmYsTz1mdW5jdGlvbih0LGkscixzLGQpe3JldHVybiBmdW5jdGlvbihkKXtpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikudHJpZ2dlcihcImNsaWNrLmpzdHJlZVwiLGQpLHQudHJpZ2dlcihcInNlbGVjdF9jZWxsLmpzdHJlZS1ncmlkXCIsW3t2YWx1ZTpyLGNvbHVtbjpzLmhlYWRlcixub2RlOmksZ3JpZDplKHRoaXMpLHNvdXJjZU5hbWU6cy52YWx1ZX1dKX19LFI9ZnVuY3Rpb24odCxpLHIscyxkKXtyZXR1cm4gZnVuY3Rpb24odCl7Qi5jb250ZXh0JiYodC5wcmV2ZW50RGVmYXVsdCgpLGUudmFrYXRhLmNvbnRleHQuc2hvdyh0aGlzLHt4OnQucGFnZVgseTp0LnBhZ2VZfSx7ZWRpdDp7bGFiZWw6XCJFZGl0XCIsYWN0aW9uOmZ1bmN0aW9uKGUpe3ZhciByPWQuZ2V0X25vZGUoaSk7RS5fZWRpdChyLHMsdC50YXJnZXQpfX19KSl9fSxaPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGZ1bmN0aW9uKCl7dC5ob3Zlcl9ub2RlKGUpfX0sZWU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZnVuY3Rpb24oKXt0LmRlaG92ZXJfbm9kZShlKX19LHRlPXRoaXMubWlkV3JhcHBlcixpZT1HLmlkLHJlPXRoaXMuZ2V0X25vZGUoRy5wYXJlbnQpLmNoaWxkcmVuLHNlPWpRdWVyeS5pbkFycmF5KGllLHJlKSxkZT10aGlzLmhvbGRpbmdDZWxscyxuZT0hMTtpZihyPWUodCksXz1yLmNoaWxkcmVuKFwiYVwiKSwxPT09Xy5sZW5ndGgpe2ZvcihJPSFHLnN0YXRlLm9wZW5lZCxTPWcrbyhpZSkrdSx6PVwiI1wiPT09Ry5wYXJlbnQ/bnVsbDpHLnBhcmVudCxfLmFkZENsYXNzKEgpLGkoXyxyLEUpLHc9XyxjPTA7YzxVLmxlbmd0aDtjKyspdGhpcy50cmVlY29sIT09YyYmKEQ9VVtjXSxOPXRlLmNoaWxkcmVuKFwiZGl2OmVxKFwiK2MrXCIpXCIpLGY9RC5jZWxsQ2xhc3N8fFwiXCIsbT1ELndpZGVDZWxsQ2xhc3N8fFwiXCIsaj1ELmNvbHVtbkNsYXNzfHxcIlwiLE4uYWRkQ2xhc3MoaikscD12b2lkIDAhPT1ELnZhbHVlJiZudWxsIT09RC52YWx1ZT9cImZ1bmN0aW9uXCI9PXR5cGVvZiBELnZhbHVlP0QudmFsdWUoRyk6bnVsbCE9PUcuZGF0YSYmdm9pZCAwIT09Ry5kYXRhJiZ2b2lkIDAhPT1HLmRhdGFbRC52YWx1ZV0/Ry5kYXRhW0QudmFsdWVdOlwiXCI6XCJcIixcImZ1bmN0aW9uXCI9PXR5cGVvZiBELmZvcm1hdCYmKHA9RC5mb3JtYXQocCkpLEQuaW1hZ2VzPyhoPUQuaW1hZ2VzW3BdfHxELmltYWdlc1tcImRlZmF1bHRcIl0saCYmKEw9XCIqXCI9PT1oWzBdPyc8c3BhbiBjbGFzcz1cIicraC5zdWJzdHIoMSkrJ1wiPjwvc3Bhbj4nOic8aW1nIHNyYz1cIicraCsnXCI+JykpOkw9cCwodm9pZCAwPT09THx8bnVsbD09PUx8fG4udGVzdChMKSkmJihMPVwiJm5ic3A7XCIpLHg9RC52YWx1ZUNsYXNzJiZudWxsIT09Ry5kYXRhJiZ2b2lkIDAhPT1HLmRhdGE/Ry5kYXRhW0QudmFsdWVDbGFzc118fFwiXCI6XCJcIix4JiZELnZhbHVlQ2xhc3NQcmVmaXgmJlwiXCIhPT1ELnZhbHVlQ2xhc3NQcmVmaXgmJih4PUQudmFsdWVDbGFzc1ByZWZpeCt4KSx5PUQud2lkZVZhbHVlQ2xhc3MmJm51bGwhPT1HLmRhdGEmJnZvaWQgMCE9PUcuZGF0YT9HLmRhdGFbRC53aWRlVmFsdWVDbGFzc118fFwiXCI6XCJcIix5JiZELndpZGVWYWx1ZUNsYXNzUHJlZml4JiZcIlwiIT09RC53aWRlVmFsdWVDbGFzc1ByZWZpeCYmKHk9RC53aWRlVmFsdWVDbGFzc1ByZWZpeCt5KSxXPUQudGl0bGUmJm51bGwhPT1HLmRhdGEmJnZvaWQgMCE9PUcuZGF0YT9HLmRhdGFbRC50aXRsZV18fFwiXCI6XCJcIixXPVcucmVwbGFjZShzLFwiXCIpLGI9NyxhPUQud2lkdGh8fEosXCJhdXRvXCIhPT1hJiYoYT1NfHxhLWIpLHc9dihOLGllKSwoIXd8fHcubGVuZ3RoPDEpJiYodz1lKFwiPGRpdj48L2Rpdj5cIiksZShcIjxzcGFuPjwvc3Bhbj5cIikuYXBwZW5kVG8odyksdy5hdHRyKFwiaWRcIixTK2MpLHcuYWRkQ2xhc3MoUyksdy5hdHRyKGwsaWUpKSxBPTA+PXNlP0cucGFyZW50OmQodGhpcyxyZVtzZS0xXSksVD12KE4sQSksRj1zZT49cmUubGVuZ3RoLTE/XCJOVUxMXCI6cmVbc2UrMV0sUD12KE4sRikscT1HLmNoaWxkcmVuJiZHLmNoaWxkcmVuLmxlbmd0aD4wP0cuY2hpbGRyZW5bMF06XCJOVUxMXCIsVj12KE4scSksaz12KE4seiksej8oayYmay5sZW5ndGg+MD8oVCYmVC5sZW5ndGg+MD93Lmluc2VydEFmdGVyKFQpOlYmJlYubGVuZ3RoPjA/dy5pbnNlcnRCZWZvcmUoVik6UCYmUC5sZW5ndGg+MD93Lmluc2VydEJlZm9yZShQKTp3Lmluc2VydEFmdGVyKGspLG5lPSEwKTpuZT0hMSxkZVtTK2NdPXcpOihUJiZULmxlbmd0aD4wP3cuaW5zZXJ0QWZ0ZXIoVCk6ViYmVi5sZW5ndGg+MD93Lmluc2VydEJlZm9yZShWKTpQJiZQLmxlbmd0aD4wP3cuaW5zZXJ0QmVmb3JlKFApOncuYXBwZW5kVG8oTiksbmU9ITApLG5lJiZ3LmFmdGVyKHRoaXMuZ2V0SG9sZGluZ0NlbGxzKEcsYyxkZSkpLEM9dy5jaGlsZHJlbihcInNwYW5cIiksQy5hZGRDbGFzcyhmK1wiIFwiK3gpLmh0bWwoTCksdz13LmNzcyhLKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGwganN0cmVlLWdyaWQtY2VsbC1yZWd1bGFyIGpzdHJlZS1ncmlkLWNlbGwtcm9vdC1cIitRK1wiIGpzdHJlZS1ncmlkLWNlbGwtXCIrWStcIiBcIittK1wiIFwiK3krKFg/XCIgdWktc3RhdGUtZGVmYXVsdFwiOlwiXCIpKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNvbC1cIitjKSx3LmNsaWNrKE8oJCxyLHAsRCx0aGlzKSksdy5vbihcImNvbnRleHRtZW51XCIsUigkLHIscCxELHRoaXMpKSx3LmhvdmVyKFoocix0aGlzKSxlZShyLHRoaXMpKSxXJiZDLmF0dHIoXCJ0aXRsZVwiLFcpKTt3LmFkZENsYXNzKFwianN0cmVlLWdyaWQtY2VsbC1sYXN0XCIrKFg/XCIgdWktc3RhdGUtZGVmYXVsdFwiOlwiXCIpKSx2b2lkIDA9PT1VW1UubGVuZ3RoLTFdLndpZHRoJiZ3LmFkZENsYXNzKFwianN0cmVlLWdyaWQtd2lkdGgtYXV0b1wiKS5uZXh0KFwiLmpzdHJlZS1ncmlkLXNlcGFyYXRvclwiKS5yZW1vdmUoKX10aGlzLmVsZW1lbnQuY3NzKHtcIm92ZXJmbG93LXlcIjpcImF1dG8gIWltcG9ydGFudFwifSl9LHRoaXMuaG9sZGluZ0NlbGxzPXt9fX0pOyIsIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gTkFNRVNQQUNFU1xuLyoqXG4gKiBAbW9kdWxlIENNU1xuICovXG52YXIgQ01TID0gd2luZG93LkNNUyB8fCB7fTtcblxuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbi8vIE1PREFMXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcGFnZXRyZWUgaXMgbG9hZGVkIHZpYSBgL2FkbWluL2Ntcy9wYWdlYCBhbmQgaGFzIGEgY3VzdG9tIGFkbWluXG4gICAgICogdGVtcGxhdGVzIHN0b3JlZCB3aXRoaW4gYHRlbXBsYXRlcy9hZG1pbi9jbXMvcGFnZS90cmVlYC5cbiAgICAgKlxuICAgICAqIEBjbGFzcyBQYWdlVHJlZVxuICAgICAqIEBuYW1lc3BhY2UgQ01TXG4gICAgICogQHVzZXMgQ01TLkFQSS5IZWxwZXJzXG4gICAgICovXG4gICAgQ01TLlBhZ2VUcmVlID0gbmV3IENNUy5DbGFzcyh7XG4gICAgICAgIC8vIFRPRE8gYWRkIG1lY2hhbmljcyB0byBzZXQgdGhlIGhvbWUgcGFnZVxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIC8vIG9wdGlvbnMgYXJlIGxvYWRlZCBmcm9tIHRoZSBwYWdldHJlZSBodG1sIG5vZGVcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdqc29uJyk7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgLy8gc3RhdGVzIGFuZCBldmVudHNcbiAgICAgICAgICAgIHRoaXMuY2xpY2sgPSAnY2xpY2suY21zLnBhZ2V0cmVlJztcbiAgICAgICAgICAgIHRoaXMuY2FjaGUgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IG51bGwsXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBudWxsLFxuICAgICAgICAgICAgICAgIHR5cGU6ICcnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zdWNjZXNzVGltZXIgPSAxMDAwO1xuXG4gICAgICAgICAgICAvLyBlbGVtZW50c1xuICAgICAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICAgICAgdGhpcy5fZXZlbnRzKCk7XG5cbiAgICAgICAgICAgIC8vIGNhbmNlbCBpZiBwYWd0cmVlIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KHRoaXMub3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdG9yZXMgYWxsIGpRdWVyeSByZWZlcmVuY2VzIHdpdGhpbiBgdGhpcy51aWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwVUlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cFVJOiBmdW5jdGlvbiBfc2V0dXBVSSgpIHtcbiAgICAgICAgICAgIHZhciBwYWdldHJlZSA9ICQoJy5jbXMtcGFnZXRyZWUnKTtcbiAgICAgICAgICAgIHRoaXMudWkgPSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiBwYWdldHJlZSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudDogJChkb2N1bWVudCksXG4gICAgICAgICAgICAgICAgdHJlZTogcGFnZXRyZWUuZmluZCgnLmpzLWNtcy1wYWdldHJlZScpLFxuICAgICAgICAgICAgICAgIGRpYWxvZzogJCgnLmpzLWNtcy10cmVlLWRpYWxvZycpLFxuICAgICAgICAgICAgICAgIHNpdGVGb3JtOiAkKCcuanMtY21zLXBhZ2V0cmVlLXNpdGUtZm9ybScpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXR0aW5nIHVwIHRoZSBqc3RyZWUgYW5kIHRoZSByZWxhdGVkIGNvbHVtbnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2V0dXA6IGZ1bmN0aW9uIF9zZXR1cCgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBjb2x1bW5zID0gW107XG4gICAgICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiB0aGlzLm9wdGlvbnMubGFuZy5jb2RlLFxuICAgICAgICAgICAgICAgIG9wZW5Ob2RlczogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBhamF4IHJlcXVlc3Qgc2VuZCB0aGUgY3NyZiB0b2tlblxuICAgICAgICAgICAgQ01TLkFQSS5IZWxwZXJzLmNzcmYodGhpcy5vcHRpb25zLmNzcmYpO1xuXG4gICAgICAgICAgICAvLyBzZXR1cCBjb2x1bW4gaGVhZGluZ3NcbiAgICAgICAgICAgICQuZWFjaCh0aGlzLm9wdGlvbnMuY29sdW1ucywgZnVuY3Rpb24gKGluZGV4LCBvYmopIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqLmtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0IHJvdyBpcyBhbHJlYWR5IHBvcHVsYXRlZCwgdG8gYXZvaWQgb3ZlcndyaXRlc1xuICAgICAgICAgICAgICAgICAgICAvLyBqdXN0IGxlYXZlIHRoZSBcImtleVwiIHBhcmFtIGVtcHR5XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IG9iai50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvYmoud2lkdGggfHwgJzElJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZGVDZWxsQ2xhc3M6IG9iai5jbHNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogb2JqLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgbmVlZHMgdG8gaGF2ZSB0aGUgXCJjb2xkZVwiIGZvcm1hdCBhbmQgbm90IFwiY29sLWRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhcyBqc3RyZWUgd2lsbCBjb252ZXJ0IFwiY29sLWRlXCIgdG8gXCJjb2xkZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxzbyB3ZSBzdHJpcCBkYXNoZXMsIGluIGNhc2UgbGFuZ3VhZ2UgY29kZSBjb250YWlucyBpdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGUuZy4gemgtaGFucywgemgtY24gZXRjXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5kYXRhWydjb2wnICsgb2JqLmtleS5yZXBsYWNlKCctJywgJycpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvYmoud2lkdGggfHwgJzElJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZGVDZWxsQ2xhc3M6IG9iai5jbHNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHByZXBhcmUgZGF0YVxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZmlsdGVyZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHRoaXMub3B0aW9ucy51cmxzLnRyZWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAnIycgaXMgcmVuZGVyZWQgaWYgaXRzIHRoZSByb290IG5vZGUsIHRoZXJlIHdlIG9ubHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhcmUgYWJvdXQgYG9iai5vcGVuTm9kZXNgLCBpbiB0aGUgZm9sbG93aW5nIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGFyZSByZXF1ZXN0aW5nIGEgc3BlY2lmaWMgbm9kZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuaWQgIT09ICcjJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdlSWQgPSB0aGF0Ll9zdG9yZU5vZGVJZChub2RlLmRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucGFnZUlkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzdG9yZSB0aGUgb3BlbmVkIGl0ZW1zIGluc2lkZSB0aGUgbG9jYWxzdG9yYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhcyB3ZSBoYXZlIHRvIGxvYWQgdGhlIHBhZ2V0cmVlIHdpdGggdGhlIHByZXZpb3VzIG9wZW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcGVuTm9kZXMgPSB0aGF0Ll9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gc2V0IHRoZSBzaXRlIGlkIHRvIGdldCB0aGUgY29ycmVjdCB0cmVlXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouc2l0ZSA9IHRoYXQub3B0aW9ucy5zaXRlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYmluZCBvcHRpb25zIHRvIHRoZSBqc3RyZWUgaW5zdGFuY2VcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoe1xuICAgICAgICAgICAgICAgIGNvcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSBvcGVuL2Nsb3NlIGFuaW1hdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiAwLFxuICAgICAgICAgICAgICAgICAgICAvLyBjb3JlIHNldHRpbmcgdG8gYWxsb3cgYWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICBjaGVja19jYWxsYmFjazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGRyYWdnaW5nIHdoZW4gZmlsdGVyaW5nIGlzIGFjdGl2ZSBieSBzZXR0aW5nIGBmYWxzZWBcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodGhhdC5vcHRpb25zLmZpbHRlcmVkKSA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cuanN0cmVlLmNvbS9hcGkvIy8/Zj0kLmpzdHJlZS5kZWZhdWx0cy5jb3JlLmRhdGFcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgLy8gc3RyaW5ncyB1c2VkIHdpdGhpbiBqc3RyZWUgdGhhdCBhcmUgY2FsbGVkIHVzaW5nIGBnZXRfc3RyaW5nYFxuICAgICAgICAgICAgICAgICAgICBzdHJpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnTG9hZGluZyAuLi4nOiB0aGlzLm9wdGlvbnMubGFuZy5sb2FkaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ05ldyBub2RlJzogdGhpcy5vcHRpb25zLmxhbmcubmV3Tm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdub2Rlcyc6IHRoaXMub3B0aW9ucy5sYW5nLm5vZGVzXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRoZW1lczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2RqYW5nby1jbXMnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgdGhlIG11bHRpIHNlbGVjdGlvbiBvZiBub2RlcyBmb3Igbm93XG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gYWN0aXZhdGUgZHJhZyBhbmQgZHJvcCBwbHVnaW5cbiAgICAgICAgICAgICAgICBwbHVnaW5zIDogWydkbmQnLCAnc2VhcmNoJywgJ2dyaWQnXSxcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy5qc3RyZWUuY29tL2FwaS8jLz9mPSQuanN0cmVlLmRlZmF1bHRzLmRuZFxuICAgICAgICAgICAgICAgIGRuZDoge1xuICAgICAgICAgICAgICAgICAgICBpbnNpZGVfcG9zOiAnbGFzdCcsXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgdGhlIG11bHRpIHNlbGVjdGlvbiBvZiBub2RlcyBmb3Igbm93XG4gICAgICAgICAgICAgICAgICAgIGRyYWdfc2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSBkcmFnZ2luZyBpZiBmaWx0ZXJlZFxuICAgICAgICAgICAgICAgICAgICBpc19kcmFnZ2FibGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodGhhdC5vcHRpb25zLmZpbHRlcmVkKSA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSBDTUQvQ1RSTCBjb3B5XG4gICAgICAgICAgICAgICAgICAgIGNvcHk6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkXG4gICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb2x1bW5zIGFyZSBwcm92aWRlZCBmcm9tIGJhc2UuaHRtbCBvcHRpb25zXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbHVtbnNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyB1cCBhbGwgdGhlIGV2ZW50IGhhbmRsZXJzLCBzdWNoIGFzIG9wZW5pbmcgYW5kIG1vdmluZy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBzZXQgZXZlbnRzIGZvciB0aGUgbm9kZUlkIHVwZGF0ZXNcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5vbignYWZ0ZXJfY2xvc2UuanN0cmVlJywgZnVuY3Rpb24gKGUsIGVsKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fcmVtb3ZlTm9kZUlkKGVsLm5vZGUuZGF0YS5pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5vbignYWZ0ZXJfb3Blbi5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgZWwpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zdG9yZU5vZGVJZChlbC5ub2RlLmRhdGEuaWQpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2NoZWNrSGVscGVycygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHN0b3JlIG1vdmVkIHBvc2l0aW9uIG5vZGVcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5vbignbW92ZV9ub2RlLmpzdHJlZSBjb3B5X25vZGUuanN0cmVlJywgZnVuY3Rpb24gKGUsIG9iaikge1xuICAgICAgICAgICAgICAgIGlmICghdGhhdC5jYWNoZS50eXBlIHx8IHRoYXQuY2FjaGUudHlwZSA9PT0gJ2N1dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fbW92ZU5vZGUodGhhdC5fZ2V0Tm9kZVBvc2l0aW9uKG9iaikpLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhhdC51aS50cmVlLmpzdHJlZSh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuX2hpZGVfZ3JpZChpbnN0YW5jZS5nZXRfbm9kZShvYmoucGFyZW50KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnBhcmVudCA9PT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIHRvIHJlZnJlc2ggcGFyZW50LCBiZWNhdXNlIHJlZnJlc2ggb25seVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnJlc2hlcyBjaGlsZHJlbiBvZiB0aGUgbm9kZSwgbmV2ZXIgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaF9ub2RlKG9iai5wYXJlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9jb3B5Tm9kZShvYmopO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIG9wZW4gdGhlIHBhcmVudCBub2RlIGlmIHdlIHRyaWdnZXIgYW4gZWxlbWVudFxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCBhbHJlYWR5IG9wZW5lZFxuICAgICAgICAgICAgICAgIHRoYXQudWkudHJlZS5qc3RyZWUoJ29wZW5fbm9kZScsIG9iai5wYXJlbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHNldCBldmVudCBmb3IgY3V0IGFuZCBwYXN0ZVxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1pdGVtLWN1dCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2N1dE9yQ29weSh7IHR5cGU6ICdjdXQnLCBlbGVtZW50OiAkKHRoaXMpIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHNldCBldmVudCBmb3IgY3V0IGFuZCBwYXN0ZVxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1pdGVtLWNvcHknLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9jdXRPckNvcHkoeyB0eXBlOiAnY29weScsIGVsZW1lbnQ6ICQodGhpcykgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byBwYXN0ZVxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5jbXMtdHJlZS1pdGVtLWhlbHBlcnMgYScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3Bhc3RlKGUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGFkdmFuY2VkIHNldHRpbmdzIGxpbmsgaGFuZGxpbmdcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssICcuanMtY21zLXRyZWUtYWR2YW5jZWQtc2V0dGluZ3MnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAkKHRoaXMpLmRhdGEoJ3VybCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhZGQgZXZlbnRzIGZvciBlcnJvciByZWxvYWQgKG1lc3NhZ2VsaXN0KVxuICAgICAgICAgICAgdGhpcy51aS5kb2N1bWVudC5vbih0aGlzLmNsaWNrLCAnLm1lc3NhZ2VsaXN0IC5jbXMtdHJlZS1yZWxvYWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBwcm9wYWduYXRlIHRoZSBzaXRlcyBkcm9wZG93biB0byB0aGUgaGlkZGVuIHNpdGVzIGZvcm1cbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtc2l0ZS10cmlnZ2VyJykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgLy8gcHJldmVudCBpZiBwYXJlbnQgaXMgYWN0aXZlXG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykucGFyZW50KCkuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhhdC51aS5zaXRlRm9ybS5maW5kKCdzZWxlY3QnKVxuICAgICAgICAgICAgICAgICAgICAudmFsKCQodGhpcykuZGF0YSgpLmlkKS5lbmQoKS5zdWJtaXQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhZGRpdGlvbmFsIGV2ZW50IGhhbmRsZXJzXG4gICAgICAgICAgICB0aGlzLl9zZXRGaWx0ZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX3NldFRvb2x0aXBzKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRTZWFyY2goKTtcblxuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFqYXggcG9zdCByZXF1ZXN0cyBhcmUgd29ya2luZ1xuICAgICAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1pdGVtLW1lbnUgYScpO1xuICAgICAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1sYW5nLXRyaWdnZXInKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGVscGVyIHRvIHByb2Nlc3MgdGhlIGN1dCBhbmQgY29weSBldmVudHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2N1dE9yQ29weVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdHNdXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy50eXBlXSBlaXRoZXIgJ2N1dCcgb3IgJ2NvcHknXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy5lbGVtZW50XSBvcmlnaW5hdGVkIHRyaWdnZXIgZWxlbWVudFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2N1dE9yQ29weTogZnVuY3Rpb24gX2N1dE9yQ29weShvYmopIHtcbiAgICAgICAgICAgIC8vIHByZXZlbnQgYWN0aW9ucyBpZiB5b3UgdHJ5IHRvIGNvcHkgYSBwYWdlIHdpdGggYW4gYXBwaG9va1xuICAgICAgICAgICAgaWYgKG9iai50eXBlID09PSAnY29weScgJiYgb2JqLmVsZW1lbnQuZGF0YSgpLmFwcGhvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dFcnJvcih0aGlzLm9wdGlvbnMubGFuZy5hcHBob29rKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBqc1RyZWVJZCA9IHRoaXMuX2dldE5vZGVJZChvYmouZWxlbWVudC5jbG9zZXN0KCcuanN0cmVlLWdyaWQtY2VsbCcpKTtcbiAgICAgICAgICAgIC8vIHJlc2V0cyBpZiB3ZSBjbGljayBhZ2FpblxuICAgICAgICAgICAgaWYgKHRoaXMuY2FjaGUudHlwZSA9PT0gb2JqLnR5cGUgJiYganNUcmVlSWQgPT09IHRoaXMuY2FjaGUuaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVIZWxwZXJzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gY2FjaGUgdGhlIG5vZGUgYW5kIHR5cGUgc28gYF9zaG93SGVscGVyc2BcbiAgICAgICAgICAgICAgICAvLyB3aWxsIHRyaWdnZXIgdGhlIGNvcnJlY3QgYmVoYXZpb3VyXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS50YXJnZXQgPSBvYmouZWxlbWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnR5cGUgPSBvYmoudHlwZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmlkID0ganNUcmVlSWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvd0hlbHBlcnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0hlbHBlcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGVscGVyIHRvIHByb2Nlc3MgdGhlIHBhc3RlIGV2ZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9wYXN0ZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGV2ZW50IG9yaWdpbmF0ZWQgZXZlbnQgaGFuZGxlclxuICAgICAgICAgKi9cbiAgICAgICAgX3Bhc3RlOiBmdW5jdGlvbiBfcGFzdGUoZXZlbnQpIHtcbiAgICAgICAgICAgIC8vIGhpZGUgaGVscGVycyBhZnRlciB3ZSBwaWNrZWQgb25lXG4gICAgICAgICAgICB0aGlzLl9oaWRlSGVscGVycygpO1xuXG4gICAgICAgICAgICB2YXIgY29weUZyb21JZCA9IHRoaXMuX2dldE5vZGVJZCh0aGlzLmNhY2hlLnRhcmdldCk7XG4gICAgICAgICAgICB2YXIgY29weVRvSWQgPSB0aGlzLl9nZXROb2RlSWQoJChldmVudC5jdXJyZW50VGFyZ2V0KSk7XG5cbiAgICAgICAgICAgIC8vIGNvcHlUb0lkIGNvbnRhaW5zIGBqc3RyZWUtMWAsIGFzc2lnbiB0byByb290XG4gICAgICAgICAgICBpZiAoY29weVRvSWQuaW5kZXhPZignanN0cmVlLTEnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgY29weVRvSWQgPSAnIyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNhY2hlLnR5cGUgPT09ICdjdXQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgnY3V0JywgY29weUZyb21JZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoJ2NvcHknLCBjb3B5RnJvbUlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgncGFzdGUnLCBjb3B5VG9JZCwgJ2xhc3QnKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUudHlwZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLnRhcmdldCA9IG51bGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJlaXZlcyBhIGxpc3Qgb2Ygbm9kZXMgZnJvbSBsb2NhbCBzdG9yYWdlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nZXRTdG9yZWROb2RlSWRzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEByZXR1cm4ge0FycmF5fSBsaXN0IG9mIGlkc1xuICAgICAgICAgKi9cbiAgICAgICAgX2dldFN0b3JlZE5vZGVJZHM6IGZ1bmN0aW9uIF9nZXRTdG9yZWROb2RlSWRzKCkge1xuICAgICAgICAgICAgcmV0dXJuIENNUy5zZXR0aW5ncy5wYWdldHJlZSB8fCBbXTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdG9yZU5vZGVJZFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgdG8gYmUgc3RvcmVkXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gaWQgdGhhdCBoYXMgYmVlbiBzdG9yZWRcbiAgICAgICAgICovXG4gICAgICAgIF9zdG9yZU5vZGVJZDogZnVuY3Rpb24gX3N0b3JlTm9kZUlkKGlkKSB7XG4gICAgICAgICAgICB2YXIgbnVtYmVyID0gaWQ7XG4gICAgICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuX2dldFN0b3JlZE5vZGVJZHMoKTtcblxuICAgICAgICAgICAgLy8gc3RvcmUgdmFsdWUgb25seSBpZiBpdCBpc24ndCB0aGVyZSB5ZXRcbiAgICAgICAgICAgIGlmIChzdG9yYWdlLmluZGV4T2YobnVtYmVyKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBzdG9yYWdlLnB1c2gobnVtYmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQ01TLnNldHRpbmdzLnBhZ2V0cmVlID0gc3RvcmFnZTtcbiAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncyhDTVMuc2V0dGluZ3MpO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9yZW1vdmVOb2RlSWRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIHRvIGJlIHN0b3JlZFxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGlkIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZFxuICAgICAgICAgKi9cbiAgICAgICAgX3JlbW92ZU5vZGVJZDogZnVuY3Rpb24gX3JlbW92ZU5vZGVJZChpZCkge1xuICAgICAgICAgICAgdmFyIG51bWJlciA9IGlkO1xuICAgICAgICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLl9nZXRTdG9yZWROb2RlSWRzKCk7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSBzdG9yYWdlLmluZGV4T2YobnVtYmVyKTtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGdpdmVuIGlkIGZyb20gc3RvcmFnZVxuICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHN0b3JhZ2Uuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQ01TLnNldHRpbmdzLnBhZ2V0cmVlID0gc3RvcmFnZTtcbiAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncyhDTVMuc2V0dGluZ3MpO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNb3ZlcyBhIG5vZGUgYWZ0ZXIgZHJhZyAmIGRyb3AuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX21vdmVOb2RlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c11cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLmlkXSBjdXJyZW50IGVsZW1lbnQgaWQgZm9yIHVybCBtYXRjaGluZ1xuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW29wdHMudGFyZ2V0XSB0YXJnZXQgc2libGluZyBvciBwYXJlbnRcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLnBvc2l0aW9uXSBlaXRoZXIgYGxlZnRgLCBgcmlnaHRgIG9yIGBsYXN0LWNoaWxkYFxuICAgICAgICAgKiBAcmV0dXJucyB7JC5EZWZlcnJlZH0gYWpheCByZXF1ZXN0IG9iamVjdFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX21vdmVOb2RlOiBmdW5jdGlvbiBfbW92ZU5vZGUob2JqKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICBvYmouc2l0ZSA9IHRoYXQub3B0aW9ucy5zaXRlO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgICAgICB1cmw6IHRoYXQub3B0aW9ucy51cmxzLm1vdmUucmVwbGFjZSgne2lkfScsIG9iai5pZCksXG4gICAgICAgICAgICAgICAgZGF0YTogb2JqXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zaG93U3VjY2VzcyhvYmouaWQpO1xuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb3BpZXMgYSBub2RlIGludG8gdGhlIHNlbGVjdGVkIG5vZGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NvcHlOb2RlXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb3B5RnJvbUlkIGVsZW1lbnQgdG8gYmUgY3V0XG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb3B5VG9JZCBkZXN0aW5hdGlvbiB0byBpbmplY3RcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jb3B5Tm9kZTogZnVuY3Rpb24gX2NvcHlOb2RlKG9iaikge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGF0Ll9nZXROb2RlUG9zaXRpb24ob2JqKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHNpdGU6IHRoaXMub3B0aW9ucy5zaXRlLFxuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVmZXIgdG8gdGhlIG9yaWdpbmFsIGl0ZW0gaGVyZSwgYXMgdGhlIGNvcGllZFxuICAgICAgICAgICAgICAgIC8vIG5vZGUgd2lsbCBoYXZlIG5vIGRhdGEgYXR0cmlidXRlcyBzdG9yZWQgYXQgaXQgKG5vdCBhIGNsb25lKVxuICAgICAgICAgICAgICAgIGlkOiBvYmoub3JpZ2luYWwuZGF0YS5pZCxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogbm9kZS5wb3NpdGlvblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdGFyZ2V0IHByb3ZpZGVkLCB0aGUgbm9kZSBsYW5kcyBpbiByb290XG4gICAgICAgICAgICBpZiAobm9kZS50YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnRhcmdldCA9IG5vZGUudGFyZ2V0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGxvYWQgYSBkaWFsb2cgZmlyc3QsIHRvIGNoZWNrIGlmIHBlcm1pc3Npb25zIHNob3VsZFxuICAgICAgICAgICAgLy8gYmUgY29waWVkIG9yIG5vdFxuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgICAgICB1cmw6IHRoYXQub3B0aW9ucy51cmxzLmNvcHlQZXJtaXNzaW9uLnJlcGxhY2UoJ3tpZH0nLCBkYXRhLmlkKSxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAvLyB0aGUgZGlhbG9nIGlzIGxvYWRlZCB2aWEgdGhlIGFqYXggcmVzcG9ucyBvcmlnaW5hdGluZyBmcm9tXG4gICAgICAgICAgICAvLyBgdGVtcGxhdGVzL2FkbWluL2Ntcy9wYWdlL3RyZWUvY29weV9wcmVtaXNzaW9ucy5odG1sYFxuICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGlhbG9nKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5kaWFsb2cuYXBwZW5kKGRpYWxvZyk7XG4gICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCBldmVudHMgdG8gdGhlIHBlcm1pc3Npb24gZGlhbG9nXG4gICAgICAgICAgICB0aGlzLnVpLmRpYWxvZy5vZmYodGhpcy5jbGljaywgJy5jYW5jZWwnKS5vbih0aGlzLmNsaWNrLCAnLmNhbmNlbCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBqdXN0IGNvcGllZCBub2RlXG4gICAgICAgICAgICAgICAgdGhhdC51aS50cmVlLmpzdHJlZSgnZGVsZXRlX25vZGUnLCBvYmoubm9kZS5pZCk7XG4gICAgICAgICAgICAgICAgJCgnLmpzLWNtcy1kaWFsb2cnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkKCcuanMtY21zLWRpYWxvZy1kaW1tZXInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pLm9mZih0aGlzLmNsaWNrLCAnLnN1Ym1pdCcpLm9uKHRoaXMuY2xpY2ssICcuc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJykuc2VyaWFsaXplKCkuc3BsaXQoJyYnKTtcbiAgICAgICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggZm9ybSBkYXRhIGFuZCBhdHRhY2ggdG8gb2JqXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmb3JtRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2Zvcm1EYXRhW2ldLnNwbGl0KCc9JylbMF1dID0gZm9ybURhdGFbaV0uc3BsaXQoJz0nKVsxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gc2VuZCB0aGUgcmVhbCBhamF4IHJlcXVlc3QgZm9yIGNvcHlpbmcgdGhlIHBsdWdpblxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHRoYXQub3B0aW9ucy51cmxzLmNvcHkucmVwbGFjZSgne2lkfScsIGRhdGEuaWQpLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybnMgZWxlbWVudCBmcm9tIGFueSBzdWIgbm9kZXMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2dldEVsZW1lbnRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGVsIGpRdWVyeSBub2RlIGZvcm0gd2hlcmUgdG8gc2VhcmNoXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ3xCb29sZWFufSBqc1RyZWUgbm9kZSBlbGVtZW50IGlkXG4gICAgICAgICAqL1xuICAgICAgICBfZ2V0Tm9kZUlkOiBmdW5jdGlvbiBfZ2V0RWxlbWVudChlbCkge1xuICAgICAgICAgICAgdmFyIGNscyA9IGVsLmNsb3Nlc3QoJy5qc3RyZWUtZ3JpZC1jZWxsJykuYXR0cignY2xhc3MnKTtcblxuICAgICAgICAgICAgcmV0dXJuIChjbHMpID8gY2xzLnJlcGxhY2UoLy4qanNncmlkXyguKz8pX2NvbC4qLywgJyQxJykgOiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0cyB0aGUgbmV3IG5vZGUgcG9zaXRpb24gYWZ0ZXIgbW92aW5nLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nZXROb2RlUG9zaXRpb25cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBqc3RyZWUgbW92ZSBvYmplY3RcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBldmFsdWF0ZWQgb2JqZWN0IHdpdGggcGFyYW1zXG4gICAgICAgICAqL1xuICAgICAgICBfZ2V0Tm9kZVBvc2l0aW9uOiBmdW5jdGlvbiBfZ2V0Tm9kZVBvc2l0aW9uKG9iaikge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgICAgICAgIHZhciBub2RlID0gdGhpcy51aS50cmVlLmpzdHJlZSgnZ2V0X25vZGUnLCBvYmoubm9kZS5wYXJlbnQpO1xuXG4gICAgICAgICAgICBkYXRhLnBvc2l0aW9uID0gb2JqLnBvc2l0aW9uO1xuXG4gICAgICAgICAgICAvLyBqc3RyZWUgaW5kaWNhdGVzIG5vIHBhcmVudCB3aXRoIGAjYCwgaW4gdGhpcyBjYXNlIHdlIGRvIG5vdFxuICAgICAgICAgICAgLy8gbmVlZCB0byBzZXQgdGhlIHRhcmdldCBhdHRyaWJ1dGUgYXQgYWxsXG4gICAgICAgICAgICBpZiAob2JqLnBhcmVudCAhPT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgZGF0YS50YXJnZXQgPSBub2RlLmRhdGEuaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNvbWUgZnVuY3Rpb25zIGxpa2UgY29weSBjcmVhdGUgYSBuZXcgZWxlbWVudCB3aXRoIGEgbmV3IGlkLFxuICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHdlIG5lZWQgdG8gc2V0IGBkYXRhLmlkYCBtYW51YWxseVxuICAgICAgICAgICAgaWYgKG9iai5ub2RlICYmIG9iai5ub2RlLmRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmlkID0gb2JqLm5vZGUuZGF0YS5pZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgZmlsdGVyIGJ1dHRvbiBkaXNwbGF5IChGaWx0ZXI6IE9mZikuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldEZpbHRlclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldEZpbHRlcjogZnVuY3Rpb24gX3NldEZpbHRlcigpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciB0cmlnZ2VyID0gJCgnLmpzLWNtcy10cmVlLWZpbHRlci10cmlnZ2VyJyk7XG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gJCgnLmpzLWNtcy10cmVlLWZpbHRlci1jb250YWluZXInKTtcblxuICAgICAgICAgICAgdHJpZ2dlci5vbih0aGlzLmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnRvZ2dsZUNsYXNzKCdoaWRkZW4nKTtcblxuICAgICAgICAgICAgICAgIHRoYXQudWkuZG9jdW1lbnQub25lKHRoYXQuY2xpY2ssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXIub24odGhhdC5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCBldmVudCBmb3Igc2l0ZSBmaWx0ZXJpbmdcbiAgICAgICAgICAgICQoJy5qcy1jbXMtdHJlZS1zZWFyY2gtc2l0ZSBzZWxlY3QnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnZm9ybScpLnN1Ym1pdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgZ2VuZXJhbCB0b29sdGlwcyB0aGF0IGNhbiBoYXZlIGEgbGlzdCBvZiBsaW5rcyBvciBjb250ZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXRUb29sdGlwc1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldFRvb2x0aXBzOiBmdW5jdGlvbiBfc2V0VG9vbHRpcHMoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgdHJpZ2dlckNscyA9ICcuanMtY21zLXRyZWUtdG9vbHRpcC10cmlnZ2VyJztcbiAgICAgICAgICAgIHZhciBjb250YWluZXJDbHMgPSAnLmpzLWNtcy10cmVlLXRvb2x0aXAtY29udGFpbmVyJztcbiAgICAgICAgICAgIHZhciB0cmlnZ2VycztcbiAgICAgICAgICAgIHZhciBjb250YWluZXJzO1xuICAgICAgICAgICAgdmFyIGluZGV4O1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnQgdG8gdGhlIHRyaWdnZXJcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXJDbHMsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICB0cmlnZ2VycyA9ICQodHJpZ2dlckNscyk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVycyA9ICQoY29udGFpbmVyQ2xzKTtcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRyaWdnZXJzLmluZGV4KHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIG9wZW5lZCB0b29sdGlwIGlzIHRyaWdnZXJlZCBhZ2FpblxuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJzLmVxKGluZGV4KS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzLnJlbW92ZUNsYXNzKCdjbXMtdHJlZS10b29sdGlwLWNvbnRhaW5lci1vcGVuJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ugc2hvdyB0aGUgZHJvcGRvd25cbiAgICAgICAgICAgICAgICBjb250YWluZXJzXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnY21zLXRyZWUtdG9vbHRpcC1jb250YWluZXItb3BlbicpXG4gICAgICAgICAgICAgICAgICAgIC5lcShpbmRleClcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdjbXMtdHJlZS10b29sdGlwLWNvbnRhaW5lci1vcGVuJyk7XG5cbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9uZSh0aGF0LmNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcnMucmVtb3ZlQ2xhc3MoJ2Ntcy10cmVlLXRvb2x0aXAtY29udGFpbmVyLW9wZW4nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBzdG9wIHByb3BhZ25hdGlvbiBvbiB0aGUgZWxlbWVudFxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgY29udGFpbmVyQ2xzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVHJpZ2dlcnMgdGhlIGxpbmtzIGBocmVmYCBhcyBhamF4IHBvc3QgcmVxdWVzdC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0QWpheFBvc3RcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IHRyaWdnZXIgalF1ZXJ5IGxpbmsgdGFyZ2V0XG4gICAgICAgICAqL1xuICAgICAgICBfc2V0QWpheFBvc3Q6IGZ1bmN0aW9uIF9zZXRBamF4UG9zdCh0cmlnZ2VyKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6ICQodGhpcykuYXR0cignaHJlZicpXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgaW4gdGhlIHNpZGVmcmFtZSB3ZSBoYXZlIHRvIGFjdHVhbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgcHVibGlzaGluZyBhIHBhZ2Ugd2UncmUgY3VycmVudGx5IGluXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIGlmIHRoZSBzbHVnIGRpZCBjaGFuZ2Ugd2Ugd291bGQgbmVlZCB0b1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gdGhhdCBuZXcgc2x1Z1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvYmxlbSBoZXJlIGlzIHRoYXQgaW4gY2FzZSBvZiB0aGUgYXBwaG9va2VkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBtb2RlbCBhbmQgcGsgYXJlIGVtcHR5IGFuZCByZWxvYWRCcm93c2VyIGRvZXNuJ3QgcmVhbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBhbnl0aGluZyAtIHNvIGhlcmUgd2Ugc3BlY2lmaWNhbGx5IGZvcmNlIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBiZSB0aGUgZGF0YSBhYm91dCB0aGUgcGFnZSBhbmQgbm90IHRoZSBtb2RlbFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9ICh3aW5kb3cucGFyZW50ID8gd2luZG93LnBhcmVudCA6IHdpbmRvdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGSVhNRSBzaG91bGRuJ3QgYmUgaGFyZGNvZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICdjbXMucGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGs6IHBhcmVudC5DTVMuY29uZmlnLnJlcXVlc3QucGFnZV9pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ugc2ltcGx5IHJlbG9hZCB0aGUgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVsb2FkSGVscGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIGV2ZW50cyBmb3IgdGhlIHNlYXJjaCBvbiB0aGUgaGVhZGVyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXRTZWFyY2hcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXRTZWFyY2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBmYWtlRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaCcpO1xuICAgICAgICAgICAgdmFyIHJlYWxGb3JtID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoLWNvcHkgZm9ybScpO1xuICAgICAgICAgICAgdmFyIGZha2VGaWVsZCA9IGZha2VGb3JtLmZpbmQoJy5jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaC1maWVsZCcpO1xuICAgICAgICAgICAgdmFyIHJlYWxGaWVsZCA9IHJlYWxGb3JtLmZpbmQoJyNzZWFyY2hiYXInKTtcblxuICAgICAgICAgICAgLy8gcHJlcG9wdWxhdGVcbiAgICAgICAgICAgIGZha2VGaWVsZC52YWwocmVhbEZpZWxkLnZhbCgpKTtcblxuICAgICAgICAgICAgLy8gZXZlbnRcbiAgICAgICAgICAgIGZha2VGb3JtLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICByZWFsRm9ybS5maW5kKCcjc2VhcmNoYmFyJylcbiAgICAgICAgICAgICAgICAgICAgLnZhbChmYWtlRmllbGQudmFsKCkpXG4gICAgICAgICAgICAgICAgICAgIC5lbmQoKVxuICAgICAgICAgICAgICAgICAgICAuc3VibWl0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvd3MgcGFzdGUgaGVscGVycy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2hvd0hlbHBlcnNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zaG93SGVscGVyczogZnVuY3Rpb24gX3Nob3dIZWxwZXJzKCkge1xuICAgICAgICAgICAgLy8gaGVscGVycyBhcmUgZ2VuZXJhdGVkIG9uIHRoZSBmbHksIHNvIHdlIG5lZWQgdG8gcmVmZXJlbmNlXG4gICAgICAgICAgICAvLyB0aGVtIGV2ZXJ5IHNpbmdsZSB0aW1lXG4gICAgICAgICAgICAkKCcuY21zLXRyZWUtaXRlbS1oZWxwZXJzJykucmVtb3ZlQ2xhc3MoJ2Ntcy1oaWRkZW4nKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlkZXMgcGFzdGUgaGVscGVycy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfaGlkZUhlbHBlcnNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9oaWRlSGVscGVyczogZnVuY3Rpb24gX2hpZGVIZWxwZXJzKCkge1xuICAgICAgICAgICAgLy8gaGVscGVycyBhcmUgZ2VuZXJhdGVkIG9uIHRoZSBmbHksIHNvIHdlIG5lZWQgdG8gcmVmZXJlbmNlXG4gICAgICAgICAgICAvLyB0aGVtIGV2ZXJ5IHNpbmdsZSB0aW1lXG4gICAgICAgICAgICAkKCcuY21zLXRyZWUtaXRlbS1oZWxwZXJzJykuYWRkQ2xhc3MoJ2Ntcy1oaWRkZW4nKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUuaWQgPSBudWxsO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVja3MgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGhlbHBlcnMgYWZ0ZXIgYGFmdGVyX29wZW4uanN0cmVlYFxuICAgICAgICAgKiBvciBgX2N1dE9yQ29weWAgaXMgdHJpZ2dlcmVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9jaGVja0hlbHBlcnNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jaGVja0hlbHBlcnM6IGZ1bmN0aW9uIF9jaGVja0hlbHBlcnMoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jYWNoZS50eXBlICYmIHRoaXMuY2FjaGUuaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93SGVscGVycyh0aGlzLmNhY2hlLnR5cGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBoaWRlIGN1dCBlbGVtZW50IGFuZCBpdCdzIGRlc2NlbmRhbnRzJyBwYXN0ZSBoZWxwZXJzIGlmIGl0IGlzIHZpc2libGVcbiAgICAgICAgICAgIGlmICh0aGlzLmNhY2hlLnR5cGUgPT09ICdjdXQnICYmIHRoaXMuY2FjaGUudGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlc2NlbmRhbnRJZHMgPSB0aGlzLnVpLnRyZWUuanN0cmVlKHRydWUpLmdldF9ub2RlKHRoaXMuY2FjaGUuaWQpLmNoaWxkcmVuX2Q7XG5cbiAgICAgICAgICAgICAgICBbdGhpcy5jYWNoZS5pZF0uY29uY2F0KGRlc2NlbmRhbnRJZHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5qc2dyaWRfJyArIGlkICsgJ19jb2wgLmNtcy10cmVlLWl0ZW0taGVscGVycycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2Ntcy1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvd3Mgc3VjY2VzcyBtZXNzYWdlIG9uIG5vZGUgYWZ0ZXIgc3VjY2Vzc2Z1bCBhY3Rpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Nob3dTdWNjZXNzXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpZCBpZCBvZiB0aGUgZWxlbWVudCB0byBhZGQgdGhlIHN1Y2Nlc3MgY2xhc3NcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zaG93U3VjY2VzczogZnVuY3Rpb24gX3Nob3dTdWNjZXNzKGlkKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMudWkudHJlZS5maW5kKCdsaVtkYXRhLWlkPVwiJyArIGlkICsgJ1wiXScpO1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnY21zLXRyZWUtbm9kZS1zdWNjZXNzJyk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgICAgIH0sIHRoaXMuc3VjY2Vzc1RpbWVyKTtcbiAgICAgICAgICAgIC8vIGhpZGUgZWxlbWVudHNcbiAgICAgICAgICAgIHRoaXMuX2hpZGVIZWxwZXJzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBpZiB3ZSBzaG91bGQgcmVsb2FkIHRoZSBpZnJhbWUgb3IgZW50aXJlIHdpbmRvdy4gRm9yIHRoaXMgd2VcbiAgICAgICAgICogbmVlZCB0byBza2lwIGBDTVMuQVBJLkhlbHBlcnMucmVsb2FkQnJvd3NlcigpO2AuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3JlbG9hZEhlbHBlclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3JlbG9hZEhlbHBlcjogZnVuY3Rpb24gX3JlbG9hZEhlbHBlcigpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcCkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzcGxheXMgYW4gZXJyb3Igd2l0aGluIHRoZSBkamFuZ28gVUkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2Qgc2hvd0Vycm9yXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIHN0cmluZyBtZXNzYWdlIHRvIGRpc3BsYXlcbiAgICAgICAgICovXG4gICAgICAgIHNob3dFcnJvcjogZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9ICQoJy5tZXNzYWdlbGlzdCcpO1xuICAgICAgICAgICAgdmFyIGJyZWFkY3J1bWIgPSAkKCcuYnJlYWRjcnVtYnMnKTtcbiAgICAgICAgICAgIHZhciByZWxvYWQgPSB0aGlzLm9wdGlvbnMubGFuZy5yZWxvYWQ7XG4gICAgICAgICAgICB2YXIgdHBsID0gJycgK1xuICAgICAgICAgICAgICAgICc8dWwgY2xhc3M9XCJtZXNzYWdlbGlzdFwiPicgK1xuICAgICAgICAgICAgICAgICcgICA8bGkgY2xhc3M9XCJlcnJvclwiPicgK1xuICAgICAgICAgICAgICAgICcgICAgICAge21zZ30gJyArXG4gICAgICAgICAgICAgICAgJyAgICAgICA8YSBocmVmPVwiI3JlbG9hZFwiIGNsYXNzPVwiY21zLXRyZWUtcmVsb2FkXCI+ICcgKyByZWxvYWQgKyAnIDwvYT4nICtcbiAgICAgICAgICAgICAgICAnICAgPC9saT4nICtcbiAgICAgICAgICAgICAgICAnPC91bD4nO1xuICAgICAgICAgICAgdmFyIG1zZyA9IHRwbC5yZXBsYWNlKCd7bXNnfScsICc8c3Ryb25nPicgKyB0aGlzLm9wdGlvbnMubGFuZy5lcnJvciArICc8L3N0cm9uZz4gJyArIG1lc3NhZ2UpO1xuXG4gICAgICAgICAgICBtZXNzYWdlcy5sZW5ndGggPyBtZXNzYWdlcy5yZXBsYWNlV2l0aChtc2cpIDogYnJlYWRjcnVtYi5hZnRlcihtc2cpO1xuICAgICAgICB9XG5cbiAgICB9KTtcblxuICAgIC8vIHNob3J0aGFuZCBmb3IgalF1ZXJ5KGRvY3VtZW50KS5yZWFkeSgpO1xuICAgICQoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBsb2FkIGNtcyBzZXR0aW5ncyBiZWZvcmVoYW5kXG4gICAgICAgIC8vIGhhdmUgdG8gc2V0IHRvb2xiYXIgdG8gXCJleHBhbmRlZFwiIGJ5IGRlZmF1bHRcbiAgICAgICAgLy8gb3RoZXJ3aXNlIGluaXRpYWxpemF0aW9uIHdpbGwgYmUgaW5jb3JyZWN0IHdoZW4geW91XG4gICAgICAgIC8vIGdvIGZpcnN0IHRvIHBhZ2VzIGFuZCB0aGVuIHRvIG5vcm1hbCBwYWdlXG4gICAgICAgIENNUy5jb25maWcgPSB7XG4gICAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgICAgIHRvb2xiYXI6ICdleHBhbmRlZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cmxzOiB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3M6ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdzZXR0aW5ncy11cmwnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBDTVMuc2V0dGluZ3MgPSBDTVMuQVBJLkhlbHBlcnMuZ2V0U2V0dGluZ3MoKTtcbiAgICAgICAgLy8gYXV0b2xvYWQgdGhlIHBhZ2V0cmVlXG4gICAgICAgIG5ldyBDTVMuUGFnZVRyZWUoKTtcbiAgICB9KTtcblxufSkoQ01TLiQpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9