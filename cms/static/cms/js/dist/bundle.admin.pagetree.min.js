/*
    THIS FILE HAS BEEN MANUALLY PATCHED UNTIL PR #1342 GETS RELEASED
    https://github.com/vakata/jstree/pull/1342/files
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],c=e("script:last").attr("src"),l=window.document,h=l.createElement("LI");h.setAttribute("role","treeitem"),i=l.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=l.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=l.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"3.2.1",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(l).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(s){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(s){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return i!==!0||this.length?(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||i===!0)&&(n=a||!1),null!==n&&n!==t?!1:void 0}),null!==n&&n!==t?n:this):!1},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(t){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(l.selection&&l.selection.empty)l.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(i){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return e.target.tagName&&"input"===e.target.tagName.toLowerCase()?!0:void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==l.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget),i&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus());break;case 38:t.preventDefault(),i=this.get_prev_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0],i&&e(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:t.preventDefault(),i=this.get_next_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),i=this._firstChild(this.get_container_ul()[0]),i&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(l.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(l).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(s){return!1}},get_path:function(t,i,r){if(t=t.parents?t:this.get_node(t),!t||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&-1!==r.className.indexOf("jstree-node")?e(r):!1},get_parent:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.parent:!1},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):e&&e.length?e.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(t=this.get_node(t),!t)return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,r=0,s=t.children_d.length;s>r;r++){for(n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[n]].children_d,t.children_d[r]);this._model.data[t.children_d[r]].state.selected&&(o=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[r])),delete this._model.data[t.children_d[r]]}t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&!o&&r&&r.length&&!r.hasClass("jstree-leaf")&&r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i){var r,s,n=!0,a=function(){this._load_nodes(e,t,!0)},o=this._model.data,d=[];for(r=0,s=e.length;s>r;r++)!o[e[r]]||(o[e[r]].state.loaded||o[e[r]].state.failed)&&i||(this.is_loading(e[r])||this.load_node(e[r],a),n=!1);if(n){for(r=0,s=e.length;s>r;r++)o[e[r]]&&o[e[r]].state.loaded&&d.push(e[r]);t&&!t.done&&(t.call(this,d),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){r===!1&&i.call(this,!1),this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){e=this.get_node(e),e&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,c=[],l=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){s=this._parse_model_from_html(e(i),d,_.parents.concat()),s&&(c.push(s),l.push(s),h[s].children_d.length&&(l=l.concat(h[s].children_d)))},this)),_.children=c,_.children_d=l,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(l);this.trigger("model",{nodes:l,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&(i=i.d,"string"==typeof i&&(i=JSON.parse(i))),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],c=[],l=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),c={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(c.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),(c.icon===t||null===c.icon||""===c.icon)&&(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(c.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(c.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(c.li_attr[s]=e.li_attr[s]);if(c.li_attr.id||(c.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(c.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(c.state.loaded=!1,c.children=[],c.children_d=[]),g[c.id]=c,s=0,n=c.children.length;n>s;s++)a=m(g[c.children[s]],c.id,r),o=g[a],c.children_d.push(a),o.children_d.length&&(c.children_d=c.children_d.concat(o.children_d));return delete e.data,delete e.children,g[c.id].original=e,c.state.selected&&l.push(c.id),c.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,c=!1;do c="j"+_+"_"+ ++u;while(g[c]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),(d.icon===t||null===d.icon||""===d.icon)&&(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&l.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),c.push(i),g[i].children_d.length&&(c=c.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(c);n={cnt:u,mod:g,sel:p,par:o,dpc:c,add:l}}else{for(r=0,s=a.length;s>r;r++)i=v(a[r],o,f.parents.concat()),i&&(d.push(i),c.push(i),g[i].children_d.length&&(c=c.concat(g[i].children_d)));for(f.children=d,f.children_d=c,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(c);n={cnt:u,mod:g,sel:p,par:o,dpc:c,add:l}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){if(this._cnt=t.cnt,this._model.data=t.mod,i){var s,n,a=t.add,o=t.sel,d=this._data.core.selected.slice(),c=this._model.data;if(o.length!==d.length||e.vakata.array_unique(o.concat(d)).length!==o.length){for(s=0,n=o.length;n>s;s++)-1===e.inArray(o[s],a)&&-1===e.inArray(o[s],d)&&(c[o[s]].state.selected=!1);for(s=0,n=d.length;n>s;s++)-1===e.inArray(d[s],o)&&(c[d[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(c){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,c,l=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),i.length?(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString()))):!0}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=d.hasClass("jstree-themeicon-hidden")?!1:d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),(h.icon===t||null===h.icon||""===h.icon)&&(h.icon=!0),d=i.children("ul").children("li");do c="j"+this._id+"_"+ ++this._cnt;while(l[c]);return h.id=h.li_attr.id?h.li_attr.id.toString():c,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),h.a_attr["class"]&&(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),l[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),c=this._model.data,l=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in l)l.hasOwnProperty(s)&&(h.state[s]=l[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),(h.icon===t||null===h.icon||""===h.icon)&&(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(h.state.loaded=!1,h.children=[],h.children_d=[]),c[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(c[h.children[s]],h.id,r),o=c[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,c[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,c=!1,l=this._model.data,h=this._model.default_state;do c="j"+this._id+"_"+ ++this._cnt;while(l[c]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),(d.icon===t||null===d.icon||""===d.icon)&&(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=l[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,l[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=l.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)t=this.redraw_node(s[i],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==l.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=l;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,c=!1,_=!1,u=!1,g="",f=l,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=l.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):l.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),
i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===l.activeElement,t.remove();else if(i=!0,!r){if(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===a||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(c in n.li_attr)if(n.li_attr.hasOwnProperty(c)){if("id"===c)continue;"class"!==c?t.setAttribute(c,n.li_attr[c]):g+=n.li_attr[c]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),c=0,_=n.children.length;_>c;c++)if(!p[n.children[c]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(c=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==c))for(c++,_=p[n.parent].children.length;_>c&&(p[p[n.parent].children[c]].state.hidden||(x=p[n.parent].children[c]),x===n.id);c++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&n.icon!==!0||n.icon===!1)&&(n.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+n.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",c=0,_=n.children.length;_>c;c++)u.appendChild(this.redraw_node(n.children[c],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),c=0,_=a.childNodes.length;_>c;c++)if(a.childNodes[c]&&a.childNodes[c].className&&-1!==a.childNodes[c].className.indexOf("jstree-children")){v=a.childNodes[c];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):r?r.call(this,e,!1):!1}):(r&&r.call(this,i,!1),!1)):!1},_open_to:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?this.is_closed(i)?!1:(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),o.length&&(r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove())),i.state.opened=!1,this.trigger("close_node",{node:i}),void(r&&o.length||this.trigger("after_close",{node:i}))):!1},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t})):!1},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t})):!1},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))):!1},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))):!1},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return e=this.get_node(e,!0),e&&e.length&&e.children(".jstree-hovered").length?(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)})):!1},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s})))):!1},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r})))):!1},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.selected:!1},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return e.isEmptyObject(i)?(i=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t,i){this._data.core.state=i===!0?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i=[],r=[];this._data.core.selected.concat([]);r.push(t.id),t.state.opened===!0&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,i){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var r,s,n=this._model.data;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i).children(".jstree-anchor").attr("id",i+"_anchor").end().attr("aria-labelledby",i+"_anchor"),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,!0},get_text:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.text:!1},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0):!1},get_json:function(t,i,r){if(t=this.get_node(t||e.jstree.root),!t)return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:i&&i.no_data?!1:e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),i=this.get_node(i),!i)return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,c,l;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,i.id,i.parents.concat()),!r)return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),c=0,l=i.parents.length;l>c;c++)this._model.data[i.parents[c]].children_d=this._model.data[i.parents[c]].children_d.concat(d);for(r=o,o=[],c=0,l=i.children.length;l>c;c++)o[c>=s?c+1:c]=i.children[c];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(t){var i,r,s,n,a,o,d,c,l,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),c=0,l=a.length;l>c;c++){for(o=0,d=t.parents.length;d>o;o++)n=e.inArray(a[c],this._model.data[t.parents[o]].children_d),-1!==n&&(this._model.data[t.parents[o]].children_d=e.vakata.array_remove(this._model.data[t.parents[o]].children_d,n));this._model.data[a[c]].state.selected&&(h=!0,n=e.inArray(a[c],this._data.core.selected),-1!==n&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,n)))}for(this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),c=0,l=a.length;l>c;c++)delete this._model.data[a[c]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||n&&n.is_multi||(i.id!==r.id||"copy_node"===t)&&e.inArray(i.id,r.children)!==s&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(a.functions[t]===!1||a.functions[t]===!0)?(a.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),a.functions[t]):o===!1||e.isFunction(o)&&o.call(this,t,i,r,s,n)===!1||o&&o[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var c,l,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(c=0,l=i.length;l>c;c++)(m=this.move_node(i[c],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return(m=this.copy_node(i,r,s,n,a,!1,d))?(g&&g.delete_node(i),m):!1;switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);(h===e.jstree.root||u.id===e.jstree.root)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var c,l,h,_,u,g,f,p,m,v,j;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(c=0,l=i.length;l>c;c++)(_=this.copy_node(i[c],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),j=!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i,!f)return!1;if(f.id===!0&&delete f.id,f=this._parse_model_from_json(f,m.id,m.parents.concat()),!f)return!1;for(_=this.get_node(f),i&&i.state&&i.state.loaded===!1&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="move_node",void this.trigger("cut",{node:t})):!1},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t})):!1},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return a!==!1&&n!==!1},paste:function(e,t){return e=this.get_node(e),e&&a&&a.match(/^(copy_node|move_node)$/)&&n?(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1)):!1},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,c,l,h,_,u=!1;return(t=this.get_node(t))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(_=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),_.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=_.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,c=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=e("<input />",{value:d,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),l=n.val(),h=this.settings.core.force_text;""===l&&(l=d),c.remove(),o.replaceWith(a),o.remove(),d=h?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,h?e("<div></div>").text(l).text():e("<div></div>").append(e.parseHTML(l)).html()),s||this.set_text(t,d),this._data.core.focused=_.id,setTimeout(e.proxy(function(){var e=this.get_node(_.id,!0);e.length&&(this._data.core.focused=_.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,_,s,u)},this),keydown:function(e){var t=e.which;27===t&&(u=!0,this.value=d),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){l.width(Math.min(c.text("pW"+this.value).width(),n))},keypress:function(e){return 13===e.which?!1:void 0}}),h={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(l),a.replaceWith(o),c.css(h),void l.css(h).width(Math.min(c.text("pW"+l[0].value).width(),n))[0].select()):!1},set_theme:function(t,i){if(!t)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),
this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(o=i.icon,i.icon=r===!0||null===r||r===t||""===r?!0:r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),r===!1?this.hide_icon(i):r===!0||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),o===!1&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),o===!1&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),o===!1&&this.show_icon(i)),!0):!1},get_icon:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.icon:!1},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(s=this.get_node(t,!0),t.icon=s.length?s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t,i){var r=e.slice((i||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,r),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=l.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,c=this._model.data,l=c[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(l.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)c[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(c[h[s]].state[g?"selected":"checked"]){for(a=0,o=c[h[s]].children_d.length;o>a;a++)c[c[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(c[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=l.children_d.length;n>s;s++)c[l.children_d[s]].children.length||_.push(c[l.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(l=c[_[a]];l&&l.id!==e.jstree.root;){for(r=0,s=0,n=l.children.length;n>s;s++)r+=c[l.children[s]].state[g?"selected":"checked"];if(r!==n)break;l.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(l.id),d=this.get_node(l,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,c=this.get_node(o.parent),l=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection;if(-1!==h.indexOf("down"))for(this._data[_?"core":"checkbox"].selected=e.vakata.array_unique(this._data[_?"core":"checkbox"].selected.concat(o.children_d)),r=0,s=o.children_d.length;s>r;r++)a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;c&&c.id!==e.jstree.root;){for(n=0,r=0,s=c.children.length;s>r;r++)n+=d[c.children[r]].state[_?"selected":"checked"];if(n!==s)break;c.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(c.id),a=this.get_node(c,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}-1!==h.indexOf("down")&&l.length&&l.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)n=o[a.children_d[r]],n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection;if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[c?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[c?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),n=this.get_node(a.parents[r],!0),n&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(n=[],r=0,s=this._data[c?"core":"checkbox"].selected.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[r],a.parents)||n.push(this._data[c?"core":"checkbox"].selected[r]);this._data[c?"core":"checkbox"].selected=e.vakata.array_unique(n),-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,c=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[c?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[c?"selected":"checked"];if(!(s>0&&n===s))break;o.state[c?"selected":"checked"]=!0,this._data[c?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(c?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,c=i.old_parent,l=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(c);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=l;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,c=this._data[d?"core":"checkbox"].selected,l=[],h=this;for(i=0,r=c.length;r>i;i++)if(o[c[i]]&&o[c[i]].parents)for(s=0,n=o[c[i]].parents.length;n>s;s++)a[o[c[i]].parents[s]]===t&&o[c[i]].parents[s]!==e.jstree.root&&(a[o[c[i]].parents[s]]=!0,l.push(o[c[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,c=h.get_node(this);if(c.state.loaded){for(i=0,r=c.children_d.length;r>i;i++)if(d=o[c.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,l.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,l.push(d.parents[s]))}else if(c.original&&c.original.state&&c.original.state.undetermined&&c.original.state.undetermined===!0)for(a[c.id]===t&&c.id!==e.jstree.root&&(a[c.id]=!0,l.push(c.id)),s=0,n=c.parents.length;n>s;s++)a[c.parents[s]]===t&&c.parents[s]!==e.jstree.root&&(a[c.parents[s]]=!0,l.push(c.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=l.length;r>i;i++)o[l[i]].state[d?"selected":"checked"]||(c=this.get_node(l[i],!0),c&&c.length&&c.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,c=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),c=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(c.className+=" jstree-checkbox-disabled"),d.insertBefore(c,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||t.state[n?"selected":"checked"]===!0||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t})))):!1},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t})))):!1},this.activate_node=function(t,i){return e(i.target).hasClass("jstree-checkbox-disabled")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):this.is_disabled(t)?!1:(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):(t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.checked:!1)},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a,o;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(o=this.get_node(t),o&&o.state.loaded))for(s=0,n=o.children_d.length;n>s;s++)this._model.data[o.children_d[s]].state.checked&&(a=!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,o.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(l).on("context_hide.vakata.jstree",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(i=this.get_node(i),!i||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),c=!1,l=!1;(a.show_at_node||r===t||s===t)&&(c=d.offset(),r=c.left,s=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),l=a.items,e.isFunction(l)&&(l=l.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(l)&&this._show_contextmenu(i,r,s,l)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(l).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(l).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return t=i.items[t],t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:i.reference,element:i.element}))&&t.action?t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}}):!1},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return r?(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(r._disabled===!0||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0),s&&(n+=s)),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0))):!0}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10?n:!1},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left+i.outerWidth(),n=i.offset().top,a=r.width(),o=r.height(),d=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[s-(a+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[s+a+10>d?"addClass":"removeClass"]("vakata-context-right"),n+o+10>c&&r.css("bottom","-1px"),r.show()}},show:function(r,s,n){var a,o,d,c,l,h,_,u,g=!0;switch(i.element&&i.element.length&&i.element.width(""),g){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,c=i.position_y,l=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth(),d<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20)),d+l+20>_&&(d=_-(l+20)),c+h+20>u&&(c=u-(h+20)),i.element.css({left:d,top:c}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(l).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1},e.jstree.plugins.dnd=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){
if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);return this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type)&&(this.settings.dnd.is_draggable===!0||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))?(this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},e(function(){var t=!1,i=!1,r=!1,s=!1,n=e('<div id="jstree-marker">&#160;</div>').hide();e(l).on("dnd_start.vakata.jstree",function(e,i){t=!1,r=!1,i&&i.data&&i.data.jstree&&n.appendTo("body")}).on("dnd_move.vakata.jstree",function(a,o){if(s&&clearTimeout(s),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){r=o.event;var d,c,l,h,_,u,g,f,p,m,v,j,y,k,x=e.jstree.reference(o.event.target),b=!1,w=!1,C=!1;if(x&&x._data&&x._data.dnd)if(n.attr("class","jstree-"+x.get_theme()+(x.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+x.get_theme()+" jstree-"+x.get_theme()+"-"+x.get_theme_variant()+" "+(x.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==x.element[0]&&o.event.target!==x.get_container_ul()[0]||0!==x.get_container_ul().children().length){if(b=x.settings.dnd.large_drop_target?e(o.event.target).closest(".jstree-node").children(".jstree-anchor"):e(o.event.target).closest(".jstree-anchor"),b&&b.length&&b.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(w=b.offset(),C=o.event.pageY-w.top,l=b.outerHeight(),u=l/3>C?["b","i","a"]:C>l-l/3?["a","i","b"]:C>l/2?["i","a","b"]:["i","b","a"],e.each(u,function(r,a){switch(a){case"b":d=w.left-6,c=w.top,h=x.get_parent(b),_=b.parent().index();break;case"i":y=x.settings.dnd.inside_pos,k=x.get_node(b.parent()),d=w.left-2,c=w.top+l/2+1,h=k.id,_="first"===y?0:"last"===y?k.children.length:Math.min(y,k.children.length);break;case"a":d=w.left-6,c=w.top+l,h=x.get_parent(b),_=b.parent().index()+1}for(g=!0,f=0,p=o.data.nodes.length;p>f;f++)if(m=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",v=_,"move_node"===m&&"a"===a&&o.data.origin&&o.data.origin===x&&h===x.get_parent(o.data.nodes[f])&&(j=x.get_node(h),v>e.inArray(o.data.nodes[f],j.children)&&(v-=1)),g=g&&(x&&x.settings&&x.settings.dnd&&x.settings.dnd.check_while_dragging===!1||x.check(m,o.data.origin&&o.data.origin!==x?o.data.origin.get_node(o.data.nodes[f]):o.data.nodes[f],h,v,{dnd:!0,ref:x.get_node(b.parent()),pos:a,origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==x,is_foreign:!o.data.origin})),!g){x&&x.last_error&&(i=x.last_error());break}return"i"===a&&b.parent().is(".jstree-closed")&&x.settings.dnd.open_timeout&&(s=setTimeout(function(e,t){return function(){e.open_node(t)}}(x,b),x.settings.dnd.open_timeout)),g?(t={ins:x,par:h,pos:"i"!==a||"last"!==y||0!==_||x.is_loaded(k)?_:"last"},n.css({left:d+"px",top:c+"px"}).show(),o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),i={},u=!0,!1):void 0}),u===!0))return}else{for(g=!0,f=0,p=o.data.nodes.length;p>f&&(g=g&&x.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==x?o.data.origin.get_node(o.data.nodes[f]):o.data.nodes[f],e.jstree.root,"last",{dnd:!0,ref:x.get_node(e.jstree.root),pos:"i",origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==x,is_foreign:!o.data.origin}),g);f++);if(g)return t={ins:x,par:e.jstree.root,pos:"last"},n.hide(),void o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.hide()}}).on("dnd_scroll.vakata.jstree",function(e,i){i&&i.data&&i.data.jstree&&(n.hide(),t=!1,r=!1,i.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(a,o){if(s&&clearTimeout(s),o&&o.data&&o.data.jstree){n.hide().detach();var d,c,l=[];if(t){for(d=0,c=o.data.nodes.length;c>d;d++)l[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](l,t.par,t.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&i&&i.error&&"check"===i.error&&(d=d.jstree(!0),d&&d.settings.core.error.call(this,i));r=!1,t=!1}}).on("keyup.jstree keydown.jstree",function(t,i){i=e.vakata.dnd._get(),i&&i.data&&i.data.jstree&&(i.helper.find(".jstree-copy").first()[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),r&&(r.metaKey=t.metaKey,r.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",r)))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,i){var r=e.vakata.dnd._get();r.event=i,e(l).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(l).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(l).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(i){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(i===!0)return!1;var r=t.scroll_e.scrollTop(),s=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(r+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(s+t.scroll_l*e.vakata.dnd.settings.scroll_speed),(r!==t.scroll_e.scrollTop()||s!==t.scroll_e.scrollLeft())&&e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(i,r,s){"touchstart"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=l.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{i.currentTarget.unselectable="on",i.currentTarget.onselectstart=function(){return!1},i.currentTarget.style&&(i.currentTarget.style.MozUserSelect="none")}catch(n){}return t.init_x=i.pageX,t.init_y=i.pageY,t.data=r,t.is_down=!0,t.element=i.currentTarget,t.target=i.target,t.is_touch="touchstart"===i.type,s!==!1&&(t.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(l).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(l).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(i){if("touchmove"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=l.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(i.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(i.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",i)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,c=!1,h=!1,_=!1,u=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-i.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),i.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-i.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),i.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l?(t.scroll_e=e(this),!1):void 0}),t.scroll_e||(r=e(l),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),c=r.scrollTop(),h=r.scrollLeft(),n>a&&i.pageY-c<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),n>a&&a-(i.pageY-c)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),o>d&&i.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),o>d&&d-(i.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=r)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(_=parseInt(i.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(i.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+t.helper_w>o&&(u=o-(t.helper_w+2)),t.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",i),!1}},stop:function(i){if("touchend"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=l.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",i);else if("touchend"===i.type&&i.target===t.target){var r=setTimeout(function(){e(i.target).click()},100);e(i.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this._data.massload={}},this._load_nodes=function(t,r,s){var n=this.settings.massload;return s&&!e.isEmptyObject(this._data.massload)?i._load_nodes.call(this,t,r,s):e.isFunction(n)?n.call(this,t,e.proxy(function(e){if(e)for(var n in e)e.hasOwnProperty(n)&&(this._data.massload[n]=e[n]);i._load_nodes.call(this,t,r,s)},this)):"object"==typeof n&&n&&n.url?(n=e.extend(!0,{},n),e.isFunction(n.url)&&(n.url=n.url.call(this,t)),e.isFunction(n.data)&&(n.data=n.data.call(this,t)),e.ajax(n).done(e.proxy(function(e,n,a){if(e)for(var o in e)e.hasOwnProperty(o)&&(this._data.massload[o]=e[o]);i._load_nodes.call(this,t,r,s)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s)},this))):i._load_nodes.call(this,t,r,s)},this._load_node=function(t,r){var s=this._data.massload[t.id];return s?this["string"==typeof s?"_append_html_data":"_append_json_data"](t,"string"==typeof s?e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}):s,function(e){r.call(this,e),delete this._data.massload[t.id]}):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n=this._model.data,a=[];for(r=0,s=i.res.length;s>r;r++)n[i.res[r]]&&!n[i.res[r]].state.hidden&&(a.push(i.res[r]),a=a.concat(n[i.res[r]].parents),this._data.search.smc&&(a=a.concat(n[i.res[r]].children_d)));a=e.vakata.array_remove_item(e.vakata.array_unique(a),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(a)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&this.show_node(this._data.search.hdn)},this))},this.search=function(i,r,s,n,a,o){if(i===!1||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,c,l=this.settings.search,h=l.ajax?l.ajax:!1,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=l.show_only_matches),o===t&&(o=l.show_only_matches_children),!r&&h!==!1)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)},!0)},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)},!0)},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:l.case_sensitive,fuzzy:l.fuzzy}),e.each(_[n?n:e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&(!l.search_leaves_only||r.state.loaded&&0===r.children.length)&&(l.search_callback&&l.search_callback.call(this,i,r)||!l.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,c=f.length;c>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&this.open_node(f[d],null,0)===!0&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments),t&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),r.fuzzy!==!1&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,c=r.distance,l=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return c?i+r/c:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,c,_,u,g,f,p,m,v=e.length,j=l,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),y=e.lastIndexOf(t,d+h),-1!==y&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(c=0,_=k;_>c;)a(i,d+_)<=j?c=_:k=_,_=Math.floor((k-c)/2+c);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],0===i?p[o]=(p[o+1]<<1|1)&m:p[o]=(p[o+1]<<1|1)&m|((u[o+1]|u[o])<<1|1)|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},i===!0?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if(t=this.get_node(t),t&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var u=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){u&&clearTimeout(u),u=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(i){return!1}return t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl?!1:(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),t?(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0):!1)},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"default":{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types["default"])for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types["default"])s.types["default"].hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types["default"][a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a=this._model.data,o=r.nodes,d=this.settings.types,c="default";for(s=0,n=o.length;n>s;s++)c="default",a[o[s]].original&&a[o[s]].original.type&&d[a[o[s]].original.type]&&(c=a[o[s]].original.type),a[o[s]].data&&a[o[s]].data.jstree&&a[o[s]].data.jstree.type&&d[a[o[s]].data.jstree.type]&&(c=a[o[s]].data.jstree.type),a[o[s]].type=c,a[o[s]].icon===!0&&d[c].icon!==t&&(a[o[s]].icon=d[c].icon);a[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},c=r.get_json.call(this,t,d,s);if(c===!1)return!1;if(e.isArray(c))for(n=0,a=c.length;a>n;n++)c[n].type=c[n].id&&o[c[n].id]&&o[c[n].id].type?o[c[n].id].type:"default",i&&i.no_id&&(delete c[n].id,c[n].li_attr&&c[n].li_attr.id&&delete c[n].li_attr.id,c[n].a_attr&&c[n].a_attr.id&&delete c[n].a_attr.id);else c.type=c.id&&o[c.id]&&o[c.id].type?o[c.id].type:"default",i&&i.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(r.check.call(this,i,s,n,a,o)===!1)return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,c,l,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(_&&s.children_d&&s.parents){for(c=0,l=0,h=s.children_d.length;h>l;l++)c=Math.max(c,_[s.children_d[l]].parents.length);c=c-s.parents.length+1}(0>=c||c===t)&&(c=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;n=this.get_node(n.parent),d=this.get_rules(n),c++}while(n)}}return!0},this.get_rules=function(e){if(e=this.get_node(e),!e)return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return t=this.get_node(t),t?i?e.extend({type:t.type},this.settings.types[t.type]):t.type:!1},this.set_type=function(i,r){var s,n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}return s=this.settings.types,i=this.get_node(i),s[r]&&i?(o=i.type,d=this.get_icon(i),i.type=r,(d===!0||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon!==t?s[r].icon:!0),!0):!1}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(r.check.call(this,t,i,s,n,a)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s),!s||!s.children)return!0;var o,d,c="rename_node"===t?n:i.text,l=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)l.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(c=c.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(c,l)||i.text&&i.text[h?"toString":"toLowerCase"]()===c,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"create_node":return o=-1===e.inArray(c,l),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"copy_node":return o=-1===e.inArray(c,l),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(c,l),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),i=this.get_node(i),!i)return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,c,l,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(c=d=this.get_string("New node"),l=[],h=0,_=i.children.length;_>h;h++)l.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?c:c.toLowerCase(),l);)c=f.call(this,d,++h).toString();s.text=c}return r.create_node.call(this,i,s,n,a,o)}};var g=l.createElement("DIV");if(g.setAttribute("unselectable","on"),g.setAttribute("role","presentation"),g.className="jstree-wholerow",g.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)s=this.get_node(t.selected[i],!0),s&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=g.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},l.registerElement&&Object&&Object.create){var f=Object.create(HTMLElement.prototype);f.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{l.registerElement("vakata-jstree",{prototype:f})}catch(p){}}}});
/*
 * http://github.com/deitch/jstree-grid
 *
 * This plugin handles adding a grid to a tree to display additional data
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Works only with jstree version >= 3.0.0
 *
 * $Date: 2015-11-29 $
 * $Revision:  3.4.2 $
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,i,r,s,d,n=/^\s*$/g,a=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,o=function(e){return(e||"").replace(a,"\\$&")},l="data-jstreegrid",h="_DATA_",c=24,p=!1,g="jsgrid_",u="_col",f=10,v=function(e,t){return e.find("div["+l+"='"+t+"']")},m=!1,j=null,_=0,w=0;s=/<\/?[^>]+>/gi,r=function(t,i){var r,s,d,n;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?n=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),d=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),d.appendTo(r),r.appendTo(e("body")),n=s.width()||c,d.detach(),r.remove(),i._gridSettings.indent=n),n},d=function(e,t){var i,r=e.get_node(t),s=r.children;return i=!s||s.length<=0||!r.state.opened?t:d(e,s[s.length-1])},t=function(e,t){var i,s,d=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,s=d-i*r(e,t),d},i=function(e,t,i){var r,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),n=i.settings.grid.columns[0];r="",n.title&&(n.title===h?r=i.get_text(t):t.attr(n.title)&&(r=t.attr(n.title))),r=r.replace(s,""),r&&d.attr("title",r)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(t,r){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,d=s.parent(),n=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,stateful:r.stateful,indent:0},a=n.columns,o=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){o=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=o,this.rootid=s.attr("id");var l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var h=parseFloat(navigator.appVersion.split("MSIE")[1]);8>h&&(n.defaultConf.display="inline",n.defaultConf.zoom="1")}for(p||(p=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(d),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<a.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+o+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){this.get_node(t||"#",!0);return '',!1},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)v(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&v(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,v(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,v(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;v(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;v(this.gridWrapper,r).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)v(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell-regular").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&v(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",e.proxy(function(e,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?v(i,t).remove():i.find("div.jstree-grid-cell-regular").remove()},this._prepare_headers=function(){var t,i,r,s,d,n,a,o,l,h,c=this._gridSettings,p=c.columns||[],g=c.columnWidth,u=c.resizable||!1,v=c.isThemeroller,x=v?"themeroller":"regular",y=!1,C=this.gridparent,b=this.rootid,W=c.defaultConf,S=0,z=0;for(this.parent=C,i=0;i<p.length;i++)d=p[i].headerClass||"",n=p[i].columnClass||"",a=p[i].header||"",a&&(y=!0),s=c.stateful&&localStorage["jstree-root-"+b+"-column-"+i]?localStorage["jstree-root-"+b+"-column-"+i]:p[i].width||g,S=v?7:10,"auto"!==s&&"string"!=typeof s&&(s-=S),o=0===i?3:0,r=this.midWrapper.children("div.jstree-grid-column-"+i),l=e("<div></div>").css(W).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+i+" "+(v?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+x+" "+d+" "+n).html(a),l.addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+x),l.prependTo(r),z+=l.outerWidth(),h=e("<div class='jstree-grid-separator jstree-grid-separator-"+x+(v?" ui-widget-header":"")+(u?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(l),r.width(s),r.css("min-width",s),r.css("max-width",s);l.addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+x),void 0===p[p.length-1].width&&(z-=s,r.css({width:"auto"}),l.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),y?c.header=t:e("div.jstree-grid-header").hide(),!this.bound&&u&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,d,n;m&&(n=j.prevAll(".jstree-grid-column").length,d=j.closest(".jstree-grid-wrapper").find(".jstree"),t=e.jstree.reference(d),i=t.settings.grid.columns,s=j.parent().children("div.jstree-grid-column"),(isNaN(n)||0>n)&&(t._gridSettings.treeWidthDiff=d.find("ins:eq(0)").width()+d.find("a:eq(0)").width()-t._gridSettings.columns[0].width),r=t._gridSettings.columns[n].width=parseFloat(j.css("width")),m=!1,j=null,d.trigger("resize_column.jstree-grid",[n,r]))}).mousemove(function(e){if(m){w=e.pageX;var t,i,r,s=w-_;0!==s&&(t=j.width(),i=parseFloat(j.css("width")),i||(i=j.innerWidth()),s=0>s?Math.max(s,-t):s,r=i+s,(s>0||t>0)&&r>f&&(j.width(r+"px"),j.css("min-width",r+"px"),j.css("max-width",r+"px"),_=w))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return m=!0,_=t.pageX,j=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),d=s.closest("div.jstree-grid-column"),n=parseFloat(d.css("width")),a=0,o=d.prevAll(".jstree-grid-column").length,l=d.width();d.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>a&&(a=t)}),i=a-n,i=0>i?Math.max(i,-l):i,r=n+i+"px",d.width(r),d.css("min-width",r),d.css("max-width",r),e(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[o,r])}))},this.redraw_node=function(e,t,i,s){return e=r.redraw_node.call(this,e,t,i,s),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),r.refresh.apply(this,arguments)},this.set_id=function(e,t){var i;e&&(i=e.id);var s=r.set_id.apply(this,arguments);if(s&&void 0!==i){var d,n=this.gridWrapper,a=[i];for(e&&e.children_d&&(a=a.concat(e.children_d)),d=0;d<a.length;d++)v(n,a[d]).attr(l,e.id).attr("id",g+e.id+u+(d+1)).removeClass(g+i+u).addClass(g+e.id+u)}return s},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)v(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,d,n=e(),a=t.children||[];for(d=0;d<a.length;d++)s=g+o(a[d])+u+i,r[s]&&t.state.opened&&(n=n.add(r[s]).add(this.getHoldingCells(this.get_node(a[d]),i,r)));return n},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,d=this.element.width(),n=t.data[i.value],a=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=e("<input />",{value:n,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=o.val();""===e||e===n?e=n:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:n}),this._prepare_grid(this.get_node(t,!0))),o.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=n),(27===t||13===t||37===t||38===t||39===t||40===t||32===t)&&e.stopImmediatePropagation(),(27===t||13===t)&&(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){o.width(Math.min(a.text("pW"+this.value).width(),d))},keypress:function(e){return 13===e.which?!1:void 0}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(o),o.css(l).width(Math.min(a.text("pW"+o[0].value).width(),d))[0].select()},this._prepare_grid=function(t){var r,a,h,c,p,f,m,j,_,w,x,y,C,b,W,S,z,k,T,A,P,F,V,q,D,L,M,N,I,B=this._gridSettings,H=B.treeClass,E=this,U=B.columns||[],X=B.isThemeroller,$=this.element,Q=this.rootid,Y=X?"themeroller":"regular",G=this.get_node(t),J=B.columnWidth,K=B.defaultConf,O=function(t,i,r,s,d){return function(d){i.children(".jstree-anchor").trigger("click.jstree",d),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}},R=function(t,i,r,s,d){return function(t){B.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=d.get_node(i);E._edit(r,s,t.target)}}}))}},Z=function(e,t){return function(){t.hover_node(e)}},ee=function(e,t){return function(){t.dehover_node(e)}},te=this.midWrapper,ie=G.id,re=this.get_node(G.parent).children,se=jQuery.inArray(ie,re),de=this.holdingCells,ne=!1;if(r=e(t),_=r.children("a"),1===_.length){for(I=!G.state.opened,S=g+o(ie)+u,z="#"===G.parent?null:G.parent,_.addClass(H),i(_,r,E),w=_,c=0;c<U.length;c++)this.treecol!==c&&(D=U[c],N=te.children("div:eq("+c+")"),f=D.cellClass||"",m=D.wideCellClass||"",j=D.columnClass||"",N.addClass(j),p=void 0!==D.value&&null!==D.value?"function"==typeof D.value?D.value(G):null!==G.data&&void 0!==G.data&&void 0!==G.data[D.value]?G.data[D.value]:"":"","function"==typeof D.format&&(p=D.format(p)),D.images?(h=D.images[p]||D.images["default"],h&&(L="*"===h[0]?'<span class="'+h.substr(1)+'"></span>':'<img src="'+h+'">')):L=p,(void 0===L||null===L||n.test(L))&&(L="&nbsp;"),x=D.valueClass&&null!==G.data&&void 0!==G.data?G.data[D.valueClass]||"":"",x&&D.valueClassPrefix&&""!==D.valueClassPrefix&&(x=D.valueClassPrefix+x),y=D.wideValueClass&&null!==G.data&&void 0!==G.data?G.data[D.wideValueClass]||"":"",y&&D.wideValueClassPrefix&&""!==D.wideValueClassPrefix&&(y=D.wideValueClassPrefix+y),W=D.title&&null!==G.data&&void 0!==G.data?G.data[D.title]||"":"",W=W.replace(s,""),b=7,a=D.width||J,"auto"!==a&&(a=M||a-b),w=v(N,ie),(!w||w.length<1)&&(w=e("<div></div>"),e("<span></span>").appendTo(w),w.attr("id",S+c),w.addClass(S),w.attr(l,ie)),A=0>=se?G.parent:d(this,re[se-1]),T=v(N,A),F=se>=re.length-1?"NULL":re[se+1],P=v(N,F),q=G.children&&G.children.length>0?G.children[0]:"NULL",V=v(N,q),k=v(N,z),z?(k&&k.length>0?(T&&T.length>0?w.insertAfter(T):V&&V.length>0?w.insertBefore(V):P&&P.length>0?w.insertBefore(P):w.insertAfter(k),ne=!0):ne=!1,de[S+c]=w):(T&&T.length>0?w.insertAfter(T):V&&V.length>0?w.insertBefore(V):P&&P.length>0?w.insertBefore(P):w.appendTo(N),ne=!0),ne&&w.after(this.getHoldingCells(G,c,de)),C=w.children("span"),C.addClass(f+" "+x).html(L),w=w.css(K).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+Q+" jstree-grid-cell-"+Y+" "+m+" "+y+(X?" ui-state-default":"")).addClass("jstree-grid-col-"+c),w.click(O($,r,p,D,this)),w.on("contextmenu",R($,r,p,D,this)),w.hover(Z(r,this),ee(r,this)),W&&C.attr("title",W));w.addClass("jstree-grid-cell-last"+(X?" ui-state-default":"")),void 0===U[U.length-1].width&&w.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});
/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
var CMS = window.CMS || {};

// #############################################################################
// MODAL
(function ($) {
    'use strict';

    /**
     * The pagetree is loaded via `/admin/cms/page` and has a custom admin
     * templates stored within `templates/admin/cms/page/tree`.
     *
     * @class PageTree
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.PageTree = new CMS.Class({
        // TODO add mechanics to set the home page
        initialize: function initialize(options) {
            // options are loaded from the pagetree html node
            this.options = $('.js-cms-pagetree').data('json');
            this.options = $.extend(true, {}, this.options, options);

            // states and events
            this.click = 'click.cms.pagetree';
            this.cache = {
                id: null,
                target: null,
                type: ''
            };
            this.successTimer = 1000;

            // elements
            this._setupUI();
            this._events();

            // cancel if pagtree is not available
            if (!$.isEmptyObject(this.options)) {
                this._setup();
            }
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var pagetree = $('.cms-pagetree');
            this.ui = {
                container: pagetree,
                document: $(document),
                tree: pagetree.find('.js-cms-pagetree'),
                dialog: $('.js-cms-tree-dialog'),
                siteForm: $('.js-cms-pagetree-site-form')
            };
        },

        /**
         * Setting up the jstree and the related columns.
         *
         * @method _setup
         * @private
         */
        _setup: function _setup() {
            var that = this;
            var columns = [];
            var obj = {
                language: this.options.lang.code,
                openNodes: []
            };
            var data = false;

            // make sure that ajax request send the csrf token
            CMS.API.Helpers.csrf(this.options.csrf);

            // setup column headings
            $.each(this.options.columns, function (index, obj) {
                if (obj.key === '') {
                    // the first row is already populated, to avoid overwrites
                    // just leave the "key" param empty
                    columns.push({
                        header: obj.title,
                        width: obj.width || '1%',
                        wideCellClass: obj.cls
                    });
                } else {
                    columns.push({
                        header: obj.title,
                        value: function (node) {
                            // it needs to have the "colde" format and not "col-de"
                            // as jstree will convert "col-de" to "colde"
                            // also we strip dashes, in case language code contains it
                            // e.g. zh-hans, zh-cn etc
                            if (node.data) {
                                return node.data['col' + obj.key.replace('-', '')];
                            } else {
                                return '';
                            }
                        },
                        width: obj.width || '1%',
                        wideCellClass: obj.cls
                    });
                }
            });

            // prepare data
            if (!this.options.filtered) {
                data = {
                    url: this.options.urls.tree,
                    data: function (node) {
                        // '#' is rendered if its the root node, there we only
                        // care about `obj.openNodes`, in the following case
                        // we are requesting a specific node
                        if (node.id !== '#') {
                            obj.pageId = that._storeNodeId(node.data.id);
                        } else {
                            obj.pageId = null;
                        }

                        // we need to store the opened items inside the localstorage
                        // as we have to load the pagetree with the previous opened
                        // state
                        obj.openNodes = that._getStoredNodeIds();

                        // we need to set the site id to get the correct tree
                        obj.site = that.options.site;

                        return obj;
                    }
                };
            }

            // bind options to the jstree instance
            this.ui.tree.jstree({
                core: {
                    // disable open/close animations
                    animation: 0,
                    // core setting to allow actions
                    check_callback: function () {
                        // cancel dragging when filtering is active by setting `false`
                        return (that.options.filtered) ? false : true;
                    },
                    // https://www.jstree.com/api/#/?f=$.jstree.defaults.core.data
                    data: data,
                    // strings used within jstree that are called using `get_string`
                    strings: {
                        'Loading ...': this.options.lang.loading,
                        'New node': this.options.lang.newNode,
                        'nodes': this.options.lang.nodes
                    },
                    error: function (error) {
                        that.showError(error.reason);
                    },
                    themes: {
                        name: 'django-cms'
                    },
                    // disable the multi selection of nodes for now
                    multiple: false
                },
                // activate drag and drop plugin
                plugins : ['dnd', 'search', 'grid'],
                // https://www.jstree.com/api/#/?f=$.jstree.defaults.dnd
                dnd: {
                    inside_pos: 'last',
                    // disable the multi selection of nodes for now
                    drag_selection: false,
                    // disable dragging if filtered
                    is_draggable: function () {
                        return (that.options.filtered) ? false : true;
                    },
                    // disable CMD/CTRL copy
                    copy: false
                },
                // https://github.com/deitch/jstree-grid
                grid: {
                    // columns are provided from base.html options
                    width: '100%',
                    columns: columns
                }
            });
        },

        /**
         * Sets up all the event handlers, such as opening and moving.
         *
         * @method _events
         * @private
         */
        _events: function _events() {
            var that = this;

            // set events for the nodeId updates
            this.ui.tree.on('after_close.jstree', function (e, el) {
                that._removeNodeId(el.node.data.id);
            });
            this.ui.tree.on('after_open.jstree', function (e, el) {
                that._storeNodeId(el.node.data.id);
                that._checkHelpers();
            });

            // store moved position node
            this.ui.tree.on('move_node.jstree copy_node.jstree', function (e, obj) {
                if (!that.cache.type || that.cache.type === 'cut') {
                    that._moveNode(that._getNodePosition(obj)).done(function () {
                        var instance = that.ui.tree.jstree(true);

                        instance._hide_grid(instance.get_node(obj.parent));
                        if (obj.parent === '#') {
                            instance.refresh();
                        } else {
                            // have to refresh parent, because refresh only
                            // refreshes children of the node, never the node itself
                            instance.refresh_node(obj.parent);
                        }
                    });
                } else {
                    that._copyNode(obj);
                }
                // we need to open the parent node if we trigger an element
                // if not already opened
                that.ui.tree.jstree('open_node', obj.parent);
            });

            // set event for cut and paste
            this.ui.container.on(this.click, '.js-cms-tree-item-cut', function (e) {
                e.preventDefault();
                that._cutOrCopy({ type: 'cut', element: $(this) });
            });

            // set event for cut and paste
            this.ui.container.on(this.click, '.js-cms-tree-item-copy', function (e) {
                e.preventDefault();
                that._cutOrCopy({ type: 'copy', element: $(this) });
            });

            // attach events to paste
            this.ui.container.on(this.click, '.cms-tree-item-helpers a', function (e) {
                e.preventDefault();
                that._paste(e);
            });

            // advanced settings link handling
            this.ui.container.on(this.click, '.js-cms-tree-advanced-settings', function (e) {
                if (e.shiftKey) {
                    e.preventDefault();
                    window.location.href = $(this).data('url');
                }
            });

            // add events for error reload (messagelist)
            this.ui.document.on(this.click, '.messagelist .cms-tree-reload', function (e) {
                e.preventDefault();
                that._reloadHelper();
            });

            // propagnate the sites dropdown to the hidden sites form
            this.ui.container.find('.js-cms-pagetree-site-trigger').on(this.click, function (e) {
                e.preventDefault();
                // prevent if parent is active
                if ($(this).parent().hasClass('active')) {
                    return false;
                }
                that.ui.siteForm.find('select')
                    .val($(this).data().id).end().submit();
            });

            // additional event handlers
            this._setTooltips();
            this._setSearch();

            // make sure ajax post requests are working
            this._setAjaxPost('.js-cms-tree-item-menu a');
            this._setAjaxPost('.js-cms-tree-lang-trigger');
        },

        /**
         * Helper to process the cut and copy events.
         *
         * @method _cutOrCopy
         * @param {Object} [opts]
         * @param {Number} [opts.type] either 'cut' or 'copy'
         * @param {Number} [opts.element] originated trigger element
         * @private
         */
        _cutOrCopy: function _cutOrCopy(obj) {
            // prevent actions if you try to copy a page with an apphook
            if (obj.type === 'copy' && obj.element.data().apphook) {
                this.showError(this.options.lang.apphook);
                return false;
            }

            var jsTreeId = this._getNodeId(obj.element.closest('.jstree-grid-cell'));
            // resets if we click again
            if (this.cache.type === obj.type && jsTreeId === this.cache.id) {
                this.cache.type = null;
                this._hideHelpers();
            } else {
                // we need to cache the node and type so `_showHelpers`
                // will trigger the correct behaviour
                this.cache.target = obj.element;
                this.cache.type = obj.type;
                this.cache.id = jsTreeId;
                this._showHelpers();
                this._checkHelpers();
            }
        },

        /**
         * Helper to process the paste event.
         *
         * @method _paste
         * @private
         * @return {Object} event originated event handler
         */
        _paste: function _paste(event) {
            // hide helpers after we picked one
            this._hideHelpers();

            var copyFromId = this._getNodeId(this.cache.target);
            var copyToId = this._getNodeId($(event.currentTarget));

            // copyToId contains `jstree-1`, assign to root
            if (copyToId.indexOf('jstree-1') > -1) {
                copyToId = '#';
            }

            if (this.cache.type === 'cut') {
                this.ui.tree.jstree('cut', copyFromId);
            } else {
                this.ui.tree.jstree('copy', copyFromId);
            }

            this.ui.tree.jstree('paste', copyToId, 'last');
            this.cache.type = null;
            this.cache.target = null;
        },

        /**
         * Retreives a list of nodes from local storage.
         *
         * @method _getStoredNodeIds
         * @private
         * @return {Array} list of ids
         */
        _getStoredNodeIds: function _getStoredNodeIds() {
            return CMS.settings.pagetree || [];
        },

        /**
         * Stores a node in local storage.
         *
         * @method _storeNodeId
         * @private
         * @param {String} id to be stored
         * @return {String} id that has been stored
         */
        _storeNodeId: function _storeNodeId(id) {
            var number = id;
            var storage = this._getStoredNodeIds();

            // store value only if it isn't there yet
            if (storage.indexOf(number) === -1) {
                storage.push(number);
            }

            CMS.settings.pagetree = storage;
            CMS.API.Helpers.setSettings(CMS.settings);

            return number;
        },

        /**
         * Removes a node in local storage.
         *
         * @method _removeNodeId
         * @private
         * @param {String} id to be stored
         * @return {String} id that has been removed
         */
        _removeNodeId: function _removeNodeId(id) {
            var number = id;
            var storage = this._getStoredNodeIds();
            var index = storage.indexOf(number);

            // remove given id from storage
            if (index !== -1) {
                storage.splice(index, 1);
            }

            CMS.settings.pagetree = storage;
            CMS.API.Helpers.setSettings(CMS.settings);

            return number;
        },

        /**
         * Moves a node after drag & drop.
         *
         * @method _moveNode
         * @param {Object} [opts]
         * @param {Number} [opts.id] current element id for url matching
         * @param {Number} [opts.target] target sibling or parent
         * @param {Number} [opts.position] either `left`, `right` or `last-child`
         * @returns {$.Deferred} ajax request object
         * @private
         */
        _moveNode: function _moveNode(obj) {
            var that = this;
            obj.site = that.options.site;

            return $.ajax({
                method: 'post',
                url: that.options.urls.move.replace('{id}', obj.id),
                data: obj
            }).done(function () {
                that._showSuccess(obj.id);
            }).fail(function (error) {
                that.showError(error.statusText);
            });
        },

        /**
         * Copies a node into the selected node.
         *
         * @method _copyNode
         * @param {String} copyFromId element to be cut
         * @param {String} copyToId destination to inject
         * @private
         */
        _copyNode: function _copyNode(obj) {
            var that = this;
            var node = that._getNodePosition(obj);
            var data = {
                site: this.options.site,
                // we need to refer to the original item here, as the copied
                // node will have no data attributes stored at it (not a clone)
                id: obj.original.data.id,
                position: node.position
            };

            // if there is no target provided, the node lands in root
            if (node.target) {
                data.target = node.target;
            }

            if (that.options.permission) {
                // we need to load a dialog first, to check if permissions should
                // be copied or not
                $.ajax({
                    method: 'post',
                    url: that.options.urls.copyPermission.replace('{id}', data.id),
                    data: data
                // the dialog is loaded via the ajax respons originating from
                // `templates/admin/cms/page/tree/copy_premissions.html`
                }).done(function (dialog) {
                    that.ui.dialog.append(dialog);
                }).fail(function (error) {
                    that.showError(error.statusText);
                });

                // attach events to the permission dialog
                this.ui.dialog.off(this.click, '.cancel').on(this.click, '.cancel', function (e) {
                    e.preventDefault();
                    // remove just copied node
                    that.ui.tree.jstree('delete_node', obj.node.id);
                    $('.js-cms-dialog').remove();
                    $('.js-cms-dialog-dimmer').remove();
                }).off(this.click, '.submit').on(this.click, '.submit', function (e) {
                    e.preventDefault();
                    var formData = $(this).closest('form').serialize().split('&');

                    // loop through form data and attach to obj
                    for (var i = 0; i < formData.length; i++) {
                        data[formData[i].split('=')[0]] = formData[i].split('=')[1];
                    }

                    that._saveCopiedNode(data);
                });
            } else {
                this._saveCopiedNode(data);
            }
        },

        /**
         * Sends the request to copy a node.
         *
         * @method _saveCopiedNode
         * @private
         * @param {Object} data node position information
         */
        _saveCopiedNode: function _saveCopiedNode(data) {
            var that = this;
            // send the real ajax request for copying the plugin
            return $.ajax({
                method: 'post',
                url: that.options.urls.copy.replace('{id}', data.id),
                data: data
            }).done(function () {
                that._reloadHelper();
            }).fail(function (error) {
                that.showError(error.statusText);
            });
        },

        /**
         * Returns element from any sub nodes.
         *
         * @method _getElement
         * @private
         * @param {jQuery} el jQuery node form where to search
         * @return {String|Boolean} jsTree node element id
         */
        _getNodeId: function _getElement(el) {
            var cls = el.closest('.jstree-grid-cell').attr('class');

            return (cls) ? cls.replace(/.*jsgrid_(.+?)_col.*/, '$1') : false;
        },

        /**
         * Gets the new node position after moving.
         *
         * @method _getNodePosition
         * @private
         * @param {Object} obj jstree move object
         * @return {Object} evaluated object with params
         */
        _getNodePosition: function _getNodePosition(obj) {
            var data = {};
            var node = this.ui.tree.jstree('get_node', obj.node.parent);

            data.position = obj.position;

            // jstree indicates no parent with `#`, in this case we do not
            // need to set the target attribute at all
            if (obj.parent !== '#') {
                data.target = node.data.id;
            }

            // some functions like copy create a new element with a new id,
            // in this case we need to set `data.id` manually
            if (obj.node && obj.node.data) {
                data.id = obj.node.data.id;
            }

            return data;
        },

        /**
         * Sets up general tooltips that can have a list of links or content.
         *
         * @method _setTooltips
         * @private
         */
        _setTooltips: function _setTooltips() {
            var that = this;
            var triggerCls = '.js-cms-tree-tooltip-trigger';
            var containerCls = '.js-cms-tree-tooltip-container';
            var triggers;
            var containers;
            var index;

            // attach event to the trigger
            this.ui.container.on(this.click, triggerCls, function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();

                triggers = $(triggerCls);
                containers = $(containerCls);
                index = triggers.index(this);

                // cancel if opened tooltip is triggered again
                if (containers.eq(index).is(':visible')) {
                    containers.removeClass('cms-tree-tooltip-container-open');
                    return false;
                }

                // otherwise show the dropdown
                containers
                    .removeClass('cms-tree-tooltip-container-open')
                    .eq(index)
                    .addClass('cms-tree-tooltip-container-open');

                that.ui.document.one(that.click, function () {
                    containers.removeClass('cms-tree-tooltip-container-open');
                });
            });

            // stop propagnation on the element
            this.ui.container.on(this.click, containerCls, function (e) {
                e.stopImmediatePropagation();
            });
        },

        /**
         * Triggers the links `href` as ajax post request.
         *
         * @method _setAjaxPost
         * @private
         * @param {jQuery} trigger jQuery link target
         */
        _setAjaxPost: function _setAjaxPost(trigger) {
            var that = this;

            this.ui.container.on(this.click, trigger, function (e) {
                e.preventDefault();
                $.ajax({
                    method: 'post',
                    url: $(this).attr('href')
                }).done(function () {
                    if (window.self !== window.top) {
                        // if we're in the sideframe we have to actually
                        // check if we are publishing a page we're currently in
                        // because if the slug did change we would need to
                        // redirect to that new slug
                        // Problem here is that in case of the apphooked page
                        // the model and pk are empty and reloadBrowser doesn't really
                        // do anything - so here we specifically force the data
                        // to be the data about the page and not the model
                        var parent = (window.parent ? window.parent : window);
                        var data = {
                            // FIXME shouldn't be hardcoded
                            model: 'cms.page',
                            pk: parent.CMS.config.request.page_id
                        };
                        CMS.API.Helpers.reloadBrowser(false, false, true, data);
                    } else {
                        // otherwise simply reload the page
                        that._reloadHelper();
                    }
                }).fail(function (error) {
                    that.showError(error.statusText);
                });
            });
        },

        /**
         * Sets events for the search on the header.
         *
         * @method _setSearch
         * @private
         */
        _setSearch: function () {
            var that = this;

            var filterActive = false;
            var filterTrigger = this.ui.container.find('.js-cms-pagetree-header-filter-trigger');
            var filterContainer = this.ui.container.find('.js-cms-pagetree-header-filter-container');
            var filterClose = filterContainer.find('.js-cms-pagetree-header-search-close');
            var filterClass = 'cms-pagetree-header-filter-active';

            var visibleForm = this.ui.container.find('.js-cms-pagetree-header-search');
            var hiddenForm = this.ui.container.find('.js-cms-pagetree-header-search-copy form');

            var searchContainer = this.ui.container.find('.cms-pagetree-header-filter');
            var searchField = searchContainer.find('#field-searchbar');
            var timeout = 200;

            // add active class when focusing the search field
            searchField.on('focus', function (e) {
                e.stopImmediatePropagation();
                searchContainer.addClass(filterClass);
            });
            searchField.on('blur', function (e) {
                e.stopImmediatePropagation();
                // timeout is required to prevent the search field from jumping
                // between enlarging and shrinking
                setTimeout(function () {
                    if (!filterActive) {
                        searchContainer.removeClass(filterClass);
                    }
                }, timeout);
                that.ui.document.off(that.click);
            });

            // shows/hides filter box
            filterTrigger.add(filterClose).on(this.click, function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();
                if (!filterActive) {
                    filterContainer.show();
                    searchContainer.addClass(filterClass);
                    that.ui.document.on(that.click, function () {
                        filterActive = true;
                        filterTrigger.trigger(that.click);
                    });
                    filterActive = true;
                } else {
                    filterContainer.hide();
                    searchContainer.removeClass(filterClass);
                    that.ui.document.off(that.click);
                    filterActive = false;
                }
            });

            // prevent closing when on filter container
            filterContainer.on('click', function (e) {
                e.stopImmediatePropagation();
            });

            // add hidden fields to the form to maintain filter params
            visibleForm.append(hiddenForm.find('input[type="hidden"]'));
        },

        /**
         * Shows paste helpers.
         *
         * @method _showHelpers
         * @private
         */
        _showHelpers: function _showHelpers() {
            // helpers are generated on the fly, so we need to reference
            // them every single time
            $('.cms-tree-item-helpers').removeClass('cms-hidden');
        },

        /**
         * Hides paste helpers.
         *
         * @method _hideHelpers
         * @private
         */
        _hideHelpers: function _hideHelpers() {
            // helpers are generated on the fly, so we need to reference
            // them every single time
            $('.cms-tree-item-helpers').addClass('cms-hidden');
            this.cache.id = null;
        },

        /**
         * Checks the current state of the helpers after `after_open.jstree`
         * or `_cutOrCopy` is triggered.
         *
         * @method _checkHelpers
         * @private
         */
        _checkHelpers: function _checkHelpers() {
            if (this.cache.type && this.cache.id) {
                this._showHelpers(this.cache.type);
            }

            // hide cut element and it's descendants' paste helpers if it is visible
            if (this.cache.type === 'cut' && this.cache.target) {
                var descendantIds = this.ui.tree.jstree(true).get_node(this.cache.id).children_d;

                [this.cache.id].concat(descendantIds).forEach(function (id) {
                    $('.jsgrid_' + id + '_col .cms-tree-item-helpers')
                        .addClass('cms-hidden');
                });
            }
        },

        /**
         * Shows success message on node after successful action.
         *
         * @method _showSuccess
         * @param {Number} id id of the element to add the success class
         * @private
         */
        _showSuccess: function _showSuccess(id) {
            var element = this.ui.tree.find('li[data-id="' + id + '"]');
            element.addClass('cms-tree-node-success');
            setTimeout(function () {
                element.removeClass('cms-tree-node-success');
            }, this.successTimer);
            // hide elements
            this._hideHelpers();
        },

        /**
         * Checks if we should reload the iframe or entire window. For this we
         * need to skip `CMS.API.Helpers.reloadBrowser();`.
         *
         * @method _reloadHelper
         * @private
         */
        _reloadHelper: function _reloadHelper() {
            if (window.self !== window.top) {
                window.location.reload();
            } else {
                CMS.API.Helpers.reloadBrowser();
            }
        },

        /**
         * Displays an error within the django UI.
         *
         * @method showError
         * @param {String} message string message to display
         */
        showError: function showError(message) {
            var messages = $('.messagelist');
            var breadcrumb = $('.breadcrumbs');
            var reload = this.options.lang.reload;
            var tpl = '' +
                '<ul class="messagelist">' +
                '   <li class="error">' +
                '       {msg} ' +
                '       <a href="#reload" class="cms-tree-reload"> ' + reload + ' </a>' +
                '   </li>' +
                '</ul>';
            var msg = tpl.replace('{msg}', '<strong>' + this.options.lang.error + '</strong> ' + message);

            messages.length ? messages.replaceWith(msg) : breadcrumb.after(msg);
        }

    });

    // shorthand for jQuery(document).ready();
    $(function () {
        // load cms settings beforehand
        // have to set toolbar to "expanded" by default
        // otherwise initialization will be incorrect when you
        // go first to pages and then to normal page
        CMS.config = {
            settings: {
                toolbar: 'expanded'
            },
            urls: {
                settings: $('.js-cms-pagetree').data('settings-url')
            }
        };
        CMS.settings = CMS.API.Helpers.getSettings();
        // autoload the pagetree
        new CMS.PageTree();
    });

})(CMS.$);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzdHJlZS5taW4uanMiLCJqc3RyZWUuZ3JpZC5taW4uanMiLCJjbXMucGFnZXRyZWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJidW5kbGUuYWRtaW4ucGFnZXRyZWUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAgICBUSElTIEZJTEUgSEFTIEJFRU4gTUFOVUFMTFkgUEFUQ0hFRCBVTlRJTCBQUiAjMTM0MiBHRVRTIFJFTEVBU0VEXG4gICAgaHR0cHM6Ly9naXRodWIuY29tL3Zha2F0YS9qc3RyZWUvcHVsbC8xMzQyL2ZpbGVzXG4gKi9cbiFmdW5jdGlvbihlKXtcInVzZSBzdHJpY3RcIjtcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKFtcImpxdWVyeVwiXSxlKTpcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1lKHJlcXVpcmUoXCJqcXVlcnlcIikpOmUoalF1ZXJ5KX0oZnVuY3Rpb24oZSx0KXtcInVzZSBzdHJpY3RcIjtpZighZS5qc3RyZWUpe3ZhciBpLHIscz0wLG49ITEsYT0hMSxvPSExLGQ9W10sYz1lKFwic2NyaXB0Omxhc3RcIikuYXR0cihcInNyY1wiKSxsPXdpbmRvdy5kb2N1bWVudCxoPWwuY3JlYXRlRWxlbWVudChcIkxJXCIpO2guc2V0QXR0cmlidXRlKFwicm9sZVwiLFwidHJlZWl0ZW1cIiksaT1sLmNyZWF0ZUVsZW1lbnQoXCJJXCIpLGkuY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLW9jbFwiLGkuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGguYXBwZW5kQ2hpbGQoaSksaT1sLmNyZWF0ZUVsZW1lbnQoXCJBXCIpLGkuY2xhc3NOYW1lPVwianN0cmVlLWFuY2hvclwiLGkuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiI1wiKSxpLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsXCItMVwiKSxyPWwuY3JlYXRlRWxlbWVudChcIklcIiksci5jbGFzc05hbWU9XCJqc3RyZWUtaWNvbiBqc3RyZWUtdGhlbWVpY29uXCIsci5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksaS5hcHBlbmRDaGlsZChyKSxoLmFwcGVuZENoaWxkKGkpLGk9cj1udWxsLGUuanN0cmVlPXt2ZXJzaW9uOlwiMy4yLjFcIixkZWZhdWx0czp7cGx1Z2luczpbXX0scGx1Z2luczp7fSxwYXRoOmMmJi0xIT09Yy5pbmRleE9mKFwiL1wiKT9jLnJlcGxhY2UoL1xcL1teXFwvXSskLyxcIlwiKTpcIlwiLGlkcmVnZXg6L1tcXFxcOiYhXnwoKVxcW1xcXTw+QConK34jXCI7Liw9XFwtIFxcLyR7fSU/YF0vZyxyb290OlwiI1wifSxlLmpzdHJlZS5jcmVhdGU9ZnVuY3Rpb24odCxpKXt2YXIgcj1uZXcgZS5qc3RyZWUuY29yZSgrK3MpLG49aTtyZXR1cm4gaT1lLmV4dGVuZCghMCx7fSxlLmpzdHJlZS5kZWZhdWx0cyxpKSxuJiZuLnBsdWdpbnMmJihpLnBsdWdpbnM9bi5wbHVnaW5zKSxlLmVhY2goaS5wbHVnaW5zLGZ1bmN0aW9uKGUsdCl7XCJjb3JlXCIhPT1lJiYocj1yLnBsdWdpbih0LGlbdF0pKX0pLGUodCkuZGF0YShcImpzdHJlZVwiLHIpLHIuaW5pdCh0LGkpLHJ9LGUuanN0cmVlLmRlc3Ryb3k9ZnVuY3Rpb24oKXtlKFwiLmpzdHJlZTpqc3RyZWVcIikuanN0cmVlKFwiZGVzdHJveVwiKSxlKGwpLm9mZihcIi5qc3RyZWVcIil9LGUuanN0cmVlLmNvcmU9ZnVuY3Rpb24oZSl7dGhpcy5faWQ9ZSx0aGlzLl9jbnQ9MCx0aGlzLl93cms9bnVsbCx0aGlzLl9kYXRhPXtjb3JlOnt0aGVtZXM6e25hbWU6ITEsZG90czohMSxpY29uczohMX0sc2VsZWN0ZWQ6W10sbGFzdF9lcnJvcjp7fSx3b3JraW5nOiExLHdvcmtlcl9xdWV1ZTpbXSxmb2N1c2VkOm51bGx9fX0sZS5qc3RyZWUucmVmZXJlbmNlPWZ1bmN0aW9uKHQpe3ZhciBpPW51bGwscj1udWxsO2lmKCF0fHwhdC5pZHx8dC50YWdOYW1lJiZ0Lm5vZGVUeXBlfHwodD10LmlkKSwhcnx8IXIubGVuZ3RoKXRyeXtyPWUodCl9Y2F0Y2gocyl7fWlmKCFyfHwhci5sZW5ndGgpdHJ5e3I9ZShcIiNcIit0LnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSl9Y2F0Y2gocyl7fXJldHVybiByJiZyLmxlbmd0aCYmKHI9ci5jbG9zZXN0KFwiLmpzdHJlZVwiKSkubGVuZ3RoJiYocj1yLmRhdGEoXCJqc3RyZWVcIikpP2k9cjplKFwiLmpzdHJlZVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIHI9ZSh0aGlzKS5kYXRhKFwianN0cmVlXCIpO3JldHVybiByJiZyLl9tb2RlbC5kYXRhW3RdPyhpPXIsITEpOnZvaWQgMH0pLGl9LGUuZm4uanN0cmVlPWZ1bmN0aW9uKGkpe3ZhciByPVwic3RyaW5nXCI9PXR5cGVvZiBpLHM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLG49bnVsbDtyZXR1cm4gaSE9PSEwfHx0aGlzLmxlbmd0aD8odGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9ZS5qc3RyZWUucmVmZXJlbmNlKHRoaXMpLG89ciYmYT9hW2ldOm51bGw7cmV0dXJuIG49ciYmbz9vLmFwcGx5KGEscyk6bnVsbCxhfHxyfHxpIT09dCYmIWUuaXNQbGFpbk9iamVjdChpKXx8ZS5qc3RyZWUuY3JlYXRlKHRoaXMsaSksKGEmJiFyfHxpPT09ITApJiYobj1hfHwhMSksbnVsbCE9PW4mJm4hPT10PyExOnZvaWQgMH0pLG51bGwhPT1uJiZuIT09dD9uOnRoaXMpOiExfSxlLmV4cHJbXCI6XCJdLmpzdHJlZT1lLmV4cHIuY3JlYXRlUHNldWRvKGZ1bmN0aW9uKGkpe3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gZShpKS5oYXNDbGFzcyhcImpzdHJlZVwiKSYmZShpKS5kYXRhKFwianN0cmVlXCIpIT09dH19KSxlLmpzdHJlZS5kZWZhdWx0cy5jb3JlPXtkYXRhOiExLHN0cmluZ3M6ITEsY2hlY2tfY2FsbGJhY2s6ITEsZXJyb3I6ZS5ub29wLGFuaW1hdGlvbjoyMDAsbXVsdGlwbGU6ITAsdGhlbWVzOntuYW1lOiExLHVybDohMSxkaXI6ITEsZG90czohMCxpY29uczohMCxzdHJpcGVzOiExLHZhcmlhbnQ6ITEscmVzcG9uc2l2ZTohMX0sZXhwYW5kX3NlbGVjdGVkX29ubG9hZDohMCx3b3JrZXI6ITAsZm9yY2VfdGV4dDohMSxkYmxjbGlja190b2dnbGU6ITB9LGUuanN0cmVlLmNvcmUucHJvdG90eXBlPXtwbHVnaW46ZnVuY3Rpb24odCxpKXt2YXIgcj1lLmpzdHJlZS5wbHVnaW5zW3RdO3JldHVybiByPyh0aGlzLl9kYXRhW3RdPXt9LHIucHJvdG90eXBlPXRoaXMsbmV3IHIoaSx0aGlzKSk6dGhpc30saW5pdDpmdW5jdGlvbih0LGkpe3RoaXMuX21vZGVsPXtkYXRhOnt9LGNoYW5nZWQ6W10sZm9yY2VfZnVsbF9yZWRyYXc6ITEscmVkcmF3X3RpbWVvdXQ6ITEsZGVmYXVsdF9zdGF0ZTp7bG9hZGVkOiEwLG9wZW5lZDohMSxzZWxlY3RlZDohMSxkaXNhYmxlZDohMX19LHRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF09e2lkOmUuanN0cmVlLnJvb3QscGFyZW50Om51bGwscGFyZW50czpbXSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLHN0YXRlOntsb2FkZWQ6ITF9fSx0aGlzLmVsZW1lbnQ9ZSh0KS5hZGRDbGFzcyhcImpzdHJlZSBqc3RyZWUtXCIrdGhpcy5faWQpLHRoaXMuc2V0dGluZ3M9aSx0aGlzLl9kYXRhLmNvcmUucmVhZHk9ITEsdGhpcy5fZGF0YS5jb3JlLmxvYWRlZD0hMSx0aGlzLl9kYXRhLmNvcmUucnRsPVwicnRsXCI9PT10aGlzLmVsZW1lbnQuY3NzKFwiZGlyZWN0aW9uXCIpLHRoaXMuZWxlbWVudFt0aGlzLl9kYXRhLmNvcmUucnRsP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLXJ0bFwiKSx0aGlzLmVsZW1lbnQuYXR0cihcInJvbGVcIixcInRyZWVcIiksdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiZ0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtbXVsdGlzZWxlY3RhYmxlXCIsITApLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIil8fHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIjBcIiksdGhpcy5iaW5kKCksdGhpcy50cmlnZ2VyKFwiaW5pdFwiKSx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWw9dGhpcy5lbGVtZW50LmZpbmQoXCIgPiB1bCA+IGxpXCIpLmNsb25lKCEwKSx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWwuZmluZChcImxpXCIpLmFkZEJhY2soKS5jb250ZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzPT09dGhpcy5ub2RlVHlwZSYmKCF0aGlzLm5vZGVWYWx1ZXx8L15cXHMrJC8udGVzdCh0aGlzLm5vZGVWYWx1ZSkpfSkucmVtb3ZlKCksdGhpcy5lbGVtZW50Lmh0bWwoXCI8dWwgY2xhc3M9J2pzdHJlZS1jb250YWluZXItdWwganN0cmVlLWNoaWxkcmVuJyByb2xlPSdncm91cCc+PGxpIGlkPSdqXCIrdGhpcy5faWQrXCJfbG9hZGluZycgY2xhc3M9J2pzdHJlZS1pbml0aWFsLW5vZGUganN0cmVlLWxvYWRpbmcganN0cmVlLWxlYWYganN0cmVlLWxhc3QnIHJvbGU9J3RyZWUtaXRlbSc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS1vY2wnPjwvaT48YSBjbGFzcz0nanN0cmVlLWFuY2hvcicgaHJlZj0nIyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb24taGlkZGVuJz48L2k+XCIrdGhpcy5nZXRfc3RyaW5nKFwiTG9hZGluZyAuLi5cIikrXCI8L2E+PC9saT48L3VsPlwiKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFwialwiK3RoaXMuX2lkK1wiX2xvYWRpbmdcIiksdGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodD10aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcImxpXCIpLmZpcnN0KCkuaGVpZ2h0KCl8fDI0LHRoaXMudHJpZ2dlcihcImxvYWRpbmdcIiksdGhpcy5sb2FkX25vZGUoZS5qc3RyZWUucm9vdCl9LGRlc3Ryb3k6ZnVuY3Rpb24oZSl7aWYodGhpcy5fd3JrKXRyeXt3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLl93cmspLHRoaXMuX3dyaz1udWxsfWNhdGNoKHQpe31lfHx0aGlzLmVsZW1lbnQuZW1wdHkoKSx0aGlzLnRlYXJkb3duKCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7dGhpcy51bmJpbmQoKSx0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWVcIikucmVtb3ZlRGF0YShcImpzdHJlZVwiKS5maW5kKFwiW2NsYXNzXj0nanN0cmVlJ11cIikuYWRkQmFjaygpLmF0dHIoXCJjbGFzc1wiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2xhc3NOYW1lLnJlcGxhY2UoL2pzdHJlZVteIF0qfCQvZ2ksXCJcIil9KSx0aGlzLmVsZW1lbnQ9bnVsbH0sYmluZDpmdW5jdGlvbigpe3ZhciB0PVwiXCIsaT1udWxsLHI9MDt0aGlzLmVsZW1lbnQub24oXCJkYmxjbGljay5qc3RyZWVcIixmdW5jdGlvbihlKXtpZihlLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1lLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aWYobC5zZWxlY3Rpb24mJmwuc2VsZWN0aW9uLmVtcHR5KWwuc2VsZWN0aW9uLmVtcHR5KCk7ZWxzZSBpZih3aW5kb3cuZ2V0U2VsZWN0aW9uKXt2YXIgdD13aW5kb3cuZ2V0U2VsZWN0aW9uKCk7dHJ5e3QucmVtb3ZlQWxsUmFuZ2VzKCksdC5jb2xsYXBzZSgpfWNhdGNoKGkpe319fSkub24oXCJtb3VzZWRvd24uanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlKXtlLnRhcmdldD09PXRoaXMuZWxlbWVudFswXSYmKGUucHJldmVudERlZmF1bHQoKSxyPStuZXcgRGF0ZSl9LHRoaXMpKS5vbihcIm1vdXNlZG93bi5qc3RyZWVcIixcIi5qc3RyZWUtb2NsXCIsZnVuY3Rpb24oZSl7ZS5wcmV2ZW50RGVmYXVsdCgpfSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtb2NsXCIsZS5wcm94eShmdW5jdGlvbihlKXt0aGlzLnRvZ2dsZV9ub2RlKGUudGFyZ2V0KX0sdGhpcykpLm9uKFwiZGJsY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKT8hMDp2b2lkKHRoaXMuc2V0dGluZ3MuY29yZS5kYmxjbGlja190b2dnbGUmJnRoaXMudG9nZ2xlX25vZGUoZS50YXJnZXQpKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24odCl7dC5wcmV2ZW50RGVmYXVsdCgpLHQuY3VycmVudFRhcmdldCE9PWwuYWN0aXZlRWxlbWVudCYmZSh0LmN1cnJlbnRUYXJnZXQpLmZvY3VzKCksdGhpcy5hY3RpdmF0ZV9ub2RlKHQuY3VycmVudFRhcmdldCx0KX0sdGhpcykpLm9uKFwia2V5ZG93bi5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZS5wcm94eShmdW5jdGlvbih0KXtpZih0LnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT10LnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aWYoMzIhPT10LndoaWNoJiYxMyE9PXQud2hpY2gmJih0LnNoaWZ0S2V5fHx0LmN0cmxLZXl8fHQuYWx0S2V5fHx0Lm1ldGFLZXkpKXJldHVybiEwO3ZhciBpPW51bGw7c3dpdGNoKHRoaXMuX2RhdGEuY29yZS5ydGwmJigzNz09PXQud2hpY2g/dC53aGljaD0zOTozOT09PXQud2hpY2gmJih0LndoaWNoPTM3KSksdC53aGljaCl7Y2FzZSAzMjp0LmN0cmxLZXkmJih0LnR5cGU9XCJjbGlja1wiLGUodC5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKHQpKTticmVhaztjYXNlIDEzOnQudHlwZT1cImNsaWNrXCIsZSh0LmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIodCk7YnJlYWs7Y2FzZSAzNzp0LnByZXZlbnREZWZhdWx0KCksdGhpcy5pc19vcGVuKHQuY3VycmVudFRhcmdldCk/dGhpcy5jbG9zZV9ub2RlKHQuY3VycmVudFRhcmdldCk6KGk9dGhpcy5nZXRfcGFyZW50KHQuY3VycmVudFRhcmdldCksaSYmaS5pZCE9PWUuanN0cmVlLnJvb3QmJnRoaXMuZ2V0X25vZGUoaSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpKTticmVhaztjYXNlIDM4OnQucHJldmVudERlZmF1bHQoKSxpPXRoaXMuZ2V0X3ByZXZfZG9tKHQuY3VycmVudFRhcmdldCksaSYmaS5sZW5ndGgmJmkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpO2JyZWFrO2Nhc2UgMzk6dC5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuaXNfY2xvc2VkKHQuY3VycmVudFRhcmdldCk/dGhpcy5vcGVuX25vZGUodC5jdXJyZW50VGFyZ2V0LGZ1bmN0aW9uKGUpe3RoaXMuZ2V0X25vZGUoZSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpfSk6dGhpcy5pc19vcGVuKHQuY3VycmVudFRhcmdldCkmJihpPXRoaXMuZ2V0X25vZGUodC5jdXJyZW50VGFyZ2V0LCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0saSYmZSh0aGlzLl9maXJzdENoaWxkKGkpKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpO2JyZWFrO2Nhc2UgNDA6dC5wcmV2ZW50RGVmYXVsdCgpLGk9dGhpcy5nZXRfbmV4dF9kb20odC5jdXJyZW50VGFyZ2V0KSxpJiZpLmxlbmd0aCYmaS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAxMDY6dGhpcy5vcGVuX2FsbCgpO2JyZWFrO2Nhc2UgMzY6dC5wcmV2ZW50RGVmYXVsdCgpLGk9dGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSksaSYmZShpKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAzNTp0LnByZXZlbnREZWZhdWx0KCksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5maWx0ZXIoXCI6dmlzaWJsZVwiKS5sYXN0KCkuZm9jdXMoKX19LHRoaXMpKS5vbihcImxvYWRfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7aS5zdGF0dXMmJihpLm5vZGUuaWQhPT1lLmpzdHJlZS5yb290fHx0aGlzLl9kYXRhLmNvcmUubG9hZGVkfHwodGhpcy5fZGF0YS5jb3JlLmxvYWRlZD0hMCx0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKS5pZCksdGhpcy50cmlnZ2VyKFwibG9hZGVkXCIpKSx0aGlzLl9kYXRhLmNvcmUucmVhZHl8fHNldFRpbWVvdXQoZS5wcm94eShmdW5jdGlvbigpe2lmKHRoaXMuZWxlbWVudCYmIXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmZpbmQoXCIuanN0cmVlLWxvYWRpbmdcIikubGVuZ3RoKXtpZih0aGlzLl9kYXRhLmNvcmUucmVhZHk9ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCl7aWYodGhpcy5zZXR0aW5ncy5jb3JlLmV4cGFuZF9zZWxlY3RlZF9vbmxvYWQpe3ZhciB0LGkscj1bXTtmb3IodD0wLGk9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtpPnQ7dCsrKXI9ci5jb25jYXQodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbdF1dLnBhcmVudHMpO2ZvcihyPWUudmFrYXRhLmFycmF5X3VuaXF1ZShyKSx0PTAsaT1yLmxlbmd0aDtpPnQ7dCsrKXRoaXMub3Blbl9ub2RlKHJbdF0sITEsMCl9dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJyZWFkeVwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pfXRoaXMudHJpZ2dlcihcInJlYWR5XCIpfX0sdGhpcyksMCkpfSx0aGlzKSkub24oXCJrZXlwcmVzcy5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHIpe2lmKHIudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PXIudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtpJiZjbGVhclRpbWVvdXQoaSksaT1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dD1cIlwifSw1MDApO3ZhciBzPVN0cmluZy5mcm9tQ2hhckNvZGUoci53aGljaCkudG9Mb3dlckNhc2UoKSxuPXRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1hbmNob3JcIikuZmlsdGVyKFwiOnZpc2libGVcIiksYT1uLmluZGV4KGwuYWN0aXZlRWxlbWVudCl8fDAsbz0hMTtpZih0Kz1zLHQubGVuZ3RoPjEpe2lmKG4uc2xpY2UoYSkuZWFjaChlLnByb3h5KGZ1bmN0aW9uKGkscil7cmV0dXJuIDA9PT1lKHIpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodCk/KGUocikuZm9jdXMoKSxvPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxvKXJldHVybjtpZihuLnNsaWNlKDAsYSkuZWFjaChlLnByb3h5KGZ1bmN0aW9uKGkscil7cmV0dXJuIDA9PT1lKHIpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodCk/KGUocikuZm9jdXMoKSxvPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxvKXJldHVybn1pZihuZXcgUmVnRXhwKFwiXlwiK3MucmVwbGFjZSgvWy1cXC9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLFwiXFxcXCQmXCIpK1wiKyRcIikudGVzdCh0KSl7aWYobi5zbGljZShhKzEpLmVhY2goZS5wcm94eShmdW5jdGlvbih0LGkpe3JldHVybiBlKGkpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmNoYXJBdCgwKT09PXM/KGUoaSkuZm9jdXMoKSxvPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxvKXJldHVybjtpZihuLnNsaWNlKDAsYSsxKS5lYWNoKGUucHJveHkoZnVuY3Rpb24odCxpKXtyZXR1cm4gZShpKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCk9PT1zPyhlKGkpLmZvY3VzKCksbz0hMCwhMSk6dm9pZCAwfSx0aGlzKSksbylyZXR1cm59fSx0aGlzKSkub24oXCJpbml0LmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oKXt2YXIgZT10aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzO3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz1lLmRvdHMsdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPWUuc3RyaXBlcyx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPWUuaWNvbnMsdGhpcy5zZXRfdGhlbWUoZS5uYW1lfHxcImRlZmF1bHRcIixlLnVybCksdGhpcy5zZXRfdGhlbWVfdmFyaWFudChlLnZhcmlhbnQpfSx0aGlzKSkub24oXCJsb2FkaW5nLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oKXt0aGlzW3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz9cInNob3dfZG90c1wiOlwiaGlkZV9kb3RzXCJdKCksdGhpc1t0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zP1wic2hvd19pY29uc1wiOlwiaGlkZV9pY29uc1wiXSgpLHRoaXNbdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzP1wic2hvd19zdHJpcGVzXCI6XCJoaWRlX3N0cmlwZXNcIl0oKX0sdGhpcykpLm9uKFwiYmx1ci5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZS5wcm94eShmdW5jdGlvbih0KXt0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsLGUodC5jdXJyZW50VGFyZ2V0KS5maWx0ZXIoXCIuanN0cmVlLWhvdmVyZWRcIikubW91c2VsZWF2ZSgpLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIjBcIil9LHRoaXMpKS5vbihcImZvY3VzLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuZ2V0X25vZGUodC5jdXJyZW50VGFyZ2V0KTtpJiZpLmlkJiYodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9aS5pZCksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWhvdmVyZWRcIikubm90KHQuY3VycmVudFRhcmdldCkubW91c2VsZWF2ZSgpLGUodC5jdXJyZW50VGFyZ2V0KS5tb3VzZWVudGVyKCksdGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiLFwiLTFcIil9LHRoaXMpKS5vbihcImZvY3VzLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oKXtpZigrbmV3IERhdGUtcj41MDAmJiF0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCl7cj0wO3ZhciBlPXRoaXMuZ2V0X25vZGUodGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIiksITApO2UmJmUuZmluZChcIj4gLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKX19LHRoaXMpKS5vbihcIm1vdXNlZW50ZXIuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy5ob3Zlcl9ub2RlKGUuY3VycmVudFRhcmdldCl9LHRoaXMpKS5vbihcIm1vdXNlbGVhdmUuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy5kZWhvdmVyX25vZGUoZS5jdXJyZW50VGFyZ2V0KX0sdGhpcykpfSx1bmJpbmQ6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub2ZmKFwiLmpzdHJlZVwiKSxlKGwpLm9mZihcIi5qc3RyZWUtXCIrdGhpcy5faWQpfSx0cmlnZ2VyOmZ1bmN0aW9uKGUsdCl7dHx8KHQ9e30pLHQuaW5zdGFuY2U9dGhpcyx0aGlzLmVsZW1lbnQudHJpZ2dlckhhbmRsZXIoZS5yZXBsYWNlKFwiLmpzdHJlZVwiLFwiXCIpK1wiLmpzdHJlZVwiLHQpfSxnZXRfY29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudH0sZ2V0X2NvbnRhaW5lcl91bDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmZpcnN0KCl9LGdldF9zdHJpbmc6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5zZXR0aW5ncy5jb3JlLnN0cmluZ3M7cmV0dXJuIGUuaXNGdW5jdGlvbihpKT9pLmNhbGwodGhpcyx0KTppJiZpW3RdP2lbdF06dH0sX2ZpcnN0Q2hpbGQ6ZnVuY3Rpb24oZSl7Zm9yKGU9ZT9lLmZpcnN0Q2hpbGQ6bnVsbDtudWxsIT09ZSYmMSE9PWUubm9kZVR5cGU7KWU9ZS5uZXh0U2libGluZztyZXR1cm4gZX0sX25leHRTaWJsaW5nOmZ1bmN0aW9uKGUpe2ZvcihlPWU/ZS5uZXh0U2libGluZzpudWxsO251bGwhPT1lJiYxIT09ZS5ub2RlVHlwZTspZT1lLm5leHRTaWJsaW5nO3JldHVybiBlfSxfcHJldmlvdXNTaWJsaW5nOmZ1bmN0aW9uKGUpe2ZvcihlPWU/ZS5wcmV2aW91c1NpYmxpbmc6bnVsbDtudWxsIT09ZSYmMSE9PWUubm9kZVR5cGU7KWU9ZS5wcmV2aW91c1NpYmxpbmc7cmV0dXJuIGV9LGdldF9ub2RlOmZ1bmN0aW9uKHQsaSl7dCYmdC5pZCYmKHQ9dC5pZCk7dmFyIHI7dHJ5e2lmKHRoaXMuX21vZGVsLmRhdGFbdF0pdD10aGlzLl9tb2RlbC5kYXRhW3RdO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIHQmJnRoaXMuX21vZGVsLmRhdGFbdC5yZXBsYWNlKC9eIy8sXCJcIildKXQ9dGhpcy5fbW9kZWwuZGF0YVt0LnJlcGxhY2UoL14jLyxcIlwiKV07ZWxzZSBpZihcInN0cmluZ1wiPT10eXBlb2YgdCYmKHI9ZShcIiNcIit0LnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpKS5sZW5ndGgmJnRoaXMuX21vZGVsLmRhdGFbci5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV0pdD10aGlzLl9tb2RlbC5kYXRhW3IuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildO2Vsc2UgaWYoKHI9ZSh0LHRoaXMuZWxlbWVudCkpLmxlbmd0aCYmdGhpcy5fbW9kZWwuZGF0YVtyLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuYXR0cihcImlkXCIpXSl0PXRoaXMuX21vZGVsLmRhdGFbci5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV07ZWxzZXtpZighKHI9ZSh0LHRoaXMuZWxlbWVudCkpLmxlbmd0aHx8IXIuaGFzQ2xhc3MoXCJqc3RyZWVcIikpcmV0dXJuITE7dD10aGlzLl9tb2RlbC5kYXRhW2UuanN0cmVlLnJvb3RdfXJldHVybiBpJiYodD10LmlkPT09ZS5qc3RyZWUucm9vdD90aGlzLmVsZW1lbnQ6ZShcIiNcIit0LmlkLnJlcGxhY2UoZS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpKSx0fWNhdGNoKHMpe3JldHVybiExfX0sZ2V0X3BhdGg6ZnVuY3Rpb24odCxpLHIpe2lmKHQ9dC5wYXJlbnRzP3Q6dGhpcy5nZXRfbm9kZSh0KSwhdHx8dC5pZD09PWUuanN0cmVlLnJvb3R8fCF0LnBhcmVudHMpcmV0dXJuITE7dmFyIHMsbixhPVtdO2ZvcihhLnB1c2gocj90LmlkOnQudGV4dCkscz0wLG49dC5wYXJlbnRzLmxlbmd0aDtuPnM7cysrKWEucHVzaChyP3QucGFyZW50c1tzXTp0aGlzLmdldF90ZXh0KHQucGFyZW50c1tzXSkpO3JldHVybiBhPWEucmV2ZXJzZSgpLnNsaWNlKDEpLGk/YS5qb2luKGkpOmF9LGdldF9uZXh0X2RvbTpmdW5jdGlvbih0LGkpe3ZhciByO2lmKHQ9dGhpcy5nZXRfbm9kZSh0LCEwKSx0WzBdPT09dGhpcy5lbGVtZW50WzBdKXtmb3Iocj10aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKTtyJiYwPT09ci5vZmZzZXRIZWlnaHQ7KXI9dGhpcy5fbmV4dFNpYmxpbmcocik7cmV0dXJuIHI/ZShyKTohMX1pZighdHx8IXQubGVuZ3RoKXJldHVybiExO2lmKGkpe3I9dFswXTtkbyByPXRoaXMuX25leHRTaWJsaW5nKHIpO3doaWxlKHImJjA9PT1yLm9mZnNldEhlaWdodCk7cmV0dXJuIHI/ZShyKTohMX1pZih0Lmhhc0NsYXNzKFwianN0cmVlLW9wZW5cIikpe2ZvcihyPXRoaXMuX2ZpcnN0Q2hpbGQodC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pO3ImJjA9PT1yLm9mZnNldEhlaWdodDspcj10aGlzLl9uZXh0U2libGluZyhyKTtpZihudWxsIT09cilyZXR1cm4gZShyKX1yPXRbMF07ZG8gcj10aGlzLl9uZXh0U2libGluZyhyKTt3aGlsZShyJiYwPT09ci5vZmZzZXRIZWlnaHQpO3JldHVybiBudWxsIT09cj9lKHIpOnQucGFyZW50c1VudGlsKFwiLmpzdHJlZVwiLFwiLmpzdHJlZS1ub2RlXCIpLm5leHRBbGwoXCIuanN0cmVlLW5vZGU6dmlzaWJsZVwiKS5maXJzdCgpfSxnZXRfcHJldl9kb206ZnVuY3Rpb24odCxpKXt2YXIgcjtpZih0PXRoaXMuZ2V0X25vZGUodCwhMCksdFswXT09PXRoaXMuZWxlbWVudFswXSl7Zm9yKHI9dGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0ubGFzdENoaWxkO3ImJjA9PT1yLm9mZnNldEhlaWdodDspcj10aGlzLl9wcmV2aW91c1NpYmxpbmcocik7cmV0dXJuIHI/ZShyKTohMX1pZighdHx8IXQubGVuZ3RoKXJldHVybiExO2lmKGkpe3I9dFswXTtkbyByPXRoaXMuX3ByZXZpb3VzU2libGluZyhyKTt3aGlsZShyJiYwPT09ci5vZmZzZXRIZWlnaHQpO3JldHVybiByP2Uocik6ITF9cj10WzBdO2RvIHI9dGhpcy5fcHJldmlvdXNTaWJsaW5nKHIpO3doaWxlKHImJjA9PT1yLm9mZnNldEhlaWdodCk7aWYobnVsbCE9PXIpe2Zvcih0PWUocik7dC5oYXNDbGFzcyhcImpzdHJlZS1vcGVuXCIpOyl0PXQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmZpcnN0KCkuY2hpbGRyZW4oXCIuanN0cmVlLW5vZGU6dmlzaWJsZTpsYXN0XCIpO3JldHVybiB0fXJldHVybiByPXRbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLHImJnIuY2xhc3NOYW1lJiYtMSE9PXIuY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtbm9kZVwiKT9lKHIpOiExfSxnZXRfcGFyZW50OmZ1bmN0aW9uKHQpe3JldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/dC5wYXJlbnQ6ITF9LGdldF9jaGlsZHJlbl9kb206ZnVuY3Rpb24oZSl7cmV0dXJuIGU9dGhpcy5nZXRfbm9kZShlLCEwKSxlWzBdPT09dGhpcy5lbGVtZW50WzBdP3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmNoaWxkcmVuKFwiLmpzdHJlZS1ub2RlXCIpOmUmJmUubGVuZ3RoP2UuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1ub2RlXCIpOiExfSxpc19wYXJlbnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9dGhpcy5nZXRfbm9kZShlKSxlJiYoZS5zdGF0ZS5sb2FkZWQ9PT0hMXx8ZS5jaGlsZHJlbi5sZW5ndGg+MCl9LGlzX2xvYWRlZDpmdW5jdGlvbihlKXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUpLGUmJmUuc3RhdGUubG9hZGVkfSxpc19sb2FkaW5nOmZ1bmN0aW9uKGUpe3JldHVybiBlPXRoaXMuZ2V0X25vZGUoZSksZSYmZS5zdGF0ZSYmZS5zdGF0ZS5sb2FkaW5nfSxpc19vcGVuOmZ1bmN0aW9uKGUpe3JldHVybiBlPXRoaXMuZ2V0X25vZGUoZSksZSYmZS5zdGF0ZS5vcGVuZWR9LGlzX2Nsb3NlZDpmdW5jdGlvbihlKXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUpLGUmJnRoaXMuaXNfcGFyZW50KGUpJiYhZS5zdGF0ZS5vcGVuZWR9LGlzX2xlYWY6ZnVuY3Rpb24oZSl7cmV0dXJuIXRoaXMuaXNfcGFyZW50KGUpfSxsb2FkX25vZGU6ZnVuY3Rpb24odCxpKXt2YXIgcixzLG4sYSxvO2lmKGUuaXNBcnJheSh0KSlyZXR1cm4gdGhpcy5fbG9hZF9ub2Rlcyh0LnNsaWNlKCksaSksITA7aWYodD10aGlzLmdldF9ub2RlKHQpLCF0KXJldHVybiBpJiZpLmNhbGwodGhpcyx0LCExKSwhMTtpZih0LnN0YXRlLmxvYWRlZCl7Zm9yKHQuc3RhdGUubG9hZGVkPSExLHI9MCxzPXQuY2hpbGRyZW5fZC5sZW5ndGg7cz5yO3IrKyl7Zm9yKG49MCxhPXQucGFyZW50cy5sZW5ndGg7YT5uO24rKyl0aGlzLl9tb2RlbC5kYXRhW3QucGFyZW50c1tuXV0uY2hpbGRyZW5fZD1lLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9tb2RlbC5kYXRhW3QucGFyZW50c1tuXV0uY2hpbGRyZW5fZCx0LmNoaWxkcmVuX2Rbcl0pO3RoaXMuX21vZGVsLmRhdGFbdC5jaGlsZHJlbl9kW3JdXS5zdGF0ZS5zZWxlY3RlZCYmKG89ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCx0LmNoaWxkcmVuX2Rbcl0pKSxkZWxldGUgdGhpcy5fbW9kZWwuZGF0YVt0LmNoaWxkcmVuX2Rbcl1dfXQuY2hpbGRyZW49W10sdC5jaGlsZHJlbl9kPVtdLG8mJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwibG9hZF9ub2RlXCIsbm9kZTp0LHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pfXJldHVybiB0LnN0YXRlLmZhaWxlZD0hMSx0LnN0YXRlLmxvYWRpbmc9ITAsdGhpcy5nZXRfbm9kZSh0LCEwKS5hZGRDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMCksdGhpcy5fbG9hZF9ub2RlKHQsZS5wcm94eShmdW5jdGlvbihlKXt0PXRoaXMuX21vZGVsLmRhdGFbdC5pZF0sdC5zdGF0ZS5sb2FkaW5nPSExLHQuc3RhdGUubG9hZGVkPWUsdC5zdGF0ZS5mYWlsZWQ9IXQuc3RhdGUubG9hZGVkO3ZhciByPXRoaXMuZ2V0X25vZGUodCwhMCkscz0wLG49MCxhPXRoaXMuX21vZGVsLmRhdGEsbz0hMTtmb3Iocz0wLG49dC5jaGlsZHJlbi5sZW5ndGg7bj5zO3MrKylpZihhW3QuY2hpbGRyZW5bc11dJiYhYVt0LmNoaWxkcmVuW3NdXS5zdGF0ZS5oaWRkZW4pe289ITA7YnJlYWt9dC5zdGF0ZS5sb2FkZWQmJiFvJiZyJiZyLmxlbmd0aCYmIXIuaGFzQ2xhc3MoXCJqc3RyZWUtbGVhZlwiKSYmci5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbG9zZWQganN0cmVlLW9wZW5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtbGVhZlwiKSxyLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKSx0aGlzLnRyaWdnZXIoXCJsb2FkX25vZGVcIix7bm9kZTp0LHN0YXR1czplfSksaSYmaS5jYWxsKHRoaXMsdCxlKX0sdGhpcykpLCEwfSxfbG9hZF9ub2RlczpmdW5jdGlvbihlLHQsaSl7dmFyIHIscyxuPSEwLGE9ZnVuY3Rpb24oKXt0aGlzLl9sb2FkX25vZGVzKGUsdCwhMCl9LG89dGhpcy5fbW9kZWwuZGF0YSxkPVtdO2ZvcihyPTAscz1lLmxlbmd0aDtzPnI7cisrKSFvW2Vbcl1dfHwob1tlW3JdXS5zdGF0ZS5sb2FkZWR8fG9bZVtyXV0uc3RhdGUuZmFpbGVkKSYmaXx8KHRoaXMuaXNfbG9hZGluZyhlW3JdKXx8dGhpcy5sb2FkX25vZGUoZVtyXSxhKSxuPSExKTtpZihuKXtmb3Iocj0wLHM9ZS5sZW5ndGg7cz5yO3IrKylvW2Vbcl1dJiZvW2Vbcl1dLnN0YXRlLmxvYWRlZCYmZC5wdXNoKGVbcl0pO3QmJiF0LmRvbmUmJih0LmNhbGwodGhpcyxkKSx0LmRvbmU9ITApfX0sbG9hZF9hbGw6ZnVuY3Rpb24odCxpKXtpZih0fHwodD1lLmpzdHJlZS5yb290KSx0PXRoaXMuZ2V0X25vZGUodCksIXQpcmV0dXJuITE7dmFyIHIscyxuPVtdLGE9dGhpcy5fbW9kZWwuZGF0YSxvPWFbdC5pZF0uY2hpbGRyZW5fZDtmb3IodC5zdGF0ZSYmIXQuc3RhdGUubG9hZGVkJiZuLnB1c2godC5pZCkscj0wLHM9by5sZW5ndGg7cz5yO3IrKylhW29bcl1dJiZhW29bcl1dLnN0YXRlJiYhYVtvW3JdXS5zdGF0ZS5sb2FkZWQmJm4ucHVzaChvW3JdKTtuLmxlbmd0aD90aGlzLl9sb2FkX25vZGVzKG4sZnVuY3Rpb24oKXt0aGlzLmxvYWRfYWxsKHQsaSl9KTooaSYmaS5jYWxsKHRoaXMsdCksdGhpcy50cmlnZ2VyKFwibG9hZF9hbGxcIix7bm9kZTp0fSkpfSxfbG9hZF9ub2RlOmZ1bmN0aW9uKHQsaSl7dmFyIHIscz10aGlzLnNldHRpbmdzLmNvcmUuZGF0YTtyZXR1cm4gcz9lLmlzRnVuY3Rpb24ocyk/cy5jYWxsKHRoaXMsdCxlLnByb3h5KGZ1bmN0aW9uKHIpe3I9PT0hMSYmaS5jYWxsKHRoaXMsITEpLHRoaXNbXCJzdHJpbmdcIj09dHlwZW9mIHI/XCJfYXBwZW5kX2h0bWxfZGF0YVwiOlwiX2FwcGVuZF9qc29uX2RhdGFcIl0odCxcInN0cmluZ1wiPT10eXBlb2Ygcj9lKGUucGFyc2VIVE1MKHIpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KTpyLGZ1bmN0aW9uKGUpe2kuY2FsbCh0aGlzLGUpfSl9LHRoaXMpKTpcIm9iamVjdFwiPT10eXBlb2Ygcz9zLnVybD8ocz1lLmV4dGVuZCghMCx7fSxzKSxlLmlzRnVuY3Rpb24ocy51cmwpJiYocy51cmw9cy51cmwuY2FsbCh0aGlzLHQpKSxlLmlzRnVuY3Rpb24ocy5kYXRhKSYmKHMuZGF0YT1zLmRhdGEuY2FsbCh0aGlzLHQpKSxlLmFqYXgocykuZG9uZShlLnByb3h5KGZ1bmN0aW9uKHIscyxuKXt2YXIgYT1uLmdldFJlc3BvbnNlSGVhZGVyKFwiQ29udGVudC1UeXBlXCIpO3JldHVybiBhJiYtMSE9PWEuaW5kZXhPZihcImpzb25cIil8fFwib2JqZWN0XCI9PXR5cGVvZiByP3RoaXMuX2FwcGVuZF9qc29uX2RhdGEodCxyLGZ1bmN0aW9uKGUpe2kuY2FsbCh0aGlzLGUpfSk6YSYmLTEhPT1hLmluZGV4T2YoXCJodG1sXCIpfHxcInN0cmluZ1wiPT10eXBlb2Ygcj90aGlzLl9hcHBlbmRfaHRtbF9kYXRhKHQsZShlLnBhcnNlSFRNTChyKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDMhPT10aGlzLm5vZGVUeXBlfSksZnVuY3Rpb24oZSl7aS5jYWxsKHRoaXMsZSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiYWpheFwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDRcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6dC5pZCx4aHI6bn0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSxpLmNhbGwodGhpcywhMSkpfSx0aGlzKSkuZmFpbChlLnByb3h5KGZ1bmN0aW9uKGUpe2kuY2FsbCh0aGlzLCExKSx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNFwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDp0LmlkLHhocjplfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpfSx0aGlzKSkpOihyPWUuaXNBcnJheShzKXx8ZS5pc1BsYWluT2JqZWN0KHMpP0pTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocykpOnMsdC5pZD09PWUuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2pzb25fZGF0YSh0LHIsZnVuY3Rpb24oZSl7aS5jYWxsKHRoaXMsZSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwibm9kYXRhXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNVwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDp0LmlkfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLGkuY2FsbCh0aGlzLCExKSkpOlwic3RyaW5nXCI9PXR5cGVvZiBzP3QuaWQ9PT1lLmpzdHJlZS5yb290P3RoaXMuX2FwcGVuZF9odG1sX2RhdGEodCxlKGUucGFyc2VIVE1MKHMpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KSxmdW5jdGlvbihlKXtpLmNhbGwodGhpcyxlKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJub2RhdGFcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA2XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOnQuaWR9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksaS5jYWxsKHRoaXMsITEpKTppLmNhbGwodGhpcywhMSk6dC5pZD09PWUuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2h0bWxfZGF0YSh0LHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbC5jbG9uZSghMCksZnVuY3Rpb24oZSl7aS5jYWxsKHRoaXMsZSl9KTppLmNhbGwodGhpcywhMSl9LF9ub2RlX2NoYW5nZWQ6ZnVuY3Rpb24oZSl7ZT10aGlzLmdldF9ub2RlKGUpLGUmJnRoaXMuX21vZGVsLmNoYW5nZWQucHVzaChlLmlkKX0sX2FwcGVuZF9odG1sX2RhdGE6ZnVuY3Rpb24odCxpLHIpe3Q9dGhpcy5nZXRfbm9kZSh0KSx0LmNoaWxkcmVuPVtdLHQuY2hpbGRyZW5fZD1bXTt2YXIgcyxuLGEsbz1pLmlzKFwidWxcIik/aS5jaGlsZHJlbigpOmksZD10LmlkLGM9W10sbD1bXSxoPXRoaXMuX21vZGVsLmRhdGEsXz1oW2RdLHU9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtmb3Ioby5lYWNoKGUucHJveHkoZnVuY3Rpb24odCxpKXtzPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21faHRtbChlKGkpLGQsXy5wYXJlbnRzLmNvbmNhdCgpKSxzJiYoYy5wdXNoKHMpLGwucHVzaChzKSxoW3NdLmNoaWxkcmVuX2QubGVuZ3RoJiYobD1sLmNvbmNhdChoW3NdLmNoaWxkcmVuX2QpKSl9LHRoaXMpKSxfLmNoaWxkcmVuPWMsXy5jaGlsZHJlbl9kPWwsbj0wLGE9Xy5wYXJlbnRzLmxlbmd0aDthPm47bisrKWhbXy5wYXJlbnRzW25dXS5jaGlsZHJlbl9kPWhbXy5wYXJlbnRzW25dXS5jaGlsZHJlbl9kLmNvbmNhdChsKTt0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpsLHBhcmVudDpkfSksZCE9PWUuanN0cmVlLnJvb3Q/KHRoaXMuX25vZGVfY2hhbmdlZChkKSx0aGlzLnJlZHJhdygpKToodGhpcy5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oXCIuanN0cmVlLWluaXRpYWwtbm9kZVwiKS5yZW1vdmUoKSx0aGlzLnJlZHJhdyghMCkpLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGghPT11JiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcIm1vZGVsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksci5jYWxsKHRoaXMsITApfSxfYXBwZW5kX2pzb25fZGF0YTpmdW5jdGlvbih0LGkscixzKXtpZihudWxsIT09dGhpcy5lbGVtZW50KXt0PXRoaXMuZ2V0X25vZGUodCksdC5jaGlsZHJlbj1bXSx0LmNoaWxkcmVuX2Q9W10saS5kJiYoaT1pLmQsXCJzdHJpbmdcIj09dHlwZW9mIGkmJihpPUpTT04ucGFyc2UoaSkpKSxlLmlzQXJyYXkoaSl8fChpPVtpXSk7dmFyIG49bnVsbCxhPXtkZjp0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLGRhdDppLHBhcjp0LmlkLG06dGhpcy5fbW9kZWwuZGF0YSx0X2lkOnRoaXMuX2lkLHRfY250OnRoaXMuX2NudCxzZWw6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSxvPWZ1bmN0aW9uKGUsdCl7ZS5kYXRhJiYoZT1lLmRhdGEpO3ZhciBpLHIscyxuLGE9ZS5kYXQsbz1lLnBhcixkPVtdLGM9W10sbD1bXSxoPWUuZGYsXz1lLnRfaWQsdT1lLnRfY250LGc9ZS5tLGY9Z1tvXSxwPWUuc2VsLG09ZnVuY3Rpb24oZSxpLHIpe3I9cj9yLmNvbmNhdCgpOltdLGkmJnIudW5zaGlmdChpKTt2YXIgcyxuLGEsbyxkPWUuaWQudG9TdHJpbmcoKSxjPXtpZDpkLHRleHQ6ZS50ZXh0fHxcIlwiLGljb246ZS5pY29uIT09dD9lLmljb246ITAscGFyZW50OmkscGFyZW50czpyLGNoaWxkcmVuOmUuY2hpbGRyZW58fFtdLGNoaWxkcmVuX2Q6ZS5jaGlsZHJlbl9kfHxbXSxkYXRhOmUuZGF0YSxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKHMgaW4gaCloLmhhc093blByb3BlcnR5KHMpJiYoYy5zdGF0ZVtzXT1oW3NdKTtpZihlJiZlLmRhdGEmJmUuZGF0YS5qc3RyZWUmJmUuZGF0YS5qc3RyZWUuaWNvbiYmKGMuaWNvbj1lLmRhdGEuanN0cmVlLmljb24pLChjLmljb249PT10fHxudWxsPT09Yy5pY29ufHxcIlwiPT09Yy5pY29uKSYmKGMuaWNvbj0hMCksZSYmZS5kYXRhJiYoYy5kYXRhPWUuZGF0YSxlLmRhdGEuanN0cmVlKSlmb3IocyBpbiBlLmRhdGEuanN0cmVlKWUuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkocykmJihjLnN0YXRlW3NdPWUuZGF0YS5qc3RyZWVbc10pO2lmKGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLnN0YXRlKWZvcihzIGluIGUuc3RhdGUpZS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShzKSYmKGMuc3RhdGVbc109ZS5zdGF0ZVtzXSk7aWYoZSYmXCJvYmplY3RcIj09dHlwZW9mIGUubGlfYXR0cilmb3IocyBpbiBlLmxpX2F0dHIpZS5saV9hdHRyLmhhc093blByb3BlcnR5KHMpJiYoYy5saV9hdHRyW3NdPWUubGlfYXR0cltzXSk7aWYoYy5saV9hdHRyLmlkfHwoYy5saV9hdHRyLmlkPWQpLGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmFfYXR0cilmb3IocyBpbiBlLmFfYXR0cillLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGMuYV9hdHRyW3NdPWUuYV9hdHRyW3NdKTtmb3IoZSYmZS5jaGlsZHJlbiYmZS5jaGlsZHJlbj09PSEwJiYoYy5zdGF0ZS5sb2FkZWQ9ITEsYy5jaGlsZHJlbj1bXSxjLmNoaWxkcmVuX2Q9W10pLGdbYy5pZF09YyxzPTAsbj1jLmNoaWxkcmVuLmxlbmd0aDtuPnM7cysrKWE9bShnW2MuY2hpbGRyZW5bc11dLGMuaWQsciksbz1nW2FdLGMuY2hpbGRyZW5fZC5wdXNoKGEpLG8uY2hpbGRyZW5fZC5sZW5ndGgmJihjLmNoaWxkcmVuX2Q9Yy5jaGlsZHJlbl9kLmNvbmNhdChvLmNoaWxkcmVuX2QpKTtyZXR1cm4gZGVsZXRlIGUuZGF0YSxkZWxldGUgZS5jaGlsZHJlbixnW2MuaWRdLm9yaWdpbmFsPWUsYy5zdGF0ZS5zZWxlY3RlZCYmbC5wdXNoKGMuaWQpLGMuaWR9LHY9ZnVuY3Rpb24oZSxpLHIpe3I9cj9yLmNvbmNhdCgpOltdLGkmJnIudW5zaGlmdChpKTt2YXIgcyxuLGEsbyxkLGM9ITE7ZG8gYz1cImpcIitfK1wiX1wiKyArK3U7d2hpbGUoZ1tjXSk7ZD17aWQ6ITEsdGV4dDpcInN0cmluZ1wiPT10eXBlb2YgZT9lOlwiXCIsaWNvbjpcIm9iamVjdFwiPT10eXBlb2YgZSYmZS5pY29uIT09dD9lLmljb246ITAscGFyZW50OmkscGFyZW50czpyLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IocyBpbiBoKWguaGFzT3duUHJvcGVydHkocykmJihkLnN0YXRlW3NdPWhbc10pO2lmKGUmJmUuaWQmJihkLmlkPWUuaWQudG9TdHJpbmcoKSksZSYmZS50ZXh0JiYoZC50ZXh0PWUudGV4dCksZSYmZS5kYXRhJiZlLmRhdGEuanN0cmVlJiZlLmRhdGEuanN0cmVlLmljb24mJihkLmljb249ZS5kYXRhLmpzdHJlZS5pY29uKSwoZC5pY29uPT09dHx8bnVsbD09PWQuaWNvbnx8XCJcIj09PWQuaWNvbikmJihkLmljb249ITApLGUmJmUuZGF0YSYmKGQuZGF0YT1lLmRhdGEsZS5kYXRhLmpzdHJlZSkpZm9yKHMgaW4gZS5kYXRhLmpzdHJlZSllLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KHMpJiYoZC5zdGF0ZVtzXT1lLmRhdGEuanN0cmVlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5zdGF0ZSlmb3IocyBpbiBlLnN0YXRlKWUuc3RhdGUuaGFzT3duUHJvcGVydHkocykmJihkLnN0YXRlW3NdPWUuc3RhdGVbc10pO2lmKGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmxpX2F0dHIpZm9yKHMgaW4gZS5saV9hdHRyKWUubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGQubGlfYXR0cltzXT1lLmxpX2F0dHJbc10pO2lmKGQubGlfYXR0ci5pZCYmIWQuaWQmJihkLmlkPWQubGlfYXR0ci5pZC50b1N0cmluZygpKSxkLmlkfHwoZC5pZD1jKSxkLmxpX2F0dHIuaWR8fChkLmxpX2F0dHIuaWQ9ZC5pZCksZSYmXCJvYmplY3RcIj09dHlwZW9mIGUuYV9hdHRyKWZvcihzIGluIGUuYV9hdHRyKWUuYV9hdHRyLmhhc093blByb3BlcnR5KHMpJiYoZC5hX2F0dHJbc109ZS5hX2F0dHJbc10pO2lmKGUmJmUuY2hpbGRyZW4mJmUuY2hpbGRyZW4ubGVuZ3RoKXtmb3Iocz0wLG49ZS5jaGlsZHJlbi5sZW5ndGg7bj5zO3MrKylhPXYoZS5jaGlsZHJlbltzXSxkLmlkLHIpLG89Z1thXSxkLmNoaWxkcmVuLnB1c2goYSksby5jaGlsZHJlbl9kLmxlbmd0aCYmKGQuY2hpbGRyZW5fZD1kLmNoaWxkcmVuX2QuY29uY2F0KG8uY2hpbGRyZW5fZCkpO2QuY2hpbGRyZW5fZD1kLmNoaWxkcmVuX2QuY29uY2F0KGQuY2hpbGRyZW4pfXJldHVybiBlJiZlLmNoaWxkcmVuJiZlLmNoaWxkcmVuPT09ITAmJihkLnN0YXRlLmxvYWRlZD0hMSxkLmNoaWxkcmVuPVtdLGQuY2hpbGRyZW5fZD1bXSksZGVsZXRlIGUuZGF0YSxkZWxldGUgZS5jaGlsZHJlbixkLm9yaWdpbmFsPWUsZ1tkLmlkXT1kLGQuc3RhdGUuc2VsZWN0ZWQmJmwucHVzaChkLmlkKSxkLmlkfTtpZihhLmxlbmd0aCYmYVswXS5pZCE9PXQmJmFbMF0ucGFyZW50IT09dCl7Zm9yKHI9MCxzPWEubGVuZ3RoO3M+cjtyKyspYVtyXS5jaGlsZHJlbnx8KGFbcl0uY2hpbGRyZW49W10pLGdbYVtyXS5pZC50b1N0cmluZygpXT1hW3JdO2ZvcihyPTAscz1hLmxlbmd0aDtzPnI7cisrKWdbYVtyXS5wYXJlbnQudG9TdHJpbmcoKV0uY2hpbGRyZW4ucHVzaChhW3JdLmlkLnRvU3RyaW5nKCkpLGYuY2hpbGRyZW5fZC5wdXNoKGFbcl0uaWQudG9TdHJpbmcoKSk7Zm9yKHI9MCxzPWYuY2hpbGRyZW4ubGVuZ3RoO3M+cjtyKyspaT1tKGdbZi5jaGlsZHJlbltyXV0sbyxmLnBhcmVudHMuY29uY2F0KCkpLGMucHVzaChpKSxnW2ldLmNoaWxkcmVuX2QubGVuZ3RoJiYoYz1jLmNvbmNhdChnW2ldLmNoaWxkcmVuX2QpKTtmb3Iocj0wLHM9Zi5wYXJlbnRzLmxlbmd0aDtzPnI7cisrKWdbZi5wYXJlbnRzW3JdXS5jaGlsZHJlbl9kPWdbZi5wYXJlbnRzW3JdXS5jaGlsZHJlbl9kLmNvbmNhdChjKTtuPXtjbnQ6dSxtb2Q6ZyxzZWw6cCxwYXI6byxkcGM6YyxhZGQ6bH19ZWxzZXtmb3Iocj0wLHM9YS5sZW5ndGg7cz5yO3IrKylpPXYoYVtyXSxvLGYucGFyZW50cy5jb25jYXQoKSksaSYmKGQucHVzaChpKSxjLnB1c2goaSksZ1tpXS5jaGlsZHJlbl9kLmxlbmd0aCYmKGM9Yy5jb25jYXQoZ1tpXS5jaGlsZHJlbl9kKSkpO2ZvcihmLmNoaWxkcmVuPWQsZi5jaGlsZHJlbl9kPWMscj0wLHM9Zi5wYXJlbnRzLmxlbmd0aDtzPnI7cisrKWdbZi5wYXJlbnRzW3JdXS5jaGlsZHJlbl9kPWdbZi5wYXJlbnRzW3JdXS5jaGlsZHJlbl9kLmNvbmNhdChjKTtuPXtjbnQ6dSxtb2Q6ZyxzZWw6cCxwYXI6byxkcGM6YyxhZGQ6bH19cmV0dXJuXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHdpbmRvdyYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHdpbmRvdy5kb2N1bWVudD9uOnZvaWQgcG9zdE1lc3NhZ2Uobil9LGQ9ZnVuY3Rpb24odCxpKXtpZihudWxsIT09dGhpcy5lbGVtZW50KXtpZih0aGlzLl9jbnQ9dC5jbnQsdGhpcy5fbW9kZWwuZGF0YT10Lm1vZCxpKXt2YXIgcyxuLGE9dC5hZGQsbz10LnNlbCxkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5zbGljZSgpLGM9dGhpcy5fbW9kZWwuZGF0YTtpZihvLmxlbmd0aCE9PWQubGVuZ3RofHxlLnZha2F0YS5hcnJheV91bmlxdWUoby5jb25jYXQoZCkpLmxlbmd0aCE9PW8ubGVuZ3RoKXtmb3Iocz0wLG49by5sZW5ndGg7bj5zO3MrKyktMT09PWUuaW5BcnJheShvW3NdLGEpJiYtMT09PWUuaW5BcnJheShvW3NdLGQpJiYoY1tvW3NdXS5zdGF0ZS5zZWxlY3RlZD0hMSk7Zm9yKHM9MCxuPWQubGVuZ3RoO24+cztzKyspLTE9PT1lLmluQXJyYXkoZFtzXSxvKSYmKGNbZFtzXV0uc3RhdGUuc2VsZWN0ZWQ9ITApfX10LmFkZC5sZW5ndGgmJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdCh0LmFkZCkpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOnQuZHBjLHBhcmVudDp0LnBhcn0pLHQucGFyIT09ZS5qc3RyZWUucm9vdD8odGhpcy5fbm9kZV9jaGFuZ2VkKHQucGFyKSx0aGlzLnJlZHJhdygpKTp0aGlzLnJlZHJhdyghMCksdC5hZGQubGVuZ3RoJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcIm1vZGVsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksci5jYWxsKHRoaXMsITApfX07aWYodGhpcy5zZXR0aW5ncy5jb3JlLndvcmtlciYmd2luZG93LkJsb2ImJndpbmRvdy5VUkwmJndpbmRvdy5Xb3JrZXIpdHJ5e251bGw9PT10aGlzLl93cmsmJih0aGlzLl93cms9d2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IHdpbmRvdy5CbG9iKFtcInNlbGYub25tZXNzYWdlID0gXCIrby50b1N0cmluZygpXSx7dHlwZTpcInRleHQvamF2YXNjcmlwdFwifSkpKSwhdGhpcy5fZGF0YS5jb3JlLndvcmtpbmd8fHM/KHRoaXMuX2RhdGEuY29yZS53b3JraW5nPSEwLG49bmV3IHdpbmRvdy5Xb3JrZXIodGhpcy5fd3JrKSxuLm9ubWVzc2FnZT1lLnByb3h5KGZ1bmN0aW9uKGUpe2QuY2FsbCh0aGlzLGUuZGF0YSwhMCk7dHJ5e24udGVybWluYXRlKCksbj1udWxsfWNhdGNoKHQpe310aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMX0sdGhpcyksYS5wYXI/bi5wb3N0TWVzc2FnZShhKTp0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMSk6dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5wdXNoKFt0LGksciwhMF0pfWNhdGNoKGMpe2QuY2FsbCh0aGlzLG8oYSksITEpLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUubGVuZ3RoP3RoaXMuX2FwcGVuZF9qc29uX2RhdGEuYXBwbHkodGhpcyx0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLnNoaWZ0KCkpOnRoaXMuX2RhdGEuY29yZS53b3JraW5nPSExfWVsc2UgZC5jYWxsKHRoaXMsbyhhKSwhMSl9fSxfcGFyc2VfbW9kZWxfZnJvbV9odG1sOmZ1bmN0aW9uKGkscixzKXtzPXM/W10uY29uY2F0KHMpOltdLHImJnMudW5zaGlmdChyKTt2YXIgbixhLG8sZCxjLGw9dGhpcy5fbW9kZWwuZGF0YSxoPXtpZDohMSx0ZXh0OiExLGljb246ITAscGFyZW50OnIscGFyZW50czpzLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IobyBpbiB0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlKXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUuaGFzT3duUHJvcGVydHkobykmJihoLnN0YXRlW29dPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGVbb10pO2lmKGQ9ZS52YWthdGEuYXR0cmlidXRlcyhpLCEwKSxlLmVhY2goZCxmdW5jdGlvbih0LGkpe3JldHVybiBpPWUudHJpbShpKSxpLmxlbmd0aD8oaC5saV9hdHRyW3RdPWksdm9pZChcImlkXCI9PT10JiYoaC5pZD1pLnRvU3RyaW5nKCkpKSk6ITB9KSxkPWkuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCksZC5sZW5ndGgmJihkPWUudmFrYXRhLmF0dHJpYnV0ZXMoZCwhMCksZS5lYWNoKGQsZnVuY3Rpb24odCxpKXtpPWUudHJpbShpKSxpLmxlbmd0aCYmKGguYV9hdHRyW3RdPWkpfSkpLGQ9aS5jaGlsZHJlbihcImFcIikuZmlyc3QoKS5sZW5ndGg/aS5jaGlsZHJlbihcImFcIikuZmlyc3QoKS5jbG9uZSgpOmkuY2xvbmUoKSxkLmNoaWxkcmVuKFwiaW5zLCBpLCB1bFwiKS5yZW1vdmUoKSxkPWQuaHRtbCgpLGQ9ZShcIjxkaXYgLz5cIikuaHRtbChkKSxoLnRleHQ9dGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQ/ZC50ZXh0KCk6ZC5odG1sKCksZD1pLmRhdGEoKSxoLmRhdGE9ZD9lLmV4dGVuZCghMCx7fSxkKTpudWxsLGguc3RhdGUub3BlbmVkPWkuaGFzQ2xhc3MoXCJqc3RyZWUtb3BlblwiKSxoLnN0YXRlLnNlbGVjdGVkPWkuY2hpbGRyZW4oXCJhXCIpLmhhc0NsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksaC5zdGF0ZS5kaXNhYmxlZD1pLmNoaWxkcmVuKFwiYVwiKS5oYXNDbGFzcyhcImpzdHJlZS1kaXNhYmxlZFwiKSxoLmRhdGEmJmguZGF0YS5qc3RyZWUpZm9yKG8gaW4gaC5kYXRhLmpzdHJlZSloLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KG8pJiYoaC5zdGF0ZVtvXT1oLmRhdGEuanN0cmVlW29dKTtkPWkuY2hpbGRyZW4oXCJhXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIiksZC5sZW5ndGgmJihoLmljb249ZC5oYXNDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpPyExOmQuYXR0cihcInJlbFwiKSksaC5zdGF0ZS5pY29uIT09dCYmKGguaWNvbj1oLnN0YXRlLmljb24pLChoLmljb249PT10fHxudWxsPT09aC5pY29ufHxcIlwiPT09aC5pY29uKSYmKGguaWNvbj0hMCksZD1pLmNoaWxkcmVuKFwidWxcIikuY2hpbGRyZW4oXCJsaVwiKTtkbyBjPVwialwiK3RoaXMuX2lkK1wiX1wiKyArK3RoaXMuX2NudDt3aGlsZShsW2NdKTtyZXR1cm4gaC5pZD1oLmxpX2F0dHIuaWQ/aC5saV9hdHRyLmlkLnRvU3RyaW5nKCk6YyxkLmxlbmd0aD8oZC5lYWNoKGUucHJveHkoZnVuY3Rpb24odCxpKXtuPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21faHRtbChlKGkpLGguaWQscyksYT10aGlzLl9tb2RlbC5kYXRhW25dLGguY2hpbGRyZW4ucHVzaChuKSxhLmNoaWxkcmVuX2QubGVuZ3RoJiYoaC5jaGlsZHJlbl9kPWguY2hpbGRyZW5fZC5jb25jYXQoYS5jaGlsZHJlbl9kKSl9LHRoaXMpKSxoLmNoaWxkcmVuX2Q9aC5jaGlsZHJlbl9kLmNvbmNhdChoLmNoaWxkcmVuKSk6aS5oYXNDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikmJihoLnN0YXRlLmxvYWRlZD0hMSksaC5saV9hdHRyW1wiY2xhc3NcIl0mJihoLmxpX2F0dHJbXCJjbGFzc1wiXT1oLmxpX2F0dHJbXCJjbGFzc1wiXS5yZXBsYWNlKFwianN0cmVlLWNsb3NlZFwiLFwiXCIpLnJlcGxhY2UoXCJqc3RyZWUtb3BlblwiLFwiXCIpKSxoLmFfYXR0cltcImNsYXNzXCJdJiYoaC5hX2F0dHJbXCJjbGFzc1wiXT1oLmFfYXR0cltcImNsYXNzXCJdLnJlcGxhY2UoXCJqc3RyZWUtY2xpY2tlZFwiLFwiXCIpLnJlcGxhY2UoXCJqc3RyZWUtZGlzYWJsZWRcIixcIlwiKSksbFtoLmlkXT1oLGguc3RhdGUuc2VsZWN0ZWQmJnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGguaWQpLGguaWR9LF9wYXJzZV9tb2RlbF9mcm9tX2ZsYXRfanNvbjpmdW5jdGlvbihlLGkscil7cj1yP3IuY29uY2F0KCk6W10saSYmci51bnNoaWZ0KGkpO3ZhciBzLG4sYSxvLGQ9ZS5pZC50b1N0cmluZygpLGM9dGhpcy5fbW9kZWwuZGF0YSxsPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsaD17aWQ6ZCx0ZXh0OmUudGV4dHx8XCJcIixpY29uOmUuaWNvbiE9PXQ/ZS5pY29uOiEwLHBhcmVudDppLHBhcmVudHM6cixjaGlsZHJlbjplLmNoaWxkcmVufHxbXSxjaGlsZHJlbl9kOmUuY2hpbGRyZW5fZHx8W10sZGF0YTplLmRhdGEsc3RhdGU6e30sbGlfYXR0cjp7aWQ6ITF9LGFfYXR0cjp7aHJlZjpcIiNcIn0sb3JpZ2luYWw6ITF9O2ZvcihzIGluIGwpbC5oYXNPd25Qcm9wZXJ0eShzKSYmKGguc3RhdGVbc109bFtzXSk7aWYoZSYmZS5kYXRhJiZlLmRhdGEuanN0cmVlJiZlLmRhdGEuanN0cmVlLmljb24mJihoLmljb249ZS5kYXRhLmpzdHJlZS5pY29uKSwoaC5pY29uPT09dHx8bnVsbD09PWguaWNvbnx8XCJcIj09PWguaWNvbikmJihoLmljb249ITApLGUmJmUuZGF0YSYmKGguZGF0YT1lLmRhdGEsZS5kYXRhLmpzdHJlZSkpZm9yKHMgaW4gZS5kYXRhLmpzdHJlZSllLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KHMpJiYoaC5zdGF0ZVtzXT1lLmRhdGEuanN0cmVlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5zdGF0ZSlmb3IocyBpbiBlLnN0YXRlKWUuc3RhdGUuaGFzT3duUHJvcGVydHkocykmJihoLnN0YXRlW3NdPWUuc3RhdGVbc10pO2lmKGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmxpX2F0dHIpZm9yKHMgaW4gZS5saV9hdHRyKWUubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGgubGlfYXR0cltzXT1lLmxpX2F0dHJbc10pO2lmKGgubGlfYXR0ci5pZHx8KGgubGlfYXR0ci5pZD1kKSxlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5hX2F0dHIpZm9yKHMgaW4gZS5hX2F0dHIpZS5hX2F0dHIuaGFzT3duUHJvcGVydHkocykmJihoLmFfYXR0cltzXT1lLmFfYXR0cltzXSk7Zm9yKGUmJmUuY2hpbGRyZW4mJmUuY2hpbGRyZW49PT0hMCYmKGguc3RhdGUubG9hZGVkPSExLGguY2hpbGRyZW49W10saC5jaGlsZHJlbl9kPVtdKSxjW2guaWRdPWgscz0wLG49aC5jaGlsZHJlbi5sZW5ndGg7bj5zO3MrKylhPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fZmxhdF9qc29uKGNbaC5jaGlsZHJlbltzXV0saC5pZCxyKSxvPWNbYV0saC5jaGlsZHJlbl9kLnB1c2goYSksby5jaGlsZHJlbl9kLmxlbmd0aCYmKGguY2hpbGRyZW5fZD1oLmNoaWxkcmVuX2QuY29uY2F0KG8uY2hpbGRyZW5fZCkpO3JldHVybiBkZWxldGUgZS5kYXRhLGRlbGV0ZSBlLmNoaWxkcmVuLGNbaC5pZF0ub3JpZ2luYWw9ZSxoLnN0YXRlLnNlbGVjdGVkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQucHVzaChoLmlkKSxoLmlkfSxfcGFyc2VfbW9kZWxfZnJvbV9qc29uOmZ1bmN0aW9uKGUsaSxyKXtyPXI/ci5jb25jYXQoKTpbXSxpJiZyLnVuc2hpZnQoaSk7dmFyIHMsbixhLG8sZCxjPSExLGw9dGhpcy5fbW9kZWwuZGF0YSxoPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGU7ZG8gYz1cImpcIit0aGlzLl9pZCtcIl9cIisgKyt0aGlzLl9jbnQ7d2hpbGUobFtjXSk7ZD17aWQ6ITEsdGV4dDpcInN0cmluZ1wiPT10eXBlb2YgZT9lOlwiXCIsaWNvbjpcIm9iamVjdFwiPT10eXBlb2YgZSYmZS5pY29uIT09dD9lLmljb246ITAscGFyZW50OmkscGFyZW50czpyLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IocyBpbiBoKWguaGFzT3duUHJvcGVydHkocykmJihkLnN0YXRlW3NdPWhbc10pO2lmKGUmJmUuaWQmJihkLmlkPWUuaWQudG9TdHJpbmcoKSksZSYmZS50ZXh0JiYoZC50ZXh0PWUudGV4dCksZSYmZS5kYXRhJiZlLmRhdGEuanN0cmVlJiZlLmRhdGEuanN0cmVlLmljb24mJihkLmljb249ZS5kYXRhLmpzdHJlZS5pY29uKSwoZC5pY29uPT09dHx8bnVsbD09PWQuaWNvbnx8XCJcIj09PWQuaWNvbikmJihkLmljb249ITApLGUmJmUuZGF0YSYmKGQuZGF0YT1lLmRhdGEsZS5kYXRhLmpzdHJlZSkpZm9yKHMgaW4gZS5kYXRhLmpzdHJlZSllLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KHMpJiYoZC5zdGF0ZVtzXT1lLmRhdGEuanN0cmVlW3NdKTtpZihlJiZcIm9iamVjdFwiPT10eXBlb2YgZS5zdGF0ZSlmb3IocyBpbiBlLnN0YXRlKWUuc3RhdGUuaGFzT3duUHJvcGVydHkocykmJihkLnN0YXRlW3NdPWUuc3RhdGVbc10pO2lmKGUmJlwib2JqZWN0XCI9PXR5cGVvZiBlLmxpX2F0dHIpZm9yKHMgaW4gZS5saV9hdHRyKWUubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShzKSYmKGQubGlfYXR0cltzXT1lLmxpX2F0dHJbc10pO2lmKGQubGlfYXR0ci5pZCYmIWQuaWQmJihkLmlkPWQubGlfYXR0ci5pZC50b1N0cmluZygpKSxkLmlkfHwoZC5pZD1jKSxkLmxpX2F0dHIuaWR8fChkLmxpX2F0dHIuaWQ9ZC5pZCksZSYmXCJvYmplY3RcIj09dHlwZW9mIGUuYV9hdHRyKWZvcihzIGluIGUuYV9hdHRyKWUuYV9hdHRyLmhhc093blByb3BlcnR5KHMpJiYoZC5hX2F0dHJbc109ZS5hX2F0dHJbc10pO2lmKGUmJmUuY2hpbGRyZW4mJmUuY2hpbGRyZW4ubGVuZ3RoKXtmb3Iocz0wLG49ZS5jaGlsZHJlbi5sZW5ndGg7bj5zO3MrKylhPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihlLmNoaWxkcmVuW3NdLGQuaWQsciksbz1sW2FdLGQuY2hpbGRyZW4ucHVzaChhKSxvLmNoaWxkcmVuX2QubGVuZ3RoJiYoZC5jaGlsZHJlbl9kPWQuY2hpbGRyZW5fZC5jb25jYXQoby5jaGlsZHJlbl9kKSk7ZC5jaGlsZHJlbl9kPWQuY2hpbGRyZW5fZC5jb25jYXQoZC5jaGlsZHJlbil9cmV0dXJuIGUmJmUuY2hpbGRyZW4mJmUuY2hpbGRyZW49PT0hMCYmKGQuc3RhdGUubG9hZGVkPSExLGQuY2hpbGRyZW49W10sZC5jaGlsZHJlbl9kPVtdKSxkZWxldGUgZS5kYXRhLGRlbGV0ZSBlLmNoaWxkcmVuLGQub3JpZ2luYWw9ZSxsW2QuaWRdPWQsZC5zdGF0ZS5zZWxlY3RlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2goZC5pZCksZC5pZH0sX3JlZHJhdzpmdW5jdGlvbigpe3ZhciB0LGkscixzPXRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3P3RoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF0uY2hpbGRyZW4uY29uY2F0KFtdKTp0aGlzLl9tb2RlbC5jaGFuZ2VkLmNvbmNhdChbXSksbj1sLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSxhPXRoaXMuX2RhdGEuY29yZS5mb2N1c2VkO2ZvcihpPTAscj1zLmxlbmd0aDtyPmk7aSsrKXQ9dGhpcy5yZWRyYXdfbm9kZShzW2ldLCEwLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3KSx0JiZ0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyYmbi5hcHBlbmRDaGlsZCh0KTt0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyYmKG4uY2xhc3NOYW1lPXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdLmNsYXNzTmFtZSxuLnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLHRoaXMuZWxlbWVudC5lbXB0eSgpLmFwcGVuZChuKSksbnVsbCE9PWEmJih0PXRoaXMuZ2V0X25vZGUoYSwhMCksdCYmdC5sZW5ndGgmJnQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKVswXSE9PWwuYWN0aXZlRWxlbWVudD90LmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTp0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsKSx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMSx0aGlzLl9tb2RlbC5jaGFuZ2VkPVtdLHRoaXMudHJpZ2dlcihcInJlZHJhd1wiLHtub2RlczpzfSl9LHJlZHJhdzpmdW5jdGlvbihlKXtlJiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX3JlZHJhdygpfSxkcmF3X2NoaWxkcmVuOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuZ2V0X25vZGUodCkscj0hMSxzPSExLG49ITEsYT1sO2lmKCFpKXJldHVybiExO2lmKGkuaWQ9PT1lLmpzdHJlZS5yb290KXJldHVybiB0aGlzLnJlZHJhdyghMCk7aWYodD10aGlzLmdldF9ub2RlKHQsITApLCF0fHwhdC5sZW5ndGgpcmV0dXJuITE7aWYodC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikucmVtb3ZlKCksdD10WzBdLGkuY2hpbGRyZW4ubGVuZ3RoJiZpLnN0YXRlLmxvYWRlZCl7Zm9yKG49YS5jcmVhdGVFbGVtZW50KFwiVUxcIiksbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSxuLmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLHI9MCxzPWkuY2hpbGRyZW4ubGVuZ3RoO3M+cjtyKyspbi5hcHBlbmRDaGlsZCh0aGlzLnJlZHJhd19ub2RlKGkuY2hpbGRyZW5bcl0sITAsITApKTt0LmFwcGVuZENoaWxkKG4pfX0scmVkcmF3X25vZGU6ZnVuY3Rpb24odCxpLHIscyl7dmFyIG49dGhpcy5nZXRfbm9kZSh0KSxhPSExLG89ITEsZD0hMSxjPSExLF89ITEsdT0hMSxnPVwiXCIsZj1sLHA9dGhpcy5fbW9kZWwuZGF0YSxtPSExLHY9bnVsbCxqPTAseT0wLGs9ITEseD0hMTtpZighbilyZXR1cm4hMTtpZihuLmlkPT09ZS5qc3RyZWUucm9vdClyZXR1cm4gdGhpcy5yZWRyYXcoITApO2lmKGk9aXx8MD09PW4uY2hpbGRyZW4ubGVuZ3RoLHQ9bC5xdWVyeVNlbGVjdG9yP3RoaXMuZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yKFwiI1wiKygtMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2Yobi5pZFswXSk/XCJcXFxcM1wiK24uaWRbMF0rXCIgXCIrbi5pZC5zdWJzdHIoMSkucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOm4uaWQucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpKSk6bC5nZXRFbGVtZW50QnlJZChuLmlkKSl0PWUodCkscnx8KGE9dC5wYXJlbnQoKS5wYXJlbnQoKVswXSxhPT09dGhpcy5lbGVtZW50WzBdJiYoYT1udWxsKSxvPXQuaW5kZXgoKSksaXx8IW4uY2hpbGRyZW4ubGVuZ3RofHx0LmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5sZW5ndGh8fChpPSEwKSxcbml8fChkPXQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKSxtPXQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKVswXT09PWwuYWN0aXZlRWxlbWVudCx0LnJlbW92ZSgpO2Vsc2UgaWYoaT0hMCwhcil7aWYoYT1uLnBhcmVudCE9PWUuanN0cmVlLnJvb3Q/ZShcIiNcIituLnBhcmVudC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KVswXTpudWxsLCEobnVsbD09PWF8fGEmJnBbbi5wYXJlbnRdLnN0YXRlLm9wZW5lZCkpcmV0dXJuITE7bz1lLmluQXJyYXkobi5pZCxudWxsPT09YT9wW2UuanN0cmVlLnJvb3RdLmNoaWxkcmVuOnBbbi5wYXJlbnRdLmNoaWxkcmVuKX10PWguY2xvbmVOb2RlKCEwKSxnPVwianN0cmVlLW5vZGUgXCI7Zm9yKGMgaW4gbi5saV9hdHRyKWlmKG4ubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShjKSl7aWYoXCJpZFwiPT09Yyljb250aW51ZTtcImNsYXNzXCIhPT1jP3Quc2V0QXR0cmlidXRlKGMsbi5saV9hdHRyW2NdKTpnKz1uLmxpX2F0dHJbY119Zm9yKG4uYV9hdHRyLmlkfHwobi5hX2F0dHIuaWQ9bi5pZCtcIl9hbmNob3JcIiksdC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNlbGVjdGVkXCIsISFuLnN0YXRlLnNlbGVjdGVkKSx0LnNldEF0dHJpYnV0ZShcImFyaWEtbGV2ZWxcIixuLnBhcmVudHMubGVuZ3RoKSx0LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxsZWRieVwiLG4uYV9hdHRyLmlkKSxuLnN0YXRlLmRpc2FibGVkJiZ0LnNldEF0dHJpYnV0ZShcImFyaWEtZGlzYWJsZWRcIiwhMCksYz0wLF89bi5jaGlsZHJlbi5sZW5ndGg7Xz5jO2MrKylpZighcFtuLmNoaWxkcmVuW2NdXS5zdGF0ZS5oaWRkZW4pe2s9ITA7YnJlYWt9aWYobnVsbCE9PW4ucGFyZW50JiZwW24ucGFyZW50XSYmIW4uc3RhdGUuaGlkZGVuJiYoYz1lLmluQXJyYXkobi5pZCxwW24ucGFyZW50XS5jaGlsZHJlbikseD1uLmlkLC0xIT09YykpZm9yKGMrKyxfPXBbbi5wYXJlbnRdLmNoaWxkcmVuLmxlbmd0aDtfPmMmJihwW3Bbbi5wYXJlbnRdLmNoaWxkcmVuW2NdXS5zdGF0ZS5oaWRkZW58fCh4PXBbbi5wYXJlbnRdLmNoaWxkcmVuW2NdKSx4PT09bi5pZCk7YysrKTtuLnN0YXRlLmhpZGRlbiYmKGcrPVwiIGpzdHJlZS1oaWRkZW5cIiksbi5zdGF0ZS5sb2FkZWQmJiFrP2crPVwiIGpzdHJlZS1sZWFmXCI6KGcrPW4uc3RhdGUub3BlbmVkJiZuLnN0YXRlLmxvYWRlZD9cIiBqc3RyZWUtb3BlblwiOlwiIGpzdHJlZS1jbG9zZWRcIix0LnNldEF0dHJpYnV0ZShcImFyaWEtZXhwYW5kZWRcIixuLnN0YXRlLm9wZW5lZCYmbi5zdGF0ZS5sb2FkZWQpKSx4PT09bi5pZCYmKGcrPVwiIGpzdHJlZS1sYXN0XCIpLHQuaWQ9bi5pZCx0LmNsYXNzTmFtZT1nLGc9KG4uc3RhdGUuc2VsZWN0ZWQ/XCIganN0cmVlLWNsaWNrZWRcIjpcIlwiKSsobi5zdGF0ZS5kaXNhYmxlZD9cIiBqc3RyZWUtZGlzYWJsZWRcIjpcIlwiKTtmb3IoXyBpbiBuLmFfYXR0cilpZihuLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShfKSl7aWYoXCJocmVmXCI9PT1fJiZcIiNcIj09PW4uYV9hdHRyW19dKWNvbnRpbnVlO1wiY2xhc3NcIiE9PV8/dC5jaGlsZE5vZGVzWzFdLnNldEF0dHJpYnV0ZShfLG4uYV9hdHRyW19dKTpnKz1cIiBcIituLmFfYXR0cltfXX1pZihnLmxlbmd0aCYmKHQuY2hpbGROb2Rlc1sxXS5jbGFzc05hbWU9XCJqc3RyZWUtYW5jaG9yIFwiK2cpLChuLmljb24mJm4uaWNvbiE9PSEwfHxuLmljb249PT0hMSkmJihuLmljb249PT0hMT90LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIGpzdHJlZS10aGVtZWljb24taGlkZGVuXCI6LTE9PT1uLmljb24uaW5kZXhPZihcIi9cIikmJi0xPT09bi5pY29uLmluZGV4T2YoXCIuXCIpP3QuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLmNsYXNzTmFtZSs9XCIgXCIrbi5pY29uK1wiIGpzdHJlZS10aGVtZWljb24tY3VzdG9tXCI6KHQuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRJbWFnZT1cInVybChcIituLmljb24rXCIpXCIsdC5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uPVwiY2VudGVyIGNlbnRlclwiLHQuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRTaXplPVwiYXV0b1wiLHQuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLmNsYXNzTmFtZSs9XCIganN0cmVlLXRoZW1laWNvbi1jdXN0b21cIikpLHRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0P3QuY2hpbGROb2Rlc1sxXS5hcHBlbmRDaGlsZChmLmNyZWF0ZVRleHROb2RlKG4udGV4dCkpOnQuY2hpbGROb2Rlc1sxXS5pbm5lckhUTUwrPW4udGV4dCxpJiZuLmNoaWxkcmVuLmxlbmd0aCYmKG4uc3RhdGUub3BlbmVkfHxzKSYmbi5zdGF0ZS5sb2FkZWQpe2Zvcih1PWYuY3JlYXRlRWxlbWVudChcIlVMXCIpLHUuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiZ3JvdXBcIiksdS5jbGFzc05hbWU9XCJqc3RyZWUtY2hpbGRyZW5cIixjPTAsXz1uLmNoaWxkcmVuLmxlbmd0aDtfPmM7YysrKXUuYXBwZW5kQ2hpbGQodGhpcy5yZWRyYXdfbm9kZShuLmNoaWxkcmVuW2NdLGksITApKTt0LmFwcGVuZENoaWxkKHUpfWlmKGQmJnQuYXBwZW5kQ2hpbGQoZCksIXIpe2ZvcihhfHwoYT10aGlzLmVsZW1lbnRbMF0pLGM9MCxfPWEuY2hpbGROb2Rlcy5sZW5ndGg7Xz5jO2MrKylpZihhLmNoaWxkTm9kZXNbY10mJmEuY2hpbGROb2Rlc1tjXS5jbGFzc05hbWUmJi0xIT09YS5jaGlsZE5vZGVzW2NdLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWNoaWxkcmVuXCIpKXt2PWEuY2hpbGROb2Rlc1tjXTticmVha312fHwodj1mLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSx2LnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLHYuY2xhc3NOYW1lPVwianN0cmVlLWNoaWxkcmVuXCIsYS5hcHBlbmRDaGlsZCh2KSksYT12LG88YS5jaGlsZE5vZGVzLmxlbmd0aD9hLmluc2VydEJlZm9yZSh0LGEuY2hpbGROb2Rlc1tvXSk6YS5hcHBlbmRDaGlsZCh0KSxtJiYoaj10aGlzLmVsZW1lbnRbMF0uc2Nyb2xsVG9wLHk9dGhpcy5lbGVtZW50WzBdLnNjcm9sbExlZnQsdC5jaGlsZE5vZGVzWzFdLmZvY3VzKCksdGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcD1qLHRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0PXkpfXJldHVybiBuLnN0YXRlLm9wZW5lZCYmIW4uc3RhdGUubG9hZGVkJiYobi5zdGF0ZS5vcGVuZWQ9ITEsc2V0VGltZW91dChlLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5vcGVuX25vZGUobi5pZCwhMSwwKX0sdGhpcyksMCkpLHR9LG9wZW5fbm9kZTpmdW5jdGlvbihpLHIscyl7dmFyIG4sYSxvLGQ7aWYoZS5pc0FycmF5KGkpKXtmb3IoaT1pLnNsaWNlKCksbj0wLGE9aS5sZW5ndGg7YT5uO24rKyl0aGlzLm9wZW5fbm9kZShpW25dLHIscyk7cmV0dXJuITB9cmV0dXJuIGk9dGhpcy5nZXRfbm9kZShpKSxpJiZpLmlkIT09ZS5qc3RyZWUucm9vdD8ocz1zPT09dD90aGlzLnNldHRpbmdzLmNvcmUuYW5pbWF0aW9uOnMsdGhpcy5pc19jbG9zZWQoaSk/dGhpcy5pc19sb2FkZWQoaSk/KG89dGhpcy5nZXRfbm9kZShpLCEwKSxkPXRoaXMsby5sZW5ndGgmJihzJiZvLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5sZW5ndGgmJm8uY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnN0b3AoITAsITApLGkuY2hpbGRyZW4ubGVuZ3RoJiYhdGhpcy5fZmlyc3RDaGlsZChvLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKVswXSkmJnRoaXMuZHJhd19jaGlsZHJlbihpKSxzPyh0aGlzLnRyaWdnZXIoXCJiZWZvcmVfb3BlblwiLHtub2RlOml9KSxvLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5jc3MoXCJkaXNwbGF5XCIsXCJub25lXCIpLmVuZCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsb3NlZFwiKS5hZGRDbGFzcyhcImpzdHJlZS1vcGVuXCIpLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKS5zbGlkZURvd24ocyxmdW5jdGlvbigpe3RoaXMuc3R5bGUuZGlzcGxheT1cIlwiLGQudHJpZ2dlcihcImFmdGVyX29wZW5cIix7bm9kZTppfSl9KSk6KHRoaXMudHJpZ2dlcihcImJlZm9yZV9vcGVuXCIse25vZGU6aX0pLG9bMF0uY2xhc3NOYW1lPW9bMF0uY2xhc3NOYW1lLnJlcGxhY2UoXCJqc3RyZWUtY2xvc2VkXCIsXCJqc3RyZWUtb3BlblwiKSxvWzBdLnNldEF0dHJpYnV0ZShcImFyaWEtZXhwYW5kZWRcIiwhMCkpKSxpLnN0YXRlLm9wZW5lZD0hMCxyJiZyLmNhbGwodGhpcyxpLCEwKSxvLmxlbmd0aHx8dGhpcy50cmlnZ2VyKFwiYmVmb3JlX29wZW5cIix7bm9kZTppfSksdGhpcy50cmlnZ2VyKFwib3Blbl9ub2RlXCIse25vZGU6aX0pLHMmJm8ubGVuZ3RofHx0aGlzLnRyaWdnZXIoXCJhZnRlcl9vcGVuXCIse25vZGU6aX0pLCEwKTp0aGlzLmlzX2xvYWRpbmcoaSk/c2V0VGltZW91dChlLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5vcGVuX25vZGUoaSxyLHMpfSx0aGlzKSw1MDApOnZvaWQgdGhpcy5sb2FkX25vZGUoaSxmdW5jdGlvbihlLHQpe3JldHVybiB0P3RoaXMub3Blbl9ub2RlKGUscixzKTpyP3IuY2FsbCh0aGlzLGUsITEpOiExfSk6KHImJnIuY2FsbCh0aGlzLGksITEpLCExKSk6ITF9LF9vcGVuX3RvOmZ1bmN0aW9uKHQpe2lmKHQ9dGhpcy5nZXRfbm9kZSh0KSwhdHx8dC5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGkscixzPXQucGFyZW50cztmb3IoaT0wLHI9cy5sZW5ndGg7cj5pO2krPTEpaSE9PWUuanN0cmVlLnJvb3QmJnRoaXMub3Blbl9ub2RlKHNbaV0sITEsMCk7cmV0dXJuIGUoXCIjXCIrdC5pZC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KX0sY2xvc2Vfbm9kZTpmdW5jdGlvbihpLHIpe3ZhciBzLG4sYSxvO2lmKGUuaXNBcnJheShpKSl7Zm9yKGk9aS5zbGljZSgpLHM9MCxuPWkubGVuZ3RoO24+cztzKyspdGhpcy5jbG9zZV9ub2RlKGlbc10scik7cmV0dXJuITB9cmV0dXJuIGk9dGhpcy5nZXRfbm9kZShpKSxpJiZpLmlkIT09ZS5qc3RyZWUucm9vdD90aGlzLmlzX2Nsb3NlZChpKT8hMToocj1yPT09dD90aGlzLnNldHRpbmdzLmNvcmUuYW5pbWF0aW9uOnIsYT10aGlzLG89dGhpcy5nZXRfbm9kZShpLCEwKSxvLmxlbmd0aCYmKHI/by5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuYXR0cihcInN0eWxlXCIsXCJkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnRcIikuZW5kKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb3BlblwiKS5hZGRDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikuYXR0cihcImFyaWEtZXhwYW5kZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnN0b3AoITAsITApLnNsaWRlVXAocixmdW5jdGlvbigpe3RoaXMuc3R5bGUuZGlzcGxheT1cIlwiLG8uY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnJlbW92ZSgpLGEudHJpZ2dlcihcImFmdGVyX2Nsb3NlXCIse25vZGU6aX0pfSk6KG9bMF0uY2xhc3NOYW1lPW9bMF0uY2xhc3NOYW1lLnJlcGxhY2UoXCJqc3RyZWUtb3BlblwiLFwianN0cmVlLWNsb3NlZFwiKSxvLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5yZW1vdmUoKSkpLGkuc3RhdGUub3BlbmVkPSExLHRoaXMudHJpZ2dlcihcImNsb3NlX25vZGVcIix7bm9kZTppfSksdm9pZChyJiZvLmxlbmd0aHx8dGhpcy50cmlnZ2VyKFwiYWZ0ZXJfY2xvc2VcIix7bm9kZTppfSkpKTohMX0sdG9nZ2xlX25vZGU6ZnVuY3Rpb24odCl7dmFyIGkscjtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxpPTAscj10Lmxlbmd0aDtyPmk7aSsrKXRoaXMudG9nZ2xlX25vZGUodFtpXSk7cmV0dXJuITB9cmV0dXJuIHRoaXMuaXNfY2xvc2VkKHQpP3RoaXMub3Blbl9ub2RlKHQpOnRoaXMuaXNfb3Blbih0KT90aGlzLmNsb3NlX25vZGUodCk6dm9pZCAwfSxvcGVuX2FsbDpmdW5jdGlvbih0LGkscil7aWYodHx8KHQ9ZS5qc3RyZWUucm9vdCksdD10aGlzLmdldF9ub2RlKHQpLCF0KXJldHVybiExO3ZhciBzLG4sYSxvPXQuaWQ9PT1lLmpzdHJlZS5yb290P3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpOnRoaXMuZ2V0X25vZGUodCwhMCk7aWYoIW8ubGVuZ3RoKXtmb3Iocz0wLG49dC5jaGlsZHJlbl9kLmxlbmd0aDtuPnM7cysrKXRoaXMuaXNfY2xvc2VkKHRoaXMuX21vZGVsLmRhdGFbdC5jaGlsZHJlbl9kW3NdXSkmJih0aGlzLl9tb2RlbC5kYXRhW3QuY2hpbGRyZW5fZFtzXV0uc3RhdGUub3BlbmVkPSEwKTtyZXR1cm4gdGhpcy50cmlnZ2VyKFwib3Blbl9hbGxcIix7bm9kZTp0fSl9cj1yfHxvLGE9dGhpcyxvPXRoaXMuaXNfY2xvc2VkKHQpP28uZmluZChcIi5qc3RyZWUtY2xvc2VkXCIpLmFkZEJhY2soKTpvLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKSxvLmVhY2goZnVuY3Rpb24oKXthLm9wZW5fbm9kZSh0aGlzLGZ1bmN0aW9uKGUsdCl7dCYmdGhpcy5pc19wYXJlbnQoZSkmJnRoaXMub3Blbl9hbGwoZSxpLHIpfSxpfHwwKX0pLDA9PT1yLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5sZW5ndGgmJnRoaXMudHJpZ2dlcihcIm9wZW5fYWxsXCIse25vZGU6dGhpcy5nZXRfbm9kZShyKX0pfSxjbG9zZV9hbGw6ZnVuY3Rpb24odCxpKXtpZih0fHwodD1lLmpzdHJlZS5yb290KSx0PXRoaXMuZ2V0X25vZGUodCksIXQpcmV0dXJuITE7dmFyIHIscyxuPXQuaWQ9PT1lLmpzdHJlZS5yb290P3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpOnRoaXMuZ2V0X25vZGUodCwhMCksYT10aGlzO2ZvcihuLmxlbmd0aCYmKG49dGhpcy5pc19vcGVuKHQpP24uZmluZChcIi5qc3RyZWUtb3BlblwiKS5hZGRCYWNrKCk6bi5maW5kKFwiLmpzdHJlZS1vcGVuXCIpLGUobi5nZXQoKS5yZXZlcnNlKCkpLmVhY2goZnVuY3Rpb24oKXthLmNsb3NlX25vZGUodGhpcyxpfHwwKX0pKSxyPTAscz10LmNoaWxkcmVuX2QubGVuZ3RoO3M+cjtyKyspdGhpcy5fbW9kZWwuZGF0YVt0LmNoaWxkcmVuX2Rbcl1dLnN0YXRlLm9wZW5lZD0hMTt0aGlzLnRyaWdnZXIoXCJjbG9zZV9hbGxcIix7bm9kZTp0fSl9LGlzX2Rpc2FibGVkOmZ1bmN0aW9uKGUpe3JldHVybiBlPXRoaXMuZ2V0X25vZGUoZSksZSYmZS5zdGF0ZSYmZS5zdGF0ZS5kaXNhYmxlZH0sZW5hYmxlX25vZGU6ZnVuY3Rpb24odCl7dmFyIGkscjtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxpPTAscj10Lmxlbmd0aDtyPmk7aSsrKXRoaXMuZW5hYmxlX25vZGUodFtpXSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8odC5zdGF0ZS5kaXNhYmxlZD0hMSx0aGlzLmdldF9ub2RlKHQsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIiwhMSksdm9pZCB0aGlzLnRyaWdnZXIoXCJlbmFibGVfbm9kZVwiLHtub2RlOnR9KSk6ITF9LGRpc2FibGVfbm9kZTpmdW5jdGlvbih0KXt2YXIgaSxyO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLGk9MCxyPXQubGVuZ3RoO3I+aTtpKyspdGhpcy5kaXNhYmxlX25vZGUodFtpXSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8odC5zdGF0ZS5kaXNhYmxlZD0hMCx0aGlzLmdldF9ub2RlKHQsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIiwhMCksdm9pZCB0aGlzLnRyaWdnZXIoXCJkaXNhYmxlX25vZGVcIix7bm9kZTp0fSkpOiExfSxoaWRlX25vZGU6ZnVuY3Rpb24odCxpKXt2YXIgcixzO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLHI9MCxzPXQubGVuZ3RoO3M+cjtyKyspdGhpcy5oaWRlX25vZGUodFtyXSwhMCk7cmV0dXJuIHRoaXMucmVkcmF3KCksITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD92b2lkKHQuc3RhdGUuaGlkZGVufHwodC5zdGF0ZS5oaWRkZW49ITAsdGhpcy5fbm9kZV9jaGFuZ2VkKHQucGFyZW50KSxpfHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcImhpZGVfbm9kZVwiLHtub2RlOnR9KSkpOiExfSxzaG93X25vZGU6ZnVuY3Rpb24odCxpKXt2YXIgcixzO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLHI9MCxzPXQubGVuZ3RoO3M+cjtyKyspdGhpcy5zaG93X25vZGUodFtyXSwhMCk7cmV0dXJuIHRoaXMucmVkcmF3KCksITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD92b2lkKHQuc3RhdGUuaGlkZGVuJiYodC5zdGF0ZS5oaWRkZW49ITEsdGhpcy5fbm9kZV9jaGFuZ2VkKHQucGFyZW50KSxpfHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcInNob3dfbm9kZVwiLHtub2RlOnR9KSkpOiExfSxoaWRlX2FsbDpmdW5jdGlvbih0KXt2YXIgaSxyPXRoaXMuX21vZGVsLmRhdGEscz1bXTtmb3IoaSBpbiByKXIuaGFzT3duUHJvcGVydHkoaSkmJmkhPT1lLmpzdHJlZS5yb290JiYhcltpXS5zdGF0ZS5oaWRkZW4mJihyW2ldLnN0YXRlLmhpZGRlbj0hMCxzLnB1c2goaSkpO3JldHVybiB0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCx0fHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcImhpZGVfYWxsXCIse25vZGVzOnN9KSxzfSxzaG93X2FsbDpmdW5jdGlvbih0KXt2YXIgaSxyPXRoaXMuX21vZGVsLmRhdGEscz1bXTtmb3IoaSBpbiByKXIuaGFzT3duUHJvcGVydHkoaSkmJmkhPT1lLmpzdHJlZS5yb290JiZyW2ldLnN0YXRlLmhpZGRlbiYmKHJbaV0uc3RhdGUuaGlkZGVuPSExLHMucHVzaChpKSk7cmV0dXJuIHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwLHR8fHRoaXMucmVkcmF3KCksdGhpcy50cmlnZ2VyKFwic2hvd19hbGxcIix7bm9kZXM6c30pLHN9LGFjdGl2YXRlX25vZGU6ZnVuY3Rpb24oZSxpKXtpZih0aGlzLmlzX2Rpc2FibGVkKGUpKXJldHVybiExO2lmKGkmJlwib2JqZWN0XCI9PXR5cGVvZiBpfHwoaT17fSksdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkIT09dD90aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuaWQpOm51bGwsdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmIXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuc3RhdGUuc2VsZWN0ZWQmJih0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPW51bGwpLCF0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoLTFdKSksdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiYoaS5tZXRhS2V5fHxpLmN0cmxLZXl8fGkuc2hpZnRLZXkpJiYoIWkuc2hpZnRLZXl8fHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQmJnRoaXMuZ2V0X3BhcmVudChlKSYmdGhpcy5nZXRfcGFyZW50KGUpPT09dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5wYXJlbnQpKWlmKGkuc2hpZnRLZXkpe3ZhciByLHMsbj10aGlzLmdldF9ub2RlKGUpLmlkLGE9dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5pZCxvPXRoaXMuZ2V0X25vZGUodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5wYXJlbnQpLmNoaWxkcmVuLGQ9ITE7Zm9yKHI9MCxzPW8ubGVuZ3RoO3M+cjtyKz0xKW9bcl09PT1uJiYoZD0hZCksb1tyXT09PWEmJihkPSFkKSx0aGlzLmlzX2Rpc2FibGVkKG9bcl0pfHwhZCYmb1tyXSE9PW4mJm9bcl0hPT1hP3RoaXMuZGVzZWxlY3Rfbm9kZShvW3JdLCEwLGkpOnRoaXMuc2VsZWN0X25vZGUob1tyXSwhMCwhMSxpKTt0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9ub2RlXCIsbm9kZTp0aGlzLmdldF9ub2RlKGUpLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxldmVudDppfSl9ZWxzZSB0aGlzLmlzX3NlbGVjdGVkKGUpP3RoaXMuZGVzZWxlY3Rfbm9kZShlLCExLGkpOnRoaXMuc2VsZWN0X25vZGUoZSwhMSwhMSxpKTtlbHNlIXRoaXMuc2V0dGluZ3MuY29yZS5tdWx0aXBsZSYmKGkubWV0YUtleXx8aS5jdHJsS2V5fHxpLnNoaWZ0S2V5KSYmdGhpcy5pc19zZWxlY3RlZChlKT90aGlzLmRlc2VsZWN0X25vZGUoZSwhMSxpKToodGhpcy5kZXNlbGVjdF9hbGwoITApLHRoaXMuc2VsZWN0X25vZGUoZSwhMSwhMSxpKSx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPXRoaXMuZ2V0X25vZGUoZSkpO3RoaXMudHJpZ2dlcihcImFjdGl2YXRlX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGUpLGV2ZW50Oml9KX0saG92ZXJfbm9kZTpmdW5jdGlvbihlKXtpZihlPXRoaXMuZ2V0X25vZGUoZSwhMCksIWV8fCFlLmxlbmd0aHx8ZS5jaGlsZHJlbihcIi5qc3RyZWUtaG92ZXJlZFwiKS5sZW5ndGgpcmV0dXJuITE7dmFyIHQ9dGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWhvdmVyZWRcIiksaT10aGlzLmVsZW1lbnQ7dCYmdC5sZW5ndGgmJnRoaXMuZGVob3Zlcl9ub2RlKHQpLGUuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpLHRoaXMudHJpZ2dlcihcImhvdmVyX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGUpfSksc2V0VGltZW91dChmdW5jdGlvbigpe2kuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLGVbMF0uaWQpfSwwKX0sZGVob3Zlcl9ub2RlOmZ1bmN0aW9uKGUpe3JldHVybiBlPXRoaXMuZ2V0X25vZGUoZSwhMCksZSYmZS5sZW5ndGgmJmUuY2hpbGRyZW4oXCIuanN0cmVlLWhvdmVyZWRcIikubGVuZ3RoPyhlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKSx2b2lkIHRoaXMudHJpZ2dlcihcImRlaG92ZXJfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoZSl9KSk6ITF9LHNlbGVjdF9ub2RlOmZ1bmN0aW9uKHQsaSxyLHMpe3ZhciBuLGEsbztpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxhPTAsbz10Lmxlbmd0aDtvPmE7YSsrKXRoaXMuc2VsZWN0X25vZGUodFthXSxpLHIscyk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8obj10aGlzLmdldF9ub2RlKHQsITApLHZvaWQodC5zdGF0ZS5zZWxlY3RlZHx8KHQuc3RhdGUuc2VsZWN0ZWQ9ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2godC5pZCkscnx8KG49dGhpcy5fb3Blbl90byh0KSksbiYmbi5sZW5ndGgmJm4uYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLHRoaXMudHJpZ2dlcihcInNlbGVjdF9ub2RlXCIse25vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6c30pLGl8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwic2VsZWN0X25vZGVcIixub2RlOnQsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OnN9KSkpKTohMX0sZGVzZWxlY3Rfbm9kZTpmdW5jdGlvbih0LGkscil7dmFyIHMsbixhO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLHM9MCxuPXQubGVuZ3RoO24+cztzKyspdGhpcy5kZXNlbGVjdF9ub2RlKHRbc10saSxyKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290PyhhPXRoaXMuZ2V0X25vZGUodCwhMCksdm9pZCh0LnN0YXRlLnNlbGVjdGVkJiYodC5zdGF0ZS5zZWxlY3RlZD0hMSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9ZS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLHQuaWQpLGEubGVuZ3RoJiZhLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJkZXNlbGVjdF9ub2RlXCIse25vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6cn0pLGl8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVzZWxlY3Rfbm9kZVwiLG5vZGU6dCxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6cn0pKSkpOiExfSxzZWxlY3RfYWxsOmZ1bmN0aW9uKHQpe3ZhciBpLHIscz10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKTtmb3IodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPXRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF0uY2hpbGRyZW5fZC5jb25jYXQoKSxpPTAscj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoO3I+aTtpKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbaV1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbaV1dLnN0YXRlLnNlbGVjdGVkPSEwKTt0aGlzLnJlZHJhdyghMCksdGhpcy50cmlnZ2VyKFwic2VsZWN0X2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KSx0fHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9hbGxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsb2xkX3NlbGVjdGlvbjpzfSl9LGRlc2VsZWN0X2FsbDpmdW5jdGlvbihlKXt2YXIgdCxpLHI9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChbXSk7Zm9yKHQ9MCxpPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7aT50O3QrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFt0XV0mJih0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFt0XV0uc3RhdGUuc2VsZWN0ZWQ9ITEpO3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1bXSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLHRoaXMudHJpZ2dlcihcImRlc2VsZWN0X2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsbm9kZTpyfSksZXx8dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJkZXNlbGVjdF9hbGxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsb2xkX3NlbGVjdGlvbjpyfSl9LGlzX3NlbGVjdGVkOmZ1bmN0aW9uKHQpe3JldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/dC5zdGF0ZS5zZWxlY3RlZDohMX0sZ2V0X3NlbGVjdGVkOmZ1bmN0aW9uKHQpe3JldHVybiB0P2UubWFwKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxlLnByb3h5KGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmdldF9ub2RlKGUpfSx0aGlzKSk6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnNsaWNlKCl9LGdldF90b3Bfc2VsZWN0ZWQ6ZnVuY3Rpb24odCl7dmFyIGkscixzLG4sYT10aGlzLmdldF9zZWxlY3RlZCghMCksbz17fTtmb3IoaT0wLHI9YS5sZW5ndGg7cj5pO2krKylvW2FbaV0uaWRdPWFbaV07Zm9yKGk9MCxyPWEubGVuZ3RoO3I+aTtpKyspZm9yKHM9MCxuPWFbaV0uY2hpbGRyZW5fZC5sZW5ndGg7bj5zO3MrKylvW2FbaV0uY2hpbGRyZW5fZFtzXV0mJmRlbGV0ZSBvW2FbaV0uY2hpbGRyZW5fZFtzXV07YT1bXTtmb3IoaSBpbiBvKW8uaGFzT3duUHJvcGVydHkoaSkmJmEucHVzaChpKTtyZXR1cm4gdD9lLm1hcChhLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoZSl9LHRoaXMpKTphfSxnZXRfYm90dG9tX3NlbGVjdGVkOmZ1bmN0aW9uKHQpe3ZhciBpLHIscz10aGlzLmdldF9zZWxlY3RlZCghMCksbj1bXTtmb3IoaT0wLHI9cy5sZW5ndGg7cj5pO2krKylzW2ldLmNoaWxkcmVuLmxlbmd0aHx8bi5wdXNoKHNbaV0uaWQpO3JldHVybiB0P2UubWFwKG4sZS5wcm94eShmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShlKX0sdGhpcykpOm59LGdldF9zdGF0ZTpmdW5jdGlvbigpe3ZhciB0LGk9e2NvcmU6e29wZW46W10sc2Nyb2xsOntsZWZ0OnRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0KCksdG9wOnRoaXMuZWxlbWVudC5zY3JvbGxUb3AoKX0sc2VsZWN0ZWQ6W119fTtmb3IodCBpbiB0aGlzLl9tb2RlbC5kYXRhKXRoaXMuX21vZGVsLmRhdGEuaGFzT3duUHJvcGVydHkodCkmJnQhPT1lLmpzdHJlZS5yb290JiYodGhpcy5fbW9kZWwuZGF0YVt0XS5zdGF0ZS5vcGVuZWQmJmkuY29yZS5vcGVuLnB1c2godCksdGhpcy5fbW9kZWwuZGF0YVt0XS5zdGF0ZS5zZWxlY3RlZCYmaS5jb3JlLnNlbGVjdGVkLnB1c2godCkpO3JldHVybiBpfSxzZXRfc3RhdGU6ZnVuY3Rpb24oaSxyKXtpZihpKXtpZihpLmNvcmUpe3ZhciBzLG47aWYoaS5jb3JlLm9wZW4pcmV0dXJuIGUuaXNBcnJheShpLmNvcmUub3BlbikmJmkuY29yZS5vcGVuLmxlbmd0aD90aGlzLl9sb2FkX25vZGVzKGkuY29yZS5vcGVuLGZ1bmN0aW9uKGUpe3RoaXMub3Blbl9ub2RlKGUsITEsMCksZGVsZXRlIGkuY29yZS5vcGVuLHRoaXMuc2V0X3N0YXRlKGkscil9LCEwKTooZGVsZXRlIGkuY29yZS5vcGVuLHRoaXMuc2V0X3N0YXRlKGkscikpLCExO2lmKGkuY29yZS5zY3JvbGwpcmV0dXJuIGkuY29yZS5zY3JvbGwmJmkuY29yZS5zY3JvbGwubGVmdCE9PXQmJnRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0KGkuY29yZS5zY3JvbGwubGVmdCksaS5jb3JlLnNjcm9sbCYmaS5jb3JlLnNjcm9sbC50b3AhPT10JiZ0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKGkuY29yZS5zY3JvbGwudG9wKSxkZWxldGUgaS5jb3JlLnNjcm9sbCx0aGlzLnNldF9zdGF0ZShpLHIpLCExO2lmKGkuY29yZS5zZWxlY3RlZClyZXR1cm4gcz10aGlzLHRoaXMuZGVzZWxlY3RfYWxsKCksZS5lYWNoKGkuY29yZS5zZWxlY3RlZCxmdW5jdGlvbihlLHQpe3Muc2VsZWN0X25vZGUodCwhMSwhMCl9KSxkZWxldGUgaS5jb3JlLnNlbGVjdGVkLHRoaXMuc2V0X3N0YXRlKGksciksITE7Zm9yKG4gaW4gaSlpLmhhc093blByb3BlcnR5KG4pJiZcImNvcmVcIiE9PW4mJi0xPT09ZS5pbkFycmF5KG4sdGhpcy5zZXR0aW5ncy5wbHVnaW5zKSYmZGVsZXRlIGlbbl07aWYoZS5pc0VtcHR5T2JqZWN0KGkuY29yZSkpcmV0dXJuIGRlbGV0ZSBpLmNvcmUsdGhpcy5zZXRfc3RhdGUoaSxyKSwhMX1yZXR1cm4gZS5pc0VtcHR5T2JqZWN0KGkpPyhpPW51bGwsciYmci5jYWxsKHRoaXMpLHRoaXMudHJpZ2dlcihcInNldF9zdGF0ZVwiKSwhMSk6ITB9cmV0dXJuITF9LHJlZnJlc2g6ZnVuY3Rpb24odCxpKXt0aGlzLl9kYXRhLmNvcmUuc3RhdGU9aT09PSEwP3t9OnRoaXMuZ2V0X3N0YXRlKCksaSYmZS5pc0Z1bmN0aW9uKGkpJiYodGhpcy5fZGF0YS5jb3JlLnN0YXRlPWkuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5zdGF0ZSkpLHRoaXMuX2NudD0wLHRoaXMuX21vZGVsLmRhdGE9e30sdGhpcy5fbW9kZWwuZGF0YVtlLmpzdHJlZS5yb290XT17aWQ6ZS5qc3RyZWUucm9vdCxwYXJlbnQ6bnVsbCxwYXJlbnRzOltdLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sc3RhdGU6e2xvYWRlZDohMX19LHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1bXSx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPW51bGwsdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbDt2YXIgcj10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWU7dHx8KHRoaXMuZWxlbWVudC5odG1sKFwiPHVsIGNsYXNzPSdcIityK1wiJyByb2xlPSdncm91cCc+PGxpIGNsYXNzPSdqc3RyZWUtaW5pdGlhbC1ub2RlIGpzdHJlZS1sb2FkaW5nIGpzdHJlZS1sZWFmIGpzdHJlZS1sYXN0JyByb2xlPSd0cmVlaXRlbScgaWQ9J2pcIit0aGlzLl9pZCtcIl9sb2FkaW5nJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLW9jbCc+PC9pPjxhIGNsYXNzPSdqc3RyZWUtYW5jaG9yJyBocmVmPScjJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLXRoZW1laWNvbi1oaWRkZW4nPjwvaT5cIit0aGlzLmdldF9zdHJpbmcoXCJMb2FkaW5nIC4uLlwiKStcIjwvYT48L2xpPjwvdWw+XCIpLHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsXCJqXCIrdGhpcy5faWQrXCJfbG9hZGluZ1wiKSksdGhpcy5sb2FkX25vZGUoZS5qc3RyZWUucm9vdCxmdW5jdGlvbih0LGkpe2kmJih0aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWU9cix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKS5pZCksdGhpcy5zZXRfc3RhdGUoZS5leHRlbmQoITAse30sdGhpcy5fZGF0YS5jb3JlLnN0YXRlKSxmdW5jdGlvbigpe3RoaXMudHJpZ2dlcihcInJlZnJlc2hcIil9KSksdGhpcy5fZGF0YS5jb3JlLnN0YXRlPW51bGx9KX0scmVmcmVzaF9ub2RlOmZ1bmN0aW9uKHQpe2lmKHQ9dGhpcy5nZXRfbm9kZSh0KSwhdHx8dC5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGk9W10scj1bXTt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKTtyLnB1c2godC5pZCksdC5zdGF0ZS5vcGVuZWQ9PT0hMCYmaS5wdXNoKHQuaWQpLHRoaXMuZ2V0X25vZGUodCwhMCkuZmluZChcIi5qc3RyZWUtb3BlblwiKS5lYWNoKGZ1bmN0aW9uKCl7aS5wdXNoKHRoaXMuaWQpfSksdGhpcy5fbG9hZF9ub2RlcyhyLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy5vcGVuX25vZGUoaSwhMSwwKSx0aGlzLnNlbGVjdF9ub2RlKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCksdGhpcy50cmlnZ2VyKFwicmVmcmVzaF9ub2RlXCIse25vZGU6dCxub2RlczplfSl9LHRoaXMpKX0sc2V0X2lkOmZ1bmN0aW9uKHQsaSl7aWYodD10aGlzLmdldF9ub2RlKHQpLCF0fHx0LmlkPT09ZS5qc3RyZWUucm9vdClyZXR1cm4hMTt2YXIgcixzLG49dGhpcy5fbW9kZWwuZGF0YTtmb3IoaT1pLnRvU3RyaW5nKCksblt0LnBhcmVudF0uY2hpbGRyZW5bZS5pbkFycmF5KHQuaWQsblt0LnBhcmVudF0uY2hpbGRyZW4pXT1pLHI9MCxzPXQucGFyZW50cy5sZW5ndGg7cz5yO3IrKyluW3QucGFyZW50c1tyXV0uY2hpbGRyZW5fZFtlLmluQXJyYXkodC5pZCxuW3QucGFyZW50c1tyXV0uY2hpbGRyZW5fZCldPWk7Zm9yKHI9MCxzPXQuY2hpbGRyZW4ubGVuZ3RoO3M+cjtyKyspblt0LmNoaWxkcmVuW3JdXS5wYXJlbnQ9aTtmb3Iocj0wLHM9dC5jaGlsZHJlbl9kLmxlbmd0aDtzPnI7cisrKW5bdC5jaGlsZHJlbl9kW3JdXS5wYXJlbnRzW2UuaW5BcnJheSh0LmlkLG5bdC5jaGlsZHJlbl9kW3JdXS5wYXJlbnRzKV09aTtyZXR1cm4gcj1lLmluQXJyYXkodC5pZCx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQpLC0xIT09ciYmKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtyXT1pKSxyPXRoaXMuZ2V0X25vZGUodC5pZCwhMCksciYmKHIuYXR0cihcImlkXCIsaSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hdHRyKFwiaWRcIixpK1wiX2FuY2hvclwiKS5lbmQoKS5hdHRyKFwiYXJpYS1sYWJlbGxlZGJ5XCIsaStcIl9hbmNob3JcIiksdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIik9PT10LmlkJiZ0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLGkpKSxkZWxldGUgblt0LmlkXSx0LmlkPWksdC5saV9hdHRyLmlkPWksbltpXT10LCEwfSxnZXRfdGV4dDpmdW5jdGlvbih0KXtyZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290P3QudGV4dDohMX0sc2V0X3RleHQ6ZnVuY3Rpb24odCxpKXt2YXIgcixzO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLHI9MCxzPXQubGVuZ3RoO3M+cjtyKyspdGhpcy5zZXRfdGV4dCh0W3JdLGkpO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KHQudGV4dD1pLHRoaXMuZ2V0X25vZGUodCwhMCkubGVuZ3RoJiZ0aGlzLnJlZHJhd19ub2RlKHQuaWQpLHRoaXMudHJpZ2dlcihcInNldF90ZXh0XCIse29iajp0LHRleHQ6aX0pLCEwKTohMX0sZ2V0X2pzb246ZnVuY3Rpb24odCxpLHIpe2lmKHQ9dGhpcy5nZXRfbm9kZSh0fHxlLmpzdHJlZS5yb290KSwhdClyZXR1cm4hMTtpJiZpLmZsYXQmJiFyJiYocj1bXSk7dmFyIHMsbixhPXtpZDp0LmlkLHRleHQ6dC50ZXh0LGljb246dGhpcy5nZXRfaWNvbih0KSxsaV9hdHRyOmUuZXh0ZW5kKCEwLHt9LHQubGlfYXR0ciksYV9hdHRyOmUuZXh0ZW5kKCEwLHt9LHQuYV9hdHRyKSxzdGF0ZTp7fSxkYXRhOmkmJmkubm9fZGF0YT8hMTplLmV4dGVuZCghMCx7fSx0LmRhdGEpfTtpZihpJiZpLmZsYXQ/YS5wYXJlbnQ9dC5wYXJlbnQ6YS5jaGlsZHJlbj1bXSwhaXx8IWkubm9fc3RhdGUpZm9yKHMgaW4gdC5zdGF0ZSl0LnN0YXRlLmhhc093blByb3BlcnR5KHMpJiYoYS5zdGF0ZVtzXT10LnN0YXRlW3NdKTtpZihpJiZpLm5vX2lkJiYoZGVsZXRlIGEuaWQsYS5saV9hdHRyJiZhLmxpX2F0dHIuaWQmJmRlbGV0ZSBhLmxpX2F0dHIuaWQsYS5hX2F0dHImJmEuYV9hdHRyLmlkJiZkZWxldGUgYS5hX2F0dHIuaWQpLGkmJmkuZmxhdCYmdC5pZCE9PWUuanN0cmVlLnJvb3QmJnIucHVzaChhKSwhaXx8IWkubm9fY2hpbGRyZW4pZm9yKHM9MCxuPXQuY2hpbGRyZW4ubGVuZ3RoO24+cztzKyspaSYmaS5mbGF0P3RoaXMuZ2V0X2pzb24odC5jaGlsZHJlbltzXSxpLHIpOmEuY2hpbGRyZW4ucHVzaCh0aGlzLmdldF9qc29uKHQuY2hpbGRyZW5bc10saSkpO3JldHVybiBpJiZpLmZsYXQ/cjp0LmlkPT09ZS5qc3RyZWUucm9vdD9hLmNoaWxkcmVuOmF9LGNyZWF0ZV9ub2RlOmZ1bmN0aW9uKGkscixzLG4sYSl7aWYobnVsbD09PWkmJihpPWUuanN0cmVlLnJvb3QpLGk9dGhpcy5nZXRfbm9kZShpKSwhaSlyZXR1cm4hMTtpZihzPXM9PT10P1wibGFzdFwiOnMsIXMudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhYSYmIXRoaXMuaXNfbG9hZGVkKGkpKXJldHVybiB0aGlzLmxvYWRfbm9kZShpLGZ1bmN0aW9uKCl7dGhpcy5jcmVhdGVfbm9kZShpLHIscyxuLCEwKX0pO3J8fChyPXt0ZXh0OnRoaXMuZ2V0X3N0cmluZyhcIk5ldyBub2RlXCIpfSksXCJzdHJpbmdcIj09dHlwZW9mIHImJihyPXt0ZXh0OnJ9KSxyLnRleHQ9PT10JiYoci50ZXh0PXRoaXMuZ2V0X3N0cmluZyhcIk5ldyBub2RlXCIpKTt2YXIgbyxkLGMsbDtzd2l0Y2goaS5pZD09PWUuanN0cmVlLnJvb3QmJihcImJlZm9yZVwiPT09cyYmKHM9XCJmaXJzdFwiKSxcImFmdGVyXCI9PT1zJiYocz1cImxhc3RcIikpLHMpe2Nhc2VcImJlZm9yZVwiOm89dGhpcy5nZXRfbm9kZShpLnBhcmVudCkscz1lLmluQXJyYXkoaS5pZCxvLmNoaWxkcmVuKSxpPW87YnJlYWs7Y2FzZVwiYWZ0ZXJcIjpvPXRoaXMuZ2V0X25vZGUoaS5wYXJlbnQpLHM9ZS5pbkFycmF5KGkuaWQsby5jaGlsZHJlbikrMSxpPW87YnJlYWs7Y2FzZVwiaW5zaWRlXCI6Y2FzZVwiZmlyc3RcIjpzPTA7YnJlYWs7Y2FzZVwibGFzdFwiOnM9aS5jaGlsZHJlbi5sZW5ndGg7YnJlYWs7ZGVmYXVsdDpzfHwocz0wKX1pZihzPmkuY2hpbGRyZW4ubGVuZ3RoJiYocz1pLmNoaWxkcmVuLmxlbmd0aCksci5pZHx8KHIuaWQ9ITApLCF0aGlzLmNoZWNrKFwiY3JlYXRlX25vZGVcIixyLGkscykpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKHIuaWQ9PT0hMCYmZGVsZXRlIHIuaWQscj10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24ocixpLmlkLGkucGFyZW50cy5jb25jYXQoKSksIXIpcmV0dXJuITE7Zm9yKG89dGhpcy5nZXRfbm9kZShyKSxkPVtdLGQucHVzaChyKSxkPWQuY29uY2F0KG8uY2hpbGRyZW5fZCksdGhpcy50cmlnZ2VyKFwibW9kZWxcIix7bm9kZXM6ZCxwYXJlbnQ6aS5pZH0pLGkuY2hpbGRyZW5fZD1pLmNoaWxkcmVuX2QuY29uY2F0KGQpLGM9MCxsPWkucGFyZW50cy5sZW5ndGg7bD5jO2MrKyl0aGlzLl9tb2RlbC5kYXRhW2kucGFyZW50c1tjXV0uY2hpbGRyZW5fZD10aGlzLl9tb2RlbC5kYXRhW2kucGFyZW50c1tjXV0uY2hpbGRyZW5fZC5jb25jYXQoZCk7Zm9yKHI9byxvPVtdLGM9MCxsPWkuY2hpbGRyZW4ubGVuZ3RoO2w+YztjKyspb1tjPj1zP2MrMTpjXT1pLmNoaWxkcmVuW2NdO3JldHVybiBvW3NdPXIuaWQsaS5jaGlsZHJlbj1vLHRoaXMucmVkcmF3X25vZGUoaSwhMCksbiYmbi5jYWxsKHRoaXMsdGhpcy5nZXRfbm9kZShyKSksdGhpcy50cmlnZ2VyKFwiY3JlYXRlX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKHIpLHBhcmVudDppLmlkLHBvc2l0aW9uOnN9KSxyLmlkfSxyZW5hbWVfbm9kZTpmdW5jdGlvbih0LGkpe3ZhciByLHMsbjtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxyPTAscz10Lmxlbmd0aDtzPnI7cisrKXRoaXMucmVuYW1lX25vZGUodFtyXSxpKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290PyhuPXQudGV4dCx0aGlzLmNoZWNrKFwicmVuYW1lX25vZGVcIix0LHRoaXMuZ2V0X3BhcmVudCh0KSxpKT8odGhpcy5zZXRfdGV4dCh0LGkpLHRoaXMudHJpZ2dlcihcInJlbmFtZV9ub2RlXCIse25vZGU6dCx0ZXh0Omksb2xkOm59KSwhMCk6KHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExKSk6ITF9LGRlbGV0ZV9ub2RlOmZ1bmN0aW9uKHQpe3ZhciBpLHIscyxuLGEsbyxkLGMsbCxoLF8sdTtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxpPTAscj10Lmxlbmd0aDtyPmk7aSsrKXRoaXMuZGVsZXRlX25vZGUodFtpXSk7cmV0dXJuITB9aWYodD10aGlzLmdldF9ub2RlKHQpLCF0fHx0LmlkPT09ZS5qc3RyZWUucm9vdClyZXR1cm4hMTtpZihzPXRoaXMuZ2V0X25vZGUodC5wYXJlbnQpLG49ZS5pbkFycmF5KHQuaWQscy5jaGlsZHJlbiksaD0hMSwhdGhpcy5jaGVjayhcImRlbGV0ZV9ub2RlXCIsdCxzLG4pKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtmb3IoLTEhPT1uJiYocy5jaGlsZHJlbj1lLnZha2F0YS5hcnJheV9yZW1vdmUocy5jaGlsZHJlbixuKSksYT10LmNoaWxkcmVuX2QuY29uY2F0KFtdKSxhLnB1c2godC5pZCksYz0wLGw9YS5sZW5ndGg7bD5jO2MrKyl7Zm9yKG89MCxkPXQucGFyZW50cy5sZW5ndGg7ZD5vO28rKyluPWUuaW5BcnJheShhW2NdLHRoaXMuX21vZGVsLmRhdGFbdC5wYXJlbnRzW29dXS5jaGlsZHJlbl9kKSwtMSE9PW4mJih0aGlzLl9tb2RlbC5kYXRhW3QucGFyZW50c1tvXV0uY2hpbGRyZW5fZD1lLnZha2F0YS5hcnJheV9yZW1vdmUodGhpcy5fbW9kZWwuZGF0YVt0LnBhcmVudHNbb11dLmNoaWxkcmVuX2QsbikpO3RoaXMuX21vZGVsLmRhdGFbYVtjXV0uc3RhdGUuc2VsZWN0ZWQmJihoPSEwLG49ZS5pbkFycmF5KGFbY10sdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkKSwtMSE9PW4mJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9ZS52YWthdGEuYXJyYXlfcmVtb3ZlKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxuKSkpfWZvcih0aGlzLnRyaWdnZXIoXCJkZWxldGVfbm9kZVwiLHtub2RlOnQscGFyZW50OnMuaWR9KSxoJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImRlbGV0ZV9ub2RlXCIsbm9kZTp0LHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxwYXJlbnQ6cy5pZH0pLGM9MCxsPWEubGVuZ3RoO2w+YztjKyspZGVsZXRlIHRoaXMuX21vZGVsLmRhdGFbYVtjXV07cmV0dXJuLTEhPT1lLmluQXJyYXkodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQsYSkmJih0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsLF89dGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcCx1PXRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0LHMuaWQ9PT1lLmpzdHJlZS5yb290P3RoaXMuZ2V0X25vZGUodGhpcy5fbW9kZWwuZGF0YVtlLmpzdHJlZS5yb290XS5jaGlsZHJlblswXSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpOnRoaXMuZ2V0X25vZGUocywhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpLHRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3A9Xyx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdD11KSx0aGlzLnJlZHJhd19ub2RlKHMsITApLCEwfSxjaGVjazpmdW5jdGlvbih0LGkscixzLG4pe2k9aSYmaS5pZD9pOnRoaXMuZ2V0X25vZGUoaSkscj1yJiZyLmlkP3I6dGhpcy5nZXRfbm9kZShyKTt2YXIgYT10Lm1hdGNoKC9ebW92ZV9ub2RlfGNvcHlfbm9kZXxjcmVhdGVfbm9kZSQvaSk/cjppLG89dGhpcy5zZXR0aW5ncy5jb3JlLmNoZWNrX2NhbGxiYWNrO3JldHVyblwibW92ZV9ub2RlXCIhPT10JiZcImNvcHlfbm9kZVwiIT09dHx8biYmbi5pc19tdWx0aXx8KGkuaWQhPT1yLmlkfHxcImNvcHlfbm9kZVwiPT09dCkmJmUuaW5BcnJheShpLmlkLHIuY2hpbGRyZW4pIT09cyYmLTE9PT1lLmluQXJyYXkoci5pZCxpLmNoaWxkcmVuX2QpPyhhJiZhLmRhdGEmJihhPWEuZGF0YSksYSYmYS5mdW5jdGlvbnMmJihhLmZ1bmN0aW9uc1t0XT09PSExfHxhLmZ1bmN0aW9uc1t0XT09PSEwKT8oYS5mdW5jdGlvbnNbdF09PT0hMSYmKHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wMlwiLHJlYXNvbjpcIk5vZGUgZGF0YSBwcmV2ZW50cyBmdW5jdGlvbjogXCIrdCxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6dCxwb3M6cyxvYmo6aSYmaS5pZD9pLmlkOiExLHBhcjpyJiZyLmlkP3IuaWQ6ITF9KX0pLGEuZnVuY3Rpb25zW3RdKTpvPT09ITF8fGUuaXNGdW5jdGlvbihvKSYmby5jYWxsKHRoaXMsdCxpLHIscyxuKT09PSExfHxvJiZvW3RdPT09ITE/KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wM1wiLHJlYXNvbjpcIlVzZXIgY29uZmlnIGZvciBjb3JlLmNoZWNrX2NhbGxiYWNrIHByZXZlbnRzIGZ1bmN0aW9uOiBcIit0LGRhdGE6SlNPTi5zdHJpbmdpZnkoe2Noazp0LHBvczpzLG9iajppJiZpLmlkP2kuaWQ6ITEscGFyOnImJnIuaWQ/ci5pZDohMX0pfSwhMSk6ITApOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDFcIixyZWFzb246XCJNb3ZpbmcgcGFyZW50IGluc2lkZSBjaGlsZFwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2Noazp0LHBvczpzLG9iajppJiZpLmlkP2kuaWQ6ITEscGFyOnImJnIuaWQ/ci5pZDohMX0pfSwhMSl9LGxhc3RfZXJyb3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3J9LG1vdmVfbm9kZTpmdW5jdGlvbihpLHIscyxuLGEsbyxkKXt2YXIgYyxsLGgsXyx1LGcsZixwLG0sdixqLHksayx4O2lmKHI9dGhpcy5nZXRfbm9kZShyKSxzPXM9PT10PzA6cywhcilyZXR1cm4hMTtpZighcy50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFhJiYhdGhpcy5pc19sb2FkZWQocikpcmV0dXJuIHRoaXMubG9hZF9ub2RlKHIsZnVuY3Rpb24oKXt0aGlzLm1vdmVfbm9kZShpLHIscyxuLCEwLCExLGQpfSk7aWYoZS5pc0FycmF5KGkpKXtpZigxIT09aS5sZW5ndGgpe2ZvcihjPTAsbD1pLmxlbmd0aDtsPmM7YysrKShtPXRoaXMubW92ZV9ub2RlKGlbY10scixzLG4sYSwhMSxkKSkmJihyPW0scz1cImFmdGVyXCIpO3JldHVybiB0aGlzLnJlZHJhdygpLCEwfWk9aVswXX1pZihpPWkmJmkuaWQ/aTp0aGlzLmdldF9ub2RlKGkpLCFpfHxpLmlkPT09ZS5qc3RyZWUucm9vdClyZXR1cm4hMTtpZihoPShpLnBhcmVudHx8ZS5qc3RyZWUucm9vdCkudG9TdHJpbmcoKSx1PXMudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiZyLmlkIT09ZS5qc3RyZWUucm9vdD90aGlzLmdldF9ub2RlKHIucGFyZW50KTpyLGc9ZD9kOnRoaXMuX21vZGVsLmRhdGFbaS5pZF0/dGhpczplLmpzdHJlZS5yZWZlcmVuY2UoaS5pZCksZj0hZ3x8IWcuX2lkfHx0aGlzLl9pZCE9PWcuX2lkLF89ZyYmZy5faWQmJmgmJmcuX21vZGVsLmRhdGFbaF0mJmcuX21vZGVsLmRhdGFbaF0uY2hpbGRyZW4/ZS5pbkFycmF5KGkuaWQsZy5fbW9kZWwuZGF0YVtoXS5jaGlsZHJlbik6LTEsZyYmZy5faWQmJihpPWcuX21vZGVsLmRhdGFbaS5pZF0pLGYpcmV0dXJuKG09dGhpcy5jb3B5X25vZGUoaSxyLHMsbixhLCExLGQpKT8oZyYmZy5kZWxldGVfbm9kZShpKSxtKTohMTtzd2l0Y2goci5pZD09PWUuanN0cmVlLnJvb3QmJihcImJlZm9yZVwiPT09cyYmKHM9XCJmaXJzdFwiKSxcImFmdGVyXCI9PT1zJiYocz1cImxhc3RcIikpLHMpe2Nhc2VcImJlZm9yZVwiOnM9ZS5pbkFycmF5KHIuaWQsdS5jaGlsZHJlbik7YnJlYWs7Y2FzZVwiYWZ0ZXJcIjpzPWUuaW5BcnJheShyLmlkLHUuY2hpbGRyZW4pKzE7YnJlYWs7Y2FzZVwiaW5zaWRlXCI6Y2FzZVwiZmlyc3RcIjpzPTA7YnJlYWs7Y2FzZVwibGFzdFwiOnM9dS5jaGlsZHJlbi5sZW5ndGg7YnJlYWs7ZGVmYXVsdDpzfHwocz0wKX1pZihzPnUuY2hpbGRyZW4ubGVuZ3RoJiYocz11LmNoaWxkcmVuLmxlbmd0aCksIXRoaXMuY2hlY2soXCJtb3ZlX25vZGVcIixpLHUscyx7Y29yZTohMCxvcmlnaW46ZCxpc19tdWx0aTpnJiZnLl9pZCYmZy5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiFnfHwhZy5faWR9KSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7aWYoaS5wYXJlbnQ9PT11LmlkKXtmb3IocD11LmNoaWxkcmVuLmNvbmNhdCgpLG09ZS5pbkFycmF5KGkuaWQscCksLTEhPT1tJiYocD1lLnZha2F0YS5hcnJheV9yZW1vdmUocCxtKSxzPm0mJnMtLSksbT1bXSx2PTAsaj1wLmxlbmd0aDtqPnY7disrKW1bdj49cz92KzE6dl09cFt2XTttW3NdPWkuaWQsdS5jaGlsZHJlbj1tLHRoaXMuX25vZGVfY2hhbmdlZCh1LmlkKSx0aGlzLnJlZHJhdyh1LmlkPT09ZS5qc3RyZWUucm9vdCl9ZWxzZXtmb3IobT1pLmNoaWxkcmVuX2QuY29uY2F0KCksbS5wdXNoKGkuaWQpLHY9MCxqPWkucGFyZW50cy5sZW5ndGg7aj52O3YrKyl7Zm9yKHA9W10seD1nLl9tb2RlbC5kYXRhW2kucGFyZW50c1t2XV0uY2hpbGRyZW5fZCx5PTAsaz14Lmxlbmd0aDtrPnk7eSsrKS0xPT09ZS5pbkFycmF5KHhbeV0sbSkmJnAucHVzaCh4W3ldKTtnLl9tb2RlbC5kYXRhW2kucGFyZW50c1t2XV0uY2hpbGRyZW5fZD1wfWZvcihnLl9tb2RlbC5kYXRhW2hdLmNoaWxkcmVuPWUudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKGcuX21vZGVsLmRhdGFbaF0uY2hpbGRyZW4saS5pZCksdj0wLGo9dS5wYXJlbnRzLmxlbmd0aDtqPnY7disrKXRoaXMuX21vZGVsLmRhdGFbdS5wYXJlbnRzW3ZdXS5jaGlsZHJlbl9kPXRoaXMuX21vZGVsLmRhdGFbdS5wYXJlbnRzW3ZdXS5jaGlsZHJlbl9kLmNvbmNhdChtKTtmb3IocD1bXSx2PTAsaj11LmNoaWxkcmVuLmxlbmd0aDtqPnY7disrKXBbdj49cz92KzE6dl09dS5jaGlsZHJlblt2XTtmb3IocFtzXT1pLmlkLHUuY2hpbGRyZW49cCx1LmNoaWxkcmVuX2QucHVzaChpLmlkKSx1LmNoaWxkcmVuX2Q9dS5jaGlsZHJlbl9kLmNvbmNhdChpLmNoaWxkcmVuX2QpLGkucGFyZW50PXUuaWQsbT11LnBhcmVudHMuY29uY2F0KCksbS51bnNoaWZ0KHUuaWQpLHg9aS5wYXJlbnRzLmxlbmd0aCxpLnBhcmVudHM9bSxtPW0uY29uY2F0KCksdj0wLGo9aS5jaGlsZHJlbl9kLmxlbmd0aDtqPnY7disrKXRoaXMuX21vZGVsLmRhdGFbaS5jaGlsZHJlbl9kW3ZdXS5wYXJlbnRzPXRoaXMuX21vZGVsLmRhdGFbaS5jaGlsZHJlbl9kW3ZdXS5wYXJlbnRzLnNsaWNlKDAsLTEqeCksQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkodGhpcy5fbW9kZWwuZGF0YVtpLmNoaWxkcmVuX2Rbdl1dLnBhcmVudHMsbSk7KGg9PT1lLmpzdHJlZS5yb290fHx1LmlkPT09ZS5qc3RyZWUucm9vdCkmJih0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXd8fCh0aGlzLl9ub2RlX2NoYW5nZWQoaCksdGhpcy5fbm9kZV9jaGFuZ2VkKHUuaWQpKSxvfHx0aGlzLnJlZHJhdygpfXJldHVybiBuJiZuLmNhbGwodGhpcyxpLHUscyksdGhpcy50cmlnZ2VyKFwibW92ZV9ub2RlXCIse25vZGU6aSxwYXJlbnQ6dS5pZCxwb3NpdGlvbjpzLG9sZF9wYXJlbnQ6aCxvbGRfcG9zaXRpb246Xyxpc19tdWx0aTpnJiZnLl9pZCYmZy5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiFnfHwhZy5faWQsb2xkX2luc3RhbmNlOmcsbmV3X2luc3RhbmNlOnRoaXN9KSxpLmlkfSxjb3B5X25vZGU6ZnVuY3Rpb24oaSxyLHMsbixhLG8sZCl7dmFyIGMsbCxoLF8sdSxnLGYscCxtLHYsajtpZihyPXRoaXMuZ2V0X25vZGUocikscz1zPT09dD8wOnMsIXIpcmV0dXJuITE7aWYoIXMudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhYSYmIXRoaXMuaXNfbG9hZGVkKHIpKXJldHVybiB0aGlzLmxvYWRfbm9kZShyLGZ1bmN0aW9uKCl7dGhpcy5jb3B5X25vZGUoaSxyLHMsbiwhMCwhMSxkKX0pO2lmKGUuaXNBcnJheShpKSl7aWYoMSE9PWkubGVuZ3RoKXtmb3IoYz0wLGw9aS5sZW5ndGg7bD5jO2MrKykoXz10aGlzLmNvcHlfbm9kZShpW2NdLHIscyxuLGEsITAsZCkpJiYocj1fLHM9XCJhZnRlclwiKTtyZXR1cm4gdGhpcy5yZWRyYXcoKSwhMH1pPWlbMF19aWYoaT1pJiZpLmlkP2k6dGhpcy5nZXRfbm9kZShpKSwhaXx8aS5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7c3dpdGNoKHA9KGkucGFyZW50fHxlLmpzdHJlZS5yb290KS50b1N0cmluZygpLG09cy50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJnIuaWQhPT1lLmpzdHJlZS5yb290P3RoaXMuZ2V0X25vZGUoci5wYXJlbnQpOnIsdj1kP2Q6dGhpcy5fbW9kZWwuZGF0YVtpLmlkXT90aGlzOmUuanN0cmVlLnJlZmVyZW5jZShpLmlkKSxqPSF2fHwhdi5faWR8fHRoaXMuX2lkIT09di5faWQsdiYmdi5faWQmJihpPXYuX21vZGVsLmRhdGFbaS5pZF0pLHIuaWQ9PT1lLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PXMmJihzPVwiZmlyc3RcIiksXCJhZnRlclwiPT09cyYmKHM9XCJsYXN0XCIpKSxzKXtjYXNlXCJiZWZvcmVcIjpzPWUuaW5BcnJheShyLmlkLG0uY2hpbGRyZW4pO2JyZWFrO2Nhc2VcImFmdGVyXCI6cz1lLmluQXJyYXkoci5pZCxtLmNoaWxkcmVuKSsxO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6cz0wO2JyZWFrO2Nhc2VcImxhc3RcIjpzPW0uY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6c3x8KHM9MCl9aWYocz5tLmNoaWxkcmVuLmxlbmd0aCYmKHM9bS5jaGlsZHJlbi5sZW5ndGgpLCF0aGlzLmNoZWNrKFwiY29weV9ub2RlXCIsaSxtLHMse2NvcmU6ITAsb3JpZ2luOmQsaXNfbXVsdGk6diYmdi5faWQmJnYuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohdnx8IXYuX2lkfSkpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKGY9dj92LmdldF9qc29uKGkse25vX2lkOiEwLG5vX2RhdGE6ITAsbm9fc3RhdGU6ITB9KTppLCFmKXJldHVybiExO2lmKGYuaWQ9PT0hMCYmZGVsZXRlIGYuaWQsZj10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24oZixtLmlkLG0ucGFyZW50cy5jb25jYXQoKSksIWYpcmV0dXJuITE7Zm9yKF89dGhpcy5nZXRfbm9kZShmKSxpJiZpLnN0YXRlJiZpLnN0YXRlLmxvYWRlZD09PSExJiYoXy5zdGF0ZS5sb2FkZWQ9ITEpLGg9W10saC5wdXNoKGYpLGg9aC5jb25jYXQoXy5jaGlsZHJlbl9kKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpoLHBhcmVudDptLmlkfSksdT0wLGc9bS5wYXJlbnRzLmxlbmd0aDtnPnU7dSsrKXRoaXMuX21vZGVsLmRhdGFbbS5wYXJlbnRzW3VdXS5jaGlsZHJlbl9kPXRoaXMuX21vZGVsLmRhdGFbbS5wYXJlbnRzW3VdXS5jaGlsZHJlbl9kLmNvbmNhdChoKTtmb3IoaD1bXSx1PTAsZz1tLmNoaWxkcmVuLmxlbmd0aDtnPnU7dSsrKWhbdT49cz91KzE6dV09bS5jaGlsZHJlblt1XTtyZXR1cm4gaFtzXT1fLmlkLG0uY2hpbGRyZW49aCxtLmNoaWxkcmVuX2QucHVzaChfLmlkKSxtLmNoaWxkcmVuX2Q9bS5jaGlsZHJlbl9kLmNvbmNhdChfLmNoaWxkcmVuX2QpLG0uaWQ9PT1lLmpzdHJlZS5yb290JiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3fHx0aGlzLl9ub2RlX2NoYW5nZWQobS5pZCksb3x8dGhpcy5yZWRyYXcobS5pZD09PWUuanN0cmVlLnJvb3QpLG4mJm4uY2FsbCh0aGlzLF8sbSxzKSx0aGlzLnRyaWdnZXIoXCJjb3B5X25vZGVcIix7bm9kZTpfLG9yaWdpbmFsOmkscGFyZW50Om0uaWQscG9zaXRpb246cyxvbGRfcGFyZW50OnAsb2xkX3Bvc2l0aW9uOnYmJnYuX2lkJiZwJiZ2Ll9tb2RlbC5kYXRhW3BdJiZ2Ll9tb2RlbC5kYXRhW3BdLmNoaWxkcmVuP2UuaW5BcnJheShpLmlkLHYuX21vZGVsLmRhdGFbcF0uY2hpbGRyZW4pOi0xLGlzX211bHRpOnYmJnYuX2lkJiZ2Ll9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IXZ8fCF2Ll9pZCxvbGRfaW5zdGFuY2U6dixuZXdfaW5zdGFuY2U6dGhpc30pLF8uaWR9LGN1dDpmdW5jdGlvbih0KXtpZih0fHwodD10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KCkpLGUuaXNBcnJheSh0KXx8KHQ9W3RdKSwhdC5sZW5ndGgpcmV0dXJuITE7dmFyIGkscixzLGQ9W107Zm9yKHI9MCxzPXQubGVuZ3RoO3M+cjtyKyspaT10aGlzLmdldF9ub2RlKHRbcl0pLGkmJmkuaWQmJmkuaWQhPT1lLmpzdHJlZS5yb290JiZkLnB1c2goaSk7cmV0dXJuIGQubGVuZ3RoPyhuPWQsbz10aGlzLGE9XCJtb3ZlX25vZGVcIix2b2lkIHRoaXMudHJpZ2dlcihcImN1dFwiLHtub2RlOnR9KSk6ITF9LGNvcHk6ZnVuY3Rpb24odCl7aWYodHx8KHQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdCgpKSxlLmlzQXJyYXkodCl8fCh0PVt0XSksIXQubGVuZ3RoKXJldHVybiExO3ZhciBpLHIscyxkPVtdO2ZvcihyPTAscz10Lmxlbmd0aDtzPnI7cisrKWk9dGhpcy5nZXRfbm9kZSh0W3JdKSxpJiZpLmlkJiZpLmlkIT09ZS5qc3RyZWUucm9vdCYmZC5wdXNoKGkpO3JldHVybiBkLmxlbmd0aD8obj1kLG89dGhpcyxhPVwiY29weV9ub2RlXCIsdm9pZCB0aGlzLnRyaWdnZXIoXCJjb3B5XCIse25vZGU6dH0pKTohMX0sZ2V0X2J1ZmZlcjpmdW5jdGlvbigpe3JldHVybnttb2RlOmEsbm9kZTpuLGluc3Q6b319LGNhbl9wYXN0ZTpmdW5jdGlvbigpe3JldHVybiBhIT09ITEmJm4hPT0hMX0scGFzdGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZT10aGlzLmdldF9ub2RlKGUpLGUmJmEmJmEubWF0Y2goL14oY29weV9ub2RlfG1vdmVfbm9kZSkkLykmJm4/KHRoaXNbYV0obixlLHQsITEsITEsITEsbykmJnRoaXMudHJpZ2dlcihcInBhc3RlXCIse3BhcmVudDplLmlkLG5vZGU6bixtb2RlOmF9KSxuPSExLGE9ITEsdm9pZChvPSExKSk6ITF9LGNsZWFyX2J1ZmZlcjpmdW5jdGlvbigpe249ITEsYT0hMSxvPSExLHRoaXMudHJpZ2dlcihcImNsZWFyX2J1ZmZlclwiKX0sZWRpdDpmdW5jdGlvbih0LGkscil7dmFyIHMsbixhLG8sZCxjLGwsaCxfLHU9ITE7cmV0dXJuKHQ9dGhpcy5nZXRfbm9kZSh0KSk/dGhpcy5zZXR0aW5ncy5jb3JlLmNoZWNrX2NhbGxiYWNrPT09ITE/KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wN1wiLHJlYXNvbjpcIkNvdWxkIG5vdCBlZGl0IG5vZGUgYmVjYXVzZSBvZiBjaGVja19jYWxsYmFja1wifSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMSk6KF89dCxpPVwic3RyaW5nXCI9PXR5cGVvZiBpP2k6dC50ZXh0LHRoaXMuc2V0X3RleHQodCxcIlwiKSx0PXRoaXMuX29wZW5fdG8odCksXy50ZXh0PWkscz10aGlzLl9kYXRhLmNvcmUucnRsLG49dGhpcy5lbGVtZW50LndpZHRoKCksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9Xy5pZCxhPXQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpLG89ZShcIjxzcGFuPlwiKSxkPWksYz1lKFwiPGRpdiAvPlwiLHtjc3M6e3Bvc2l0aW9uOlwiYWJzb2x1dGVcIix0b3A6XCItMjAwcHhcIixsZWZ0OnM/XCIwcHhcIjpcIi0xMDAwcHhcIix2aXNpYmlsaXR5OlwiaGlkZGVuXCJ9fSkuYXBwZW5kVG8oXCJib2R5XCIpLGw9ZShcIjxpbnB1dCAvPlwiLHt2YWx1ZTpkLFwiY2xhc3NcIjpcImpzdHJlZS1yZW5hbWUtaW5wdXRcIixjc3M6e3BhZGRpbmc6XCIwXCIsYm9yZGVyOlwiMXB4IHNvbGlkIHNpbHZlclwiLFwiYm94LXNpemluZ1wiOlwiYm9yZGVyLWJveFwiLGRpc3BsYXk6XCJpbmxpbmUtYmxvY2tcIixoZWlnaHQ6dGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCtcInB4XCIsbGluZUhlaWdodDp0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0K1wicHhcIix3aWR0aDpcIjE1MHB4XCJ9LGJsdXI6ZS5wcm94eShmdW5jdGlvbihpKXtpLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGkucHJldmVudERlZmF1bHQoKTt2YXIgcyxuPW8uY2hpbGRyZW4oXCIuanN0cmVlLXJlbmFtZS1pbnB1dFwiKSxsPW4udmFsKCksaD10aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dDtcIlwiPT09bCYmKGw9ZCksYy5yZW1vdmUoKSxvLnJlcGxhY2VXaXRoKGEpLG8ucmVtb3ZlKCksZD1oP2Q6ZShcIjxkaXY+PC9kaXY+XCIpLmFwcGVuZChlLnBhcnNlSFRNTChkKSkuaHRtbCgpLHRoaXMuc2V0X3RleHQodCxkKSxzPSEhdGhpcy5yZW5hbWVfbm9kZSh0LGg/ZShcIjxkaXY+PC9kaXY+XCIpLnRleHQobCkudGV4dCgpOmUoXCI8ZGl2PjwvZGl2PlwiKS5hcHBlbmQoZS5wYXJzZUhUTUwobCkpLmh0bWwoKSksc3x8dGhpcy5zZXRfdGV4dCh0LGQpLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPV8uaWQsc2V0VGltZW91dChlLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5nZXRfbm9kZShfLmlkLCEwKTtlLmxlbmd0aCYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPV8uaWQsZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpfSx0aGlzKSwwKSxyJiZyLmNhbGwodGhpcyxfLHMsdSl9LHRoaXMpLGtleWRvd246ZnVuY3Rpb24oZSl7dmFyIHQ9ZS53aGljaDsyNz09PXQmJih1PSEwLHRoaXMudmFsdWU9ZCksKDI3PT09dHx8MTM9PT10fHwzNz09PXR8fDM4PT09dHx8Mzk9PT10fHw0MD09PXR8fDMyPT09dCkmJmUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksKDI3PT09dHx8MTM9PT10KSYmKGUucHJldmVudERlZmF1bHQoKSx0aGlzLmJsdXIoKSl9LGNsaWNrOmZ1bmN0aW9uKGUpe2Uuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9LG1vdXNlZG93bjpmdW5jdGlvbihlKXtlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfSxrZXl1cDpmdW5jdGlvbihlKXtsLndpZHRoKE1hdGgubWluKGMudGV4dChcInBXXCIrdGhpcy52YWx1ZSkud2lkdGgoKSxuKSl9LGtleXByZXNzOmZ1bmN0aW9uKGUpe3JldHVybiAxMz09PWUud2hpY2g/ITE6dm9pZCAwfX0pLGg9e2ZvbnRGYW1pbHk6YS5jc3MoXCJmb250RmFtaWx5XCIpfHxcIlwiLGZvbnRTaXplOmEuY3NzKFwiZm9udFNpemVcIil8fFwiXCIsZm9udFdlaWdodDphLmNzcyhcImZvbnRXZWlnaHRcIil8fFwiXCIsZm9udFN0eWxlOmEuY3NzKFwiZm9udFN0eWxlXCIpfHxcIlwiLGZvbnRTdHJldGNoOmEuY3NzKFwiZm9udFN0cmV0Y2hcIil8fFwiXCIsZm9udFZhcmlhbnQ6YS5jc3MoXCJmb250VmFyaWFudFwiKXx8XCJcIixsZXR0ZXJTcGFjaW5nOmEuY3NzKFwibGV0dGVyU3BhY2luZ1wiKXx8XCJcIix3b3JkU3BhY2luZzphLmNzcyhcIndvcmRTcGFjaW5nXCIpfHxcIlwifSxvLmF0dHIoXCJjbGFzc1wiLGEuYXR0cihcImNsYXNzXCIpKS5hcHBlbmQoYS5jb250ZW50cygpLmNsb25lKCkpLmFwcGVuZChsKSxhLnJlcGxhY2VXaXRoKG8pLGMuY3NzKGgpLHZvaWQgbC5jc3MoaCkud2lkdGgoTWF0aC5taW4oYy50ZXh0KFwicFdcIitsWzBdLnZhbHVlKS53aWR0aCgpLG4pKVswXS5zZWxlY3QoKSk6ITF9LHNldF90aGVtZTpmdW5jdGlvbih0LGkpe2lmKCF0KXJldHVybiExO2lmKGk9PT0hMCl7dmFyIHI9dGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lcy5kaXI7cnx8KHI9ZS5qc3RyZWUucGF0aCtcIi90aGVtZXNcIiksaT1yK1wiL1wiK3QrXCIvc3R5bGUuY3NzXCJ9aSYmLTE9PT1lLmluQXJyYXkoaSxkKSYmKGUoXCJoZWFkXCIpLmFwcGVuZCgnPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCInK2krJ1wiIHR5cGU9XCJ0ZXh0L2Nzc1wiIC8+JyksZC5wdXNoKGkpKSx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWUmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImpzdHJlZS1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWUpLFxudGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lPXQsdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLVwiK3QpLHRoaXMuZWxlbWVudFt0aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJqc3RyZWUtXCIrdCtcIi1yZXNwb25zaXZlXCIpLHRoaXMudHJpZ2dlcihcInNldF90aGVtZVwiLHt0aGVtZTp0fSl9LGdldF90aGVtZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWV9LHNldF90aGVtZV92YXJpYW50OmZ1bmN0aW9uKGUpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudCYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZStcIi1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQpLHRoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudD1lLGUmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWUrXCItXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50KX0sZ2V0X3RoZW1lX3ZhcmlhbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50fSxzaG93X3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkuYWRkQ2xhc3MoXCJqc3RyZWUtc3RyaXBlZFwiKX0saGlkZV9zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLXN0cmlwZWRcIil9LHRvZ2dsZV9zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzP3RoaXMuaGlkZV9zdHJpcGVzKCk6dGhpcy5zaG93X3N0cmlwZXMoKX0sc2hvd19kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWRvdHNcIil9LGhpZGVfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1kb3RzXCIpfSx0b2dnbGVfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz90aGlzLmhpZGVfZG90cygpOnRoaXMuc2hvd19kb3RzKCl9LHNob3dfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWljb25zXCIpfSxoaWRlX2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1pY29uc1wiKX0sdG9nZ2xlX2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz90aGlzLmhpZGVfaWNvbnMoKTp0aGlzLnNob3dfaWNvbnMoKX0sc2V0X2ljb246ZnVuY3Rpb24oaSxyKXt2YXIgcyxuLGEsbztpZihlLmlzQXJyYXkoaSkpe2ZvcihpPWkuc2xpY2UoKSxzPTAsbj1pLmxlbmd0aDtuPnM7cysrKXRoaXMuc2V0X2ljb24oaVtzXSxyKTtyZXR1cm4hMH1yZXR1cm4gaT10aGlzLmdldF9ub2RlKGkpLGkmJmkuaWQhPT1lLmpzdHJlZS5yb290PyhvPWkuaWNvbixpLmljb249cj09PSEwfHxudWxsPT09cnx8cj09PXR8fFwiXCI9PT1yPyEwOnIsYT10aGlzLmdldF9ub2RlKGksITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKSxyPT09ITE/dGhpcy5oaWRlX2ljb24oaSk6cj09PSEwfHxudWxsPT09cnx8cj09PXR8fFwiXCI9PT1yPyhhLnJlbW92ZUNsYXNzKFwianN0cmVlLXRoZW1laWNvbi1jdXN0b20gXCIrbykuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLnJlbW92ZUF0dHIoXCJyZWxcIiksbz09PSExJiZ0aGlzLnNob3dfaWNvbihpKSk6LTE9PT1yLmluZGV4T2YoXCIvXCIpJiYtMT09PXIuaW5kZXhPZihcIi5cIik/KGEucmVtb3ZlQ2xhc3MobykuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLGEuYWRkQ2xhc3MocitcIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKS5hdHRyKFwicmVsXCIsciksbz09PSExJiZ0aGlzLnNob3dfaWNvbihpKSk6KGEucmVtb3ZlQ2xhc3MobykuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLGEuYWRkQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJ1cmwoJ1wiK3IrXCInKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdFwiKS5hdHRyKFwicmVsXCIsciksbz09PSExJiZ0aGlzLnNob3dfaWNvbihpKSksITApOiExfSxnZXRfaWNvbjpmdW5jdGlvbih0KXtyZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290P3QuaWNvbjohMX0saGlkZV9pY29uOmZ1bmN0aW9uKHQpe3ZhciBpLHI7aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksaT0wLHI9dC5sZW5ndGg7cj5pO2krKyl0aGlzLmhpZGVfaWNvbih0W2ldKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQhPT1lLmpzdHJlZS5yb290Pyh0Lmljb249ITEsdGhpcy5nZXRfbm9kZSh0LCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikuYWRkQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKSwhMCk6ITF9LHNob3dfaWNvbjpmdW5jdGlvbih0KXt2YXIgaSxyLHM7aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksaT0wLHI9dC5sZW5ndGg7cj5pO2krKyl0aGlzLnNob3dfaWNvbih0W2ldKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQhPT1lLmpzdHJlZS5yb290PyhzPXRoaXMuZ2V0X25vZGUodCwhMCksdC5pY29uPXMubGVuZ3RoP3MuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLmF0dHIoXCJyZWxcIik6ITAsdC5pY29ufHwodC5pY29uPSEwKSxzLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpLCEwKTohMX19LGUudmFrYXRhPXt9LGUudmFrYXRhLmF0dHJpYnV0ZXM9ZnVuY3Rpb24odCxpKXt0PWUodClbMF07dmFyIHI9aT97fTpbXTtyZXR1cm4gdCYmdC5hdHRyaWJ1dGVzJiZlLmVhY2godC5hdHRyaWJ1dGVzLGZ1bmN0aW9uKHQscyl7LTE9PT1lLmluQXJyYXkocy5uYW1lLnRvTG93ZXJDYXNlKCksW1wic3R5bGVcIixcImNvbnRlbnRlZGl0YWJsZVwiLFwiaGFzZm9jdXNcIixcInRhYmluZGV4XCJdKSYmbnVsbCE9PXMudmFsdWUmJlwiXCIhPT1lLnRyaW0ocy52YWx1ZSkmJihpP3Jbcy5uYW1lXT1zLnZhbHVlOnIucHVzaChzLm5hbWUpKX0pLHJ9LGUudmFrYXRhLmFycmF5X3VuaXF1ZT1mdW5jdGlvbihlKXt2YXIgaSxyLHM9W10sbj17fTtmb3IoaT0wLHI9ZS5sZW5ndGg7cj5pO2krKyluW2VbaV1dPT09dCYmKHMucHVzaChlW2ldKSxuW2VbaV1dPSEwKTtyZXR1cm4gc30sZS52YWthdGEuYXJyYXlfcmVtb3ZlPWZ1bmN0aW9uKGUsdCxpKXt2YXIgcj1lLnNsaWNlKChpfHx0KSsxfHxlLmxlbmd0aCk7cmV0dXJuIGUubGVuZ3RoPTA+dD9lLmxlbmd0aCt0OnQsZS5wdXNoLmFwcGx5KGUsciksZX0sZS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW09ZnVuY3Rpb24odCxpKXt2YXIgcj1lLmluQXJyYXkoaSx0KTtyZXR1cm4tMSE9PXI/ZS52YWthdGEuYXJyYXlfcmVtb3ZlKHQscik6dH0sZS5qc3RyZWUucGx1Z2lucy5jaGFuZ2VkPWZ1bmN0aW9uKGUsdCl7dmFyIGk9W107dGhpcy50cmlnZ2VyPWZ1bmN0aW9uKGUscil7dmFyIHMsbjtpZihyfHwocj17fSksXCJjaGFuZ2VkXCI9PT1lLnJlcGxhY2UoXCIuanN0cmVlXCIsXCJcIikpe3IuY2hhbmdlZD17c2VsZWN0ZWQ6W10sZGVzZWxlY3RlZDpbXX07dmFyIGE9e307Zm9yKHM9MCxuPWkubGVuZ3RoO24+cztzKyspYVtpW3NdXT0xO2ZvcihzPTAsbj1yLnNlbGVjdGVkLmxlbmd0aDtuPnM7cysrKWFbci5zZWxlY3RlZFtzXV0/YVtyLnNlbGVjdGVkW3NdXT0yOnIuY2hhbmdlZC5zZWxlY3RlZC5wdXNoKHIuc2VsZWN0ZWRbc10pO2ZvcihzPTAsbj1pLmxlbmd0aDtuPnM7cysrKTE9PT1hW2lbc11dJiZyLmNoYW5nZWQuZGVzZWxlY3RlZC5wdXNoKGlbc10pO2k9ci5zZWxlY3RlZC5zbGljZSgpfXQudHJpZ2dlci5jYWxsKHRoaXMsZSxyKX0sdGhpcy5yZWZyZXNoPWZ1bmN0aW9uKGUscil7cmV0dXJuIGk9W10sdC5yZWZyZXNoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19O3ZhciBfPWwuY3JlYXRlRWxlbWVudChcIklcIik7Xy5jbGFzc05hbWU9XCJqc3RyZWUtaWNvbiBqc3RyZWUtY2hlY2tib3hcIixfLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxlLmpzdHJlZS5kZWZhdWx0cy5jaGVja2JveD17dmlzaWJsZTohMCx0aHJlZV9zdGF0ZTohMCx3aG9sZV9ub2RlOiEwLGtlZXBfc2VsZWN0ZWRfc3R5bGU6ITAsY2FzY2FkZTpcIlwiLHRpZV9zZWxlY3Rpb246ITB9LGUuanN0cmVlLnBsdWdpbnMuY2hlY2tib3g9ZnVuY3Rpb24oaSxyKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtyLmJpbmQuY2FsbCh0aGlzKSx0aGlzLl9kYXRhLmNoZWNrYm94LnV0bz0hMSx0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGhyZWVfc3RhdGUmJih0aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGU9XCJ1cCtkb3duK3VuZGV0ZXJtaW5lZFwiKSx0aGlzLmVsZW1lbnQub24oXCJpbml0LmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNoZWNrYm94LnZpc2libGU9dGhpcy5zZXR0aW5ncy5jaGVja2JveC52aXNpYmxlLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gua2VlcF9zZWxlY3RlZF9zdHlsZXx8dGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LW5vLWNsaWNrZWRcIiksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3gtc2VsZWN0aW9uXCIpfSx0aGlzKSkub24oXCJsb2FkaW5nLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oKXt0aGlzW3RoaXMuX2RhdGEuY2hlY2tib3gudmlzaWJsZT9cInNob3dfY2hlY2tib3hlc1wiOlwiaGlkZV9jaGVja2JveGVzXCJdKCl9LHRoaXMpKSwtMSE9PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwidW5kZXRlcm1pbmVkXCIpJiZ0aGlzLmVsZW1lbnQub24oXCJjaGFuZ2VkLmpzdHJlZSB1bmNoZWNrX25vZGUuanN0cmVlIGNoZWNrX25vZGUuanN0cmVlIHVuY2hlY2tfYWxsLmpzdHJlZSBjaGVja19hbGwuanN0cmVlIG1vdmVfbm9kZS5qc3RyZWUgY29weV9ub2RlLmpzdHJlZSByZWRyYXcuanN0cmVlIG9wZW5fbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jaGVja2JveC51dG8mJmNsZWFyVGltZW91dCh0aGlzLl9kYXRhLmNoZWNrYm94LnV0byksdGhpcy5fZGF0YS5jaGVja2JveC51dG89c2V0VGltZW91dChlLnByb3h5KHRoaXMuX3VuZGV0ZXJtaW5lZCx0aGlzKSw1MCl9LHRoaXMpKSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb258fHRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt2YXIgaSxyLHM9dGhpcy5fbW9kZWwuZGF0YSxuPShzW3QucGFyZW50XSx0Lm5vZGVzKTtmb3IoaT0wLHI9bi5sZW5ndGg7cj5pO2krKylzW25baV1dLnN0YXRlLmNoZWNrZWQ9c1tuW2ldXS5zdGF0ZS5jaGVja2VkfHxzW25baV1dLm9yaWdpbmFsJiZzW25baV1dLm9yaWdpbmFsLnN0YXRlJiZzW25baV1dLm9yaWdpbmFsLnN0YXRlLmNoZWNrZWQsc1tuW2ldXS5zdGF0ZS5jaGVja2VkJiZ0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnB1c2gobltpXSl9LHRoaXMpKSwoLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVwXCIpfHwtMSE9PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwiZG93blwiKSkmJnRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24odCxpKXt2YXIgcixzLG4sYSxvLGQsYz10aGlzLl9tb2RlbC5kYXRhLGw9Y1tpLnBhcmVudF0saD1pLm5vZGVzLF89W10sdT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUsZz10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoLTEhPT11LmluZGV4T2YoXCJkb3duXCIpKWlmKGwuc3RhdGVbZz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3Iocz0wLG49aC5sZW5ndGg7bj5zO3MrKyljW2hbc11dLnN0YXRlW2c/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMDt0aGlzLl9kYXRhW2c/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD10aGlzLl9kYXRhW2c/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5jb25jYXQoaCl9ZWxzZSBmb3Iocz0wLG49aC5sZW5ndGg7bj5zO3MrKylpZihjW2hbc11dLnN0YXRlW2c/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGE9MCxvPWNbaFtzXV0uY2hpbGRyZW5fZC5sZW5ndGg7bz5hO2ErKyljW2NbaFtzXV0uY2hpbGRyZW5fZFthXV0uc3RhdGVbZz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwO3RoaXMuX2RhdGFbZz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPXRoaXMuX2RhdGFbZz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLmNvbmNhdChjW2hbc11dLmNoaWxkcmVuX2QpfWlmKC0xIT09dS5pbmRleE9mKFwidXBcIikpe2ZvcihzPTAsbj1sLmNoaWxkcmVuX2QubGVuZ3RoO24+cztzKyspY1tsLmNoaWxkcmVuX2Rbc11dLmNoaWxkcmVuLmxlbmd0aHx8Xy5wdXNoKGNbbC5jaGlsZHJlbl9kW3NdXS5wYXJlbnQpO2ZvcihfPWUudmFrYXRhLmFycmF5X3VuaXF1ZShfKSxhPTAsbz1fLmxlbmd0aDtvPmE7YSsrKWZvcihsPWNbX1thXV07bCYmbC5pZCE9PWUuanN0cmVlLnJvb3Q7KXtmb3Iocj0wLHM9MCxuPWwuY2hpbGRyZW4ubGVuZ3RoO24+cztzKyspcis9Y1tsLmNoaWxkcmVuW3NdXS5zdGF0ZVtnP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYociE9PW4pYnJlYWs7bC5zdGF0ZVtnP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVtnP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChsLmlkKSxkPXRoaXMuZ2V0X25vZGUobCwhMCksZCYmZC5sZW5ndGgmJmQuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhnP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGw9dGhpcy5nZXRfbm9kZShsLnBhcmVudCl9fXRoaXMuX2RhdGFbZz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3VuaXF1ZSh0aGlzLl9kYXRhW2c/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJzZWxlY3Rfbm9kZS5qc3RyZWVcIjpcImNoZWNrX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe3ZhciByLHMsbixhLG89aS5ub2RlLGQ9dGhpcy5fbW9kZWwuZGF0YSxjPXRoaXMuZ2V0X25vZGUoby5wYXJlbnQpLGw9dGhpcy5nZXRfbm9kZShvLCEwKSxoPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxfPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjtpZigtMSE9PWguaW5kZXhPZihcImRvd25cIikpZm9yKHRoaXMuX2RhdGFbXz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3VuaXF1ZSh0aGlzLl9kYXRhW18/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5jb25jYXQoby5jaGlsZHJlbl9kKSkscj0wLHM9by5jaGlsZHJlbl9kLmxlbmd0aDtzPnI7cisrKWE9ZFtvLmNoaWxkcmVuX2Rbcl1dLGEuc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLGEmJmEub3JpZ2luYWwmJmEub3JpZ2luYWwuc3RhdGUmJmEub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYoYS5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpO2lmKC0xIT09aC5pbmRleE9mKFwidXBcIikpZm9yKDtjJiZjLmlkIT09ZS5qc3RyZWUucm9vdDspe2ZvcihuPTAscj0wLHM9Yy5jaGlsZHJlbi5sZW5ndGg7cz5yO3IrKyluKz1kW2MuY2hpbGRyZW5bcl1dLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXTtpZihuIT09cylicmVhaztjLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW18/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGMuaWQpLGE9dGhpcy5nZXRfbm9kZShjLCEwKSxhJiZhLmxlbmd0aCYmYS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKF8/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksYz10aGlzLmdldF9ub2RlKGMucGFyZW50KX0tMSE9PWguaW5kZXhPZihcImRvd25cIikmJmwubGVuZ3RoJiZsLmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhfP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApfSx0aGlzKSkub24odGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP1wiZGVzZWxlY3RfYWxsLmpzdHJlZVwiOlwidW5jaGVja19hbGwuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe3ZhciByLHMsbixhPXRoaXMuZ2V0X25vZGUoZS5qc3RyZWUucm9vdCksbz10aGlzLl9tb2RlbC5kYXRhO2ZvcihyPTAscz1hLmNoaWxkcmVuX2QubGVuZ3RoO3M+cjtyKyspbj1vW2EuY2hpbGRyZW5fZFtyXV0sbiYmbi5vcmlnaW5hbCYmbi5vcmlnaW5hbC5zdGF0ZSYmbi5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihuLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJkZXNlbGVjdF9ub2RlLmpzdHJlZVwiOlwidW5jaGVja19ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24odCxpKXt2YXIgcixzLG4sYT1pLm5vZGUsbz10aGlzLmdldF9ub2RlKGEsITApLGQ9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLGM9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uO2lmKGEmJmEub3JpZ2luYWwmJmEub3JpZ2luYWwuc3RhdGUmJmEub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYoYS5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpLC0xIT09ZC5pbmRleE9mKFwiZG93blwiKSlmb3Iocj0wLHM9YS5jaGlsZHJlbl9kLmxlbmd0aDtzPnI7cisrKW49dGhpcy5fbW9kZWwuZGF0YVthLmNoaWxkcmVuX2Rbcl1dLG4uc3RhdGVbYz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSExLG4mJm4ub3JpZ2luYWwmJm4ub3JpZ2luYWwuc3RhdGUmJm4ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYobi5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpO2lmKC0xIT09ZC5pbmRleE9mKFwidXBcIikpZm9yKHI9MCxzPWEucGFyZW50cy5sZW5ndGg7cz5yO3IrKyluPXRoaXMuX21vZGVsLmRhdGFbYS5wYXJlbnRzW3JdXSxuLnN0YXRlW2M/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSxuJiZuLm9yaWdpbmFsJiZuLm9yaWdpbmFsLnN0YXRlJiZuLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKG4ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKSxuPXRoaXMuZ2V0X25vZGUoYS5wYXJlbnRzW3JdLCEwKSxuJiZuLmxlbmd0aCYmbi5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKGM/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIik7Zm9yKG49W10scj0wLHM9dGhpcy5fZGF0YVtjP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQubGVuZ3RoO3M+cjtyKyspLTEhPT1kLmluZGV4T2YoXCJkb3duXCIpJiYtMSE9PWUuaW5BcnJheSh0aGlzLl9kYXRhW2M/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZFtyXSxhLmNoaWxkcmVuX2QpfHwtMSE9PWQuaW5kZXhPZihcInVwXCIpJiYtMSE9PWUuaW5BcnJheSh0aGlzLl9kYXRhW2M/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZFtyXSxhLnBhcmVudHMpfHxuLnB1c2godGhpcy5fZGF0YVtjP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWRbcl0pO3RoaXMuX2RhdGFbYz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWUudmFrYXRhLmFycmF5X3VuaXF1ZShuKSwtMSE9PWQuaW5kZXhPZihcImRvd25cIikmJm8ubGVuZ3RoJiZvLmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhjP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpfSx0aGlzKSksLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVwXCIpJiZ0aGlzLmVsZW1lbnQub24oXCJkZWxldGVfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7Zm9yKHZhciByLHMsbixhLG89dGhpcy5nZXRfbm9kZShpLnBhcmVudCksZD10aGlzLl9tb2RlbC5kYXRhLGM9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uO28mJm8uaWQhPT1lLmpzdHJlZS5yb290JiYhby5zdGF0ZVtjP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07KXtmb3Iobj0wLHI9MCxzPW8uY2hpbGRyZW4ubGVuZ3RoO3M+cjtyKyspbis9ZFtvLmNoaWxkcmVuW3JdXS5zdGF0ZVtjP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoIShzPjAmJm49PT1zKSlicmVhaztvLnN0YXRlW2M/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW2M/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKG8uaWQpLGE9dGhpcy5nZXRfbm9kZShvLCEwKSxhJiZhLmxlbmd0aCYmYS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKGM/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksbz10aGlzLmdldF9ub2RlKG8ucGFyZW50KX19LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7dmFyIHIscyxuLGEsbyxkPWkuaXNfbXVsdGksYz1pLm9sZF9wYXJlbnQsbD10aGlzLmdldF9ub2RlKGkucGFyZW50KSxoPXRoaXMuX21vZGVsLmRhdGEsXz10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoIWQpZm9yKHI9dGhpcy5nZXRfbm9kZShjKTtyJiZyLmlkIT09ZS5qc3RyZWUucm9vdCYmIXIuc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdOyl7Zm9yKHM9MCxuPTAsYT1yLmNoaWxkcmVuLmxlbmd0aDthPm47bisrKXMrPWhbci5jaGlsZHJlbltuXV0uc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKCEoYT4wJiZzPT09YSkpYnJlYWs7ci5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVtfP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChyLmlkKSxvPXRoaXMuZ2V0X25vZGUociwhMCksbyYmby5sZW5ndGgmJm8uYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhfP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLHI9dGhpcy5nZXRfbm9kZShyLnBhcmVudCl9Zm9yKHI9bDtyJiZyLmlkIT09ZS5qc3RyZWUucm9vdDspe2ZvcihzPTAsbj0wLGE9ci5jaGlsZHJlbi5sZW5ndGg7YT5uO24rKylzKz1oW3IuY2hpbGRyZW5bbl1dLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXTtpZihzPT09YSlyLnN0YXRlW18/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXXx8KHIuc3RhdGVbXz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLHRoaXMuX2RhdGFbXz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLnB1c2goci5pZCksbz10aGlzLmdldF9ub2RlKHIsITApLG8mJm8ubGVuZ3RoJiZvLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSk7ZWxzZXtpZighci5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl0pYnJlYWs7ci5zdGF0ZVtfP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITEsdGhpcy5fZGF0YVtfP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9ZS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YVtfP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQsci5pZCksbz10aGlzLmdldF9ub2RlKHIsITApLG8mJm8ubGVuZ3RoJiZvLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKX1yPXRoaXMuZ2V0X25vZGUoci5wYXJlbnQpfX0sdGhpcykpfSx0aGlzLl91bmRldGVybWluZWQ9ZnVuY3Rpb24oKXtpZihudWxsIT09dGhpcy5lbGVtZW50KXt2YXIgaSxyLHMsbixhPXt9LG89dGhpcy5fbW9kZWwuZGF0YSxkPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbixjPXRoaXMuX2RhdGFbZD9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLGw9W10saD10aGlzO2ZvcihpPTAscj1jLmxlbmd0aDtyPmk7aSsrKWlmKG9bY1tpXV0mJm9bY1tpXV0ucGFyZW50cylmb3Iocz0wLG49b1tjW2ldXS5wYXJlbnRzLmxlbmd0aDtuPnM7cysrKWFbb1tjW2ldXS5wYXJlbnRzW3NdXT09PXQmJm9bY1tpXV0ucGFyZW50c1tzXSE9PWUuanN0cmVlLnJvb3QmJihhW29bY1tpXV0ucGFyZW50c1tzXV09ITAsbC5wdXNoKG9bY1tpXV0ucGFyZW50c1tzXSkpO2Zvcih0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtY2xvc2VkXCIpLm5vdChcIjpoYXMoLmpzdHJlZS1jaGlsZHJlbilcIikuZWFjaChmdW5jdGlvbigpe3ZhciBkLGM9aC5nZXRfbm9kZSh0aGlzKTtpZihjLnN0YXRlLmxvYWRlZCl7Zm9yKGk9MCxyPWMuY2hpbGRyZW5fZC5sZW5ndGg7cj5pO2krKylpZihkPW9bYy5jaGlsZHJlbl9kW2ldXSwhZC5zdGF0ZS5sb2FkZWQmJmQub3JpZ2luYWwmJmQub3JpZ2luYWwuc3RhdGUmJmQub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiZkLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD09PSEwKWZvcihhW2QuaWRdPT09dCYmZC5pZCE9PWUuanN0cmVlLnJvb3QmJihhW2QuaWRdPSEwLGwucHVzaChkLmlkKSkscz0wLG49ZC5wYXJlbnRzLmxlbmd0aDtuPnM7cysrKWFbZC5wYXJlbnRzW3NdXT09PXQmJmQucGFyZW50c1tzXSE9PWUuanN0cmVlLnJvb3QmJihhW2QucGFyZW50c1tzXV09ITAsbC5wdXNoKGQucGFyZW50c1tzXSkpfWVsc2UgaWYoYy5vcmlnaW5hbCYmYy5vcmlnaW5hbC5zdGF0ZSYmYy5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJmMub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPT09ITApZm9yKGFbYy5pZF09PT10JiZjLmlkIT09ZS5qc3RyZWUucm9vdCYmKGFbYy5pZF09ITAsbC5wdXNoKGMuaWQpKSxzPTAsbj1jLnBhcmVudHMubGVuZ3RoO24+cztzKyspYVtjLnBhcmVudHNbc11dPT09dCYmYy5wYXJlbnRzW3NdIT09ZS5qc3RyZWUucm9vdCYmKGFbYy5wYXJlbnRzW3NdXT0hMCxsLnB1c2goYy5wYXJlbnRzW3NdKSl9KSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtdW5kZXRlcm1pbmVkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXVuZGV0ZXJtaW5lZFwiKSxpPTAscj1sLmxlbmd0aDtyPmk7aSsrKW9bbFtpXV0uc3RhdGVbZD9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdfHwoYz10aGlzLmdldF9ub2RlKGxbaV0sITApLGMmJmMubGVuZ3RoJiZjLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLmFkZENsYXNzKFwianN0cmVlLXVuZGV0ZXJtaW5lZFwiKSl9fSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKHQsaSxzLG4pe2lmKHQ9ci5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cykpe3ZhciBhLG8sZD1udWxsLGM9bnVsbDtmb3IoYT0wLG89dC5jaGlsZE5vZGVzLmxlbmd0aDtvPmE7YSsrKWlmKHQuY2hpbGROb2Rlc1thXSYmdC5jaGlsZE5vZGVzW2FdLmNsYXNzTmFtZSYmLTEhPT10LmNoaWxkTm9kZXNbYV0uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtYW5jaG9yXCIpKXtkPXQuY2hpbGROb2Rlc1thXTticmVha31kJiYoIXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmdGhpcy5fbW9kZWwuZGF0YVt0LmlkXS5zdGF0ZS5jaGVja2VkJiYoZC5jbGFzc05hbWUrPVwiIGpzdHJlZS1jaGVja2VkXCIpLGM9Xy5jbG9uZU5vZGUoITEpLHRoaXMuX21vZGVsLmRhdGFbdC5pZF0uc3RhdGUuY2hlY2tib3hfZGlzYWJsZWQmJihjLmNsYXNzTmFtZSs9XCIganN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLGQuaW5zZXJ0QmVmb3JlKGMsZC5jaGlsZE5vZGVzWzBdKSl9cmV0dXJuIHN8fC0xPT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1bmRldGVybWluZWRcIil8fCh0aGlzLl9kYXRhLmNoZWNrYm94LnV0byYmY2xlYXJUaW1lb3V0KHRoaXMuX2RhdGEuY2hlY2tib3gudXRvKSx0aGlzLl9kYXRhLmNoZWNrYm94LnV0bz1zZXRUaW1lb3V0KGUucHJveHkodGhpcy5fdW5kZXRlcm1pbmVkLHRoaXMpLDUwKSksdH0sdGhpcy5zaG93X2NoZWNrYm94ZXM9ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmNoZWNrYm94ZXM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbm8tY2hlY2tib3hlc1wiKX0sdGhpcy5oaWRlX2NoZWNrYm94ZXM9ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmNoZWNrYm94ZXM9ITEsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkuYWRkQ2xhc3MoXCJqc3RyZWUtbm8tY2hlY2tib3hlc1wiKX0sdGhpcy50b2dnbGVfY2hlY2tib3hlcz1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuY2hlY2tib3hlcz90aGlzLmhpZGVfY2hlY2tib3hlcygpOnRoaXMuc2hvd19jaGVja2JveGVzKCl9LHRoaXMuaXNfdW5kZXRlcm1pbmVkPWZ1bmN0aW9uKHQpe3Q9dGhpcy5nZXRfbm9kZSh0KTt2YXIgaSxyLHM9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLG49dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLGE9dGhpcy5fZGF0YVtuP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQsbz10aGlzLl9tb2RlbC5kYXRhO2lmKCF0fHx0LnN0YXRlW24/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT09PSEwfHwtMT09PXMuaW5kZXhPZihcInVuZGV0ZXJtaW5lZFwiKXx8LTE9PT1zLmluZGV4T2YoXCJkb3duXCIpJiYtMT09PXMuaW5kZXhPZihcInVwXCIpKXJldHVybiExO2lmKCF0LnN0YXRlLmxvYWRlZCYmdC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9PT0hMClyZXR1cm4hMDtmb3IoaT0wLHI9dC5jaGlsZHJlbl9kLmxlbmd0aDtyPmk7aSsrKWlmKC0xIT09ZS5pbkFycmF5KHQuY2hpbGRyZW5fZFtpXSxhKXx8IW9bdC5jaGlsZHJlbl9kW2ldXS5zdGF0ZS5sb2FkZWQmJm9bdC5jaGlsZHJlbl9kW2ldXS5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQpcmV0dXJuITA7cmV0dXJuITF9LHRoaXMuZGlzYWJsZV9jaGVja2JveD1mdW5jdGlvbih0KXt2YXIgaSxyLHM7aWYoZS5pc0FycmF5KHQpKXtmb3IodD10LnNsaWNlKCksaT0wLHI9dC5sZW5ndGg7cj5pO2krKyl0aGlzLmRpc2FibGVfY2hlY2tib3godFtpXSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8ocz10aGlzLmdldF9ub2RlKHQsITApLHZvaWQodC5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZHx8KHQuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWQ9ITAscyYmcy5sZW5ndGgmJnMuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hlY2tib3hcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3gtZGlzYWJsZWRcIiksdGhpcy50cmlnZ2VyKFwiZGlzYWJsZV9jaGVja2JveFwiLHtub2RlOnR9KSkpKTohMX0sdGhpcy5lbmFibGVfY2hlY2tib3g9ZnVuY3Rpb24odCl7dmFyIGkscixzO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLGk9MCxyPXQubGVuZ3RoO3I+aTtpKyspdGhpcy5lbmFibGVfY2hlY2tib3godFtpXSk7cmV0dXJuITB9cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0JiZ0LmlkIT09ZS5qc3RyZWUucm9vdD8ocz10aGlzLmdldF9ub2RlKHQsITApLHZvaWQodC5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZCYmKHQuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWQ9ITEscyYmcy5sZW5ndGgmJnMuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hlY2tib3hcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3gtZGlzYWJsZWRcIiksdGhpcy50cmlnZ2VyKFwiZW5hYmxlX2NoZWNrYm94XCIse25vZGU6dH0pKSkpOiExfSx0aGlzLmFjdGl2YXRlX25vZGU9ZnVuY3Rpb24odCxpKXtyZXR1cm4gZShpLnRhcmdldCkuaGFzQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3gtZGlzYWJsZWRcIik/ITE6KHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gud2hvbGVfbm9kZXx8ZShpLnRhcmdldCkuaGFzQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3hcIikpJiYoaS5jdHJsS2V5PSEwKSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb258fCF0aGlzLnNldHRpbmdzLmNoZWNrYm94Lndob2xlX25vZGUmJiFlKGkudGFyZ2V0KS5oYXNDbGFzcyhcImpzdHJlZS1jaGVja2JveFwiKT9yLmFjdGl2YXRlX25vZGUuY2FsbCh0aGlzLHQsaSk6dGhpcy5pc19kaXNhYmxlZCh0KT8hMToodGhpcy5pc19jaGVja2VkKHQpP3RoaXMudW5jaGVja19ub2RlKHQsaSk6dGhpcy5jaGVja19ub2RlKHQsaSksdm9pZCB0aGlzLnRyaWdnZXIoXCJhY3RpdmF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZSh0KX0pKSl9LHRoaXMuY2hlY2tfbm9kZT1mdW5jdGlvbih0LGkpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5zZWxlY3Rfbm9kZSh0LCExLCEwLGkpO3ZhciByLHMsbjtpZihlLmlzQXJyYXkodCkpe2Zvcih0PXQuc2xpY2UoKSxzPTAsbj10Lmxlbmd0aDtuPnM7cysrKXRoaXMuY2hlY2tfbm9kZSh0W3NdLGkpO3JldHVybiEwfXJldHVybiB0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5pZCE9PWUuanN0cmVlLnJvb3Q/KHI9dGhpcy5nZXRfbm9kZSh0LCEwKSx2b2lkKHQuc3RhdGUuY2hlY2tlZHx8KHQuc3RhdGUuY2hlY2tlZD0hMCx0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnB1c2godC5pZCksciYmci5sZW5ndGgmJnIuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2VkXCIpLHRoaXMudHJpZ2dlcihcImNoZWNrX25vZGVcIix7bm9kZTp0LHNlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZXZlbnQ6aX0pKSkpOiExfSx0aGlzLnVuY2hlY2tfbm9kZT1mdW5jdGlvbih0LGkpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5kZXNlbGVjdF9ub2RlKHQsITEsaSk7dmFyIHIscyxuO2lmKGUuaXNBcnJheSh0KSl7Zm9yKHQ9dC5zbGljZSgpLHI9MCxzPXQubGVuZ3RoO3M+cjtyKyspdGhpcy51bmNoZWNrX25vZGUodFtyXSxpKTtyZXR1cm4hMH1yZXR1cm4gdD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290PyhuPXRoaXMuZ2V0X25vZGUodCwhMCksdm9pZCh0LnN0YXRlLmNoZWNrZWQmJih0LnN0YXRlLmNoZWNrZWQ9ITEsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1lLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLHQuaWQpLG4ubGVuZ3RoJiZuLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJ1bmNoZWNrX25vZGVcIix7bm9kZTp0LHNlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZXZlbnQ6aX0pKSkpOiExfSx0aGlzLmNoZWNrX2FsbD1mdW5jdGlvbigpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5zZWxlY3RfYWxsKCk7dmFyIHQsaTt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmNvbmNhdChbXSk7Zm9yKHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9dGhpcy5fbW9kZWwuZGF0YVtlLmpzdHJlZS5yb290XS5jaGlsZHJlbl9kLmNvbmNhdCgpLHQ9MCxpPXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQubGVuZ3RoO2k+dDt0KyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW3RdXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFt0XV0uc3RhdGUuY2hlY2tlZD0hMCk7dGhpcy5yZWRyYXcoITApLHRoaXMudHJpZ2dlcihcImNoZWNrX2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkfSl9LHRoaXMudW5jaGVja19hbGw9ZnVuY3Rpb24oKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZGVzZWxlY3RfYWxsKCk7dmFyIGUsdCxpPXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQuY29uY2F0KFtdKTtmb3IoZT0wLHQ9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5sZW5ndGg7dD5lO2UrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbZV1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2VdXS5zdGF0ZS5jaGVja2VkPSExKTt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1jaGVja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrZWRcIiksdGhpcy50cmlnZ2VyKFwidW5jaGVja19hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxub2RlOml9KX0sdGhpcy5pc19jaGVja2VkPWZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/dGhpcy5pc19zZWxlY3RlZCh0KToodD10aGlzLmdldF9ub2RlKHQpLHQmJnQuaWQhPT1lLmpzdHJlZS5yb290P3Quc3RhdGUuY2hlY2tlZDohMSl9LHRoaXMuZ2V0X2NoZWNrZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj90aGlzLmdldF9zZWxlY3RlZCh0KTp0P2UubWFwKHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZS5wcm94eShmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShlKX0sdGhpcykpOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWR9LHRoaXMuZ2V0X3RvcF9jaGVja2VkPWZ1bmN0aW9uKHQpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5nZXRfdG9wX3NlbGVjdGVkKHQpO3ZhciBpLHIscyxuLGE9dGhpcy5nZXRfY2hlY2tlZCghMCksbz17fTtmb3IoaT0wLHI9YS5sZW5ndGg7cj5pO2krKylvW2FbaV0uaWRdPWFbaV07Zm9yKGk9MCxyPWEubGVuZ3RoO3I+aTtpKyspZm9yKHM9MCxuPWFbaV0uY2hpbGRyZW5fZC5sZW5ndGg7bj5zO3MrKylvW2FbaV0uY2hpbGRyZW5fZFtzXV0mJmRlbGV0ZSBvW2FbaV0uY2hpbGRyZW5fZFtzXV07YT1bXTtmb3IoaSBpbiBvKW8uaGFzT3duUHJvcGVydHkoaSkmJmEucHVzaChpKTtyZXR1cm4gdD9lLm1hcChhLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoZSl9LHRoaXMpKTphfSx0aGlzLmdldF9ib3R0b21fY2hlY2tlZD1mdW5jdGlvbih0KXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZ2V0X2JvdHRvbV9zZWxlY3RlZCh0KTt2YXIgaSxyLHM9dGhpcy5nZXRfY2hlY2tlZCghMCksbj1bXTtmb3IoaT0wLHI9cy5sZW5ndGg7cj5pO2krKylzW2ldLmNoaWxkcmVuLmxlbmd0aHx8bi5wdXNoKHNbaV0uaWQpO3JldHVybiB0P2UubWFwKG4sZS5wcm94eShmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShlKX0sdGhpcykpOm59LHRoaXMubG9hZF9ub2RlPWZ1bmN0aW9uKHQsaSl7dmFyIHMsbixhLG87aWYoIWUuaXNBcnJheSh0KSYmIXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmKG89dGhpcy5nZXRfbm9kZSh0KSxvJiZvLnN0YXRlLmxvYWRlZCkpZm9yKHM9MCxuPW8uY2hpbGRyZW5fZC5sZW5ndGg7bj5zO3MrKyl0aGlzLl9tb2RlbC5kYXRhW28uY2hpbGRyZW5fZFtzXV0uc3RhdGUuY2hlY2tlZCYmKGE9ITAsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1lLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLG8uY2hpbGRyZW5fZFtzXSkpO3JldHVybiByLmxvYWRfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHRoaXMuZ2V0X3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGU9ci5nZXRfc3RhdGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/ZTooZS5jaGVja2JveD10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnNsaWNlKCksZSl9LHRoaXMuc2V0X3N0YXRlPWZ1bmN0aW9uKHQsaSl7dmFyIHM9ci5zZXRfc3RhdGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKHMmJnQuY2hlY2tib3gpe2lmKCF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pe3RoaXMudW5jaGVja19hbGwoKTt2YXIgbj10aGlzO2UuZWFjaCh0LmNoZWNrYm94LGZ1bmN0aW9uKGUsdCl7bi5jaGVja19ub2RlKHQpfSl9cmV0dXJuIGRlbGV0ZSB0LmNoZWNrYm94LHRoaXMuc2V0X3N0YXRlKHQsaSksITF9cmV0dXJuIHN9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb258fCh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdKSxyLnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpfX0sZS5qc3RyZWUuZGVmYXVsdHMuY29uZGl0aW9uYWxzZWxlY3Q9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sZS5qc3RyZWUucGx1Z2lucy5jb25kaXRpb25hbHNlbGVjdD1mdW5jdGlvbihlLHQpe3RoaXMuYWN0aXZhdGVfbm9kZT1mdW5jdGlvbihlLGkpe3RoaXMuc2V0dGluZ3MuY29uZGl0aW9uYWxzZWxlY3QuY2FsbCh0aGlzLHRoaXMuZ2V0X25vZGUoZSksaSkmJnQuYWN0aXZhdGVfbm9kZS5jYWxsKHRoaXMsZSxpKX19LGUuanN0cmVlLmRlZmF1bHRzLmNvbnRleHRtZW51PXtzZWxlY3Rfbm9kZTohMCxzaG93X2F0X25vZGU6ITAsaXRlbXM6ZnVuY3Rpb24odCxpKXtyZXR1cm57Y3JlYXRlOntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMCxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJDcmVhdGVcIixhY3Rpb246ZnVuY3Rpb24odCl7dmFyIGk9ZS5qc3RyZWUucmVmZXJlbmNlKHQucmVmZXJlbmNlKSxyPWkuZ2V0X25vZGUodC5yZWZlcmVuY2UpO2kuY3JlYXRlX25vZGUocix7fSxcImxhc3RcIixmdW5jdGlvbihlKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7aS5lZGl0KGUpfSwwKX0pfX0scmVuYW1lOntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMSxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJSZW5hbWVcIixhY3Rpb246ZnVuY3Rpb24odCl7dmFyIGk9ZS5qc3RyZWUucmVmZXJlbmNlKHQucmVmZXJlbmNlKSxyPWkuZ2V0X25vZGUodC5yZWZlcmVuY2UpO2kuZWRpdChyKX19LHJlbW92ZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxpY29uOiExLHNlcGFyYXRvcl9hZnRlcjohMSxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJEZWxldGVcIixhY3Rpb246ZnVuY3Rpb24odCl7dmFyIGk9ZS5qc3RyZWUucmVmZXJlbmNlKHQucmVmZXJlbmNlKSxyPWkuZ2V0X25vZGUodC5yZWZlcmVuY2UpO2kuaXNfc2VsZWN0ZWQocik/aS5kZWxldGVfbm9kZShpLmdldF9zZWxlY3RlZCgpKTppLmRlbGV0ZV9ub2RlKHIpfX0sY2NwOntzZXBhcmF0b3JfYmVmb3JlOiEwLGljb246ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiRWRpdFwiLGFjdGlvbjohMSxzdWJtZW51OntjdXQ6e3NlcGFyYXRvcl9iZWZvcmU6ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiQ3V0XCIsYWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkscj1pLmdldF9ub2RlKHQucmVmZXJlbmNlKTtpLmlzX3NlbGVjdGVkKHIpP2kuY3V0KGkuZ2V0X3RvcF9zZWxlY3RlZCgpKTppLmN1dChyKX19LGNvcHk6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsbGFiZWw6XCJDb3B5XCIsYWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkscj1pLmdldF9ub2RlKHQucmVmZXJlbmNlKTtpLmlzX3NlbGVjdGVkKHIpP2kuY29weShpLmdldF90b3Bfc2VsZWN0ZWQoKSk6aS5jb3B5KHIpfX0scGFzdGU6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxfZGlzYWJsZWQ6ZnVuY3Rpb24odCl7cmV0dXJuIWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkuY2FuX3Bhc3RlKCl9LHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIlBhc3RlXCIsYWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPWUuanN0cmVlLnJlZmVyZW5jZSh0LnJlZmVyZW5jZSkscj1pLmdldF9ub2RlKHQucmVmZXJlbmNlKTtpLnBhc3RlKHIpfX19fX19fSxlLmpzdHJlZS5wbHVnaW5zLmNvbnRleHRtZW51PWZ1bmN0aW9uKGkscil7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ci5iaW5kLmNhbGwodGhpcyk7dmFyIHQsaSxzPTAsbj1udWxsO3RoaXMuZWxlbWVudC5vbihcImNvbnRleHRtZW51LmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7ZS5wcmV2ZW50RGVmYXVsdCgpLHM9ZS5jdHJsS2V5PytuZXcgRGF0ZTowLCh0fHxuKSYmKHM9K25ldyBEYXRlKzFlNCksbiYmY2xlYXJUaW1lb3V0KG4pLHRoaXMuaXNfbG9hZGluZyhlLmN1cnJlbnRUYXJnZXQpfHx0aGlzLnNob3dfY29udGV4dG1lbnUoZS5jdXJyZW50VGFyZ2V0LGUucGFnZVgsZS5wYWdlWSxlKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24odCl7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlJiYoIXN8fCtuZXcgRGF0ZS1zPjI1MCkmJmUudmFrYXRhLmNvbnRleHQuaGlkZSgpLHM9MH0sdGhpcykpLm9uKFwidG91Y2hzdGFydC5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZnVuY3Rpb24ocil7ci5vcmlnaW5hbEV2ZW50JiZyLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJnIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKHQ9ci5wYWdlWCxpPXIucGFnZVksbj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZShyLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoXCJjb250ZXh0bWVudVwiLCEwKX0sNzUwKSl9KS5vbihcInRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oZSl7biYmZS5vcmlnaW5hbEV2ZW50JiZlLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmUub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKE1hdGguYWJzKHQtZS5wYWdlWCk+NTB8fE1hdGguYWJzKGktZS5wYWdlWSk+NTApJiZjbGVhclRpbWVvdXQobil9KS5vbihcInRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihlKXtuJiZjbGVhclRpbWVvdXQobil9KSxlKGwpLm9uKFwiY29udGV4dF9oaWRlLnZha2F0YS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlPSExfSx0aGlzKSl9LHRoaXMudGVhcmRvd249ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvbnRleHRtZW51LnZpc2libGUmJmUudmFrYXRhLmNvbnRleHQuaGlkZSgpLHIudGVhcmRvd24uY2FsbCh0aGlzKX0sdGhpcy5zaG93X2NvbnRleHRtZW51PWZ1bmN0aW9uKGkscixzLG4pe2lmKGk9dGhpcy5nZXRfbm9kZShpKSwhaXx8aS5pZD09PWUuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGE9dGhpcy5zZXR0aW5ncy5jb250ZXh0bWVudSxvPXRoaXMuZ2V0X25vZGUoaSwhMCksZD1vLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIiksYz0hMSxsPSExOyhhLnNob3dfYXRfbm9kZXx8cj09PXR8fHM9PT10KSYmKGM9ZC5vZmZzZXQoKSxyPWMubGVmdCxzPWMudG9wK3RoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpLHRoaXMuc2V0dGluZ3MuY29udGV4dG1lbnUuc2VsZWN0X25vZGUmJiF0aGlzLmlzX3NlbGVjdGVkKGkpJiZ0aGlzLmFjdGl2YXRlX25vZGUoaSxuKSxsPWEuaXRlbXMsZS5pc0Z1bmN0aW9uKGwpJiYobD1sLmNhbGwodGhpcyxpLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy5fc2hvd19jb250ZXh0bWVudShpLHIscyxlKX0sdGhpcykpKSxlLmlzUGxhaW5PYmplY3QobCkmJnRoaXMuX3Nob3dfY29udGV4dG1lbnUoaSxyLHMsbCl9LHRoaXMuX3Nob3dfY29udGV4dG1lbnU9ZnVuY3Rpb24odCxpLHIscyl7dmFyIG49dGhpcy5nZXRfbm9kZSh0LCEwKSxhPW4uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKTtlKGwpLm9uZShcImNvbnRleHRfc2hvdy52YWthdGEuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe3ZhciByPVwianN0cmVlLWNvbnRleHRtZW51IGpzdHJlZS1cIit0aGlzLmdldF90aGVtZSgpK1wiLWNvbnRleHRtZW51XCI7ZShpLmVsZW1lbnQpLmFkZENsYXNzKHIpfSx0aGlzKSksdGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlPSEwLGUudmFrYXRhLmNvbnRleHQuc2hvdyhhLHt4OmkseTpyfSxzKSx0aGlzLnRyaWdnZXIoXCJzaG93X2NvbnRleHRtZW51XCIse25vZGU6dCx4OmkseTpyfSl9fSxmdW5jdGlvbihlKXt2YXIgdD0hMSxpPXtlbGVtZW50OiExLHJlZmVyZW5jZTohMSxwb3NpdGlvbl94OjAscG9zaXRpb25feTowLGl0ZW1zOltdLGh0bWw6XCJcIixpc192aXNpYmxlOiExfTtlLnZha2F0YS5jb250ZXh0PXtzZXR0aW5nczp7aGlkZV9vbm1vdXNlbGVhdmU6MCxpY29uczohMH0sX3RyaWdnZXI6ZnVuY3Rpb24odCl7ZShsKS50cmlnZ2VySGFuZGxlcihcImNvbnRleHRfXCIrdCtcIi52YWthdGFcIix7cmVmZXJlbmNlOmkucmVmZXJlbmNlLGVsZW1lbnQ6aS5lbGVtZW50LHBvc2l0aW9uOnt4OmkucG9zaXRpb25feCx5OmkucG9zaXRpb25feX19KX0sX2V4ZWN1dGU6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9aS5pdGVtc1t0XSx0JiYoIXQuX2Rpc2FibGVkfHxlLmlzRnVuY3Rpb24odC5fZGlzYWJsZWQpJiYhdC5fZGlzYWJsZWQoe2l0ZW06dCxyZWZlcmVuY2U6aS5yZWZlcmVuY2UsZWxlbWVudDppLmVsZW1lbnR9KSkmJnQuYWN0aW9uP3QuYWN0aW9uLmNhbGwobnVsbCx7aXRlbTp0LHJlZmVyZW5jZTppLnJlZmVyZW5jZSxlbGVtZW50OmkuZWxlbWVudCxwb3NpdGlvbjp7eDppLnBvc2l0aW9uX3gseTppLnBvc2l0aW9uX3l9fSk6ITF9LF9wYXJzZTpmdW5jdGlvbih0LHIpe2lmKCF0KXJldHVybiExO3J8fChpLmh0bWw9XCJcIixpLml0ZW1zPVtdKTt2YXIgcyxuPVwiXCIsYT0hMTtyZXR1cm4gciYmKG4rPVwiPHVsPlwiKSxlLmVhY2godCxmdW5jdGlvbih0LHIpe3JldHVybiByPyhpLml0ZW1zLnB1c2gociksIWEmJnIuc2VwYXJhdG9yX2JlZm9yZSYmKG4rPVwiPGxpIGNsYXNzPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InPjxhIGhyZWY9JyMnIFwiKyhlLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zP1wiXCI6J3N0eWxlPVwibWFyZ2luLWxlZnQ6MHB4O1wiJykrXCI+JiMxNjA7PC9hPjwvbGk+XCIpLGE9ITEsbis9XCI8bGkgY2xhc3M9J1wiKyhyLl9jbGFzc3x8XCJcIikrKHIuX2Rpc2FibGVkPT09ITB8fGUuaXNGdW5jdGlvbihyLl9kaXNhYmxlZCkmJnIuX2Rpc2FibGVkKHtpdGVtOnIscmVmZXJlbmNlOmkucmVmZXJlbmNlLGVsZW1lbnQ6aS5lbGVtZW50fSk/XCIgdmFrYXRhLWNvbnRleHRtZW51LWRpc2FibGVkIFwiOlwiXCIpK1wiJyBcIisoci5zaG9ydGN1dD9cIiBkYXRhLXNob3J0Y3V0PSdcIityLnNob3J0Y3V0K1wiJyBcIjpcIlwiKStcIj5cIixuKz1cIjxhIGhyZWY9JyMnIHJlbD0nXCIrKGkuaXRlbXMubGVuZ3RoLTEpK1wiJz5cIixlLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zJiYobis9XCI8aSBcIixyLmljb24mJihuKz0tMSE9PXIuaWNvbi5pbmRleE9mKFwiL1wiKXx8LTEhPT1yLmljb24uaW5kZXhPZihcIi5cIik/XCIgc3R5bGU9J2JhY2tncm91bmQ6dXJsKFxcXCJcIityLmljb24rXCJcXFwiKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdCcgXCI6XCIgY2xhc3M9J1wiK3IuaWNvbitcIicgXCIpLG4rPVwiPjwvaT48c3BhbiBjbGFzcz0ndmFrYXRhLWNvbnRleHRtZW51LXNlcCc+JiMxNjA7PC9zcGFuPlwiKSxuKz0oZS5pc0Z1bmN0aW9uKHIubGFiZWwpP3IubGFiZWwoe2l0ZW06dCxyZWZlcmVuY2U6aS5yZWZlcmVuY2UsZWxlbWVudDppLmVsZW1lbnR9KTpyLmxhYmVsKSsoci5zaG9ydGN1dD8nIDxzcGFuIGNsYXNzPVwidmFrYXRhLWNvbnRleHRtZW51LXNob3J0Y3V0IHZha2F0YS1jb250ZXh0bWVudS1zaG9ydGN1dC0nK3Iuc2hvcnRjdXQrJ1wiPicrKHIuc2hvcnRjdXRfbGFiZWx8fFwiXCIpK1wiPC9zcGFuPlwiOlwiXCIpK1wiPC9hPlwiLHIuc3VibWVudSYmKHM9ZS52YWthdGEuY29udGV4dC5fcGFyc2Uoci5zdWJtZW51LCEwKSxzJiYobis9cykpLG4rPVwiPC9saT5cIix2b2lkKHIuc2VwYXJhdG9yX2FmdGVyJiYobis9XCI8bGkgY2xhc3M9J3Zha2F0YS1jb250ZXh0LXNlcGFyYXRvcic+PGEgaHJlZj0nIycgXCIrKGUudmFrYXRhLmNvbnRleHQuc2V0dGluZ3MuaWNvbnM/XCJcIjonc3R5bGU9XCJtYXJnaW4tbGVmdDowcHg7XCInKStcIj4mIzE2MDs8L2E+PC9saT5cIixhPSEwKSkpOiEwfSksbj1uLnJlcGxhY2UoLzxsaSBjbGFzc1xcPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InXFw+PFxcL2xpXFw+JC8sXCJcIiksciYmKG4rPVwiPC91bD5cIikscnx8KGkuaHRtbD1uLGUudmFrYXRhLmNvbnRleHQuX3RyaWdnZXIoXCJwYXJzZVwiKSksbi5sZW5ndGg+MTA/bjohMX0sX3Nob3dfc3VibWVudTpmdW5jdGlvbihpKXtpZihpPWUoaSksaS5sZW5ndGgmJmkuY2hpbGRyZW4oXCJ1bFwiKS5sZW5ndGgpe3ZhciByPWkuY2hpbGRyZW4oXCJ1bFwiKSxzPWkub2Zmc2V0KCkubGVmdCtpLm91dGVyV2lkdGgoKSxuPWkub2Zmc2V0KCkudG9wLGE9ci53aWR0aCgpLG89ci5oZWlnaHQoKSxkPWUod2luZG93KS53aWR0aCgpK2Uod2luZG93KS5zY3JvbGxMZWZ0KCksYz1lKHdpbmRvdykuaGVpZ2h0KCkrZSh3aW5kb3cpLnNjcm9sbFRvcCgpO3Q/aVtzLShhKzEwK2kub3V0ZXJXaWR0aCgpKTwwP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidmFrYXRhLWNvbnRleHQtbGVmdFwiKTppW3MrYSsxMD5kP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidmFrYXRhLWNvbnRleHQtcmlnaHRcIiksbitvKzEwPmMmJnIuY3NzKFwiYm90dG9tXCIsXCItMXB4XCIpLHIuc2hvdygpfX0sc2hvdzpmdW5jdGlvbihyLHMsbil7dmFyIGEsbyxkLGMsbCxoLF8sdSxnPSEwO3N3aXRjaChpLmVsZW1lbnQmJmkuZWxlbWVudC5sZW5ndGgmJmkuZWxlbWVudC53aWR0aChcIlwiKSxnKXtjYXNlIXMmJiFyOnJldHVybiExO2Nhc2UhIXMmJiEhcjppLnJlZmVyZW5jZT1yLGkucG9zaXRpb25feD1zLngsaS5wb3NpdGlvbl95PXMueTticmVhaztjYXNlIXMmJiEhcjppLnJlZmVyZW5jZT1yLGE9ci5vZmZzZXQoKSxpLnBvc2l0aW9uX3g9YS5sZWZ0K3Iub3V0ZXJIZWlnaHQoKSxpLnBvc2l0aW9uX3k9YS50b3A7YnJlYWs7Y2FzZSEhcyYmIXI6aS5wb3NpdGlvbl94PXMueCxpLnBvc2l0aW9uX3k9cy55fXImJiFuJiZlKHIpLmRhdGEoXCJ2YWthdGFfY29udGV4dG1lbnVcIikmJihuPWUocikuZGF0YShcInZha2F0YV9jb250ZXh0bWVudVwiKSksZS52YWthdGEuY29udGV4dC5fcGFyc2UobikmJmkuZWxlbWVudC5odG1sKGkuaHRtbCksaS5pdGVtcy5sZW5ndGgmJihpLmVsZW1lbnQuYXBwZW5kVG8oXCJib2R5XCIpLG89aS5lbGVtZW50LGQ9aS5wb3NpdGlvbl94LGM9aS5wb3NpdGlvbl95LGw9by53aWR0aCgpLGg9by5oZWlnaHQoKSxfPWUod2luZG93KS53aWR0aCgpK2Uod2luZG93KS5zY3JvbGxMZWZ0KCksdT1lKHdpbmRvdykuaGVpZ2h0KCkrZSh3aW5kb3cpLnNjcm9sbFRvcCgpLHQmJihkLT1vLm91dGVyV2lkdGgoKS1lKHIpLm91dGVyV2lkdGgoKSxkPGUod2luZG93KS5zY3JvbGxMZWZ0KCkrMjAmJihkPWUod2luZG93KS5zY3JvbGxMZWZ0KCkrMjApKSxkK2wrMjA+XyYmKGQ9Xy0obCsyMCkpLGMraCsyMD51JiYoYz11LShoKzIwKSksaS5lbGVtZW50LmNzcyh7bGVmdDpkLHRvcDpjfSkuc2hvdygpLmZpbmQoXCJhXCIpLmZpcnN0KCkuZm9jdXMoKS5wYXJlbnQoKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGkuaXNfdmlzaWJsZT0hMCxlLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwic2hvd1wiKSl9LGhpZGU6ZnVuY3Rpb24oKXtpLmlzX3Zpc2libGUmJihpLmVsZW1lbnQuaGlkZSgpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCkuZmluZChcIjpmb2N1c1wiKS5ibHVyKCkuZW5kKCkuZGV0YWNoKCksaS5pc192aXNpYmxlPSExLGUudmFrYXRhLmNvbnRleHQuX3RyaWdnZXIoXCJoaWRlXCIpKX19LGUoZnVuY3Rpb24oKXt0PVwicnRsXCI9PT1lKFwiYm9keVwiKS5jc3MoXCJkaXJlY3Rpb25cIik7dmFyIHI9ITE7aS5lbGVtZW50PWUoXCI8dWwgY2xhc3M9J3Zha2F0YS1jb250ZXh0Jz48L3VsPlwiKSxpLmVsZW1lbnQub24oXCJtb3VzZWVudGVyXCIsXCJsaVwiLGZ1bmN0aW9uKHQpe3Quc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksZS5jb250YWlucyh0aGlzLHQucmVsYXRlZFRhcmdldCl8fChyJiZjbGVhclRpbWVvdXQociksaS5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5lbmQoKSxlKHRoaXMpLnNpYmxpbmdzKCkuZmluZChcInVsXCIpLmhpZGUoKS5lbmQoKS5lbmQoKS5wYXJlbnRzVW50aWwoXCIudmFrYXRhLWNvbnRleHRcIixcImxpXCIpLmFkZEJhY2soKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGUudmFrYXRhLmNvbnRleHQuX3Nob3dfc3VibWVudSh0aGlzKSl9KS5vbihcIm1vdXNlbGVhdmVcIixcImxpXCIsZnVuY3Rpb24odCl7ZS5jb250YWlucyh0aGlzLHQucmVsYXRlZFRhcmdldCl8fGUodGhpcykuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5hZGRCYWNrKCkucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKX0pLm9uKFwibW91c2VsZWF2ZVwiLGZ1bmN0aW9uKHQpe2UodGhpcykuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGUudmFrYXRhLmNvbnRleHQuc2V0dGluZ3MuaGlkZV9vbm1vdXNlbGVhdmUmJihyPXNldFRpbWVvdXQoZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7ZS52YWthdGEuY29udGV4dC5oaWRlKCl9fSh0aGlzKSxlLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmhpZGVfb25tb3VzZWxlYXZlKSl9KS5vbihcImNsaWNrXCIsXCJhXCIsZnVuY3Rpb24odCl7dC5wcmV2ZW50RGVmYXVsdCgpLGUodGhpcykuYmx1cigpLnBhcmVudCgpLmhhc0NsYXNzKFwidmFrYXRhLWNvbnRleHQtZGlzYWJsZWRcIil8fGUudmFrYXRhLmNvbnRleHQuX2V4ZWN1dGUoZSh0aGlzKS5hdHRyKFwicmVsXCIpKT09PSExfHxlLnZha2F0YS5jb250ZXh0LmhpZGUoKX0pLm9uKFwia2V5ZG93blwiLFwiYVwiLGZ1bmN0aW9uKHQpe3ZhciByPW51bGw7c3dpdGNoKHQud2hpY2gpe2Nhc2UgMTM6Y2FzZSAzMjp0LnR5cGU9XCJtb3VzZXVwXCIsdC5wcmV2ZW50RGVmYXVsdCgpLGUodC5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKHQpO2JyZWFrO2Nhc2UgMzc6aS5pc192aXNpYmxlJiYoaS5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikubGFzdCgpLmNsb3Nlc3QoXCJsaVwiKS5maXJzdCgpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmVuZCgpLmVuZCgpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLHQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdC5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDM4OmkuaXNfdmlzaWJsZSYmKHI9aS5lbGVtZW50LmZpbmQoXCJ1bDp2aXNpYmxlXCIpLmFkZEJhY2soKS5sYXN0KCkuY2hpbGRyZW4oXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5wcmV2QWxsKFwibGk6bm90KC52YWthdGEtY29udGV4dC1zZXBhcmF0b3IpXCIpLmZpcnN0KCksci5sZW5ndGh8fChyPWkuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwibGk6bm90KC52YWthdGEtY29udGV4dC1zZXBhcmF0b3IpXCIpLmxhc3QoKSksci5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLHQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdC5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDM5OmkuaXNfdmlzaWJsZSYmKGkuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmxhc3QoKS5jaGlsZHJlbihcInVsXCIpLnNob3coKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmZpcnN0KCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSx0LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHQucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSA0MDppLmlzX3Zpc2libGUmJihyPWkuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikubmV4dEFsbChcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpLHIubGVuZ3RofHwocj1pLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpKSxyLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuY2hpbGRyZW4oXCJhXCIpLmZvY3VzKCksdC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSx0LnByZXZlbnREZWZhdWx0KCkpO2JyZWFrO2Nhc2UgMjc6ZS52YWthdGEuY29udGV4dC5oaWRlKCksdC5wcmV2ZW50RGVmYXVsdCgpfX0pLm9uKFwia2V5ZG93blwiLGZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKTt2YXIgdD1pLmVsZW1lbnQuZmluZChcIi52YWthdGEtY29udGV4dG1lbnUtc2hvcnRjdXQtXCIrZS53aGljaCkucGFyZW50KCk7dC5wYXJlbnQoKS5ub3QoXCIudmFrYXRhLWNvbnRleHQtZGlzYWJsZWRcIikmJnQuY2xpY2soKX0pLGUobCkub24oXCJtb3VzZWRvd24udmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKHQpe2kuaXNfdmlzaWJsZSYmIWUuY29udGFpbnMoaS5lbGVtZW50WzBdLHQudGFyZ2V0KSYmZS52YWthdGEuY29udGV4dC5oaWRlKCl9KS5vbihcImNvbnRleHRfc2hvdy52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oZSxyKXtpLmVsZW1lbnQuZmluZChcImxpOmhhcyh1bClcIikuY2hpbGRyZW4oXCJhXCIpLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtcGFyZW50XCIpLHQmJmkuZWxlbWVudC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LXJ0bFwiKS5jc3MoXCJkaXJlY3Rpb25cIixcInJ0bFwiKSxpLmVsZW1lbnQuZmluZChcInVsXCIpLmhpZGUoKS5lbmQoKX0pfSl9KGUpLGUuanN0cmVlLmRlZmF1bHRzLmRuZD17Y29weTohMCxvcGVuX3RpbWVvdXQ6NTAwLGlzX2RyYWdnYWJsZTohMCxjaGVja193aGlsZV9kcmFnZ2luZzohMCxhbHdheXNfY29weTohMSxpbnNpZGVfcG9zOjAsZHJhZ19zZWxlY3Rpb246ITAsdG91Y2g6ITAsbGFyZ2VfZHJvcF90YXJnZXQ6ITEsbGFyZ2VfZHJhZ190YXJnZXQ6ITF9LGUuanN0cmVlLnBsdWdpbnMuZG5kPWZ1bmN0aW9uKHQsaSl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7aS5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKFwibW91c2Vkb3duLmpzdHJlZSB0b3VjaHN0YXJ0LmpzdHJlZVwiLHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0P1wiLmpzdHJlZS1ub2RlXCI6XCIuanN0cmVlLWFuY2hvclwiLGUucHJveHkoZnVuY3Rpb24odCl7XG5pZih0aGlzLnNldHRpbmdzLmRuZC5sYXJnZV9kcmFnX3RhcmdldCYmZSh0LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKVswXSE9PXQuY3VycmVudFRhcmdldClyZXR1cm4hMDtpZihcInRvdWNoc3RhcnRcIj09PXQudHlwZSYmKCF0aGlzLnNldHRpbmdzLmRuZC50b3VjaHx8XCJzZWxlY3RlZFwiPT09dGhpcy5zZXR0aW5ncy5kbmQudG91Y2gmJiFlKHQuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmhhc0NsYXNzKFwianN0cmVlLWNsaWNrZWRcIikpKXJldHVybiEwO3ZhciBpPXRoaXMuZ2V0X25vZGUodC50YXJnZXQpLHI9dGhpcy5pc19zZWxlY3RlZChpKSYmdGhpcy5zZXR0aW5ncy5kbmQuZHJhZ19zZWxlY3Rpb24/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCkubGVuZ3RoOjEscz1yPjE/citcIiBcIit0aGlzLmdldF9zdHJpbmcoXCJub2Rlc1wiKTp0aGlzLmdldF90ZXh0KHQuY3VycmVudFRhcmdldCk7cmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0JiYocz1lLnZha2F0YS5odG1sLmVzY2FwZShzKSksaSYmaS5pZCYmaS5pZCE9PWUuanN0cmVlLnJvb3QmJigxPT09dC53aGljaHx8XCJ0b3VjaHN0YXJ0XCI9PT10LnR5cGUpJiYodGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlPT09ITB8fGUuaXNGdW5jdGlvbih0aGlzLnNldHRpbmdzLmRuZC5pc19kcmFnZ2FibGUpJiZ0aGlzLnNldHRpbmdzLmRuZC5pc19kcmFnZ2FibGUuY2FsbCh0aGlzLHI+MT90aGlzLmdldF90b3Bfc2VsZWN0ZWQoITApOltpXSx0KSk/KHRoaXMuZWxlbWVudC50cmlnZ2VyKFwibW91c2Vkb3duLmpzdHJlZVwiKSxlLnZha2F0YS5kbmQuc3RhcnQodCx7anN0cmVlOiEwLG9yaWdpbjp0aGlzLG9iajp0aGlzLmdldF9ub2RlKGksITApLG5vZGVzOnI+MT90aGlzLmdldF90b3Bfc2VsZWN0ZWQoKTpbaS5pZF19LCc8ZGl2IGlkPVwianN0cmVlLWRuZFwiIGNsYXNzPVwianN0cmVlLScrdGhpcy5nZXRfdGhlbWUoKStcIiBqc3RyZWUtXCIrdGhpcy5nZXRfdGhlbWUoKStcIi1cIit0aGlzLmdldF90aGVtZV92YXJpYW50KCkrXCIgXCIrKHRoaXMuc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSsnXCI+PGkgY2xhc3M9XCJqc3RyZWUtaWNvbiBqc3RyZWUtZXJcIj48L2k+JytzKyc8aW5zIGNsYXNzPVwianN0cmVlLWNvcHlcIiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj4rPC9pbnM+PC9kaXY+JykpOnZvaWQgMH0sdGhpcykpfX0sZShmdW5jdGlvbigpe3ZhciB0PSExLGk9ITEscj0hMSxzPSExLG49ZSgnPGRpdiBpZD1cImpzdHJlZS1tYXJrZXJcIj4mIzE2MDs8L2Rpdj4nKS5oaWRlKCk7ZShsKS5vbihcImRuZF9zdGFydC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oZSxpKXt0PSExLHI9ITEsaSYmaS5kYXRhJiZpLmRhdGEuanN0cmVlJiZuLmFwcGVuZFRvKFwiYm9keVwiKX0pLm9uKFwiZG5kX21vdmUudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsbyl7aWYocyYmY2xlYXJUaW1lb3V0KHMpLG8mJm8uZGF0YSYmby5kYXRhLmpzdHJlZSYmKCFvLmV2ZW50LnRhcmdldC5pZHx8XCJqc3RyZWUtbWFya2VyXCIhPT1vLmV2ZW50LnRhcmdldC5pZCkpe3I9by5ldmVudDt2YXIgZCxjLGwsaCxfLHUsZyxmLHAsbSx2LGoseSxrLHg9ZS5qc3RyZWUucmVmZXJlbmNlKG8uZXZlbnQudGFyZ2V0KSxiPSExLHc9ITEsQz0hMTtpZih4JiZ4Ll9kYXRhJiZ4Ll9kYXRhLmRuZClpZihuLmF0dHIoXCJjbGFzc1wiLFwianN0cmVlLVwiK3guZ2V0X3RoZW1lKCkrKHguc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSksby5oZWxwZXIuY2hpbGRyZW4oKS5hdHRyKFwiY2xhc3NcIixcImpzdHJlZS1cIit4LmdldF90aGVtZSgpK1wiIGpzdHJlZS1cIit4LmdldF90aGVtZSgpK1wiLVwiK3guZ2V0X3RoZW1lX3ZhcmlhbnQoKStcIiBcIisoeC5zZXR0aW5ncy5jb3JlLnRoZW1lcy5yZXNwb25zaXZlP1wiIGpzdHJlZS1kbmQtcmVzcG9uc2l2ZVwiOlwiXCIpKS5maW5kKFwiLmpzdHJlZS1jb3B5XCIpLmZpcnN0KClbby5kYXRhLm9yaWdpbiYmKG8uZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxvLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoby5ldmVudC5tZXRhS2V5fHxvLmV2ZW50LmN0cmxLZXkpKT9cInNob3dcIjpcImhpZGVcIl0oKSxvLmV2ZW50LnRhcmdldCE9PXguZWxlbWVudFswXSYmby5ldmVudC50YXJnZXQhPT14LmdldF9jb250YWluZXJfdWwoKVswXXx8MCE9PXguZ2V0X2NvbnRhaW5lcl91bCgpLmNoaWxkcmVuKCkubGVuZ3RoKXtpZihiPXguc2V0dGluZ3MuZG5kLmxhcmdlX2Ryb3BfdGFyZ2V0P2Uoby5ldmVudC50YXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKTplKG8uZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1hbmNob3JcIiksYiYmYi5sZW5ndGgmJmIucGFyZW50KCkuaXMoXCIuanN0cmVlLWNsb3NlZCwgLmpzdHJlZS1vcGVuLCAuanN0cmVlLWxlYWZcIikmJih3PWIub2Zmc2V0KCksQz1vLmV2ZW50LnBhZ2VZLXcudG9wLGw9Yi5vdXRlckhlaWdodCgpLHU9bC8zPkM/W1wiYlwiLFwiaVwiLFwiYVwiXTpDPmwtbC8zP1tcImFcIixcImlcIixcImJcIl06Qz5sLzI/W1wiaVwiLFwiYVwiLFwiYlwiXTpbXCJpXCIsXCJiXCIsXCJhXCJdLGUuZWFjaCh1LGZ1bmN0aW9uKHIsYSl7c3dpdGNoKGEpe2Nhc2VcImJcIjpkPXcubGVmdC02LGM9dy50b3AsaD14LmdldF9wYXJlbnQoYiksXz1iLnBhcmVudCgpLmluZGV4KCk7YnJlYWs7Y2FzZVwiaVwiOnk9eC5zZXR0aW5ncy5kbmQuaW5zaWRlX3BvcyxrPXguZ2V0X25vZGUoYi5wYXJlbnQoKSksZD13LmxlZnQtMixjPXcudG9wK2wvMisxLGg9ay5pZCxfPVwiZmlyc3RcIj09PXk/MDpcImxhc3RcIj09PXk/ay5jaGlsZHJlbi5sZW5ndGg6TWF0aC5taW4oeSxrLmNoaWxkcmVuLmxlbmd0aCk7YnJlYWs7Y2FzZVwiYVwiOmQ9dy5sZWZ0LTYsYz13LnRvcCtsLGg9eC5nZXRfcGFyZW50KGIpLF89Yi5wYXJlbnQoKS5pbmRleCgpKzF9Zm9yKGc9ITAsZj0wLHA9by5kYXRhLm5vZGVzLmxlbmd0aDtwPmY7ZisrKWlmKG09by5kYXRhLm9yaWdpbiYmKG8uZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxvLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoby5ldmVudC5tZXRhS2V5fHxvLmV2ZW50LmN0cmxLZXkpKT9cImNvcHlfbm9kZVwiOlwibW92ZV9ub2RlXCIsdj1fLFwibW92ZV9ub2RlXCI9PT1tJiZcImFcIj09PWEmJm8uZGF0YS5vcmlnaW4mJm8uZGF0YS5vcmlnaW49PT14JiZoPT09eC5nZXRfcGFyZW50KG8uZGF0YS5ub2Rlc1tmXSkmJihqPXguZ2V0X25vZGUoaCksdj5lLmluQXJyYXkoby5kYXRhLm5vZGVzW2ZdLGouY2hpbGRyZW4pJiYodi09MSkpLGc9ZyYmKHgmJnguc2V0dGluZ3MmJnguc2V0dGluZ3MuZG5kJiZ4LnNldHRpbmdzLmRuZC5jaGVja193aGlsZV9kcmFnZ2luZz09PSExfHx4LmNoZWNrKG0sby5kYXRhLm9yaWdpbiYmby5kYXRhLm9yaWdpbiE9PXg/by5kYXRhLm9yaWdpbi5nZXRfbm9kZShvLmRhdGEubm9kZXNbZl0pOm8uZGF0YS5ub2Rlc1tmXSxoLHYse2RuZDohMCxyZWY6eC5nZXRfbm9kZShiLnBhcmVudCgpKSxwb3M6YSxvcmlnaW46by5kYXRhLm9yaWdpbixpc19tdWx0aTpvLmRhdGEub3JpZ2luJiZvLmRhdGEub3JpZ2luIT09eCxpc19mb3JlaWduOiFvLmRhdGEub3JpZ2lufSkpLCFnKXt4JiZ4Lmxhc3RfZXJyb3ImJihpPXgubGFzdF9lcnJvcigpKTticmVha31yZXR1cm5cImlcIj09PWEmJmIucGFyZW50KCkuaXMoXCIuanN0cmVlLWNsb3NlZFwiKSYmeC5zZXR0aW5ncy5kbmQub3Blbl90aW1lb3V0JiYocz1zZXRUaW1lb3V0KGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGZ1bmN0aW9uKCl7ZS5vcGVuX25vZGUodCl9fSh4LGIpLHguc2V0dGluZ3MuZG5kLm9wZW5fdGltZW91dCkpLGc/KHQ9e2luczp4LHBhcjpoLHBvczpcImlcIiE9PWF8fFwibGFzdFwiIT09eXx8MCE9PV98fHguaXNfbG9hZGVkKGspP186XCJsYXN0XCJ9LG4uY3NzKHtsZWZ0OmQrXCJweFwiLHRvcDpjK1wicHhcIn0pLnNob3coKSxvLmhlbHBlci5maW5kKFwiLmpzdHJlZS1pY29uXCIpLmZpcnN0KCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtZXJcIikuYWRkQ2xhc3MoXCJqc3RyZWUtb2tcIiksaT17fSx1PSEwLCExKTp2b2lkIDB9KSx1PT09ITApKXJldHVybn1lbHNle2ZvcihnPSEwLGY9MCxwPW8uZGF0YS5ub2Rlcy5sZW5ndGg7cD5mJiYoZz1nJiZ4LmNoZWNrKG8uZGF0YS5vcmlnaW4mJihvLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8by5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKG8uZXZlbnQubWV0YUtleXx8by5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiLG8uZGF0YS5vcmlnaW4mJm8uZGF0YS5vcmlnaW4hPT14P28uZGF0YS5vcmlnaW4uZ2V0X25vZGUoby5kYXRhLm5vZGVzW2ZdKTpvLmRhdGEubm9kZXNbZl0sZS5qc3RyZWUucm9vdCxcImxhc3RcIix7ZG5kOiEwLHJlZjp4LmdldF9ub2RlKGUuanN0cmVlLnJvb3QpLHBvczpcImlcIixvcmlnaW46by5kYXRhLm9yaWdpbixpc19tdWx0aTpvLmRhdGEub3JpZ2luJiZvLmRhdGEub3JpZ2luIT09eCxpc19mb3JlaWduOiFvLmRhdGEub3JpZ2lufSksZyk7ZisrKTtpZihnKXJldHVybiB0PXtpbnM6eCxwYXI6ZS5qc3RyZWUucm9vdCxwb3M6XCJsYXN0XCJ9LG4uaGlkZSgpLHZvaWQgby5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5maXJzdCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWVyXCIpLmFkZENsYXNzKFwianN0cmVlLW9rXCIpfXQ9ITEsby5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1va1wiKS5hZGRDbGFzcyhcImpzdHJlZS1lclwiKSxuLmhpZGUoKX19KS5vbihcImRuZF9zY3JvbGwudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGUsaSl7aSYmaS5kYXRhJiZpLmRhdGEuanN0cmVlJiYobi5oaWRlKCksdD0hMSxyPSExLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1va1wiKS5hZGRDbGFzcyhcImpzdHJlZS1lclwiKSl9KS5vbihcImRuZF9zdG9wLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhLG8pe2lmKHMmJmNsZWFyVGltZW91dChzKSxvJiZvLmRhdGEmJm8uZGF0YS5qc3RyZWUpe24uaGlkZSgpLmRldGFjaCgpO3ZhciBkLGMsbD1bXTtpZih0KXtmb3IoZD0wLGM9by5kYXRhLm5vZGVzLmxlbmd0aDtjPmQ7ZCsrKWxbZF09by5kYXRhLm9yaWdpbj9vLmRhdGEub3JpZ2luLmdldF9ub2RlKG8uZGF0YS5ub2Rlc1tkXSk6by5kYXRhLm5vZGVzW2RdO3QuaW5zW28uZGF0YS5vcmlnaW4mJihvLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8by5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKG8uZXZlbnQubWV0YUtleXx8by5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiXShsLHQucGFyLHQucG9zLCExLCExLCExLG8uZGF0YS5vcmlnaW4pfWVsc2UgZD1lKG8uZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZVwiKSxkLmxlbmd0aCYmaSYmaS5lcnJvciYmXCJjaGVja1wiPT09aS5lcnJvciYmKGQ9ZC5qc3RyZWUoITApLGQmJmQuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsaSkpO3I9ITEsdD0hMX19KS5vbihcImtleXVwLmpzdHJlZSBrZXlkb3duLmpzdHJlZVwiLGZ1bmN0aW9uKHQsaSl7aT1lLnZha2F0YS5kbmQuX2dldCgpLGkmJmkuZGF0YSYmaS5kYXRhLmpzdHJlZSYmKGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWNvcHlcIikuZmlyc3QoKVtpLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJih0Lm1ldGFLZXl8fHQuY3RybEtleSkpP1wic2hvd1wiOlwiaGlkZVwiXSgpLHImJihyLm1ldGFLZXk9dC5tZXRhS2V5LHIuY3RybEtleT10LmN0cmxLZXksZS52YWthdGEuZG5kLl90cmlnZ2VyKFwibW92ZVwiLHIpKSl9KX0pLGZ1bmN0aW9uKGUpe2UudmFrYXRhLmh0bWw9e2RpdjplKFwiPGRpdiAvPlwiKSxlc2NhcGU6ZnVuY3Rpb24odCl7cmV0dXJuIGUudmFrYXRhLmh0bWwuZGl2LnRleHQodCkuaHRtbCgpfSxzdHJpcDpmdW5jdGlvbih0KXtyZXR1cm4gZS52YWthdGEuaHRtbC5kaXYuZW1wdHkoKS5hcHBlbmQoZS5wYXJzZUhUTUwodCkpLnRleHQoKX19O3ZhciB0PXtlbGVtZW50OiExLHRhcmdldDohMSxpc19kb3duOiExLGlzX2RyYWc6ITEsaGVscGVyOiExLGhlbHBlcl93OjAsZGF0YTohMSxpbml0X3g6MCxpbml0X3k6MCxzY3JvbGxfbDowLHNjcm9sbF90OjAsc2Nyb2xsX2U6ITEsc2Nyb2xsX2k6ITEsaXNfdG91Y2g6ITF9O2UudmFrYXRhLmRuZD17c2V0dGluZ3M6e3Njcm9sbF9zcGVlZDoxMCxzY3JvbGxfcHJveGltaXR5OjIwLGhlbHBlcl9sZWZ0OjUsaGVscGVyX3RvcDoxMCx0aHJlc2hvbGQ6NSx0aHJlc2hvbGRfdG91Y2g6NTB9LF90cmlnZ2VyOmZ1bmN0aW9uKHQsaSl7dmFyIHI9ZS52YWthdGEuZG5kLl9nZXQoKTtyLmV2ZW50PWksZShsKS50cmlnZ2VySGFuZGxlcihcImRuZF9cIit0K1wiLnZha2F0YVwiLHIpfSxfZ2V0OmZ1bmN0aW9uKCl7cmV0dXJue2RhdGE6dC5kYXRhLGVsZW1lbnQ6dC5lbGVtZW50LGhlbHBlcjp0LmhlbHBlcn19LF9jbGVhbjpmdW5jdGlvbigpe3QuaGVscGVyJiZ0LmhlbHBlci5yZW1vdmUoKSx0LnNjcm9sbF9pJiYoY2xlYXJJbnRlcnZhbCh0LnNjcm9sbF9pKSx0LnNjcm9sbF9pPSExKSx0PXtlbGVtZW50OiExLHRhcmdldDohMSxpc19kb3duOiExLGlzX2RyYWc6ITEsaGVscGVyOiExLGhlbHBlcl93OjAsZGF0YTohMSxpbml0X3g6MCxpbml0X3k6MCxzY3JvbGxfbDowLHNjcm9sbF90OjAsc2Nyb2xsX2U6ITEsc2Nyb2xsX2k6ITEsaXNfdG91Y2g6ITF9LGUobCkub2ZmKFwibW91c2Vtb3ZlLnZha2F0YS5qc3RyZWUgdG91Y2htb3ZlLnZha2F0YS5qc3RyZWVcIixlLnZha2F0YS5kbmQuZHJhZyksZShsKS5vZmYoXCJtb3VzZXVwLnZha2F0YS5qc3RyZWUgdG91Y2hlbmQudmFrYXRhLmpzdHJlZVwiLGUudmFrYXRhLmRuZC5zdG9wKX0sX3Njcm9sbDpmdW5jdGlvbihpKXtpZighdC5zY3JvbGxfZXx8IXQuc2Nyb2xsX2wmJiF0LnNjcm9sbF90KXJldHVybiB0LnNjcm9sbF9pJiYoY2xlYXJJbnRlcnZhbCh0LnNjcm9sbF9pKSx0LnNjcm9sbF9pPSExKSwhMTtpZighdC5zY3JvbGxfaSlyZXR1cm4gdC5zY3JvbGxfaT1zZXRJbnRlcnZhbChlLnZha2F0YS5kbmQuX3Njcm9sbCwxMDApLCExO2lmKGk9PT0hMClyZXR1cm4hMTt2YXIgcj10LnNjcm9sbF9lLnNjcm9sbFRvcCgpLHM9dC5zY3JvbGxfZS5zY3JvbGxMZWZ0KCk7dC5zY3JvbGxfZS5zY3JvbGxUb3Aocit0LnNjcm9sbF90KmUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfc3BlZWQpLHQuc2Nyb2xsX2Uuc2Nyb2xsTGVmdChzK3Quc2Nyb2xsX2wqZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9zcGVlZCksKHIhPT10LnNjcm9sbF9lLnNjcm9sbFRvcCgpfHxzIT09dC5zY3JvbGxfZS5zY3JvbGxMZWZ0KCkpJiZlLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJzY3JvbGxcIix0LnNjcm9sbF9lKX0sc3RhcnQ6ZnVuY3Rpb24oaSxyLHMpe1widG91Y2hzdGFydFwiPT09aS50eXBlJiZpLm9yaWdpbmFsRXZlbnQmJmkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcyYmaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdJiYoaS5wYWdlWD1pLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgsaS5wYWdlWT1pLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVksaS50YXJnZXQ9bC5lbGVtZW50RnJvbVBvaW50KGkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWC13aW5kb3cucGFnZVhPZmZzZXQsaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLXdpbmRvdy5wYWdlWU9mZnNldCkpLHQuaXNfZHJhZyYmZS52YWthdGEuZG5kLnN0b3Aoe30pO3RyeXtpLmN1cnJlbnRUYXJnZXQudW5zZWxlY3RhYmxlPVwib25cIixpLmN1cnJlbnRUYXJnZXQub25zZWxlY3RzdGFydD1mdW5jdGlvbigpe3JldHVybiExfSxpLmN1cnJlbnRUYXJnZXQuc3R5bGUmJihpLmN1cnJlbnRUYXJnZXQuc3R5bGUuTW96VXNlclNlbGVjdD1cIm5vbmVcIil9Y2F0Y2gobil7fXJldHVybiB0LmluaXRfeD1pLnBhZ2VYLHQuaW5pdF95PWkucGFnZVksdC5kYXRhPXIsdC5pc19kb3duPSEwLHQuZWxlbWVudD1pLmN1cnJlbnRUYXJnZXQsdC50YXJnZXQ9aS50YXJnZXQsdC5pc190b3VjaD1cInRvdWNoc3RhcnRcIj09PWkudHlwZSxzIT09ITEmJih0LmhlbHBlcj1lKFwiPGRpdiBpZD0ndmFrYXRhLWRuZCc+PC9kaXY+XCIpLmh0bWwocykuY3NzKHtkaXNwbGF5OlwiYmxvY2tcIixtYXJnaW46XCIwXCIscGFkZGluZzpcIjBcIixwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiLTIwMDBweFwiLGxpbmVIZWlnaHQ6XCIxNnB4XCIsekluZGV4OlwiMTAwMDBcIn0pKSxlKGwpLm9uKFwibW91c2Vtb3ZlLnZha2F0YS5qc3RyZWUgdG91Y2htb3ZlLnZha2F0YS5qc3RyZWVcIixlLnZha2F0YS5kbmQuZHJhZyksZShsKS5vbihcIm1vdXNldXAudmFrYXRhLmpzdHJlZSB0b3VjaGVuZC52YWthdGEuanN0cmVlXCIsZS52YWthdGEuZG5kLnN0b3ApLCExfSxkcmFnOmZ1bmN0aW9uKGkpe2lmKFwidG91Y2htb3ZlXCI9PT1pLnR5cGUmJmkub3JpZ2luYWxFdmVudCYmaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihpLnBhZ2VYPWkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxpLnBhZ2VZPWkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxpLnRhcmdldD1sLmVsZW1lbnRGcm9tUG9pbnQoaS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLXdpbmRvdy5wYWdlWE9mZnNldCxpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVktd2luZG93LnBhZ2VZT2Zmc2V0KSksdC5pc19kb3duKXtpZighdC5pc19kcmFnKXtpZighKE1hdGguYWJzKGkucGFnZVgtdC5pbml0X3gpPih0LmlzX3RvdWNoP2UudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGRfdG91Y2g6ZS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZCl8fE1hdGguYWJzKGkucGFnZVktdC5pbml0X3kpPih0LmlzX3RvdWNoP2UudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGRfdG91Y2g6ZS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZCkpKXJldHVybjt0LmhlbHBlciYmKHQuaGVscGVyLmFwcGVuZFRvKFwiYm9keVwiKSx0LmhlbHBlcl93PXQuaGVscGVyLm91dGVyV2lkdGgoKSksdC5pc19kcmFnPSEwLGUudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0YXJ0XCIsaSl9dmFyIHI9ITEscz0hMSxuPSExLGE9ITEsbz0hMSxkPSExLGM9ITEsaD0hMSxfPSExLHU9ITE7cmV0dXJuIHQuc2Nyb2xsX3Q9MCx0LnNjcm9sbF9sPTAsdC5zY3JvbGxfZT0hMSxlKGUoaS50YXJnZXQpLnBhcmVudHNVbnRpbChcImJvZHlcIikuYWRkQmFjaygpLmdldCgpLnJldmVyc2UoKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuL15hdXRvfHNjcm9sbCQvLnRlc3QoZSh0aGlzKS5jc3MoXCJvdmVyZmxvd1wiKSkmJih0aGlzLnNjcm9sbEhlaWdodD50aGlzLm9mZnNldEhlaWdodHx8dGhpcy5zY3JvbGxXaWR0aD50aGlzLm9mZnNldFdpZHRoKX0pLmVhY2goZnVuY3Rpb24oKXt2YXIgcj1lKHRoaXMpLHM9ci5vZmZzZXQoKTtyZXR1cm4gdGhpcy5zY3JvbGxIZWlnaHQ+dGhpcy5vZmZzZXRIZWlnaHQmJihzLnRvcCtyLmhlaWdodCgpLWkucGFnZVk8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF90PTEpLGkucGFnZVktcy50b3A8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF90PS0xKSksdGhpcy5zY3JvbGxXaWR0aD50aGlzLm9mZnNldFdpZHRoJiYocy5sZWZ0K3Iud2lkdGgoKS1pLnBhZ2VYPGUudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYodC5zY3JvbGxfbD0xKSxpLnBhZ2VYLXMubGVmdDxlLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKHQuc2Nyb2xsX2w9LTEpKSx0LnNjcm9sbF90fHx0LnNjcm9sbF9sPyh0LnNjcm9sbF9lPWUodGhpcyksITEpOnZvaWQgMH0pLHQuc2Nyb2xsX2V8fChyPWUobCkscz1lKHdpbmRvdyksbj1yLmhlaWdodCgpLGE9cy5oZWlnaHQoKSxvPXIud2lkdGgoKSxkPXMud2lkdGgoKSxjPXIuc2Nyb2xsVG9wKCksaD1yLnNjcm9sbExlZnQoKSxuPmEmJmkucGFnZVktYzxlLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKHQuc2Nyb2xsX3Q9LTEpLG4+YSYmYS0oaS5wYWdlWS1jKTxlLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKHQuc2Nyb2xsX3Q9MSksbz5kJiZpLnBhZ2VYLWg8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF9sPS0xKSxvPmQmJmQtKGkucGFnZVgtaCk8ZS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJih0LnNjcm9sbF9sPTEpLCh0LnNjcm9sbF90fHx0LnNjcm9sbF9sKSYmKHQuc2Nyb2xsX2U9cikpLHQuc2Nyb2xsX2UmJmUudmFrYXRhLmRuZC5fc2Nyb2xsKCEwKSx0LmhlbHBlciYmKF89cGFyc2VJbnQoaS5wYWdlWStlLnZha2F0YS5kbmQuc2V0dGluZ3MuaGVscGVyX3RvcCwxMCksdT1wYXJzZUludChpLnBhZ2VYK2UudmFrYXRhLmRuZC5zZXR0aW5ncy5oZWxwZXJfbGVmdCwxMCksbiYmXysyNT5uJiYoXz1uLTUwKSxvJiZ1K3QuaGVscGVyX3c+byYmKHU9by0odC5oZWxwZXJfdysyKSksdC5oZWxwZXIuY3NzKHtsZWZ0OnUrXCJweFwiLHRvcDpfK1wicHhcIn0pKSxlLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsaSksITF9fSxzdG9wOmZ1bmN0aW9uKGkpe2lmKFwidG91Y2hlbmRcIj09PWkudHlwZSYmaS5vcmlnaW5hbEV2ZW50JiZpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGkucGFnZVg9aS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGkucGFnZVk9aS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGkudGFyZ2V0PWwuZWxlbWVudEZyb21Qb2ludChpLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGkub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSx0LmlzX2RyYWcpZS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RvcFwiLGkpO2Vsc2UgaWYoXCJ0b3VjaGVuZFwiPT09aS50eXBlJiZpLnRhcmdldD09PXQudGFyZ2V0KXt2YXIgcj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZShpLnRhcmdldCkuY2xpY2soKX0sMTAwKTtlKGkudGFyZ2V0KS5vbmUoXCJjbGlja1wiLGZ1bmN0aW9uKCl7ciYmY2xlYXJUaW1lb3V0KHIpfSl9cmV0dXJuIGUudmFrYXRhLmRuZC5fY2xlYW4oKSwhMX19fShlKSxlLmpzdHJlZS5kZWZhdWx0cy5tYXNzbG9hZD1udWxsLGUuanN0cmVlLnBsdWdpbnMubWFzc2xvYWQ9ZnVuY3Rpb24odCxpKXt0aGlzLmluaXQ9ZnVuY3Rpb24oZSx0KXtpLmluaXQuY2FsbCh0aGlzLGUsdCksdGhpcy5fZGF0YS5tYXNzbG9hZD17fX0sdGhpcy5fbG9hZF9ub2Rlcz1mdW5jdGlvbih0LHIscyl7dmFyIG49dGhpcy5zZXR0aW5ncy5tYXNzbG9hZDtyZXR1cm4gcyYmIWUuaXNFbXB0eU9iamVjdCh0aGlzLl9kYXRhLm1hc3Nsb2FkKT9pLl9sb2FkX25vZGVzLmNhbGwodGhpcyx0LHIscyk6ZS5pc0Z1bmN0aW9uKG4pP24uY2FsbCh0aGlzLHQsZS5wcm94eShmdW5jdGlvbihlKXtpZihlKWZvcih2YXIgbiBpbiBlKWUuaGFzT3duUHJvcGVydHkobikmJih0aGlzLl9kYXRhLm1hc3Nsb2FkW25dPWVbbl0pO2kuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLHQscixzKX0sdGhpcykpOlwib2JqZWN0XCI9PXR5cGVvZiBuJiZuJiZuLnVybD8obj1lLmV4dGVuZCghMCx7fSxuKSxlLmlzRnVuY3Rpb24obi51cmwpJiYobi51cmw9bi51cmwuY2FsbCh0aGlzLHQpKSxlLmlzRnVuY3Rpb24obi5kYXRhKSYmKG4uZGF0YT1uLmRhdGEuY2FsbCh0aGlzLHQpKSxlLmFqYXgobikuZG9uZShlLnByb3h5KGZ1bmN0aW9uKGUsbixhKXtpZihlKWZvcih2YXIgbyBpbiBlKWUuaGFzT3duUHJvcGVydHkobykmJih0aGlzLl9kYXRhLm1hc3Nsb2FkW29dPWVbb10pO2kuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLHQscixzKX0sdGhpcykpLmZhaWwoZS5wcm94eShmdW5jdGlvbihlKXtpLl9sb2FkX25vZGVzLmNhbGwodGhpcyx0LHIscyl9LHRoaXMpKSk6aS5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsdCxyLHMpfSx0aGlzLl9sb2FkX25vZGU9ZnVuY3Rpb24odCxyKXt2YXIgcz10aGlzLl9kYXRhLm1hc3Nsb2FkW3QuaWRdO3JldHVybiBzP3RoaXNbXCJzdHJpbmdcIj09dHlwZW9mIHM/XCJfYXBwZW5kX2h0bWxfZGF0YVwiOlwiX2FwcGVuZF9qc29uX2RhdGFcIl0odCxcInN0cmluZ1wiPT10eXBlb2Ygcz9lKGUucGFyc2VIVE1MKHMpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KTpzLGZ1bmN0aW9uKGUpe3IuY2FsbCh0aGlzLGUpLGRlbGV0ZSB0aGlzLl9kYXRhLm1hc3Nsb2FkW3QuaWRdfSk6aS5fbG9hZF9ub2RlLmNhbGwodGhpcyx0LHIpfX0sZS5qc3RyZWUuZGVmYXVsdHMuc2VhcmNoPXthamF4OiExLGZ1enp5OiExLGNhc2Vfc2Vuc2l0aXZlOiExLHNob3dfb25seV9tYXRjaGVzOiExLHNob3dfb25seV9tYXRjaGVzX2NoaWxkcmVuOiExLGNsb3NlX29wZW5lZF9vbmNsZWFyOiEwLHNlYXJjaF9sZWF2ZXNfb25seTohMSxzZWFyY2hfY2FsbGJhY2s6ITF9LGUuanN0cmVlLnBsdWdpbnMuc2VhcmNoPWZ1bmN0aW9uKGkscil7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ci5iaW5kLmNhbGwodGhpcyksdGhpcy5fZGF0YS5zZWFyY2guc3RyPVwiXCIsdGhpcy5fZGF0YS5zZWFyY2guZG9tPWUoKSx0aGlzLl9kYXRhLnNlYXJjaC5yZXM9W10sdGhpcy5fZGF0YS5zZWFyY2gub3BuPVtdLHRoaXMuX2RhdGEuc2VhcmNoLnNvbT0hMSx0aGlzLl9kYXRhLnNlYXJjaC5zbWM9ITEsdGhpcy5fZGF0YS5zZWFyY2guaGRuPVtdLHRoaXMuZWxlbWVudC5vbihcInNlYXJjaC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7aWYodGhpcy5fZGF0YS5zZWFyY2guc29tJiZpLnJlcy5sZW5ndGgpe3ZhciByLHMsbj10aGlzLl9tb2RlbC5kYXRhLGE9W107Zm9yKHI9MCxzPWkucmVzLmxlbmd0aDtzPnI7cisrKW5baS5yZXNbcl1dJiYhbltpLnJlc1tyXV0uc3RhdGUuaGlkZGVuJiYoYS5wdXNoKGkucmVzW3JdKSxhPWEuY29uY2F0KG5baS5yZXNbcl1dLnBhcmVudHMpLHRoaXMuX2RhdGEuc2VhcmNoLnNtYyYmKGE9YS5jb25jYXQobltpLnJlc1tyXV0uY2hpbGRyZW5fZCkpKTthPWUudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKGUudmFrYXRhLmFycmF5X3VuaXF1ZShhKSxlLmpzdHJlZS5yb290KSx0aGlzLl9kYXRhLnNlYXJjaC5oZG49dGhpcy5oaWRlX2FsbCghMCksdGhpcy5zaG93X25vZGUoYSl9fSx0aGlzKSkub24oXCJjbGVhcl9zZWFyY2guanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3RoaXMuX2RhdGEuc2VhcmNoLnNvbSYmdC5yZXMubGVuZ3RoJiZ0aGlzLnNob3dfbm9kZSh0aGlzLl9kYXRhLnNlYXJjaC5oZG4pfSx0aGlzKSl9LHRoaXMuc2VhcmNoPWZ1bmN0aW9uKGkscixzLG4sYSxvKXtpZihpPT09ITF8fFwiXCI9PT1lLnRyaW0oaS50b1N0cmluZygpKSlyZXR1cm4gdGhpcy5jbGVhcl9zZWFyY2goKTtuPXRoaXMuZ2V0X25vZGUobiksbj1uJiZuLmlkP24uaWQ6bnVsbCxpPWkudG9TdHJpbmcoKTt2YXIgZCxjLGw9dGhpcy5zZXR0aW5ncy5zZWFyY2gsaD1sLmFqYXg/bC5hamF4OiExLF89dGhpcy5fbW9kZWwuZGF0YSx1PW51bGwsZz1bXSxmPVtdO2lmKHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5sZW5ndGgmJiFhJiZ0aGlzLmNsZWFyX3NlYXJjaCgpLHM9PT10JiYocz1sLnNob3dfb25seV9tYXRjaGVzKSxvPT09dCYmKG89bC5zaG93X29ubHlfbWF0Y2hlc19jaGlsZHJlbiksIXImJmghPT0hMSlyZXR1cm4gZS5pc0Z1bmN0aW9uKGgpP2guY2FsbCh0aGlzLGksZS5wcm94eShmdW5jdGlvbih0KXt0JiZ0LmQmJih0PXQuZCksdGhpcy5fbG9hZF9ub2RlcyhlLmlzQXJyYXkodCk/ZS52YWthdGEuYXJyYXlfdW5pcXVlKHQpOltdLGZ1bmN0aW9uKCl7dGhpcy5zZWFyY2goaSwhMCxzLG4sYSl9LCEwKX0sdGhpcyksbik6KGg9ZS5leHRlbmQoe30saCksaC5kYXRhfHwoaC5kYXRhPXt9KSxoLmRhdGEuc3RyPWksbiYmKGguZGF0YS5pbnNpZGU9biksZS5hamF4KGgpLmZhaWwoZS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImFqYXhcIixwbHVnaW46XCJzZWFyY2hcIixpZDpcInNlYXJjaF8wMVwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIHNlYXJjaCBwYXJlbnRzXCIsZGF0YTpKU09OLnN0cmluZ2lmeShoKX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcil9LHRoaXMpKS5kb25lKGUucHJveHkoZnVuY3Rpb24odCl7dCYmdC5kJiYodD10LmQpLHRoaXMuX2xvYWRfbm9kZXMoZS5pc0FycmF5KHQpP2UudmFrYXRhLmFycmF5X3VuaXF1ZSh0KTpbXSxmdW5jdGlvbigpe3RoaXMuc2VhcmNoKGksITAscyxuLGEpfSwhMCl9LHRoaXMpKSk7aWYoYXx8KHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1pLHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1lKCksdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5zb209cyx0aGlzLl9kYXRhLnNlYXJjaC5zbWM9byksdT1uZXcgZS52YWthdGEuc2VhcmNoKGksITAse2Nhc2VTZW5zaXRpdmU6bC5jYXNlX3NlbnNpdGl2ZSxmdXp6eTpsLmZ1enp5fSksZS5lYWNoKF9bbj9uOmUuanN0cmVlLnJvb3RdLmNoaWxkcmVuX2QsZnVuY3Rpb24oZSx0KXt2YXIgcj1fW3RdO3IudGV4dCYmKCFsLnNlYXJjaF9sZWF2ZXNfb25seXx8ci5zdGF0ZS5sb2FkZWQmJjA9PT1yLmNoaWxkcmVuLmxlbmd0aCkmJihsLnNlYXJjaF9jYWxsYmFjayYmbC5zZWFyY2hfY2FsbGJhY2suY2FsbCh0aGlzLGkscil8fCFsLnNlYXJjaF9jYWxsYmFjayYmdS5zZWFyY2goci50ZXh0KS5pc01hdGNoKSYmKGcucHVzaCh0KSxmPWYuY29uY2F0KHIucGFyZW50cykpfSksZy5sZW5ndGgpe2ZvcihmPWUudmFrYXRhLmFycmF5X3VuaXF1ZShmKSxkPTAsYz1mLmxlbmd0aDtjPmQ7ZCsrKWZbZF0hPT1lLmpzdHJlZS5yb290JiZfW2ZbZF1dJiZ0aGlzLm9wZW5fbm9kZShmW2RdLG51bGwsMCk9PT0hMCYmdGhpcy5fZGF0YS5zZWFyY2gub3BuLnB1c2goZltkXSk7YT8odGhpcy5fZGF0YS5zZWFyY2guZG9tPXRoaXMuX2RhdGEuc2VhcmNoLmRvbS5hZGQoZSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIitlLm1hcChnLGZ1bmN0aW9uKHQpe3JldHVybi0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZih0WzBdKT9cIlxcXFwzXCIrdFswXStcIiBcIit0LnN1YnN0cigxKS5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6dC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIil9KS5qb2luKFwiLCAjXCIpKSkpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1lLnZha2F0YS5hcnJheV91bmlxdWUodGhpcy5fZGF0YS5zZWFyY2gucmVzLmNvbmNhdChnKSkpOih0aGlzLl9kYXRhLnNlYXJjaC5kb209ZSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIitlLm1hcChnLGZ1bmN0aW9uKHQpe3JldHVybi0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZih0WzBdKT9cIlxcXFwzXCIrdFswXStcIiBcIit0LnN1YnN0cigxKS5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6dC5yZXBsYWNlKGUuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIil9KS5qb2luKFwiLCAjXCIpKSksdGhpcy5fZGF0YS5zZWFyY2gucmVzPWcpLHRoaXMuX2RhdGEuc2VhcmNoLmRvbS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLXNlYXJjaFwiKX10aGlzLnRyaWdnZXIoXCJzZWFyY2hcIix7bm9kZXM6dGhpcy5fZGF0YS5zZWFyY2guZG9tLHN0cjppLHJlczp0aGlzLl9kYXRhLnNlYXJjaC5yZXMsc2hvd19vbmx5X21hdGNoZXM6c30pfSx0aGlzLmNsZWFyX3NlYXJjaD1mdW5jdGlvbigpe3RoaXMuc2V0dGluZ3Muc2VhcmNoLmNsb3NlX29wZW5lZF9vbmNsZWFyJiZ0aGlzLmNsb3NlX25vZGUodGhpcy5fZGF0YS5zZWFyY2gub3BuLDApLHRoaXMudHJpZ2dlcihcImNsZWFyX3NlYXJjaFwiLHtub2Rlczp0aGlzLl9kYXRhLnNlYXJjaC5kb20sc3RyOnRoaXMuX2RhdGEuc2VhcmNoLnN0cixyZXM6dGhpcy5fZGF0YS5zZWFyY2gucmVzfSksdGhpcy5fZGF0YS5zZWFyY2gucmVzLmxlbmd0aCYmKHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1lKHRoaXMuZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yQWxsKFwiI1wiK2UubWFwKHRoaXMuX2RhdGEuc2VhcmNoLnJlcyxmdW5jdGlvbih0KXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YodFswXSk/XCJcXFxcM1wiK3RbMF0rXCIgXCIrdC5zdWJzdHIoMSkucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOnQucmVwbGFjZShlLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpLHRoaXMuX2RhdGEuc2VhcmNoLmRvbS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXNlYXJjaFwiKSksdGhpcy5fZGF0YS5zZWFyY2guc3RyPVwiXCIsdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5kb209ZSgpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKHQsaSxzLG4pe2lmKHQ9ci5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksdCYmLTEhPT1lLmluQXJyYXkodC5pZCx0aGlzLl9kYXRhLnNlYXJjaC5yZXMpKXt2YXIgYSxvLGQ9bnVsbDtmb3IoYT0wLG89dC5jaGlsZE5vZGVzLmxlbmd0aDtvPmE7YSsrKWlmKHQuY2hpbGROb2Rlc1thXSYmdC5jaGlsZE5vZGVzW2FdLmNsYXNzTmFtZSYmLTEhPT10LmNoaWxkTm9kZXNbYV0uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtYW5jaG9yXCIpKXtkPXQuY2hpbGROb2Rlc1thXTticmVha31kJiYoZC5jbGFzc05hbWUrPVwiIGpzdHJlZS1zZWFyY2hcIil9cmV0dXJuIHR9fSxmdW5jdGlvbihlKXtlLnZha2F0YS5zZWFyY2g9ZnVuY3Rpb24odCxpLHIpe3I9cnx8e30scj1lLmV4dGVuZCh7fSxlLnZha2F0YS5zZWFyY2guZGVmYXVsdHMsciksci5mdXp6eSE9PSExJiYoci5mdXp6eT0hMCksdD1yLmNhc2VTZW5zaXRpdmU/dDp0LnRvTG93ZXJDYXNlKCk7dmFyIHMsbixhLG8sZD1yLmxvY2F0aW9uLGM9ci5kaXN0YW5jZSxsPXIudGhyZXNob2xkLGg9dC5sZW5ndGg7cmV0dXJuIGg+MzImJihyLmZ1enp5PSExKSxyLmZ1enp5JiYocz0xPDxoLTEsbj1mdW5jdGlvbigpe3ZhciBlPXt9LGk9MDtmb3IoaT0wO2g+aTtpKyspZVt0LmNoYXJBdChpKV09MDtmb3IoaT0wO2g+aTtpKyspZVt0LmNoYXJBdChpKV18PTE8PGgtaS0xO3JldHVybiBlfSgpLGE9ZnVuY3Rpb24oZSx0KXt2YXIgaT1lL2gscj1NYXRoLmFicyhkLXQpO3JldHVybiBjP2krci9jOnI/MTppfSksbz1mdW5jdGlvbihlKXtpZihlPXIuY2FzZVNlbnNpdGl2ZT9lOmUudG9Mb3dlckNhc2UoKSx0PT09ZXx8LTEhPT1lLmluZGV4T2YodCkpcmV0dXJue2lzTWF0Y2g6ITAsc2NvcmU6MH07aWYoIXIuZnV6enkpcmV0dXJue2lzTWF0Y2g6ITEsc2NvcmU6MX07dmFyIGksbyxjLF8sdSxnLGYscCxtLHY9ZS5sZW5ndGgsaj1sLHk9ZS5pbmRleE9mKHQsZCksaz1oK3YseD0xLGI9W107Zm9yKC0xIT09eSYmKGo9TWF0aC5taW4oYSgwLHkpLGopLHk9ZS5sYXN0SW5kZXhPZih0LGQraCksLTEhPT15JiYoaj1NYXRoLm1pbihhKDAseSksaikpKSx5PS0xLGk9MDtoPmk7aSsrKXtmb3IoYz0wLF89aztfPmM7KWEoaSxkK18pPD1qP2M9XzprPV8sXz1NYXRoLmZsb29yKChrLWMpLzIrYyk7Zm9yKGs9XyxnPU1hdGgubWF4KDEsZC1fKzEpLGY9TWF0aC5taW4oZCtfLHYpK2gscD1uZXcgQXJyYXkoZisyKSxwW2YrMV09KDE8PGkpLTEsbz1mO28+PWc7by0tKWlmKG09bltlLmNoYXJBdChvLTEpXSwwPT09aT9wW29dPShwW28rMV08PDF8MSkmbTpwW29dPShwW28rMV08PDF8MSkmbXwoKHVbbysxXXx1W29dKTw8MXwxKXx1W28rMV0scFtvXSZzJiYoeD1hKGksby0xKSxqPj14KSl7aWYoaj14LHk9by0xLGIucHVzaCh5KSwhKHk+ZCkpYnJlYWs7Zz1NYXRoLm1heCgxLDIqZC15KX1pZihhKGkrMSxkKT5qKWJyZWFrO3U9cH1yZXR1cm57aXNNYXRjaDp5Pj0wLHNjb3JlOnh9fSxpPT09ITA/e3NlYXJjaDpvfTpvKGkpfSxlLnZha2F0YS5zZWFyY2guZGVmYXVsdHM9e2xvY2F0aW9uOjAsZGlzdGFuY2U6MTAwLHRocmVzaG9sZDouNixmdXp6eTohMSxjYXNlU2Vuc2l0aXZlOiExfX0oZSksZS5qc3RyZWUuZGVmYXVsdHMuc29ydD1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmdldF90ZXh0KGUpPnRoaXMuZ2V0X3RleHQodCk/MTotMX0sZS5qc3RyZWUucGx1Z2lucy5zb3J0PWZ1bmN0aW9uKHQsaSl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7aS5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3RoaXMuc29ydCh0LnBhcmVudCwhMCl9LHRoaXMpKS5vbihcInJlbmFtZV9ub2RlLmpzdHJlZSBjcmVhdGVfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7dGhpcy5zb3J0KHQucGFyZW50fHx0Lm5vZGUucGFyZW50LCExKSx0aGlzLnJlZHJhd19ub2RlKHQucGFyZW50fHx0Lm5vZGUucGFyZW50LCEwKX0sdGhpcykpLm9uKFwibW92ZV9ub2RlLmpzdHJlZSBjb3B5X25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3RoaXMuc29ydCh0LnBhcmVudCwhMSksdGhpcy5yZWRyYXdfbm9kZSh0LnBhcmVudCwhMCl9LHRoaXMpKX0sdGhpcy5zb3J0PWZ1bmN0aW9uKHQsaSl7dmFyIHIscztpZih0PXRoaXMuZ2V0X25vZGUodCksdCYmdC5jaGlsZHJlbiYmdC5jaGlsZHJlbi5sZW5ndGgmJih0LmNoaWxkcmVuLnNvcnQoZS5wcm94eSh0aGlzLnNldHRpbmdzLnNvcnQsdGhpcykpLGkpKWZvcihyPTAscz10LmNoaWxkcmVuX2QubGVuZ3RoO3M+cjtyKyspdGhpcy5zb3J0KHQuY2hpbGRyZW5fZFtyXSwhMSl9fTt2YXIgdT0hMTtlLmpzdHJlZS5kZWZhdWx0cy5zdGF0ZT17a2V5OlwianN0cmVlXCIsZXZlbnRzOlwiY2hhbmdlZC5qc3RyZWUgb3Blbl9ub2RlLmpzdHJlZSBjbG9zZV9ub2RlLmpzdHJlZSBjaGVja19ub2RlLmpzdHJlZSB1bmNoZWNrX25vZGUuanN0cmVlXCIsdHRsOiExLGZpbHRlcjohMX0sZS5qc3RyZWUucGx1Z2lucy5zdGF0ZT1mdW5jdGlvbih0LGkpe3RoaXMuYmluZD1mdW5jdGlvbigpe2kuYmluZC5jYWxsKHRoaXMpO3ZhciB0PWUucHJveHkoZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub24odGhpcy5zZXR0aW5ncy5zdGF0ZS5ldmVudHMsZS5wcm94eShmdW5jdGlvbigpe3UmJmNsZWFyVGltZW91dCh1KSx1PXNldFRpbWVvdXQoZS5wcm94eShmdW5jdGlvbigpe3RoaXMuc2F2ZV9zdGF0ZSgpfSx0aGlzKSwxMDApfSx0aGlzKSksdGhpcy50cmlnZ2VyKFwic3RhdGVfcmVhZHlcIil9LHRoaXMpO3RoaXMuZWxlbWVudC5vbihcInJlYWR5LmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSxpKXt0aGlzLmVsZW1lbnQub25lKFwicmVzdG9yZV9zdGF0ZS5qc3RyZWVcIix0KSx0aGlzLnJlc3RvcmVfc3RhdGUoKXx8dCgpfSx0aGlzKSl9LHRoaXMuc2F2ZV9zdGF0ZT1mdW5jdGlvbigpe3ZhciB0PXtzdGF0ZTp0aGlzLmdldF9zdGF0ZSgpLHR0bDp0aGlzLnNldHRpbmdzLnN0YXRlLnR0bCxzZWM6K25ldyBEYXRlfTtlLnZha2F0YS5zdG9yYWdlLnNldCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSxKU09OLnN0cmluZ2lmeSh0KSl9LHRoaXMucmVzdG9yZV9zdGF0ZT1mdW5jdGlvbigpe3ZhciB0PWUudmFrYXRhLnN0b3JhZ2UuZ2V0KHRoaXMuc2V0dGluZ3Muc3RhdGUua2V5KTtpZih0KXRyeXt0PUpTT04ucGFyc2UodCl9Y2F0Y2goaSl7cmV0dXJuITF9cmV0dXJuIHQmJnQudHRsJiZ0LnNlYyYmK25ldyBEYXRlLXQuc2VjPnQudHRsPyExOih0JiZ0LnN0YXRlJiYodD10LnN0YXRlKSx0JiZlLmlzRnVuY3Rpb24odGhpcy5zZXR0aW5ncy5zdGF0ZS5maWx0ZXIpJiYodD10aGlzLnNldHRpbmdzLnN0YXRlLmZpbHRlci5jYWxsKHRoaXMsdCkpLHQ/KHRoaXMuZWxlbWVudC5vbmUoXCJzZXRfc3RhdGUuanN0cmVlXCIsZnVuY3Rpb24oaSxyKXtyLmluc3RhbmNlLnRyaWdnZXIoXCJyZXN0b3JlX3N0YXRlXCIse3N0YXRlOmUuZXh0ZW5kKCEwLHt9LHQpfSl9KSx0aGlzLnNldF9zdGF0ZSh0KSwhMCk6ITEpfSx0aGlzLmNsZWFyX3N0YXRlPWZ1bmN0aW9uKCl7cmV0dXJuIGUudmFrYXRhLnN0b3JhZ2UuZGVsKHRoaXMuc2V0dGluZ3Muc3RhdGUua2V5KX19LGZ1bmN0aW9uKGUsdCl7ZS52YWthdGEuc3RvcmFnZT17c2V0OmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShlLHQpfSxnZXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShlKX0sZGVsOmZ1bmN0aW9uKGUpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oZSl9fX0oZSksZS5qc3RyZWUuZGVmYXVsdHMudHlwZXM9e1wiZGVmYXVsdFwiOnt9fSxlLmpzdHJlZS5kZWZhdWx0cy50eXBlc1tlLmpzdHJlZS5yb290XT17fSxlLmpzdHJlZS5wbHVnaW5zLnR5cGVzPWZ1bmN0aW9uKGkscil7dGhpcy5pbml0PWZ1bmN0aW9uKGkscyl7dmFyIG4sYTtpZihzJiZzLnR5cGVzJiZzLnR5cGVzW1wiZGVmYXVsdFwiXSlmb3IobiBpbiBzLnR5cGVzKWlmKFwiZGVmYXVsdFwiIT09biYmbiE9PWUuanN0cmVlLnJvb3QmJnMudHlwZXMuaGFzT3duUHJvcGVydHkobikpZm9yKGEgaW4gcy50eXBlc1tcImRlZmF1bHRcIl0pcy50eXBlc1tcImRlZmF1bHRcIl0uaGFzT3duUHJvcGVydHkoYSkmJnMudHlwZXNbbl1bYV09PT10JiYocy50eXBlc1tuXVthXT1zLnR5cGVzW1wiZGVmYXVsdFwiXVthXSk7ci5pbml0LmNhbGwodGhpcyxpLHMpLHRoaXMuX21vZGVsLmRhdGFbZS5qc3RyZWUucm9vdF0udHlwZT1lLmpzdHJlZS5yb290fSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24odCxpKXtyLnJlZnJlc2guY2FsbCh0aGlzLHQsaSksdGhpcy5fbW9kZWwuZGF0YVtlLmpzdHJlZS5yb290XS50eXBlPWUuanN0cmVlLnJvb3R9LHRoaXMuYmluZD1mdW5jdGlvbigpe3RoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oaSxyKXt2YXIgcyxuLGE9dGhpcy5fbW9kZWwuZGF0YSxvPXIubm9kZXMsZD10aGlzLnNldHRpbmdzLnR5cGVzLGM9XCJkZWZhdWx0XCI7Zm9yKHM9MCxuPW8ubGVuZ3RoO24+cztzKyspYz1cImRlZmF1bHRcIixhW29bc11dLm9yaWdpbmFsJiZhW29bc11dLm9yaWdpbmFsLnR5cGUmJmRbYVtvW3NdXS5vcmlnaW5hbC50eXBlXSYmKGM9YVtvW3NdXS5vcmlnaW5hbC50eXBlKSxhW29bc11dLmRhdGEmJmFbb1tzXV0uZGF0YS5qc3RyZWUmJmFbb1tzXV0uZGF0YS5qc3RyZWUudHlwZSYmZFthW29bc11dLmRhdGEuanN0cmVlLnR5cGVdJiYoYz1hW29bc11dLmRhdGEuanN0cmVlLnR5cGUpLGFbb1tzXV0udHlwZT1jLGFbb1tzXV0uaWNvbj09PSEwJiZkW2NdLmljb24hPT10JiYoYVtvW3NdXS5pY29uPWRbY10uaWNvbik7YVtlLmpzdHJlZS5yb290XS50eXBlPWUuanN0cmVlLnJvb3R9LHRoaXMpKSxyLmJpbmQuY2FsbCh0aGlzKX0sdGhpcy5nZXRfanNvbj1mdW5jdGlvbih0LGkscyl7dmFyIG4sYSxvPXRoaXMuX21vZGVsLmRhdGEsZD1pP2UuZXh0ZW5kKCEwLHt9LGkse25vX2lkOiExfSk6e30sYz1yLmdldF9qc29uLmNhbGwodGhpcyx0LGQscyk7aWYoYz09PSExKXJldHVybiExO2lmKGUuaXNBcnJheShjKSlmb3Iobj0wLGE9Yy5sZW5ndGg7YT5uO24rKyljW25dLnR5cGU9Y1tuXS5pZCYmb1tjW25dLmlkXSYmb1tjW25dLmlkXS50eXBlP29bY1tuXS5pZF0udHlwZTpcImRlZmF1bHRcIixpJiZpLm5vX2lkJiYoZGVsZXRlIGNbbl0uaWQsY1tuXS5saV9hdHRyJiZjW25dLmxpX2F0dHIuaWQmJmRlbGV0ZSBjW25dLmxpX2F0dHIuaWQsY1tuXS5hX2F0dHImJmNbbl0uYV9hdHRyLmlkJiZkZWxldGUgY1tuXS5hX2F0dHIuaWQpO2Vsc2UgYy50eXBlPWMuaWQmJm9bYy5pZF0mJm9bYy5pZF0udHlwZT9vW2MuaWRdLnR5cGU6XCJkZWZhdWx0XCIsaSYmaS5ub19pZCYmKGM9dGhpcy5fZGVsZXRlX2lkcyhjKSk7cmV0dXJuIGN9LHRoaXMuX2RlbGV0ZV9pZHM9ZnVuY3Rpb24odCl7aWYoZS5pc0FycmF5KHQpKXtmb3IodmFyIGk9MCxyPXQubGVuZ3RoO3I+aTtpKyspdFtpXT10aGlzLl9kZWxldGVfaWRzKHRbaV0pO3JldHVybiB0fXJldHVybiBkZWxldGUgdC5pZCx0LmxpX2F0dHImJnQubGlfYXR0ci5pZCYmZGVsZXRlIHQubGlfYXR0ci5pZCx0LmFfYXR0ciYmdC5hX2F0dHIuaWQmJmRlbGV0ZSB0LmFfYXR0ci5pZCx0LmNoaWxkcmVuJiZlLmlzQXJyYXkodC5jaGlsZHJlbikmJih0LmNoaWxkcmVuPXRoaXMuX2RlbGV0ZV9pZHModC5jaGlsZHJlbikpLHR9LHRoaXMuY2hlY2s9ZnVuY3Rpb24oaSxzLG4sYSxvKXtpZihyLmNoZWNrLmNhbGwodGhpcyxpLHMsbixhLG8pPT09ITEpcmV0dXJuITE7cz1zJiZzLmlkP3M6dGhpcy5nZXRfbm9kZShzKSxuPW4mJm4uaWQ/bjp0aGlzLmdldF9ub2RlKG4pO3ZhciBkLGMsbCxoLF89cyYmcy5pZD9vJiZvLm9yaWdpbj9vLm9yaWdpbjplLmpzdHJlZS5yZWZlcmVuY2Uocy5pZCk6bnVsbDtzd2l0Y2goXz1fJiZfLl9tb2RlbCYmXy5fbW9kZWwuZGF0YT9fLl9tb2RlbC5kYXRhOm51bGwsaSl7Y2FzZVwiY3JlYXRlX25vZGVcIjpjYXNlXCJtb3ZlX25vZGVcIjpjYXNlXCJjb3B5X25vZGVcIjppZihcIm1vdmVfbm9kZVwiIT09aXx8LTE9PT1lLmluQXJyYXkocy5pZCxuLmNoaWxkcmVuKSl7aWYoZD10aGlzLmdldF9ydWxlcyhuKSxkLm1heF9jaGlsZHJlbiE9PXQmJi0xIT09ZC5tYXhfY2hpbGRyZW4mJmQubWF4X2NoaWxkcmVuPT09bi5jaGlsZHJlbi5sZW5ndGgpcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAxXCIscmVhc29uOlwibWF4X2NoaWxkcmVuIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitpLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazppLHBvczphLG9iajpzJiZzLmlkP3MuaWQ6ITEscGFyOm4mJm4uaWQ/bi5pZDohMX0pfSwhMTtpZihkLnZhbGlkX2NoaWxkcmVuIT09dCYmLTEhPT1kLnZhbGlkX2NoaWxkcmVuJiYtMT09PWUuaW5BcnJheShzLnR5cGV8fFwiZGVmYXVsdFwiLGQudmFsaWRfY2hpbGRyZW4pKXJldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInR5cGVzXCIsaWQ6XCJ0eXBlc18wMlwiLHJlYXNvbjpcInZhbGlkX2NoaWxkcmVuIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitpLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazppLHBvczphLG9iajpzJiZzLmlkP3MuaWQ6ITEscGFyOm4mJm4uaWQ/bi5pZDohMX0pfSwhMTtpZihfJiZzLmNoaWxkcmVuX2QmJnMucGFyZW50cyl7Zm9yKGM9MCxsPTAsaD1zLmNoaWxkcmVuX2QubGVuZ3RoO2g+bDtsKyspYz1NYXRoLm1heChjLF9bcy5jaGlsZHJlbl9kW2xdXS5wYXJlbnRzLmxlbmd0aCk7Yz1jLXMucGFyZW50cy5sZW5ndGgrMX0oMD49Y3x8Yz09PXQpJiYoYz0xKTtkb3tpZihkLm1heF9kZXB0aCE9PXQmJi0xIT09ZC5tYXhfZGVwdGgmJmQubWF4X2RlcHRoPGMpcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAzXCIscmVhc29uOlwibWF4X2RlcHRoIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitpLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazppLHBvczphLG9iajpzJiZzLmlkP3MuaWQ6ITEscGFyOm4mJm4uaWQ/bi5pZDohMX0pfSwhMTtuPXRoaXMuZ2V0X25vZGUobi5wYXJlbnQpLGQ9dGhpcy5nZXRfcnVsZXMobiksYysrfXdoaWxlKG4pfX1yZXR1cm4hMH0sdGhpcy5nZXRfcnVsZXM9ZnVuY3Rpb24oZSl7aWYoZT10aGlzLmdldF9ub2RlKGUpLCFlKXJldHVybiExO3ZhciBpPXRoaXMuZ2V0X3R5cGUoZSwhMCk7cmV0dXJuIGkubWF4X2RlcHRoPT09dCYmKGkubWF4X2RlcHRoPS0xKSxpLm1heF9jaGlsZHJlbj09PXQmJihpLm1heF9jaGlsZHJlbj0tMSksaS52YWxpZF9jaGlsZHJlbj09PXQmJihpLnZhbGlkX2NoaWxkcmVuPS0xKSxpfSx0aGlzLmdldF90eXBlPWZ1bmN0aW9uKHQsaSl7cmV0dXJuIHQ9dGhpcy5nZXRfbm9kZSh0KSx0P2k/ZS5leHRlbmQoe3R5cGU6dC50eXBlfSx0aGlzLnNldHRpbmdzLnR5cGVzW3QudHlwZV0pOnQudHlwZTohMX0sdGhpcy5zZXRfdHlwZT1mdW5jdGlvbihpLHIpe3ZhciBzLG4sYSxvLGQ7aWYoZS5pc0FycmF5KGkpKXtmb3IoaT1pLnNsaWNlKCksbj0wLGE9aS5sZW5ndGg7YT5uO24rKyl0aGlzLnNldF90eXBlKGlbbl0scik7cmV0dXJuITB9cmV0dXJuIHM9dGhpcy5zZXR0aW5ncy50eXBlcyxpPXRoaXMuZ2V0X25vZGUoaSksc1tyXSYmaT8obz1pLnR5cGUsZD10aGlzLmdldF9pY29uKGkpLGkudHlwZT1yLChkPT09ITB8fHNbb10mJnNbb10uaWNvbiE9PXQmJmQ9PT1zW29dLmljb24pJiZ0aGlzLnNldF9pY29uKGksc1tyXS5pY29uIT09dD9zW3JdLmljb246ITApLCEwKTohMX19LGUuanN0cmVlLmRlZmF1bHRzLnVuaXF1ZT17Y2FzZV9zZW5zaXRpdmU6ITEsZHVwbGljYXRlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrXCIgKFwiK3QrXCIpXCJ9fSxlLmpzdHJlZS5wbHVnaW5zLnVuaXF1ZT1mdW5jdGlvbihpLHIpe3RoaXMuY2hlY2s9ZnVuY3Rpb24odCxpLHMsbixhKXtpZihyLmNoZWNrLmNhbGwodGhpcyx0LGkscyxuLGEpPT09ITEpcmV0dXJuITE7aWYoaT1pJiZpLmlkP2k6dGhpcy5nZXRfbm9kZShpKSxzPXMmJnMuaWQ/czp0aGlzLmdldF9ub2RlKHMpLCFzfHwhcy5jaGlsZHJlbilyZXR1cm4hMDt2YXIgbyxkLGM9XCJyZW5hbWVfbm9kZVwiPT09dD9uOmkudGV4dCxsPVtdLGg9dGhpcy5zZXR0aW5ncy51bmlxdWUuY2FzZV9zZW5zaXRpdmUsXz10aGlzLl9tb2RlbC5kYXRhO2ZvcihvPTAsZD1zLmNoaWxkcmVuLmxlbmd0aDtkPm87bysrKWwucHVzaChoP19bcy5jaGlsZHJlbltvXV0udGV4dDpfW3MuY2hpbGRyZW5bb11dLnRleHQudG9Mb3dlckNhc2UoKSk7c3dpdGNoKGh8fChjPWMudG9Mb3dlckNhc2UoKSksdCl7Y2FzZVwiZGVsZXRlX25vZGVcIjpyZXR1cm4hMDtjYXNlXCJyZW5hbWVfbm9kZVwiOnJldHVybiBvPS0xPT09ZS5pbkFycmF5KGMsbCl8fGkudGV4dCYmaS50ZXh0W2g/XCJ0b1N0cmluZ1wiOlwidG9Mb3dlckNhc2VcIl0oKT09PWMsb3x8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDFcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIrYytcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrdCxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6dCxwb3M6bixvYmo6aSYmaS5pZD9pLmlkOiExLHBhcjpzJiZzLmlkP3MuaWQ6ITF9KX0pLG87Y2FzZVwiY3JlYXRlX25vZGVcIjpyZXR1cm4gbz0tMT09PWUuaW5BcnJheShjLGwpLG98fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzA0XCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2MrXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK3QsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOnQscG9zOm4sb2JqOmkmJmkuaWQ/aS5pZDohMSxwYXI6cyYmcy5pZD9zLmlkOiExfSl9KSxvO2Nhc2VcImNvcHlfbm9kZVwiOnJldHVybiBvPS0xPT09ZS5pbkFycmF5KGMsbCksb3x8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDJcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIrYytcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrdCxkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6dCxwb3M6bixvYmo6aSYmaS5pZD9pLmlkOiExLHBhcjpzJiZzLmlkP3MuaWQ6ITF9KX0pLG87Y2FzZVwibW92ZV9ub2RlXCI6cmV0dXJuIG89aS5wYXJlbnQ9PT1zLmlkJiYoIWF8fCFhLmlzX211bHRpKXx8LTE9PT1lLmluQXJyYXkoYyxsKSxvfHwodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ1bmlxdWVcIixpZDpcInVuaXF1ZV8wM1wiLHJlYXNvbjpcIkNoaWxkIHdpdGggbmFtZSBcIitjK1wiIGFscmVhZHkgZXhpc3RzLiBQcmV2ZW50aW5nOiBcIit0LGRhdGE6SlNPTi5zdHJpbmdpZnkoe2Noazp0LHBvczpuLG9iajppJiZpLmlkP2kuaWQ6ITEscGFyOnMmJnMuaWQ/cy5pZDohMX0pfSksb31yZXR1cm4hMH0sdGhpcy5jcmVhdGVfbm9kZT1mdW5jdGlvbihpLHMsbixhLG8pe2lmKCFzfHxzLnRleHQ9PT10KXtpZihudWxsPT09aSYmKGk9ZS5qc3RyZWUucm9vdCksaT10aGlzLmdldF9ub2RlKGkpLCFpKXJldHVybiByLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxpLHMsbixhLG8pO2lmKG49bj09PXQ/XCJsYXN0XCI6biwhbi50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFvJiYhdGhpcy5pc19sb2FkZWQoaSkpcmV0dXJuIHIuY3JlYXRlX25vZGUuY2FsbCh0aGlzLGkscyxuLGEsbyk7c3x8KHM9e30pO3ZhciBkLGMsbCxoLF8sdT10aGlzLl9tb2RlbC5kYXRhLGc9dGhpcy5zZXR0aW5ncy51bmlxdWUuY2FzZV9zZW5zaXRpdmUsZj10aGlzLnNldHRpbmdzLnVuaXF1ZS5kdXBsaWNhdGU7Zm9yKGM9ZD10aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKSxsPVtdLGg9MCxfPWkuY2hpbGRyZW4ubGVuZ3RoO18+aDtoKyspbC5wdXNoKGc/dVtpLmNoaWxkcmVuW2hdXS50ZXh0OnVbaS5jaGlsZHJlbltoXV0udGV4dC50b0xvd2VyQ2FzZSgpKTtmb3IoaD0xOy0xIT09ZS5pbkFycmF5KGc/YzpjLnRvTG93ZXJDYXNlKCksbCk7KWM9Zi5jYWxsKHRoaXMsZCwrK2gpLnRvU3RyaW5nKCk7cy50ZXh0PWN9cmV0dXJuIHIuY3JlYXRlX25vZGUuY2FsbCh0aGlzLGkscyxuLGEsbyl9fTt2YXIgZz1sLmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7aWYoZy5zZXRBdHRyaWJ1dGUoXCJ1bnNlbGVjdGFibGVcIixcIm9uXCIpLGcuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGcuY2xhc3NOYW1lPVwianN0cmVlLXdob2xlcm93XCIsZy5pbm5lckhUTUw9XCImIzE2MDtcIixlLmpzdHJlZS5wbHVnaW5zLndob2xlcm93PWZ1bmN0aW9uKHQsaSl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7aS5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKFwicmVhZHkuanN0cmVlIHNldF9zdGF0ZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5oaWRlX2RvdHMoKX0sdGhpcykpLm9uKFwiaW5pdC5qc3RyZWUgbG9hZGluZy5qc3RyZWUgcmVhZHkuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbigpe3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LXVsXCIpfSx0aGlzKSkub24oXCJkZXNlbGVjdF9hbGwuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3RoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImNoYW5nZWQuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3RoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIik7dmFyIGkscixzPSExO2ZvcihpPTAscj10LnNlbGVjdGVkLmxlbmd0aDtyPmk7aSsrKXM9dGhpcy5nZXRfbm9kZSh0LnNlbGVjdGVkW2ldLCEwKSxzJiZzLmxlbmd0aCYmcy5jaGlsZHJlbihcIi5qc3RyZWUtd2hvbGVyb3dcIikuYWRkQ2xhc3MoXCJqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwib3Blbl9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLmdldF9ub2RlKHQubm9kZSwhMCkuZmluZChcIi5qc3RyZWUtY2xpY2tlZFwiKS5wYXJlbnQoKS5jaGlsZHJlbihcIi5qc3RyZWUtd2hvbGVyb3dcIikuYWRkQ2xhc3MoXCJqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwiaG92ZXJfbm9kZS5qc3RyZWUgZGVob3Zlcl9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXtcImhvdmVyX25vZGVcIj09PWUudHlwZSYmdGhpcy5pc19kaXNhYmxlZCh0Lm5vZGUpfHx0aGlzLmdldF9ub2RlKHQubm9kZSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpW1wiaG92ZXJfbm9kZVwiPT09ZS50eXBlP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLXdob2xlcm93LWhvdmVyZWRcIil9LHRoaXMpKS5vbihcImNvbnRleHRtZW51LmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvd1wiLGUucHJveHkoZnVuY3Rpb24odCl7dC5wcmV2ZW50RGVmYXVsdCgpO3ZhciBpPWUuRXZlbnQoXCJjb250ZXh0bWVudVwiLHttZXRhS2V5OnQubWV0YUtleSxjdHJsS2V5OnQuY3RybEtleSxhbHRLZXk6dC5hbHRLZXksc2hpZnRLZXk6dC5zaGlmdEtleSxwYWdlWDp0LnBhZ2VYLHBhZ2VZOnQucGFnZVl9KTtlKHQuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihpKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLXdob2xlcm93XCIsZnVuY3Rpb24odCl7dC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTt2YXIgaT1lLkV2ZW50KFwiY2xpY2tcIix7bWV0YUtleTp0Lm1ldGFLZXksY3RybEtleTp0LmN0cmxLZXksYWx0S2V5OnQuYWx0S2V5LHNoaWZ0S2V5OnQuc2hpZnRLZXl9KTtlKHQuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihpKS5mb2N1cygpfSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtbGVhZiA+IC5qc3RyZWUtb2NsXCIsZS5wcm94eShmdW5jdGlvbih0KXt0LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO3ZhciBpPWUuRXZlbnQoXCJjbGlja1wiLHttZXRhS2V5OnQubWV0YUtleSxjdHJsS2V5OnQuY3RybEtleSxhbHRLZXk6dC5hbHRLZXksc2hpZnRLZXk6dC5zaGlmdEtleX0pO2UodC5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZmlyc3QoKS50cmlnZ2VyKGkpLmZvY3VzKCl9LHRoaXMpKS5vbihcIm1vdXNlb3Zlci5qc3RyZWVcIixcIi5qc3RyZWUtd2hvbGVyb3csIC5qc3RyZWUtaWNvblwiLGUucHJveHkoZnVuY3Rpb24oZSl7cmV0dXJuIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdGhpcy5pc19kaXNhYmxlZChlLmN1cnJlbnRUYXJnZXQpfHx0aGlzLmhvdmVyX25vZGUoZS5jdXJyZW50VGFyZ2V0KSwhMX0sdGhpcykpLm9uKFwibW91c2VsZWF2ZS5qc3RyZWVcIixcIi5qc3RyZWUtbm9kZVwiLGUucHJveHkoZnVuY3Rpb24oZSl7dGhpcy5kZWhvdmVyX25vZGUoZS5jdXJyZW50VGFyZ2V0KX0sdGhpcykpfSx0aGlzLnRlYXJkb3duPWZ1bmN0aW9uKCl7dGhpcy5zZXR0aW5ncy53aG9sZXJvdyYmdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLXdob2xlcm93XCIpLnJlbW92ZSgpLGkudGVhcmRvd24uY2FsbCh0aGlzKX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbih0LHIscyxuKXtpZih0PWkucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpKXt2YXIgYT1nLmNsb25lTm9kZSghMCk7LTEhPT1lLmluQXJyYXkodC5pZCx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQpJiYoYS5jbGFzc05hbWUrPVwiIGpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkJiZ0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD09PXQuaWQmJihhLmNsYXNzTmFtZSs9XCIganN0cmVlLXdob2xlcm93LWhvdmVyZWRcIiksdC5pbnNlcnRCZWZvcmUoYSx0LmNoaWxkTm9kZXNbMF0pfXJldHVybiB0fX0sbC5yZWdpc3RlckVsZW1lbnQmJk9iamVjdCYmT2JqZWN0LmNyZWF0ZSl7dmFyIGY9T2JqZWN0LmNyZWF0ZShIVE1MRWxlbWVudC5wcm90b3R5cGUpO2YuY3JlYXRlZENhbGxiYWNrPWZ1bmN0aW9uKCl7dmFyIHQsaT17Y29yZTp7fSxwbHVnaW5zOltdfTtmb3IodCBpbiBlLmpzdHJlZS5wbHVnaW5zKWUuanN0cmVlLnBsdWdpbnMuaGFzT3duUHJvcGVydHkodCkmJnRoaXMuYXR0cmlidXRlc1t0XSYmKGkucGx1Z2lucy5wdXNoKHQpLHRoaXMuZ2V0QXR0cmlidXRlKHQpJiZKU09OLnBhcnNlKHRoaXMuZ2V0QXR0cmlidXRlKHQpKSYmKGlbdF09SlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZSh0KSkpKTtmb3IodCBpbiBlLmpzdHJlZS5kZWZhdWx0cy5jb3JlKWUuanN0cmVlLmRlZmF1bHRzLmNvcmUuaGFzT3duUHJvcGVydHkodCkmJnRoaXMuYXR0cmlidXRlc1t0XSYmKGkuY29yZVt0XT1KU09OLnBhcnNlKHRoaXMuZ2V0QXR0cmlidXRlKHQpKXx8dGhpcy5nZXRBdHRyaWJ1dGUodCkpO2UodGhpcykuanN0cmVlKGkpfTt0cnl7bC5yZWdpc3RlckVsZW1lbnQoXCJ2YWthdGEtanN0cmVlXCIse3Byb3RvdHlwZTpmfSl9Y2F0Y2gocCl7fX19fSk7IiwiLypcbiAqIGh0dHA6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZFxuICpcbiAqIFRoaXMgcGx1Z2luIGhhbmRsZXMgYWRkaW5nIGEgZ3JpZCB0byBhIHRyZWUgdG8gZGlzcGxheSBhZGRpdGlvbmFsIGRhdGFcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2U6XG4gKiAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG4gKlxuICogV29ya3Mgb25seSB3aXRoIGpzdHJlZSB2ZXJzaW9uID49IDMuMC4wXG4gKlxuICogJERhdGU6IDIwMTUtMTEtMjkgJFxuICogJFJldmlzaW9uOiAgMy40LjIgJFxuICovXG4hZnVuY3Rpb24oZSl7XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXCJqcXVlcnlcIixcImpzdHJlZVwiXSxlKTplKGpRdWVyeSl9KGZ1bmN0aW9uKGUpe3ZhciB0LGkscixzLGQsbj0vXlxccyokL2csYT0vW1xcXFw6JiFefCgpXFxbXFxdPD5AKicrfiNcIjssPSBcXC8ke30lXS9nLG89ZnVuY3Rpb24oZSl7cmV0dXJuKGV8fFwiXCIpLnJlcGxhY2UoYSxcIlxcXFwkJlwiKX0sbD1cImRhdGEtanN0cmVlZ3JpZFwiLGg9XCJfREFUQV9cIixjPTI0LHA9ITEsZz1cImpzZ3JpZF9cIix1PVwiX2NvbFwiLGY9MTAsdj1mdW5jdGlvbihlLHQpe3JldHVybiBlLmZpbmQoXCJkaXZbXCIrbCtcIj0nXCIrdCtcIiddXCIpfSxtPSExLGo9bnVsbCxfPTAsdz0wO3M9LzxcXC8/W14+XSs+L2dpLHI9ZnVuY3Rpb24odCxpKXt2YXIgcixzLGQsbjtyZXR1cm4gaS5fZ3JpZFNldHRpbmdzPWkuX2dyaWRTZXR0aW5nc3x8e30saS5fZ3JpZFNldHRpbmdzLmluZGVudD4wP249aS5fZ3JpZFNldHRpbmdzLmluZGVudDoocj1lKFwiPGRpdj48L2Rpdj5cIikscz10LnByZXYoXCJpXCIpLGQ9cy5wYXJlbnQoKSxyLmFkZENsYXNzKGkuZ2V0X25vZGUoXCIjXCIsITApLmF0dHIoXCJjbGFzc1wiKSksZC5hcHBlbmRUbyhyKSxyLmFwcGVuZFRvKGUoXCJib2R5XCIpKSxuPXMud2lkdGgoKXx8YyxkLmRldGFjaCgpLHIucmVtb3ZlKCksaS5fZ3JpZFNldHRpbmdzLmluZGVudD1uKSxufSxkPWZ1bmN0aW9uKGUsdCl7dmFyIGkscj1lLmdldF9ub2RlKHQpLHM9ci5jaGlsZHJlbjtyZXR1cm4gaT0hc3x8cy5sZW5ndGg8PTB8fCFyLnN0YXRlLm9wZW5lZD90OmQoZSxzW3MubGVuZ3RoLTFdKX0sdD1mdW5jdGlvbihlLHQpe3ZhciBpLHMsZD1wYXJzZUludCh0LnNldHRpbmdzLmdyaWQuY29sdW1uc1swXS53aWR0aCwxMCkrcGFyc2VJbnQodC5fZ3JpZFNldHRpbmdzLnRyZWVXaWR0aERpZmYsMTApO3JldHVybiBpPXQuZ2V0X25vZGUoZSkucGFyZW50cy5sZW5ndGgscz1kLWkqcihlLHQpLGR9LGk9ZnVuY3Rpb24oZSx0LGkpe3ZhciByLGQ9XCJhXCI9PT1lLmdldCgwKS50YWdOYW1lLnRvTG93ZXJDYXNlKCk/ZTplLmNoaWxkcmVuKFwiYVwiKSxuPWkuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zWzBdO3I9XCJcIixuLnRpdGxlJiYobi50aXRsZT09PWg/cj1pLmdldF90ZXh0KHQpOnQuYXR0cihuLnRpdGxlKSYmKHI9dC5hdHRyKG4udGl0bGUpKSkscj1yLnJlcGxhY2UocyxcIlwiKSxyJiZkLmF0dHIoXCJ0aXRsZVwiLHIpfSxlLmpzdHJlZS5kZWZhdWx0cy5ncmlkPXt3aWR0aDpcImF1dG9cIn0sZS5qc3RyZWUucGx1Z2lucy5ncmlkPWZ1bmN0aW9uKHQscil7dGhpcy5faW5pdGlhbGl6ZT1mdW5jdGlvbigpe2lmKCF0aGlzLl9pbml0aWFsaXplZCl7dmFyIHQsaSxyPXRoaXMuc2V0dGluZ3MuZ3JpZHx8e30scz10aGlzLmVsZW1lbnQsZD1zLnBhcmVudCgpLG49dGhpcy5fZ3JpZFNldHRpbmdzPXtjb2x1bW5zOnIuY29sdW1uc3x8W10sdHJlZUNsYXNzOlwianN0cmVlLWdyaWQtY29sLTBcIixjb250ZXh0OnIuY29udGV4dG1lbnV8fCExLGNvbHVtbldpZHRoOnIuY29sdW1uV2lkdGgsZGVmYXVsdENvbmY6e1wiKmRpc3BsYXlcIjpcImlubGluZVwiLFwiKitkaXNwbGF5XCI6XCJpbmxpbmVcIn0saXNUaGVtZXJvbGxlcjohIXRoaXMuX2RhdGEudGhlbWVyb2xsZXIsdHJlZVdpZHRoRGlmZjowLHJlc2l6YWJsZTpyLnJlc2l6YWJsZSxzdGF0ZWZ1bDpyLnN0YXRlZnVsLGluZGVudDowfSxhPW4uY29sdW1ucyxvPTA7Zm9yKGk9MDtpPHIuY29sdW1ucy5sZW5ndGg7aSsrKWlmKHIuY29sdW1uc1tpXS50cmVlKXtvPWk7YnJlYWt9dGhpcy51bmlxPU1hdGguY2VpbCgxZTMqTWF0aC5yYW5kb20oKSksdGhpcy50cmVlY29sPW8sdGhpcy5yb290aWQ9cy5hdHRyKFwiaWRcIik7dmFyIGw9L21zaWUvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKTtpZihsKXt2YXIgaD1wYXJzZUZsb2F0KG5hdmlnYXRvci5hcHBWZXJzaW9uLnNwbGl0KFwiTVNJRVwiKVsxXSk7OD5oJiYobi5kZWZhdWx0Q29uZi5kaXNwbGF5PVwiaW5saW5lXCIsbi5kZWZhdWx0Q29uZi56b29tPVwiMVwiKX1mb3IocHx8KHA9ITAsdD1bXCIuanN0cmVlLWdyaWQtY2VsbCB7dmVydGljYWwtYWxpZ246IHRvcDsgb3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1sZWZ0OjA7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6IDEwMCU7cGFkZGluZy1sZWZ0OjdweDt3aGl0ZS1zcGFjZTogbm93cmFwO31cIixcIi5qc3RyZWUtZ3JpZC1jZWxsIHNwYW4ge21hcmdpbi1yaWdodDowcHg7bWFyZ2luLXJpZ2h0OjBweDsqZGlzcGxheTppbmxpbmU7KitkaXNwbGF5OmlubGluZTt3aGl0ZS1zcGFjZTogbm93cmFwO31cIixcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3Ige3Bvc2l0aW9uOmFic29sdXRlOyB0b3A6MDsgcmlnaHQ6MDsgaGVpZ2h0OjI0cHg7IG1hcmdpbi1sZWZ0OiAtMnB4OyBib3JkZXItd2lkdGg6IDAgMnB4IDAgMDsgKmRpc3BsYXk6aW5saW5lOyAqK2Rpc3BsYXk6aW5saW5lOyBtYXJnaW4tcmlnaHQ6MHB4O3dpZHRoOjBweDt9XCIsXCIuanN0cmVlLWdyaWQtaGVhZGVyLWNlbGwge292ZXJmbG93OiBoaWRkZW47IHdoaXRlLXNwYWNlOiBub3dyYXA7cGFkZGluZzogMXB4IDNweCAycHggNXB4O31cIixcIi5qc3RyZWUtZ3JpZC1oZWFkZXItdGhlbWVyb2xsZXIge2JvcmRlcjogMDsgcGFkZGluZzogMXB4IDNweDt9XCIsXCIuanN0cmVlLWdyaWQtaGVhZGVyLXJlZ3VsYXIge3Bvc2l0aW9uOnJlbGF0aXZlOyBiYWNrZ3JvdW5kLWNvbG9yOiAjRUJGM0ZEO31cIixcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yIHtjdXJzb3I6IGNvbC1yZXNpemU7IHdpZHRoOiAycHg7fVwiLFwiLmpzdHJlZS1ncmlkLXNlcGFyYXRvci1yZWd1bGFyIHtib3JkZXItY29sb3I6ICNkMGQwZDA7IGJvcmRlci1zdHlsZTogc29saWQ7fVwiLFwiLmpzdHJlZS1ncmlkLWNlbGwtdGhlbWVyb2xsZXIge2JvcmRlcjogbm9uZSAhaW1wb3J0YW50OyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudCAhaW1wb3J0YW50O31cIixcIi5qc3RyZWUtZ3JpZC13cmFwcGVyIHt3aWR0aDogMTAwJTsgb3ZlcmZsb3cteDogYXV0bzt9XCIsXCIuanN0cmVlLWdyaWQtbWlkd3JhcHBlciB7ZGlzcGxheTogdGFibGUtcm93OyBvdmVyZmxvdzogdmlzaWJsZTt9XCIsXCIuanN0cmVlLWdyaWQtd2lkdGgtYXV0byB7d2lkdGg6YXV0bztkaXNwbGF5OmJsb2NrO31cIixcIi5qc3RyZWUtZ3JpZC1jb2x1bW4ge2Rpc3BsYXk6IHRhYmxlLWNlbGw7IG92ZXJmbG93OiBoaWRkZW47fVwiLFwiLmpzdHJlZS1ncmlkLWNvbC0wIHt3aWR0aDogMTAwJTt9XCJdLGUoJzxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj4nK3Quam9pbihcIlxcblwiKStcIjwvc3R5bGU+XCIpLmFwcGVuZFRvKFwiaGVhZFwiKSksdGhpcy5ncmlkV3JhcHBlcj1lKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmFwcGVuZFRvKGQpLHRoaXMubWlkV3JhcHBlcj1lKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1taWR3cmFwcGVyXCIpLmFwcGVuZFRvKHRoaXMuZ3JpZFdyYXBwZXIpLHIud2lkdGgmJnRoaXMuZ3JpZFdyYXBwZXIud2lkdGgoci53aWR0aCksaT0wO2k8YS5sZW5ndGg7aSsrKWUoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNvbHVtbiBqc3RyZWUtZ3JpZC1jb2x1bW4tXCIraStcIiBqc3RyZWUtZ3JpZC1jb2x1bW4tcm9vdC1cIit0aGlzLnJvb3RpZCkuYXBwZW5kVG8odGhpcy5taWRXcmFwcGVyKTt0aGlzLm1pZFdyYXBwZXIuY2hpbGRyZW4oXCJkaXY6ZXEoXCIrbytcIilcIikuYXBwZW5kKHMpLHMuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jZWxsXCIpLHRoaXMuX2luaXRpYWxpemVkPSEwfX0sdGhpcy5pbml0PWZ1bmN0aW9uKGUsdCl7ci5pbml0LmNhbGwodGhpcyxlLHQpLHRoaXMuX2luaXRpYWxpemUoKX0sdGhpcy5iaW5kPWZ1bmN0aW9uKCl7ci5iaW5kLmNhbGwodGhpcyksdGhpcy5faW5pdGlhbGl6ZSgpLHRoaXMuZWxlbWVudC5vbihcIm1vdmVfbm9kZS5qc3RyZWUgY3JlYXRlX25vZGUuanN0cmVlIGNsZWFuX25vZGUuanN0cmVlIGNoYW5nZV9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLmdldF9ub2RlKHR8fFwiI1wiLCEwKTtyZXR1cm4gJycsITF9LHRoaXMpKS5vbihcImRlbGV0ZV9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXtpZih2b2lkIDAhPT10Lm5vZGUuaWQpe3ZhciBpLHI9dGhpcy5ncmlkV3JhcHBlcixzPVt0Lm5vZGUuaWRdO2Zvcih0Lm5vZGUmJnQubm9kZS5jaGlsZHJlbl9kJiYocz1zLmNvbmNhdCh0Lm5vZGUuY2hpbGRyZW5fZCkpLGk9MDtpPHMubGVuZ3RoO2krKyl2KHIsc1tpXSkucmVtb3ZlKCl9fSx0aGlzKSkub24oXCJjbG9zZV9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0aGlzLl9oaWRlX2dyaWQodC5ub2RlKX0sdGhpcykpLm9uKFwib3Blbl9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt9LHRoaXMpKS5vbihcImxvYWRfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCl7fSx0aGlzKSkub24oXCJsb2FkZWQuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlKXt0aGlzLl9wcmVwYXJlX2hlYWRlcnMoKSx0aGlzLmVsZW1lbnQudHJpZ2dlcihcImxvYWRlZF9ncmlkLmpzdHJlZVwiKX0sdGhpcykpLm9uKFwicmVhZHkuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbih0LGkpe3ZhciByPXRoaXMuZWxlbWVudC5maW5kKFwibGkgYTpmaXJzdFwiKS5vdXRlckhlaWdodCgpO2UoJzxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj5kaXYuanN0cmVlLWdyaWQtY2VsbC1yb290LScrdGhpcy5yb290aWQrXCIge2xpbmUtaGVpZ2h0OiBcIityK1wicHh9PC9zdHlsZT5cIikuYXBwZW5kVG8oXCJoZWFkXCIpLHRoaXMuZ3JpZFdyYXBwZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50LmF0dHIoXCJjbGFzc1wiKSl9LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKHQsaSl7dmFyIHI9aS5uZXdfaW5zdGFuY2UuZWxlbWVudDtyLmZpbmQoXCJsaSA+IGFcIikuZWFjaChlLnByb3h5KGZ1bmN0aW9uKGUsdCl7fSx0aGlzKSl9LHRoaXMpKS5vbihcImhvdmVyX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQsaSl7dmFyIHI9dC5ub2RlLmlkO251bGwhPT10aGlzLl9ob3Zlcl9ub2RlJiZ2b2lkIDAhPT10aGlzLl9ob3Zlcl9ub2RlJiZ2KHRoaXMuZ3JpZFdyYXBwZXIsdGhpcy5faG92ZXJfbm9kZSkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKSx0aGlzLl9ob3Zlcl9ub2RlPXIsdih0aGlzLmdyaWRXcmFwcGVyLHIpLmFkZENsYXNzKFwianN0cmVlLWhvdmVyZWRcIil9LHRoaXMpKS5vbihcImRlaG92ZXJfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCxpKXt2YXIgcj10Lm5vZGUuaWQ7dGhpcy5faG92ZXJfbm9kZT1udWxsLHYodGhpcy5ncmlkV3JhcHBlcixyKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpfSx0aGlzKSkub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCxpKXt2YXIgcj10Lm5vZGUuaWQ7dih0aGlzLmdyaWRXcmFwcGVyLHIpLmFkZENsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksdGhpcy5nZXRfbm9kZSh0Lm5vZGUuaWQsITApLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGxcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwiZGVzZWxlY3Rfbm9kZS5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCxpKXt2YXIgcj10Lm5vZGUuaWQ7dih0aGlzLmdyaWRXcmFwcGVyLHIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImRlc2VsZWN0X2FsbC5qc3RyZWVcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCxpKXt2YXIgcixzPXQubm9kZXx8W107Zm9yKHI9MDtyPHMubGVuZ3RoO3IrKyl2KHRoaXMuZ3JpZFdyYXBwZXIsc1tyXSkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwic2VhcmNoLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt2YXIgaT10aGlzLmdyaWRXcmFwcGVyO3JldHVybiB0aGlzLl9kYXRhLnNlYXJjaC5zb20mJnQubm9kZXMubGVuZ3RoJiYoaS5maW5kKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGwtcmVndWxhclwiKS5oaWRlKCksdC5ub2Rlcy5hZGQodC5ub2Rlcy5wYXJlbnRzVW50aWwoXCIuanN0cmVlXCIpKS5maWx0ZXIoXCIuanN0cmVlLW5vZGVcIikuZWFjaChmdW5jdGlvbihlLHQpe3ZhciByPXQuaWQ7ciYmdihpLHIpLnNob3coKX0pKSwhMH0sdGhpcykpLm9uKFwiY2xlYXJfc2VhcmNoLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5ncmlkV3JhcHBlci5maW5kKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGxcIikuc2hvdygpLCEwfSx0aGlzKSksdGhpcy5fZ3JpZFNldHRpbmdzLmlzVGhlbWVyb2xsZXImJnRoaXMuZWxlbWVudC5vbihcInNlbGVjdF9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0LnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpfSx0aGlzKSkub24oXCJkZXNlbGVjdF9ub2RlLmpzdHJlZSBkZXNlbGVjdF9hbGwuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3QucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIil9LHRoaXMpKS5vbihcImhvdmVyX25vZGUuanN0cmVlXCIsZS5wcm94eShmdW5jdGlvbihlLHQpe3QucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sdGhpcykpLm9uKFwiZGVob3Zlcl9ub2RlLmpzdHJlZVwiLGUucHJveHkoZnVuY3Rpb24oZSx0KXt0LnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9LHRoaXMpKSx0aGlzLl9ncmlkU2V0dGluZ3Muc3RhdGVmdWwmJnRoaXMuZWxlbWVudC5vbihcInJlc2l6ZV9jb2x1bW4uanN0cmVlLWdyaWRcIixlLnByb3h5KGZ1bmN0aW9uKGUsdCxpKXtsb2NhbFN0b3JhZ2VbXCJqc3RyZWUtcm9vdC1cIit0aGlzLnJvb3RpZCtcIi1jb2x1bW4tXCIrdF09aX0sdGhpcykpfSx0aGlzLnRlYXJkb3duPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ncmlkV3JhcHBlcix0PXRoaXMuZWxlbWVudCxpPWUucGFyZW50KCk7dC5kZXRhY2goKSxlLnJlbW92ZSgpLGkuYXBwZW5kKHQpLHIudGVhcmRvd24uY2FsbCh0aGlzKX0sdGhpcy5fY2xlYW5fZ3JpZD1mdW5jdGlvbihlLHQpe3ZhciBpPXRoaXMuZ3JpZFdyYXBwZXI7ZT92KGksdCkucmVtb3ZlKCk6aS5maW5kKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGwtcmVndWxhclwiKS5yZW1vdmUoKX0sdGhpcy5fcHJlcGFyZV9oZWFkZXJzPWZ1bmN0aW9uKCl7dmFyIHQsaSxyLHMsZCxuLGEsbyxsLGgsYz10aGlzLl9ncmlkU2V0dGluZ3MscD1jLmNvbHVtbnN8fFtdLGc9Yy5jb2x1bW5XaWR0aCx1PWMucmVzaXphYmxlfHwhMSx2PWMuaXNUaGVtZXJvbGxlcix4PXY/XCJ0aGVtZXJvbGxlclwiOlwicmVndWxhclwiLHk9ITEsQz10aGlzLmdyaWRwYXJlbnQsYj10aGlzLnJvb3RpZCxXPWMuZGVmYXVsdENvbmYsUz0wLHo9MDtmb3IodGhpcy5wYXJlbnQ9QyxpPTA7aTxwLmxlbmd0aDtpKyspZD1wW2ldLmhlYWRlckNsYXNzfHxcIlwiLG49cFtpXS5jb2x1bW5DbGFzc3x8XCJcIixhPXBbaV0uaGVhZGVyfHxcIlwiLGEmJih5PSEwKSxzPWMuc3RhdGVmdWwmJmxvY2FsU3RvcmFnZVtcImpzdHJlZS1yb290LVwiK2IrXCItY29sdW1uLVwiK2ldP2xvY2FsU3RvcmFnZVtcImpzdHJlZS1yb290LVwiK2IrXCItY29sdW1uLVwiK2ldOnBbaV0ud2lkdGh8fGcsUz12Pzc6MTAsXCJhdXRvXCIhPT1zJiZcInN0cmluZ1wiIT10eXBlb2YgcyYmKHMtPVMpLG89MD09PWk/MzowLHI9dGhpcy5taWRXcmFwcGVyLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtbi1cIitpKSxsPWUoXCI8ZGl2PjwvZGl2PlwiKS5jc3MoVykuY3NzKHtcIm1hcmdpbi1sZWZ0XCI6b30pLmFkZENsYXNzKFwianN0cmVlLWdyaWQtZGl2LVwiK3RoaXMudW5pcStcIi1cIitpK1wiIFwiKyh2P1widWktd2lkZ2V0LWhlYWRlciBcIjpcIlwiKStcIiBqc3RyZWUtZ3JpZC1oZWFkZXIganN0cmVlLWdyaWQtaGVhZGVyLWNlbGwganN0cmVlLWdyaWQtaGVhZGVyLVwiK3grXCIgXCIrZCtcIiBcIituKS5odG1sKGEpLGwuYWRkQ2xhc3MoKHY/XCJ1aS13aWRnZXQtaGVhZGVyIFwiOlwiXCIpK1wianN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1cIit4KSxsLnByZXBlbmRUbyhyKSx6Kz1sLm91dGVyV2lkdGgoKSxoPWUoXCI8ZGl2IGNsYXNzPSdqc3RyZWUtZ3JpZC1zZXBhcmF0b3IganN0cmVlLWdyaWQtc2VwYXJhdG9yLVwiK3grKHY/XCIgdWktd2lkZ2V0LWhlYWRlclwiOlwiXCIpKyh1P1wiIGpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIjpcIlwiKStcIic+Jm5ic3A7PC9kaXY+XCIpLmFwcGVuZFRvKGwpLHIud2lkdGgocyksci5jc3MoXCJtaW4td2lkdGhcIixzKSxyLmNzcyhcIm1heC13aWR0aFwiLHMpO2wuYWRkQ2xhc3MoKHY/XCJ1aS13aWRnZXQtaGVhZGVyIFwiOlwiXCIpK1wianN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1sYXN0IGpzdHJlZS1ncmlkLWhlYWRlci1cIit4KSx2b2lkIDA9PT1wW3AubGVuZ3RoLTFdLndpZHRoJiYoei09cyxyLmNzcyh7d2lkdGg6XCJhdXRvXCJ9KSxsLmFkZENsYXNzKFwianN0cmVlLWdyaWQtd2lkdGgtYXV0b1wiKS5uZXh0KFwiLmpzdHJlZS1ncmlkLXNlcGFyYXRvclwiKS5yZW1vdmUoKSkseT9jLmhlYWRlcj10OmUoXCJkaXYuanN0cmVlLWdyaWQtaGVhZGVyXCIpLmhpZGUoKSwhdGhpcy5ib3VuZCYmdSYmKHRoaXMuYm91bmQ9ITAsZShkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbigpe3ZhciB0LGkscixzLGQsbjttJiYobj1qLnByZXZBbGwoXCIuanN0cmVlLWdyaWQtY29sdW1uXCIpLmxlbmd0aCxkPWouY2xvc2VzdChcIi5qc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmZpbmQoXCIuanN0cmVlXCIpLHQ9ZS5qc3RyZWUucmVmZXJlbmNlKGQpLGk9dC5zZXR0aW5ncy5ncmlkLmNvbHVtbnMscz1qLnBhcmVudCgpLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKSwoaXNOYU4obil8fDA+bikmJih0Ll9ncmlkU2V0dGluZ3MudHJlZVdpZHRoRGlmZj1kLmZpbmQoXCJpbnM6ZXEoMClcIikud2lkdGgoKStkLmZpbmQoXCJhOmVxKDApXCIpLndpZHRoKCktdC5fZ3JpZFNldHRpbmdzLmNvbHVtbnNbMF0ud2lkdGgpLHI9dC5fZ3JpZFNldHRpbmdzLmNvbHVtbnNbbl0ud2lkdGg9cGFyc2VGbG9hdChqLmNzcyhcIndpZHRoXCIpKSxtPSExLGo9bnVsbCxkLnRyaWdnZXIoXCJyZXNpemVfY29sdW1uLmpzdHJlZS1ncmlkXCIsW24scl0pKX0pLm1vdXNlbW92ZShmdW5jdGlvbihlKXtpZihtKXt3PWUucGFnZVg7dmFyIHQsaSxyLHM9dy1fOzAhPT1zJiYodD1qLndpZHRoKCksaT1wYXJzZUZsb2F0KGouY3NzKFwid2lkdGhcIikpLGl8fChpPWouaW5uZXJXaWR0aCgpKSxzPTA+cz9NYXRoLm1heChzLC10KTpzLHI9aStzLChzPjB8fHQ+MCkmJnI+ZiYmKGoud2lkdGgocitcInB4XCIpLGouY3NzKFwibWluLXdpZHRoXCIscitcInB4XCIpLGouY3NzKFwibWF4LXdpZHRoXCIscitcInB4XCIpLF89dykpfX0pLHRoaXMuZ3JpZFdyYXBwZXIub24oXCJzZWxlY3RzdGFydFwiLFwiLmpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIixmdW5jdGlvbigpe3JldHVybiExfSkub24oXCJtb3VzZWRvd25cIixcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsZnVuY3Rpb24odCl7cmV0dXJuIG09ITAsXz10LnBhZ2VYLGo9ZSh0aGlzKS5jbG9zZXN0KFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKSwhMX0pLm9uKFwiZGJsY2xpY2tcIixcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsZnVuY3Rpb24odCl7dmFyIGkscixzPWUodGhpcyksZD1zLmNsb3Nlc3QoXCJkaXYuanN0cmVlLWdyaWQtY29sdW1uXCIpLG49cGFyc2VGbG9hdChkLmNzcyhcIndpZHRoXCIpKSxhPTAsbz1kLnByZXZBbGwoXCIuanN0cmVlLWdyaWQtY29sdW1uXCIpLmxlbmd0aCxsPWQud2lkdGgoKTtkLmZpbmQoXCIuanN0cmVlLWdyaWQtY2VsbFwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQsaT1lKHRoaXMpO2kuY3NzKFwicG9zaXRpb25cIixcImFic29sdXRlXCIpLGkuY3NzKFwid2lkdGhcIixcImF1dG9cIiksdD1pLm91dGVyV2lkdGgoKSxpLmNzcyhcInBvc2l0aW9uXCIsXCJyZWxhdGl2ZVwiKSx0PmEmJihhPXQpfSksaT1hLW4saT0wPmk/TWF0aC5tYXgoaSwtbCk6aSxyPW4raStcInB4XCIsZC53aWR0aChyKSxkLmNzcyhcIm1pbi13aWR0aFwiLHIpLGQuY3NzKFwibWF4LXdpZHRoXCIsciksZSh0aGlzKS5jbG9zZXN0KFwiLmpzdHJlZS1ncmlkLXdyYXBwZXJcIikuZmluZChcIi5qc3RyZWVcIikudHJpZ2dlcihcInJlc2l6ZV9jb2x1bW4uanN0cmVlLWdyaWRcIixbbyxyXSl9KSl9LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oZSx0LGkscyl7cmV0dXJuIGU9ci5yZWRyYXdfbm9kZS5jYWxsKHRoaXMsZSx0LGkscyksZSYmdGhpcy5fcHJlcGFyZV9ncmlkKGUpLGV9LHRoaXMucmVmcmVzaD1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9jbGVhbl9ncmlkKCksci5yZWZyZXNoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdGhpcy5zZXRfaWQ9ZnVuY3Rpb24oZSx0KXt2YXIgaTtlJiYoaT1lLmlkKTt2YXIgcz1yLnNldF9pZC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7aWYocyYmdm9pZCAwIT09aSl7dmFyIGQsbj10aGlzLmdyaWRXcmFwcGVyLGE9W2ldO2ZvcihlJiZlLmNoaWxkcmVuX2QmJihhPWEuY29uY2F0KGUuY2hpbGRyZW5fZCkpLGQ9MDtkPGEubGVuZ3RoO2QrKyl2KG4sYVtkXSkuYXR0cihsLGUuaWQpLmF0dHIoXCJpZFwiLGcrZS5pZCt1KyhkKzEpKS5yZW1vdmVDbGFzcyhnK2krdSkuYWRkQ2xhc3MoZytlLmlkK3UpfXJldHVybiBzfSx0aGlzLl9oaWRlX2dyaWQ9ZnVuY3Rpb24oZSl7dmFyIHQsaT1lJiZlLmNoaWxkcmVuX2Q/ZS5jaGlsZHJlbl9kOltdO2Zvcih0PTA7dDxpLmxlbmd0aDt0Kyspdih0aGlzLmdyaWRXcmFwcGVyLGlbdF0pLnJlbW92ZSgpfSx0aGlzLmhvbGRpbmdDZWxscz17fSx0aGlzLmdldEhvbGRpbmdDZWxscz1mdW5jdGlvbih0LGkscil7dmFyIHMsZCxuPWUoKSxhPXQuY2hpbGRyZW58fFtdO2ZvcihkPTA7ZDxhLmxlbmd0aDtkKyspcz1nK28oYVtkXSkrdStpLHJbc10mJnQuc3RhdGUub3BlbmVkJiYobj1uLmFkZChyW3NdKS5hZGQodGhpcy5nZXRIb2xkaW5nQ2VsbHModGhpcy5nZXRfbm9kZShhW2RdKSxpLHIpKSk7cmV0dXJuIG59LHRoaXMuX2VkaXQ9ZnVuY3Rpb24odCxpLHIpe2lmKCF0KXJldHVybiExO2lmKCFyKXJldHVybiExO3I9ZShyKSxcImRpdlwiPT09ci5wcm9wKFwidGFnTmFtZVwiKS50b0xvd2VyQ2FzZSgpJiYocj1yLmNoaWxkcmVuKFwic3BhbjpmaXJzdFwiKSk7dmFyIHM9dGhpcy5fZGF0YS5jb3JlLnJ0bCxkPXRoaXMuZWxlbWVudC53aWR0aCgpLG49dC5kYXRhW2kudmFsdWVdLGE9ZShcIjxkaXYgLz5cIix7Y3NzOntwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiLTIwMHB4XCIsbGVmdDpzP1wiMHB4XCI6XCItMTAwMHB4XCIsdmlzaWJpbGl0eTpcImhpZGRlblwifX0pLmFwcGVuZFRvKFwiYm9keVwiKSxvPWUoXCI8aW5wdXQgLz5cIix7dmFsdWU6bixcImNsYXNzXCI6XCJqc3RyZWUtcmVuYW1lLWlucHV0XCIsY3NzOntwYWRkaW5nOlwiMFwiLGJvcmRlcjpcIjFweCBzb2xpZCBzaWx2ZXJcIixcImJveC1zaXppbmdcIjpcImJvcmRlci1ib3hcIixkaXNwbGF5OlwiaW5saW5lLWJsb2NrXCIsaGVpZ2h0OnRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQrXCJweFwiLGxpbmVIZWlnaHQ6dGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCtcInB4XCIsd2lkdGg6XCIxNTBweFwifSxibHVyOmUucHJveHkoZnVuY3Rpb24oKXt2YXIgZT1vLnZhbCgpO1wiXCI9PT1lfHxlPT09bj9lPW46KHQuZGF0YVtpLnZhbHVlXT1lLHRoaXMuZWxlbWVudC50cmlnZ2VyKFwidXBkYXRlX2NlbGwuanN0cmVlLWdyaWRcIix7bm9kZTp0LGNvbDppLnZhbHVlLHZhbHVlOmUsb2xkOm59KSx0aGlzLl9wcmVwYXJlX2dyaWQodGhpcy5nZXRfbm9kZSh0LCEwKSkpLG8ucmVtb3ZlKCksci5zaG93KCl9LHRoaXMpLGtleWRvd246ZnVuY3Rpb24oZSl7dmFyIHQ9ZS53aGljaDsyNz09PXQmJih0aGlzLnZhbHVlPW4pLCgyNz09PXR8fDEzPT09dHx8Mzc9PT10fHwzOD09PXR8fDM5PT09dHx8NDA9PT10fHwzMj09PXQpJiZlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLCgyNz09PXR8fDEzPT09dCkmJihlLnByZXZlbnREZWZhdWx0KCksdGhpcy5ibHVyKCkpfSxjbGljazpmdW5jdGlvbihlKXtlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfSxtb3VzZWRvd246ZnVuY3Rpb24oZSl7ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKX0sa2V5dXA6ZnVuY3Rpb24oZSl7by53aWR0aChNYXRoLm1pbihhLnRleHQoXCJwV1wiK3RoaXMudmFsdWUpLndpZHRoKCksZCkpfSxrZXlwcmVzczpmdW5jdGlvbihlKXtyZXR1cm4gMTM9PT1lLndoaWNoPyExOnZvaWQgMH19KSxsPXtmb250RmFtaWx5OnIuY3NzKFwiZm9udEZhbWlseVwiKXx8XCJcIixmb250U2l6ZTpyLmNzcyhcImZvbnRTaXplXCIpfHxcIlwiLGZvbnRXZWlnaHQ6ci5jc3MoXCJmb250V2VpZ2h0XCIpfHxcIlwiLGZvbnRTdHlsZTpyLmNzcyhcImZvbnRTdHlsZVwiKXx8XCJcIixmb250U3RyZXRjaDpyLmNzcyhcImZvbnRTdHJldGNoXCIpfHxcIlwiLGZvbnRWYXJpYW50OnIuY3NzKFwiZm9udFZhcmlhbnRcIil8fFwiXCIsbGV0dGVyU3BhY2luZzpyLmNzcyhcImxldHRlclNwYWNpbmdcIil8fFwiXCIsd29yZFNwYWNpbmc6ci5jc3MoXCJ3b3JkU3BhY2luZ1wiKXx8XCJcIn07ci5oaWRlKCksci5wYXJlbnQoKS5hcHBlbmQobyksby5jc3MobCkud2lkdGgoTWF0aC5taW4oYS50ZXh0KFwicFdcIitvWzBdLnZhbHVlKS53aWR0aCgpLGQpKVswXS5zZWxlY3QoKX0sdGhpcy5fcHJlcGFyZV9ncmlkPWZ1bmN0aW9uKHQpe3ZhciByLGEsaCxjLHAsZixtLGosXyx3LHgseSxDLGIsVyxTLHosayxULEEsUCxGLFYscSxELEwsTSxOLEksQj10aGlzLl9ncmlkU2V0dGluZ3MsSD1CLnRyZWVDbGFzcyxFPXRoaXMsVT1CLmNvbHVtbnN8fFtdLFg9Qi5pc1RoZW1lcm9sbGVyLCQ9dGhpcy5lbGVtZW50LFE9dGhpcy5yb290aWQsWT1YP1widGhlbWVyb2xsZXJcIjpcInJlZ3VsYXJcIixHPXRoaXMuZ2V0X25vZGUodCksSj1CLmNvbHVtbldpZHRoLEs9Qi5kZWZhdWx0Q29uZixPPWZ1bmN0aW9uKHQsaSxyLHMsZCl7cmV0dXJuIGZ1bmN0aW9uKGQpe2kuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS50cmlnZ2VyKFwiY2xpY2suanN0cmVlXCIsZCksdC50cmlnZ2VyKFwic2VsZWN0X2NlbGwuanN0cmVlLWdyaWRcIixbe3ZhbHVlOnIsY29sdW1uOnMuaGVhZGVyLG5vZGU6aSxncmlkOmUodGhpcyksc291cmNlTmFtZTpzLnZhbHVlfV0pfX0sUj1mdW5jdGlvbih0LGkscixzLGQpe3JldHVybiBmdW5jdGlvbih0KXtCLmNvbnRleHQmJih0LnByZXZlbnREZWZhdWx0KCksZS52YWthdGEuY29udGV4dC5zaG93KHRoaXMse3g6dC5wYWdlWCx5OnQucGFnZVl9LHtlZGl0OntsYWJlbDpcIkVkaXRcIixhY3Rpb246ZnVuY3Rpb24oZSl7dmFyIHI9ZC5nZXRfbm9kZShpKTtFLl9lZGl0KHIscyx0LnRhcmdldCl9fX0pKX19LFo9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZnVuY3Rpb24oKXt0LmhvdmVyX25vZGUoZSl9fSxlZT1mdW5jdGlvbihlLHQpe3JldHVybiBmdW5jdGlvbigpe3QuZGVob3Zlcl9ub2RlKGUpfX0sdGU9dGhpcy5taWRXcmFwcGVyLGllPUcuaWQscmU9dGhpcy5nZXRfbm9kZShHLnBhcmVudCkuY2hpbGRyZW4sc2U9alF1ZXJ5LmluQXJyYXkoaWUscmUpLGRlPXRoaXMuaG9sZGluZ0NlbGxzLG5lPSExO2lmKHI9ZSh0KSxfPXIuY2hpbGRyZW4oXCJhXCIpLDE9PT1fLmxlbmd0aCl7Zm9yKEk9IUcuc3RhdGUub3BlbmVkLFM9ZytvKGllKSt1LHo9XCIjXCI9PT1HLnBhcmVudD9udWxsOkcucGFyZW50LF8uYWRkQ2xhc3MoSCksaShfLHIsRSksdz1fLGM9MDtjPFUubGVuZ3RoO2MrKyl0aGlzLnRyZWVjb2whPT1jJiYoRD1VW2NdLE49dGUuY2hpbGRyZW4oXCJkaXY6ZXEoXCIrYytcIilcIiksZj1ELmNlbGxDbGFzc3x8XCJcIixtPUQud2lkZUNlbGxDbGFzc3x8XCJcIixqPUQuY29sdW1uQ2xhc3N8fFwiXCIsTi5hZGRDbGFzcyhqKSxwPXZvaWQgMCE9PUQudmFsdWUmJm51bGwhPT1ELnZhbHVlP1wiZnVuY3Rpb25cIj09dHlwZW9mIEQudmFsdWU/RC52YWx1ZShHKTpudWxsIT09Ry5kYXRhJiZ2b2lkIDAhPT1HLmRhdGEmJnZvaWQgMCE9PUcuZGF0YVtELnZhbHVlXT9HLmRhdGFbRC52YWx1ZV06XCJcIjpcIlwiLFwiZnVuY3Rpb25cIj09dHlwZW9mIEQuZm9ybWF0JiYocD1ELmZvcm1hdChwKSksRC5pbWFnZXM/KGg9RC5pbWFnZXNbcF18fEQuaW1hZ2VzW1wiZGVmYXVsdFwiXSxoJiYoTD1cIipcIj09PWhbMF0/JzxzcGFuIGNsYXNzPVwiJytoLnN1YnN0cigxKSsnXCI+PC9zcGFuPic6JzxpbWcgc3JjPVwiJytoKydcIj4nKSk6TD1wLCh2b2lkIDA9PT1MfHxudWxsPT09THx8bi50ZXN0KEwpKSYmKEw9XCImbmJzcDtcIikseD1ELnZhbHVlQ2xhc3MmJm51bGwhPT1HLmRhdGEmJnZvaWQgMCE9PUcuZGF0YT9HLmRhdGFbRC52YWx1ZUNsYXNzXXx8XCJcIjpcIlwiLHgmJkQudmFsdWVDbGFzc1ByZWZpeCYmXCJcIiE9PUQudmFsdWVDbGFzc1ByZWZpeCYmKHg9RC52YWx1ZUNsYXNzUHJlZml4K3gpLHk9RC53aWRlVmFsdWVDbGFzcyYmbnVsbCE9PUcuZGF0YSYmdm9pZCAwIT09Ry5kYXRhP0cuZGF0YVtELndpZGVWYWx1ZUNsYXNzXXx8XCJcIjpcIlwiLHkmJkQud2lkZVZhbHVlQ2xhc3NQcmVmaXgmJlwiXCIhPT1ELndpZGVWYWx1ZUNsYXNzUHJlZml4JiYoeT1ELndpZGVWYWx1ZUNsYXNzUHJlZml4K3kpLFc9RC50aXRsZSYmbnVsbCE9PUcuZGF0YSYmdm9pZCAwIT09Ry5kYXRhP0cuZGF0YVtELnRpdGxlXXx8XCJcIjpcIlwiLFc9Vy5yZXBsYWNlKHMsXCJcIiksYj03LGE9RC53aWR0aHx8SixcImF1dG9cIiE9PWEmJihhPU18fGEtYiksdz12KE4saWUpLCghd3x8dy5sZW5ndGg8MSkmJih3PWUoXCI8ZGl2PjwvZGl2PlwiKSxlKFwiPHNwYW4+PC9zcGFuPlwiKS5hcHBlbmRUbyh3KSx3LmF0dHIoXCJpZFwiLFMrYyksdy5hZGRDbGFzcyhTKSx3LmF0dHIobCxpZSkpLEE9MD49c2U/Ry5wYXJlbnQ6ZCh0aGlzLHJlW3NlLTFdKSxUPXYoTixBKSxGPXNlPj1yZS5sZW5ndGgtMT9cIk5VTExcIjpyZVtzZSsxXSxQPXYoTixGKSxxPUcuY2hpbGRyZW4mJkcuY2hpbGRyZW4ubGVuZ3RoPjA/Ry5jaGlsZHJlblswXTpcIk5VTExcIixWPXYoTixxKSxrPXYoTix6KSx6PyhrJiZrLmxlbmd0aD4wPyhUJiZULmxlbmd0aD4wP3cuaW5zZXJ0QWZ0ZXIoVCk6ViYmVi5sZW5ndGg+MD93Lmluc2VydEJlZm9yZShWKTpQJiZQLmxlbmd0aD4wP3cuaW5zZXJ0QmVmb3JlKFApOncuaW5zZXJ0QWZ0ZXIoayksbmU9ITApOm5lPSExLGRlW1MrY109dyk6KFQmJlQubGVuZ3RoPjA/dy5pbnNlcnRBZnRlcihUKTpWJiZWLmxlbmd0aD4wP3cuaW5zZXJ0QmVmb3JlKFYpOlAmJlAubGVuZ3RoPjA/dy5pbnNlcnRCZWZvcmUoUCk6dy5hcHBlbmRUbyhOKSxuZT0hMCksbmUmJncuYWZ0ZXIodGhpcy5nZXRIb2xkaW5nQ2VsbHMoRyxjLGRlKSksQz13LmNoaWxkcmVuKFwic3BhblwiKSxDLmFkZENsYXNzKGYrXCIgXCIreCkuaHRtbChMKSx3PXcuY3NzKEspLmFkZENsYXNzKFwianN0cmVlLWdyaWQtY2VsbCBqc3RyZWUtZ3JpZC1jZWxsLXJlZ3VsYXIganN0cmVlLWdyaWQtY2VsbC1yb290LVwiK1ErXCIganN0cmVlLWdyaWQtY2VsbC1cIitZK1wiIFwiK20rXCIgXCIreSsoWD9cIiB1aS1zdGF0ZS1kZWZhdWx0XCI6XCJcIikpLmFkZENsYXNzKFwianN0cmVlLWdyaWQtY29sLVwiK2MpLHcuY2xpY2soTygkLHIscCxELHRoaXMpKSx3Lm9uKFwiY29udGV4dG1lbnVcIixSKCQscixwLEQsdGhpcykpLHcuaG92ZXIoWihyLHRoaXMpLGVlKHIsdGhpcykpLFcmJkMuYXR0cihcInRpdGxlXCIsVykpO3cuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jZWxsLWxhc3RcIisoWD9cIiB1aS1zdGF0ZS1kZWZhdWx0XCI6XCJcIikpLHZvaWQgMD09PVVbVS5sZW5ndGgtMV0ud2lkdGgmJncuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC13aWR0aC1hdXRvXCIpLm5leHQoXCIuanN0cmVlLWdyaWQtc2VwYXJhdG9yXCIpLnJlbW92ZSgpfXRoaXMuZWxlbWVudC5jc3Moe1wib3ZlcmZsb3cteVwiOlwiYXV0byAhaW1wb3J0YW50XCJ9KX0sdGhpcy5ob2xkaW5nQ2VsbHM9e319fSk7IiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOQU1FU1BBQ0VTXG4vKipcbiAqIEBtb2R1bGUgQ01TXG4gKi9cbnZhciBDTVMgPSB3aW5kb3cuQ01TIHx8IHt9O1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gTU9EQUxcbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8qKlxuICAgICAqIFRoZSBwYWdldHJlZSBpcyBsb2FkZWQgdmlhIGAvYWRtaW4vY21zL3BhZ2VgIGFuZCBoYXMgYSBjdXN0b20gYWRtaW5cbiAgICAgKiB0ZW1wbGF0ZXMgc3RvcmVkIHdpdGhpbiBgdGVtcGxhdGVzL2FkbWluL2Ntcy9wYWdlL3RyZWVgLlxuICAgICAqXG4gICAgICogQGNsYXNzIFBhZ2VUcmVlXG4gICAgICogQG5hbWVzcGFjZSBDTVNcbiAgICAgKiBAdXNlcyBDTVMuQVBJLkhlbHBlcnNcbiAgICAgKi9cbiAgICBDTVMuUGFnZVRyZWUgPSBuZXcgQ01TLkNsYXNzKHtcbiAgICAgICAgLy8gVE9ETyBhZGQgbWVjaGFuaWNzIHRvIHNldCB0aGUgaG9tZSBwYWdlXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykge1xuICAgICAgICAgICAgLy8gb3B0aW9ucyBhcmUgbG9hZGVkIGZyb20gdGhlIHBhZ2V0cmVlIGh0bWwgbm9kZVxuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJCgnLmpzLWNtcy1wYWdldHJlZScpLmRhdGEoJ2pzb24nKTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAvLyBzdGF0ZXMgYW5kIGV2ZW50c1xuICAgICAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMucGFnZXRyZWUnO1xuICAgICAgICAgICAgdGhpcy5jYWNoZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogbnVsbCxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IG51bGwsXG4gICAgICAgICAgICAgICAgdHlwZTogJydcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3NUaW1lciA9IDEwMDA7XG5cbiAgICAgICAgICAgIC8vIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLl9zZXR1cFVJKCk7XG4gICAgICAgICAgICB0aGlzLl9ldmVudHMoKTtcblxuICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHBhZ3RyZWUgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3QodGhpcy5vcHRpb25zKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldHVwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyBhbGwgalF1ZXJ5IHJlZmVyZW5jZXMgd2l0aGluIGB0aGlzLnVpYC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICAgICAgdmFyIHBhZ2V0cmVlID0gJCgnLmNtcy1wYWdldHJlZScpO1xuICAgICAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IHBhZ2V0cmVlLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50OiAkKGRvY3VtZW50KSxcbiAgICAgICAgICAgICAgICB0cmVlOiBwYWdldHJlZS5maW5kKCcuanMtY21zLXBhZ2V0cmVlJyksXG4gICAgICAgICAgICAgICAgZGlhbG9nOiAkKCcuanMtY21zLXRyZWUtZGlhbG9nJyksXG4gICAgICAgICAgICAgICAgc2l0ZUZvcm06ICQoJy5qcy1jbXMtcGFnZXRyZWUtc2l0ZS1mb3JtJylcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHRpbmcgdXAgdGhlIGpzdHJlZSBhbmQgdGhlIHJlbGF0ZWQgY29sdW1ucy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cDogZnVuY3Rpb24gX3NldHVwKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSBbXTtcbiAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMub3B0aW9ucy5sYW5nLmNvZGUsXG4gICAgICAgICAgICAgICAgb3Blbk5vZGVzOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBkYXRhID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IGFqYXggcmVxdWVzdCBzZW5kIHRoZSBjc3JmIHRva2VuXG4gICAgICAgICAgICBDTVMuQVBJLkhlbHBlcnMuY3NyZih0aGlzLm9wdGlvbnMuY3NyZik7XG5cbiAgICAgICAgICAgIC8vIHNldHVwIGNvbHVtbiBoZWFkaW5nc1xuICAgICAgICAgICAgJC5lYWNoKHRoaXMub3B0aW9ucy5jb2x1bW5zLCBmdW5jdGlvbiAoaW5kZXgsIG9iaikge1xuICAgICAgICAgICAgICAgIGlmIChvYmoua2V5ID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmlyc3Qgcm93IGlzIGFscmVhZHkgcG9wdWxhdGVkLCB0byBhdm9pZCBvdmVyd3JpdGVzXG4gICAgICAgICAgICAgICAgICAgIC8vIGp1c3QgbGVhdmUgdGhlIFwia2V5XCIgcGFyYW0gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogb2JqLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG9iai53aWR0aCB8fCAnMSUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkZUNlbGxDbGFzczogb2JqLmNsc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBvYmoudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCBuZWVkcyB0byBoYXZlIHRoZSBcImNvbGRlXCIgZm9ybWF0IGFuZCBub3QgXCJjb2wtZGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIGpzdHJlZSB3aWxsIGNvbnZlcnQgXCJjb2wtZGVcIiB0byBcImNvbGRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHdlIHN0cmlwIGRhc2hlcywgaW4gY2FzZSBsYW5ndWFnZSBjb2RlIGNvbnRhaW5zIGl0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZS5nLiB6aC1oYW5zLCB6aC1jbiBldGNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmRhdGFbJ2NvbCcgKyBvYmoua2V5LnJlcGxhY2UoJy0nLCAnJyldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG9iai53aWR0aCB8fCAnMSUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkZUNlbGxDbGFzczogb2JqLmNsc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gcHJlcGFyZSBkYXRhXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5maWx0ZXJlZCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdGhpcy5vcHRpb25zLnVybHMudHJlZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICcjJyBpcyByZW5kZXJlZCBpZiBpdHMgdGhlIHJvb3Qgbm9kZSwgdGhlcmUgd2Ugb25seVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FyZSBhYm91dCBgb2JqLm9wZW5Ob2Rlc2AsIGluIHRoZSBmb2xsb3dpbmcgY2FzZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgYXJlIHJlcXVlc3RpbmcgYSBzcGVjaWZpYyBub2RlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCAhPT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2VJZCA9IHRoYXQuX3N0b3JlTm9kZUlkKG5vZGUuZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdlSWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHN0b3JlIHRoZSBvcGVuZWQgaXRlbXMgaW5zaWRlIHRoZSBsb2NhbHN0b3JhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIHdlIGhhdmUgdG8gbG9hZCB0aGUgcGFnZXRyZWUgd2l0aCB0aGUgcHJldmlvdXMgb3BlbmVkXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wZW5Ob2RlcyA9IHRoYXQuX2dldFN0b3JlZE5vZGVJZHMoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzZXQgdGhlIHNpdGUgaWQgdG8gZ2V0IHRoZSBjb3JyZWN0IHRyZWVcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zaXRlID0gdGhhdC5vcHRpb25zLnNpdGU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBiaW5kIG9wdGlvbnMgdG8gdGhlIGpzdHJlZSBpbnN0YW5jZVxuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSh7XG4gICAgICAgICAgICAgICAgY29yZToge1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIG9wZW4vY2xvc2UgYW5pbWF0aW9uc1xuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IDAsXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvcmUgc2V0dGluZyB0byBhbGxvdyBhY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrX2NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgZHJhZ2dpbmcgd2hlbiBmaWx0ZXJpbmcgaXMgYWN0aXZlIGJ5IHNldHRpbmcgYGZhbHNlYFxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh0aGF0Lm9wdGlvbnMuZmlsdGVyZWQpID8gZmFsc2UgOiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy5qc3RyZWUuY29tL2FwaS8jLz9mPSQuanN0cmVlLmRlZmF1bHRzLmNvcmUuZGF0YVxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICAvLyBzdHJpbmdzIHVzZWQgd2l0aGluIGpzdHJlZSB0aGF0IGFyZSBjYWxsZWQgdXNpbmcgYGdldF9zdHJpbmdgXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdMb2FkaW5nIC4uLic6IHRoaXMub3B0aW9ucy5sYW5nLmxvYWRpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnTmV3IG5vZGUnOiB0aGlzLm9wdGlvbnMubGFuZy5uZXdOb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25vZGVzJzogdGhpcy5vcHRpb25zLmxhbmcubm9kZXNcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3IucmVhc29uKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGhlbWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnZGphbmdvLWNtcydcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSB0aGUgbXVsdGkgc2VsZWN0aW9uIG9mIG5vZGVzIGZvciBub3dcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBhY3RpdmF0ZSBkcmFnIGFuZCBkcm9wIHBsdWdpblxuICAgICAgICAgICAgICAgIHBsdWdpbnMgOiBbJ2RuZCcsICdzZWFyY2gnLCAnZ3JpZCddLFxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LmpzdHJlZS5jb20vYXBpLyMvP2Y9JC5qc3RyZWUuZGVmYXVsdHMuZG5kXG4gICAgICAgICAgICAgICAgZG5kOiB7XG4gICAgICAgICAgICAgICAgICAgIGluc2lkZV9wb3M6ICdsYXN0JyxcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSB0aGUgbXVsdGkgc2VsZWN0aW9uIG9mIG5vZGVzIGZvciBub3dcbiAgICAgICAgICAgICAgICAgICAgZHJhZ19zZWxlY3Rpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIGRyYWdnaW5nIGlmIGZpbHRlcmVkXG4gICAgICAgICAgICAgICAgICAgIGlzX2RyYWdnYWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh0aGF0Lm9wdGlvbnMuZmlsdGVyZWQpID8gZmFsc2UgOiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIENNRC9DVFJMIGNvcHlcbiAgICAgICAgICAgICAgICAgICAgY29weTogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kZWl0Y2gvanN0cmVlLWdyaWRcbiAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbHVtbnMgYXJlIHByb3ZpZGVkIGZyb20gYmFzZS5odG1sIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sdW1uc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMsIHN1Y2ggYXMgb3BlbmluZyBhbmQgbW92aW5nLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9ldmVudHNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9ldmVudHM6IGZ1bmN0aW9uIF9ldmVudHMoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIHNldCBldmVudHMgZm9yIHRoZSBub2RlSWQgdXBkYXRlc1xuICAgICAgICAgICAgdGhpcy51aS50cmVlLm9uKCdhZnRlcl9jbG9zZS5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgZWwpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9yZW1vdmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy51aS50cmVlLm9uKCdhZnRlcl9vcGVuLmpzdHJlZScsIGZ1bmN0aW9uIChlLCBlbCkge1xuICAgICAgICAgICAgICAgIHRoYXQuX3N0b3JlTm9kZUlkKGVsLm5vZGUuZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fY2hlY2tIZWxwZXJzKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gc3RvcmUgbW92ZWQgcG9zaXRpb24gbm9kZVxuICAgICAgICAgICAgdGhpcy51aS50cmVlLm9uKCdtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgb2JqKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGF0LmNhY2hlLnR5cGUgfHwgdGhhdC5jYWNoZS50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9tb3ZlTm9kZSh0aGF0Ll9nZXROb2RlUG9zaXRpb24ob2JqKSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGF0LnVpLnRyZWUuanN0cmVlKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5faGlkZV9ncmlkKGluc3RhbmNlLmdldF9ub2RlKG9iai5wYXJlbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucGFyZW50ID09PSAnIycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhdmUgdG8gcmVmcmVzaCBwYXJlbnQsIGJlY2F1c2UgcmVmcmVzaCBvbmx5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVmcmVzaGVzIGNoaWxkcmVuIG9mIHRoZSBub2RlLCBuZXZlciB0aGUgbm9kZSBpdHNlbGZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoX25vZGUob2JqLnBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2NvcHlOb2RlKG9iaik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gb3BlbiB0aGUgcGFyZW50IG5vZGUgaWYgd2UgdHJpZ2dlciBhbiBlbGVtZW50XG4gICAgICAgICAgICAgICAgLy8gaWYgbm90IGFscmVhZHkgb3BlbmVkXG4gICAgICAgICAgICAgICAgdGhhdC51aS50cmVlLmpzdHJlZSgnb3Blbl9ub2RlJywgb2JqLnBhcmVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gc2V0IGV2ZW50IGZvciBjdXQgYW5kIHBhc3RlXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCAnLmpzLWNtcy10cmVlLWl0ZW0tY3V0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fY3V0T3JDb3B5KHsgdHlwZTogJ2N1dCcsIGVsZW1lbnQ6ICQodGhpcykgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gc2V0IGV2ZW50IGZvciBjdXQgYW5kIHBhc3RlXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCAnLmpzLWNtcy10cmVlLWl0ZW0tY29weScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX2N1dE9yQ29weSh7IHR5cGU6ICdjb3B5JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnRzIHRvIHBhc3RlXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCAnLmNtcy10cmVlLWl0ZW0taGVscGVycyBhJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fcGFzdGUoZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYWR2YW5jZWQgc2V0dGluZ3MgbGluayBoYW5kbGluZ1xuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1hZHZhbmNlZC1zZXR0aW5ncycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICQodGhpcykuZGF0YSgndXJsJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGFkZCBldmVudHMgZm9yIGVycm9yIHJlbG9hZCAobWVzc2FnZWxpc3QpXG4gICAgICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKHRoaXMuY2xpY2ssICcubWVzc2FnZWxpc3QgLmNtcy10cmVlLXJlbG9hZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHByb3BhZ25hdGUgdGhlIHNpdGVzIGRyb3Bkb3duIHRvIHRoZSBoaWRkZW4gc2l0ZXMgZm9ybVxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1zaXRlLXRyaWdnZXInKS5vbih0aGlzLmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAvLyBwcmV2ZW50IGlmIHBhcmVudCBpcyBhY3RpdmVcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGF0LnVpLnNpdGVGb3JtLmZpbmQoJ3NlbGVjdCcpXG4gICAgICAgICAgICAgICAgICAgIC52YWwoJCh0aGlzKS5kYXRhKCkuaWQpLmVuZCgpLnN1Ym1pdCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGFkZGl0aW9uYWwgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgICAgIHRoaXMuX3NldFRvb2x0aXBzKCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRTZWFyY2goKTtcblxuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGFqYXggcG9zdCByZXF1ZXN0cyBhcmUgd29ya2luZ1xuICAgICAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1pdGVtLW1lbnUgYScpO1xuICAgICAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1sYW5nLXRyaWdnZXInKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGVscGVyIHRvIHByb2Nlc3MgdGhlIGN1dCBhbmQgY29weSBldmVudHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2N1dE9yQ29weVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdHNdXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy50eXBlXSBlaXRoZXIgJ2N1dCcgb3IgJ2NvcHknXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy5lbGVtZW50XSBvcmlnaW5hdGVkIHRyaWdnZXIgZWxlbWVudFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2N1dE9yQ29weTogZnVuY3Rpb24gX2N1dE9yQ29weShvYmopIHtcbiAgICAgICAgICAgIC8vIHByZXZlbnQgYWN0aW9ucyBpZiB5b3UgdHJ5IHRvIGNvcHkgYSBwYWdlIHdpdGggYW4gYXBwaG9va1xuICAgICAgICAgICAgaWYgKG9iai50eXBlID09PSAnY29weScgJiYgb2JqLmVsZW1lbnQuZGF0YSgpLmFwcGhvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dFcnJvcih0aGlzLm9wdGlvbnMubGFuZy5hcHBob29rKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBqc1RyZWVJZCA9IHRoaXMuX2dldE5vZGVJZChvYmouZWxlbWVudC5jbG9zZXN0KCcuanN0cmVlLWdyaWQtY2VsbCcpKTtcbiAgICAgICAgICAgIC8vIHJlc2V0cyBpZiB3ZSBjbGljayBhZ2FpblxuICAgICAgICAgICAgaWYgKHRoaXMuY2FjaGUudHlwZSA9PT0gb2JqLnR5cGUgJiYganNUcmVlSWQgPT09IHRoaXMuY2FjaGUuaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVIZWxwZXJzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gY2FjaGUgdGhlIG5vZGUgYW5kIHR5cGUgc28gYF9zaG93SGVscGVyc2BcbiAgICAgICAgICAgICAgICAvLyB3aWxsIHRyaWdnZXIgdGhlIGNvcnJlY3QgYmVoYXZpb3VyXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS50YXJnZXQgPSBvYmouZWxlbWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnR5cGUgPSBvYmoudHlwZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmlkID0ganNUcmVlSWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvd0hlbHBlcnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0hlbHBlcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGVscGVyIHRvIHByb2Nlc3MgdGhlIHBhc3RlIGV2ZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9wYXN0ZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGV2ZW50IG9yaWdpbmF0ZWQgZXZlbnQgaGFuZGxlclxuICAgICAgICAgKi9cbiAgICAgICAgX3Bhc3RlOiBmdW5jdGlvbiBfcGFzdGUoZXZlbnQpIHtcbiAgICAgICAgICAgIC8vIGhpZGUgaGVscGVycyBhZnRlciB3ZSBwaWNrZWQgb25lXG4gICAgICAgICAgICB0aGlzLl9oaWRlSGVscGVycygpO1xuXG4gICAgICAgICAgICB2YXIgY29weUZyb21JZCA9IHRoaXMuX2dldE5vZGVJZCh0aGlzLmNhY2hlLnRhcmdldCk7XG4gICAgICAgICAgICB2YXIgY29weVRvSWQgPSB0aGlzLl9nZXROb2RlSWQoJChldmVudC5jdXJyZW50VGFyZ2V0KSk7XG5cbiAgICAgICAgICAgIC8vIGNvcHlUb0lkIGNvbnRhaW5zIGBqc3RyZWUtMWAsIGFzc2lnbiB0byByb290XG4gICAgICAgICAgICBpZiAoY29weVRvSWQuaW5kZXhPZignanN0cmVlLTEnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgY29weVRvSWQgPSAnIyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNhY2hlLnR5cGUgPT09ICdjdXQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgnY3V0JywgY29weUZyb21JZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoJ2NvcHknLCBjb3B5RnJvbUlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgncGFzdGUnLCBjb3B5VG9JZCwgJ2xhc3QnKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUudHlwZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLnRhcmdldCA9IG51bGw7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJlaXZlcyBhIGxpc3Qgb2Ygbm9kZXMgZnJvbSBsb2NhbCBzdG9yYWdlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nZXRTdG9yZWROb2RlSWRzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEByZXR1cm4ge0FycmF5fSBsaXN0IG9mIGlkc1xuICAgICAgICAgKi9cbiAgICAgICAgX2dldFN0b3JlZE5vZGVJZHM6IGZ1bmN0aW9uIF9nZXRTdG9yZWROb2RlSWRzKCkge1xuICAgICAgICAgICAgcmV0dXJuIENNUy5zZXR0aW5ncy5wYWdldHJlZSB8fCBbXTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdG9yZU5vZGVJZFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgdG8gYmUgc3RvcmVkXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gaWQgdGhhdCBoYXMgYmVlbiBzdG9yZWRcbiAgICAgICAgICovXG4gICAgICAgIF9zdG9yZU5vZGVJZDogZnVuY3Rpb24gX3N0b3JlTm9kZUlkKGlkKSB7XG4gICAgICAgICAgICB2YXIgbnVtYmVyID0gaWQ7XG4gICAgICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuX2dldFN0b3JlZE5vZGVJZHMoKTtcblxuICAgICAgICAgICAgLy8gc3RvcmUgdmFsdWUgb25seSBpZiBpdCBpc24ndCB0aGVyZSB5ZXRcbiAgICAgICAgICAgIGlmIChzdG9yYWdlLmluZGV4T2YobnVtYmVyKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBzdG9yYWdlLnB1c2gobnVtYmVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQ01TLnNldHRpbmdzLnBhZ2V0cmVlID0gc3RvcmFnZTtcbiAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncyhDTVMuc2V0dGluZ3MpO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9yZW1vdmVOb2RlSWRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIHRvIGJlIHN0b3JlZFxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGlkIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZFxuICAgICAgICAgKi9cbiAgICAgICAgX3JlbW92ZU5vZGVJZDogZnVuY3Rpb24gX3JlbW92ZU5vZGVJZChpZCkge1xuICAgICAgICAgICAgdmFyIG51bWJlciA9IGlkO1xuICAgICAgICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLl9nZXRTdG9yZWROb2RlSWRzKCk7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSBzdG9yYWdlLmluZGV4T2YobnVtYmVyKTtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGdpdmVuIGlkIGZyb20gc3RvcmFnZVxuICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHN0b3JhZ2Uuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQ01TLnNldHRpbmdzLnBhZ2V0cmVlID0gc3RvcmFnZTtcbiAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncyhDTVMuc2V0dGluZ3MpO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNb3ZlcyBhIG5vZGUgYWZ0ZXIgZHJhZyAmIGRyb3AuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX21vdmVOb2RlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c11cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLmlkXSBjdXJyZW50IGVsZW1lbnQgaWQgZm9yIHVybCBtYXRjaGluZ1xuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW29wdHMudGFyZ2V0XSB0YXJnZXQgc2libGluZyBvciBwYXJlbnRcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLnBvc2l0aW9uXSBlaXRoZXIgYGxlZnRgLCBgcmlnaHRgIG9yIGBsYXN0LWNoaWxkYFxuICAgICAgICAgKiBAcmV0dXJucyB7JC5EZWZlcnJlZH0gYWpheCByZXF1ZXN0IG9iamVjdFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX21vdmVOb2RlOiBmdW5jdGlvbiBfbW92ZU5vZGUob2JqKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICBvYmouc2l0ZSA9IHRoYXQub3B0aW9ucy5zaXRlO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgICAgICB1cmw6IHRoYXQub3B0aW9ucy51cmxzLm1vdmUucmVwbGFjZSgne2lkfScsIG9iai5pZCksXG4gICAgICAgICAgICAgICAgZGF0YTogb2JqXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zaG93U3VjY2VzcyhvYmouaWQpO1xuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb3BpZXMgYSBub2RlIGludG8gdGhlIHNlbGVjdGVkIG5vZGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NvcHlOb2RlXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb3B5RnJvbUlkIGVsZW1lbnQgdG8gYmUgY3V0XG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb3B5VG9JZCBkZXN0aW5hdGlvbiB0byBpbmplY3RcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jb3B5Tm9kZTogZnVuY3Rpb24gX2NvcHlOb2RlKG9iaikge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG5vZGUgPSB0aGF0Ll9nZXROb2RlUG9zaXRpb24ob2JqKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHNpdGU6IHRoaXMub3B0aW9ucy5zaXRlLFxuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVmZXIgdG8gdGhlIG9yaWdpbmFsIGl0ZW0gaGVyZSwgYXMgdGhlIGNvcGllZFxuICAgICAgICAgICAgICAgIC8vIG5vZGUgd2lsbCBoYXZlIG5vIGRhdGEgYXR0cmlidXRlcyBzdG9yZWQgYXQgaXQgKG5vdCBhIGNsb25lKVxuICAgICAgICAgICAgICAgIGlkOiBvYmoub3JpZ2luYWwuZGF0YS5pZCxcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogbm9kZS5wb3NpdGlvblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdGFyZ2V0IHByb3ZpZGVkLCB0aGUgbm9kZSBsYW5kcyBpbiByb290XG4gICAgICAgICAgICBpZiAobm9kZS50YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnRhcmdldCA9IG5vZGUudGFyZ2V0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLnBlcm1pc3Npb24pIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGxvYWQgYSBkaWFsb2cgZmlyc3QsIHRvIGNoZWNrIGlmIHBlcm1pc3Npb25zIHNob3VsZFxuICAgICAgICAgICAgICAgIC8vIGJlIGNvcGllZCBvciBub3RcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGF0Lm9wdGlvbnMudXJscy5jb3B5UGVybWlzc2lvbi5yZXBsYWNlKCd7aWR9JywgZGF0YS5pZCksXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICAvLyB0aGUgZGlhbG9nIGlzIGxvYWRlZCB2aWEgdGhlIGFqYXggcmVzcG9ucyBvcmlnaW5hdGluZyBmcm9tXG4gICAgICAgICAgICAgICAgLy8gYHRlbXBsYXRlcy9hZG1pbi9jbXMvcGFnZS90cmVlL2NvcHlfcHJlbWlzc2lvbnMuaHRtbGBcbiAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChkaWFsb2cpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5kaWFsb2cuYXBwZW5kKGRpYWxvZyk7XG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnRzIHRvIHRoZSBwZXJtaXNzaW9uIGRpYWxvZ1xuICAgICAgICAgICAgICAgIHRoaXMudWkuZGlhbG9nLm9mZih0aGlzLmNsaWNrLCAnLmNhbmNlbCcpLm9uKHRoaXMuY2xpY2ssICcuY2FuY2VsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUganVzdCBjb3BpZWQgbm9kZVxuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLnRyZWUuanN0cmVlKCdkZWxldGVfbm9kZScsIG9iai5ub2RlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmpzLWNtcy1kaWFsb2cnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmpzLWNtcy1kaWFsb2ctZGltbWVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSkub2ZmKHRoaXMuY2xpY2ssICcuc3VibWl0Jykub24odGhpcy5jbGljaywgJy5zdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9ICQodGhpcykuY2xvc2VzdCgnZm9ybScpLnNlcmlhbGl6ZSgpLnNwbGl0KCcmJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGZvcm0gZGF0YSBhbmQgYXR0YWNoIHRvIG9ialxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1EYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2Zvcm1EYXRhW2ldLnNwbGl0KCc9JylbMF1dID0gZm9ybURhdGFbaV0uc3BsaXQoJz0nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3NhdmVDb3BpZWROb2RlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zYXZlQ29waWVkTm9kZShkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VuZHMgdGhlIHJlcXVlc3QgdG8gY29weSBhIG5vZGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NhdmVDb3BpZWROb2RlXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIG5vZGUgcG9zaXRpb24gaW5mb3JtYXRpb25cbiAgICAgICAgICovXG4gICAgICAgIF9zYXZlQ29waWVkTm9kZTogZnVuY3Rpb24gX3NhdmVDb3BpZWROb2RlKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIC8vIHNlbmQgdGhlIHJlYWwgYWpheCByZXF1ZXN0IGZvciBjb3B5aW5nIHRoZSBwbHVnaW5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMuY29weS5yZXBsYWNlKCd7aWR9JywgZGF0YS5pZCksXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fcmVsb2FkSGVscGVyKCk7XG4gICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybnMgZWxlbWVudCBmcm9tIGFueSBzdWIgbm9kZXMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2dldEVsZW1lbnRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGVsIGpRdWVyeSBub2RlIGZvcm0gd2hlcmUgdG8gc2VhcmNoXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ3xCb29sZWFufSBqc1RyZWUgbm9kZSBlbGVtZW50IGlkXG4gICAgICAgICAqL1xuICAgICAgICBfZ2V0Tm9kZUlkOiBmdW5jdGlvbiBfZ2V0RWxlbWVudChlbCkge1xuICAgICAgICAgICAgdmFyIGNscyA9IGVsLmNsb3Nlc3QoJy5qc3RyZWUtZ3JpZC1jZWxsJykuYXR0cignY2xhc3MnKTtcblxuICAgICAgICAgICAgcmV0dXJuIChjbHMpID8gY2xzLnJlcGxhY2UoLy4qanNncmlkXyguKz8pX2NvbC4qLywgJyQxJykgOiBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0cyB0aGUgbmV3IG5vZGUgcG9zaXRpb24gYWZ0ZXIgbW92aW5nLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nZXROb2RlUG9zaXRpb25cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBqc3RyZWUgbW92ZSBvYmplY3RcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBldmFsdWF0ZWQgb2JqZWN0IHdpdGggcGFyYW1zXG4gICAgICAgICAqL1xuICAgICAgICBfZ2V0Tm9kZVBvc2l0aW9uOiBmdW5jdGlvbiBfZ2V0Tm9kZVBvc2l0aW9uKG9iaikge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgICAgICAgIHZhciBub2RlID0gdGhpcy51aS50cmVlLmpzdHJlZSgnZ2V0X25vZGUnLCBvYmoubm9kZS5wYXJlbnQpO1xuXG4gICAgICAgICAgICBkYXRhLnBvc2l0aW9uID0gb2JqLnBvc2l0aW9uO1xuXG4gICAgICAgICAgICAvLyBqc3RyZWUgaW5kaWNhdGVzIG5vIHBhcmVudCB3aXRoIGAjYCwgaW4gdGhpcyBjYXNlIHdlIGRvIG5vdFxuICAgICAgICAgICAgLy8gbmVlZCB0byBzZXQgdGhlIHRhcmdldCBhdHRyaWJ1dGUgYXQgYWxsXG4gICAgICAgICAgICBpZiAob2JqLnBhcmVudCAhPT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgZGF0YS50YXJnZXQgPSBub2RlLmRhdGEuaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNvbWUgZnVuY3Rpb25zIGxpa2UgY29weSBjcmVhdGUgYSBuZXcgZWxlbWVudCB3aXRoIGEgbmV3IGlkLFxuICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHdlIG5lZWQgdG8gc2V0IGBkYXRhLmlkYCBtYW51YWxseVxuICAgICAgICAgICAgaWYgKG9iai5ub2RlICYmIG9iai5ub2RlLmRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmlkID0gb2JqLm5vZGUuZGF0YS5pZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgZ2VuZXJhbCB0b29sdGlwcyB0aGF0IGNhbiBoYXZlIGEgbGlzdCBvZiBsaW5rcyBvciBjb250ZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXRUb29sdGlwc1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldFRvb2x0aXBzOiBmdW5jdGlvbiBfc2V0VG9vbHRpcHMoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgdHJpZ2dlckNscyA9ICcuanMtY21zLXRyZWUtdG9vbHRpcC10cmlnZ2VyJztcbiAgICAgICAgICAgIHZhciBjb250YWluZXJDbHMgPSAnLmpzLWNtcy10cmVlLXRvb2x0aXAtY29udGFpbmVyJztcbiAgICAgICAgICAgIHZhciB0cmlnZ2VycztcbiAgICAgICAgICAgIHZhciBjb250YWluZXJzO1xuICAgICAgICAgICAgdmFyIGluZGV4O1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnQgdG8gdGhlIHRyaWdnZXJcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXJDbHMsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICB0cmlnZ2VycyA9ICQodHJpZ2dlckNscyk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVycyA9ICQoY29udGFpbmVyQ2xzKTtcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRyaWdnZXJzLmluZGV4KHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIG9wZW5lZCB0b29sdGlwIGlzIHRyaWdnZXJlZCBhZ2FpblxuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJzLmVxKGluZGV4KS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzLnJlbW92ZUNsYXNzKCdjbXMtdHJlZS10b29sdGlwLWNvbnRhaW5lci1vcGVuJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ugc2hvdyB0aGUgZHJvcGRvd25cbiAgICAgICAgICAgICAgICBjb250YWluZXJzXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnY21zLXRyZWUtdG9vbHRpcC1jb250YWluZXItb3BlbicpXG4gICAgICAgICAgICAgICAgICAgIC5lcShpbmRleClcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdjbXMtdHJlZS10b29sdGlwLWNvbnRhaW5lci1vcGVuJyk7XG5cbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9uZSh0aGF0LmNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcnMucmVtb3ZlQ2xhc3MoJ2Ntcy10cmVlLXRvb2x0aXAtY29udGFpbmVyLW9wZW4nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBzdG9wIHByb3BhZ25hdGlvbiBvbiB0aGUgZWxlbWVudFxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgY29udGFpbmVyQ2xzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVHJpZ2dlcnMgdGhlIGxpbmtzIGBocmVmYCBhcyBhamF4IHBvc3QgcmVxdWVzdC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0QWpheFBvc3RcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IHRyaWdnZXIgalF1ZXJ5IGxpbmsgdGFyZ2V0XG4gICAgICAgICAqL1xuICAgICAgICBfc2V0QWpheFBvc3Q6IGZ1bmN0aW9uIF9zZXRBamF4UG9zdCh0cmlnZ2VyKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6ICQodGhpcykuYXR0cignaHJlZicpXG4gICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgaW4gdGhlIHNpZGVmcmFtZSB3ZSBoYXZlIHRvIGFjdHVhbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgcHVibGlzaGluZyBhIHBhZ2Ugd2UncmUgY3VycmVudGx5IGluXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIGlmIHRoZSBzbHVnIGRpZCBjaGFuZ2Ugd2Ugd291bGQgbmVlZCB0b1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gdGhhdCBuZXcgc2x1Z1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvYmxlbSBoZXJlIGlzIHRoYXQgaW4gY2FzZSBvZiB0aGUgYXBwaG9va2VkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBtb2RlbCBhbmQgcGsgYXJlIGVtcHR5IGFuZCByZWxvYWRCcm93c2VyIGRvZXNuJ3QgcmVhbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBhbnl0aGluZyAtIHNvIGhlcmUgd2Ugc3BlY2lmaWNhbGx5IGZvcmNlIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBiZSB0aGUgZGF0YSBhYm91dCB0aGUgcGFnZSBhbmQgbm90IHRoZSBtb2RlbFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9ICh3aW5kb3cucGFyZW50ID8gd2luZG93LnBhcmVudCA6IHdpbmRvdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGSVhNRSBzaG91bGRuJ3QgYmUgaGFyZGNvZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICdjbXMucGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGs6IHBhcmVudC5DTVMuY29uZmlnLnJlcXVlc3QucGFnZV9pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ugc2ltcGx5IHJlbG9hZCB0aGUgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVsb2FkSGVscGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIGV2ZW50cyBmb3IgdGhlIHNlYXJjaCBvbiB0aGUgaGVhZGVyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXRTZWFyY2hcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXRTZWFyY2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIGZpbHRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGZpbHRlclRyaWdnZXIgPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1maWx0ZXItdHJpZ2dlcicpO1xuICAgICAgICAgICAgdmFyIGZpbHRlckNvbnRhaW5lciA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLWZpbHRlci1jb250YWluZXInKTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJDbG9zZSA9IGZpbHRlckNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1zZWFyY2gtY2xvc2UnKTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJDbGFzcyA9ICdjbXMtcGFnZXRyZWUtaGVhZGVyLWZpbHRlci1hY3RpdmUnO1xuXG4gICAgICAgICAgICB2YXIgdmlzaWJsZUZvcm0gPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1zZWFyY2gnKTtcbiAgICAgICAgICAgIHZhciBoaWRkZW5Gb3JtID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoLWNvcHkgZm9ybScpO1xuXG4gICAgICAgICAgICB2YXIgc2VhcmNoQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyJyk7XG4gICAgICAgICAgICB2YXIgc2VhcmNoRmllbGQgPSBzZWFyY2hDb250YWluZXIuZmluZCgnI2ZpZWxkLXNlYXJjaGJhcicpO1xuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSAyMDA7XG5cbiAgICAgICAgICAgIC8vIGFkZCBhY3RpdmUgY2xhc3Mgd2hlbiBmb2N1c2luZyB0aGUgc2VhcmNoIGZpZWxkXG4gICAgICAgICAgICBzZWFyY2hGaWVsZC5vbignZm9jdXMnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLmFkZENsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VhcmNoRmllbGQub24oJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy8gdGltZW91dCBpcyByZXF1aXJlZCB0byBwcmV2ZW50IHRoZSBzZWFyY2ggZmllbGQgZnJvbSBqdW1waW5nXG4gICAgICAgICAgICAgICAgLy8gYmV0d2VlbiBlbmxhcmdpbmcgYW5kIHNocmlua2luZ1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLnJlbW92ZUNsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHRoYXQudWkuZG9jdW1lbnQub2ZmKHRoYXQuY2xpY2spO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHNob3dzL2hpZGVzIGZpbHRlciBib3hcbiAgICAgICAgICAgIGZpbHRlclRyaWdnZXIuYWRkKGZpbHRlckNsb3NlKS5vbih0aGlzLmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmICghZmlsdGVyQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckNvbnRhaW5lci5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5hZGRDbGFzcyhmaWx0ZXJDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkuZG9jdW1lbnQub24odGhhdC5jbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclRyaWdnZXIudHJpZ2dlcih0aGF0LmNsaWNrKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyQ29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoQ29udGFpbmVyLnJlbW92ZUNsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYodGhhdC5jbGljayk7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBwcmV2ZW50IGNsb3Npbmcgd2hlbiBvbiBmaWx0ZXIgY29udGFpbmVyXG4gICAgICAgICAgICBmaWx0ZXJDb250YWluZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGFkZCBoaWRkZW4gZmllbGRzIHRvIHRoZSBmb3JtIHRvIG1haW50YWluIGZpbHRlciBwYXJhbXNcbiAgICAgICAgICAgIHZpc2libGVGb3JtLmFwcGVuZChoaWRkZW5Gb3JtLmZpbmQoJ2lucHV0W3R5cGU9XCJoaWRkZW5cIl0nKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3dzIHBhc3RlIGhlbHBlcnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Nob3dIZWxwZXJzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2hvd0hlbHBlcnM6IGZ1bmN0aW9uIF9zaG93SGVscGVycygpIHtcbiAgICAgICAgICAgIC8vIGhlbHBlcnMgYXJlIGdlbmVyYXRlZCBvbiB0aGUgZmx5LCBzbyB3ZSBuZWVkIHRvIHJlZmVyZW5jZVxuICAgICAgICAgICAgLy8gdGhlbSBldmVyeSBzaW5nbGUgdGltZVxuICAgICAgICAgICAgJCgnLmNtcy10cmVlLWl0ZW0taGVscGVycycpLnJlbW92ZUNsYXNzKCdjbXMtaGlkZGVuJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpZGVzIHBhc3RlIGhlbHBlcnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2hpZGVIZWxwZXJzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfaGlkZUhlbHBlcnM6IGZ1bmN0aW9uIF9oaWRlSGVscGVycygpIHtcbiAgICAgICAgICAgIC8vIGhlbHBlcnMgYXJlIGdlbmVyYXRlZCBvbiB0aGUgZmx5LCBzbyB3ZSBuZWVkIHRvIHJlZmVyZW5jZVxuICAgICAgICAgICAgLy8gdGhlbSBldmVyeSBzaW5nbGUgdGltZVxuICAgICAgICAgICAgJCgnLmNtcy10cmVlLWl0ZW0taGVscGVycycpLmFkZENsYXNzKCdjbXMtaGlkZGVuJyk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLmlkID0gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2tzIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBoZWxwZXJzIGFmdGVyIGBhZnRlcl9vcGVuLmpzdHJlZWBcbiAgICAgICAgICogb3IgYF9jdXRPckNvcHlgIGlzIHRyaWdnZXJlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfY2hlY2tIZWxwZXJzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfY2hlY2tIZWxwZXJzOiBmdW5jdGlvbiBfY2hlY2tIZWxwZXJzKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FjaGUudHlwZSAmJiB0aGlzLmNhY2hlLmlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvd0hlbHBlcnModGhpcy5jYWNoZS50eXBlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaGlkZSBjdXQgZWxlbWVudCBhbmQgaXQncyBkZXNjZW5kYW50cycgcGFzdGUgaGVscGVycyBpZiBpdCBpcyB2aXNpYmxlXG4gICAgICAgICAgICBpZiAodGhpcy5jYWNoZS50eXBlID09PSAnY3V0JyAmJiB0aGlzLmNhY2hlLnRhcmdldCkge1xuICAgICAgICAgICAgICAgIHZhciBkZXNjZW5kYW50SWRzID0gdGhpcy51aS50cmVlLmpzdHJlZSh0cnVlKS5nZXRfbm9kZSh0aGlzLmNhY2hlLmlkKS5jaGlsZHJlbl9kO1xuXG4gICAgICAgICAgICAgICAgW3RoaXMuY2FjaGUuaWRdLmNvbmNhdChkZXNjZW5kYW50SWRzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuanNncmlkXycgKyBpZCArICdfY29sIC5jbXMtdHJlZS1pdGVtLWhlbHBlcnMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdjbXMtaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3dzIHN1Y2Nlc3MgbWVzc2FnZSBvbiBub2RlIGFmdGVyIHN1Y2Nlc3NmdWwgYWN0aW9uLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zaG93U3VjY2Vzc1xuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gaWQgaWQgb2YgdGhlIGVsZW1lbnQgdG8gYWRkIHRoZSBzdWNjZXNzIGNsYXNzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2hvd1N1Y2Nlc3M6IGZ1bmN0aW9uIF9zaG93U3VjY2VzcyhpZCkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnVpLnRyZWUuZmluZCgnbGlbZGF0YS1pZD1cIicgKyBpZCArICdcIl0nKTtcbiAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2Ntcy10cmVlLW5vZGUtc3VjY2VzcycpO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnY21zLXRyZWUtbm9kZS1zdWNjZXNzJyk7XG4gICAgICAgICAgICB9LCB0aGlzLnN1Y2Nlc3NUaW1lcik7XG4gICAgICAgICAgICAvLyBoaWRlIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLl9oaWRlSGVscGVycygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVja3MgaWYgd2Ugc2hvdWxkIHJlbG9hZCB0aGUgaWZyYW1lIG9yIGVudGlyZSB3aW5kb3cuIEZvciB0aGlzIHdlXG4gICAgICAgICAqIG5lZWQgdG8gc2tpcCBgQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9yZWxvYWRIZWxwZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9yZWxvYWRIZWxwZXI6IGZ1bmN0aW9uIF9yZWxvYWRIZWxwZXIoKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LnNlbGYgIT09IHdpbmRvdy50b3ApIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpc3BsYXlzIGFuIGVycm9yIHdpdGhpbiB0aGUgZGphbmdvIFVJLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHNob3dFcnJvclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBzdHJpbmcgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICAgICAqL1xuICAgICAgICBzaG93RXJyb3I6IGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAkKCcubWVzc2FnZWxpc3QnKTtcbiAgICAgICAgICAgIHZhciBicmVhZGNydW1iID0gJCgnLmJyZWFkY3J1bWJzJyk7XG4gICAgICAgICAgICB2YXIgcmVsb2FkID0gdGhpcy5vcHRpb25zLmxhbmcucmVsb2FkO1xuICAgICAgICAgICAgdmFyIHRwbCA9ICcnICtcbiAgICAgICAgICAgICAgICAnPHVsIGNsYXNzPVwibWVzc2FnZWxpc3RcIj4nICtcbiAgICAgICAgICAgICAgICAnICAgPGxpIGNsYXNzPVwiZXJyb3JcIj4nICtcbiAgICAgICAgICAgICAgICAnICAgICAgIHttc2d9ICcgK1xuICAgICAgICAgICAgICAgICcgICAgICAgPGEgaHJlZj1cIiNyZWxvYWRcIiBjbGFzcz1cImNtcy10cmVlLXJlbG9hZFwiPiAnICsgcmVsb2FkICsgJyA8L2E+JyArXG4gICAgICAgICAgICAgICAgJyAgIDwvbGk+JyArXG4gICAgICAgICAgICAgICAgJzwvdWw+JztcbiAgICAgICAgICAgIHZhciBtc2cgPSB0cGwucmVwbGFjZSgne21zZ30nLCAnPHN0cm9uZz4nICsgdGhpcy5vcHRpb25zLmxhbmcuZXJyb3IgKyAnPC9zdHJvbmc+ICcgKyBtZXNzYWdlKTtcblxuICAgICAgICAgICAgbWVzc2FnZXMubGVuZ3RoID8gbWVzc2FnZXMucmVwbGFjZVdpdGgobXNnKSA6IGJyZWFkY3J1bWIuYWZ0ZXIobXNnKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICAvLyBzaG9ydGhhbmQgZm9yIGpRdWVyeShkb2N1bWVudCkucmVhZHkoKTtcbiAgICAkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gbG9hZCBjbXMgc2V0dGluZ3MgYmVmb3JlaGFuZFxuICAgICAgICAvLyBoYXZlIHRvIHNldCB0b29sYmFyIHRvIFwiZXhwYW5kZWRcIiBieSBkZWZhdWx0XG4gICAgICAgIC8vIG90aGVyd2lzZSBpbml0aWFsaXphdGlvbiB3aWxsIGJlIGluY29ycmVjdCB3aGVuIHlvdVxuICAgICAgICAvLyBnbyBmaXJzdCB0byBwYWdlcyBhbmQgdGhlbiB0byBub3JtYWwgcGFnZVxuICAgICAgICBDTVMuY29uZmlnID0ge1xuICAgICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICB0b29sYmFyOiAnZXhwYW5kZWQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXJsczoge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzOiAkKCcuanMtY21zLXBhZ2V0cmVlJykuZGF0YSgnc2V0dGluZ3MtdXJsJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgQ01TLnNldHRpbmdzID0gQ01TLkFQSS5IZWxwZXJzLmdldFNldHRpbmdzKCk7XG4gICAgICAgIC8vIGF1dG9sb2FkIHRoZSBwYWdldHJlZVxuICAgICAgICBuZXcgQ01TLlBhZ2VUcmVlKCk7XG4gICAgfSk7XG5cbn0pKENNUy4kKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==