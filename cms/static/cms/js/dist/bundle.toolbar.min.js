//##############################################################################
// Function.prototype.bind

if (!Function.prototype.bind) {
    Function.prototype.bind = function(oThis) {
        if (typeof this !== 'function') {
            // closest thing possible to the ECMAScript 5
            // internal IsCallable function
            throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');
        }

        var aArgs   = Array.prototype.slice.call(arguments, 1),
            fToBind = this,
            fNOP    = function() {},
            fBound  = function() {
                return fToBind.apply(this instanceof fNOP
                        ? this
                        : oThis,
                    aArgs.concat(Array.prototype.slice.call(arguments)));
            };

        if (this.prototype) {
            // native functions don't have a prototype
            fNOP.prototype = this.prototype;
        }
        fBound.prototype = new fNOP();

        return fBound;
    };
}

/*! jQuery v1.11.3 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.3",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=r(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=r(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function r(a){var b="length"in a&&a.length,c=m.type(a);return"function"===c||m.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var s=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,aa=/[+~]/,ba=/'|\\/g,ca=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),da=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ea=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fa){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(ba,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+ra(o[l]);w=aa.test(a)&&pa(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",ea,!1):e.attachEvent&&e.attachEvent("onunload",ea)),p=!f(g),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?la(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ca,da),a[3]=(a[3]||a[4]||a[5]||"").replace(ca,da),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ca,da).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(ca,da),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return W.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(ca,da).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:oa(function(){return[0]}),last:oa(function(a,b){return[b-1]}),eq:oa(function(a,b,c){return[0>c?c+b:c]}),even:oa(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:oa(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:oa(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:oa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function qa(){}qa.prototype=d.filters=d.pseudos,d.setFilters=new qa,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function ra(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sa(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function ta(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c){for(var d=0,e=b.length;e>d;d++)ga(a,b[d],c);return c}function va(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wa(a,b,c,d,e,f){return d&&!d[u]&&(d=wa(d)),e&&!e[u]&&(e=wa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ua(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:va(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=va(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=va(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sa(function(a){return a===b},h,!0),l=sa(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sa(ta(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wa(i>1&&ta(m),i>1&&ra(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xa(a.slice(i,e)),f>e&&xa(a=a.slice(e)),f>e&&ra(a))}m.push(c)}return ta(m)}function ya(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=va(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&ga.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,ya(e,d)),f.selector=a}return f},i=ga.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ca,da),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ca,da),aa.test(j[0].type)&&pa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&ra(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,aa.test(a)&&pa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=y.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?"undefined"!=typeof x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))};A.prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}m.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):m.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){var d;while((d=m.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(a===!0?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,a!==!0&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}});function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var K="undefined",L;for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;

return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[m.camelCase(b)])):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?m.cache[a[m.expando]]:a[m.expando],!!a&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d])));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b),g=function(){m.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=m._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;function aa(){return!0}function ba(){return!1}function ca(){try{return y.activeElement}catch(a){}}m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(E)||[""],h=b.length;while(h--)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=m.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,n=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;while(f--)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}n=0;while((h=o[n++])&&!b.isPropagationStopped())b.type=n>1?i:k.bindType||p,f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){l=d[g],l&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=m.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ca()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ca()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?aa:ba):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=aa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=aa,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=aa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return m.nodeName(this,"form")?!1:void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return m.nodeName(this,"form")?!1:void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=ba;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=ba),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});function da(a){var b=ea.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var ea="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fa=/ jQuery\d+="(?:null|\d+)"/g,ga=new RegExp("<(?:"+ea+")[\\s/>]","i"),ha=/^\s+/,ia=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ja=/<([\w:]+)/,ka=/<tbody/i,la=/<|&#?\w+;/,ma=/<(?:script|style|link)/i,na=/checked\s*(?:[^=]|=\s*.checked.)/i,oa=/^$|\/(?:java|ecma)script/i,pa=/^true\/(.*)/,qa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ra={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sa=da(y),ta=sa.appendChild(y.createElement("div"));ra.optgroup=ra.option,ra.tbody=ra.tfoot=ra.colgroup=ra.caption=ra.thead,ra.th=ra.td;function ua(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ua(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function va(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wa(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xa(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function ya(a){var b=pa.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function za(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Aa(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Ba(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xa(b).text=a.text,ya(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!ga.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ta.innerHTML=a.outerHTML,ta.removeChild(f=ta.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ua(f),h=ua(a),g=0;null!=(e=h[g]);++g)d[g]&&Ba(e,d[g]);if(b)if(c)for(h=h||ua(a),d=d||ua(f),g=0;null!=(e=h[g]);g++)Aa(e,d[g]);else Aa(a,f);return d=ua(f,"script"),d.length>0&&za(d,!i&&ua(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=da(b),p=[],q=0;n>q;q++)if(f=a[q],f||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(la.test(f)){h=h||o.appendChild(b.createElement("div")),i=(ja.exec(f)||["",""])[1].toLowerCase(),l=ra[i]||ra._default,h.innerHTML=l[1]+f.replace(ia,"<$1></$2>")+l[2],e=l[0];while(e--)h=h.lastChild;if(!k.leadingWhitespace&&ha.test(f)&&p.push(b.createTextNode(ha.exec(f)[0])),!k.tbody){f="table"!==i||ka.test(f)?"<table>"!==l[1]||ka.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}m.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),k.appendChecked||m.grep(ua(p,"input"),va),q=0;while(f=p[q++])if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ua(o.appendChild(f),"script"),g&&za(h),c)){e=0;while(f=h[e++])oa.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wa(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ua(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&za(ua(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&m.cleanData(ua(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fa,""):void 0;if(!("string"!=typeof a||ma.test(a)||!k.htmlSerialize&&ga.test(a)||!k.leadingWhitespace&&ha.test(a)||ra[(ja.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ia,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(m.cleanData(ua(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ua(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&na.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=m.map(ua(i,"script"),xa),f=g.length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ua(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,ya),j=0;f>j;j++)d=g[j],oa.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qa,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Ca,Da={};function Ea(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fa(a){var b=y,c=Da[a];return c||(c=Ea(a,b),"none"!==c&&c||(Ca=(Ca||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ca[0].contentWindow||Ca[0].contentDocument).document,b.write(),b.close(),c=Ea(a,b),Ca.detach()),Da[a]=c),c}!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=y.getElementsByTagName("body")[0],c&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Ga=/^margin/,Ha=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ia,Ja,Ka=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ia=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)},Ja=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ia(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Ha.test(g)&&Ga.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ia=function(a){return a.currentStyle},Ja=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ia(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Ha.test(g)&&!Ka.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function La(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h;if(b=y.createElement("div"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=d&&d.style){c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}});function i(){var b,c,d,i;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight),b.removeChild(i)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",g=0===i[0].offsetHeight,g&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}}}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Ma=/alpha\([^)]*\)/i,Na=/opacity\s*=\s*([^)]*)/,Oa=/^(none|table(?!-c[ea]).+)/,Pa=new RegExp("^("+S+")(.*)$","i"),Qa=new RegExp("^([+-])=("+S+")","i"),Ra={position:"absolute",visibility:"hidden",display:"block"},Sa={letterSpacing:"0",fontWeight:"400"},Ta=["Webkit","O","Moz","ms"];function Ua(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Ta.length;while(e--)if(b=Ta[e]+c,b in a)return b;return d}function Va(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fa(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wa(a,b,c){var d=Pa.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xa(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Ya(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ia(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Ja(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ha.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xa(a,b,c||(g?"border":"content"),d,f)+"px"}m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Ja(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ua(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Qa.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ua(a.style,h)),g=m.cssHooks[b]||m.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Ja(a,b,d)),"normal"===f&&b in Sa&&(f=Sa[b]),""===c||c?(e=parseFloat(f),c===!0||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Oa.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Ra,function(){return Ya(a,b,d)}):Ya(a,b,d):void 0},set:function(a,c,d){var e=d&&Ia(a);return Wa(a,c,d?Xa(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Na.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Ma,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Ma.test(f)?f.replace(Ma,e):f+" "+e)}}),m.cssHooks.marginRight=La(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Ja,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Ga.test(a)||(m.cssHooks[a+b].set=Wa)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ia(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Va(this,!0)},hide:function(){return Va(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}});function Za(a,b,c,d,e){
return new Za.prototype.init(a,b,c,d,e)}m.Tween=Za,Za.prototype={constructor:Za,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")},cur:function(){var a=Za.propHooks[this.prop];return a&&a.get?a.get(this):Za.propHooks._default.get(this)},run:function(a){var b,c=Za.propHooks[this.prop];return this.options.duration?this.pos=b=m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Za.propHooks._default.set(this),this}},Za.prototype.init.prototype=Za.prototype,Za.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Za.propHooks.scrollTop=Za.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Za.prototype.init,m.fx.step={};var $a,_a,ab=/^(?:toggle|show|hide)$/,bb=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cb=/queueHooks$/,db=[ib],eb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bb.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bb.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,m.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function fb(){return setTimeout(function(){$a=void 0}),$a=m.now()}function gb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hb(a,b,c){for(var d,e=(eb[b]||[]).concat(eb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ib(a,b,c){var d,e,f,g,h,i,j,l,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(h=m._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=m.css(a,"display"),l="none"===j?m._data(a,"olddisplay")||Fa(a.nodeName):j,"inline"===l&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fa(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ab.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fa(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hb(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function jb(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=m.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kb(a,b,c){var d,e,f=0,g=db.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$a||fb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$a||fb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jb(k,j.opts.specialEasing);g>f;f++)if(d=db[f].call(j,a,k,j.opts))return d;return m.map(k,hb,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}m.Animation=m.extend(kb,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],eb[c]=eb[c]||[],eb[c].unshift(b)},prefilter:function(a,b){b?db.unshift(a):db.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kb(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gb(b,!0),a,d,e)}}),m.each({slideDown:gb("show"),slideUp:gb("hide"),slideToggle:gb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($a=m.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$a=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_a||(_a=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_a),_a=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;b=y.createElement("div"),b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=y.createElement("select"),e=c.appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,a=y.createElement("input"),a.setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lb=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,m(this).val()):a,null==e?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(lb,""):null==c?"":c)}}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=m.makeArray(b),g=e.length;while(g--)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mb,nb,ob=m.expr.attrHandle,pb=/^(?:checked|selected)$/i,qb=k.getSetAttribute,rb=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nb:mb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=m.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=m.propFix[c]||c,m.expr.match.bool.test(c)?rb&&qb||!pb.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qb?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nb={set:function(a,b,c){return b===!1?m.removeAttr(a,c):rb&&qb||!pb.test(c)?a.setAttribute(!qb&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=ob[b]||m.find.attr;ob[b]=rb&&qb||!pb.test(b)?function(a,b,d){var e,f;return d||(f=ob[b],ob[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,ob[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rb&&qb||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mb&&mb.set(a,b,c)}}),qb||(mb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},ob.id=ob.name=ob.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mb.set},m.attrHooks.contenteditable={set:function(a,b,c){mb.set(a,""===b?!1:b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sb=/^(?:input|select|textarea|button|object)$/i,tb=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!m.isXMLDoc(a),f&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sb.test(a.nodeName)||tb.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var ub=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=m(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||a===!1?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ub," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vb=m.now(),wb=/\?/,xb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yb,zb,Ab=/#.*$/,Bb=/([?&])_=[^&]*/,Cb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Db=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Eb=/^(?:GET|HEAD)$/,Fb=/^\/\//,Gb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hb={},Ib={},Jb="*/".concat("*");try{zb=location.href}catch(Kb){zb=y.createElement("a"),zb.href="",zb=zb.href}yb=Gb.exec(zb.toLowerCase())||[];function Lb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mb(a,b,c,d){var e={},f=a===Ib;function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nb(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Ob(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zb,type:"GET",isLocal:Db.test(yb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nb(Nb(a,m.ajaxSettings),b):Nb(m.ajaxSettings,a)},ajaxPrefilter:Lb(Hb),ajaxTransport:Lb(Ib),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Cb.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zb)+"").replace(Ab,"").replace(Fb,yb[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gb.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yb[1]&&c[2]===yb[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yb[3]||("http:"===yb[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mb(Hb,k,b,v),2===t)return v;h=m.event&&k.global,h&&0===m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Eb.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wb.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Bb.test(e)?e.replace(Bb,"$1_="+vb++):e+(wb.test(e)?"&":"?")+"_="+vb++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jb+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mb(Ib,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Ob(k,v,c)),u=Pb(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(m.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qb=/%20/g,Rb=/\[\]$/,Sb=/\r?\n/g,Tb=/^(?:submit|button|image|reset|file)$/i,Ub=/^(?:input|select|textarea|keygen)/i;function Vb(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rb.test(a)?d(a,e):Vb(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vb(a+"["+e+"]",b[e],c,d)}m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vb(c,a[c],b,e);return d.join("&").replace(Qb,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Ub.test(this.nodeName)&&!Tb.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sb,"\r\n")}}):{name:b.name,value:c.replace(Sb,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zb()||$b()}:Zb;var Wb=0,Xb={},Yb=m.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Xb)Xb[a](void 0,!0)}),k.cors=!!Yb&&"withCredentials"in Yb,Yb=k.ajax=!!Yb,Yb&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xb[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xb[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function Zb(){try{return new a.XMLHttpRequest}catch(b){}}function $b(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){b=y.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _b=[],ac=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_b.pop()||m.expando+"_"+vb++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(ac.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ac.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ac,"$1"+e):b.jsonp!==!1&&(b.url+=(wb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_b.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bc=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bc)return bc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cc=a.document.documentElement;function dc(a){return m.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),j=("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||cc;while(a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position"))a=a.offsetParent;return a||cc})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=La(k.pixelPosition,function(a,c){return c?(c=Ja(a,b),Ha.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ec=a.jQuery,fc=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fc),b&&a.jQuery===m&&(a.jQuery=ec),m},typeof b===K&&(a.jQuery=a.$=m),m});

/*!
 * @author    Angelo Dini
 * @version   1.0
 * @copyright Distributed under the BSD License.
 */
(function(){var d="1.0";var c=window.Class;var b=window.Class=function(n){n=n||{};var m=function(){return(this.initialize)?this.initialize.apply(this,arguments):j};if(n.implement){var j=window===this?g(m.prototype):this;var l=n.implement;a(n,"implement");n=f(n,e(l))}m.prototype=g(n);m.constructor=m;m._parent=g(n);for(var k=0,h=["extend","implement","getOptions","setOptions"];k<h.length;k++){m[h[k]]=b[h[k]]}return m};b.extend=function(j){var h=this;if(j.implement){this.prototype=f(this.prototype,e(j.implement));a(j,"implement")}for(var i in j){j[i]=typeof j[i]==="function"&&/parent/.test(j[i].toString())?(function(l,k){return function(){this.parent=h._parent[k];return l.apply(this,arguments)}})(j[i],i):j[i]}this._parent=f(this._parent,j,true);this.prototype=f(this.prototype,j);return this};b.implement=function(h){return this.prototype=f(this.prototype,e(h))};b.getOptions=function(){return this.prototype.options||{}};b.setOptions=function(h){return this.prototype.options=f(this.prototype.options,h)};b.noConflict=function(){window.Class=c;return b};b.version=d;function g(i){var h=function(){};h.prototype=i.prototype||i;return new h()}function a(l,i,k){if(k){var h={};for(var j in l){if(j!==i){h[j]=l[j]}}}else{delete l[i]}return h||l}function f(h,i,k){if(!h||!i){return h||i||{}}h=g(h);i=g(i);for(var j in i){if(Object.prototype.toString.call(i[j])==="[object Object]"){f(h[j],i[j])}else{h[j]=(k&&h[j])?h[j]:i[j]}}return h}function e(l){var k={};for(var h=0;h<l.length;h++){if(typeof(l[h])==="function"){l[h]=l[h].prototype}var j=a(l[h],"initialize",true);if(j.implement){k=e(j.implement)}else{k=f(k,j)}}return k}})();
/*!
 * PEP v0.3.0 | https://github.com/jquery/PEP
 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
 *
 * This file is modified for CMS. All `touch-action` attributes are now `data-touch-action`
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  global.PointerEventsPolyfill = factory()
}(this, function () { 'use strict';

  /**
   * This module implements an map of pointer states
   */
  var USE_MAP = window.Map && window.Map.prototype.forEach;
  var POINTERS_FN = function(){ return this.size; };
  function PointerMap() {
    if (USE_MAP) {
      var m = new Map();
      m.pointers = POINTERS_FN;
      return m;
    } else {
      this.keys = [];
      this.values = [];
    }
  }

  PointerMap.prototype = {
    set: function(inId, inEvent) {
      var i = this.keys.indexOf(inId);
      if (i > -1) {
        this.values[i] = inEvent;
      } else {
        this.keys.push(inId);
        this.values.push(inEvent);
      }
    },
    has: function(inId) {
      return this.keys.indexOf(inId) > -1;
    },
    'delete': function(inId) {
      var i = this.keys.indexOf(inId);
      if (i > -1) {
        this.keys.splice(i, 1);
        this.values.splice(i, 1);
      }
    },
    get: function(inId) {
      var i = this.keys.indexOf(inId);
      return this.values[i];
    },
    clear: function() {
      this.keys.length = 0;
      this.values.length = 0;
    },
    // return value, key, map
    forEach: function(callback, thisArg) {
      this.values.forEach(function(v, i) {
        callback.call(thisArg, v, this.keys[i], this);
      }, this);
    },
    pointers: function() {
      return this.keys.length;
    }
  };

  var _pointermap = PointerMap;

  var CLONE_PROPS = [
    // MouseEvent
    'bubbles',
    'cancelable',
    'view',
    'detail',
    'screenX',
    'screenY',
    'clientX',
    'clientY',
    'ctrlKey',
    'altKey',
    'shiftKey',
    'metaKey',
    'button',
    'relatedTarget',
    // DOM Level 3
    'buttons',
    // PointerEvent
    'pointerId',
    'width',
    'height',
    'pressure',
    'tiltX',
    'tiltY',
    'pointerType',
    'hwTimestamp',
    'isPrimary',
    // event instance
    'type',
    'target',
    'currentTarget',
    'which',
    'pageX',
    'pageY',
    'timeStamp'
  ];

  var CLONE_DEFAULTS = [
    // MouseEvent
    false,
    false,
    null,
    null,
    0,
    0,
    0,
    0,
    false,
    false,
    false,
    false,
    0,
    null,
    // DOM Level 3
    0,
    // PointerEvent
    0,
    0,
    0,
    0,
    0,
    0,
    '',
    0,
    false,
    // event instance
    '',
    null,
    null,
    0,
    0,
    0,
    0
  ];

  var HAS_SVG_INSTANCE = (typeof SVGElementInstance !== 'undefined');

  /**
   * This module is for normalizing events. Mouse and Touch events will be
   * collected here, and fire PointerEvents that have the same semantics, no
   * matter the source.
   * Events fired:
   *   - pointerdown: a pointing is added
   *   - pointerup: a pointer is removed
   *   - pointermove: a pointer is moved
   *   - pointerover: a pointer crosses into an element
   *   - pointerout: a pointer leaves an element
   *   - pointercancel: a pointer will no longer generate events
   */
  var dispatcher = {
    pointermap: new _pointermap(),
    eventMap: Object.create(null),
    captureInfo: Object.create(null),
    // Scope objects for native events.
    // This exists for ease of testing.
    eventSources: Object.create(null),
    eventSourceList: [],
    /**
     * Add a new event source that will generate pointer events.
     *
     * `inSource` must contain an array of event names named `events`, and
     * functions with the names specified in the `events` array.
     * @param {string} name A name for the event source
     * @param {Object} source A new source of platform events.
     */
    registerSource: function(name, source) {
      var s = source;
      var newEvents = s.events;
      if (newEvents) {
        newEvents.forEach(function(e) {
          if (s[e]) {
            this.eventMap[e] = s[e].bind(s);
          }
        }, this);
        this.eventSources[name] = s;
        this.eventSourceList.push(s);
      }
    },
    register: function(element) {
      var l = this.eventSourceList.length;
      for (var i = 0, es; (i < l) && (es = this.eventSourceList[i]); i++) {
        // call eventsource register
        es.register.call(es, element);
      }
    },
    unregister: function(element) {
      var l = this.eventSourceList.length;
      for (var i = 0, es; (i < l) && (es = this.eventSourceList[i]); i++) {
        // call eventsource register
        es.unregister.call(es, element);
      }
    },
    contains: /*scope.external.contains || */function(container, contained) {
      return container.contains(contained);
    },
    // EVENTS
    down: function(inEvent) {
      inEvent.bubbles = true;
      this.fireEvent('pointerdown', inEvent);
    },
    move: function(inEvent) {
      inEvent.bubbles = true;
      this.fireEvent('pointermove', inEvent);
    },
    up: function(inEvent) {
      inEvent.bubbles = true;
      this.fireEvent('pointerup', inEvent);
    },
    enter: function(inEvent) {
      inEvent.bubbles = false;
      this.fireEvent('pointerenter', inEvent);
    },
    leave: function(inEvent) {
      inEvent.bubbles = false;
      this.fireEvent('pointerleave', inEvent);
    },
    over: function(inEvent) {
      inEvent.bubbles = true;
      this.fireEvent('pointerover', inEvent);
    },
    out: function(inEvent) {
      inEvent.bubbles = true;
      this.fireEvent('pointerout', inEvent);
    },
    cancel: function(inEvent) {
      inEvent.bubbles = true;
      this.fireEvent('pointercancel', inEvent);
    },
    leaveOut: function(event) {
      this.out(event);
      if (!this.contains(event.target, event.relatedTarget)) {
        this.leave(event);
      }
    },
    enterOver: function(event) {
      this.over(event);
      if (!this.contains(event.target, event.relatedTarget)) {
        this.enter(event);
      }
    },
    // LISTENER LOGIC
    eventHandler: function(inEvent) {
      // This is used to prevent multiple dispatch of pointerevents from
      // platform events. This can happen when two elements in different scopes
      // are set up to create pointer events, which is relevant to Shadow DOM.
      if (inEvent._handledByPE) {
        return;
      }
      var type = inEvent.type;
      var fn = this.eventMap && this.eventMap[type];
      if (fn) {
        fn(inEvent);
      }
      inEvent._handledByPE = true;
    },
    // set up event listeners
    listen: function(target, events) {
      events.forEach(function(e) {
        this.addEvent(target, e);
      }, this);
    },
    // remove event listeners
    unlisten: function(target, events) {
      events.forEach(function(e) {
        this.removeEvent(target, e);
      }, this);
    },
    addEvent: /*scope.external.addEvent || */function(target, eventName) {
      target.addEventListener(eventName, this.boundHandler);
    },
    removeEvent: /*scope.external.removeEvent || */function(target, eventName) {
      target.removeEventListener(eventName, this.boundHandler);
    },
    // EVENT CREATION AND TRACKING
    /**
     * Creates a new Event of type `inType`, based on the information in
     * `inEvent`.
     *
     * @param {string} inType A string representing the type of event to create
     * @param {Event} inEvent A platform event with a target
     * @return {Event} A PointerEvent of type `inType`
     */
    makeEvent: function(inType, inEvent) {
      // relatedTarget must be null if pointer is captured
      if (this.captureInfo[inEvent.pointerId]) {
        inEvent.relatedTarget = null;
      }
      var e = new PointerEvent(inType, inEvent);
      if (inEvent.preventDefault) {
        e.preventDefault = inEvent.preventDefault;
      }
      e._target = e._target || inEvent.target;
      return e;
    },
    // make and dispatch an event in one call
    fireEvent: function(inType, inEvent) {
      var e = this.makeEvent(inType, inEvent);
      return this.dispatchEvent(e);
    },
    /**
     * Returns a snapshot of inEvent, with writable properties.
     *
     * @param {Event} inEvent An event that contains properties to copy.
     * @return {Object} An object containing shallow copies of `inEvent`'s
     *    properties.
     */
    cloneEvent: function(inEvent) {
      var eventCopy = Object.create(null), p;
      for (var i = 0; i < CLONE_PROPS.length; i++) {
        p = CLONE_PROPS[i];
        eventCopy[p] = inEvent[p] || CLONE_DEFAULTS[i];
        // Work around SVGInstanceElement shadow tree
        // Return the <use> element that is represented by the instance for Safari, Chrome, IE.
        // This is the behavior implemented by Firefox.
        if (HAS_SVG_INSTANCE && (p === 'target' || p === 'relatedTarget')) {
          if (eventCopy[p] instanceof SVGElementInstance) {
            eventCopy[p] = eventCopy[p].correspondingUseElement;
          }
        }
      }
      // keep the semantics of preventDefault
      if (inEvent.preventDefault) {
        eventCopy.preventDefault = function() {
          inEvent.preventDefault();
        };
      }
      return eventCopy;
    },
    getTarget: function(inEvent) {
      // if pointer capture is set, route all events for the specified pointerId
      // to the capture target
      return this.captureInfo[inEvent.pointerId] || inEvent._target;
    },
    setCapture: function(inPointerId, inTarget) {
      if (this.captureInfo[inPointerId]) {
        this.releaseCapture(inPointerId);
      }
      this.captureInfo[inPointerId] = inTarget;
      var e = document.createEvent('Event');
      e.initEvent('gotpointercapture', true, false);
      e.pointerId = inPointerId;
      this.implicitRelease = this.releaseCapture.bind(this, inPointerId);
      document.addEventListener('pointerup', this.implicitRelease);
      document.addEventListener('pointercancel', this.implicitRelease);
      e._target = inTarget;
      this.asyncDispatchEvent(e);
    },
    releaseCapture: function(inPointerId) {
      var t = this.captureInfo[inPointerId];
      if (t) {
        var e = document.createEvent('Event');
        e.initEvent('lostpointercapture', true, false);
        e.pointerId = inPointerId;
        this.captureInfo[inPointerId] = undefined;
        document.removeEventListener('pointerup', this.implicitRelease);
        document.removeEventListener('pointercancel', this.implicitRelease);
        e._target = t;
        this.asyncDispatchEvent(e);
      }
    },
    /**
     * Dispatches the event to its target.
     *
     * @param {Event} inEvent The event to be dispatched.
     * @return {Boolean} True if an event handler returns true, false otherwise.
     */
    dispatchEvent: /*scope.external.dispatchEvent || */function(inEvent) {
      var t = this.getTarget(inEvent);
      if (t) {
        return t.dispatchEvent(inEvent);
      }
    },
    asyncDispatchEvent: function(inEvent) {
      requestAnimationFrame(this.dispatchEvent.bind(this, inEvent));
    }
  };
  dispatcher.boundHandler = dispatcher.eventHandler.bind(dispatcher);

  var _dispatcher = dispatcher;

  var targeting = {
    shadow: function(inEl) {
      if (inEl) {
        return inEl.shadowRoot || inEl.webkitShadowRoot;
      }
    },
    canTarget: function(shadow) {
      return shadow && Boolean(shadow.elementFromPoint);
    },
    targetingShadow: function(inEl) {
      var s = this.shadow(inEl);
      if (this.canTarget(s)) {
        return s;
      }
    },
    olderShadow: function(shadow) {
      var os = shadow.olderShadowRoot;
      if (!os) {
        var se = shadow.querySelector('shadow');
        if (se) {
          os = se.olderShadowRoot;
        }
      }
      return os;
    },
    allShadows: function(element) {
      var shadows = [], s = this.shadow(element);
      while(s) {
        shadows.push(s);
        s = this.olderShadow(s);
      }
      return shadows;
    },
    searchRoot: function(inRoot, x, y) {
      if (inRoot) {
        var t = inRoot.elementFromPoint(x, y);
        var st, sr, os;
        // is element a shadow host?
        sr = this.targetingShadow(t);
        while (sr) {
          // find the the element inside the shadow root
          st = sr.elementFromPoint(x, y);
          if (!st) {
            // check for older shadows
            sr = this.olderShadow(sr);
          } else {
            // shadowed element may contain a shadow root
            var ssr = this.targetingShadow(st);
            return this.searchRoot(ssr, x, y) || st;
          }
        }
        // light dom element is the target
        return t;
      }
    },
    owner: function(element) {
      var s = element;
      // walk up until you hit the shadow root or document
      while (s.parentNode) {
        s = s.parentNode;
      }
      // the owner element is expected to be a Document or ShadowRoot
      if (s.nodeType != Node.DOCUMENT_NODE && s.nodeType != Node.DOCUMENT_FRAGMENT_NODE) {
        s = document;
      }
      return s;
    },
    findTarget: function(inEvent) {
      var x = inEvent.clientX, y = inEvent.clientY;
      // if the listener is in the shadow root, it is much faster to start there
      var s = this.owner(inEvent.target);
      // if x, y is not in this root, fall back to document search
      if (!s.elementFromPoint(x, y)) {
        s = document;
      }
      return this.searchRoot(s, x, y);
    }
  };

  /**
   * This module uses Mutation Observers to dynamically adjust which nodes will
   * generate Pointer Events.
   *
   * All nodes that wish to generate Pointer Events must have the attribute
   * `data-touch-action` set to `none`.
   */
  var forEach = Array.prototype.forEach.call.bind(Array.prototype.forEach);
  var map = Array.prototype.map.call.bind(Array.prototype.map);
  var toArray = Array.prototype.slice.call.bind(Array.prototype.slice);
  var filter = Array.prototype.filter.call.bind(Array.prototype.filter);
  var MO = window.MutationObserver || window.WebKitMutationObserver;
  var SELECTOR = '[data-touch-action]';
  var OBSERVER_INIT = {
    subtree: true,
    childList: true,
    attributes: true,
    attributeOldValue: true,
    attributeFilter: ['data-touch-action']
  };

  function Installer(add, remove, changed, binder) {
    this.addCallback = add.bind(binder);
    this.removeCallback = remove.bind(binder);
    this.changedCallback = changed.bind(binder);
    if (MO) {
      this.observer = new MO(this.mutationWatcher.bind(this));
    }
  }

  Installer.prototype = {
    watchSubtree: function(target) {
      // Only watch scopes that can target find, as these are top-level.
      // Otherwise we can see duplicate additions and removals that add noise.
      //
      // TODO(dfreedman): For some instances with ShadowDOMPolyfill, we can see
      // a removal without an insertion when a node is redistributed among
      // shadows. Since it all ends up correct in the document, watching only
      // the document will yield the correct mutations to watch.
      if (targeting.canTarget(target)) {
        this.observer.observe(target, OBSERVER_INIT);
      }
    },
    enableOnSubtree: function(target) {
      this.watchSubtree(target);
      if (target === document && document.readyState !== 'complete') {
        this.installOnLoad();
      } else {
        this.installNewSubtree(target);
      }
    },
    installNewSubtree: function(target) {
      forEach(this.findElements(target), this.addElement, this);
    },
    findElements: function(target) {
      if (target.querySelectorAll) {
        return target.querySelectorAll(SELECTOR);
      }
      return [];
    },
    removeElement: function(el) {
      this.removeCallback(el);
    },
    addElement: function(el) {
      this.addCallback(el);
    },
    elementChanged: function(el, oldValue) {
      this.changedCallback(el, oldValue);
    },
    concatLists: function(accum, list) {
      return accum.concat(toArray(list));
    },
    // register all data-touch-action = none nodes on document load
    installOnLoad: function() {
      document.addEventListener('readystatechange', function() {
        if (document.readyState === 'complete') {
          this.installNewSubtree(document);
        }
      }.bind(this));
    },
    isElement: function(n) {
      return n.nodeType === Node.ELEMENT_NODE;
    },
    flattenMutationTree: function(inNodes) {
      // find children with data-touch-action
      var tree = map(inNodes, this.findElements, this);
      // make sure the added nodes are accounted for
      tree.push(filter(inNodes, this.isElement));
      // flatten the list
      return tree.reduce(this.concatLists, []);
    },
    mutationWatcher: function(mutations) {
      mutations.forEach(this.mutationHandler, this);
    },
    mutationHandler: function(m) {
      if (m.type === 'childList') {
        var added = this.flattenMutationTree(m.addedNodes);
        added.forEach(this.addElement, this);
        var removed = this.flattenMutationTree(m.removedNodes);
        removed.forEach(this.removeElement, this);
      } else if (m.type === 'attributes') {
        this.elementChanged(m.target, m.oldValue);
      }
    }
  };

  if (!MO) {
    Installer.prototype.watchSubtree = function(){
      console.warn('PointerEventsPolyfill: MutationObservers not found, data-touch-action will not be dynamically detected');
    };
  }

  var installer = Installer;

  /**
   * This is the constructor for new PointerEvents.
   *
   * New Pointer Events must be given a type, and an optional dictionary of
   * initialization properties.
   *
   * Due to certain platform requirements, events returned from the constructor
   * identify as MouseEvents.
   *
   * @constructor
   * @param {String} inType The type of the event to create.
   * @param {Object} [inDict] An optional dictionary of initial event properties.
   * @return {Event} A new PointerEvent of type `inType` and initialized with properties from `inDict`.
   */
  var MOUSE_PROPS = [
    'bubbles',
    'cancelable',
    'view',
    'detail',
    'screenX',
    'screenY',
    'clientX',
    'clientY',
    'ctrlKey',
    'altKey',
    'shiftKey',
    'metaKey',
    'button',
    'relatedTarget',
    'pageX',
    'pageY'
  ];

  var MOUSE_DEFAULTS = [
    false,
    false,
    null,
    null,
    0,
    0,
    0,
    0,
    false,
    false,
    false,
    false,
    0,
    null,
    0,
    0
  ];

  function _PointerEvent__PointerEvent(inType, inDict) {
    inDict = inDict || Object.create(null);

    var e = document.createEvent('Event');
    e.initEvent(inType, inDict.bubbles || false, inDict.cancelable || false);

    // define inherited MouseEvent properties
    // skip bubbles and cancelable since they're set above in initEvent()
    for(var i = 2, p; i < MOUSE_PROPS.length; i++) {
      p = MOUSE_PROPS[i];
      e[p] = inDict[p] || MOUSE_DEFAULTS[i];
    }
    e.buttons = inDict.buttons || 0;

    // Spec requires that pointers without pressure specified use 0.5 for down
    // state and 0 for up state.
    var pressure = 0;
    if (inDict.pressure) {
      pressure = inDict.pressure;
    } else {
      pressure = e.buttons ? 0.5 : 0;
    }

    // add x/y properties aliased to clientX/Y
    e.x = e.clientX;
    e.y = e.clientY;

    // define the properties of the PointerEvent interface
    e.pointerId = inDict.pointerId || 0;
    e.width = inDict.width || 0;
    e.height = inDict.height || 0;
    e.pressure = pressure;
    e.tiltX = inDict.tiltX || 0;
    e.tiltY = inDict.tiltY || 0;
    e.pointerType = inDict.pointerType || '';
    e.hwTimestamp = inDict.hwTimestamp || 0;
    e.isPrimary = inDict.isPrimary || false;
    return e;
  }

  var _PointerEvent = _PointerEvent__PointerEvent;

  function shadowSelector(v) {
    return 'body /shadow-deep/ ' + selector(v);
  }
  function selector(v) {
    return '[data-touch-action="' + v + '"]';
  }
  function rule(v) {
    return '{ -ms-touch-action: ' + v + '; touch-action: ' + v + '; touch-action-delay: none; }';
  }
  var attrib2css = [
    'none',
    'auto',
    'pan-x',
    'pan-y',
    {
      rule: 'pan-x pan-y',
      selectors: [
        'pan-x pan-y',
        'pan-y pan-x'
      ]
    }
  ];
  var styles = '';
  // only install stylesheet if the browser has touch action support
  var head = document.head;
  var hasNativePE = window.PointerEvent || window.MSPointerEvent;
  // only add shadow selectors if shadowdom is supported
  var hasShadowRoot = !window.ShadowDOMPolyfill && document.head.createShadowRoot;

  function applyAttributeStyles() {
    if (hasNativePE) {
      attrib2css.forEach(function(r) {
        if (String(r) === r) {
          styles += selector(r) + rule(r) + '\n';
          if (hasShadowRoot) {
            styles += shadowSelector(r) + rule(r) + '\n';
          }
        } else {
          styles += r.selectors.map(selector) + rule(r.rule) + '\n';
          if (hasShadowRoot) {
            styles += r.selectors.map(shadowSelector) + rule(r.rule) + '\n';
          }
        }
      });

      var el = document.createElement('style');
      el.textContent = styles;
      document.head.appendChild(el);
    }
  }

  var mouse__pointermap = _dispatcher.pointermap;
  // radius around touchend that swallows mouse events
  var DEDUP_DIST = 25;

  var WHICH_TO_BUTTONS = [0, 1, 4, 2];

  var HAS_BUTTONS = false;
  try {
    HAS_BUTTONS = new MouseEvent('test', {buttons: 1}).buttons === 1;
  } catch (e) {}

  // handler block for native mouse events
  var mouseEvents = {
    POINTER_ID: 1,
    POINTER_TYPE: 'mouse',
    events: [
      'mousedown',
      'mousemove',
      'mouseup',
      'mouseover',
      'mouseout'
    ],
    register: function(target) {
      _dispatcher.listen(target, this.events);
    },
    unregister: function(target) {
      _dispatcher.unlisten(target, this.events);
    },
    lastTouches: [],
    // collide with the global mouse listener
    isEventSimulatedFromTouch: function(inEvent) {
      var lts = this.lastTouches;
      var x = inEvent.clientX, y = inEvent.clientY;
      for (var i = 0, l = lts.length, t; i < l && (t = lts[i]); i++) {
        // simulated mouse events will be swallowed near a primary touchend
        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);
        if (dx <= DEDUP_DIST && dy <= DEDUP_DIST) {
          return true;
        }
      }
    },
    prepareEvent: function(inEvent) {
      var e = _dispatcher.cloneEvent(inEvent);
      // forward mouse preventDefault
      var pd = e.preventDefault;
      e.preventDefault = function() {
        inEvent.preventDefault();
        pd();
      };
      e.pointerId = this.POINTER_ID;
      e.isPrimary = true;
      e.pointerType = this.POINTER_TYPE;
      if (!HAS_BUTTONS) {
        e.buttons = WHICH_TO_BUTTONS[e.which] || 0;
      }
      return e;
    },
    mousedown: function(inEvent) {
      if (!this.isEventSimulatedFromTouch(inEvent)) {
        var p = mouse__pointermap.has(this.POINTER_ID);
        // TODO(dfreedman) workaround for some elements not sending mouseup
        // http://crbug/149091
        if (p) {
          this.cancel(inEvent);
        }
        var e = this.prepareEvent(inEvent);
        mouse__pointermap.set(this.POINTER_ID, inEvent);
        _dispatcher.down(e);
      }
    },
    mousemove: function(inEvent) {
      if (!this.isEventSimulatedFromTouch(inEvent)) {
        var e = this.prepareEvent(inEvent);
        _dispatcher.move(e);
      }
    },
    mouseup: function(inEvent) {
      if (!this.isEventSimulatedFromTouch(inEvent)) {
        var p = mouse__pointermap.get(this.POINTER_ID);
        if (p && p.button === inEvent.button) {
          var e = this.prepareEvent(inEvent);
          _dispatcher.up(e);
          this.cleanupMouse();
        }
      }
    },
    mouseover: function(inEvent) {
      if (!this.isEventSimulatedFromTouch(inEvent)) {
        var e = this.prepareEvent(inEvent);
        _dispatcher.enterOver(e);
      }
    },
    mouseout: function(inEvent) {
      if (!this.isEventSimulatedFromTouch(inEvent)) {
        var e = this.prepareEvent(inEvent);
        _dispatcher.leaveOut(e);
      }
    },
    cancel: function(inEvent) {
      var e = this.prepareEvent(inEvent);
      _dispatcher.cancel(e);
      this.cleanupMouse();
    },
    cleanupMouse: function() {
      mouse__pointermap['delete'](this.POINTER_ID);
    }
  };

  var mouse = mouseEvents;

  var captureInfo = _dispatcher.captureInfo;
  var findTarget = targeting.findTarget.bind(targeting);
  var allShadows = targeting.allShadows.bind(targeting);
  var touch__pointermap = _dispatcher.pointermap;
  var touchMap = Array.prototype.map.call.bind(Array.prototype.map);
  // This should be long enough to ignore compat mouse events made by touch
  var DEDUP_TIMEOUT = 2500;
  var CLICK_COUNT_TIMEOUT = 200;
  var ATTRIB = 'data-touch-action';
  var INSTALLER;
  // The presence of touch event handlers blocks scrolling, and so we must be careful to
  // avoid adding handlers unnecessarily.  Chrome plans to add a touch-action-delay property
  // (crbug.com/329559) to address this, and once we have that we can opt-in to a simpler
  // handler registration mechanism.  Rather than try to predict how exactly to opt-in to
  // that we'll just leave this disabled until there is a build of Chrome to test.
  var HAS_TOUCH_ACTION_DELAY = false;

  // handler block for native touch events
  var touchEvents = {
    events: [
      'touchstart',
      'touchmove',
      'touchend',
      'touchcancel'
    ],
    register: function(target) {
      if (HAS_TOUCH_ACTION_DELAY) {
        _dispatcher.listen(target, this.events);
      } else {
        INSTALLER.enableOnSubtree(target);
      }
    },
    unregister: function(target) {
      if (HAS_TOUCH_ACTION_DELAY) {
        _dispatcher.unlisten(target, this.events);
      } else {
        // TODO(dfreedman): is it worth it to disconnect the MO?
      }
    },
    elementAdded: function(el) {
      var a = el.getAttribute(ATTRIB);
      var st = this.touchActionToScrollType(a);
      if (st) {
        el._scrollType = st;
        _dispatcher.listen(el, this.events);
        // set data-touch-action on shadows as well
        allShadows(el).forEach(function(s) {
          s._scrollType = st;
          _dispatcher.listen(s, this.events);
        }, this);
      }
    },
    elementRemoved: function(el) {
      el._scrollType = undefined;
      _dispatcher.unlisten(el, this.events);
      // remove data-touch-action from shadow
      allShadows(el).forEach(function(s) {
        s._scrollType = undefined;
        _dispatcher.unlisten(s, this.events);
      }, this);
    },
    elementChanged: function(el, oldValue) {
      var a = el.getAttribute(ATTRIB);
      var st = this.touchActionToScrollType(a);
      var oldSt = this.touchActionToScrollType(oldValue);
      // simply update scrollType if listeners are already established
      if (st && oldSt) {
        el._scrollType = st;
        allShadows(el).forEach(function(s) {
          s._scrollType = st;
        }, this);
      } else if (oldSt) {
        this.elementRemoved(el);
      } else if (st) {
        this.elementAdded(el);
      }
    },
    scrollTypes: {
      EMITTER: 'none',
      XSCROLLER: 'pan-x',
      YSCROLLER: 'pan-y',
      SCROLLER: /^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/
    },
    touchActionToScrollType: function(touchAction) {
      var t = touchAction;
      var st = this.scrollTypes;
      if (t === 'none') {
        return 'none';
      } else if (t === st.XSCROLLER) {
        return 'X';
      } else if (t === st.YSCROLLER) {
        return 'Y';
      } else if (st.SCROLLER.exec(t)) {
        return 'XY';
      }
    },
    POINTER_TYPE: 'touch',
    firstTouch: null,
    isPrimaryTouch: function(inTouch) {
      return this.firstTouch === inTouch.identifier;
    },
    setPrimaryTouch: function(inTouch) {
      // set primary touch if there no pointers, or the only pointer is the mouse
      if (touch__pointermap.pointers() === 0 || (touch__pointermap.pointers() === 1 && touch__pointermap.has(1))) {
        this.firstTouch = inTouch.identifier;
        this.firstXY = {X: inTouch.clientX, Y: inTouch.clientY};
        this.scrolling = false;
        this.cancelResetClickCount();
      }
    },
    removePrimaryPointer: function(inPointer) {
      if (inPointer.isPrimary) {
        this.firstTouch = null;
        this.firstXY = null;
        this.resetClickCount();
      }
    },
    clickCount: 0,
    resetId: null,
    resetClickCount: function() {
      var fn = function() {
        this.clickCount = 0;
        this.resetId = null;
      }.bind(this);
      this.resetId = setTimeout(fn, CLICK_COUNT_TIMEOUT);
    },
    cancelResetClickCount: function() {
      if (this.resetId) {
        clearTimeout(this.resetId);
      }
    },
    typeToButtons: function(type) {
      var ret = 0;
      if (type === 'touchstart' || type === 'touchmove') {
        ret = 1;
      }
      return ret;
    },
    touchToPointer: function(inTouch) {
      var cte = this.currentTouchEvent;
      var e = _dispatcher.cloneEvent(inTouch);
      // Spec specifies that pointerId 1 is reserved for Mouse.
      // Touch identifiers can start at 0.
      // Add 2 to the touch identifier for compatibility.
      var id = e.pointerId = inTouch.identifier + 2;
      e.target = captureInfo[id] || findTarget(e);
      e.bubbles = true;
      e.cancelable = true;
      e.detail = this.clickCount;
      e.button = 0;
      e.buttons = this.typeToButtons(cte.type);
      e.width = inTouch.webkitRadiusX || inTouch.radiusX || 0;
      e.height = inTouch.webkitRadiusY || inTouch.radiusY || 0;
      e.pressure = inTouch.webkitForce || inTouch.force || 0.5;
      e.isPrimary = this.isPrimaryTouch(inTouch);
      e.pointerType = this.POINTER_TYPE;
      // forward touch preventDefaults
      var self = this;
      e.preventDefault = function() {
        self.scrolling = false;
        self.firstXY = null;
        cte.preventDefault();
      };
      return e;
    },
    processTouches: function(inEvent, inFunction) {
      var tl = inEvent.changedTouches;
      this.currentTouchEvent = inEvent;
      for (var i = 0, t; i < tl.length; i++) {
        t = tl[i];
        inFunction.call(this, this.touchToPointer(t));
      }
    },
    // For single axis scrollers, determines whether the element should emit
    // pointer events or behave as a scroller
    shouldScroll: function(inEvent) {
      if (this.firstXY) {
        var ret;
        var scrollAxis = inEvent.currentTarget._scrollType;
        if (scrollAxis === 'none') {
          // this element is a touch-action: none, should never scroll
          ret = false;
        } else if (scrollAxis === 'XY') {
          // this element should always scroll
          ret = true;
        } else {
          var t = inEvent.changedTouches[0];
          // check the intended scroll axis, and other axis
          var a = scrollAxis;
          var oa = scrollAxis === 'Y' ? 'X' : 'Y';
          var da = Math.abs(t['client' + a] - this.firstXY[a]);
          var doa = Math.abs(t['client' + oa] - this.firstXY[oa]);
          // if delta in the scroll axis > delta other axis, scroll instead of
          // making events
          ret = da >= doa;
        }
        this.firstXY = null;
        return ret;
      }
    },
    findTouch: function(inTL, inId) {
      for (var i = 0, l = inTL.length, t; i < l && (t = inTL[i]); i++) {
        if (t.identifier === inId) {
          return true;
        }
      }
    },
    // In some instances, a touchstart can happen without a touchend. This
    // leaves the pointermap in a broken state.
    // Therefore, on every touchstart, we remove the touches that did not fire a
    // touchend event.
    // To keep state globally consistent, we fire a
    // pointercancel for this "abandoned" touch
    vacuumTouches: function(inEvent) {
      var tl = inEvent.touches;
      // pointermap.pointers() should be < tl.length here, as the touchstart has not
      // been processed yet.
      if (touch__pointermap.pointers() >= tl.length) {
        var d = [];
        touch__pointermap.forEach(function(value, key) {
          // Never remove pointerId == 1, which is mouse.
          // Touch identifiers are 2 smaller than their pointerId, which is the
          // index in pointermap.
          if (key !== 1 && !this.findTouch(tl, key - 2)) {
            var p = value.out;
            d.push(p);
          }
        }, this);
        d.forEach(this.cancelOut, this);
      }
    },
    touchstart: function(inEvent) {
      this.vacuumTouches(inEvent);
      this.setPrimaryTouch(inEvent.changedTouches[0]);
      this.dedupSynthMouse(inEvent);
      if (!this.scrolling) {
        this.clickCount++;
        this.processTouches(inEvent, this.overDown);
      }
    },
    overDown: function(inPointer) {
      var p = touch__pointermap.set(inPointer.pointerId, {
        target: inPointer.target,
        out: inPointer,
        outTarget: inPointer.target
      });
      _dispatcher.over(inPointer);
      _dispatcher.enter(inPointer);
      _dispatcher.down(inPointer);
    },
    touchmove: function(inEvent) {
      if (!this.scrolling) {
        if (this.shouldScroll(inEvent)) {
          this.scrolling = true;
          this.touchcancel(inEvent);
        } else {
          inEvent.preventDefault();
          this.processTouches(inEvent, this.moveOverOut);
        }
      }
    },
    moveOverOut: function(inPointer) {
      var event = inPointer;
      var pointer = touch__pointermap.get(event.pointerId);
      // a finger drifted off the screen, ignore it
      if (!pointer) {
        return;
      }
      var outEvent = pointer.out;
      var outTarget = pointer.outTarget;
      _dispatcher.move(event);
      if (outEvent && outTarget !== event.target) {
        outEvent.relatedTarget = event.target;
        event.relatedTarget = outTarget;
        // recover from retargeting by shadow
        outEvent.target = outTarget;
        if (event.target) {
          _dispatcher.leaveOut(outEvent);
          _dispatcher.enterOver(event);
        } else {
          // clean up case when finger leaves the screen
          event.target = outTarget;
          event.relatedTarget = null;
          this.cancelOut(event);
        }
      }
      pointer.out = event;
      pointer.outTarget = event.target;
    },
    touchend: function(inEvent) {
      this.dedupSynthMouse(inEvent);
      this.processTouches(inEvent, this.upOut);
    },
    upOut: function(inPointer) {
      if (!this.scrolling) {
        _dispatcher.up(inPointer);
        _dispatcher.out(inPointer);
        _dispatcher.leave(inPointer);
      }
      this.cleanUpPointer(inPointer);
    },
    touchcancel: function(inEvent) {
      this.processTouches(inEvent, this.cancelOut);
    },
    cancelOut: function(inPointer) {
      _dispatcher.cancel(inPointer);
      _dispatcher.out(inPointer);
      _dispatcher.leave(inPointer);
      this.cleanUpPointer(inPointer);
    },
    cleanUpPointer: function(inPointer) {
      touch__pointermap['delete'](inPointer.pointerId);
      this.removePrimaryPointer(inPointer);
    },
    // prevent synth mouse events from creating pointer events
    dedupSynthMouse: function(inEvent) {
      var lts = mouse.lastTouches;
      var t = inEvent.changedTouches[0];
      // only the primary finger will synth mouse events
      if (this.isPrimaryTouch(t)) {
        // remember x/y of last touch
        var lt = {x: t.clientX, y: t.clientY};
        lts.push(lt);
        var fn = (function(lts, lt){
          var i = lts.indexOf(lt);
          if (i > -1) {
            lts.splice(i, 1);
          }
        }).bind(null, lts, lt);
        setTimeout(fn, DEDUP_TIMEOUT);
      }
    }
  };

  if (!HAS_TOUCH_ACTION_DELAY) {
    INSTALLER = new installer(touchEvents.elementAdded, touchEvents.elementRemoved, touchEvents.elementChanged, touchEvents);
  }

  var touch = touchEvents;

  var ms__pointermap = _dispatcher.pointermap;
  var HAS_BITMAP_TYPE = window.MSPointerEvent && typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE === 'number';
  var msEvents = {
    events: [
      'MSPointerDown',
      'MSPointerMove',
      'MSPointerUp',
      'MSPointerOut',
      'MSPointerOver',
      'MSPointerCancel',
      'MSGotPointerCapture',
      'MSLostPointerCapture'
    ],
    register: function(target) {
      _dispatcher.listen(target, this.events);
    },
    unregister: function(target) {
      _dispatcher.unlisten(target, this.events);
    },
    POINTER_TYPES: [
      '',
      'unavailable',
      'touch',
      'pen',
      'mouse'
    ],
    prepareEvent: function(inEvent) {
      var e = inEvent;
      if (HAS_BITMAP_TYPE) {
        e = _dispatcher.cloneEvent(inEvent);
        e.pointerType = this.POINTER_TYPES[inEvent.pointerType];
      }
      return e;
    },
    cleanup: function(id) {
      ms__pointermap['delete'](id);
    },
    MSPointerDown: function(inEvent) {
      ms__pointermap.set(inEvent.pointerId, inEvent);
      var e = this.prepareEvent(inEvent);
      _dispatcher.down(e);
    },
    MSPointerMove: function(inEvent) {
      var e = this.prepareEvent(inEvent);
      _dispatcher.move(e);
    },
    MSPointerUp: function(inEvent) {
      var e = this.prepareEvent(inEvent);
      _dispatcher.up(e);
      this.cleanup(inEvent.pointerId);
    },
    MSPointerOut: function(inEvent) {
      var e = this.prepareEvent(inEvent);
      _dispatcher.leaveOut(e);
    },
    MSPointerOver: function(inEvent) {
      var e = this.prepareEvent(inEvent);
      _dispatcher.enterOver(e);
    },
    MSPointerCancel: function(inEvent) {
      var e = this.prepareEvent(inEvent);
      _dispatcher.cancel(e);
      this.cleanup(inEvent.pointerId);
    },
    MSLostPointerCapture: function(inEvent) {
      var e = _dispatcher.makeEvent('lostpointercapture', inEvent);
      _dispatcher.dispatchEvent(e);
    },
    MSGotPointerCapture: function(inEvent) {
      var e = _dispatcher.makeEvent('gotpointercapture', inEvent);
      _dispatcher.dispatchEvent(e);
    }
  };

  var ms = msEvents;

  function platform_events__applyPolyfill() {
    // only activate if this platform does not have pointer events
    if (!window.PointerEvent) {
      window.PointerEvent = _PointerEvent;

      if (window.navigator.msPointerEnabled) {
        var tp = window.navigator.msMaxTouchPoints;
        Object.defineProperty(window.navigator, 'maxTouchPoints', {
          value: tp,
          enumerable: true
        });
        _dispatcher.registerSource('ms', ms);
      } else {
        _dispatcher.registerSource('mouse', mouse);
        if (window.ontouchstart !== undefined) {
          _dispatcher.registerSource('touch', touch);
        }
      }

      _dispatcher.register(document);
    }
  }

  var n = window.navigator;
  var s, r;
  function assertDown(id) {
    if (!_dispatcher.pointermap.has(id)) {
      throw new Error('InvalidPointerId');
    }
  }
  if (n.msPointerEnabled) {
    s = function(pointerId) {
      assertDown(pointerId);
      this.msSetPointerCapture(pointerId);
    };
    r = function(pointerId) {
      assertDown(pointerId);
      this.msReleasePointerCapture(pointerId);
    };
  } else {
    s = function setPointerCapture(pointerId) {
      assertDown(pointerId);
      _dispatcher.setCapture(pointerId, this);
    };
    r = function releasePointerCapture(pointerId) {
      assertDown(pointerId);
      _dispatcher.releaseCapture(pointerId, this);
    };
  }

  function capture__applyPolyfill() {
    if (window.Element && !Element.prototype.setPointerCapture) {
      Object.defineProperties(Element.prototype, {
        'setPointerCapture': {
          value: s
        },
        'releasePointerCapture': {
          value: r
        }
      });
    }
  }

  applyAttributeStyles();
  platform_events__applyPolyfill();
  capture__applyPolyfill();

  var pointerevents = {
    dispatcher: _dispatcher,
    Installer: installer,
    PointerEvent: _PointerEvent,
    PointerMap: _pointermap,
    targetFinding: targeting
  };

  return pointerevents;

}));

/*! jQuery UI - v1.11.4 - 2015-11-13
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, sortable.js, effect.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])
},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}});var o="ui-effects-",r=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(r),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(r.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(o+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(o+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects});

/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);

/*
 * jQuery UI Nested Sortable
 * v 2.0 / 29 oct 2012
 * http://mjsarfatti.com/sandbox/nestedSortable
 *
 * Depends on:
 * jquery.ui.sortable.js 1.10+
 *
 * Copyright (c) 2010-2013 Manuele J Sarfatti
 * Licensed under the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */

(function($) {

    function isOverAxis( x, reference, size ) {
        return ( x > reference ) && ( x < ( reference + size ) );
    }

    $.widget("mjs.nestedSortable", $.extend({}, $.ui.sortable.prototype, {

        options: {
            doNotClear: false,
            expandOnHover: 700,
            isAllowed: function(placeholder, placeholderParent, originalItem) { return true; },
            isTree: false,
            listType: 'ol',
            maxLevels: 0,
            protectRoot: false,
            rootID: null,
            rtl: false,
            startCollapsed: false,
            tabSize: 20,

            branchClass: 'mjs-nestedSortable-branch',
            collapsedClass: 'mjs-nestedSortable-collapsed',
            disableNestingClass: 'mjs-nestedSortable-no-nesting',
            errorClass: 'mjs-nestedSortable-error',
            expandedClass: 'mjs-nestedSortable-expanded',
            hoveringClass: 'mjs-nestedSortable-hovering',
            leafClass: 'mjs-nestedSortable-leaf'
        },

        _create: function() {
            this.element.data('ui-sortable', this.element.data('mjs-nestedSortable'));

            // mjs - prevent browser from freezing if the HTML is not correct
            if (!this.element.is(this.options.listType))
                throw new Error('nestedSortable: Please check that the listType option is set to your actual list type');

            // mjs - force 'intersect' tolerance method if we have a tree with expanding/collapsing functionality
            if (this.options.isTree && this.options.expandOnHover) {
                this.options.tolerance = 'intersect';
            }

            $.ui.sortable.prototype._create.apply(this, arguments);

            // mjs - prepare the tree by applying the right classes (the CSS is responsible for actual hide/show functionality)
            if (this.options.isTree) {
                var self = this;
                $(this.items).each(function() {
                    var $li = this.item;
                    if ($li.children(self.options.listType).length) {
                        $li.addClass(self.options.branchClass);
                        // expand/collapse class only if they have children
                        if (self.options.startCollapsed) $li.addClass(self.options.collapsedClass);
                        else $li.addClass(self.options.expandedClass);
                    } else {
                        $li.addClass(self.options.leafClass);
                    }
                })
            }
        },

        _destroy: function() {
            this.element
                .removeData("mjs-nestedSortable")
                .removeData("ui-sortable");
            return $.ui.sortable.prototype._destroy.apply(this, arguments);
        },

        _mouseDrag: function(event) {
            var i, item, itemElement, intersection,
                o = this.options,
                scrolled = false;

            //Compute the helpers position
            this.position = this._generatePosition(event);
            this.positionAbs = this._convertPositionTo("absolute");

            if (!this.lastPositionAbs) {
                this.lastPositionAbs = this.positionAbs;
            }

            //Do scrolling
            if(this.options.scroll) {
                if(this.scrollParent[0] != document && this.scrollParent[0].tagName != 'HTML') {

                    if((this.overflowOffset.top + this.scrollParent[0].offsetHeight) - event.pageY < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop = scrolled = this.scrollParent[0].scrollTop + o.scrollSpeed;
                    } else if(event.pageY - this.overflowOffset.top < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop = scrolled = this.scrollParent[0].scrollTop - o.scrollSpeed;
                    }

                    if((this.overflowOffset.left + this.scrollParent[0].offsetWidth) - event.pageX < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled = this.scrollParent[0].scrollLeft + o.scrollSpeed;
                    } else if(event.pageX - this.overflowOffset.left < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled = this.scrollParent[0].scrollLeft - o.scrollSpeed;
                    }

                } else {

                    if(event.pageY - $(document).scrollTop() < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() - o.scrollSpeed);
                    } else if($(window).height() - (event.pageY - $(document).scrollTop()) < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() + o.scrollSpeed);
                    }

                    if(event.pageX - $(document).scrollLeft() < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft($(document).scrollLeft() - o.scrollSpeed);
                    } else if($(window).width() - (event.pageX - $(document).scrollLeft()) < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft($(document).scrollLeft() + o.scrollSpeed);
                    }

                }

                if(scrolled !== false && $.ui.ddmanager && !o.dropBehaviour)
                    $.ui.ddmanager.prepareOffsets(this, event);
            }

            //Regenerate the absolute position used for position checks
            this.positionAbs = this._convertPositionTo("absolute");

            // mjs - find the top offset before rearrangement,
            var previousTopOffset = this.placeholder.offset().top;

            //Set the helper position
            if(!this.options.axis || this.options.axis !== "y") {
                this.helper[0].style.left = this.position.left+"px";
            }
            if(!this.options.axis || this.options.axis !== "x") {
                this.helper[0].style.top = this.position.top+"px";
            }

            // mjs - check and reset hovering state at each cycle
            this.hovering = this.hovering ? this.hovering : null;
            this.mouseentered = this.mouseentered ? this.mouseentered : false;

            // mjs - let's start caching some variables
            var parentItem = (this.placeholder[0].parentNode.parentNode &&
                             $(this.placeholder[0].parentNode.parentNode).closest('.ui-sortable').length)
                                   ? $(this.placeholder[0].parentNode.parentNode)
                                   : null,
                level = this._getLevel(this.placeholder),
                childLevels = this._getChildLevels(this.helper);

            var newList = document.createElement(o.listType);

            //Rearrange
            for (i = this.items.length - 1; i >= 0; i--) {

                //Cache variables and intersection, continue if no intersection
                item = this.items[i];
                itemElement = item.item[0];
                intersection = this._intersectsWithPointer(item);
                if (!intersection) {
                    continue;
                }

                // Only put the placeholder inside the current Container, skip all
                // items form other containers. This works because when moving
                // an item from one container to another the
                // currentContainer is switched before the placeholder is moved.
                //
                // Without this moving items in "sub-sortables" can cause the placeholder to jitter
                // beetween the outer and inner container.
                if (item.instance !== this.currentContainer) {
                    continue;
                }

                // cannot intersect with itself
                // no useless actions that have been done before
                // no action if the item moved is the parent of the item checked
                if (itemElement !== this.currentItem[0] &&
                    this.placeholder[intersection === 1 ? "next" : "prev"]()[0] !== itemElement &&
                    !$.contains(this.placeholder[0], itemElement) &&
                    (this.options.type === "semi-dynamic" ? !$.contains(this.element[0], itemElement) : true)
                ) {

                    // mjs - we are intersecting an element: trigger the mouseenter event and store this state
                    if (!this.mouseentered) {
                        $(itemElement).mouseenter();
                        this.mouseentered = true;
                    }

                    // mjs - if the element has children and they are hidden, show them after a delay (CSS responsible)
                    if (o.isTree && $(itemElement).hasClass(o.collapsedClass) && o.expandOnHover) {
                        if (!this.hovering) {
                            $(itemElement).addClass(o.hoveringClass);
                            var self = this;
                            this.hovering = window.setTimeout(function() {
                                $(itemElement).removeClass(o.collapsedClass).addClass(o.expandedClass);
                                self.refreshPositions();
                                self._trigger("expand", event, self._uiHash());
                            }, o.expandOnHover);
                        }
                    }

                    this.direction = intersection == 1 ? "down" : "up";

                    // mjs - rearrange the elements and reset timeouts and hovering state
                    if (this.options.tolerance == "pointer" || this._intersectsWithSides(item)) {
                        $(itemElement).mouseleave();
                        this.mouseentered = false;
                        $(itemElement).removeClass(o.hoveringClass);
                        this.hovering && window.clearTimeout(this.hovering);
                        this.hovering = null;

                        // mjs - do not switch container if it's a root item and 'protectRoot' is true
                        // or if it's not a root item but we are trying to make it root
                        if (o.protectRoot
                            && ! (this.currentItem[0].parentNode == this.element[0] // it's a root item
                                  && itemElement.parentNode != this.element[0]) // it's intersecting a non-root item
                        ) {
                            if (this.currentItem[0].parentNode != this.element[0]
                                   && itemElement.parentNode == this.element[0]
                            ) {

                                if ( ! $(itemElement).children(o.listType).length) {
                                    itemElement.appendChild(newList);
                                    o.isTree && $(itemElement).removeClass(o.leafClass).addClass(o.branchClass + ' ' + o.expandedClass);
                                }

                                var a = this.direction === "down" ? $(itemElement).prev().children(o.listType) : $(itemElement).children(o.listType);
                                if (a[0] !== undefined) {
                                    this._rearrange(event, null, a);
                                }

                            } else {
                                this._rearrange(event, item);
                            }
                        } else if ( ! o.protectRoot) {
                            this._rearrange(event, item);
                        }
                    } else {
                        break;
                    }

                    // Clear emtpy ul's/ol's
                    this._clearEmpty(itemElement);

                    this._trigger("change", event, this._uiHash());
                    break;
                }
            }

            // mjs - to find the previous sibling in the list, keep backtracking until we hit a valid list item.
            var previousItem = this.placeholder[0].previousSibling ? $(this.placeholder[0].previousSibling) : null;
            if (previousItem != null) {
                while (previousItem[0].nodeName.toLowerCase() != $(o.listType)[0].nodeName.toLowerCase() || previousItem[0] == this.currentItem[0] || previousItem[0] == this.helper[0]) {
                    if (previousItem[0].previousSibling) {
                        previousItem = $(previousItem[0].previousSibling);
                    } else {
                        previousItem = null;
                        break;
                    }
                }
            }

            // mjs - to find the next sibling in the list, keep stepping forward until we hit a valid list item.
            var nextItem = this.placeholder[0].nextSibling ? $(this.placeholder[0].nextSibling) : null;
            if (nextItem != null) {
                while (nextItem[0].nodeName.toLowerCase() != $(o.listType)[0].nodeName.toLowerCase() || nextItem[0] == this.currentItem[0] || nextItem[0] == this.helper[0]) {
                    if (nextItem[0].nextSibling) {
                        nextItem = $(nextItem[0].nextSibling);
                    } else {
                        nextItem = null;
                        break;
                    }
                }
            }

            this.beyondMaxLevels = 0;

            // mjs - if the item is moved to the left, send it one level up but only if it's at the bottom of the list
            if (parentItem != null
                && nextItem == null
                && ! (o.protectRoot && parentItem[0].parentNode == this.element[0])
                &&
                    (o.rtl && (this.positionAbs.left + this.helper.outerWidth() > parentItem.offset().left + parentItem.outerWidth())
                     || ! o.rtl && (this.positionAbs.left < parentItem.offset().left))
            ) {

                parentItem.after(this.placeholder[0]);
                if (o.isTree && parentItem.children(o.listItem).children(o.listItem + ':visible:not(.ui-sortable-helper)').length < 1) {
                    parentItem.removeClass(this.options.branchClass + ' ' + this.options.expandedClass)
                              .addClass(this.options.leafClass);
                }
                this._clearEmpty(parentItem[0]);
                this._trigger("change", event, this._uiHash());
            }
            // mjs - if the item is below a sibling and is moved to the right, make it a child of that sibling
            else if (previousItem != null
                     && ! previousItem.hasClass(o.disableNestingClass)
                     &&
                        (previousItem.children(o.listType).length && previousItem.children(o.listType).is(':visible')
                         || ! previousItem.children(o.listType).length)
                     && ! (o.protectRoot && this.currentItem[0].parentNode == this.element[0])
                     &&
                        (o.rtl && (this.positionAbs.left + this.helper.outerWidth() < previousItem.offset().left + previousItem.outerWidth() - o.tabSize)
                         || ! o.rtl && (this.positionAbs.left > previousItem.offset().left + o.tabSize))
            ) {

                this._isAllowed(previousItem, level, level+childLevels+1);

                if (!previousItem.children(o.listType).length) {
                    previousItem[0].appendChild(newList);
                    o.isTree && previousItem.removeClass(o.leafClass).addClass(o.branchClass + ' ' + o.expandedClass);
                }

                // mjs - if this item is being moved from the top, add it to the top of the list.
                if (previousTopOffset && (previousTopOffset <= previousItem.offset().top)) {
                    previousItem.children(o.listType).prepend(this.placeholder);
                }
                // mjs - otherwise, add it to the bottom of the list.
                else if(previousItem.children(o.listType).length) {
                    previousItem.children(o.listType)[0].appendChild(this.placeholder[0]);
                }

                this._trigger("change", event, this._uiHash());
            }
            else {
                this._isAllowed(parentItem, level, level+childLevels);
            }

            //Post events to containers
            this._contactContainers(event);

            //Interconnect with droppables
            if($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event);
            }

            //Call callbacks
            this._trigger('sort', event, this._uiHash());

            this.lastPositionAbs = this.positionAbs;
            return false;

        },

        _mouseStop: function(event, noPropagation) {

            // mjs - if the item is in a position not allowed, send it back
            if (this.beyondMaxLevels) {

                this.placeholder.removeClass(this.options.errorClass);

                if (this.domPosition.prev) {
                    $(this.domPosition.prev).after(this.placeholder);
                } else {
                    $(this.domPosition.parent).prepend(this.placeholder);
                }

                this._trigger("revert", event, this._uiHash());

            }


            // mjs - clear the hovering timeout, just to be sure
            $('.'+this.options.hoveringClass).mouseleave().removeClass(this.options.hoveringClass);
            this.mouseentered = false;
            this.hovering && window.clearTimeout(this.hovering);
            this.hovering = null;

            $.ui.sortable.prototype._mouseStop.apply(this, arguments);

        },

        // mjs - this function is slightly modified to make it easier to hover over a collapsed element and have it expand
        _intersectsWithSides: function(item) {

            var half = this.options.isTree ? .8 : .5;

            var isOverBottomHalf = isOverAxis(this.positionAbs.top + this.offset.click.top, item.top + (item.height*half), item.height),
                isOverTopHalf = isOverAxis(this.positionAbs.top + this.offset.click.top, item.top - (item.height*half), item.height),
                isOverRightHalf = isOverAxis(this.positionAbs.left + this.offset.click.left, item.left + (item.width/2), item.width),
                verticalDirection = this._getDragVerticalDirection(),
                horizontalDirection = this._getDragHorizontalDirection();

            if (this.floating && horizontalDirection) {
                return ((horizontalDirection == "right" && isOverRightHalf) || (horizontalDirection == "left" && !isOverRightHalf));
            } else {
                return verticalDirection && ((verticalDirection == "down" && isOverBottomHalf) || (verticalDirection == "up" && isOverTopHalf));
            }

        },

        _contactContainers: function(event) {

            if (this.options.protectRoot && this.currentItem[0].parentNode == this.element[0] ) {
                return;
            }

            $.ui.sortable.prototype._contactContainers.apply(this, arguments);

        },

        _clear: function(event, noPropagation) {

            $.ui.sortable.prototype._clear.apply(this, arguments);

            // mjs - clean last empty ul/ol
            for (var i = this.items.length - 1; i >= 0; i--) {
                var item = this.items[i].item[0];
                this._clearEmpty(item);
            }

        },

        serialize: function(options) {

            var o = $.extend({}, this.options, options),
                items = this._getItemsAsjQuery(o && o.connected),
                str = [];

            $(items).each(function() {
                var res = ($(o.item || this).attr(o.attribute || 'id') || '')
                        .match(o.expression || (/(.+)[-=_](.+)/)),
                    pid = ($(o.item || this).parent(o.listType)
                        .parent(o.items)
                        .attr(o.attribute || 'id') || '')
                        .match(o.expression || (/(.+)[-=_](.+)/));

                if (res) {
                    str.push(((o.key || res[1]) + '[' + (o.key && o.expression ? res[1] : res[2]) + ']')
                        + '='
                        + (pid ? (o.key && o.expression ? pid[1] : pid[2]) : o.rootID));
                }
            });

            if(!str.length && o.key) {
                str.push(o.key + '=');
            }

            return str.join('&');

        },

        toHierarchy: function(options) {

            var o = $.extend({}, this.options, options),
                sDepth = o.startDepthCount || 0,
                ret = [];

            $(this.element).children(o.items).each(function () {
                var level = _recursiveItems(this);
                ret.push(level);
            });

            return ret;

            function _recursiveItems(item) {
                var id = ($(item).attr(o.attribute || 'id') || '').match(o.expression || (/(.+)[-=_](.+)/));
                if (id) {
                    var currentItem = {"id" : id[2]};
                    if ($(item).children(o.listType).children(o.items).length > 0) {
                        currentItem.children = [];
                        $(item).children(o.listType).children(o.items).each(function() {
                            var level = _recursiveItems(this);
                            currentItem.children.push(level);
                        });
                    }
                    return currentItem;
                }
            }
        },

        toArray: function(options) {

            var o = $.extend({}, this.options, options),
                sDepth = o.startDepthCount || 0,
                ret = [],
                left = 1;

            if (!o.excludeRoot) {
                ret.push({
                    "item_id": o.rootID,
                    "parent_id": null,
                    "depth": sDepth,
                    "left": left,
                    "right": ($(o.items, this.element).length + 1) * 2
                });
                left++
            }

            $(this.element).children(o.items).each(function () {
                left = _recursiveArray(this, sDepth + 1, left);
            });

            ret = ret.sort(function(a,b){ return (a.left - b.left); });

            return ret;

            function _recursiveArray(item, depth, left) {

                var right = left + 1,
                    id,
                    pid;

                if ($(item).children(o.listType).children(o.items).length > 0) {
                    depth ++;
                    $(item).children(o.listType).children(o.items).each(function () {
                        right = _recursiveArray($(this), depth, right);
                    });
                    depth --;
                }

                id = ($(item).attr(o.attribute || 'id')).match(o.expression || (/(.+)[-=_](.+)/));

                if (depth === sDepth + 1) {
                    pid = o.rootID;
                } else {
                    var parentItem = ($(item).parent(o.listType)
                                             .parent(o.items)
                                             .attr(o.attribute || 'id'))
                                             .match(o.expression || (/(.+)[-=_](.+)/));
                    pid = parentItem[2];
                }

                if (id) {
                        ret.push({"item_id": id[2], "parent_id": pid, "depth": depth, "left": left, "right": right});
                }

                left = right + 1;
                return left;
            }

        },

        _clearEmpty: function(item) {
            var o = this.options;

            var emptyList = $(item).children(o.listType);

            if (emptyList.length && !emptyList.children().length && !o.doNotClear) {
                o.isTree && $(item).removeClass(o.branchClass + ' ' + o.expandedClass).addClass(o.leafClass);
                emptyList.remove();
            } else if (o.isTree && emptyList.length && emptyList.children().length && emptyList.is(':visible')) {
                $(item).removeClass(o.leafClass).addClass(o.branchClass + ' ' + o.expandedClass);
            } else if (o.isTree && emptyList.length && emptyList.children().length && !emptyList.is(':visible')) {
                $(item).removeClass(o.leafClass).addClass(o.branchClass + ' ' + o.collapsedClass);
            }

        },

        _getLevel: function(item) {

            var level = 1;

            if (this.options.listType) {
                var list = item.closest(this.options.listType);
                while (list && list.length > 0 &&
                        !list.is('.ui-sortable')) {
                    level++;
                    list = list.parent().closest(this.options.listType);
                }
            }

            return level;
        },

        _getChildLevels: function(parent, depth) {
            var self = this,
                o = this.options,
                result = 0;
            depth = depth || 0;

            $(parent).children(o.listType).children(o.items).each(function (index, child) {
                    result = Math.max(self._getChildLevels(child, depth + 1), result);
            });

            return depth ? result + 1 : result;
        },

        _isAllowed: function(parentItem, level, levels) {
            var o = this.options,
                maxLevels = this.placeholder.closest('.ui-sortable').nestedSortable('option', 'maxLevels'); // this takes into account the maxLevels set to the recipient list

            // mjs - is the root protected?
            // mjs - are we nesting too deep?
            if ( ! o.isAllowed(this.placeholder, parentItem, this.currentItem)) {
                    this.placeholder.addClass(o.errorClass);
                    if (maxLevels < levels && maxLevels != 0) {
                        this.beyondMaxLevels = levels - maxLevels;
                    } else {
                        this.beyondMaxLevels = 1;
                    }
            } else {
                if (maxLevels < levels && maxLevels != 0) {
                    this.placeholder.addClass(o.errorClass);
                    this.beyondMaxLevels = levels - maxLevels;
                } else {
                    this.placeholder.removeClass(o.errorClass);
                    this.beyondMaxLevels = 0;
                }
            }
        }

    }));

    $.mjs.nestedSortable.prototype.options = $.extend({}, $.ui.sortable.prototype.options, $.mjs.nestedSortable.prototype.options);
})(jQuery);
/*!
 * CMS.API.Helpers
 * Multiple helpers used across all CMS features
 */

//##############################################################################
// COMPATIBILITY

// ensuring django namespace is set correctly
window.django = window.django || undefined;

// ensuring jQuery namespace is set correctly
// istanbul ignore next
window.jQuery = (window.django && window.django.jQuery) ? window.django.jQuery : window.jQuery || undefined;

// ensuring Class namespace is set correctly
// istanbul ignore next
window.Class = window.Class || undefined;

// ensuring CMS namespace is set correctly
/**
 * @module CMS
 */
var CMS = {
    $: (typeof window.jQuery === 'function') ? window.jQuery :/* istanbul ignore next */ undefined,
    Class: (typeof window.Class === 'function') ? window.Class :/* istanbul ignore next */ undefined,
    /**
     * @module CMS
     * @submodule CMS.API
     */
    API: {},
    /**
     * Provides key codes for common keys.
     *
     * @module CMS
     * @submodule CMS.KEYS
     * @example
     *     if (e.keyCode === CMS.KEYS.ENTER) { ... };
     */
    KEYS: {
        SHIFT: 16,
        TAB: 9,
        UP: 38,
        DOWN: 40,
        ENTER: 13,
        SPACE: 32,
        ESC: 27,
        CMD_LEFT: 91,
        CMD_RIGHT: 93,
        CMD_FIREFOX: 224,
        CTRL: 17
    },
    /**
     * Provides breakpoints for certain device widths
     *
     * @module CMS
     * @submodule CMS.BREAKPOINTS
     * @example
     *     if (window.width >= CMS.BREAKPOINTS.mobile) { ... };
     */
    BREAKPOINTS: {
        mobile: 420
    }
};

//##############################################################################
// CMS.API
(function ($) {
    'use strict';
    /**
     * @function _ns
     * @private
     * @param {String} events space separated event names to be namespaces
     * @return {String} string containing space separated namespaced event names
     */
    var _ns = function nameSpaceEvent(events) {
        return events.split(/\s+/g).map(function (eventName) {
            return 'cms-' + eventName;
        }).join(' ');
    };

    /**
     * Provides various helpers that are mixed in all CMS classes.
     *
     * @class Helpers
     * @static
     * @module CMS
     * @submodule CMS.API
     * @namespace CMS.API
     */
    CMS.API.Helpers = {

        /**
         * Redirects to a specific url or reloads browser.
         *
         * @method reloadBrowser
         * @param {String} url where to redirect. if equal to `REFRESH_PAGE` will reload page instead
         * @param {Number} timeout=0 timeout in ms
         * @param {Boolean} ajax if set to true first initiates **synchronous**
         *     ajax request to figure out if the browser should reload current page,
         *     move to another one, or do nothing.
         * @param {Object} [data] optional data to be passed instead of one provided by request config
         * @param {String} [data.model=CMS.config.request.model]
         * @param {String|Number} [data.pk=CMS.config.request.pk]
         */
        reloadBrowser: function (url, timeout, ajax, data) {
            var that = this;
            // is there a parent window?
            var win = this._getWindow();
            var parent = (win.parent) ? win.parent : win;

            // if there is an ajax reload, prioritize
            if (ajax) {
                parent.CMS.API.locked = true;
                // check if the url has changed, if true redirect to the new path
                // this requires an ajax request
                $.ajax({
                    async: false,
                    type: 'GET',
                    url: parent.CMS.config.request.url,
                    data: data || {
                        model: parent.CMS.config.request.model,
                        pk: parent.CMS.config.request.pk
                    },
                    success: function (response) {
                        parent.CMS.API.locked = false;

                        if (response === '' && !url) {
                            // cancel if response is empty
                            return false;
                        } else if (parent.location.pathname !== response && response !== '') {
                            // api call to the backend to check if the current path is still the same
                            that.reloadBrowser(response);
                        } else if (url === 'REFRESH_PAGE') {
                            // if on_close provides REFRESH_PAGE, only do a reload
                            that.reloadBrowser();
                        } else if (url) {
                            // on_close can also provide a url, reload to the new destination
                            that.reloadBrowser(url);
                        } else {
                            that.reloadBrowser();
                        }
                    }
                });

                // cancel further operations
                return false;
            }

            // add timeout if provided
            parent.setTimeout(function () {
                if (url && url !== parent.location.href) {
                    // location.reload() takes precedence over this, so we
                    // don't want to reload the page if we need a redirect
                    parent.location.href = url;
                } else {
                    // ensure page is always reloaded #3413
                    parent.location.reload();
                }
            }, timeout || 0);
        },

        /**
         * Assigns an event handler to forms located in the toolbar
         * to prevent multiple submissions.
         *
         * @method preventSubmit
         */
        preventSubmit: function () {
            var forms = $('.cms-toolbar').find('form');
            forms.submit(function () {
                // show loader
                CMS.API.Toolbar.showLoader();
                // we cannot use disabled as the name action will be ignored
                $('input[type="submit"]').on('click', function (e) {
                    e.preventDefault();
                }).css('opacity', 0.5);
            });
        },

        /**
         * Sets csrf token header on ajax requests.
         *
         * @method csrf
         * @param {String} csrf_token
         */
        csrf: function (csrf_token) {
            $.ajaxSetup({
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('X-CSRFToken', csrf_token);
                }
            });
        },

        /**
         * Sends or retrieves a JSON from localStorage
         * or the session (through synchronous ajax request)
         * if localStorage is not available. Does not merge with
         * previous setSettings calls.
         *
         * @method setSettings
         * @param settings
         */
        setSettings: function (settings) {
            // merge settings
            settings = JSON.stringify($.extend({}, CMS.config.settings, settings));
            // set loader
            if (CMS.API.Toolbar) {
                CMS.API.Toolbar.showLoader();
            }

            // use local storage or session
            if (this._isStorageSupported) {
                // save within local storage
                localStorage.setItem('cms_cookie', settings);
                if (CMS.API.Toolbar) {
                    CMS.API.Toolbar.hideLoader();
                }
            } else {
                // save within session
                CMS.API.locked = true;

                $.ajax({
                    async: false,
                    type: 'POST',
                    url: CMS.config.urls.settings,
                    data: {
                        csrfmiddlewaretoken: CMS.config.csrf,
                        settings: settings
                    },
                    success: function (data) {
                        CMS.API.locked = false;
                        // determine if logged in or not
                        settings = (data) ? JSON.parse(data) : CMS.config.settings;
                        if (CMS.API.Toolbar) {
                            CMS.API.Toolbar.hideLoader();
                        }
                    },
                    error: function (jqXHR) {
                        CMS.API.Messages.open({
                            message: jqXHR.responseText + ' | ' + jqXHR.status + ' ' + jqXHR.statusText,
                            error: true
                        });
                    }
                });
            }

            // save settings
            CMS.settings = typeof settings === 'object' ? settings : JSON.parse(settings);

            // ensure new settings are returned
            return CMS.settings;
        },

        /**
         * Gets user settings (from JSON or the session)
         * in the same way as setSettings sets them.
         *
         * @method getSettings
         */
        getSettings: function () {
            var settings;
            // set loader
            if (CMS.API.Toolbar) {
                CMS.API.Toolbar.showLoader();
            }

            // use local storage or session
            if (this._isStorageSupported) {
                // get from local storage
                settings = JSON.parse(localStorage.getItem('cms_cookie'));
                if (CMS.API.Toolbar) {
                    CMS.API.Toolbar.hideLoader();
                }
            } else {
                CMS.API.locked = true;
                // get from session
                $.ajax({
                    async: false,
                    type: 'GET',
                    url: CMS.config.urls.settings,
                    success: function (data) {
                        CMS.API.locked = false;
                        // determine if logged in or not
                        settings = (data) ? JSON.parse(data) : CMS.config.settings;
                        if (CMS.API.Toolbar) {
                            CMS.API.Toolbar.hideLoader();
                        }
                    },
                    error: function (jqXHR) {
                        CMS.API.Messages.open({
                            message: jqXHR.responseText + ' | ' + jqXHR.status + ' ' + jqXHR.statusText,
                            error: true
                        });
                    }
                });
            }

            if (!settings) {
                settings = this.setSettings(CMS.config.settings);
            }

            // save settings
            CMS.settings = settings;

            // ensure new settings are returned
            return CMS.settings;
        },

        /**
         * Modifies the url with new params and sanitises
         * the ampersand within the url for #3404.
         *
         * @method makeURL
         * @param {String} url original url
         * @param {String[]} [params] array of `param=value` strings to update the url
         */
        makeURL: function makeURL(url, params) {
            var arr = [];
            var keys = [];
            var values = [];
            var tmp = '';
            var urlArray = [];
            var urlParams = [];
            var origin = url;

            // return url if there is no param
            if (url.split('?').length > 1) {
                // setup local vars
                urlArray = url.split('?');
                urlParams = urlArray[1].replace(/&(?:amp;)/g, '&').split('&');
                origin = urlArray[0];
            }

            // loop through the available params
            $.each(urlParams, function (index, param) {
                arr.push({
                    param: param.split('=')[0],
                    value: param.split('=')[1]
                });
            });
            // loop through the new params
            if (params && params.length) {
                $.each(params, function (index, param) {
                    arr.push({
                        param: param.split('=')[0],
                        value: param.split('=')[1]
                    });
                });
            }

            // merge manually because jquery...
            $.each(arr, function (index, item) {
                var i = $.inArray(item.param, keys);

                if (i === -1) {
                    keys.push(item.param);
                    values.push(item.value);
                } else {
                    values[i] = item.value;
                }
            });

            // merge new url
            $.each(keys, function (index, key) {
                tmp += '&' + key + '=' + values[index];
            });
            tmp = tmp.replace('&', '?');
            url = origin + tmp;
            url = url.replace(/&/g, '&amp;');

            return url;
        },

        /**
         * Creates a debounced function that delays invoking `func`
         * until after `wait` milliseconds have elapsed since
         * the last time the debounced function was invoked.
         * Optionally can be invoked first time immediately.
         *
         * @method debounce
         * @param {Function} func function to debounce
         * @param {Number} wait time in ms to wait
         * @param {Object} [opts]
         * @param {Boolean} [opts.immediate] trigger func immediately?
         * @return {Function}
         */
        debounce: function debounce(func, wait, opts) {
            var timeout;
            return function () {
                var context = this, args = arguments;
                var later = function () {
                    timeout = null;
                    if (!opts || !opts.immediate) {
                        func.apply(context, args);
                    }
                };
                var callNow = opts && opts.immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) {
                    func.apply(context, args);
                }
            };
        },

        /**
         * Returns a function that when invoked, will only be triggered
         * at most once during a given window of time. Normally, the
         * throttled function will run as much as it can, without ever
         * going more than once per `wait` duration, but if you’d like to
         * disable the execution on the leading edge, pass `{leading: false}`.
         * To disable execution on the trailing edge, ditto.
         *
         * @method throttle
         * @param {Function} func function to throttle
         * @param {Number} wait time window
         * @param {Object} [opts]
         * @param {Boolean} [opts.leading=true] execute on the leading edge
         * @param {Boolean} [opts.trailing=true] execute on the trailing edge
         * @return {Function}
         */
        throttle: function throttle(func, wait, opts) {
            var context, args, result;
            var timeout = null;
            var previous = 0;
            if (!opts) {
                opts = {};
            }
            var later = function () {
                previous = opts.leading === false ? 0 : $.now();
                timeout = null;
                result = func.apply(context, args);
                if (!timeout) {
                    context = args = null;
                }
            };
            return function () {
                var now = $.now();
                if (!previous && opts.leading === false) {
                    previous = now;
                }
                var remaining = wait - (now - previous);
                context = this;
                args = arguments;
                if (remaining <= 0 || remaining > wait) {
                    // istanbul ignore if
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                    previous = now;
                    result = func.apply(context, args);
                    if (!timeout) {
                        context = args = null;
                    }
                } else if (!timeout && opts.trailing !== false) {
                    timeout = setTimeout(later, remaining);
                }
                return result;
            };
        },

        /**
         * Browsers allow to "Prevent this page form creating additional
         * dialogs." checkbox which prevents further input from confirm messages.
         * This method falls back to "true" once the user chooses this option.
         *
         * @method secureConfirm
         * @param {String} message to be displayed
         * @return {Boolean}
         */
        secureConfirm: function secureConfirm(message) {
            var start = Number(new Date());
            var result = confirm(message);
            var end = Number(new Date());

            return (end < (start + 10) || result === true);
        },

        /**
         * Is localStorage truly supported?
         * Check is taken from modernizr.
         *
         * @property _isStorageSupported
         * @private
         * @type {Boolean}
         */
        _isStorageSupported: (function localStorageCheck() {
            var mod = 'modernizr';
            try {
                localStorage.setItem(mod, mod);
                localStorage.removeItem(mod);
                return true;
            } catch (e) {
                // istanbul ignore next
                return false;
            }
        }()),

        /**
         * Adds an event listener to the "CMS".
         *
         * @method addEventListener
         * @param {String} eventName string containing space separated event names
         * @param {Function} fn callback to run when the event happens
         */
        addEventListener: function addEventListener(eventName, fn) {
            return CMS._eventRoot.on(_ns(eventName), fn);
        },

        /**
         * Removes the event listener from the "CMS". If a callback is provided - removes only that callback.
         *
         * @method removeEventListener
         * @param {String} eventName string containing space separated event names
         * @param {Function} [fn] specific callback to be removed
         */
        removeEventListener: function removeEventListener(eventName, fn) {
            return CMS._eventRoot.off(_ns(eventName), fn);
        },

        /**
         * Dispatches an event
         * @method dispatchEvent
         * @param {String} eventName  string containing space separated event names
         * @param {Object} payload whatever payload required for the consumer
         */
        dispatchEvent: function dispatchEvent(eventName, payload) {
            return CMS._eventRoot.trigger(_ns(eventName), [payload]);
        },

        /**
         * Returns a function that wraps the passed function so the wrapped function
         * is executed only once, no matter how many times the wrapper function is executed.
         *
         * @method once
         * @param {Function} fn function to be executed only once
         * @return {Function}
         */
        once: function once(fn) {
            var result;
            var didRunOnce = false;

            return function () {
                if (didRunOnce) {
                    fn = undefined;
                } else {
                    didRunOnce = true;
                    result = fn.apply(this, arguments);
                }
                return result;
            };
        },

        /**
         * Prevents scrolling with touch in an element.
         *
         * @method preventTouchScrolling
         * @param {jQuery} element element where we are preventing the scroll
         * @param {String} namespace so we don't mix events from two different places on the same element
         */
        preventTouchScrolling: function preventTouchScrolling(element, namespace) {
            element.on('touchmove.cms.preventscroll.' + namespace, function (e) {
                e.preventDefault();
            });
        },

        /**
        * Allows scrolling with touch in an element.
        *
        * @method allowTouchScrolling
        * @param {jQuery} element element where we are allowing the scroll again
        * @param {String} namespace so we don't accidentally remove events from a different handler
        */
        allowTouchScrolling: function allowTouchScrolling(element, namespace) {
            element.off('touchmove.cms.preventscroll.' + namespace);
        },

        /**
         * Returns window object.
         *
         * @method _getWindow
         * @private
         * @returns {Window}
         */
        _getWindow: function () {
            return window;
        }

    };

    // shorthand for jQuery(document).ready();
    $(function () {
        CMS._eventRoot = $('#cms-top');
        // autoinits
        CMS.API.Helpers.preventSubmit();
    });
})(CMS.$);

/*!========================================================================
 * Originally taken from
 * Bootstrap: transition.js v3.3.5
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
<<<<<<< HEAD
/* global CMS */

(function ($) {
    'use strict';

    // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
    // ============================================================

    function transitionEnd() {
        var el = document.createElement('cms');

        var transEndEventNames = {
            WebkitTransition: 'webkitTransitionEnd',
            MozTransition: 'transitionend',
            OTransition: 'oTransitionEnd otransitionend',
            transition: 'transitionend'
        };

        for (var name in transEndEventNames) {
            if (el.style[name] !== undefined) {
                return { end: transEndEventNames[name] };
            }
        }

        return false; // explicit for ie8 (  ._.)
    }

    // http://blog.alexmaccaw.com/css-transitions
    $.fn.emulateTransitionEnd = function (duration) {
        var called = false;
        var $el = this;
        $(this).one('cmsTransitionEnd', function () {
            called = true;
        });
        var callback = function () {
            if (!called) {
                $($el).trigger($.support.transition.end) ;
            }
        };
        setTimeout(callback, duration + 10);
        return this;
    };

    $(function () {
        $.support.transition = transitionEnd();

        if (!$.support.transition) {
            return;
        }

        $.event.special.cmsTransitionEnd = {
            bindType: $.support.transition.end,
            delegateType: $.support.transition.end,
            handle: function (e) {
                if ($(e.target).is(this)) {
                    return e.handleObj.handler.apply(this, arguments);
                }
            }
        };
    });

    // has to be attached to CMS
}(CMS.$));

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

// #############################################################################
// MODAL
(function ($) {
    'use strict';

    /**
     * Displays a message underneath the toolbar.
     *
     * @class Messages
     * @namespace CMS
     */
    CMS.Messages = new CMS.Class({

        options: {
            messageDuration: 300,
            messageDelay: 3000
        },

        initialize: function initialize(options) {
            this.options = $.extend(true, {}, this.options, options);

            // states and events
            this.click = 'click.cms.message';

            // elements
            this._setupUI();
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var container = $('.cms');
            this.ui = {
                container: container,
                body: $('html'),
                toolbar: container.find('.cms-toolbar'),
                messages: container.find('.cms-messages')
            };
        },

        /**
         * Opens a message window underneath the toolbar.
         *
         * @method open
         * @param opts
         * @param {String|HTMLNode} opts.message message to be displayed
         * @param {String} [opts.dir='center'] direction to be displayed `center` `left` or `right`
         * @param {Number} [opts.delay=this.options.messageDelay] delay until message is closed, 0 leaves it open
         * @param {Boolean} [opts.error] if true sets the style to `.cms-messages-error`
         */
        open: function open(opts) {
            if (!(opts && opts.message)) {
                throw new Error('The arguments passed to "open" were invalid.');
            }

            var that = this;

            var msg = opts.message;
            var dir = opts.dir === undefined ? 'center' : opts.dir;
            var delay = opts.delay === undefined ? this.options.messageDelay : opts.delay;
            var error = opts.error === undefined ? false : opts.error;

            var width = 320;
            var height = this.ui.messages.outerHeight(true);
            var top = this.ui.toolbar.outerHeight(true);
            var close = this.ui.messages.find('.cms-messages-close');

            // add content to element
            this.ui.messages.find('.cms-messages-inner').html(msg);

            // error handling
            this.ui.messages.removeClass('cms-messages-error');
            if (error) {
                this.ui.messages.addClass('cms-messages-error');
            }

            // clear timeout
            clearTimeout(this.timer);

            close.hide();
            close.off(this.click).on(this.click, function () {
                that.close();
            });

            // set top to 0 if toolbar is collapsed
            if (CMS.settings.toolbar === 'collapsed') {
                top = 0;
            }

            // set correct position and show
            this.ui.messages.css('top', -height).show();

            // set correct direction and animation
            switch (dir) {
                case 'left':
                    this.ui.messages.css({
                        'top': top,
                        'left': -width,
                        'right': 'auto',
                        'margin-left': 0
                    });
                    this.ui.messages.animate({ 'left': 0 });
                    break;
                case 'right':
                    this.ui.messages.css({
                        'top': top,
                        'right': -width,
                        'left': 'auto',
                        'margin-left': 0
                    });
                    this.ui.messages.animate({ 'right': 0 });
                    break;
                default:
                    this.ui.messages.css({
                        'left': '50%',
                        'right': 'auto',
                        'margin-left': -(width / 2)
                    });
                    this.ui.messages.animate({ 'top': top });
            }

            // cancel autohide if delay is <= 0
            if (delay <= 0) {
                close.show();
            } else {
                // add delay to hide if delay > 0
                this.timer = setTimeout(function () {
                    that.close();
                }, delay);
            }
        },

        /**
         * Closes the message window underneath the toolbar.
         *
         * @method close
         */
        close: function close() {
            this.ui.messages.fadeOut(this.options.messageDuration);
        }

    });
})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

// #############################################################################
// MODAL
(function ($) {
    'use strict';

    /**
     * The modal is triggered via API calls from the backend either
     * through the toolbar navigation or from plugins. The APIs allow to
     * open content from a url (iframe) or inject html directly.
     *
     * @class Modal
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.Modal = new CMS.Class({

        implement: [CMS.API.Helpers],

        options: {
            onClose: false,
            minHeight: 400,
            minWidth: 800,
            modalDuration: 200,
            newPlugin: false,
            resizable: true,
            maximizable: true,
            minimizable: true
        },

        initialize: function initialize(options) {
            this.options = $.extend(true, {}, this.options, options);

            // elements
            this._setupUI();
            // event emitter
            this._setupEventEmitter();

            // states and events
            this.click = 'click.cms.modal';
            this.pointerDown = 'pointerdown.cms.modal contextmenu.cms.modal';
            this.pointerUp = 'pointerup.cms.modal pointercancel.cms.modal';
            this.pointerMove = 'pointermove.cms.modal';
            this.doubleClick = 'dblclick.cms.modal';
            this.touchEnd = 'touchend.cms.modal';
            this.maximized = false;
            this.minimized = false;
            this.triggerMaximized = false;
            this.saved = false;
        },

        /**
         * Setup event pubsub mechanism for the instance.
         *
         * @private
         * @method _setupEventEmitter
         */
        _setupEventEmitter: function _setupEventEmitter() {
            var that = this;
            var bus = $({});

            function proxy(name) {
                return function () {
                    bus[name].apply(bus, arguments);
                    return that;
                };
            }

            this.trigger = proxy('trigger');
            this.one = proxy('one');
            this.on = proxy('on');
            this.off = proxy('off');
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var modal = $('.cms-modal');
            this.ui = {
                modal: modal,
                body: $('html'),
                window: $(window),
                toolbarLeftPart: $('.cms-toolbar-left'),
                minimizeButton: modal.find('.cms-modal-minimize'),
                maximizeButton: modal.find('.cms-modal-maximize'),
                title: modal.find('.cms-modal-title'),
                titlePrefix: modal.find('.cms-modal-title-prefix'),
                titleSuffix: modal.find('.cms-modal-title-suffix'),
                resize: modal.find('.cms-modal-resize'),
                breadcrumb: modal.find('.cms-modal-breadcrumb'),
                closeAndCancel: modal.find('.cms-modal-close, .cms-modal-cancel'),
                modalButtons: modal.find('.cms-modal-buttons'),
                modalBody: modal.find('.cms-modal-body'),
                frame: modal.find('.cms-modal-frame'),
                shim: modal.find('.cms-modal-shim')
            };
        },

        /**
         * Sets up all the event handlers, such as maximize/minimize and resizing.
         *
         * @method _events
         * @private
         */
        _events: function _events() {
            var that = this;

            // modal behaviours
            this.ui.minimizeButton.
                off(this.click + ' ' + this.touchEnd)
                .on(this.click + ' ' + this.touchEnd, function (e) {
                e.preventDefault();
                that.minimize();
            });
            this.ui.maximizeButton
                .off(this.click + ' ' + this.touchEnd)
                .on(this.click + ' ' + this.touchEnd, function (e) {
                e.preventDefault();
                that.maximize();
            });

            this.ui.title.off(this.pointerDown).on(this.pointerDown, function (e) {
                e.preventDefault();
                that._startMove(e);
            });
            this.ui.title.off(this.doubleClick).on(this.doubleClick, function () {
                that.maximize();
            });

            this.ui.resize.off(this.pointerDown).on(this.pointerDown, function (e) {
                e.preventDefault();
                that._startResize(e);
            });

            this.ui.closeAndCancel
                .off(this.click + ' ' + this.touchEnd)
                .on(this.click + ' ' + this.touchEnd, function (e) {
                that.options.onClose = null;
                e.preventDefault();
                that.close();
            });

            // elements within the window
            this.ui.breadcrumb.off(this.click, 'a').on(this.click, 'a', function (e) {
                e.preventDefault();
                that._changeIframe($(this));
            });
        },

        /**
         * Opens the modal either in an iframe or renders markup.
         *
         * @method open
         * @chainable
         * @param {Object} opts either `opts.url` or `opts.html` are required
         * @param {Object[]} [opts.breadcrumbs] collection of breadcrumb items
         * @param {String|HTMLNode|jQuery} [opts.html] html markup to render
         * @param {String} [opts.title] modal window main title (bold)
         * @param {String} [opts.subtitle] modal window secondary title (normal)
         * @param {String} [opts.url] url to render iframe, takes precedence over `opts.html`
         * @param {Number} [opts.width] sets the width of the modal
         * @param {Number} [opts.height] sets the height of the modal
         */
        open: function open(opts) {
            // setup internals
            if (!(opts && opts.url || opts && opts.html)) {
                throw new Error('The arguments passed to "open" were invalid.');
            }

            // handle remove option when plugin is new
            // cancel open process when switching context
            if (CMS._newPlugin && !this._deletePlugin()) {
                return false;
            }

            // We have to rebind events every time we open a modal
            // because the event handlers contain references to the instance
            // and since we reuse the same markup we need to update
            // that instance reference every time.
            this._events();

            this.trigger('cms.modal.load');
            // trigger the event also on the dom element,
            // because if we load another modal while one is already open
            // the older instance won't receive any updates
            this.ui.modal.trigger('cms.modal.load');

            // common elements state
            this.ui.resize.toggle(this.options.resizable);
            this.ui.minimizeButton.toggle(this.options.minimizable);
            this.ui.maximizeButton.toggle(this.options.maximizable);

            var position = this._calculateNewPosition(opts);

            this.ui.maximizeButton.removeClass('cms-modal-maximize-active');
            this.maximized = false;

            // new plugin will freeze the creation process
            if (this.options.newPlugin) {
                CMS._newPlugin = this.options.newPlugin;
            }

            // because a new instance is called, we have to ensure minimized state is removed #3620
            if (this.ui.body.hasClass('cms-modal-minimized')) {
                this.minimized = true;
                this.minimize();
            }

            // clear elements
            this.ui.modalButtons.empty();
            this.ui.breadcrumb.empty();

            // remove class from modal when no breadcrumbs is rendered
            this.ui.modal.removeClass('cms-modal-has-breadcrumb');

            // hide tooltip
            CMS.API.Tooltip.hide();

            // redirect to iframe rendering if url is provided
            if (opts.url) {
                this._loadIframe({
                    url: opts.url,
                    title: opts.title,
                    breadcrumbs: opts.breadcrumbs
                });
            } else {
                // if url is not provided we go for html
                this._loadMarkup({
                    html: opts.html,
                    title: opts.title,
                    subtitle: opts.subtitle
                });
            }

            this.trigger('cms.modal.loaded');

            // display modal
            this._show($.extend({
                duration: this.options.modalDuration
            }, position));

            return this;
        },

        /**
         * Calculates coordinates and dimensions for modal placement
         *
         * @method _calculateNewPosition
         * @private
         * @param {Object} [opts]
         * @param {Number} [opts.width] desired width of the modal
         * @param {Number} [opts.height] desired height of the modal
         */
        _calculateNewPosition: function (opts) {
            // lets set the modal width and height to the size of the browser
            var widthOffset = 300; // adds margin left and right
            var heightOffset = 300; // adds margin top and bottom;
            var screenWidth = this.ui.window.width();
            var screenHeight = this.ui.window.height();
            var modalWidth = opts.width || this.options.minWidth;
            var modalHeight = opts.height || this.options.minHeight;
            // screen width and height calculation, WC = width
            var screenWidthCalc = screenWidth >= (modalWidth + widthOffset);
            var screenHeightCalc = screenHeight >= (modalHeight + heightOffset);

            var width = screenWidthCalc && !opts.width ? screenWidth - widthOffset : modalWidth;
            var height = screenHeightCalc && !opts.height ? screenHeight - heightOffset : modalHeight;

            var currentLeft = this.ui.modal.css('left');
            var currentTop = this.ui.modal.css('top');
            var newLeft;
            var newTop;

            // jquery made me do it
            if (currentLeft === '50%') {
                currentLeft = screenWidth / 2;
            }
            if (currentTop === '50%') {
                currentTop = screenHeight / 2;
            }

            currentTop = parseInt(currentTop);
            currentLeft = parseInt(currentLeft);

            // if new width/height go out of the screen - reset position to center of screen
            if ((width / 2 + currentLeft > screenWidth) || (height / 2 + currentTop > screenHeight) ||
                (currentLeft - width / 2 < 0) || (currentTop - height / 2 < 0)) {
                newLeft = screenWidth / 2;
                newTop = screenHeight / 2;
            }

            // in case, the modal is larger than the window, we trigger fullscreen mode
            if (width >= screenWidth || height >= screenHeight) {
                this.triggerMaximized = true;
            }

            return {
                width: width,
                height: height,
                top: newTop,
                left: newLeft
            };
        },

        /**
         * Animation helper for opening the sideframe.
         *
         * @method _show
         * @private
         * @param {Object} opts
         * @param {Number} opts.width width of the modal
         * @param {Number} opts.height height of the modal
         * @param {Number} opts.left left in px of the center of the modal
         * @param {Number} opts.top top in px of the center of the modal
         * @param {Number} opts.duration speed of opening, ms (not really used yet)
         */
        _show: function _show(opts) {
            // we need to position the modal in the center
            var that = this;
            var width = opts.width;
            var height = opts.height;
            // TODO make use of transitionDuration, currently capped at 0.2s
            var speed = opts.duration;
            var top = opts.top;
            var left = opts.left;


            if (this.ui.modal.hasClass('cms-modal-open')) {
                this.ui.modal.addClass('cms-modal-morphing');
            }

            this.ui.modal.css({
                'display': 'block',
                'width': width,
                'height': height,
                'top': top,
                'left': left,
                // TODO animate translateX if possible instead of margin
                'margin-left': -(width / 2),
                'margin-top': -(height / 2)
            });
            // setImmediate is required to go into the next frame
            setTimeout(function () {
                that.ui.modal.addClass('cms-modal-open');
            }, 0);

            this.ui.modal.one('cmsTransitionEnd', function () {
                that.ui.modal.removeClass('cms-modal-morphing');
                that.ui.modal.css({
                    'margin-left': -(width / 2),
                    'margin-top': -(height / 2)
                });

                // check if we should maximize
                if (that.triggerMaximized) {
                    that.maximize();
                }

                // changed locked status to allow other modals again
                CMS.API.locked = false;
                that.trigger('cms.modal.shown');
            }).emulateTransitionEnd(speed);

            // add esc close event
            this.ui.body.off('keydown.cms.close').on('keydown.cms.close', function (e) {
                if (e.keyCode === CMS.KEYS.ESC) {
                    that.options.onClose = null;
                    that.close();
                }
            });

            // set focus to modal
            this.ui.modal.focus();
        },

        /**
         * Closes the current instance.
         *
         * @method close
         */
        close: function close() {
            // handle refresh option
            if (this.options.onClose) {
                this.reloadBrowser(this.options.onClose, false, true);
            }

            // handle remove option when plugin is new
            if (CMS._newPlugin) {
                this._deletePlugin({
                    hideAfter: true
                });
            } else {
                this._hide({
                    duration: this.options.modalDuration / 2
                });
            }
        },

        /**
         * Animation helper for closing the iframe.
         *
         * @method _hide
         * @private
         * @param {Object} opts
         * @param {Number} [opts.duration=this.options.modalDuration] animation duration
         */
        _hide: function _hide(opts) {
            var that = this;
            var duration = this.options.modalDuration;

            if (opts && opts.duration) {
                duration = opts.duration;
            }

            this.ui.frame.empty();
            this.ui.modalBody.removeClass('cms-loader');
            this.ui.modal.removeClass('cms-modal-open');
            this.ui.modal.one('cmsTransitionEnd', function () {
                that.ui.modal.css('display', 'none');
            }).emulateTransitionEnd(duration);

            // reset maximize or minimize states for #3111
            setTimeout(function () {
                if (that.minimized) {
                    that.minimize();
                }
                if (that.maximized) {
                    that.maximize();
                }
                that.trigger('cms.modal.closed');
            }, this.options.duration);

            this.ui.body.off('keydown.cms.close');
        },

        /**
         * Minimizes the modal onto the toolbar.
         *
         * @method minimize
         */
        minimize: function minimize() {
            // cancel action if maximized
            if (this.maximized) {
                return false;
            }

            if (this.minimized === false) {
                // ensure toolbar is shown
                CMS.API.Toolbar.open();

                // save initial state
                this.ui.modal.data('css', this.ui.modal.css([
                    'left', 'top', 'margin-left', 'margin-top'
                ]));

                // minimize
                this.ui.body.addClass('cms-modal-minimized');
                this.ui.modal.css({
                    'left': this.ui.toolbarLeftPart.outerWidth(true) + 50
                });

                this.minimized = true;
            } else {
                // maximize
                this.ui.body.removeClass('cms-modal-minimized');
                this.ui.modal.css(this.ui.modal.data('css'));

                this.minimized = false;
            }
        },

        /**
         * Maximizes the window according to the browser size.
         *
         * @method maximize
         */
        maximize: function maximize() {
            // cancel action when minimized
            if (this.minimized) {
                return false;
            }

            if (this.maximized === false) {
                // save initial state
                this.ui.modal.data('css', this.ui.modal.css([
                    'left', 'top', 'margin-left', 'margin-top',
                    'width', 'height'
                ]));

                this.ui.body.addClass('cms-modal-maximized');

                this.maximized = true;
                this.dispatchEvent('modal-maximized', { instance: this });
            } else {
                // minimize
                this.ui.body.removeClass('cms-modal-maximized');
                this.ui.modal.css(this.ui.modal.data('css'));

                this.maximized = false;
                this.dispatchEvent('modal-restored', { instance: this });
            }
        },

        /**
         * Initiates the start move event from `_events`.
         *
         * @method _startMove
         * @private
         * @param {Object} pointerEvent passes starting event
         */
        _startMove: function _startMove(pointerEvent) {
            // cancel if maximized or minimized
            if (this.maximized || this.minimized) {
                return false;
            }

            var that = this;
            var position = this.ui.modal.position();
            var left;
            var top;

            this.ui.shim.show();

            // create event for stopping
            this.ui.body.on(this.pointerUp, function (e) {
                that._stopMove(e);
            });

            this.ui.body.on(this.pointerMove, function (e) {
                left = position.left - (pointerEvent.originalEvent.pageX - e.originalEvent.pageX);
                top = position.top - (pointerEvent.originalEvent.pageY - e.originalEvent.pageY);

                that.ui.modal.css({
                    'left': left,
                    'top': top
                });
            }).attr('data-touch-action', 'none');
        },

        /**
         * Initiates the stop move event from `_startMove`.
         *
         * @method _stopMove
         * @private
         */
        _stopMove: function _stopMove() {
            this.ui.shim.hide();
            this.ui.body
                .off(this.pointerMove + ' ' + this.pointerUp)
                .removeAttr('data-touch-action');
        },

        /**
         * Initiates the start resize event from `_events`.
         *
         * @method _startResize
         * @private
         * @param {Object} pointerEvent passes starting event
         */
        _startResize: function _startResize(pointerEvent) {
            // cancel if in fullscreen
            if (this.maximized) {
                return false;
            }
            // continue
            var that = this;
            var width = this.ui.modal.width();
            var height = this.ui.modal.height();
            var modalLeft = this.ui.modal.position().left;
            var modalTop = this.ui.modal.position().top;

            // create event for stopping
            this.ui.body.on(this.pointerUp, function (e) {
                that._stopResize(e);
            });

            this.ui.shim.show();

            this.ui.body.on(this.pointerMove, function (e) {
                var mvX = pointerEvent.originalEvent.pageX - e.originalEvent.pageX;
                var mvY = pointerEvent.originalEvent.pageY - e.originalEvent.pageY;
                var w = width - (mvX * 2);
                var h = height - (mvY * 2);
                var wMin = that.options.minWidth;
                var hMin = that.options.minHeight;
                var left = mvX + modalLeft;
                var top = mvY + modalTop;

                // add some limits
                if (w <= wMin) {
                    w = wMin;
                    left = modalLeft + width / 2 - w / 2;
                }
                if (h <= hMin) {
                    h = hMin;
                    top = modalTop + height / 2 - h / 2;
                }

                // set centered animation
                that.ui.modal.css({
                    width: w,
                    height: h,
                    left: left,
                    top: top
                });
            }).attr('data-touch-action', 'none');
        },

        /**
         * Initiates the stop resize event from `_startResize`.
         *
         * @method _stopResize
         * @private
         */
        _stopResize: function _stopResize() {
            this.ui.shim.hide();
            this.ui.body
                .off(this.pointerMove + ' ' + this.pointerUp)
                .removeAttr('data-touch-action');
        },

        /**
         * Sets the breadcrumb inside the modal.
         *
         * @method _setBreadcrumb
         * @private
         * @param {Object[]} breadcrumbs renderes breadcrumb on modal
         */
        _setBreadcrumb: function _setBreadcrumb(breadcrumbs) {
            var crumb = '';
            var template = '<a href="{1}" class="{2}"><span>{3}</span></a>';

            // cancel if there is no breadcrumbs)
            if (!breadcrumbs || breadcrumbs.length <= 1) {
                return false;
            }
            if (!breadcrumbs[0].title) {
                return false;
            }

            // add class to modal
            this.ui.modal.addClass('cms-modal-has-breadcrumb');

            // load breadcrumbs
            $.each(breadcrumbs, function (index, item) {
                // check if the item is the last one
                var last = (index >= breadcrumbs.length - 1) ? 'active' : '';
                // render breadcrumbs
                crumb += template
                    .replace('{1}', item.url)
                    .replace('{2}', last)
                    .replace('{3}', item.title);
            });

            // attach elements
            this.ui.breadcrumb.html(crumb);
        },

        /**
         * Sets the buttons inside the modal.
         *
         * @method _setButtons
         * @private
         * @param {jQuery} iframe loaded iframe element
         */
        _setButtons: function _setButtons(iframe) {
            var djangoSuit = iframe.contents().find('.suit-columns').length > 0;
            var that = this;
            var group = $('<div class="cms-modal-item-buttons"></div>');
            var render = $('<div class="cms-modal-buttons-inner"></div>');
            var cancel = $('<a href="#" class="cms-btn">' + CMS.config.lang.cancel + '</a>');
            var row;
            var tmp;

            // istanbul ignore else
            if (!djangoSuit) {
                row = iframe.contents().find('.submit-row:eq(0)');
            } else {
                row = iframe.contents().find('.save-box:eq(0)');
            }
            var form = iframe.contents().find('form');
            //avoids conflict between the browser's form validation and Django's validation
            form.on('submit', function () {
                // default submit button was clicked
                // meaning, if you have save - it should close the iframe,
                // if you hit save and continue editing it should be default form behaviour
                if (that.hideFrame) {
                    that.ui.modal.find('.cms-modal-frame iframe').hide();
                    // page has been saved, run checkup
                    that.saved = true;
                }
            });
            var buttons = row.find('input, a, button');
            // these are the buttons _inside_ the iframe
            // we need to listen to this click event to support submitting
            // a form by pressing enter inside of a field
            // click is actually triggered by submit
            buttons.on('click', function () {
                if ($(this).hasClass('default')) {
                    that.hideFrame = true;
                }
            });

            // hide all submit-rows
            iframe.contents().find('.submit-row').hide();

            // if there are no given buttons within the submit-row area
            // scan deeper within the form itself
            // istanbul ignore next
            if (!buttons.length) {
                row = iframe.contents().find('body:not(.change-list) #content form:eq(0)');
                buttons = row.find('input[type="submit"], button[type="submit"]');
                buttons.addClass('deletelink').hide();
            }

            // loop over input buttons
            buttons.each(function (index, item) {
                item = $(item);
                item.attr('data-rel', '_' + index);

                // cancel if item is a hidden input
                if (item.attr('type') === 'hidden') {
                    return false;
                }

                var title = item.attr('value') || item.text();
                var cls = 'cms-btn';

                if (item.is('button')) {
                    title = item.text();
                }

                // set additional special css classes
                if (item.hasClass('default')) {
                    cls = 'cms-btn cms-btn-action';
                }
                if (item.hasClass('deletelink')) {
                    cls = 'cms-btn cms-btn-caution';
                }

                var el = $('<a href="#" class="' + cls + ' ' + item.attr('class') + '">' + title + '</a>');

                el.on(that.click + ' ' + that.touchEnd, function (e) {
                    e.preventDefault();

                    if (item.is('a')) {
                        that._loadIframe({
                            url: item.prop('href'),
                            name: title
                        });
                    }

                    // trigger only when blue action buttons are triggered
                    if (item.hasClass('default') || item.hasClass('deletelink')) {
                        if (!item.hasClass('default')) { // hide iframe when using buttons other than submit
                            that.ui.modal.find('.cms-modal-frame iframe').hide();
                            // page has been saved or deleted, run checkup
                            that.saved = true;
                        } else { // submit button uses the form's submit event
                            that.hideFrame = true;
                        }
                    }

                    if (item.is('input') || item.is('button')) {
                        // we need to use native `.click()` event specifically
                        // as we are inside an iframe and magic is happening
                        item[0].click();
                    }

                });
                el.wrap(group);

                // append element
                render.append(el.parent());
            });

            // manually add cancel button at the end
            cancel.on(that.click, function (e) {
                e.preventDefault();
                that.options.onClose = false;
                that.close();
            });
            cancel.wrap(group);
            render.append(cancel.parent());

            // prepare groups
            render.find('.cms-btn-group').unwrap();
            tmp = render.find('.cms-btn-group').clone(true, true);
            render.find('.cms-btn-group').remove();
            render.append(tmp.wrapAll(group.clone().addClass('cms-modal-item-buttons-left')).parent());

            // render buttons
            this.ui.modalButtons.html(render);
        },

        /**
         * Version where the modal loads an iframe.
         *
         * @method _loadIframe
         * @private
         * @param {Object} opts
         * @param {String} opts.url url to render iframe, takes presedence over opts.html
         * @param {Object[]} [opts.breadcrumbs] collection of breadcrumb items
         * @param {String} [opts.title] modal window main title (bold)
         */
        _loadIframe: function _loadIframe(opts) {
            var that = this;

            opts.url = this.makeURL(opts.url);
            opts.title = opts.title || '';
            opts.breadcrumbs = opts.breadcrumbs || '';

            // show loader
            CMS.API.Toolbar.showLoader();

            // set classes
            this.ui.modal.removeClass('cms-modal-markup');
            this.ui.modal.addClass('cms-modal-iframe');

            // we need to render the breadcrumb
            this._setBreadcrumb(opts.breadcrumbs);

            // now refresh the content
            var holder = this.ui.frame;
            var iframe = $('<iframe src="' + opts.url + '" class="" frameborder="0" />');

            // set correct title
            var titlePrefix = this.ui.titlePrefix;
            var titleSuffix = this.ui.titleSuffix;

            iframe.css('visibility', 'hidden');
            titlePrefix.text(opts.title || '');
            titleSuffix.text('');

            // ensure previous iframe is hidden
            holder.find('iframe').css('visibility', 'hidden');
            that.ui.modalBody.addClass('cms-loader');

            // attach load event for iframe to prevent flicker effects
            iframe.on('load', function () {
                var messages;
                var messageList;
                var contents;
                var body;
                var innerTitle;
                var bc;

                // check if iframe can be accessed
                try {
                    iframe.contents();
                } catch (error) {
                    CMS.API.Messages.open({
                        message: '<strong>' + error + '</strong>',
                        error: true
                    });
                    that.close();
                    return;
                }

                CMS.Modal._setupCtrlEnterSave(document);
                // istanbul ignore else
                if (iframe[0].contentWindow && iframe[0].contentWindow.document) {
                    CMS.Modal._setupCtrlEnterSave(iframe[0].contentWindow.document);
                }
                // for ckeditor we need to go deeper
                // istanbul ignore next
                if (iframe[0].contentWindow && iframe[0].contentWindow.CMS && iframe[0].contentWindow.CMS.CKEditor) {
                    $(iframe[0].contentWindow.document).ready(function () {
                        // setTimeout is required to battle CKEditor initialisation
                        setTimeout(function () {
                            var editor = iframe[0].contentWindow.CMS.CKEditor.editor;
                            if (editor) {
                                editor.on('loaded', function (e) {
                                    CMS.Modal._setupCtrlEnterSave(
                                        $(e.editor.container.$).find('iframe')[0].contentWindow.document
                                    );
                                });
                            }
                        }, 100);
                    });
                }

                // hide loader
                CMS.API.Toolbar.hideLoader();

                // show messages in toolbar if provided
                messageList = iframe.contents().find('.messagelist');
                messages = messageList.find('li');
                if (messages.length) {
                    CMS.API.Messages.open({
                        message: messages.eq(0).text()
                    });
                }
                messageList.remove();
                contents = iframe.contents();
                body = contents.find('body');

                // inject css class
                body.addClass('cms-admin cms-admin-modal');

                // determine if we should close the modal or reload
                if (messages.length && that.enforceReload) {
                    that.reloadBrowser();
                }
                if (messages.length && that.enforceClose) {
                    that.close();
                    return false;
                }

                // adding django hacks
                contents.find('.viewsitelink').attr('target', '_top');

                // set modal buttons
                that._setButtons($(this));

                // when an error occurs, reset the saved status so the form can be checked and validated again
                if (iframe.contents().find('.errornote').length || iframe.contents().find('.errorlist').length) {
                    that.saved = false;
                }

                // when the window has been changed pressing the blue or red button, we need to run a reload check
                // also check that no delete-confirmation is required
                if (that.saved && !contents.find('.delete-confirmation').length) {
                    that.reloadBrowser(
                        that.options.onClose ? that.options.onClose : window.location.href,
                        false,
                        true
                    );
                } else {
                    iframe.show();
                    // set title of not provided
                    innerTitle = iframe.contents().find('#content h1:eq(0)');

                    // case when there is no prefix
                    // istanbul ignore next: never happens
                    if (opts.title === undefined && that.ui.titlePrefix.text() === '') {
                        bc = iframe.contents().find('.breadcrumbs').contents();
                        that.ui.titlePrefix.text(bc.eq(bc.length - 1).text().replace('›', '').trim());
                    }

                    if (titlePrefix.text().trim() === '') {
                        titlePrefix.text(innerTitle.text());
                    } else {
                        titleSuffix.text(innerTitle.text());
                    }
                    innerTitle.remove();

                    // than show
                    iframe.css('visibility', 'visible');

                    // append ready state
                    iframe.data('ready', true);

                    // attach close event
                    body.on('keydown.cms', function (e) {
                        if (e.keyCode === CMS.KEYS.ESC) {
                            that.close();
                        }
                    });

                    // figure out if .object-tools is available
                    if (contents.find('.object-tools').length) {
                        contents.find('#content').css('padding-top', 38);
                    }
                }
            });

            // inject
            holder.html(iframe);
        },

        /**
         * Version where the modal loads an url within an iframe.
         *
         * @method _changeIframe
         * @private
         * @param {jQuery} el originated element
         */
        _changeIframe: function _changeIframe(el) {
            if (el.hasClass('active')) {
                return false;
            }

            var parents = el.parent().find('a');
            parents.removeClass('active');

            el.addClass('active');

            this._loadIframe({
                url: el.attr('href')
            });

            this.ui.titlePrefix.text(el.text());
        },

        /**
         * Version where the modal loads html markup.
         *
         * @method _loadMarkup
         * @private
         * @param {Object} opts
         * @param {String|HTMLNode|jQuery} opts.html html markup to render
         * @param {String} opts.title modal window main title (bold)
         * @param {String} [opts.subtitle] modal window secondary title (normal)
         */
        _loadMarkup: function _loadMarkup(opts) {
            this.ui.modal.removeClass('cms-modal-iframe');
            this.ui.modal.addClass('cms-modal-markup');
            this.ui.modalBody.removeClass('cms-loader');

            // set content
            // empty to remove events, append to keep events
            this.ui.frame.empty().append(opts.html);
            this.ui.titlePrefix.text(opts.title || '');
            this.ui.titleSuffix.text(opts.subtitle || '');
        },

        /**
         * _deletePlugin removes a plugin once created when clicking
         * on delete or the close item. If we don't do this, an empty
         * plugin is generated
         * https://github.com/divio/django-cms/pull/4381 will eventually
         * provide a better solution
         *
         * @method _deletePlugin
         * @private
         * @param {Object} [opts] general objects element that holds settings
         * @param {Boolean} [opts.hideAfter] hides the modal after the ajax requests succeeds
         */
        _deletePlugin: function _deletePlugin(opts) {
            var that = this;
            var data = CMS._newPlugin;
            var post = '{ "csrfmiddlewaretoken": "' + CMS.config.csrf + '" }';
            var text = CMS.config.lang.confirmEmpty.replace(
                '{1}', CMS._newPlugin.breadcrumb[CMS._newPlugin.breadcrumb.length - 1].title
            );

            // trigger an ajax request
            return CMS.API.Toolbar.openAjax({
                url: data['delete'],
                post: post,
                text: text,
                callback: function () {
                    CMS._newPlugin = false;
                    if (opts && opts.hideAfter) {
                        that._hide({
                            duration: 100
                        });
                    }
                }
            });
        }
    });

    /**
     * Sets up keyup/keydown listeners so you're able to save whatever you're
     * editing inside of an iframe by pressing `ctrl + enter` on windows and `cmd + enter` on mac.
     *
     * It only works with default button (e.g. action), not the `delete` button,
     * even though sometimes it's the only actionable button in the modal.
     *
     * @method _setupCtrlEnterSave
     * @private
     * @static
     * @param {HTMLElement} document document element (iframe or parent window);
     */
    CMS.Modal._setupCtrlEnterSave = function _setupCtrlEnterSave(doc) {
        var cmdPressed = false;
        var mac = (navigator.platform.toLowerCase().indexOf('mac') + 1);

        $(doc).on('keydown.cms.submit', function (e) {
            if (e.ctrlKey && e.keyCode === CMS.KEYS.ENTER && !mac) {
                $('.cms-modal-buttons .cms-btn-action:first').trigger('click');
            }

            if (mac) {
                if (e.keyCode === CMS.KEYS.CMD_LEFT ||
                    e.keyCode === CMS.KEYS.CMD_RIGHT ||
                    e.keyCode === CMS.KEYS.CMD_FIREFOX) {
                    cmdPressed = true;
                }

                if (e.keyCode === CMS.KEYS.ENTER && cmdPressed) {
                    $('.cms-modal-buttons .cms-btn-action:first').trigger('click');
                }
            }
        }).on('keyup.cms.submit', function (e) {
            if (mac) {
                if (e.keyCode === CMS.KEYS.CMD_LEFT || e.keyCode === CMS.KEYS.CMD_RIGHT) {
                    cmdPressed = false;
                }
            }
        });

    };

})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

// #############################################################################
// SIDEFRAME
(function ($) {
    'use strict';

    /**
     * The sideframe is triggered via API calls from the backend either
     * through the toolbar navigation or from plugins. The APIs only allow to
     * open a url within the sideframe.
     *
     * @class Sideframe
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.Sideframe = new CMS.Class({

        implement: [CMS.API.Helpers],

        options: {
            onClose: false,
            sideframeDuration: 300,
            sideframeWidth: 0.8 // matches 80% of window width
        },

        initialize: function initialize(options) {
            this.options = $.extend(true, {}, this.options, options);

            // elements
            this._setupUI();

            // states and events
            this.click = 'click.cms.sideframe';
            this.pointerDown = 'pointerdown.cms.sideframe contextmenu.cms.sideframe';
            this.pointerUp = 'pointerup.cms.sideframe pointercancel.cms.sideframe';
            this.pointerMove = 'pointermove.cms.sideframe';
            this.enforceReload = false;
            this.settingsRefreshTimer = 600;
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var sideframe = $('.cms-sideframe');
            this.ui = {
                sideframe: sideframe,
                body: $('html'),
                window: $(window),
                dimmer: sideframe.find('.cms-sideframe-dimmer'),
                close: sideframe.find('.cms-sideframe-close'),
                resize: sideframe.find('.cms-sideframe-resize'),
                frame: sideframe.find('.cms-sideframe-frame'),
                shim: sideframe.find('.cms-sideframe-shim'),
                historyBack: sideframe.find('.cms-sideframe-history .cms-icon-arrow-back'),
                historyForward: sideframe.find('.cms-sideframe-history .cms-icon-arrow-forward')
            };
        },

        /**
         * Sets up all the event handlers, such as closing and resizing.
         *
         * @method _events
         * @private
         */
        _events: function _events() {
            var that = this;

            // we need to set the history state on event creation
            // to ensure we start with clean states in new instances
            this.history = {
                back: [],
                forward: []
            };

            this.ui.close.off(this.click).on(this.click, function () {
                that.close();
            });

            // the resize event attaches an off event to the body
            // which is handled within _startResize()
            this.ui.resize.off(this.pointerDown).on(this.pointerDown, function (e) {
                e.preventDefault();
                that._startResize();
            });

            // close sideframe when clicking on the dimmer
            this.ui.dimmer.off(this.click).on(this.click, function () {
                that.close();
            });

            // attach events to the back button
            this.ui.historyBack.off(this.click).on(this.click, function () {
                if (that.ui.historyBack.hasClass('cms-icon-disabled')) {
                    return false;
                }
                that._goToHistory('back');
            });

            // attach events to the forward button
            this.ui.historyForward.off(this.click).on(this.click, function () {
                if (that.ui.historyForward.hasClass('cms-icon-disabled')) {
                    return false;
                }
                that._goToHistory('forward');
            });
        },

        /**
         * Opens a given url within a sideframe.
         *
         * @method open
         * @chainable
         * @param {Object} opts
         * @param {String} opts.url url to render iframe
         * @param {Boolean} [opts.animate] should sideframe be animated
         */
        open: function open(opts) {
            if (!(opts && opts.url)) {
                throw new Error('The arguments passed to "open" were invalid.');
            }

            var url = opts.url;
            var animate = opts.animate;

            // setup internals
            var language = 'language=' + CMS.config.request.language;
            var page_id = 'page_id=' + CMS.config.request.page_id;
            var params = [];
            var width = window.innerWidth;
            var currentWidth = this.ui.sideframe.outerWidth();
            var isFrameVisible = this.ui.sideframe.is(':visible');

            // set the ratio for bigger devices than mobile
            if (this.ui.body.width() >= CMS.BREAKPOINTS.mobile) {
                width = CMS.settings.sideframe.position ||
                    (this.options.sideframeWidth * 100 + '%');
            }

            // We have to rebind events every time we open a sideframe
            // because the event handlers contain references to the instance
            // and since we reuse the same markup we need to update
            // that instance reference every time.
            this._events();

            // show dimmer even before iframe is loaded
            this.ui.dimmer.show();
            this.ui.frame.addClass('cms-loader');

            // show loader
            if (CMS.API && CMS.API.Toolbar) {
                CMS.API.Toolbar.showLoader();
            }

            // we need to modify the url appropriately to pass
            // language and page to the params
            if (url.indexOf(CMS.config.request.tree) >= 0) {
                if (CMS.config.request.language) {
                    params.push(language);
                }
                if (CMS.config.request.page_id) {
                    params.push(page_id);
                }
            }

            url = this.makeURL(url, params);

            // load the iframe
            this._content(url);

            // cancel animation if sideframe is already shown
            if (isFrameVisible && currentWidth < width) {
                // The user has performed an action that requires the
                // sideframe to be shown, this intent outweighs any
                // previous intent to minimize the frame.
                CMS.settings.sideframe.hidden = false;
            }

            if (isFrameVisible && Math.round(currentWidth) === Math.round(width)) {
                // Math.round because subpixel values
                animate = false;
            }

            // show iframe
            this._show(width, animate);

            return this;
        },

        /**
         * Handles content replacement mechanisms.
         *
         * @method _content
         * @private
         * @param {String} url valid uri to pass on the iframe
         */
        _content: function _content(url) {
            var that = this;
            var iframe = $('<iframe src="' + url + '" class="" frameborder="0" />');
            var holder = this.ui.frame;
            var contents;
            var body;
            var iOS = /iPhone|iPod|iPad/.test(navigator.userAgent);

            /**
             * On iOS iframes do not respect the size set in css or attributes, and
             * is always matching the content. However, if you first load the page
             * with one amount of content (small) and then from there you'd go to a page
             * with lots of content (long, scroll requred) it won't be scrollable, because
             * iframe would retain the size of previous page. When this happens we
             * need to rerender the iframe (that's why we are animating the width here, so far
             * that was the only reliable way). But after that if you try to scroll the iframe
             * which height was just adjusted it will hide completely from the screen
             * (this is an iOS glitch, the content would still be there and in fact it would
             * be usable, but just not visible). To get rid of that we bring up the shim element
             * up and down again and this fixes the glitch. (same shim we use for resizing the sideframe)
             *
             * It is not recommended to expose it and use it on other devices rather than iOS ones.
             *
             * @function forceRerenderOnIOS
             * @private
             */
            function forceRerenderOnIOS() {
                var w = that.ui.sideframe.width();
                that.ui.sideframe.animate({ 'width': w + 1 }, 0);
                setTimeout(function () {
                    that.ui.sideframe.animate({ 'width': w }, 0);
                    that.ui.shim.css('z-index', 20);
                    setTimeout(function () {
                        that.ui.shim.css('z-index', 1);
                    }, 0);
                }, 0);
            }

            // attach load event to iframe
            iframe.hide().on('load', function () {
                // check if iframe can be accessed
                try {
                    iframe.contents();
                } catch (error) {
                    CMS.API.Messages.open({
                        message: '<strong>' + error + '</strong>',
                        error: true
                    });
                    that.close();
                    return;
                }

                contents = iframe.contents();
                body = contents.find('body');

                // inject css class
                body.addClass('cms-admin cms-admin-sideframe');

                // remove loader
                that.ui.frame.removeClass('cms-loader');
                // than show
                iframe.show();

                // force style recalculation on iOS
                if (iOS) {
                    forceRerenderOnIOS();
                }

                // add debug infos
                if (CMS.config.debug) {
                    body.addClass('cms-debug');
                }

                // save url in settings
                CMS.settings.sideframe.url = iframe[0].contentWindow.location.href;
                CMS.settings = that.setSettings(CMS.settings);

                // This essentially hides the toolbar dropdown when
                // click happens inside of a sideframe iframe
                body.on(that.click, function () {
                    $(document).trigger(that.click);
                });

                // attach close event
                body.on('keydown.cms', function (e) {
                    if (e.keyCode === CMS.KEYS.ESC) {
                        that.close();
                    }
                });

                // adding django hacks
                contents.find('.viewsitelink').attr('target', '_top');

                // update history
                that._addToHistory(this.contentWindow.location.href);
            });

            // clear the frame (removes all the handlers)
            holder.empty();
            // inject iframe
            holder.html(iframe);
        },

        /**
         * Animation helper for opening the sideframe.
         *
         * @method _show
         * @private
         * @param {Number} width width that the iframes opens to
         * @param {Number} [animate] Animation duration
         */
        _show: function _show(width, animate) {
            var that = this;

            this.ui.sideframe.show();

            // check if sideframe should be hidden
            if (CMS.settings.sideframe.hidden) {
                this._hide();
            }

            // otherwise do normal behaviour
            if (animate) {
                this.ui.sideframe.animate({
                    width: width,
                    overflow: 'visible'
                }, this.options.sideframeDuration);
            } else {
                this.ui.sideframe.css('width', width);
                // reset width if larger than available space
                if (width >= this.ui.window.width()) {
                    this.ui.sideframe.css({
                        width: this.ui.window.width() - 30,
                        overflow: 'visible'
                    });
                }
            }

            // trigger API handlers
            if (CMS.API && CMS.API.Toolbar) {
                // FIXME: initialization needs to be done after our libs are loaded
                CMS.API.Toolbar.open();
                CMS.API.Toolbar.hideLoader();
                CMS.API.Toolbar._lock(true);
            }

            // add esc close event
            this.ui.body.off('keydown.cms.close').on('keydown.cms.close', function (e) {
                if (e.keyCode === CMS.KEYS.ESC) {
                    that.options.onClose = null;
                    that.close();
                }
            });

            // disable scrolling for touch
            this.ui.body.addClass('cms-prevent-scrolling');
            this.preventTouchScrolling($(document), 'sideframe');
        },

        /**
         * Closes the current instance.
         *
         * @method close
         */
        close: function close() {
            // hide dimmer immediately
            this.ui.dimmer.hide();

            // update settings
            CMS.settings.sideframe = {
                url: null,
                hidden: false,
                width: this.options.sideframeWidth
            };
            CMS.settings = this.setSettings(CMS.settings);

            // check for reloading
            this.reloadBrowser(this.options.onClose, false, true);

            // trigger hide animation
            this._hide({
                duration: this.options.sideframeDuration / 2
            });
        },

        /**
         * Animation helper for closing the iframe.
         *
         * @method _hide
         * @private
         * @param {Object} [opts]
         * @param {Number} [opts.duration=this.options.sideframeDuration] animation duration
         */
        _hide: function _hide(opts) {
            var duration = this.options.sideframeDuration;
            if (opts && typeof opts.duration === 'number') {
                duration = opts.duration;
            }

            this.ui.sideframe.animate({ width: 0 }, duration, function () {
                $(this).hide();
            });
            this.ui.frame.removeClass('cms-loader');

            if (CMS.API && CMS.API.Toolbar) {
                CMS.API.Toolbar._lock(false);
            }

            this.ui.body.off('keydown.cms.close');

            // enable scrolling again
            this.ui.body.removeClass('cms-prevent-scrolling');
            this.allowTouchScrolling($(document), 'sideframe');
        },

        /**
         * Initiates the start resize event from `_events`.
         *
         * @method _startResize
         * @private
         */
        _startResize: function _startResize() {
            var that = this;
            var outerOffset = 30;
            var timer = function () {};

            // create event for stopping
            this.ui.body.on(this.pointerUp, function (e) {
                e.preventDefault();
                that._stopResize();
            });

            // this prevents the iframe from being focusable
            this.ui.shim.css('z-index', 20);

            this.ui.body.attr('data-touch-action', 'none').on(this.pointerMove, function (e) {
                if (e.originalEvent.clientX <= 320) {
                    e.originalEvent.clientX = 320;
                }
                if (e.originalEvent.clientX >= that.ui.window.width() - outerOffset) {
                    e.originalEvent.clientX = that.ui.window.width() - outerOffset;
                }

                that.ui.sideframe.css('width', e.originalEvent.clientX);

                // update settings
                CMS.settings.sideframe.position = e.originalEvent.clientX;

                // save position into our settings
                clearTimeout(timer);
                timer = setTimeout(function () {
                    CMS.settings = that.setSettings(CMS.settings);
                }, that.settingsRefreshTimer);
            });
        },

        /**
         * Initiates the stop resize event from `_startResize`.
         *
         * @method _stopResize
         * @private
         */
        _stopResize: function _stopResize() {
            this.ui.shim.css('z-index', 1);
            this.ui.body
                .off(this.pointerUp)
                .off(this.pointerMove)
                .removeAttr('data-touch-action');
        },

        /**
         * Retrieves the history states from `this.history`.
         *
         * @method _goToHistory
         * @private
         * @param {String} type can be either `back` or `forward`
         */
        _goToHistory: function _goToHistory(type) {
            var iframe = this.ui.frame.find('iframe');
            var tmp;

            if (type === 'back') {
                // remove latest entry (which is the current site)
                this.history.forward.push(this.history.back.pop());
                iframe.attr('src', this.history.back[this.history.back.length - 1]);
            }

            if (type === 'forward') {
                tmp = this.history.forward.pop();
                this.history.back.push(tmp);
                iframe.attr('src', tmp);
            }

            this._updateHistoryButtons();
        },

        /**
         * Stores the history states in `this.history`.
         *
         * @method _addToHistory
         * @private
         * @param {String} url url to be stored in `this.history.back`
         */
        _addToHistory: function _addToHistory(url) {
            var iframe = this.ui.frame.find('iframe');

            // we need to update history first
            this.history.back.push(url);
            // and than set local variables
            var length = this.history.back.length;

            // store current url if array is empty
            if (this.history.back.length <= 0) {
                this.history.back.push(iframe.attr('src'));
            }

            // check for duplicates
            if (this.history.back[length - 1] === this.history.back[length - 2]) {
                this.history.back.pop();
            }

            this._updateHistoryButtons();
        },

        /**
         * Sets the correct states for the history UI elements.
         *
         * @method _updateHistoryButtons
         * @private
         */
        _updateHistoryButtons: function _updateHistoryButtons() {
            if (this.history.back.length > 1) {
                this.ui.historyBack.removeClass('cms-icon-disabled');
            } else {
                this.ui.historyBack.addClass('cms-icon-disabled');
            }

            if (this.history.forward.length >= 1) {
                this.ui.historyForward.removeClass('cms-icon-disabled');
            } else {
                this.ui.historyForward.addClass('cms-icon-disabled');
            }
        }
    });
})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

// #############################################################################
// Clipboard
(function ($) {
    'use strict';

    /**
     * Handles copy & paste in the structureboard.
     *
     * @class Clipboard
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.Clipboard = new CMS.Class({

        implement: [CMS.API.Helpers],

        initialize: function () {
            this._setupUI();

            // states
            this.click = 'click.cms.clipboard';

            // setup events
            this._events();
        },

        /**
         * Caches all the jQuery element queries.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var clipboard = $('.cms-clipboard');
            this.ui = {
                clipboard: clipboard,
                triggers: $('.cms-clipboard-trigger a'),
                triggerRemove: $('.cms-clipboard-empty a'),
                pluginsList: clipboard.find('.cms-clipboard-containers'),
                document: $(document)
            };
        },

        /**
         * Sets up event handlers for clipboard ui.
         *
         * @method _events
         * @private
         */
        _events: function () {
            var that = this;

            var MIN_WIDTH = 400;
            // FIXME kind of a magic number for 1 item in clipboard
            var MIN_HEIGHT = 117;

            that.modal = new CMS.Modal({
                minWidth: MIN_WIDTH,
                minHeight: MIN_HEIGHT,
                minimizable: false,
                maximizable: false,
                resizable: false
            });

            that.modal.on('cms.modal.loaded cms.modal.closed', function removePlaceholder() {
                // cannot be cached
                $('.cms-add-plugin-placeholder').remove();
            }).on('cms.modal.closed cms.modal.load', function () {
                that.ui.pluginsList.prependTo(that.ui.clipboard);
            }).ui.modal.on('cms.modal.load', function () {
                that.ui.pluginsList.prependTo(that.ui.clipboard);
            });

            that.ui.triggers.on(that.click, function (e) {
                e.preventDefault();
                e.stopPropagation();
                if ($(this).parent().hasClass('cms-toolbar-item-navigation-disabled')) {
                    return false;
                }

                that.modal.open({
                    html: that.ui.pluginsList,
                    title: that.ui.clipboard.data('title'),
                    width: MIN_WIDTH,
                    height: MIN_HEIGHT
                });
                that.ui.document.trigger('click.cms.toolbar');
            });

            // add remove event
            that.ui.triggerRemove.on(that.click, function (e) {
                e.preventDefault();
                e.stopPropagation();
                if ($(this).parent().hasClass('cms-toolbar-item-navigation-disabled')) {
                    return false;
                }
                that.clear(function () {
                    // remove element on success
                    that.modal.close();
                    that.ui.triggers.parent().addClass('cms-toolbar-item-navigation-disabled');
                    that.ui.triggerRemove.parent().addClass('cms-toolbar-item-navigation-disabled');
                    that.ui.document.trigger('click.cms.toolbar');
                });
            });
        },

        /**
         * Clears the clipboard by quering the server.
         * Callback is optional, but if provided - it's called
         * no matter what outcome was of the ajax call.
         *
         * @method clear
         * @param {Function} [callback]
         */
        clear: function (callback) {
            // post needs to be a string, it will be converted using JSON.parse
            var post = '{ "csrfmiddlewaretoken": "' + CMS.config.csrf + '" }';
            var pasteItems = $('.cms-submenu-item [data-rel=paste]').parent().
                addClass('cms-submenu-item-disabled');
            pasteItems.find('.cms-submenu-item-paste-tooltip').css('display', 'none');
            pasteItems.find('.cms-submenu-item-paste-tooltip-empty').css('display', 'block');

            // redirect to ajax
            CMS.API.Toolbar.openAjax({
                url: CMS.config.clipboard.url,
                post: post,
                callback: callback
            });
        }

    });
})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
var CMS = window.CMS || {};

// #############################################################################
// Plugin
(function ($) {
    'use strict';

    var doc;
    var clipboard;
    var clipboardDraggable;
    var clipboardPlugin;

    /**
     * Class for handling Plugins / Placeholders or Generics.
     * Handles adding / moving / copying / pasting / menus etc
     * in structureboard.
     *
     * @class Plugin
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.Plugin = new CMS.Class({

        implement: [CMS.API.Helpers],

        options: {
            type: '', // bar, plugin or generic
            placeholder_id: null,
            plugin_type: '',
            plugin_id: null,
            plugin_language: '',
            plugin_parent: null,
            plugin_order: null,
            plugin_breadcrumb: [],
            plugin_restriction: [],
            plugin_parent_restriction: [],
            urls: {
                add_plugin: '',
                edit_plugin: '',
                move_plugin: '',
                copy_plugin: '',
                delete_plugin: ''
            }
        },

        initialize: function initialize(container, options) {
            this.options = $.extend(true, {}, this.options, options);

            this._setupUI(container);

            // states
            this.csrf = CMS.config.csrf;
            this.click = 'click.cms.plugin';
            this.pointerUp = 'pointerup.cms.plugin';
            this.pointerDown = 'pointerdown.cms.plugin';
            this.pointerOverAndOut = 'pointerover.cms.plugin pointerout.cms.plugin';
            this.doubleClick = 'dblclick.cms.plugin';
            this.keyUp = 'keyup.cms.plugin';
            this.keyDown = 'keydown.cms.plugin';
            this.mouseEvents = 'mousedown.cms.plugin mousemove.cms.plugin mouseup.cms.plugin';
            this.touchStart = 'touchstart.cms.plugin';
            this.touchEnd = 'touchend.cms.plugin';

            // bind data element to the container
            this.ui.container.data('settings', this.options);

            // determine type of plugin
            switch (this.options.type) {
                case 'placeholder': // handler for placeholder bars
                    this._setPlaceholder();
                    this._collapsables();
                    break;
                case 'plugin': // handler for all plugins
                    this._setPlugin();
                    this._collapsables();
                    break;
                default: // handler for static content
                    this._setGeneric();
            }
        },

        /**
         * Caches some jQuery references and sets up structure for
         * further initialisation.
         *
         * @method _setupUI
         * @private
         * @param {String} container `cms-plugin-${id}`
         */
        _setupUI: function setupUI(container) {
            container = $('.' + container);
            this.ui = {
                container: container,
                publish: $('.cms-btn-publish'),
                save: $('.cms-toolbar-item-switch-save-edit'),
                window: $(window),
                revert: $('.cms-toolbar-revert'),
                dragbar: null,
                draggable: null,
                draggables: null,
                submenu: null,
                dropdown: null
            };
        },

        /**
         * Sets up behaviours and ui for placeholder.
         *
         * @method _setPlaceholder
         * @private
         */
        _setPlaceholder: function () {
            var that = this;
            this.ui.dragbar = $('.cms-dragbar-' + this.options.placeholder_id);
            this.ui.draggables = this.ui.dragbar.closest('.cms-dragarea').find('> .cms-draggables');
            this.ui.submenu = this.ui.dragbar.find('.cms-submenu-settings');
            var title = this.ui.dragbar.find('.cms-dragbar-title');
            var togglerLinks = this.ui.dragbar.find('.cms-dragbar-toggler a');
            var expanded = 'cms-dragbar-title-expanded';

            // register the subnav on the placeholder
            this._setSettingsMenu(this.ui.submenu);
            this._setAddPluginModal(this.ui.dragbar.find('.cms-submenu-add'));

            CMS.settings.dragbars = CMS.settings.dragbars || []; // expanded dragbars array

            // enable expanding/collapsing globally within the placeholder
            togglerLinks.off(this.click).on(this.click, function (e) {
                e.preventDefault();
                if (title.hasClass(expanded)) {
                    that._collapseAll(title);
                } else {
                    that._expandAll(title);
                }
            });

            if ($.inArray(this.options.placeholder_id, CMS.settings.dragbars) !== -1) {
                title.addClass(expanded);
            }

            this._checkIfPasteAllowed();
        },

        /**
         * Sets up behaviours and ui for plugin.
         *
         * @method _setPlugin
         * @private
         */
        _setPlugin: function () {
            var that = this;

            // adds double click to edit
            this.ui.container.add(this.ui.dragitem).on(this.doubleClick, function (e) {
                e.preventDefault();
                e.stopPropagation();

                that.editPlugin(
                    that.options.urls.edit_plugin,
                    that.options.plugin_name,
                    that.options.plugin_breadcrumb
                );
            });

            // adds edit tooltip
            this.ui.container.on(this.pointerOverAndOut + ' ' + this.touchStart, function (e) {
                // required for both, click and touch
                // otherwise propagation won't work to the nested plugin
                e.stopPropagation();
                if (e.type === 'touchstart') {
                    CMS.API.Tooltip._forceTouchOnce();
                }
                var name = that.options.plugin_name;
                var id = that.options.plugin_id;

                var placeholderId = that._getId(that.ui.dragitem.closest('.cms-dragarea'));
                var placeholder = $('.cms-placeholder-' + placeholderId);

                if (placeholder.length && placeholder.data('settings')) {
                    name = placeholder.data('settings').name + ': ' + name;
                }

                CMS.API.Tooltip.displayToggle(e.type === 'pointerover' || e.type === 'touchstart', e, name, id);
            });

            // adds listener for all plugin updates
            this.ui.container.on('cms.plugins.update', function (e) {
                e.stopPropagation();
                that.movePlugin();
            });

            // adds listener for copy/paste updates
            this.ui.container.on('cms.plugin.update', function (e) {
                e.stopPropagation();

                var el = $(e.delegateTarget);
                var dragitem = $('.cms-draggable-' + el.data('settings').plugin_id);
                var placeholder_id = that._getId(
                    dragitem.parents('.cms-draggables').last().prevAll('.cms-dragbar').first()
                );

                // if placeholder_id is empty, cancel
                if (!placeholder_id) {
                    return false;
                }

                var data = el.data('settings');
                data.target = placeholder_id;
                data.parent = that._getId(dragitem.parent().closest('.cms-draggable'));
                data.move_a_copy = true;

                that.movePlugin(data);
            });

            // filling up ui object
            this.ui.draggable = $('.cms-draggable-' + this.options.plugin_id);
            this.ui.dragitem = this.ui.draggable.find('> .cms-dragitem');
            this.ui.draggables = this.ui.draggable.find('> .cms-draggables');
            this.ui.submenu = this.ui.dragitem.find('.cms-submenu');

            // attach event to the plugin menu
            this._setSettingsMenu(this.ui.submenu);

            // attach events for the "Add plugin" modal
            this._setAddPluginModal(this.ui.dragitem.find('.cms-submenu-add'));

            // clickability of "Paste" menu item
            this._checkIfPasteAllowed();
        },

        /**
         * Sets up behaviours and ui for generics.
         * Generics do not show up in structure board.
         *
         * @method _setGeneric
         * @private
         */
        _setGeneric: function () {
            var that = this;

            // adds double click to edit
            this.ui.container.on(this.doubleClick, function (e) {
                e.preventDefault();
                e.stopPropagation();
                that.editPlugin(that.options.urls.edit_plugin, that.options.plugin_name, []);
            });

            // adds edit tooltip
            this.ui.container.on(this.pointerOverAndOut + ' ' + this.touchStart, function (e) {
                if (e.type !== 'touchstart') {
                    e.stopPropagation();
                }
                var name = that.options.plugin_name;
                var id = that.options.plugin_id;
                CMS.API.Tooltip.displayToggle(e.type === 'pointerover' || e.type === 'touchstart', e, name, id);
            });
        },

        /**
         * Checks if paste is allowed into current plugin/placeholder based
         * on restrictions we have. Also determines which tooltip to show.
         *
         * WARNING: this relies on clipboard plugins always being instantiated
         * first, so they have data('settings') by the time this method is called.
         *
         * @method _checkIfPasteAllowed
         * @private
         * @return {Boolean}
         */
        _checkIfPasteAllowed: function _checkIfPasteAllowed() {
            var pasteButton = this.ui.dropdown.find('[data-rel=paste]');
            var pasteItem = pasteButton.parent();
            if (!clipboardPlugin.length) {
                pasteItem.addClass('cms-submenu-item-disabled');
                pasteItem.find('.cms-submenu-item-paste-tooltip-empty').css('display', 'block');
                return false;
            }

            if (this.ui.draggable && this.ui.draggable.hasClass('cms-draggable-disabled')) {
                pasteItem.addClass('cms-submenu-item-disabled');
                pasteItem.find('.cms-submenu-item-paste-tooltip-disabled').css('display', 'block');
                return false;
            }

            var bounds = this.options.plugin_restriction;
            var type = clipboardPlugin.data('settings').plugin_type;
            var parent_bounds = $.grep(clipboardPlugin.data('settings').plugin_parent_restriction, function (r) {
                // special case when PlaceholderPlugin has a parent restriction named "0"
                return r !== '0';
            });
            var currentPluginType = this.options.plugin_type;

            if ((bounds.length && $.inArray(type, bounds) === -1) ||
                (parent_bounds.length && $.inArray(currentPluginType, parent_bounds) === -1)) {
                pasteItem.addClass('cms-submenu-item-disabled');
                pasteItem.find('.cms-submenu-item-paste-tooltip-restricted').css('display', 'block');
                return false;
            }

            return true;
        },

        /**
         * Calls api to create a plugin and then proceeds to edit it.
         *
         * @method addPlugin
         * @param {String} type type of the plugin, e.g "Bootstrap3ColumnCMSPlugin"
         * @param {String} name name of the plugin, e.g. "Column"
         * @param {String} parent id of a parent plugin
         */
        addPlugin: function (type, name, parent) {
            // cancel request if already in progress
            if (CMS.API.locked) {
                return false;
            }
            CMS.API.locked = true;

            var that = this;
            var data = {
                placeholder_id: this.options.placeholder_id,
                plugin_type: type,
                plugin_parent: parent || '',
                plugin_language: this.options.plugin_language,
                csrfmiddlewaretoken: this.csrf
            };

            $.ajax({
                type: 'POST',
                url: this.options.urls.add_plugin,
                data: data,
                success: function (data) {
                    CMS.API.locked = false;
                    that.newPlugin = data;
                    that.editPlugin(data.url, name, data.breadcrumb);
                },
                error: function (jqXHR) {
                    CMS.API.locked = false;
                    var msg = CMS.config.lang.error;
                    // trigger error
                    CMS.API.Messages.open({
                        message: msg + jqXHR.responseText || jqXHR.status + ' ' + jqXHR.statusText,
                        error: true
                    });
                }
            });
        },

        /**
         * Opens the modal for editing a plugin.
         *
         * @method editPlugin
         * @param {String} url editing url
         * @param {String} name Name of the plugin, e.g. "Column"
         * @param {Object[]} breadcrumb array of objects representing a breadcrumb,
         *     each item is `{ title: 'string': url: 'string' }`
         */
        editPlugin: function (url, name, breadcrumb) {
            // trigger modal window
            var modal = new CMS.Modal({
                newPlugin: this.newPlugin || false,
                onClose: this.options.onClose || false,
                redirectOnClose: this.options.redirectOnClose || false
            });
            if (!this.newPlugin) {
                modal.on('cms.modal.loaded', function removePlaceholder() {
                    $('.cms-add-plugin-placeholder').remove();
                });
            }
            modal.on('cms.modal.closed', function removePlaceholder() {
                $('.cms-add-plugin-placeholder').remove();
            });
            modal.open({
                url: url,
                title: name,
                breadcrumbs: breadcrumb,
                width: 850
            });
        },

        /**
         * Used for copying _and_ pasting a plugin. If either of params
         * is present method assumes that it's "paste" and will make a call
         * to api to insert current plugin to specified `options.target_plugin_id`
         * or `options.target_placeholder_id`. Copying a plugin also first
         * clears the clipboard.
         *
         * @method copyPlugin
         * @param {Object} [options=this.options]
         * @param {String} source_language
         */
        copyPlugin: function (options, source_language) {
            // cancel request if already in progress
            if (CMS.API.locked) {
                return false;
            }
            CMS.API.locked = true;

            var move = (options || source_language) ? true : false;

            // set correct options
            options = options || this.options;
            if (source_language) {
                options.target = options.placeholder_id;
                options.plugin_id = '';
                options.parent = '';
            } else {
                source_language = options.plugin_language;
            }

            var data = {
                source_placeholder_id: options.placeholder_id,
                source_plugin_id: options.plugin_id || '',
                source_language: source_language,
                target_plugin_id: options.parent || '',
                target_placeholder_id: options.target || CMS.config.clipboard.id,
                target_language: options.page_language || source_language,
                csrfmiddlewaretoken: this.csrf
            };
            var request = {
                type: 'POST',
                url: options.urls.copy_plugin,
                data: data,
                success: function () {
                    CMS.API.Messages.open({
                        message: CMS.config.lang.success
                    });
                    // reload
                    CMS.API.Helpers.reloadBrowser();
                },
                error: function (jqXHR) {
                    CMS.API.locked = false;
                    var msg = CMS.config.lang.error;
                    // trigger error
                    CMS.API.Messages.open({
                        message: msg + jqXHR.responseText || jqXHR.status + ' ' + jqXHR.statusText,
                        error: true
                    });
                }
            };

            if (move) {
                $.ajax(request);
            } else {
                // ensure clipboard is cleaned
                CMS.API.Clipboard.clear(function () {
                    $.ajax(request);
                });
            }
        },

        /**
         * Essentially clears clipboard and moves plugin to a clipboard
         * placholder through `movePlugin`.
         *
         * @method cutPlugin
         */
        cutPlugin: function () {
            // if cut is once triggered, prevent additional actions
            if (CMS.API.locked) {
                return false;
            }
            CMS.API.locked = true;

            var that = this;
            var data = {
                placeholder_id: CMS.config.clipboard.id,
                plugin_id: this.options.plugin_id,
                plugin_parent: '',
                plugin_language: this.options.page_language,
                plugin_order: [this.options.plugin_id],
                csrfmiddlewaretoken: this.csrf
            };

            // ensure clipboard is cleaned
            CMS.API.Clipboard.clear(function () {
                // cancel request if already in progress
                if (CMS.API.locked) {
                    return false;
                }
                CMS.API.locked = true;

                // move plugin
                $.ajax({
                    type: 'POST',
                    url: that.options.urls.move_plugin,
                    data: data,
                    success: function () {
                        CMS.API.Messages.open({
                            message: CMS.config.lang.success
                        });
                        // if response is reload
                        CMS.API.Helpers.reloadBrowser();
                    },
                    error: function (jqXHR) {
                        CMS.API.locked = false;
                        var msg = CMS.config.lang.error;
                        // trigger error
                        CMS.API.Messages.open({
                            message: msg + jqXHR.responseText || jqXHR.status + ' ' + jqXHR.statusText,
                            error: true
                        });
                    }
                });
            });
        },

        /**
         * Method is called when you click on the paste button on the plugin.
         * Uses existing solution of `copyPlugin(options)`
         *
         * @method pastePlugin
         */
        pastePlugin: function () {
            clipboardDraggable.appendTo(this.ui.draggables);
            this.ui.draggables.trigger('cms.update');
            clipboardPlugin.trigger('cms.plugin.update');
        },

        /**
         * Moves plugin by querying the API and then updates some UI parts
         * to reflect that the page has changed.
         *
         * @method movePlugin
         * @param {Object} [options=this.options]
         * @param {String} [options.placeholder_id]
         * @param {String} [options.plugin_id]
         * @param {String} [options.plugin_parent]
         * @param {String} [options.plugin_language]
         * @param {Boolean} [options.move_a_copy]
         */
        movePlugin: function (options) {
            // cancel request if already in progress
            if (CMS.API.locked) {
                return false;
            }
            CMS.API.locked = true;

            var that = this;
            // set correct options
            options = options || this.options;

            var plugin = $('.cms-plugin-' + options.plugin_id);
            var dragitem = $('.cms-draggable-' + options.plugin_id);

            // SETTING POSITION
            this._setPosition(options.plugin_id, plugin, dragitem);

            // SAVING POSITION
            var placeholder_id = this._getId(
                dragitem.parents('.cms-draggables').last().prevAll('.cms-dragbar').first()
            );
            var plugin_parent = this._getId(dragitem.parent().closest('.cms-draggable'));
            var plugin_order = this._getIds(dragitem.siblings('.cms-draggable').andSelf());

            if (options.move_a_copy) {
                plugin_order = plugin_order.map(function (pluginId) {
                    // TODO correct way would be to check if it's actually a
                    // pasted plugin and only then replace the id with copy token
                    // otherwise if we would copy from the same placeholder we would get
                    // two copy tokens instead of original and a copy.
                    // it's ok so far, as long as we copy only from clipboard
                    if (pluginId === options.plugin_id) {
                        pluginId = '__COPY__';
                    }
                    return pluginId;
                });
            }

            // cancel here if we have no placeholder id
            if (placeholder_id === false) {
                return false;
            }

            // gather the data for ajax request
            var data = {
                placeholder_id: placeholder_id,
                plugin_id: options.plugin_id,
                plugin_parent: plugin_parent || '',
                // this is a hack: when moving to different languages use the global language
                plugin_language: options.page_language,
                plugin_order: plugin_order,
                csrfmiddlewaretoken: this.csrf,
                move_a_copy: options.move_a_copy
            };

            $.ajax({
                type: 'POST',
                url: options.urls.move_plugin,
                data: data,
                success: function (response) {
                    // if response is reload
                    if (response.reload) {
                        CMS.API.Helpers.reloadBrowser();
                    }

                    // set new url settings when moving #4803
                    if (response.urls) {
                        that._setSettings(options, {
                            urls: response.urls
                        });
                    }

                    // enable actions again
                    CMS.API.locked = false;

                    // TODO: show only if (response.status)
                    that._showSuccess(dragitem);
                },
                error: function (jqXHR) {
                    CMS.API.locked = false;
                    var msg = CMS.config.lang.error;
                    // trigger error
                    CMS.API.Messages.open({
                        message: msg + jqXHR.responseText || jqXHR.status + ' ' + jqXHR.statusText,
                        error: true
                    });
                }
            });

            // show publish / save buttons
            this.ui.publish
                .addClass('cms-btn-publish-active')
                .removeClass('cms-btn-disabled')
                .parent().show();
            this.ui.window.trigger('resize');

            // enable revert to live
            this.ui.revert.removeClass('cms-toolbar-item-navigation-disabled');
        },

        /**
         * Changes the settings attributes on an initialised plugin.
         *
         * @method _setSettings
         * @param {Object} oldSettings current settings
         * @param {Object} newSettings new settings to be applied
         * @private
         */
        _setSettings: function _setSettings(oldSettings, newSettings) {
            var settings = $.extend(true, {}, oldSettings, newSettings);
            var plugin = $('.cms-plugin-' + settings.plugin_id);

            // set new setting on instance and plugin data
            this.options = settings;
            plugin.data('settings', settings);
        },

        /**
         * Opens a modal to delete a plugin.
         *
         * @method deletePlugin
         * @param {String} url admin url for deleting a page
         * @param {String} name plugin name, e.g. "Column"
         * @param {Object[]} breadcrumb array of objects representing a breadcrumb,
         *     each item is `{ title: 'string': url: 'string' }`
         */
        deletePlugin: function (url, name, breadcrumb) {
            // trigger modal window
            var modal = new CMS.Modal({
                newPlugin: this.newPlugin || false,
                onClose: this.options.onClose || false,
                redirectOnClose: this.options.redirectOnClose || false
            });
            modal.on('cms.modal.loaded', function removePlaceholder() {
                $('.cms-add-plugin-placeholder').remove();
            });
            modal.open({
                url: url,
                title: name,
                breadcrumbs: breadcrumb
            });
        },

        /**
         * Moves the plugin according to the place it should have in content mode.
         *
         * @method _setPosition
         * @private
         * @param {String} id
         * @param {jQuery} plugin the `.cms-plugin` element
         * @param {jQuery} dragitem the `.cms-draggable` of the plugin
         */
        _setPosition: function (id, plugin, dragitem) {
            // after we insert the plugin onto its new place, we need to figure out where to position it
            var prevItem = dragitem.prev('.cms-draggable');
            var nextItem = dragitem.next('.cms-draggable');
            var parent = dragitem.parent().closest('.cms-draggable');
            var child = $('.cms-plugin-' + this._getId(parent));
            var placeholder = dragitem.closest('.cms-dragarea');

            // determine if there are other plugins within the same level, this makes the move easier
            if (prevItem.length) {
                plugin.insertAfter($('.cms-plugin-' + this._getId(prevItem)));
            } else if (nextItem.length) {
                plugin.insertBefore($('.cms-plugin-' + this._getId(nextItem)));
            } else if (parent.length) {
                // if we can't find a plugin on the same level, we need to travel higher
                // for this we need to find the deepest child
                while (child.children().length) {
                    child = child.children();
                }
                child.append(plugin);
            } else if (placeholder.length) {
                // we also need to cover the case if we move the plugin to an empty placeholder
                plugin.insertAfter($('.cms-placeholder-' + this._getId(placeholder)));
            } else {
                // if we did not found a match, reload
                CMS.API.Helpers.reloadBrowser();
            }
        },

        /**
         * Called after plugin is added through ajax.
         *
         * @method editPluginPostAjax
         * @param {Object} toolbar CMS.API.Toolbar instance (not used)
         * @param {Object} response response from server
         */
        editPluginPostAjax: function (toolbar, response) {
            this.editPlugin(response.url, this.options.plugin_name, response.breadcrumb);
        },

        /**
         * _setSettingsMenu sets up event handlers for settings menu.
         *
         * @method _setSettingsMenu
         * @private
         * @param {jQuery} nav
         */
        _setSettingsMenu: function _setSettingsMenu(nav) {
            var that = this;
            this.ui.dropdown = nav.siblings('.cms-submenu-dropdown-settings');
            var dropdown = this.ui.dropdown;

            nav.on(this.pointerUp, function (e) {
                e.preventDefault();
                e.stopPropagation();
                var trigger = $(this);
                if (trigger.hasClass('cms-btn-active')) {
                    CMS.Plugin._hideSettingsMenu(trigger);
                } else {
                    CMS.Plugin._hideSettingsMenu();
                    that._showSettingsMenu(trigger);
                }
            }).on(this.touchStart, function (e) {
                // required on some touch devices so
                // ui touch punch is not triggering mousemove
                // which in turn results in pep triggering pointercancel
                e.stopPropagation();
            });

            dropdown.on(this.mouseEvents, function (e) {
                e.stopPropagation();
            }).on(this.touchStart, function (e) {
                // required for scrolling on mobile
                e.stopPropagation();
            });

            that._setupActions(nav);
            // prevent propagation
            nav.on([this.pointerUp, this.pointerDown, this.click, this.doubleClick].join(' '), function (e) {
                e.stopPropagation();
            });

            nav.siblings('.cms-quicksearch, .cms-submenu-dropdown-settings')
                .on([this.pointerUp, this.click, this.doubleClick].join(' '), function (e) {
                e.stopPropagation();
            });
        },

        /**
         * Simplistic implementation, only scrolls down, only works in structuremode
         * and highly depends on the styles of the structureboard to work correctly
         *
         * @method _scrollToElement
         * @private
         * @param {jQuery} el element to scroll to
         * @param {Object} [opts]
         * @param {Number} [opts.duration=200] time to scroll
         * @param {Number} [opts.offset=50] distance in px to the bottom of the screen
         */
        _scrollToElement: function _scrollToElement(el, opts) {
            var duration = opts && opts.duration !== undefined ? opts.duration : 200;
            var offset = opts && opts.offset !== undefined ? opts.offset : 50;
            var scrollable = el.offsetParent();
            var win = $(window);
            var scrollHeight = win.height();
            var scrollTop = scrollable.scrollTop();
            var elPosition = el.position().top;
            var elHeight = el.height();
            var isInViewport = (elPosition + elHeight + offset <= scrollHeight);

            if (!isInViewport) {
                scrollable.animate({
                    scrollTop: elPosition + offset + elHeight + scrollTop - scrollHeight
                }, duration);
            }
        },

        /**
         * Opens a modal with traversable plugins list, adds a placeholder to where
         * the plugin will be added.
         *
         * @method _setAddPluginModal
         * @private
         * @param {jQuery} nav modal trigger element
         */
        _setAddPluginModal: function _setAddPluginModal(nav) {
            if (nav.hasClass('cms-btn-disabled')) {
                return false;
            }
            var that = this;
            var placeholder = $(
                '<div class="cms-add-plugin-placeholder">' +
                    CMS.config.lang.addPluginPlaceholder +
                '</div>'
            );
            var modal = new CMS.Modal({
                minWidth: 400,
                minHeight: 400
            });
            var dragItem = nav.closest('.cms-dragitem');
            var isPlaceholder = !Boolean(dragItem.length);
            var childrenList;
            var isTouching;

            if (isPlaceholder) {
                childrenList = nav.closest('.cms-dragarea').find('> .cms-draggables');
            } else {
                childrenList = nav.closest('.cms-draggable').find('> .cms-draggables');
            }

            modal.on('cms.modal.loaded', $.proxy(that._setupKeyboardTraversing, that));
            modal.on('cms.modal.loaded', function addPlaceholder() {
                if (childrenList.hasClass('cms-hidden') && !isPlaceholder) {
                    that._toggleCollapsable(dragItem);
                }
                $('.cms-add-plugin-placeholder').remove();
                placeholder.appendTo(childrenList);
                that._scrollToElement(placeholder);
            });
            modal.on('cms.modal.closed', function removePlaceholder() {
                $('.cms-add-plugin-placeholder').remove();
            });
            modal.on('cms.modal.shown', function () {
                var dropdown = $('.cms-modal-markup .cms-plugin-picker');
                if (!isTouching) {
                    // only focus the field if using mouse
                    // otherwise keyboard pops up
                    dropdown.find('input').trigger('focus');
                }
                isTouching = false;
            });
            var plugins = nav.siblings('.cms-plugin-picker');

            that._setupQuickSearch(plugins);

            nav.on(this.touchStart, function (e) {
                isTouching = true;
                // required on some touch devices so
                // ui touch punch is not triggering mousemove
                // which in turn results in pep triggering pointercancel
                e.stopPropagation();
            }).on(this.pointerUp, function (e) {
                e.preventDefault();
                e.stopPropagation();

                CMS.Plugin._hideSettingsMenu();

                // since we don't know exact plugin parent (because dragndrop)
                // we need to know the parent id by the time we open "add plugin" dialog
                var pluginsCopy = plugins.clone(true, true).data(
                    'parentId', that._getId(nav.closest('.cms-draggable'))
                );

                modal.open({
                    title: that.options.addPluginHelpTitle,
                    html: pluginsCopy,
                    width: 530,
                    height: 400
                });
            });

            // prevent propagation
            nav.on([this.pointerUp, this.pointerDown, this.click, this.doubleClick].join(' '), function (e) {
                e.stopPropagation();
            });

            nav.siblings('.cms-quicksearch, .cms-submenu-dropdown')
                .on([this.pointerUp, this.click, this.doubleClick].join(' '), function (e) {
                e.stopPropagation();
            });
        },

        /**
         * Sets up event handlers for quicksearching in the plugin picker.
         *
         * @method _setupQuickSearch
         * @private
         * @param {jQuery} plugins plugins picker element
         */
        _setupQuickSearch: function _setupQuickSearch(plugins) {
            var that = this;
            var input = plugins.find('> .cms-quicksearch').find('input');

            var handler = CMS.API.Helpers.debounce(function () {
                var input = $(this);
                // have to always find the pluginsPicker in the handler
                // because of how we move things into/out of the modal
                var pluginsPicker = input.closest('.cms-plugin-picker');
                that._filterPluginsList(pluginsPicker, input);
            }, 100);

            input.on(this.keyUp, handler).on(this.keyUp, CMS.API.Helpers.debounce(function (e) {
                var input;
                var pluginsPicker;
                if (e.keyCode === CMS.KEYS.ENTER) {
                    input = $(this);
                    pluginsPicker = input.closest('.cms-plugin-picker');
                    pluginsPicker.find('.cms-submenu-item')
                        .not('.cms-submenu-item-title').filter(':visible').first().find('> a').focus()
                        .trigger('click');
                }
            }, 110));
        },

        /**
         * Sets up click handlers for various plugin/placeholder items.
         * Items can be anywhere in the plugin dragitem, not only in dropdown.
         *
         * @method _setupActions
         * @private
         * @param {jQuery} nav dropdown trigger with the items
         */
        _setupActions: function _setupActions(nav) {
            var that = this;
            var items = '.cms-submenu-edit, .cms-submenu-item a';
            nav.parent().find('.cms-submenu-edit').on(this.touchStart, function (e) {
                // required on some touch devices so
                // ui touch punch is not triggering mousemove
                // which in turn results in pep triggering pointercancel
                e.stopPropagation();
            });
            nav.parent().find(items).on(that.click, function (e) {
                e.preventDefault();
                e.stopPropagation();

                // show loader and make sure scroll doesn't jump
                CMS.API.Toolbar.showLoader();

                var el = $(this);
                CMS.Plugin._hideSettingsMenu(nav);

                // set switch for subnav entries
                switch (el.attr('data-rel')) {
                    case 'add':
                        that.addPlugin(
                            el.attr('href').replace('#', ''),
                            el.text(),
                            el.closest('.cms-plugin-picker').data('parentId')
                        );
                        break;
                    case 'ajax_add':
                        CMS.API.Toolbar.openAjax({
                            url: el.attr('href'),
                            post: JSON.stringify(el.data('post')),
                            text: el.data('text'),
                            callback: $.proxy(that.editPluginPostAjax, that),
                            onSuccess: el.data('on-success')
                        });
                        break;
                    case 'edit':
                        that.editPlugin(
                            that.options.urls.edit_plugin,
                            that.options.plugin_name,
                            that.options.plugin_breadcrumb
                        );
                        break;
                    case 'copy-lang':
                        that.copyPlugin(this.options, el.attr('data-language'));
                        break;
                    case 'copy':
                        if (!el.parent().hasClass('cms-submenu-item-disabled')) {
                            that.copyPlugin();
                        } else {
                            CMS.API.Toolbar.hideLoader();
                        }
                        break;
                    case 'cut':
                        that.cutPlugin();
                        break;
                    case 'paste':
                        if (!el.parent().hasClass('cms-submenu-item-disabled')) {
                            that.pastePlugin();
                        } else {
                            CMS.API.Toolbar.hideLoader();
                        }
                        break;
                    case 'delete':
                        that.deletePlugin(
                            that.options.urls.delete_plugin,
                            that.options.plugin_name,
                            that.options.plugin_breadcrumb
                        );
                        break;
                    default:
                        CMS.API.Toolbar.hideLoader();
                        CMS.API.Toolbar._delegate(el);
                }
            });
        },

        /**
         * Sets up keyboard traversing of plugin picker.
         *
         * @method _setupKeyboardTraversing
         * @private
         */
        _setupKeyboardTraversing: function _setupKeyboardTraversing() {
            var dropdown = $('.cms-modal-markup .cms-plugin-picker');
            if (!dropdown.length) {
                return;
            }
            // add key events
            doc.off(this.keyDown + '.traverse');
            doc.on(this.keyDown + '.traverse', function (e) {
                var anchors = dropdown.find('.cms-submenu-item:visible a');
                var index = anchors.index(anchors.filter(':focus'));

                // bind arrow down and tab keys
                if (e.keyCode === CMS.KEYS.DOWN || e.keyCode === CMS.KEYS.TAB) {
                    e.preventDefault();
                    if (index >= 0 && index < anchors.length - 1) {
                        anchors.eq(index + 1).focus();
                    } else {
                        anchors.eq(0).focus();
                    }
                }

                // bind arrow up and shift+tab keys
                if (e.keyCode === CMS.KEYS.UP || (e.keyCode === CMS.KEYS.TAB && e.shiftKey)) {
                    e.preventDefault();
                    if (anchors.is(':focus')) {
                        anchors.eq(index - 1).focus();
                    } else {
                        anchors.eq(anchors.length).focus();
                    }
                }
            });
        },

        /**
         * Opens the settings menu for a plugin.
         *
         * @method _showSettingsMenu
         * @private
         * @param {jQuery} nav trigger element
         */
        _showSettingsMenu: function (nav) {
            var dropdown = this.ui.dropdown;
            var parents = nav.parentsUntil('.cms-dragarea').last();

            nav.addClass('cms-btn-active');
            parents.addClass('cms-z-index-9999');

            // set visible states
            dropdown.show();

            // calculate dropdown positioning
            if (this.ui.window.height() + this.ui.window.scrollTop() -
                nav.offset().top - dropdown.height() <= 10 && nav.offset().top - dropdown.height() >= 0) {
                dropdown.removeClass('cms-submenu-dropdown-top').addClass('cms-submenu-dropdown-bottom');
            } else {
                dropdown.removeClass('cms-submenu-dropdown-bottom').addClass('cms-submenu-dropdown-top');
            }
        },

        /**
         * Filters given plugins list by a query.
         *
         * @method _filterPluginsList
         * @private
         * @param {jQuery} list plugins picker element
         * @param {jQuery} input input, which value to filter plugins with
         */
        _filterPluginsList: function _filterPluginsList(list, input) {
            var items = list.find('.cms-submenu-item');
            var titles = list.find('.cms-submenu-item-title');
            var query = input.val();

            // cancel if query is zero
            if (query === '') {
                items.add(titles).show();
                return false;
            }

            // loop through items and figure out if we need to hide items
            items.find('a, span').each(function (index, item) {
                item = $(item);
                var text = item.text().toLowerCase();
                var search = query.toLowerCase();

                (text.indexOf(search) >= 0) ? item.parent().show() : item.parent().hide();
            });

            // check if a title is matching
            titles.filter(':visible').each(function (index, item) {
                titles.hide();
                $(item).nextUntil('.cms-submenu-item-title').show();
            });

            // always display title of a category
            items.filter(':visible').each(function (index, item) {
                item = $(item);
                if (item.prev().hasClass('cms-submenu-item-title')) {
                    item.prev().show();
                } else {
                    item.prevUntil('.cms-submenu-item-title').last().prev().show();
                }
            });

            // if there is no element visible, show only first categoriy
            list.siblings('.cms-submenu-dropdown-children').show();
            if (items.add(titles).filter(':visible').length <= 0) {
                list.siblings('.cms-submenu-dropdown-children').hide();
            }
        },

        /**
         * Toggles collapsable item.
         *
         * @method _toggleCollapsable
         * @private
         * @param {jQuery} el element to toggle
         */
        _toggleCollapsable: function toggleCollapsable(el) {
            var that = this;
            var id = that._getId(el.parent());
            var draggable = this.ui.draggable;
            var items;

            var settings = CMS.settings;
            settings.states = settings.states || [];

            // collapsable function and save states
            if (el.hasClass('cms-dragitem-expanded')) {
                settings.states.splice($.inArray(id, settings.states), 1);
                el.removeClass('cms-dragitem-expanded').parent()
                    .find('> .cms-collapsable-container').addClass('cms-hidden');

                if (doc.data('expandmode')) {
                    items = draggable.find('.cms-draggable').find('.cms-dragitem-collapsable');
                    if (!items.length) {
                        return false;
                    }
                    items.each(function () {
                        var item = $(this);
                        if (item.hasClass('cms-dragitem-expanded')) {
                            that._toggleCollapsable(item);
                        }
                    });
                }

            } else {
                settings.states.push(id);
                el.addClass('cms-dragitem-expanded').parent()
                    .find('> .cms-collapsable-container').removeClass('cms-hidden');

                if (doc.data('expandmode')) {
                    items = draggable.find('.cms-draggable').find('.cms-dragitem-collapsable');
                    if (!items.length) {
                        return false;
                    }
                    items.each(function () {
                        var item = $(this);
                        if (!item.hasClass('cms-dragitem-expanded')) {
                            that._toggleCollapsable(item);
                        }
                    });
                }
            }

            // make sure structurboard gets updated after expanding
            this.ui.window.trigger('resize.sideframe');

            // save settings
            CMS.API.Toolbar.setSettings(settings);
        },

        /**
         * Sets up collabspable event handlers.
         *
         * @method _collapsables
         * @private
         */
        _collapsables: function () {
            // one time setup
            var that = this;
            this.ui.draggable = $('.cms-draggable-' + this.options.plugin_id);
            var dragitem = this.ui.draggable.find('> .cms-dragitem');

            // check which button should be shown for collapsemenu
            this.ui.container.each(function (index, item) {
                var els = $(item).find('.cms-dragitem-collapsable');
                var open = els.filter('.cms-dragitem-expanded');
                if (els.length === open.length && (els.length + open.length !== 0)) {
                    $(item).find('.cms-dragbar-title').addClass('cms-dragbar-title-expanded');
                }
            });
            // cancel here if its not a draggable
            if (!this.ui.draggable.length) {
                return false;
            }

            // attach events to draggable
            // debounce here required because on some devices click is not triggered,
            // so we consolidate latest click and touch event to run the collapse only once
            dragitem.find('> .cms-dragitem-text').on(
                this.touchEnd + ' ' + this.click,
                CMS.API.Helpers.debounce(function () {
                    if (!dragitem.hasClass('cms-dragitem-collapsable')) {
                        return;
                    }
                    that._toggleCollapsable(dragitem);
                }, 0)
            );

            // adds double click event
            this.ui.draggable.on(this.doubleClick, function (e) {
                e.stopPropagation();
                $('.cms-plugin-' + that._getId($(this))).trigger('dblclick.cms');
            });

            // only needs to be excecuted once
            if (CMS.Toolbar.ready) {
                return false;
            }

            // removing duplicate entries
            var sortedArr = CMS.settings.states.sort();
            var filteredArray = [];
            for (var i = 0; i < sortedArr.length; i++) {
                if (sortedArr[i] !== sortedArr[i + 1]) {
                    filteredArray.push(sortedArr[i]);
                }
            }
            CMS.settings.states = filteredArray;

            // loop through the items
            $.each(CMS.settings.states, function (index, id) {
                var el = $('.cms-draggable-' + id);
                // only add this class to elements which have a draggable area
                if (el.find('.cms-draggables').length) {
                    el.find('> .cms-collapsable-container').removeClass('cms-hidden');
                    el.find('> .cms-dragitem').addClass('cms-dragitem-expanded');
                }
            });

            // set global setup
            CMS.Toolbar.ready = true;
        },

        /**
         * Expands all the collapsables in the given placeholder.
         *
         * @method _expandAll
         * @private
         * @param {jQuery} el trigger element that is a child of a placeholder
         */
        _expandAll: function (el) {
            var that = this;
            var items = el.closest('.cms-dragarea').find('.cms-dragitem-collapsable');
            // cancel if there are no items
            if (!items.length) {
                return false;
            }
            items.each(function () {
                var item = $(this);
                if (!item.hasClass('cms-dragitem-expanded')) {
                    that._toggleCollapsable(item);
                }
            });

            el.addClass('cms-dragbar-title-expanded');

            var settings = CMS.settings;
            settings.dragbars = settings.dragbars || [];
            settings.dragbars.push(this.options.placeholder_id);
            CMS.API.Toolbar.setSettings(settings);
        },

        /**
         * Collapses all the collapsables in the given placeholder.
         *
         * @method _collapseAll
         * @private
         * @param {jQuery} el trigger element that is a child of a placeholder
         */
        _collapseAll: function (el) {
            var that = this;
            var items = el.closest('.cms-dragarea').find('.cms-dragitem-collapsable');
            items.each(function () {
                var item = $(this);
                if (item.hasClass('cms-dragitem-expanded')) {
                    that._toggleCollapsable(item);
                }
            });

            el.removeClass('cms-dragbar-title-expanded');

            var settings = CMS.settings;
            settings.dragbars = settings.dragbars || [];
            settings.dragbars.splice($.inArray(this.options.placeholder_id, settings.states), 1);
            CMS.API.Toolbar.setSettings(settings);
        },

        /**
         * Gets the id of the element, uses CMS.StructureBoard instance.
         *
         * @method _getId
         * @private
         * @param {jQuery} el element to get id from
         * @return {String}
         */
        _getId: function (el) {
            return CMS.API.StructureBoard.getId(el);
        },

        /**
         * Gets the ids of the list of elements, uses CMS.StructureBoard instance.
         *
         * @method _getIds
         * @private
         * @param {jQuery} els elements to get id from
         * @return {String[]}
         */
        _getIds: function (els) {
            return CMS.API.StructureBoard.getIds(els);
        },

        /**
         * Shows and immediately fades out a success notification (when
         * plugin was successfully moved.
         *
         * @method _showSuccess
         * @private
         * @param {jQuery} el draggable element
         */
        _showSuccess: function (el) {
            var tpl = $('<div class="cms-dragitem-success"></div>');
            el.addClass('cms-draggable-success').append(tpl);
            // start animation
            tpl.fadeOut(1000, function () {
                $(this).remove();
                el.removeClass('cms-draggable-success');
            });
            // make sure structurboard gets updated after success
            this.ui.window.trigger('resize.sideframe');
        }
    });

    /**
     * Hides the opened settings menu. By default looks for any open ones.
     *
     * @method _hideSettingsMenu
     * @static
     * @private
     * @param {jQuery} [nav] element representing the subnav trigger
     */
    CMS.Plugin._hideSettingsMenu = function (nav) {
        nav = nav || $('.cms-submenu-btn.cms-btn-active');
        if (!nav.length) {
            return;
        }
        nav.removeClass('cms-btn-active');

        // set correct active state
        nav.closest('.cms-draggable').data('active', false);
        $('.cms-z-index-9999').removeClass('cms-z-index-9999');

        nav.siblings('.cms-submenu-dropdown').hide();
        nav.siblings('.cms-quicksearch').hide();
        // reset search
        nav.siblings('.cms-quicksearch')
            .find('input')
            .val('')
            .trigger(this.keyUp).blur();

        // reset relativity
        $('.cms-dragbar').css('position', '');
    };

    /**
     * Initialises handlers that affect all plugins and don't make sense
     * in context of each own plugin instance, e.g. listening for a click on a document
     * to hide plugin settings menu should only be applied once, and not every time
     * CMS.Plugin is instantiated.
     *
     * @method _initializeGlobalHandlers
     * @static
     * @private
     */
    CMS.Plugin._initializeGlobalHandlers = function _initializeGlobalHandlers() {
        var timer;
        var clickCounter = 0;

        doc = $(document);
        clipboard = $('.cms-clipboard');
        clipboardDraggable = clipboard.find('.cms-draggable:first');
        clipboardPlugin = clipboard.find('.cms-plugin:first');

        doc.on('pointerup.cms.plugin', function () {
            // call it as a static method, because otherwise we trigger it the
            // amount of times CMS.Plugin is instantiated,
            // which does not make much sense.
            CMS.Plugin._hideSettingsMenu();
        }).on('keydown.cms.plugin', function (e) {
            if (e.keyCode === CMS.KEYS.SHIFT) {
                doc.data('expandmode', true);
            }
        }).on('keyup.cms.plugin', function (e) {
            if (e.keyCode === CMS.KEYS.SHIFT) {
                doc.data('expandmode', false);
            }
        }).on('click.cms.plugin', '.cms-plugin a, a:has(.cms-plugin)', function (e) {
            // prevents single click from messing up the edit call
            // don't go to the link if there is custom js attached to it
            // or if it's clicked along with shift, ctrl, cmd
            if (e.shiftKey || e.ctrlKey || e.metaKey || e.isDefaultPrevented()) {
                return;
            }
            e.preventDefault();
            if (++clickCounter === 1) {
                timer = setTimeout(function () {
                    var anchor = $(e.currentTarget);
                    clickCounter = 0;
                    // make sure that the target attribute is honoured on links
                    window.open(anchor.attr('href'), anchor.attr('target') || '_self');
                }, 300);
            } else {
                clearTimeout(timer);
                clickCounter = 0;
            }
        });
    };

    // shorthand for jQuery(document).ready();
    $(CMS.Plugin._initializeGlobalHandlers);

})(CMS.$);

//##############################################################################
// STRUCTUREBOARD
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

(function ($) {
    'use strict';

    var placeholders;

    // TODO make these static methods on CMS.StructureBoard
    function actualizeEmptyPlaceholders() {
        placeholders.each(function () {
            var placeholder = $(this);
            var copyAll = placeholder.find('.cms-dragbar .cms-submenu-item:has(a[data-rel="copy"]):first');
            if (placeholder
                .find('> .cms-draggables')
                .children('.cms-draggable:not(.cms-draggable-is-dragging)').length) {
                placeholder.removeClass('cms-dragarea-empty');
                copyAll.removeClass('cms-submenu-item-disabled');
            } else {
                placeholder.addClass('cms-dragarea-empty');
                copyAll.addClass('cms-submenu-item-disabled');

            }
        });
    }

    function actualizePluginsCollapsibleStatus(els) {
        els.each(function () {
            var childList = $(this);
            var pluginDragItem = childList.closest('.cms-draggable').find('> .cms-dragitem');

            if (childList.children().length) {
                pluginDragItem.addClass('cms-dragitem-collapsable cms-dragitem-expanded');
            } else {
                pluginDragItem.removeClass('cms-dragitem-collapsable');
            }
        });
    }

    /**
     * Handles drag & drop, mode switching and collapsables.
     *
     * @class StructureBoard
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.StructureBoard = new CMS.Class({

        implement: [CMS.API.Helpers],

        initialize: function () {
            // elements
            this._setupUI();

            // states
            this.click = 'click.cms';
            this.pointerUp = 'pointerup.cms';
            this.state = false;
            this.dragging = false;

            // setup initial stuff
            this._setup();

            this._setupModeSwitcher();
            actualizeEmptyPlaceholders();
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function setupUI() {
            var container = $('.cms-structure');
            var toolbar = $('.cms-toolbar');
            this.ui = {
                container: container,
                content: $('.cms-structure-content'),
                doc: $(document),
                window: $(window),
                html: $('html'),
                toolbar: toolbar,
                sortables: $('.cms-draggables'), // global scope to include clipboard
                plugins: $('.cms-plugin'),
                render_model: $('.cms-render-model'),
                placeholders: $('.cms-placeholder'),
                dragitems: $('.cms-draggable'),
                dragareas: $('.cms-dragarea'),
                toolbarModeSwitcher: toolbar.find('.cms-toolbar-item-cms-mode-switcher'),
                toolbarModeLinks: toolbar.find('.cms-toolbar-item-cms-mode-switcher a'),
                toolbarTrigger: $('.cms-toolbar-trigger')
            };
        },

        /**
         * Initial setup (and early bail if specific
         * elements do not exist).
         *
         * @method _setup
         * @private
         */
        _setup: function () {
            var that = this;
            // cancel if there are no dragareas
            if (!this.ui.dragareas.length) {
                return false;
            }

            // cancel if there is no structure / content switcher
            if (!this.ui.toolbarModeSwitcher.length) {
                return false;
            }

            // setup toolbar mode
            // FIXME this setTimeout is needed because
            // plugins are initialized after all the scripts are processed
            // which should be fixed btw. _resizeBoard wants plugins to be initialized,
            // otherwise throws errors
            setTimeout(function () {
                if (CMS.settings.mode === 'structure') {
                    that.show(true);
                } else {
                    // triggering hide here to switch proper classnames on switcher
                    that.hide(true);
                }
            }, 0);

            // check if modes should be visible
            if (this.ui.placeholders.length) {
                this.ui.toolbarModeSwitcher.show();
            }

            // add drag & drop functionality
            this._drag();
        },

        /**
         * Sets up events handlers for switching
         * structureboard modes.
         *
         * @method _setupModeSwitcher
         * @private
         */
        _setupModeSwitcher: function () {
            var that = this;
            var modes = that.ui.toolbarModeLinks;

            // show edit mode
            modes.eq(1).on(that.click + ' ' + that.pointerUp, function (e) {
                e.preventDefault();
                // cancel if already active
                if (CMS.settings.mode === 'edit') {
                    return false;
                }
                // otherwise hide
                that.hide();
            });
            // show structure mode
            modes.eq(0).on(that.click + ' ' + that.pointerUp, function (e) {
                e.preventDefault();
                // cancel if already active
                if (CMS.settings.mode === 'structure') {
                    return false;
                }
                // otherwise show
                that.show();
            });

            // keyboard handling
            // only if there is a structure / content switcher
            if (that.ui.toolbarModeSwitcher.length) {
                that.ui.doc.on('keydown', function (e) {
                    // check if we have an important focus
                    var haveFocusedField = document.activeElement !== document.body;
                    if (e.keyCode === CMS.KEYS.SPACE && !haveFocusedField) {
                        e.preventDefault();
                        if (CMS.settings.mode === 'structure') {
                            that.hide();
                        } else if (CMS.settings.mode === 'edit') {
                            that.show();
                        }
                    }
                });
            }
        },

        /**
         * Shows the structureboard. (Structure mode)
         *
         * @method show
         * @public
         * @param {Boolean} init true if this is first initialization
         */
        show: function (init) {
            // cancel show if live modus is active
            if (CMS.config.mode === 'live') {
                return false;
            }

            // in order to get consistent positioning
            // of the toolbar we have to know if the page
            // had the scrollbar nad if it had - we adjust
            // the toolbar positioning
            var width = this.ui.toolbar.width();
            var scrollBarWidth = this.ui.window[0].innerWidth - width;
            if (scrollBarWidth) {
                this.ui.toolbar.css('right', scrollBarWidth);
                this.ui.toolbarTrigger.css('right', scrollBarWidth);
            }

            // set active item
            var modes = this.ui.toolbarModeLinks;
            modes.removeClass('cms-btn-active').eq(0).addClass('cms-btn-active');
            this.ui.html.removeClass('cms-structure-mode-content')
                .addClass('cms-structure-mode-structure');

            // apply new settings
            CMS.settings.mode = 'structure';
            if (!init) {
                CMS.settings = this.setSettings(CMS.settings);
            }

            // ensure all elements are visible
            this.ui.dragareas.show();

            // show canvas
            this._showBoard();
        },

        /**
         * Hides the structureboard. (Content mode)
         *
         * @method hide
         * @param {Boolean} init true if this is first initialization
         */
        hide: function (init) {
            // cancel show if live modus is active
            if (CMS.config.mode === 'live') {
                return false;
            }

            // reset toolbar positioning
            this.ui.toolbar.css('right', '');
            this.ui.toolbarTrigger.css('right', '');

            // set active item
            var modes = this.ui.toolbarModeLinks;
            modes.removeClass('cms-btn-active').eq(1).addClass('cms-btn-active');
            this.ui.html.removeClass('cms-structure-mode-structure')
                .addClass('cms-structure-mode-content');

            // hide clipboard if in edit mode
            this.ui.container.find('.cms-clipboard').hide();

            CMS.settings.mode = 'edit';
            if (!init) {
                CMS.settings = this.setSettings(CMS.settings);
            }

            // hide canvas
            this._hideBoard();
        },

        /**
         * Gets the id of the element.
         * TODO: relies on cms-{item}-{id} to always be second in a string of classes
         *
         * @method getId
         * @param {jQuery} el element to get id from
         * @return {String}
         */
        getId: function (el) {
            // cancel if no element is defined
            if (el === undefined || el === null || el.length <= 0) {
                return false;
            }

            var id = null;
            var cls = el.attr('class').split(' ')[1];

            if (el.hasClass('cms-plugin')) {
                id = cls.replace('cms-plugin-', '');
            } else if (el.hasClass('cms-draggable')) {
                id = cls.replace('cms-draggable-', '');
            } else if (el.hasClass('cms-placeholder')) {
                id = cls.replace('cms-placeholder-', '');
            } else if (el.hasClass('cms-dragbar')) {
                id = cls.replace('cms-dragbar-', '');
            } else if (el.hasClass('cms-dragarea')) {
                id = cls.replace('cms-dragarea-', '');
            }

            return id;
        },

        /**
         * Gets the ids of the list of  elements.
         *
         * @method getIds
         * @param {jQuery} el elements to get id from
         * @return {String[]}
         */
        getIds: function (els) {
            var that = this;
            var array = [];
            els.each(function () {
                array.push(that.getId($(this)));
            });
            return array;
        },

        /**
         * Actually shows the board canvas.
         *
         * @method _showBoard
         * @private
         */
        _showBoard: function () {
            var that = this;

            // show container
            this.ui.container.show();
            this.ui.dragareas.css('opacity', 1);

            this.ui.plugins.not(this.ui.render_model).hide();
            this.ui.placeholders.show();

            // attach event
            if (CMS.config.simpleStructureBoard) {
                var content = this.ui.content;
                var areas = content.find('.cms-dragarea');
                // set correct css attributes for the new mode
                content.addClass('cms-structure-content-simple');
                areas.addClass('cms-dragarea-simple');
                // lets reorder placeholders
                areas.each(function (index, item) {
                    if ($(item).hasClass('cms-dragarea-static')) {
                        content.append(item);
                    }
                });
                // now lets get the first instance and add some padding
                areas.filter('.cms-dragarea-static').eq(0).css('margin-top', '50px');
            } else {
                this.ui.container.addClass('cms-structure-dynamic');
                this.ui.window.on('resize.sideframe', function () {
                    that._resizeBoard();
                }).trigger('resize.sideframe');
            }
        },

        /**
         * Hides the board canvas.
         *
         * @method _hideBoard
         * @private
         */
        _hideBoard: function () {
            // hide elements
            this.ui.container.hide();
            this.ui.plugins.show();
            this.ui.placeholders.hide();

            // detach event
            this.ui.window.off('resize.sideframe');

            this.ui.window.trigger('structureboard_hidden.sideframe');

            // this is sometimes required for user-side scripts to
            // render dynamic elements on the page correctly.
            // e.g. you have a parallax script that calculates position
            // of elements based on document height. but if the page is
            // loaded with structureboard active - the document height
            // would be same as screen height, which is likely incorrect,
            // so triggering resize on window would force user scripts
            // to recalculate whatever is required there
            this.ui.window.trigger('resize');

            if (!CMS.config.simpleStructureBoard) {
                this.ui.container.height(this.ui.doc.outerHeight());
            }
        },

        /**
         * Resizes the placeholder to fit their placement
         * and the structure board.
         *
         * @method _resizeBoard
         * @private
         * @deprecated as of CMS 3.2
         */
        _resizeBoard: function () {
            // calculate placeholder position
            var id = null;
            var area = null;
            var min = null;
            var areaParentOffset = null;
            var that = this;

            // have to delay since height changes when toggling modes
            setTimeout(function () {
                that.ui.container.height(that.ui.doc.outerHeight());
            }, 0);

            // start calculating
            this.ui.placeholders.each(function (index, item) {
                item = $(item);
                id = item.data('settings').placeholder_id;
                area = $('.cms-dragarea-' + id);
                // to calculate the correct offset, we need to set the
                // placeholders correct heights and than set the according position
                item.height(area.outerHeight(true));
                // set min width
                min = (item.width()) ? 0 : 150;
                // as area is "css positioned" and jquery offset function is relative to the
                // document (not the first relative/absolute parent) we need to substract
                // first relative/absolute parent offset.
                areaParentOffset = $(area).offsetParent().offset();
                area.css({
                    top: item.offset().top - areaParentOffset.top - 5,
                    left: item.offset().left - areaParentOffset.left - min,
                    width: item.width() + min
                });
            });
        },

        /**
         * Sets up all the sortables.
         *
         * @method _drag
         * @private
         */
        _drag: function () {
            var that = this;
            var originalPluginContainer;

            this.ui.sortables.nestedSortable({
                items: '> .cms-draggable:not(.cms-draggable-disabled .cms-draggable)',
                placeholder: 'cms-droppable',
                connectWith: '.cms-draggables:not(.cms-hidden)',
                tolerance: 'intersect',
                toleranceElement: '> div',
                dropOnEmpty: true,
                // cloning huge structure is a performance loss compared to cloning just a dragitem
                helper: function createHelper(e, item) {
                    var clone = item.find('> .cms-dragitem').clone();
                    clone.wrap('<div class="' + item[0].className + '"></div>');
                    return clone.parent();
                },
                appendTo: '.cms-structure-content',
                // appendTo: '.cms',
                cursor: 'move',
                cursorAt: { left: -15, top: -15 },
                opacity: 1,
                zIndex: 9999999,
                delay: 100,
                tabSize: 15,
                // nestedSortable
                listType: 'div.cms-draggables',
                doNotClear: true,
                disableNestingClass: 'cms-draggable-disabled',
                errorClass: 'cms-draggable-disallowed',
                scrollSpeed: 15,
                scrollSensitivity: that.ui.window.height() * 0.2,
                start: function (e, ui) {
                    that.ui.content.attr('data-touch-action', 'none');

                    originalPluginContainer = ui.item.closest('.cms-draggables');
                    that.dragging = true;
                    // show empty
                    actualizeEmptyPlaceholders();
                    // ensure all menus are closed
                    CMS.Plugin._hideSettingsMenu();
                    // keep in mind that caching cms-draggables query only works
                    // as long as we don't create them on the fly
                    that.ui.sortables.each(function () {
                        var element = $(this);
                        if (element.children().length === 0) {
                            element.removeClass('cms-hidden');
                        }
                    });

                    // fixes placeholder height
                    ui.item.addClass('cms-is-dragging');
                    ui.helper.addClass('cms-draggable-is-dragging');
                    if (ui.item.find('> .cms-draggables').children().length) {
                        ui.helper.addClass('cms-draggable-stack');
                    }

                    // attach escape event to cancel dragging
                    that.ui.doc.on('keyup.cms.interrupt', function (e, cancel) {
                        if (e.keyCode === CMS.KEYS.ESC && that.dragging || cancel) {
                            that.state = false;
                            $.ui.sortable.prototype._mouseStop();
                            that.ui.sortables.trigger('mouseup');
                        }
                    });
                },

                beforeStop: function (event, ui) {
                    that.dragging = false;
                    ui.item.removeClass('cms-is-dragging cms-draggable-stack');
                    that.ui.doc.off('keyup.cms.interrupt');
                    that.ui.content.attr('data-touch-action', 'pan-y');
                },

                update: function (event, ui) {
                    // cancel if isAllowed returns false
                    if (!that.state) {
                        return false;
                    }

                    var newPluginContainer = ui.item.closest('.cms-draggables');
                    if (!originalPluginContainer.is(newPluginContainer)) {
                        actualizePluginsCollapsibleStatus(newPluginContainer.add(originalPluginContainer));
                    } else {
                        // if we moved inside same container,
                        // but event is fired on a parent, discard update
                        if (!newPluginContainer.is(this)) {
                            return false;
                        }
                    }

                    // we pass the id to the updater which checks within the backend the correct place
                    var id = that.getId(ui.item);
                    var plugin = $('.cms-plugin-' + id);

                    // check if we copy/paste a plugin or not
                    if (plugin.closest('.cms-clipboard').length) {
                        plugin.trigger('cms.plugin.update');
                    } else {
                        plugin.trigger('cms.plugins.update');
                    }

                    // reset placeholder without entries
                    that.ui.sortables.each(function () {
                        var element = $(this);
                        if (element.children().length === 0) {
                            element.addClass('cms-hidden');
                        }
                    });

                    actualizeEmptyPlaceholders();
                },
                isAllowed: function (placeholder, placeholderParent, originalItem) {
                    // cancel if action is executed
                    if (CMS.API.locked) {
                        return false;
                    }
                    // getting restriction array
                    var bounds = [];
                    var immediateParentType;
                    // save original state events
                    var original = $('.cms-plugin-' + that.getId(originalItem));
                    // cancel if item has no settings
                    if (original.length === 0 || original.data('settings') === null) {
                        return false;
                    }
                    var parent_bounds = $.grep(original.data('settings').plugin_parent_restriction, function (r) {
                        // special case when PlaceholderPlugin has a parent restriction named "0"
                        return r !== '0';
                    });
                    var type = original.data('settings').plugin_type;
                    // prepare variables for bound
                    var holderId = that.getId(placeholder.closest('.cms-dragarea'));
                    var holder = $('.cms-placeholder-' + holderId);
                    var plugin;
                    if (placeholderParent && placeholderParent.length) {
                        // placeholderParent is always latest, it maybe that
                        // isAllowed is called _before_ placeholder is moved to a child plugin
                        plugin = $('.cms-plugin-' + that.getId(placeholderParent.closest('.cms-draggable')));
                    } else {
                        plugin = $('.cms-plugin-' + that.getId(placeholder.closest('.cms-draggable')));
                    }

                    // now set the correct bounds
                    if (holder.length) {
                        bounds = holder.data('settings').plugin_restriction;
                        immediateParentType = holder.data('settings').plugin_type;
                    }
                    if (plugin.length) {
                        bounds = plugin.data('settings').plugin_restriction;
                        immediateParentType = plugin.data('settings').plugin_type;
                    }

                    // if parent has class disabled, dissalow drop
                    if (placeholder.parent().hasClass('cms-draggable-disabled')) {
                        return false;
                    }

                    // if restrictions is still empty, proceed
                    that.state = (!bounds.length || $.inArray(type, bounds) !== -1) ? true : false;

                    // check if we have a parent restriction
                    if (parent_bounds.length) {
                        that.state = ($.inArray(immediateParentType, parent_bounds) !== -1) ? true : false;
                    }

                    return that.state;
                }
            }).on('cms.update', actualizeEmptyPlaceholders);
        }

    });

    /**
     * Similar to CMS.Plugin populates globally required
     * variables, that only need querying once, e.g. placeholders.
     *
     * @method _initializeGlobalHandlers
     * @static
     * @private
     */
    CMS.StructureBoard._initializeGlobalHandlers = function _initializeGlobalHandlers() {
        placeholders = $('.cms-dragarea:not(.cms-clipboard-containers)');
    };

    // shorthand for jQuery(document).ready();
    $(CMS.StructureBoard._initializeGlobalHandlers);

})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

// #############################################################################
// Toolbar
(function ($) {
    'use strict';

    /**
     * Responsible for creating usable navigation for narrow screens.
     *
     * @class Navigation
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.Navigation = new CMS.Class({

        implement: [CMS.API.Helpers],

        initialize: function initialize() {
            this._setupUI();
            this._getWidths();

            /**
             * The zero based index of the right-most visible menu item of the left toolbar part.
             *
             * @property rightMostItemIndex {Number}
             */
            this.rightMostItemIndex = this.items.left.length - 1;

            /**
             * The zero based index of the left-most visible item of the right toolbar part.
             *
             * @property leftMostItemIndex {Number}
             */
            this.leftMostItemIndex = 0;

            this.resize = 'resize.cms.navigation';
            this.load = 'load.cms.navigation';
            this.orientationChange = 'orientationchange.cms.navigation';

            this._events();
        },

        /**
         * Cache UI jquery objects.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var container = $('.cms');
            var trigger = container.find('.cms-toolbar-more');
            this.ui = {
                window: $(window),
                toolbarLeftPart: container.find('.cms-toolbar-left'),
                toolbarRightPart: container.find('.cms-toolbar-right'),
                trigger: trigger,
                dropdown: trigger.find('> ul'),
                toolbarTrigger: container.find('.cms-toolbar-trigger'),
                logo: container.find('.cms-toolbar-item-logo')
            };
        },

        /**
         * Setup resize handler to construct the dropdown.
         *
         * @method _events
         * @private
         */
        _events: function _events() {
            this.ui.window.on(
                [this.resize, this.load, this.orientationChange].join(' '),
                CMS.API.Helpers.throttle(
                    this._handleResize.bind(this), 50
                )
            );
        },

        /**
         * Calculates all the movable menu items widths.
         *
         * @method _getWidths
         * @private
         */
        _getWidths: function _getWidths() {
            var that = this;
            that.items = {
                left: [],
                leftTotalWidth: 0,
                right: [],
                rightTotalWidth: 0,
                moreButtonWidth: 0
            };
            var leftItems = that.ui.toolbarLeftPart
                .find('.cms-toolbar-item-navigation > li:not(.cms-toolbar-more)');
            var rightItems = that.ui.toolbarRightPart.find('> .cms-toolbar-item');

            var getSize = function getSize(el, store) {
                var element = $(el);
                var width = $(el).outerWidth(true);

                store.push({
                    element: element,
                    width: width
                });
            };
            var sumWidths = function sumWidths(sum, item) {
                return sum + item.width;
            };

            leftItems.each(function () {
                getSize(this, that.items.left);
            });

            rightItems.each(function () {
                getSize(this, that.items.right);
            });

            that.items.leftTotalWidth = that.items.left.reduce(sumWidths, 0);
            that.items.rightTotalWidth = that.items.right.reduce(sumWidths, 0);
            that.items.moreButtonWidth = that.ui.trigger.outerWidth();
        },

        /**
         * Calculates available width based on the state of the page.
         *
         * @method _calculateAvailableWidth
         * @private
         * @return {Number} available width in px
         */
        _calculateAvailableWidth: function _calculateAvailableWidth() {
            var fullWidth = this.ui.window.width();
            var reduce = parseInt(this.ui.toolbarRightPart.css('padding-right'), 10) + this.ui.logo.offset().left +
                this.ui.logo.outerWidth(true) + 15;

            return fullWidth - reduce;
        },

        /**
         * Shows the dropdown.
         *
         * @method _showDropdown
         * @private
         */
        _showDropdown: function _showDropdown() {
            this.ui.trigger.css('display', 'list-item');
        },

        /**
         * Hides the dropdown.
         *
         * @method _hideDropdown
         * @private
         */
        _hideDropdown: function _hideDropdown() {
            this.ui.trigger.css('display', 'none');
        },

        /**
         * Figures out if we need to show/hide/modify the dropdown.
         *
         * @method _handleResize
         * @private
         */
        _handleResize: function _handleResize() {
            var remainingWidth;
            var availableWidth = this._calculateAvailableWidth();

            if (availableWidth > this.items.leftTotalWidth + this.items.rightTotalWidth) {
                this._showAll();
            } else {
                // first handle the left part
                remainingWidth = availableWidth - this.items.moreButtonWidth - this.items.rightTotalWidth;

                // Figure out how many nav menu items fit into the available space.
                var newRightMostItemIndex = -1;
                while (remainingWidth - this.items.left[newRightMostItemIndex + 1].width >= 0) {
                    remainingWidth -= this.items.left[newRightMostItemIndex + 1].width;
                    newRightMostItemIndex++;
                }

                if (newRightMostItemIndex < this.rightMostItemIndex) {
                    this._moveToDropdown(this.rightMostItemIndex - newRightMostItemIndex);
                } else if (this.rightMostItemIndex < newRightMostItemIndex) {
                    this._moveOutOfDropdown(newRightMostItemIndex - this.rightMostItemIndex);
                }

                this._showDropdown();

                // if we do not have any width left and all the items from the left part
                // are already in the dropdown - start with the right part
                if (remainingWidth < 0 && this.rightMostItemIndex === -1) {
                    remainingWidth += this.items.rightTotalWidth;

                    var newLeftMostItemIndex = this.items.right.length;
                    // istanbul ignore if: this moves items to the right one by one
                    if (false) {
                        // if you want to move items from the right one by one
                        while (remainingWidth - this.items.right[newLeftMostItemIndex - 1].width > 0) {
                            remainingWidth -= this.items.right[newLeftMostItemIndex - 1].width;
                            newLeftMostItemIndex--;
                        }

                        if (newLeftMostItemIndex > this.leftMostItemIndex) {
                            this._moveToDropdown(newLeftMostItemIndex - this.leftMostItemIndex, 'right');
                        } else if (newLeftMostItemIndex < this.leftMostItemIndex) {
                            this._moveOutOfDropdown(this.leftMostItemIndex - newLeftMostItemIndex, 'right');
                        }
                    } else {
                        // but for now we want to move all of them immediately
                        this._moveToDropdown(newLeftMostItemIndex - this.leftMostItemIndex, 'right');
                        this.ui.dropdown.addClass('cms-more-dropdown-full');
                    }
                } else {
                    this._showAllRight();
                    this.ui.dropdown.removeClass('cms-more-dropdown-full');
                }
            }
        },

        /**
         * Hides and empties dropdown.
         *
         * @method _showAll
         * @private
         */
        _showAll: function _showAll() {
            this._showAllLeft();
            this._showAllRight();
            this._hideDropdown();
        },

        /**
         * Show all items in the left part of the toolbar.
         *
         * @method _showAllLeft
         * @private
         */
        _showAllLeft: function _showAllLeft() {
            this._moveOutOfDropdown((this.items.left.length - 1) - this.rightMostItemIndex);
        },

        /**
         * Show all items in the right part of the toolbar.
         *
         * @method _showAllRight
         * @private
         */
        _showAllRight: function _showAllRight() {
            this._moveOutOfDropdown(this.leftMostItemIndex, 'right');
        },

        /**
         * Moves items into the dropdown, reducing menu right-to-left in case it's a left part of toolbar
         * and left-to-right if it's right one.
         *
         * @method _moveToDropdown
         * @private
         * @param {Number} numberOfItems how many items to move to dropdown
         * @param {String} part from which part to move to dropdown (defaults to left)
         */
        _moveToDropdown: function _moveToDropdown(numberOfItems, part) {
            if (numberOfItems <= 0) {
                return;
            }

            var item;
            var leftMostIndexToMove;
            var rightMostIndexToMove;
            var i;

            if (part === 'right') {
                // Move items (working left-to-right) from the toolbar left part to the more menu.
                leftMostIndexToMove = this.leftMostItemIndex;
                rightMostIndexToMove = this.leftMostItemIndex + numberOfItems - 1;
                for (i = leftMostIndexToMove; i <= rightMostIndexToMove; i++) {
                    item = this.items.right[i].element;

                    this.ui.dropdown.prepend(item.wrap('<li class="cms-more-buttons"></li>').parent());
                }

                this.leftMostItemIndex += numberOfItems;
            } else {
                // Move items (working right-to-left) from the toolbar left part to the more menu.
                rightMostIndexToMove = this.rightMostItemIndex;
                leftMostIndexToMove = this.rightMostItemIndex - numberOfItems + 1;
                for (i = rightMostIndexToMove; i >= leftMostIndexToMove; i--) {
                    item = this.items.left[i].element;

                    this.ui.dropdown.prepend(item);
                    if (item.find('> ul').children().length) {
                        item.addClass('cms-toolbar-item-navigation-children');
                    }
                }

                this.rightMostItemIndex -= numberOfItems;
            }
        },

        /**
         * Moves items out of the dropdown.
         *
         * @method _moveOutOfDropdown
         * @private
         * @param {Number} numberOfItems how many items to move out of the dropdown
         * @param {String} part to which part to move out of dropdown (defaults to left)
         */
        _moveOutOfDropdown: function _moveOutOfDropdown(numberOfItems, part) {
            if (numberOfItems <= 0) {
                return;
            }

            var i;
            var item;
            var leftMostIndexToMove;
            var rightMostIndexToMove;

            if (part === 'right') {
                // Move items (working bottom-to-top) from the more menu into the toolbar right part.
                rightMostIndexToMove = this.leftMostItemIndex - 1;
                leftMostIndexToMove = this.leftMostItemIndex - numberOfItems;

                for (i = rightMostIndexToMove; i >= leftMostIndexToMove; i--) {
                    item = this.items.right[i].element;
                    item.unwrap('<li></li>');

                    item.prependTo(this.ui.toolbarRightPart);
                }

                this.leftMostItemIndex -= numberOfItems;
            } else {
                // Move items (working top-to-bottom) from the more menu into the toolbar left part.
                leftMostIndexToMove = this.rightMostItemIndex + 1;
                rightMostIndexToMove = this.rightMostItemIndex + numberOfItems;

                for (i = leftMostIndexToMove; i <= rightMostIndexToMove; i++) {
                    item = this.items.left[i].element;

                    item.insertBefore(this.ui.trigger);
                    item.removeClass('cms-toolbar-item-navigation-children');
                    item.find('> ul').removeAttr('style');
                }

                this.rightMostItemIndex += numberOfItems;
            }
        }

    });
})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
/* istanbul ignore next */
var CMS = window.CMS || {};

// #############################################################################
// Toolbar
(function ($) {
    'use strict';

    /**
     * The toolbar is the generic element which holds various components
     * together and provides several commonly used API methods such as
     * show/hide, message display or loader indication.
     *
     * @class Toolbar
     * @namespace CMS
     * @uses CMS.API.Helpers
     */
    CMS.Toolbar = new CMS.Class({

        implement: [CMS.API.Helpers],

        options: {
            toolbarDuration: 200
        },

        initialize: function initialize(options) {
            this.options = $.extend(true, {}, this.options, options);

            // elements
            this._setupUI();

            /**
             * @property {CMS.Navigation} navigation
             */
            this.navigation = new CMS.Navigation();

            /**
             * @property {Object} _position
             * @property {Number} _position.top current position of the toolbar
             * @property {Number} _position.top position when toolbar became non-sticky
             * @property {Boolean} _position.isSticky is toolbar sticky?
             * @see _handleLongMenus
             * @private
             */
            this._position = {
                top: 0,
                stickyTop: 0,
                isSticky: true
            };

            // states
            this.click = 'click.cms.toolbar';
            this.touchStart = 'touchstart.cms.toolbar';
            this.pointerUp = 'pointerup.cms.toolbar';
            this.pointerOverOut = 'pointerover.cms.toolbar pointerout.cms.toolbar';
            this.pointerLeave = 'pointerleave.csm.toolbar';
            this.mouseEnter = 'mouseenter.cms.toolbar';
            this.mouseLeave = 'mouseleave.cms.toolbar';
            this.resize = 'resize.cms.toolbar';
            this.scroll = 'scroll.cms.toolbar';
            this.key = 'keydown.cms.toolbar keyup.cms.toolbar';

            // istanbul ignore next: function is always reassigned
            this.timer = function () {};
            this.lockToolbar = false;

            // setup initial stuff
            if (!this.ui.toolbar.data('ready')) {
                this._events();
            }

            // FIXME the general initialization is handled within the toolbar
            // rather than a separate cms.setup or similar. Yet other components
            // are loaded after the toolbar so it can create a clash where
            // CMS.API is not ready. This is a workaround until a proper fix
            // will be released in 3.x
            var that = this;
            setTimeout(function () {
                that._initialStates();
            }, 200);

            // set a state to determine if we need to reinitialize this._events();
            this.ui.toolbar.data('ready', true);
        },

        /**
         * Stores all jQuery references within `this.ui`.
         *
         * @method _setupUI
         * @private
         */
        _setupUI: function _setupUI() {
            var container = $('.cms');
            this.ui = {
                container: container,
                body: $('html'),
                document: $(document),
                window: $(window),
                toolbar: container.find('.cms-toolbar'),
                toolbarTrigger: container.find('.cms-toolbar-trigger'),
                navigations: container.find('.cms-toolbar-item-navigation'),
                buttons: container.find('.cms-toolbar-item-buttons'),
                messages: container.find('.cms-messages'),
                screenBlock: container.find('.cms-screenblock'),
                structureBoard: container.find('.cms-structure')
            };
        },

        /**
         * Sets up all the event handlers, such as closing and resizing.
         *
         * @method _events
         * @private
         */
        _events: function _events() {
            var that = this;

            // attach event to the trigger handler
            this.ui.toolbarTrigger.on(this.pointerUp, function (e) {
                e.preventDefault();
                that.toggle();
                that.ui.document.trigger(that.click);
            }).on(this.click, function (e) {
                e.preventDefault();
            });

            // attach event to the navigation elements
            this.ui.navigations.each(function () {
                var navigation = $(this);
                var lists = navigation.find('li');
                var root = 'cms-toolbar-item-navigation';
                var hover = 'cms-toolbar-item-navigation-hover';
                var disabled = 'cms-toolbar-item-navigation-disabled';
                var children = 'cms-toolbar-item-navigation-children';
                var isTouchingTopLevelMenu = false;
                var open = false;
                var cmdPressed = false;

                // removes classes and events
                function reset() {
                    open = false;
                    cmdPressed = false;
                    lists.removeClass(hover);
                    lists.find('ul ul').hide();
                    navigation.find('> li').off(that.mouseEnter);
                    that.ui.document.off(that.click);
                    that.ui.toolbar.off(that.click, reset);
                    that.ui.structureBoard.off(that.click);
                    that.ui.window.off(that.resize + '.menu.reset');
                    that._handleLongMenus();
                }

                // remove events from first level
                navigation.find('a').on(that.click + ' ' + that.key, function (e) {
                    var el = $(this);
                    // we need to restore the default behaviour once a user
                    // presses ctrl/cmd and clicks on the entry. In this
                    // case a new tab should open. First we determine if
                    // ctrl/cmd is pressed:
                    if (
                        e.keyCode === CMS.KEYS.CMD_LEFT ||
                        e.keyCode === CMS.KEYS.CMD_RIGHT ||
                        e.keyCode === CMS.KEYS.CMD_FIREFOX ||
                        e.keyCode === CMS.KEYS.SHIFT ||
                        e.keyCode === CMS.KEYS.CTRL
                    ) {
                        cmdPressed = true;
                    }
                    if (e.type === 'keyup') {
                        cmdPressed = false;
                    }

                    if (el.attr('href') !== '' &&
                        el.attr('href') !== '#' &&
                        !el.parent().hasClass(disabled)) {

                        if (cmdPressed) {
                            // control the behaviour when ctrl/cmd is pressed
                            CMS.API.Helpers._getWindow().open(el.attr('href'), '_blank');
                        } else {
                            // otherwise delegate as usual
                            that._delegate($(this));
                        }

                        reset();
                        return false;
                    }

                }).on(that.touchStart, function () {
                    isTouchingTopLevelMenu = true;
                });

                // handle click states
                lists.on(that.click, function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    var el = $(this);

                    // close navigation once it's pressed again
                    if (el.parent().hasClass(root) && open) {
                        that.ui.body.trigger(that.click);
                        return false;
                    }

                    // close if el does not have children
                    if (!el.hasClass(children)) {
                        reset();
                    }

                    if (el.parent().hasClass(root) && el.hasClass(hover) || el.hasClass(disabled)) {
                        return false;
                    } else {
                        el.addClass(hover);
                        that._handleLongMenus();
                    }

                    // activate hover selection
                    if (!isTouchingTopLevelMenu) {
                        // we only set the handler for mouseover when not touching because
                        // the mouseover actually is triggered on touch devices :/
                        navigation.find('> li').on(that.mouseEnter, function () {
                            // cancel if item is already active
                            if ($(this).hasClass(hover)) {
                                return false;
                            }
                            open = false;
                            $(this).trigger(that.click);
                        });
                    }

                    isTouchingTopLevelMenu = false;
                    // create the document event
                    that.ui.document.on(that.click, reset);
                    that.ui.structureBoard.on(that.click, reset);
                    that.ui.toolbar.on(that.click, reset);
                    that.ui.window.on(that.resize + '.menu.reset', CMS.API.Helpers.throttle(reset, 1000));
                    // update states
                    open = true;
                });

                // attach hover
                lists.on(that.pointerOverOut, 'li', function () {
                    var el = $(this);
                    var parent = el.closest('.cms-toolbar-item-navigation-children')
                        .add(el.parents('.cms-toolbar-item-navigation-children'));
                    var hasChildren = el.hasClass(children) || parent.length;

                    // do not attach hover effect if disabled
                    // cancel event if element has already hover class
                    if (el.hasClass(disabled)) {
                        return false;
                    }
                    if (el.hasClass(hover)) {
                        return true;
                    }

                    // reset
                    lists.find('li').removeClass(hover);

                    // add hover effect
                    el.addClass(hover);

                    // handle children elements
                    if (hasChildren) {
                        el.find('> ul').show();
                        // add parent class
                        parent.addClass(hover);
                        that._handleLongMenus();
                    } else {
                        lists.find('ul ul').hide();
                        that._handleLongMenus();
                    }

                    // Remove stale submenus
                    el.siblings().find('> ul').hide();
                }).on(that.click, function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                });

                // fix leave event
                lists.on(that.pointerLeave, '> ul', function () {
                    lists.find('li').removeClass(hover);
                });
            });

            // attach event for first page publish
            this.ui.buttons.each(function () {
                var btn = $(this);

                // in case the button has a data-rel attribute
                if (btn.find('a').attr('data-rel')) {
                    btn.on(that.click, function (e) {
                        e.preventDefault();
                        that._delegate($(this).find('a'));
                    });
                } else {
                    btn.find('a').on(that.click, function (e) {
                        e.stopPropagation();
                    });
                }

                // in case of the publish button
                btn.find('.cms-publish-page').on(that.click, function (e) {
                    if (!CMS.API.Helpers.secureConfirm(CMS.config.lang.publish)) {
                        e.preventDefault();
                    }
                });

                btn.find('.cms-btn-publish').on(that.click, function (e) {
                    e.preventDefault();
                    // send post request to prevent xss attacks
                    $.ajax({
                        'type': 'post',
                        'url': $(this).prop('href'),
                        'data': {
                            'csrfmiddlewaretoken': CMS.config.csrf
                        },
                        'success': function () {
                            var url = CMS.API.Helpers.makeURL(
                                CMS.API.Helpers._getWindow().location.href.split('?')[0],
                                [CMS.settings.edit_off + '=true']
                            );
                            CMS.API.Helpers.reloadBrowser(url);
                        },
                        'error': function (request) {
                            throw new Error(request);
                        }
                    });
                });

            });
            this.ui.window.on(
                [this.resize, this.scroll].join(' '),
                CMS.API.Helpers.throttle($.proxy(this._handleLongMenus, this), 10)
            );
        },

        /**
         * We check for various states on load if elements in the toolbar
         * should appear or trigger other components. This precedes a timeout
         * which is not optimal and should be addressed separately.
         *
         * @method _initialStates
         * @private
         * @deprecated this method is deprecated now, it will be removed in > 3.2
         */
        _initialStates: function _initialStates() {
            var publishBtn = $('.cms-btn-publish').parent();

            // setup toolbar visibility, we need to reverse the options to set the correct state
            if (CMS.settings.toolbar === 'expanded') {
                this.open({ duration: 0 });
            } else {
                this.close();
            }

            // hide publish button
            publishBtn.hide();

            if ($('.cms-btn-publish-active').length) {
                publishBtn.show();
                this.ui.window.trigger('resize');
            }

            // check if debug is true
            if (CMS.config.debug) {
                this._debug();
            }

            // check if there are messages and display them
            if (CMS.config.messages) {
                CMS.API.Messages.open({
                    message: CMS.config.messages
                });
            }

            // check if there are error messages and display them
            if (CMS.config.error) {
                CMS.API.Messages.open({
                    message: CMS.config.error,
                    error: true
                });
            }

            // enforce open state if user is not logged in but requests the toolbar
            if (!CMS.config.auth || CMS.config.settings.version !== CMS.settings.version) {
                this.open({ duration: 0 });
                CMS.settings = this.setSettings(CMS.config.settings);
            }

            // should switcher indicate that there is an unpublished page?
            if (CMS.config.publisher) {
                CMS.API.Messages.open({
                    message: CMS.config.publisher,
                    dir: 'right'
                });
            }

            // open sideframe if it was previously opened
            if (CMS.settings.sideframe && CMS.settings.sideframe.url) {
                var sideframe = new CMS.Sideframe();
                sideframe.open({
                    url: CMS.settings.sideframe.url,
                    animate: false
                });
            }

            // if there is a screenblock, do some resize magic
            if (this.ui.screenBlock.length) {
                this._screenBlock();
            }

            // add toolbar ready class to body and fire event
            this.ui.body.addClass('cms-ready');
            this.ui.document.trigger('cms-ready');
        },

        /**
         * Toggles the toolbar state: open > closes / closed > opens.
         *
         * @method toggle
         */
        toggle: function toggle() {
            // toggle bar
            if (CMS.settings.toolbar === 'collapsed') {
                this.open();
            } else {
                this.close();
            }
        },

        /**
         * Opens the toolbar (slide down).
         *
         * @method open
         * @param {Object} [opts]
         * @param {Number} [opts.duration] time in milliseconds for toolbar to animate
         */
        open: function open(opts) {
            this._show(opts);

            // set new settings
            CMS.settings.toolbar = 'expanded';
            CMS.settings = this.setSettings(CMS.settings);
        },

        /**
         * Animation helper for opening the toolbar.
         *
         * @method _show
         * @private
         * @param {Object} [opts]
         * @param {Number} [opts.duration] time in milliseconds for toolbar to animate
         */
        _show: function _show(opts) {
            var that = this;
            var speed = opts && opts.duration !== undefined ? opts.duration : this.options.toolbarDuration;
            var debugHeight = $('.cms-debug-bar').height() || 0;
            var toolbarHeight = $('.cms-toolbar').height() + 10;

            this.ui.toolbar.css({
                'transition': 'margin-top ' + speed + 'ms',
                'margin-top': 0
            });
            this.ui.toolbarTrigger.addClass('cms-toolbar-trigger-expanded');
            this.ui.body.addClass('cms-toolbar-expanding');
            // animate html
            this.ui.body.animate({ 'margin-top': toolbarHeight - 10 + debugHeight }, speed, 'linear', function () {
                that.ui.body.removeClass('cms-toolbar-expanding');
                that.ui.body.addClass('cms-toolbar-expanded');
            });
            // set messages top to toolbar height
            this.ui.messages.css('top', toolbarHeight - 10);
        },

        /**
         * Closes the toolbar (slide up).
         *
         * @method close
         */
        close: function close() {
            this._hide();

            // set new settings
            CMS.settings.toolbar = 'collapsed';
            CMS.settings = this.setSettings(CMS.settings);
        },

        /**
         * Animation helper for closing the toolbar.
         *
         * @method _hide
         * @private
         */
        _hide: function _hide() {
            var speed = this.options.toolbarDuration;
            var toolbarHeight = $('.cms-toolbar').height() + 10;
            var that = this;

            this.ui.toolbar.css('transition', 'margin-top ' + speed + 'ms');
            // cancel if sideframe is active
            if (this.lockToolbar) {
                return false;
            }

            this.ui.toolbar.css('margin-top', -toolbarHeight);
            this.ui.toolbarTrigger.removeClass('cms-toolbar-trigger-expanded');
            this.ui.body.addClass('cms-toolbar-collapsing');
            // animate html
            this.ui.body.animate({ 'margin-top': (CMS.config.debug) ? 5 : 0 }, speed, 'linear', function () {
                that.ui.body.removeClass('cms-toolbar-expanded cms-toolbar-collapsing');
            });
            // set messages top to 0
            this.ui.messages.css('top', 0);
        },

        /**
         * Makes a request to the given url, runs optional callbacks.
         *
         * @method openAjax
         * @param {Object} opts
         * @param {String} opts.url url where the ajax points to
         * @param {String} [opts.post] post data to be passed (must be stringified JSON)
         * @param {String} [opts.text] message to be displayed
         * @param {Function} [opts.callback] custom callback instead of reload
         * @param {String} [opts.onSuccess] reload and display custom message
         * @return {Boolean|jQuery.Deferred} either false or a promise
         */
        openAjax: function (opts) {
            var that = this;
            // url, post, text, callback, onSuccess
            var url = opts.url;
            var post = opts.post || '{}';
            var text = opts.text || '';
            var callback = opts.callback;
            var onSuccess = opts.onSuccess;
            var question = (text) ? CMS.API.Helpers.secureConfirm(text) : true;

            // cancel if question has been denied
            if (!question) {
                return false;
            }

            // set loader
            this.showLoader();

            return $.ajax({
                type: 'POST',
                url: url,
                data: JSON.parse(post)
            }).done(function (response) {
                CMS.API.locked = false;

                if (callback) {
                    callback(that, response);
                    that.hideLoader();
                } else if (onSuccess) {
                    CMS.API.Helpers.reloadBrowser(onSuccess, false, true);
                } else {
                    // reload
                    CMS.API.Helpers.reloadBrowser(false, false, true);
                }
            }).fail(function (jqXHR) {
                CMS.API.locked = false;

                CMS.API.Messages.open({
                    message: jqXHR.responseText + ' | ' + jqXHR.status + ' ' + jqXHR.statusText,
                    error: true
                });
            });
        },

        /**
         * Shows the loader spinner on the trigger knob for the toolbar.
         *
         * @method showLoader
         */
        showLoader: function showLoader() {
            this.ui.toolbarTrigger.addClass('cms-toolbar-loader');
        },

        /**
         * Hides the loader spinner on the trigger knob for the toolbar.
         *
         * @method hideLoader
         */
        hideLoader: function hideLoader() {
            this.ui.toolbarTrigger.removeClass('cms-toolbar-loader');
        },

        /**
         * Delegates event from element to appropriate functionalities.
         *
         * @method _delegate
         * @param {jQuery} el trigger element
         * @private
         */
        _delegate: function _delegate(el) {
            // save local vars
            var target = el.data('rel');
            if (el.hasClass('cms-btn-disabled')) {
                return false;
            }

            switch (target) {
                case 'modal':
                    var modal = new CMS.Modal({
                        onClose: el.data('on-close')
                    });
                    modal.open({
                        url: el.attr('href'),
                        title: el.data('name')
                    });
                    break;
                case 'message':
                    CMS.API.Messages.open({
                        message: el.data('text')
                    });
                    break;
                case 'sideframe':
                    var sideframe = new CMS.Sideframe({
                        onClose: el.data('on-close')
                    });
                    sideframe.open({
                        url: el.attr('href'),
                        animate: true
                    });
                    break;
                case 'ajax':
                    this.openAjax({
                        url: el.attr('href'),
                        post: JSON.stringify(el.data('post')),
                        text: el.data('text'),
                        onSuccess: el.data('on-success')
                    });
                    break;
                default:
                    CMS.API.Helpers._getWindow().location.href = el.attr('href');
            }
        },

        /**
         * Locks the toolbar so it cannot be closed.
         *
         * @method _lock
         * @param {Boolean} lock true if the toolbar should be locked
         * @private
         */
        _lock: function _lock(lock) {
            if (lock) {
                this.lockToolbar = true;
                // make button look disabled
                this.ui.toolbarTrigger.css('opacity', 0.2);
            } else {
                this.lockToolbar = false;
                // make button look disabled
                this.ui.toolbarTrigger.css('opacity', 1);
            }
        },

        /**
         * Handles the debug bar when `DEBUG=true` on top of the toolbar.
         *
         * @method _debug
         * @private
         */
        _debug: function _debug() {
            var timeout = 1000;
            // istanbul ignore next: function always reassigned
            var timer = function () {};

            // bind message event
            var debug = this.ui.container.find('.cms-debug-bar');
            debug.on(this.mouseEnter + ' ' + this.mouseLeave, function (e) {
                clearTimeout(timer);

                if (e.type === 'mouseenter') {
                    timer = setTimeout(function () {
                        CMS.API.Messages.open({
                            message: CMS.config.lang.debug
                        });
                    }, timeout);
                }
            });
        },

        /**
         * This shows a dark screen with a note "This page is a redirect"
         * on a page where the settings have been modified to redirect to
         * another page.
         *
         * @method _screenBlock
         * @private
         */
        _screenBlock: function _screenBlock() {
            var that = this;
            var interval = 20;
            var blocker = this.ui.screenBlock;
            var sideframe = $('.cms-sideframe');

            // automatically resize screenblock window according to given attributes
            that.ui.window.on(that.resize + '.screenblock', function () {
                blocker.css({
                    'width': that.ui.window.width() - sideframe.width(),
                    'height': that.ui.window.height()
                });
            }).trigger(that.resize + '.screenblock');

            // set update interval
            setInterval(function () {
                that.ui.window.trigger(that.resize + '.screenblock');
            }, interval);
        },

        /**
         * Handles the case when opened menu doesn't fit the screen.
         *
         * @method _handleLongMenus
         * @private
         */
        _handleLongMenus: function _handleLongMenus() {
            var openMenus = $('.cms-toolbar-item-navigation-hover > ul');
            if (!openMenus.length) {
                this._stickToolbar();
                return;
            }

            var positions = openMenus.toArray().map(function (item) {
                var el = $(item);

                return $.extend({}, el.position(), { height: el.height() });
            });
            var windowHeight = this.ui.window.height();

            this._position.top = this.ui.window.scrollTop();

            var shouldUnstickToolbar = positions.some(function (item) {
                return item.top + item.height > windowHeight;
            });

            if (shouldUnstickToolbar && this._position.top >= this._position.stickyTop) {
                if (this._position.isSticky) {
                    this._unstickToolbar();
                }
            } else {
                this._stickToolbar();
            }
        },

        /**
         * Resets toolbar to the normal position.
         *
         * @method _stickToolbar
         * @private
         */
        _stickToolbar: function _stickToolbar() {
            this._position.stickyTop = 0;
            this._position.isSticky = true;
            this.ui.toolbar.removeClass('cms-toolbar-non-sticky');
            this.ui.toolbar.css({
                'top': 0,
                'margin-top': ''
            });
        },

        /**
         * Positions toolbar absolutely so the long menus can be scrolled
         * (toolbar goes away from the screen if required)
         *
         * @method _unstickToolbar
         * @private
         */
        _unstickToolbar: function _unstickToolbar() {
            var htmlMargin = parseInt($('html').css('margin-top'), 10);

            this._position.stickyTop = this._position.top;
            this.ui.toolbar.addClass('cms-toolbar-non-sticky');
            // have to do the !important because of "debug" toolbar
            this.ui.toolbar[0].style.setProperty(
                'top',
                (this._position.stickyTop + (CMS.config.debug ? 5 : -5)) + 'px',
                'important'
            );
            this.ui.toolbar.css({
                'margin-top': -(htmlMargin + ((CMS.config.debug ? 5 : 0)))
            });
            this._position.isSticky = false;
        }
    });
})(CMS.$);

/*
 * Copyright https://github.com/divio/django-cms
 */

// #############################################################################
// NAMESPACES
/**
 * @module CMS
 */
var CMS = window.CMS || {};

// #############################################################################
// Tooltip
(function ($) {
    'use strict';

    /**
     * The tooltip is the element which shows over plugins
     * and suggests clicking/tapping them to edit.
     *
     * @class Tooltip
     * @namespace CMS
     */
    CMS.Tooltip = new CMS.Class({

        initialize: function initialize() {
            this.body = $('body');
            /**
             * Are we on touch device?
             *
             * @property {Boolean} isTouch
             */
            this.isTouch = false;
            /**
             * Tooltip DOM element
             *
             * @property {jQuery} domElem
             */
            this.domElem = this._pick();

            this._forceTouchOnce = CMS.API.Helpers.once(this._forceTouch);
            this._checkTouch();
        },

        /**
         * Checks for touch event and switches to touch tooltip if detected.
         *
         * @method _checkTouch
         * @private
         */
        _checkTouch: function _checkTouch() {
            this.body.one('touchstart.cms', $.proxy(this._forceTouchOnce, this));
        },

        /**
         * Force tooltip to be "touch".
         *
         * @method _forceTouch
         * @private
         */
        _forceTouch: function _forceTouch() {
            this.isTouch = true;
            this.domElem = this._pick();

            // attach tooltip event for touch devices
            this.domElem.on('touchstart.cms', function () {
                var id = $(this).data('plugin_id');
                var plugin = $('.cms-plugin-' + id);
                // check if it is a normal plugin or a generic
                if (plugin.length) {
                    plugin.trigger('dblclick.cms');
                } else {
                    // generics are added through the content mode via special
                    // template tags some generic element might be
                    // cms-plugin-cms-page-changelist-x
                    var generic = $('.cms-plugin[class*="cms-plugin-cms-"][class*="-' + id + '"]');
                    generic.eq(0).trigger('dblclick.cms');
                }
            });
        },

        /**
         * Manages show/hide calls.
         *
         * @method displayToggle
         * @param {Boolean} isShown
         * @param {Object} e event object
         * @param {String} name current plugin name
         * @param {String} id current plugin id
         */
        displayToggle: function displayToggle(isShown, e, name, id) {
            isShown ? this.show(e, name, id) : this.hide();
        },

        /**
         * Shows tooltip with specific plugin-related parameters.
         *
         * @method show
         * @param {Object} e
         * @param {String} name current plugin name
         * @param {String} id current plugin id
         */
        show: function show(e, name, id) {
            var tooltip = this.domElem;
            var that = this;

            // change css and attributes
            tooltip.css('visibility', 'visible')
                .data('plugin_id', id || null)
                .show()
                .find('span').html(name);

            if (this.isTouch) {
                this.position(e.originalEvent, tooltip);
            } else {
                // attaches move event
                // this sets the correct position for the edit tooltip
                that.position(e.originalEvent, tooltip);
                this.body.on('mousemove.cms.tooltip', function (e) {
                    that.position(e, tooltip);
                });
            }
        },

        /**
         * Hides tooltip.
         *
         * @method hide
         */
        hide: function hide() {
            // change css
            this.domElem.css('visibility', 'hidden').hide();

            // unbind events
            if (!this.isTouch) {
                this.body.off('mousemove.cms.tooltip');
            }
        },

        /**
         * Picks tooltip to show (touch or desktop).
         *
         * @method _pick
         * @private
         */
        _pick: function _pick() {
            $('.cms-tooltip-touch, .cms-tooltip').css('visibility', 'hidden').hide();
            return this.isTouch ? $('.cms-tooltip-touch') : $('.cms-tooltip');
        },

        /**
         * Positions tooltip next to the pointer event coordinates.
         *
         * @method position
         * @param {Object} e event object
         * @param {jQuery} tooltip element
         */
        position: function position(e, tooltip) {
            // so lets figure out where we are
            var offset = 20;
            var relX = e.pageX - $(tooltip).offsetParent().offset().left;
            var relY = e.pageY - $(tooltip).offsetParent().offset().top;
            var bound = $(tooltip).offsetParent().width();
            var pos = relX + tooltip.outerWidth(true) + offset;

            tooltip.css({
                left: (pos >= bound) ? relX - tooltip.outerWidth(true) - offset : relX + offset,
                top: relY - 12
            });
        }
    });
})(CMS.$);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJpbmQuanMiLCJqcXVlcnkubWluLmpzIiwiY2xhc3MubWluLmpzIiwicGVwLmpzIiwianF1ZXJ5LnVpLmN1c3RvbS5qcyIsImpxdWVyeS51aS50b3VjaHB1bmNoLmpzIiwianF1ZXJ5LnVpLm5lc3RlZHNvcnRhYmxlLmpzIiwiY21zLmJhc2UuanMiLCJqcXVlcnkudHJhbnNpdGlvbi5qcyIsImNtcy5tZXNzYWdlcy5qcyIsImNtcy5tb2RhbC5qcyIsImNtcy5zaWRlZnJhbWUuanMiLCJjbXMuY2xpcGJvYXJkLmpzIiwiY21zLnBsdWdpbnMuanMiLCJjbXMuc3RydWN0dXJlYm9hcmQuanMiLCJjbXMubmF2aWdhdGlvbi5qcyIsImNtcy50b29sYmFyLmpzIiwiY21zLnRvb2x0aXAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BtQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdmxCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeGxDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNpQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ243Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbG5CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2V0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaHlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImJ1bmRsZS50b29sYmFyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBGdW5jdGlvbi5wcm90b3R5cGUuYmluZFxuXG5pZiAoIUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kKSB7XG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbihvVGhpcykge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIC8vIGNsb3Nlc3QgdGhpbmcgcG9zc2libGUgdG8gdGhlIEVDTUFTY3JpcHQgNVxuICAgICAgICAgICAgLy8gaW50ZXJuYWwgSXNDYWxsYWJsZSBmdW5jdGlvblxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgLSB3aGF0IGlzIHRyeWluZyB0byBiZSBib3VuZCBpcyBub3QgY2FsbGFibGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhQXJncyAgID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgICAgIGZUb0JpbmQgPSB0aGlzLFxuICAgICAgICAgICAgZk5PUCAgICA9IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICAgICBmQm91bmQgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZUb0JpbmQuYXBwbHkodGhpcyBpbnN0YW5jZW9mIGZOT1BcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBvVGhpcyxcbiAgICAgICAgICAgICAgICAgICAgYUFyZ3MuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRoaXMucHJvdG90eXBlKSB7XG4gICAgICAgICAgICAvLyBuYXRpdmUgZnVuY3Rpb25zIGRvbid0IGhhdmUgYSBwcm90b3R5cGVcbiAgICAgICAgICAgIGZOT1AucHJvdG90eXBlID0gdGhpcy5wcm90b3R5cGU7XG4gICAgICAgIH1cbiAgICAgICAgZkJvdW5kLnByb3RvdHlwZSA9IG5ldyBmTk9QKCk7XG5cbiAgICAgICAgcmV0dXJuIGZCb3VuZDtcbiAgICB9O1xufVxuIiwiLyohIGpRdWVyeSB2MS4xMS4zIHwgKGMpIDIwMDUsIDIwMTUgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gfCBqcXVlcnkub3JnL2xpY2Vuc2UgKi9cbiFmdW5jdGlvbihhLGIpe1wib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGUmJlwib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1hLmRvY3VtZW50P2IoYSwhMCk6ZnVuY3Rpb24oYSl7aWYoIWEuZG9jdW1lbnQpdGhyb3cgbmV3IEVycm9yKFwialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudFwiKTtyZXR1cm4gYihhKX06YihhKX0oXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6dGhpcyxmdW5jdGlvbihhLGIpe3ZhciBjPVtdLGQ9Yy5zbGljZSxlPWMuY29uY2F0LGY9Yy5wdXNoLGc9Yy5pbmRleE9mLGg9e30saT1oLnRvU3RyaW5nLGo9aC5oYXNPd25Qcm9wZXJ0eSxrPXt9LGw9XCIxLjExLjNcIixtPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBtLmZuLmluaXQoYSxiKX0sbj0vXltcXHNcXHVGRUZGXFx4QTBdK3xbXFxzXFx1RkVGRlxceEEwXSskL2csbz0vXi1tcy0vLHA9Ly0oW1xcZGEtel0pL2dpLHE9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYi50b1VwcGVyQ2FzZSgpfTttLmZuPW0ucHJvdG90eXBlPXtqcXVlcnk6bCxjb25zdHJ1Y3RvcjptLHNlbGVjdG9yOlwiXCIsbGVuZ3RoOjAsdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBkLmNhbGwodGhpcyl9LGdldDpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbCE9YT8wPmE/dGhpc1thK3RoaXMubGVuZ3RoXTp0aGlzW2FdOmQuY2FsbCh0aGlzKX0scHVzaFN0YWNrOmZ1bmN0aW9uKGEpe3ZhciBiPW0ubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLGEpO3JldHVybiBiLnByZXZPYmplY3Q9dGhpcyxiLmNvbnRleHQ9dGhpcy5jb250ZXh0LGJ9LGVhY2g6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbS5lYWNoKHRoaXMsYSxiKX0sbWFwOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhtLm1hcCh0aGlzLGZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEuY2FsbChiLGMsYil9KSl9LHNsaWNlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQuYXBwbHkodGhpcyxhcmd1bWVudHMpKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sZXE6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5sZW5ndGgsYz0rYSsoMD5hP2I6MCk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGM+PTAmJmI+Yz9bdGhpc1tjXV06W10pfSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wcmV2T2JqZWN0fHx0aGlzLmNvbnN0cnVjdG9yKG51bGwpfSxwdXNoOmYsc29ydDpjLnNvcnQsc3BsaWNlOmMuc3BsaWNlfSxtLmV4dGVuZD1tLmZuLmV4dGVuZD1mdW5jdGlvbigpe3ZhciBhLGIsYyxkLGUsZixnPWFyZ3VtZW50c1swXXx8e30saD0xLGk9YXJndW1lbnRzLmxlbmd0aCxqPSExO2ZvcihcImJvb2xlYW5cIj09dHlwZW9mIGcmJihqPWcsZz1hcmd1bWVudHNbaF18fHt9LGgrKyksXCJvYmplY3RcIj09dHlwZW9mIGd8fG0uaXNGdW5jdGlvbihnKXx8KGc9e30pLGg9PT1pJiYoZz10aGlzLGgtLSk7aT5oO2grKylpZihudWxsIT0oZT1hcmd1bWVudHNbaF0pKWZvcihkIGluIGUpYT1nW2RdLGM9ZVtkXSxnIT09YyYmKGomJmMmJihtLmlzUGxhaW5PYmplY3QoYyl8fChiPW0uaXNBcnJheShjKSkpPyhiPyhiPSExLGY9YSYmbS5pc0FycmF5KGEpP2E6W10pOmY9YSYmbS5pc1BsYWluT2JqZWN0KGEpP2E6e30sZ1tkXT1tLmV4dGVuZChqLGYsYykpOnZvaWQgMCE9PWMmJihnW2RdPWMpKTtyZXR1cm4gZ30sbS5leHRlbmQoe2V4cGFuZG86XCJqUXVlcnlcIisobCtNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cXEQvZyxcIlwiKSxpc1JlYWR5OiEwLGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IG5ldyBFcnJvcihhKX0sbm9vcDpmdW5jdGlvbigpe30saXNGdW5jdGlvbjpmdW5jdGlvbihhKXtyZXR1cm5cImZ1bmN0aW9uXCI9PT1tLnR5cGUoYSl9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuXCJhcnJheVwiPT09bS50eXBlKGEpfSxpc1dpbmRvdzpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbCE9YSYmYT09YS53aW5kb3d9LGlzTnVtZXJpYzpmdW5jdGlvbihhKXtyZXR1cm4hbS5pc0FycmF5KGEpJiZhLXBhcnNlRmxvYXQoYSkrMT49MH0saXNFbXB0eU9iamVjdDpmdW5jdGlvbihhKXt2YXIgYjtmb3IoYiBpbiBhKXJldHVybiExO3JldHVybiEwfSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGEpe3ZhciBiO2lmKCFhfHxcIm9iamVjdFwiIT09bS50eXBlKGEpfHxhLm5vZGVUeXBlfHxtLmlzV2luZG93KGEpKXJldHVybiExO3RyeXtpZihhLmNvbnN0cnVjdG9yJiYhai5jYWxsKGEsXCJjb25zdHJ1Y3RvclwiKSYmIWouY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSxcImlzUHJvdG90eXBlT2ZcIikpcmV0dXJuITF9Y2F0Y2goYyl7cmV0dXJuITF9aWYoay5vd25MYXN0KWZvcihiIGluIGEpcmV0dXJuIGouY2FsbChhLGIpO2ZvcihiIGluIGEpO3JldHVybiB2b2lkIDA9PT1ifHxqLmNhbGwoYSxiKX0sdHlwZTpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbD09YT9hK1wiXCI6XCJvYmplY3RcIj09dHlwZW9mIGF8fFwiZnVuY3Rpb25cIj09dHlwZW9mIGE/aFtpLmNhbGwoYSldfHxcIm9iamVjdFwiOnR5cGVvZiBhfSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJm0udHJpbShiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZShvLFwibXMtXCIpLnJlcGxhY2UocCxxKX0sbm9kZU5hbWU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yi50b0xvd2VyQ2FzZSgpfSxlYWNoOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlPTAsZj1hLmxlbmd0aCxnPXIoYSk7aWYoYyl7aWYoZyl7Zm9yKDtmPmU7ZSsrKWlmKGQ9Yi5hcHBseShhW2VdLGMpLGQ9PT0hMSlicmVha31lbHNlIGZvcihlIGluIGEpaWYoZD1iLmFwcGx5KGFbZV0sYyksZD09PSExKWJyZWFrfWVsc2UgaWYoZyl7Zm9yKDtmPmU7ZSsrKWlmKGQ9Yi5jYWxsKGFbZV0sZSxhW2VdKSxkPT09ITEpYnJlYWt9ZWxzZSBmb3IoZSBpbiBhKWlmKGQ9Yi5jYWxsKGFbZV0sZSxhW2VdKSxkPT09ITEpYnJlYWs7cmV0dXJuIGF9LHRyaW06ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PWE/XCJcIjooYStcIlwiKS5yZXBsYWNlKG4sXCJcIil9LG1ha2VBcnJheTpmdW5jdGlvbihhLGIpe3ZhciBjPWJ8fFtdO3JldHVybiBudWxsIT1hJiYocihPYmplY3QoYSkpP20ubWVyZ2UoYyxcInN0cmluZ1wiPT10eXBlb2YgYT9bYV06YSk6Zi5jYWxsKGMsYSkpLGN9LGluQXJyYXk6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2lmKGIpe2lmKGcpcmV0dXJuIGcuY2FsbChiLGEsYyk7Zm9yKGQ9Yi5sZW5ndGgsYz1jPzA+Yz9NYXRoLm1heCgwLGQrYyk6YzowO2Q+YztjKyspaWYoYyBpbiBiJiZiW2NdPT09YSlyZXR1cm4gY31yZXR1cm4tMX0sbWVyZ2U6ZnVuY3Rpb24oYSxiKXt2YXIgYz0rYi5sZW5ndGgsZD0wLGU9YS5sZW5ndGg7d2hpbGUoYz5kKWFbZSsrXT1iW2QrK107aWYoYyE9PWMpd2hpbGUodm9pZCAwIT09YltkXSlhW2UrK109YltkKytdO3JldHVybiBhLmxlbmd0aD1lLGF9LGdyZXA6ZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZCxlPVtdLGY9MCxnPWEubGVuZ3RoLGg9IWM7Zz5mO2YrKylkPSFiKGFbZl0sZiksZCE9PWgmJmUucHVzaChhW2ZdKTtyZXR1cm4gZX0sbWFwOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxmPTAsZz1hLmxlbmd0aCxoPXIoYSksaT1bXTtpZihoKWZvcig7Zz5mO2YrKylkPWIoYVtmXSxmLGMpLG51bGwhPWQmJmkucHVzaChkKTtlbHNlIGZvcihmIGluIGEpZD1iKGFbZl0sZixjKSxudWxsIT1kJiZpLnB1c2goZCk7cmV0dXJuIGUuYXBwbHkoW10saSl9LGd1aWQ6MSxwcm94eTpmdW5jdGlvbihhLGIpe3ZhciBjLGUsZjtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgYiYmKGY9YVtiXSxiPWEsYT1mKSxtLmlzRnVuY3Rpb24oYSk/KGM9ZC5jYWxsKGFyZ3VtZW50cywyKSxlPWZ1bmN0aW9uKCl7cmV0dXJuIGEuYXBwbHkoYnx8dGhpcyxjLmNvbmNhdChkLmNhbGwoYXJndW1lbnRzKSkpfSxlLmd1aWQ9YS5ndWlkPWEuZ3VpZHx8bS5ndWlkKyssZSk6dm9pZCAwfSxub3c6ZnVuY3Rpb24oKXtyZXR1cm4rbmV3IERhdGV9LHN1cHBvcnQ6a30pLG0uZWFjaChcIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3JcIi5zcGxpdChcIiBcIiksZnVuY3Rpb24oYSxiKXtoW1wiW29iamVjdCBcIitiK1wiXVwiXT1iLnRvTG93ZXJDYXNlKCl9KTtmdW5jdGlvbiByKGEpe3ZhciBiPVwibGVuZ3RoXCJpbiBhJiZhLmxlbmd0aCxjPW0udHlwZShhKTtyZXR1cm5cImZ1bmN0aW9uXCI9PT1jfHxtLmlzV2luZG93KGEpPyExOjE9PT1hLm5vZGVUeXBlJiZiPyEwOlwiYXJyYXlcIj09PWN8fDA9PT1ifHxcIm51bWJlclwiPT10eXBlb2YgYiYmYj4wJiZiLTEgaW4gYX12YXIgcz1mdW5jdGlvbihhKXt2YXIgYixjLGQsZSxmLGcsaCxpLGosayxsLG0sbixvLHAscSxyLHMsdCx1PVwic2l6emxlXCIrMSpuZXcgRGF0ZSx2PWEuZG9jdW1lbnQsdz0wLHg9MCx5PWhhKCksej1oYSgpLEE9aGEoKSxCPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGE9PT1iJiYobD0hMCksMH0sQz0xPDwzMSxEPXt9Lmhhc093blByb3BlcnR5LEU9W10sRj1FLnBvcCxHPUUucHVzaCxIPUUucHVzaCxJPUUuc2xpY2UsSj1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wLGQ9YS5sZW5ndGg7ZD5jO2MrKylpZihhW2NdPT09YilyZXR1cm4gYztyZXR1cm4tMX0sSz1cImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkXCIsTD1cIltcXFxceDIwXFxcXHRcXFxcclxcXFxuXFxcXGZdXCIsTT1cIig/OlxcXFxcXFxcLnxbXFxcXHctXXxbXlxcXFx4MDAtXFxcXHhhMF0pK1wiLE49TS5yZXBsYWNlKFwid1wiLFwidyNcIiksTz1cIlxcXFxbXCIrTCtcIiooXCIrTStcIikoPzpcIitMK1wiKihbKl4kfCF+XT89KVwiK0wrXCIqKD86JygoPzpcXFxcXFxcXC58W15cXFxcXFxcXCddKSopJ3xcXFwiKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcXFxcIl0pKilcXFwifChcIitOK1wiKSl8KVwiK0wrXCIqXFxcXF1cIixQPVwiOihcIitNK1wiKSg/OlxcXFwoKCgnKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcJ10pKiknfFxcXCIoKD86XFxcXFxcXFwufFteXFxcXFxcXFxcXFwiXSkqKVxcXCIpfCgoPzpcXFxcXFxcXC58W15cXFxcXFxcXCgpW1xcXFxdXXxcIitPK1wiKSopfC4qKVxcXFwpfClcIixRPW5ldyBSZWdFeHAoTCtcIitcIixcImdcIiksUj1uZXcgUmVnRXhwKFwiXlwiK0wrXCIrfCgoPzpefFteXFxcXFxcXFxdKSg/OlxcXFxcXFxcLikqKVwiK0wrXCIrJFwiLFwiZ1wiKSxTPW5ldyBSZWdFeHAoXCJeXCIrTCtcIiosXCIrTCtcIipcIiksVD1uZXcgUmVnRXhwKFwiXlwiK0wrXCIqKFs+K35dfFwiK0wrXCIpXCIrTCtcIipcIiksVT1uZXcgUmVnRXhwKFwiPVwiK0wrXCIqKFteXFxcXF0nXFxcIl0qPylcIitMK1wiKlxcXFxdXCIsXCJnXCIpLFY9bmV3IFJlZ0V4cChQKSxXPW5ldyBSZWdFeHAoXCJeXCIrTitcIiRcIiksWD17SUQ6bmV3IFJlZ0V4cChcIl4jKFwiK00rXCIpXCIpLENMQVNTOm5ldyBSZWdFeHAoXCJeXFxcXC4oXCIrTStcIilcIiksVEFHOm5ldyBSZWdFeHAoXCJeKFwiK00ucmVwbGFjZShcIndcIixcIncqXCIpK1wiKVwiKSxBVFRSOm5ldyBSZWdFeHAoXCJeXCIrTyksUFNFVURPOm5ldyBSZWdFeHAoXCJeXCIrUCksQ0hJTEQ6bmV3IFJlZ0V4cChcIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcXFwoXCIrTCtcIiooZXZlbnxvZGR8KChbKy1dfCkoXFxcXGQqKW58KVwiK0wrXCIqKD86KFsrLV18KVwiK0wrXCIqKFxcXFxkKyl8KSlcIitMK1wiKlxcXFwpfClcIixcImlcIiksYm9vbDpuZXcgUmVnRXhwKFwiXig/OlwiK0srXCIpJFwiLFwiaVwiKSxuZWVkc0NvbnRleHQ6bmV3IFJlZ0V4cChcIl5cIitMK1wiKls+K35dfDooZXZlbnxvZGR8ZXF8Z3R8bHR8bnRofGZpcnN0fGxhc3QpKD86XFxcXChcIitMK1wiKigoPzotXFxcXGQpP1xcXFxkKilcIitMK1wiKlxcXFwpfCkoPz1bXi1dfCQpXCIsXCJpXCIpfSxZPS9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksWj0vXmhcXGQkL2ksJD0vXltee10rXFx7XFxzKlxcW25hdGl2ZSBcXHcvLF89L14oPzojKFtcXHctXSspfChcXHcrKXxcXC4oW1xcdy1dKykpJC8sYWE9L1srfl0vLGJhPS8nfFxcXFwvZyxjYT1uZXcgUmVnRXhwKFwiXFxcXFxcXFwoW1xcXFxkYS1mXXsxLDZ9XCIrTCtcIj98KFwiK0wrXCIpfC4pXCIsXCJpZ1wiKSxkYT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9XCIweFwiK2ItNjU1MzY7cmV0dXJuIGQhPT1kfHxjP2I6MD5kP1N0cmluZy5mcm9tQ2hhckNvZGUoZCs2NTUzNik6U3RyaW5nLmZyb21DaGFyQ29kZShkPj4xMHw1NTI5NiwxMDIzJmR8NTYzMjApfSxlYT1mdW5jdGlvbigpe20oKX07dHJ5e0guYXBwbHkoRT1JLmNhbGwodi5jaGlsZE5vZGVzKSx2LmNoaWxkTm9kZXMpLEVbdi5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGV9Y2F0Y2goZmEpe0g9e2FwcGx5OkUubGVuZ3RoP2Z1bmN0aW9uKGEsYil7Ry5hcHBseShhLEkuY2FsbChiKSl9OmZ1bmN0aW9uKGEsYil7dmFyIGM9YS5sZW5ndGgsZD0wO3doaWxlKGFbYysrXT1iW2QrK10pO2EubGVuZ3RoPWMtMX19fWZ1bmN0aW9uIGdhKGEsYixkLGUpe3ZhciBmLGgsaixrLGwsbyxyLHMsdyx4O2lmKChiP2Iub3duZXJEb2N1bWVudHx8Yjp2KSE9PW4mJm0oYiksYj1ifHxuLGQ9ZHx8W10saz1iLm5vZGVUeXBlLFwic3RyaW5nXCIhPXR5cGVvZiBhfHwhYXx8MSE9PWsmJjkhPT1rJiYxMSE9PWspcmV0dXJuIGQ7aWYoIWUmJnApe2lmKDExIT09ayYmKGY9Xy5leGVjKGEpKSlpZihqPWZbMV0pe2lmKDk9PT1rKXtpZihoPWIuZ2V0RWxlbWVudEJ5SWQoaiksIWh8fCFoLnBhcmVudE5vZGUpcmV0dXJuIGQ7aWYoaC5pZD09PWopcmV0dXJuIGQucHVzaChoKSxkfWVsc2UgaWYoYi5vd25lckRvY3VtZW50JiYoaD1iLm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaikpJiZ0KGIsaCkmJmguaWQ9PT1qKXJldHVybiBkLnB1c2goaCksZH1lbHNle2lmKGZbMl0pcmV0dXJuIEguYXBwbHkoZCxiLmdldEVsZW1lbnRzQnlUYWdOYW1lKGEpKSxkO2lmKChqPWZbM10pJiZjLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpcmV0dXJuIEguYXBwbHkoZCxiLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaikpLGR9aWYoYy5xc2EmJighcXx8IXEudGVzdChhKSkpe2lmKHM9cj11LHc9Yix4PTEhPT1rJiZhLDE9PT1rJiZcIm9iamVjdFwiIT09Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXtvPWcoYSksKHI9Yi5nZXRBdHRyaWJ1dGUoXCJpZFwiKSk/cz1yLnJlcGxhY2UoYmEsXCJcXFxcJCZcIik6Yi5zZXRBdHRyaWJ1dGUoXCJpZFwiLHMpLHM9XCJbaWQ9J1wiK3MrXCInXSBcIixsPW8ubGVuZ3RoO3doaWxlKGwtLSlvW2xdPXMrcmEob1tsXSk7dz1hYS50ZXN0KGEpJiZwYShiLnBhcmVudE5vZGUpfHxiLHg9by5qb2luKFwiLFwiKX1pZih4KXRyeXtyZXR1cm4gSC5hcHBseShkLHcucXVlcnlTZWxlY3RvckFsbCh4KSksZH1jYXRjaCh5KXt9ZmluYWxseXtyfHxiLnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpfX19cmV0dXJuIGkoYS5yZXBsYWNlKFIsXCIkMVwiKSxiLGQsZSl9ZnVuY3Rpb24gaGEoKXt2YXIgYT1bXTtmdW5jdGlvbiBiKGMsZSl7cmV0dXJuIGEucHVzaChjK1wiIFwiKT5kLmNhY2hlTGVuZ3RoJiZkZWxldGUgYlthLnNoaWZ0KCldLGJbYytcIiBcIl09ZX1yZXR1cm4gYn1mdW5jdGlvbiBpYShhKXtyZXR1cm4gYVt1XT0hMCxhfWZ1bmN0aW9uIGphKGEpe3ZhciBiPW4uY3JlYXRlRWxlbWVudChcImRpdlwiKTt0cnl7cmV0dXJuISFhKGIpfWNhdGNoKGMpe3JldHVybiExfWZpbmFsbHl7Yi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYiksYj1udWxsfX1mdW5jdGlvbiBrYShhLGIpe3ZhciBjPWEuc3BsaXQoXCJ8XCIpLGU9YS5sZW5ndGg7d2hpbGUoZS0tKWQuYXR0ckhhbmRsZVtjW2VdXT1ifWZ1bmN0aW9uIGxhKGEsYil7dmFyIGM9YiYmYSxkPWMmJjE9PT1hLm5vZGVUeXBlJiYxPT09Yi5ub2RlVHlwZSYmKH5iLnNvdXJjZUluZGV4fHxDKS0ofmEuc291cmNlSW5kZXh8fEMpO2lmKGQpcmV0dXJuIGQ7aWYoYyl3aGlsZShjPWMubmV4dFNpYmxpbmcpaWYoYz09PWIpcmV0dXJuLTE7cmV0dXJuIGE/MTotMX1mdW5jdGlvbiBtYShhKXtyZXR1cm4gZnVuY3Rpb24oYil7dmFyIGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVyblwiaW5wdXRcIj09PWMmJmIudHlwZT09PWF9fWZ1bmN0aW9uIG5hKGEpe3JldHVybiBmdW5jdGlvbihiKXt2YXIgYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuKFwiaW5wdXRcIj09PWN8fFwiYnV0dG9uXCI9PT1jKSYmYi50eXBlPT09YX19ZnVuY3Rpb24gb2EoYSl7cmV0dXJuIGlhKGZ1bmN0aW9uKGIpe3JldHVybiBiPStiLGlhKGZ1bmN0aW9uKGMsZCl7dmFyIGUsZj1hKFtdLGMubGVuZ3RoLGIpLGc9Zi5sZW5ndGg7d2hpbGUoZy0tKWNbZT1mW2ddXSYmKGNbZV09IShkW2VdPWNbZV0pKX0pfSl9ZnVuY3Rpb24gcGEoYSl7cmV0dXJuIGEmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiBhLmdldEVsZW1lbnRzQnlUYWdOYW1lJiZhfWM9Z2Euc3VwcG9ydD17fSxmPWdhLmlzWE1MPWZ1bmN0aW9uKGEpe3ZhciBiPWEmJihhLm93bmVyRG9jdW1lbnR8fGEpLmRvY3VtZW50RWxlbWVudDtyZXR1cm4gYj9cIkhUTUxcIiE9PWIubm9kZU5hbWU6ITF9LG09Z2Euc2V0RG9jdW1lbnQ9ZnVuY3Rpb24oYSl7dmFyIGIsZSxnPWE/YS5vd25lckRvY3VtZW50fHxhOnY7cmV0dXJuIGchPT1uJiY5PT09Zy5ub2RlVHlwZSYmZy5kb2N1bWVudEVsZW1lbnQ/KG49ZyxvPWcuZG9jdW1lbnRFbGVtZW50LGU9Zy5kZWZhdWx0VmlldyxlJiZlIT09ZS50b3AmJihlLmFkZEV2ZW50TGlzdGVuZXI/ZS5hZGRFdmVudExpc3RlbmVyKFwidW5sb2FkXCIsZWEsITEpOmUuYXR0YWNoRXZlbnQmJmUuYXR0YWNoRXZlbnQoXCJvbnVubG9hZFwiLGVhKSkscD0hZihnKSxjLmF0dHJpYnV0ZXM9amEoZnVuY3Rpb24oYSl7cmV0dXJuIGEuY2xhc3NOYW1lPVwiaVwiLCFhLmdldEF0dHJpYnV0ZShcImNsYXNzTmFtZVwiKX0pLGMuZ2V0RWxlbWVudHNCeVRhZ05hbWU9amEoZnVuY3Rpb24oYSl7cmV0dXJuIGEuYXBwZW5kQ2hpbGQoZy5jcmVhdGVDb21tZW50KFwiXCIpKSwhYS5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikubGVuZ3RofSksYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lPSQudGVzdChnLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpLGMuZ2V0QnlJZD1qYShmdW5jdGlvbihhKXtyZXR1cm4gby5hcHBlbmRDaGlsZChhKS5pZD11LCFnLmdldEVsZW1lbnRzQnlOYW1lfHwhZy5nZXRFbGVtZW50c0J5TmFtZSh1KS5sZW5ndGh9KSxjLmdldEJ5SWQ/KGQuZmluZC5JRD1mdW5jdGlvbihhLGIpe2lmKFwidW5kZWZpbmVkXCIhPXR5cGVvZiBiLmdldEVsZW1lbnRCeUlkJiZwKXt2YXIgYz1iLmdldEVsZW1lbnRCeUlkKGEpO3JldHVybiBjJiZjLnBhcmVudE5vZGU/W2NdOltdfX0sZC5maWx0ZXIuSUQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5yZXBsYWNlKGNhLGRhKTtyZXR1cm4gZnVuY3Rpb24oYSl7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKFwiaWRcIik9PT1ifX0pOihkZWxldGUgZC5maW5kLklELGQuZmlsdGVyLklEPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVwbGFjZShjYSxkYSk7cmV0dXJuIGZ1bmN0aW9uKGEpe3ZhciBjPVwidW5kZWZpbmVkXCIhPXR5cGVvZiBhLmdldEF0dHJpYnV0ZU5vZGUmJmEuZ2V0QXR0cmlidXRlTm9kZShcImlkXCIpO3JldHVybiBjJiZjLnZhbHVlPT09Yn19KSxkLmZpbmQuVEFHPWMuZ2V0RWxlbWVudHNCeVRhZ05hbWU/ZnVuY3Rpb24oYSxiKXtyZXR1cm5cInVuZGVmaW5lZFwiIT10eXBlb2YgYi5nZXRFbGVtZW50c0J5VGFnTmFtZT9iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGEpOmMucXNhP2IucXVlcnlTZWxlY3RvckFsbChhKTp2b2lkIDB9OmZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPTAsZj1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKGEpO2lmKFwiKlwiPT09YSl7d2hpbGUoYz1mW2UrK10pMT09PWMubm9kZVR5cGUmJmQucHVzaChjKTtyZXR1cm4gZH1yZXR1cm4gZn0sZC5maW5kLkNMQVNTPWMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmZnVuY3Rpb24oYSxiKXtyZXR1cm4gcD9iLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYSk6dm9pZCAwfSxyPVtdLHE9W10sKGMucXNhPSQudGVzdChnLnF1ZXJ5U2VsZWN0b3JBbGwpKSYmKGphKGZ1bmN0aW9uKGEpe28uYXBwZW5kQ2hpbGQoYSkuaW5uZXJIVE1MPVwiPGEgaWQ9J1wiK3UrXCInPjwvYT48c2VsZWN0IGlkPSdcIit1K1wiLVxcZl0nIG1zYWxsb3djYXB0dXJlPScnPjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+XCIsYS5xdWVyeVNlbGVjdG9yQWxsKFwiW21zYWxsb3djYXB0dXJlXj0nJ11cIikubGVuZ3RoJiZxLnB1c2goXCJbKl4kXT1cIitMK1wiKig/OicnfFxcXCJcXFwiKVwiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbc2VsZWN0ZWRdXCIpLmxlbmd0aHx8cS5wdXNoKFwiXFxcXFtcIitMK1wiKig/OnZhbHVlfFwiK0srXCIpXCIpLGEucXVlcnlTZWxlY3RvckFsbChcIltpZH49XCIrdStcIi1dXCIpLmxlbmd0aHx8cS5wdXNoKFwifj1cIiksYS5xdWVyeVNlbGVjdG9yQWxsKFwiOmNoZWNrZWRcIikubGVuZ3RofHxxLnB1c2goXCI6Y2hlY2tlZFwiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoXCJhI1wiK3UrXCIrKlwiKS5sZW5ndGh8fHEucHVzaChcIi4jLitbK35dXCIpfSksamEoZnVuY3Rpb24oYSl7dmFyIGI9Zy5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7Yi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsXCJoaWRkZW5cIiksYS5hcHBlbmRDaGlsZChiKS5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsXCJEXCIpLGEucXVlcnlTZWxlY3RvckFsbChcIltuYW1lPWRdXCIpLmxlbmd0aCYmcS5wdXNoKFwibmFtZVwiK0wrXCIqWypeJHwhfl0/PVwiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6ZW5hYmxlZFwiKS5sZW5ndGh8fHEucHVzaChcIjplbmFibGVkXCIsXCI6ZGlzYWJsZWRcIiksYS5xdWVyeVNlbGVjdG9yQWxsKFwiKiw6eFwiKSxxLnB1c2goXCIsLio6XCIpfSkpLChjLm1hdGNoZXNTZWxlY3Rvcj0kLnRlc3Qocz1vLm1hdGNoZXN8fG8ud2Via2l0TWF0Y2hlc1NlbGVjdG9yfHxvLm1vek1hdGNoZXNTZWxlY3Rvcnx8by5vTWF0Y2hlc1NlbGVjdG9yfHxvLm1zTWF0Y2hlc1NlbGVjdG9yKSkmJmphKGZ1bmN0aW9uKGEpe2MuZGlzY29ubmVjdGVkTWF0Y2g9cy5jYWxsKGEsXCJkaXZcIikscy5jYWxsKGEsXCJbcyE9JyddOnhcIiksci5wdXNoKFwiIT1cIixQKX0pLHE9cS5sZW5ndGgmJm5ldyBSZWdFeHAocS5qb2luKFwifFwiKSkscj1yLmxlbmd0aCYmbmV3IFJlZ0V4cChyLmpvaW4oXCJ8XCIpKSxiPSQudGVzdChvLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKSx0PWJ8fCQudGVzdChvLmNvbnRhaW5zKT9mdW5jdGlvbihhLGIpe3ZhciBjPTk9PT1hLm5vZGVUeXBlP2EuZG9jdW1lbnRFbGVtZW50OmEsZD1iJiZiLnBhcmVudE5vZGU7cmV0dXJuIGE9PT1kfHwhKCFkfHwxIT09ZC5ub2RlVHlwZXx8IShjLmNvbnRhaW5zP2MuY29udGFpbnMoZCk6YS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiYmMTYmYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihkKSkpfTpmdW5jdGlvbihhLGIpe2lmKGIpd2hpbGUoYj1iLnBhcmVudE5vZGUpaWYoYj09PWEpcmV0dXJuITA7cmV0dXJuITF9LEI9Yj9mdW5jdGlvbihhLGIpe2lmKGE9PT1iKXJldHVybiBsPSEwLDA7dmFyIGQ9IWEuY29tcGFyZURvY3VtZW50UG9zaXRpb24tIWIuY29tcGFyZURvY3VtZW50UG9zaXRpb247cmV0dXJuIGQ/ZDooZD0oYS5vd25lckRvY3VtZW50fHxhKT09PShiLm93bmVyRG9jdW1lbnR8fGIpP2EuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYik6MSwxJmR8fCFjLnNvcnREZXRhY2hlZCYmYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhKT09PWQ/YT09PWd8fGEub3duZXJEb2N1bWVudD09PXYmJnQodixhKT8tMTpiPT09Z3x8Yi5vd25lckRvY3VtZW50PT09diYmdCh2LGIpPzE6az9KKGssYSktSihrLGIpOjA6NCZkPy0xOjEpfTpmdW5jdGlvbihhLGIpe2lmKGE9PT1iKXJldHVybiBsPSEwLDA7dmFyIGMsZD0wLGU9YS5wYXJlbnROb2RlLGY9Yi5wYXJlbnROb2RlLGg9W2FdLGk9W2JdO2lmKCFlfHwhZilyZXR1cm4gYT09PWc/LTE6Yj09PWc/MTplPy0xOmY/MTprP0ooayxhKS1KKGssYik6MDtpZihlPT09ZilyZXR1cm4gbGEoYSxiKTtjPWE7d2hpbGUoYz1jLnBhcmVudE5vZGUpaC51bnNoaWZ0KGMpO2M9Yjt3aGlsZShjPWMucGFyZW50Tm9kZSlpLnVuc2hpZnQoYyk7d2hpbGUoaFtkXT09PWlbZF0pZCsrO3JldHVybiBkP2xhKGhbZF0saVtkXSk6aFtkXT09PXY/LTE6aVtkXT09PXY/MTowfSxnKTpufSxnYS5tYXRjaGVzPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGdhKGEsbnVsbCxudWxsLGIpfSxnYS5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24oYSxiKXtpZigoYS5vd25lckRvY3VtZW50fHxhKSE9PW4mJm0oYSksYj1iLnJlcGxhY2UoVSxcIj0nJDEnXVwiKSwhKCFjLm1hdGNoZXNTZWxlY3Rvcnx8IXB8fHImJnIudGVzdChiKXx8cSYmcS50ZXN0KGIpKSl0cnl7dmFyIGQ9cy5jYWxsKGEsYik7aWYoZHx8Yy5kaXNjb25uZWN0ZWRNYXRjaHx8YS5kb2N1bWVudCYmMTEhPT1hLmRvY3VtZW50Lm5vZGVUeXBlKXJldHVybiBkfWNhdGNoKGUpe31yZXR1cm4gZ2EoYixuLG51bGwsW2FdKS5sZW5ndGg+MH0sZ2EuY29udGFpbnM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4oYS5vd25lckRvY3VtZW50fHxhKSE9PW4mJm0oYSksdChhLGIpfSxnYS5hdHRyPWZ1bmN0aW9uKGEsYil7KGEub3duZXJEb2N1bWVudHx8YSkhPT1uJiZtKGEpO3ZhciBlPWQuYXR0ckhhbmRsZVtiLnRvTG93ZXJDYXNlKCldLGY9ZSYmRC5jYWxsKGQuYXR0ckhhbmRsZSxiLnRvTG93ZXJDYXNlKCkpP2UoYSxiLCFwKTp2b2lkIDA7cmV0dXJuIHZvaWQgMCE9PWY/ZjpjLmF0dHJpYnV0ZXN8fCFwP2EuZ2V0QXR0cmlidXRlKGIpOihmPWEuZ2V0QXR0cmlidXRlTm9kZShiKSkmJmYuc3BlY2lmaWVkP2YudmFsdWU6bnVsbH0sZ2EuZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3cgbmV3IEVycm9yKFwiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogXCIrYSl9LGdhLnVuaXF1ZVNvcnQ9ZnVuY3Rpb24oYSl7dmFyIGIsZD1bXSxlPTAsZj0wO2lmKGw9IWMuZGV0ZWN0RHVwbGljYXRlcyxrPSFjLnNvcnRTdGFibGUmJmEuc2xpY2UoMCksYS5zb3J0KEIpLGwpe3doaWxlKGI9YVtmKytdKWI9PT1hW2ZdJiYoZT1kLnB1c2goZikpO3doaWxlKGUtLSlhLnNwbGljZShkW2VdLDEpfXJldHVybiBrPW51bGwsYX0sZT1nYS5nZXRUZXh0PWZ1bmN0aW9uKGEpe3ZhciBiLGM9XCJcIixkPTAsZj1hLm5vZGVUeXBlO2lmKGYpe2lmKDE9PT1mfHw5PT09Znx8MTE9PT1mKXtpZihcInN0cmluZ1wiPT10eXBlb2YgYS50ZXh0Q29udGVudClyZXR1cm4gYS50ZXh0Q29udGVudDtmb3IoYT1hLmZpcnN0Q2hpbGQ7YTthPWEubmV4dFNpYmxpbmcpYys9ZShhKX1lbHNlIGlmKDM9PT1mfHw0PT09ZilyZXR1cm4gYS5ub2RlVmFsdWV9ZWxzZSB3aGlsZShiPWFbZCsrXSljKz1lKGIpO3JldHVybiBjfSxkPWdhLnNlbGVjdG9ycz17Y2FjaGVMZW5ndGg6NTAsY3JlYXRlUHNldWRvOmlhLG1hdGNoOlgsYXR0ckhhbmRsZTp7fSxmaW5kOnt9LHJlbGF0aXZlOntcIj5cIjp7ZGlyOlwicGFyZW50Tm9kZVwiLGZpcnN0OiEwfSxcIiBcIjp7ZGlyOlwicGFyZW50Tm9kZVwifSxcIitcIjp7ZGlyOlwicHJldmlvdXNTaWJsaW5nXCIsZmlyc3Q6ITB9LFwiflwiOntkaXI6XCJwcmV2aW91c1NpYmxpbmdcIn19LHByZUZpbHRlcjp7QVRUUjpmdW5jdGlvbihhKXtyZXR1cm4gYVsxXT1hWzFdLnJlcGxhY2UoY2EsZGEpLGFbM109KGFbM118fGFbNF18fGFbNV18fFwiXCIpLnJlcGxhY2UoY2EsZGEpLFwifj1cIj09PWFbMl0mJihhWzNdPVwiIFwiK2FbM10rXCIgXCIpLGEuc2xpY2UoMCw0KX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGFbMV09YVsxXS50b0xvd2VyQ2FzZSgpLFwibnRoXCI9PT1hWzFdLnNsaWNlKDAsMyk/KGFbM118fGdhLmVycm9yKGFbMF0pLGFbNF09KyhhWzRdP2FbNV0rKGFbNl18fDEpOjIqKFwiZXZlblwiPT09YVszXXx8XCJvZGRcIj09PWFbM10pKSxhWzVdPSsoYVs3XSthWzhdfHxcIm9kZFwiPT09YVszXSkpOmFbM10mJmdhLmVycm9yKGFbMF0pLGF9LFBTRVVETzpmdW5jdGlvbihhKXt2YXIgYixjPSFhWzZdJiZhWzJdO3JldHVybiBYLkNISUxELnRlc3QoYVswXSk/bnVsbDooYVszXT9hWzJdPWFbNF18fGFbNV18fFwiXCI6YyYmVi50ZXN0KGMpJiYoYj1nKGMsITApKSYmKGI9Yy5pbmRleE9mKFwiKVwiLGMubGVuZ3RoLWIpLWMubGVuZ3RoKSYmKGFbMF09YVswXS5zbGljZSgwLGIpLGFbMl09Yy5zbGljZSgwLGIpKSxhLnNsaWNlKDAsMykpfX0sZmlsdGVyOntUQUc6ZnVuY3Rpb24oYSl7dmFyIGI9YS5yZXBsYWNlKGNhLGRhKS50b0xvd2VyQ2FzZSgpO3JldHVyblwiKlwiPT09YT9mdW5jdGlvbigpe3JldHVybiEwfTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09Yn19LENMQVNTOmZ1bmN0aW9uKGEpe3ZhciBiPXlbYStcIiBcIl07cmV0dXJuIGJ8fChiPW5ldyBSZWdFeHAoXCIoXnxcIitMK1wiKVwiK2ErXCIoXCIrTCtcInwkKVwiKSkmJnkoYSxmdW5jdGlvbihhKXtyZXR1cm4gYi50ZXN0KFwic3RyaW5nXCI9PXR5cGVvZiBhLmNsYXNzTmFtZSYmYS5jbGFzc05hbWV8fFwidW5kZWZpbmVkXCIhPXR5cGVvZiBhLmdldEF0dHJpYnV0ZSYmYS5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKXx8XCJcIil9KX0sQVRUUjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGZ1bmN0aW9uKGQpe3ZhciBlPWdhLmF0dHIoZCxhKTtyZXR1cm4gbnVsbD09ZT9cIiE9XCI9PT1iOmI/KGUrPVwiXCIsXCI9XCI9PT1iP2U9PT1jOlwiIT1cIj09PWI/ZSE9PWM6XCJePVwiPT09Yj9jJiYwPT09ZS5pbmRleE9mKGMpOlwiKj1cIj09PWI/YyYmZS5pbmRleE9mKGMpPi0xOlwiJD1cIj09PWI/YyYmZS5zbGljZSgtYy5sZW5ndGgpPT09YzpcIn49XCI9PT1iPyhcIiBcIitlLnJlcGxhY2UoUSxcIiBcIikrXCIgXCIpLmluZGV4T2YoYyk+LTE6XCJ8PVwiPT09Yj9lPT09Y3x8ZS5zbGljZSgwLGMubGVuZ3RoKzEpPT09YytcIi1cIjohMSk6ITB9fSxDSElMRDpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPVwibnRoXCIhPT1hLnNsaWNlKDAsMyksZz1cImxhc3RcIiE9PWEuc2xpY2UoLTQpLGg9XCJvZi10eXBlXCI9PT1iO3JldHVybiAxPT09ZCYmMD09PWU/ZnVuY3Rpb24oYSl7cmV0dXJuISFhLnBhcmVudE5vZGV9OmZ1bmN0aW9uKGIsYyxpKXt2YXIgaixrLGwsbSxuLG8scD1mIT09Zz9cIm5leHRTaWJsaW5nXCI6XCJwcmV2aW91c1NpYmxpbmdcIixxPWIucGFyZW50Tm9kZSxyPWgmJmIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSxzPSFpJiYhaDtpZihxKXtpZihmKXt3aGlsZShwKXtsPWI7d2hpbGUobD1sW3BdKWlmKGg/bC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09cjoxPT09bC5ub2RlVHlwZSlyZXR1cm4hMTtvPXA9XCJvbmx5XCI9PT1hJiYhbyYmXCJuZXh0U2libGluZ1wifXJldHVybiEwfWlmKG89W2c/cS5maXJzdENoaWxkOnEubGFzdENoaWxkXSxnJiZzKXtrPXFbdV18fChxW3VdPXt9KSxqPWtbYV18fFtdLG49alswXT09PXcmJmpbMV0sbT1qWzBdPT09dyYmalsyXSxsPW4mJnEuY2hpbGROb2Rlc1tuXTt3aGlsZShsPSsrbiYmbCYmbFtwXXx8KG09bj0wKXx8by5wb3AoKSlpZigxPT09bC5ub2RlVHlwZSYmKyttJiZsPT09Yil7a1thXT1bdyxuLG1dO2JyZWFrfX1lbHNlIGlmKHMmJihqPShiW3VdfHwoYlt1XT17fSkpW2FdKSYmalswXT09PXcpbT1qWzFdO2Vsc2Ugd2hpbGUobD0rK24mJmwmJmxbcF18fChtPW49MCl8fG8ucG9wKCkpaWYoKGg/bC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09cjoxPT09bC5ub2RlVHlwZSkmJisrbSYmKHMmJigobFt1XXx8KGxbdV09e30pKVthXT1bdyxtXSksbD09PWIpKWJyZWFrO3JldHVybiBtLT1lLG09PT1kfHxtJWQ9PT0wJiZtL2Q+PTB9fX0sUFNFVURPOmZ1bmN0aW9uKGEsYil7dmFyIGMsZT1kLnBzZXVkb3NbYV18fGQuc2V0RmlsdGVyc1thLnRvTG93ZXJDYXNlKCldfHxnYS5lcnJvcihcInVuc3VwcG9ydGVkIHBzZXVkbzogXCIrYSk7cmV0dXJuIGVbdV0/ZShiKTplLmxlbmd0aD4xPyhjPVthLGEsXCJcIixiXSxkLnNldEZpbHRlcnMuaGFzT3duUHJvcGVydHkoYS50b0xvd2VyQ2FzZSgpKT9pYShmdW5jdGlvbihhLGMpe3ZhciBkLGY9ZShhLGIpLGc9Zi5sZW5ndGg7d2hpbGUoZy0tKWQ9SihhLGZbZ10pLGFbZF09IShjW2RdPWZbZ10pfSk6ZnVuY3Rpb24oYSl7cmV0dXJuIGUoYSwwLGMpfSk6ZX19LHBzZXVkb3M6e25vdDppYShmdW5jdGlvbihhKXt2YXIgYj1bXSxjPVtdLGQ9aChhLnJlcGxhY2UoUixcIiQxXCIpKTtyZXR1cm4gZFt1XT9pYShmdW5jdGlvbihhLGIsYyxlKXt2YXIgZixnPWQoYSxudWxsLGUsW10pLGg9YS5sZW5ndGg7d2hpbGUoaC0tKShmPWdbaF0pJiYoYVtoXT0hKGJbaF09ZikpfSk6ZnVuY3Rpb24oYSxlLGYpe3JldHVybiBiWzBdPWEsZChiLG51bGwsZixjKSxiWzBdPW51bGwsIWMucG9wKCl9fSksaGFzOmlhKGZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4gZ2EoYSxiKS5sZW5ndGg+MH19KSxjb250YWluczppYShmdW5jdGlvbihhKXtyZXR1cm4gYT1hLnJlcGxhY2UoY2EsZGEpLGZ1bmN0aW9uKGIpe3JldHVybihiLnRleHRDb250ZW50fHxiLmlubmVyVGV4dHx8ZShiKSkuaW5kZXhPZihhKT4tMX19KSxsYW5nOmlhKGZ1bmN0aW9uKGEpe3JldHVybiBXLnRlc3QoYXx8XCJcIil8fGdhLmVycm9yKFwidW5zdXBwb3J0ZWQgbGFuZzogXCIrYSksYT1hLnJlcGxhY2UoY2EsZGEpLnRvTG93ZXJDYXNlKCksZnVuY3Rpb24oYil7dmFyIGM7ZG8gaWYoYz1wP2IubGFuZzpiLmdldEF0dHJpYnV0ZShcInhtbDpsYW5nXCIpfHxiLmdldEF0dHJpYnV0ZShcImxhbmdcIikpcmV0dXJuIGM9Yy50b0xvd2VyQ2FzZSgpLGM9PT1hfHwwPT09Yy5pbmRleE9mKGErXCItXCIpO3doaWxlKChiPWIucGFyZW50Tm9kZSkmJjE9PT1iLm5vZGVUeXBlKTtyZXR1cm4hMX19KSx0YXJnZXQ6ZnVuY3Rpb24oYil7dmFyIGM9YS5sb2NhdGlvbiYmYS5sb2NhdGlvbi5oYXNoO3JldHVybiBjJiZjLnNsaWNlKDEpPT09Yi5pZH0scm9vdDpmdW5jdGlvbihhKXtyZXR1cm4gYT09PW99LGZvY3VzOmZ1bmN0aW9uKGEpe3JldHVybiBhPT09bi5hY3RpdmVFbGVtZW50JiYoIW4uaGFzRm9jdXN8fG4uaGFzRm9jdXMoKSkmJiEhKGEudHlwZXx8YS5ocmVmfHx+YS50YWJJbmRleCl9LGVuYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMX0sZGlzYWJsZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZGlzYWJsZWQ9PT0hMH0sY2hlY2tlZDpmdW5jdGlvbihhKXt2YXIgYj1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuXCJpbnB1dFwiPT09YiYmISFhLmNoZWNrZWR8fFwib3B0aW9uXCI9PT1iJiYhIWEuc2VsZWN0ZWR9LHNlbGVjdGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4LGEuc2VsZWN0ZWQ9PT0hMH0sZW1wdHk6ZnVuY3Rpb24oYSl7Zm9yKGE9YS5maXJzdENoaWxkO2E7YT1hLm5leHRTaWJsaW5nKWlmKGEubm9kZVR5cGU8NilyZXR1cm4hMTtyZXR1cm4hMH0scGFyZW50OmZ1bmN0aW9uKGEpe3JldHVybiFkLnBzZXVkb3MuZW1wdHkoYSl9LGhlYWRlcjpmdW5jdGlvbihhKXtyZXR1cm4gWi50ZXN0KGEubm9kZU5hbWUpfSxpbnB1dDpmdW5jdGlvbihhKXtyZXR1cm4gWS50ZXN0KGEubm9kZU5hbWUpfSxidXR0b246ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVyblwiaW5wdXRcIj09PWImJlwiYnV0dG9uXCI9PT1hLnR5cGV8fFwiYnV0dG9uXCI9PT1ifSx0ZXh0OmZ1bmN0aW9uKGEpe3ZhciBiO3JldHVyblwiaW5wdXRcIj09PWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmXCJ0ZXh0XCI9PT1hLnR5cGUmJihudWxsPT0oYj1hLmdldEF0dHJpYnV0ZShcInR5cGVcIikpfHxcInRleHRcIj09PWIudG9Mb3dlckNhc2UoKSl9LGZpcnN0Om9hKGZ1bmN0aW9uKCl7cmV0dXJuWzBdfSksbGFzdDpvYShmdW5jdGlvbihhLGIpe3JldHVybltiLTFdfSksZXE6b2EoZnVuY3Rpb24oYSxiLGMpe3JldHVyblswPmM/YytiOmNdfSksZXZlbjpvYShmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wO2I+YztjKz0yKWEucHVzaChjKTtyZXR1cm4gYX0pLG9kZDpvYShmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0xO2I+YztjKz0yKWEucHVzaChjKTtyZXR1cm4gYX0pLGx0Om9hKGZ1bmN0aW9uKGEsYixjKXtmb3IodmFyIGQ9MD5jP2MrYjpjOy0tZD49MDspYS5wdXNoKGQpO3JldHVybiBhfSksZ3Q6b2EoZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZD0wPmM/YytiOmM7KytkPGI7KWEucHVzaChkKTtyZXR1cm4gYX0pfX0sZC5wc2V1ZG9zLm50aD1kLnBzZXVkb3MuZXE7Zm9yKGIgaW57cmFkaW86ITAsY2hlY2tib3g6ITAsZmlsZTohMCxwYXNzd29yZDohMCxpbWFnZTohMH0pZC5wc2V1ZG9zW2JdPW1hKGIpO2ZvcihiIGlue3N1Ym1pdDohMCxyZXNldDohMH0pZC5wc2V1ZG9zW2JdPW5hKGIpO2Z1bmN0aW9uIHFhKCl7fXFhLnByb3RvdHlwZT1kLmZpbHRlcnM9ZC5wc2V1ZG9zLGQuc2V0RmlsdGVycz1uZXcgcWEsZz1nYS50b2tlbml6ZT1mdW5jdGlvbihhLGIpe3ZhciBjLGUsZixnLGgsaSxqLGs9elthK1wiIFwiXTtpZihrKXJldHVybiBiPzA6ay5zbGljZSgwKTtoPWEsaT1bXSxqPWQucHJlRmlsdGVyO3doaWxlKGgpeyghY3x8KGU9Uy5leGVjKGgpKSkmJihlJiYoaD1oLnNsaWNlKGVbMF0ubGVuZ3RoKXx8aCksaS5wdXNoKGY9W10pKSxjPSExLChlPVQuZXhlYyhoKSkmJihjPWUuc2hpZnQoKSxmLnB1c2goe3ZhbHVlOmMsdHlwZTplWzBdLnJlcGxhY2UoUixcIiBcIil9KSxoPWguc2xpY2UoYy5sZW5ndGgpKTtmb3IoZyBpbiBkLmZpbHRlcikhKGU9WFtnXS5leGVjKGgpKXx8altnXSYmIShlPWpbZ10oZSkpfHwoYz1lLnNoaWZ0KCksZi5wdXNoKHt2YWx1ZTpjLHR5cGU6ZyxtYXRjaGVzOmV9KSxoPWguc2xpY2UoYy5sZW5ndGgpKTtpZighYylicmVha31yZXR1cm4gYj9oLmxlbmd0aDpoP2dhLmVycm9yKGEpOnooYSxpKS5zbGljZSgwKX07ZnVuY3Rpb24gcmEoYSl7Zm9yKHZhciBiPTAsYz1hLmxlbmd0aCxkPVwiXCI7Yz5iO2IrKylkKz1hW2JdLnZhbHVlO3JldHVybiBkfWZ1bmN0aW9uIHNhKGEsYixjKXt2YXIgZD1iLmRpcixlPWMmJlwicGFyZW50Tm9kZVwiPT09ZCxmPXgrKztyZXR1cm4gYi5maXJzdD9mdW5jdGlvbihiLGMsZil7d2hpbGUoYj1iW2RdKWlmKDE9PT1iLm5vZGVUeXBlfHxlKXJldHVybiBhKGIsYyxmKX06ZnVuY3Rpb24oYixjLGcpe3ZhciBoLGksaj1bdyxmXTtpZihnKXt3aGlsZShiPWJbZF0paWYoKDE9PT1iLm5vZGVUeXBlfHxlKSYmYShiLGMsZykpcmV0dXJuITB9ZWxzZSB3aGlsZShiPWJbZF0paWYoMT09PWIubm9kZVR5cGV8fGUpe2lmKGk9Ylt1XXx8KGJbdV09e30pLChoPWlbZF0pJiZoWzBdPT09dyYmaFsxXT09PWYpcmV0dXJuIGpbMl09aFsyXTtpZihpW2RdPWosalsyXT1hKGIsYyxnKSlyZXR1cm4hMH19fWZ1bmN0aW9uIHRhKGEpe3JldHVybiBhLmxlbmd0aD4xP2Z1bmN0aW9uKGIsYyxkKXt2YXIgZT1hLmxlbmd0aDt3aGlsZShlLS0paWYoIWFbZV0oYixjLGQpKXJldHVybiExO3JldHVybiEwfTphWzBdfWZ1bmN0aW9uIHVhKGEsYixjKXtmb3IodmFyIGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspZ2EoYSxiW2RdLGMpO3JldHVybiBjfWZ1bmN0aW9uIHZhKGEsYixjLGQsZSl7Zm9yKHZhciBmLGc9W10saD0wLGk9YS5sZW5ndGgsaj1udWxsIT1iO2k+aDtoKyspKGY9YVtoXSkmJighY3x8YyhmLGQsZSkpJiYoZy5wdXNoKGYpLGomJmIucHVzaChoKSk7cmV0dXJuIGd9ZnVuY3Rpb24gd2EoYSxiLGMsZCxlLGYpe3JldHVybiBkJiYhZFt1XSYmKGQ9d2EoZCkpLGUmJiFlW3VdJiYoZT13YShlLGYpKSxpYShmdW5jdGlvbihmLGcsaCxpKXt2YXIgaixrLGwsbT1bXSxuPVtdLG89Zy5sZW5ndGgscD1mfHx1YShifHxcIipcIixoLm5vZGVUeXBlP1toXTpoLFtdKSxxPSFhfHwhZiYmYj9wOnZhKHAsbSxhLGgsaSkscj1jP2V8fChmP2E6b3x8ZCk/W106ZzpxO2lmKGMmJmMocSxyLGgsaSksZCl7aj12YShyLG4pLGQoaixbXSxoLGkpLGs9ai5sZW5ndGg7d2hpbGUoay0tKShsPWpba10pJiYocltuW2tdXT0hKHFbbltrXV09bCkpfWlmKGYpe2lmKGV8fGEpe2lmKGUpe2o9W10saz1yLmxlbmd0aDt3aGlsZShrLS0pKGw9cltrXSkmJmoucHVzaChxW2tdPWwpO2UobnVsbCxyPVtdLGosaSl9az1yLmxlbmd0aDt3aGlsZShrLS0pKGw9cltrXSkmJihqPWU/SihmLGwpOm1ba10pPi0xJiYoZltqXT0hKGdbal09bCkpfX1lbHNlIHI9dmEocj09PWc/ci5zcGxpY2UobyxyLmxlbmd0aCk6ciksZT9lKG51bGwsZyxyLGkpOkguYXBwbHkoZyxyKX0pfWZ1bmN0aW9uIHhhKGEpe2Zvcih2YXIgYixjLGUsZj1hLmxlbmd0aCxnPWQucmVsYXRpdmVbYVswXS50eXBlXSxoPWd8fGQucmVsYXRpdmVbXCIgXCJdLGk9Zz8xOjAsaz1zYShmdW5jdGlvbihhKXtyZXR1cm4gYT09PWJ9LGgsITApLGw9c2EoZnVuY3Rpb24oYSl7cmV0dXJuIEooYixhKT4tMX0saCwhMCksbT1bZnVuY3Rpb24oYSxjLGQpe3ZhciBlPSFnJiYoZHx8YyE9PWopfHwoKGI9Yykubm9kZVR5cGU/ayhhLGMsZCk6bChhLGMsZCkpO3JldHVybiBiPW51bGwsZX1dO2Y+aTtpKyspaWYoYz1kLnJlbGF0aXZlW2FbaV0udHlwZV0pbT1bc2EodGEobSksYyldO2Vsc2V7aWYoYz1kLmZpbHRlclthW2ldLnR5cGVdLmFwcGx5KG51bGwsYVtpXS5tYXRjaGVzKSxjW3VdKXtmb3IoZT0rK2k7Zj5lO2UrKylpZihkLnJlbGF0aXZlW2FbZV0udHlwZV0pYnJlYWs7cmV0dXJuIHdhKGk+MSYmdGEobSksaT4xJiZyYShhLnNsaWNlKDAsaS0xKS5jb25jYXQoe3ZhbHVlOlwiIFwiPT09YVtpLTJdLnR5cGU/XCIqXCI6XCJcIn0pKS5yZXBsYWNlKFIsXCIkMVwiKSxjLGU+aSYmeGEoYS5zbGljZShpLGUpKSxmPmUmJnhhKGE9YS5zbGljZShlKSksZj5lJiZyYShhKSl9bS5wdXNoKGMpfXJldHVybiB0YShtKX1mdW5jdGlvbiB5YShhLGIpe3ZhciBjPWIubGVuZ3RoPjAsZT1hLmxlbmd0aD4wLGY9ZnVuY3Rpb24oZixnLGgsaSxrKXt2YXIgbCxtLG8scD0wLHE9XCIwXCIscj1mJiZbXSxzPVtdLHQ9aix1PWZ8fGUmJmQuZmluZC5UQUcoXCIqXCIsayksdj13Kz1udWxsPT10PzE6TWF0aC5yYW5kb20oKXx8LjEseD11Lmxlbmd0aDtmb3IoayYmKGo9ZyE9PW4mJmcpO3EhPT14JiZudWxsIT0obD11W3FdKTtxKyspe2lmKGUmJmwpe209MDt3aGlsZShvPWFbbSsrXSlpZihvKGwsZyxoKSl7aS5wdXNoKGwpO2JyZWFrfWsmJih3PXYpfWMmJigobD0hbyYmbCkmJnAtLSxmJiZyLnB1c2gobCkpfWlmKHArPXEsYyYmcSE9PXApe209MDt3aGlsZShvPWJbbSsrXSlvKHIscyxnLGgpO2lmKGYpe2lmKHA+MCl3aGlsZShxLS0pcltxXXx8c1txXXx8KHNbcV09Ri5jYWxsKGkpKTtzPXZhKHMpfUguYXBwbHkoaSxzKSxrJiYhZiYmcy5sZW5ndGg+MCYmcCtiLmxlbmd0aD4xJiZnYS51bmlxdWVTb3J0KGkpfXJldHVybiBrJiYodz12LGo9dCkscn07cmV0dXJuIGM/aWEoZik6Zn1yZXR1cm4gaD1nYS5jb21waWxlPWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPVtdLGY9QVthK1wiIFwiXTtpZighZil7Ynx8KGI9ZyhhKSksYz1iLmxlbmd0aDt3aGlsZShjLS0pZj14YShiW2NdKSxmW3VdP2QucHVzaChmKTplLnB1c2goZik7Zj1BKGEseWEoZSxkKSksZi5zZWxlY3Rvcj1hfXJldHVybiBmfSxpPWdhLnNlbGVjdD1mdW5jdGlvbihhLGIsZSxmKXt2YXIgaSxqLGssbCxtLG49XCJmdW5jdGlvblwiPT10eXBlb2YgYSYmYSxvPSFmJiZnKGE9bi5zZWxlY3Rvcnx8YSk7aWYoZT1lfHxbXSwxPT09by5sZW5ndGgpe2lmKGo9b1swXT1vWzBdLnNsaWNlKDApLGoubGVuZ3RoPjImJlwiSURcIj09PShrPWpbMF0pLnR5cGUmJmMuZ2V0QnlJZCYmOT09PWIubm9kZVR5cGUmJnAmJmQucmVsYXRpdmVbalsxXS50eXBlXSl7aWYoYj0oZC5maW5kLklEKGsubWF0Y2hlc1swXS5yZXBsYWNlKGNhLGRhKSxiKXx8W10pWzBdLCFiKXJldHVybiBlO24mJihiPWIucGFyZW50Tm9kZSksYT1hLnNsaWNlKGouc2hpZnQoKS52YWx1ZS5sZW5ndGgpfWk9WC5uZWVkc0NvbnRleHQudGVzdChhKT8wOmoubGVuZ3RoO3doaWxlKGktLSl7aWYoaz1qW2ldLGQucmVsYXRpdmVbbD1rLnR5cGVdKWJyZWFrO2lmKChtPWQuZmluZFtsXSkmJihmPW0oay5tYXRjaGVzWzBdLnJlcGxhY2UoY2EsZGEpLGFhLnRlc3QoalswXS50eXBlKSYmcGEoYi5wYXJlbnROb2RlKXx8YikpKXtpZihqLnNwbGljZShpLDEpLGE9Zi5sZW5ndGgmJnJhKGopLCFhKXJldHVybiBILmFwcGx5KGUsZiksZTticmVha319fXJldHVybihufHxoKGEsbykpKGYsYiwhcCxlLGFhLnRlc3QoYSkmJnBhKGIucGFyZW50Tm9kZSl8fGIpLGV9LGMuc29ydFN0YWJsZT11LnNwbGl0KFwiXCIpLnNvcnQoQikuam9pbihcIlwiKT09PXUsYy5kZXRlY3REdXBsaWNhdGVzPSEhbCxtKCksYy5zb3J0RGV0YWNoZWQ9amEoZnVuY3Rpb24oYSl7cmV0dXJuIDEmYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihuLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpfSksamEoZnVuY3Rpb24oYSl7cmV0dXJuIGEuaW5uZXJIVE1MPVwiPGEgaHJlZj0nIyc+PC9hPlwiLFwiI1wiPT09YS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZShcImhyZWZcIil9KXx8a2EoXCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoXCIsZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjP3ZvaWQgMDphLmdldEF0dHJpYnV0ZShiLFwidHlwZVwiPT09Yi50b0xvd2VyQ2FzZSgpPzE6Mil9KSxjLmF0dHJpYnV0ZXMmJmphKGZ1bmN0aW9uKGEpe3JldHVybiBhLmlubmVySFRNTD1cIjxpbnB1dC8+XCIsYS5maXJzdENoaWxkLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsXCJcIiksXCJcIj09PWEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiKX0pfHxrYShcInZhbHVlXCIsZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjfHxcImlucHV0XCIhPT1hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk/dm9pZCAwOmEuZGVmYXVsdFZhbHVlfSksamEoZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PWEuZ2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIil9KXx8a2EoSyxmdW5jdGlvbihhLGIsYyl7dmFyIGQ7cmV0dXJuIGM/dm9pZCAwOmFbYl09PT0hMD9iLnRvTG93ZXJDYXNlKCk6KGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGIpKSYmZC5zcGVjaWZpZWQ/ZC52YWx1ZTpudWxsfSksZ2F9KGEpO20uZmluZD1zLG0uZXhwcj1zLnNlbGVjdG9ycyxtLmV4cHJbXCI6XCJdPW0uZXhwci5wc2V1ZG9zLG0udW5pcXVlPXMudW5pcXVlU29ydCxtLnRleHQ9cy5nZXRUZXh0LG0uaXNYTUxEb2M9cy5pc1hNTCxtLmNvbnRhaW5zPXMuY29udGFpbnM7dmFyIHQ9bS5leHByLm1hdGNoLm5lZWRzQ29udGV4dCx1PS9ePChcXHcrKVxccypcXC8/Pig/OjxcXC9cXDE+fCkkLyx2PS9eLlteOiNcXFtcXC4sXSokLztmdW5jdGlvbiB3KGEsYixjKXtpZihtLmlzRnVuY3Rpb24oYikpcmV0dXJuIG0uZ3JlcChhLGZ1bmN0aW9uKGEsZCl7cmV0dXJuISFiLmNhbGwoYSxkLGEpIT09Y30pO2lmKGIubm9kZVR5cGUpcmV0dXJuIG0uZ3JlcChhLGZ1bmN0aW9uKGEpe3JldHVybiBhPT09YiE9PWN9KTtpZihcInN0cmluZ1wiPT10eXBlb2YgYil7aWYodi50ZXN0KGIpKXJldHVybiBtLmZpbHRlcihiLGEsYyk7Yj1tLmZpbHRlcihiLGEpfXJldHVybiBtLmdyZXAoYSxmdW5jdGlvbihhKXtyZXR1cm4gbS5pbkFycmF5KGEsYik+PTAhPT1jfSl9bS5maWx0ZXI9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWJbMF07cmV0dXJuIGMmJihhPVwiOm5vdChcIithK1wiKVwiKSwxPT09Yi5sZW5ndGgmJjE9PT1kLm5vZGVUeXBlP20uZmluZC5tYXRjaGVzU2VsZWN0b3IoZCxhKT9bZF06W106bS5maW5kLm1hdGNoZXMoYSxtLmdyZXAoYixmdW5jdGlvbihhKXtyZXR1cm4gMT09PWEubm9kZVR5cGV9KSl9LG0uZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGEpe3ZhciBiLGM9W10sZD10aGlzLGU9ZC5sZW5ndGg7aWYoXCJzdHJpbmdcIiE9dHlwZW9mIGEpcmV0dXJuIHRoaXMucHVzaFN0YWNrKG0oYSkuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKGI9MDtlPmI7YisrKWlmKG0uY29udGFpbnMoZFtiXSx0aGlzKSlyZXR1cm4hMH0pKTtmb3IoYj0wO2U+YjtiKyspbS5maW5kKGEsZFtiXSxjKTtyZXR1cm4gYz10aGlzLnB1c2hTdGFjayhlPjE/bS51bmlxdWUoYyk6YyksYy5zZWxlY3Rvcj10aGlzLnNlbGVjdG9yP3RoaXMuc2VsZWN0b3IrXCIgXCIrYTphLGN9LGZpbHRlcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2sodyh0aGlzLGF8fFtdLCExKSl9LG5vdDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2sodyh0aGlzLGF8fFtdLCEwKSl9LGlzOmZ1bmN0aW9uKGEpe3JldHVybiEhdyh0aGlzLFwic3RyaW5nXCI9PXR5cGVvZiBhJiZ0LnRlc3QoYSk/bShhKTphfHxbXSwhMSkubGVuZ3RofX0pO3ZhciB4LHk9YS5kb2N1bWVudCx6PS9eKD86XFxzKig8W1xcd1xcV10rPilbXj5dKnwjKFtcXHctXSopKSQvLEE9bS5mbi5pbml0PWZ1bmN0aW9uKGEsYil7dmFyIGMsZDtpZighYSlyZXR1cm4gdGhpcztpZihcInN0cmluZ1wiPT10eXBlb2YgYSl7aWYoYz1cIjxcIj09PWEuY2hhckF0KDApJiZcIj5cIj09PWEuY2hhckF0KGEubGVuZ3RoLTEpJiZhLmxlbmd0aD49Mz9bbnVsbCxhLG51bGxdOnouZXhlYyhhKSwhY3x8IWNbMV0mJmIpcmV0dXJuIWJ8fGIuanF1ZXJ5PyhifHx4KS5maW5kKGEpOnRoaXMuY29uc3RydWN0b3IoYikuZmluZChhKTtpZihjWzFdKXtpZihiPWIgaW5zdGFuY2VvZiBtP2JbMF06YixtLm1lcmdlKHRoaXMsbS5wYXJzZUhUTUwoY1sxXSxiJiZiLm5vZGVUeXBlP2Iub3duZXJEb2N1bWVudHx8Yjp5LCEwKSksdS50ZXN0KGNbMV0pJiZtLmlzUGxhaW5PYmplY3QoYikpZm9yKGMgaW4gYiltLmlzRnVuY3Rpb24odGhpc1tjXSk/dGhpc1tjXShiW2NdKTp0aGlzLmF0dHIoYyxiW2NdKTtyZXR1cm4gdGhpc31pZihkPXkuZ2V0RWxlbWVudEJ5SWQoY1syXSksZCYmZC5wYXJlbnROb2RlKXtpZihkLmlkIT09Y1syXSlyZXR1cm4geC5maW5kKGEpO3RoaXMubGVuZ3RoPTEsdGhpc1swXT1kfXJldHVybiB0aGlzLmNvbnRleHQ9eSx0aGlzLnNlbGVjdG9yPWEsdGhpc31yZXR1cm4gYS5ub2RlVHlwZT8odGhpcy5jb250ZXh0PXRoaXNbMF09YSx0aGlzLmxlbmd0aD0xLHRoaXMpOm0uaXNGdW5jdGlvbihhKT9cInVuZGVmaW5lZFwiIT10eXBlb2YgeC5yZWFkeT94LnJlYWR5KGEpOmEobSk6KHZvaWQgMCE9PWEuc2VsZWN0b3ImJih0aGlzLnNlbGVjdG9yPWEuc2VsZWN0b3IsdGhpcy5jb250ZXh0PWEuY29udGV4dCksbS5tYWtlQXJyYXkoYSx0aGlzKSl9O0EucHJvdG90eXBlPW0uZm4seD1tKHkpO3ZhciBCPS9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLEM9e2NoaWxkcmVuOiEwLGNvbnRlbnRzOiEwLG5leHQ6ITAscHJldjohMH07bS5leHRlbmQoe2RpcjpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9W10sZT1hW2JdO3doaWxlKGUmJjkhPT1lLm5vZGVUeXBlJiYodm9pZCAwPT09Y3x8MSE9PWUubm9kZVR5cGV8fCFtKGUpLmlzKGMpKSkxPT09ZS5ub2RlVHlwZSYmZC5wdXNoKGUpLGU9ZVtiXTtyZXR1cm4gZH0sc2libGluZzpmdW5jdGlvbihhLGIpe2Zvcih2YXIgYz1bXTthO2E9YS5uZXh0U2libGluZykxPT09YS5ub2RlVHlwZSYmYSE9PWImJmMucHVzaChhKTtyZXR1cm4gY319KSxtLmZuLmV4dGVuZCh7aGFzOmZ1bmN0aW9uKGEpe3ZhciBiLGM9bShhLHRoaXMpLGQ9Yy5sZW5ndGg7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKGI9MDtkPmI7YisrKWlmKG0uY29udGFpbnModGhpcyxjW2JdKSlyZXR1cm4hMH0pfSxjbG9zZXN0OmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjLGQ9MCxlPXRoaXMubGVuZ3RoLGY9W10sZz10LnRlc3QoYSl8fFwic3RyaW5nXCIhPXR5cGVvZiBhP20oYSxifHx0aGlzLmNvbnRleHQpOjA7ZT5kO2QrKylmb3IoYz10aGlzW2RdO2MmJmMhPT1iO2M9Yy5wYXJlbnROb2RlKWlmKGMubm9kZVR5cGU8MTEmJihnP2cuaW5kZXgoYyk+LTE6MT09PWMubm9kZVR5cGUmJm0uZmluZC5tYXRjaGVzU2VsZWN0b3IoYyxhKSkpe2YucHVzaChjKTticmVha31yZXR1cm4gdGhpcy5wdXNoU3RhY2soZi5sZW5ndGg+MT9tLnVuaXF1ZShmKTpmKX0saW5kZXg6ZnVuY3Rpb24oYSl7cmV0dXJuIGE/XCJzdHJpbmdcIj09dHlwZW9mIGE/bS5pbkFycmF5KHRoaXNbMF0sbShhKSk6bS5pbkFycmF5KGEuanF1ZXJ5P2FbMF06YSx0aGlzKTp0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGU/dGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGg6LTF9LGFkZDpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLnB1c2hTdGFjayhtLnVuaXF1ZShtLm1lcmdlKHRoaXMuZ2V0KCksbShhLGIpKSkpfSxhZGRCYWNrOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmFkZChudWxsPT1hP3RoaXMucHJldk9iamVjdDp0aGlzLnByZXZPYmplY3QuZmlsdGVyKGEpKX19KTtmdW5jdGlvbiBEKGEsYil7ZG8gYT1hW2JdO3doaWxlKGEmJjEhPT1hLm5vZGVUeXBlKTtyZXR1cm4gYX1tLmVhY2goe3BhcmVudDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJjExIT09Yi5ub2RlVHlwZT9iOm51bGx9LHBhcmVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIG0uZGlyKGEsXCJwYXJlbnROb2RlXCIpfSxwYXJlbnRzVW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBtLmRpcihhLFwicGFyZW50Tm9kZVwiLGMpfSxuZXh0OmZ1bmN0aW9uKGEpe3JldHVybiBEKGEsXCJuZXh0U2libGluZ1wiKX0scHJldjpmdW5jdGlvbihhKXtyZXR1cm4gRChhLFwicHJldmlvdXNTaWJsaW5nXCIpfSxuZXh0QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBtLmRpcihhLFwibmV4dFNpYmxpbmdcIil9LHByZXZBbGw6ZnVuY3Rpb24oYSl7cmV0dXJuIG0uZGlyKGEsXCJwcmV2aW91c1NpYmxpbmdcIil9LG5leHRVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIG0uZGlyKGEsXCJuZXh0U2libGluZ1wiLGMpfSxwcmV2VW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBtLmRpcihhLFwicHJldmlvdXNTaWJsaW5nXCIsYyl9LHNpYmxpbmdzOmZ1bmN0aW9uKGEpe3JldHVybiBtLnNpYmxpbmcoKGEucGFyZW50Tm9kZXx8e30pLmZpcnN0Q2hpbGQsYSl9LGNoaWxkcmVuOmZ1bmN0aW9uKGEpe3JldHVybiBtLnNpYmxpbmcoYS5maXJzdENoaWxkKX0sY29udGVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIG0ubm9kZU5hbWUoYSxcImlmcmFtZVwiKT9hLmNvbnRlbnREb2N1bWVudHx8YS5jb250ZW50V2luZG93LmRvY3VtZW50Om0ubWVyZ2UoW10sYS5jaGlsZE5vZGVzKX19LGZ1bmN0aW9uKGEsYil7bS5mblthXT1mdW5jdGlvbihjLGQpe3ZhciBlPW0ubWFwKHRoaXMsYixjKTtyZXR1cm5cIlVudGlsXCIhPT1hLnNsaWNlKC01KSYmKGQ9YyksZCYmXCJzdHJpbmdcIj09dHlwZW9mIGQmJihlPW0uZmlsdGVyKGQsZSkpLHRoaXMubGVuZ3RoPjEmJihDW2FdfHwoZT1tLnVuaXF1ZShlKSksQi50ZXN0KGEpJiYoZT1lLnJldmVyc2UoKSkpLHRoaXMucHVzaFN0YWNrKGUpfX0pO3ZhciBFPS9cXFMrL2csRj17fTtmdW5jdGlvbiBHKGEpe3ZhciBiPUZbYV09e307cmV0dXJuIG0uZWFjaChhLm1hdGNoKEUpfHxbXSxmdW5jdGlvbihhLGMpe2JbY109ITB9KSxifW0uQ2FsbGJhY2tzPWZ1bmN0aW9uKGEpe2E9XCJzdHJpbmdcIj09dHlwZW9mIGE/RlthXXx8RyhhKTptLmV4dGVuZCh7fSxhKTt2YXIgYixjLGQsZSxmLGcsaD1bXSxpPSFhLm9uY2UmJltdLGo9ZnVuY3Rpb24obCl7Zm9yKGM9YS5tZW1vcnkmJmwsZD0hMCxmPWd8fDAsZz0wLGU9aC5sZW5ndGgsYj0hMDtoJiZlPmY7ZisrKWlmKGhbZl0uYXBwbHkobFswXSxsWzFdKT09PSExJiZhLnN0b3BPbkZhbHNlKXtjPSExO2JyZWFrfWI9ITEsaCYmKGk/aS5sZW5ndGgmJmooaS5zaGlmdCgpKTpjP2g9W106ay5kaXNhYmxlKCkpfSxrPXthZGQ6ZnVuY3Rpb24oKXtpZihoKXt2YXIgZD1oLmxlbmd0aDshZnVuY3Rpb24gZihiKXttLmVhY2goYixmdW5jdGlvbihiLGMpe3ZhciBkPW0udHlwZShjKTtcImZ1bmN0aW9uXCI9PT1kP2EudW5pcXVlJiZrLmhhcyhjKXx8aC5wdXNoKGMpOmMmJmMubGVuZ3RoJiZcInN0cmluZ1wiIT09ZCYmZihjKX0pfShhcmd1bWVudHMpLGI/ZT1oLmxlbmd0aDpjJiYoZz1kLGooYykpfXJldHVybiB0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtyZXR1cm4gaCYmbS5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihhLGMpe3ZhciBkO3doaWxlKChkPW0uaW5BcnJheShjLGgsZCkpPi0xKWguc3BsaWNlKGQsMSksYiYmKGU+PWQmJmUtLSxmPj1kJiZmLS0pfSksdGhpc30saGFzOmZ1bmN0aW9uKGEpe3JldHVybiBhP20uaW5BcnJheShhLGgpPi0xOiEoIWh8fCFoLmxlbmd0aCl9LGVtcHR5OmZ1bmN0aW9uKCl7cmV0dXJuIGg9W10sZT0wLHRoaXN9LGRpc2FibGU6ZnVuY3Rpb24oKXtyZXR1cm4gaD1pPWM9dm9pZCAwLHRoaXN9LGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIWh9LGxvY2s6ZnVuY3Rpb24oKXtyZXR1cm4gaT12b2lkIDAsY3x8ay5kaXNhYmxlKCksdGhpc30sbG9ja2VkOmZ1bmN0aW9uKCl7cmV0dXJuIWl9LGZpcmVXaXRoOmZ1bmN0aW9uKGEsYyl7cmV0dXJuIWh8fGQmJiFpfHwoYz1jfHxbXSxjPVthLGMuc2xpY2U/Yy5zbGljZSgpOmNdLGI/aS5wdXNoKGMpOmooYykpLHRoaXN9LGZpcmU6ZnVuY3Rpb24oKXtyZXR1cm4gay5maXJlV2l0aCh0aGlzLGFyZ3VtZW50cyksdGhpc30sZmlyZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWR9fTtyZXR1cm4ga30sbS5leHRlbmQoe0RlZmVycmVkOmZ1bmN0aW9uKGEpe3ZhciBiPVtbXCJyZXNvbHZlXCIsXCJkb25lXCIsbS5DYWxsYmFja3MoXCJvbmNlIG1lbW9yeVwiKSxcInJlc29sdmVkXCJdLFtcInJlamVjdFwiLFwiZmFpbFwiLG0uQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIiksXCJyZWplY3RlZFwiXSxbXCJub3RpZnlcIixcInByb2dyZXNzXCIsbS5DYWxsYmFja3MoXCJtZW1vcnlcIildXSxjPVwicGVuZGluZ1wiLGQ9e3N0YXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGN9LGFsd2F5czpmdW5jdGlvbigpe3JldHVybiBlLmRvbmUoYXJndW1lbnRzKS5mYWlsKGFyZ3VtZW50cyksdGhpc30sdGhlbjpmdW5jdGlvbigpe3ZhciBhPWFyZ3VtZW50cztyZXR1cm4gbS5EZWZlcnJlZChmdW5jdGlvbihjKXttLmVhY2goYixmdW5jdGlvbihiLGYpe3ZhciBnPW0uaXNGdW5jdGlvbihhW2JdKSYmYVtiXTtlW2ZbMV1dKGZ1bmN0aW9uKCl7dmFyIGE9ZyYmZy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7YSYmbS5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/YS5wcm9taXNlKCkuZG9uZShjLnJlc29sdmUpLmZhaWwoYy5yZWplY3QpLnByb2dyZXNzKGMubm90aWZ5KTpjW2ZbMF0rXCJXaXRoXCJdKHRoaXM9PT1kP2MucHJvbWlzZSgpOnRoaXMsZz9bYV06YXJndW1lbnRzKX0pfSksYT1udWxsfSkucHJvbWlzZSgpfSxwcm9taXNlOmZ1bmN0aW9uKGEpe3JldHVybiBudWxsIT1hP20uZXh0ZW5kKGEsZCk6ZH19LGU9e307cmV0dXJuIGQucGlwZT1kLnRoZW4sbS5lYWNoKGIsZnVuY3Rpb24oYSxmKXt2YXIgZz1mWzJdLGg9ZlszXTtkW2ZbMV1dPWcuYWRkLGgmJmcuYWRkKGZ1bmN0aW9uKCl7Yz1ofSxiWzFeYV1bMl0uZGlzYWJsZSxiWzJdWzJdLmxvY2spLGVbZlswXV09ZnVuY3Rpb24oKXtyZXR1cm4gZVtmWzBdK1wiV2l0aFwiXSh0aGlzPT09ZT9kOnRoaXMsYXJndW1lbnRzKSx0aGlzfSxlW2ZbMF0rXCJXaXRoXCJdPWcuZmlyZVdpdGh9KSxkLnByb21pc2UoZSksYSYmYS5jYWxsKGUsZSksZX0sd2hlbjpmdW5jdGlvbihhKXt2YXIgYj0wLGM9ZC5jYWxsKGFyZ3VtZW50cyksZT1jLmxlbmd0aCxmPTEhPT1lfHxhJiZtLmlzRnVuY3Rpb24oYS5wcm9taXNlKT9lOjAsZz0xPT09Zj9hOm0uRGVmZXJyZWQoKSxoPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZnVuY3Rpb24oZSl7YlthXT10aGlzLGNbYV09YXJndW1lbnRzLmxlbmd0aD4xP2QuY2FsbChhcmd1bWVudHMpOmUsYz09PWk/Zy5ub3RpZnlXaXRoKGIsYyk6LS1mfHxnLnJlc29sdmVXaXRoKGIsYyl9fSxpLGosaztpZihlPjEpZm9yKGk9bmV3IEFycmF5KGUpLGo9bmV3IEFycmF5KGUpLGs9bmV3IEFycmF5KGUpO2U+YjtiKyspY1tiXSYmbS5pc0Z1bmN0aW9uKGNbYl0ucHJvbWlzZSk/Y1tiXS5wcm9taXNlKCkuZG9uZShoKGIsayxjKSkuZmFpbChnLnJlamVjdCkucHJvZ3Jlc3MoaChiLGosaSkpOi0tZjtyZXR1cm4gZnx8Zy5yZXNvbHZlV2l0aChrLGMpLGcucHJvbWlzZSgpfX0pO3ZhciBIO20uZm4ucmVhZHk9ZnVuY3Rpb24oYSl7cmV0dXJuIG0ucmVhZHkucHJvbWlzZSgpLmRvbmUoYSksdGhpc30sbS5leHRlbmQoe2lzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKGEpe2E/bS5yZWFkeVdhaXQrKzptLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24oYSl7aWYoYT09PSEwPyEtLW0ucmVhZHlXYWl0OiFtLmlzUmVhZHkpe2lmKCF5LmJvZHkpcmV0dXJuIHNldFRpbWVvdXQobS5yZWFkeSk7bS5pc1JlYWR5PSEwLGEhPT0hMCYmLS1tLnJlYWR5V2FpdD4wfHwoSC5yZXNvbHZlV2l0aCh5LFttXSksbS5mbi50cmlnZ2VySGFuZGxlciYmKG0oeSkudHJpZ2dlckhhbmRsZXIoXCJyZWFkeVwiKSxtKHkpLm9mZihcInJlYWR5XCIpKSl9fX0pO2Z1bmN0aW9uIEkoKXt5LmFkZEV2ZW50TGlzdGVuZXI/KHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIixKLCExKSxhLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsSiwhMSkpOih5LmRldGFjaEV2ZW50KFwib25yZWFkeXN0YXRlY2hhbmdlXCIsSiksYS5kZXRhY2hFdmVudChcIm9ubG9hZFwiLEopKX1mdW5jdGlvbiBKKCl7KHkuYWRkRXZlbnRMaXN0ZW5lcnx8XCJsb2FkXCI9PT1ldmVudC50eXBlfHxcImNvbXBsZXRlXCI9PT15LnJlYWR5U3RhdGUpJiYoSSgpLG0ucmVhZHkoKSl9bS5yZWFkeS5wcm9taXNlPWZ1bmN0aW9uKGIpe2lmKCFIKWlmKEg9bS5EZWZlcnJlZCgpLFwiY29tcGxldGVcIj09PXkucmVhZHlTdGF0ZSlzZXRUaW1lb3V0KG0ucmVhZHkpO2Vsc2UgaWYoeS5hZGRFdmVudExpc3RlbmVyKXkuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIixKLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsSiwhMSk7ZWxzZXt5LmF0dGFjaEV2ZW50KFwib25yZWFkeXN0YXRlY2hhbmdlXCIsSiksYS5hdHRhY2hFdmVudChcIm9ubG9hZFwiLEopO3ZhciBjPSExO3RyeXtjPW51bGw9PWEuZnJhbWVFbGVtZW50JiZ5LmRvY3VtZW50RWxlbWVudH1jYXRjaChkKXt9YyYmYy5kb1Njcm9sbCYmIWZ1bmN0aW9uIGUoKXtpZighbS5pc1JlYWR5KXt0cnl7Yy5kb1Njcm9sbChcImxlZnRcIil9Y2F0Y2goYSl7cmV0dXJuIHNldFRpbWVvdXQoZSw1MCl9SSgpLG0ucmVhZHkoKX19KCl9cmV0dXJuIEgucHJvbWlzZShiKX07dmFyIEs9XCJ1bmRlZmluZWRcIixMO2ZvcihMIGluIG0oaykpYnJlYWs7ay5vd25MYXN0PVwiMFwiIT09TCxrLmlubGluZUJsb2NrTmVlZHNMYXlvdXQ9ITEsbShmdW5jdGlvbigpe3ZhciBhLGIsYyxkO2M9eS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF0sYyYmYy5zdHlsZSYmKGI9eS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGQ9eS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGQuc3R5bGUuY3NzVGV4dD1cInBvc2l0aW9uOmFic29sdXRlO2JvcmRlcjowO3dpZHRoOjA7aGVpZ2h0OjA7dG9wOjA7bGVmdDotOTk5OXB4XCIsYy5hcHBlbmRDaGlsZChkKS5hcHBlbmRDaGlsZChiKSx0eXBlb2YgYi5zdHlsZS56b29tIT09SyYmKGIuc3R5bGUuY3NzVGV4dD1cImRpc3BsYXk6aW5saW5lO21hcmdpbjowO2JvcmRlcjowO3BhZGRpbmc6MXB4O3dpZHRoOjFweDt6b29tOjFcIixrLmlubGluZUJsb2NrTmVlZHNMYXlvdXQ9YT0zPT09Yi5vZmZzZXRXaWR0aCxhJiYoYy5zdHlsZS56b29tPTEpKSxjLnJlbW92ZUNoaWxkKGQpKX0pLGZ1bmN0aW9uKCl7dmFyIGE9eS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2lmKG51bGw9PWsuZGVsZXRlRXhwYW5kbyl7ay5kZWxldGVFeHBhbmRvPSEwO3RyeXtkZWxldGUgYS50ZXN0fWNhdGNoKGIpe2suZGVsZXRlRXhwYW5kbz0hMX19YT1udWxsfSgpLG0uYWNjZXB0RGF0YT1mdW5jdGlvbihhKXt2YXIgYj1tLm5vRGF0YVsoYS5ub2RlTmFtZStcIiBcIikudG9Mb3dlckNhc2UoKV0sYz0rYS5ub2RlVHlwZXx8MTtyZXR1cm4gMSE9PWMmJjkhPT1jPyExOiFifHxiIT09ITAmJmEuZ2V0QXR0cmlidXRlKFwiY2xhc3NpZFwiKT09PWJ9O3ZhciBNPS9eKD86XFx7W1xcd1xcV10qXFx9fFxcW1tcXHdcXFddKlxcXSkkLyxOPS8oW0EtWl0pL2c7ZnVuY3Rpb24gTyhhLGIsYyl7aWYodm9pZCAwPT09YyYmMT09PWEubm9kZVR5cGUpe3ZhciBkPVwiZGF0YS1cIitiLnJlcGxhY2UoTixcIi0kMVwiKS50b0xvd2VyQ2FzZSgpO2lmKGM9YS5nZXRBdHRyaWJ1dGUoZCksXCJzdHJpbmdcIj09dHlwZW9mIGMpe3RyeXtjPVwidHJ1ZVwiPT09Yz8hMDpcImZhbHNlXCI9PT1jPyExOlwibnVsbFwiPT09Yz9udWxsOitjK1wiXCI9PT1jPytjOk0udGVzdChjKT9tLnBhcnNlSlNPTihjKTpjfWNhdGNoKGUpe31tLmRhdGEoYSxiLGMpfWVsc2UgYz12b2lkIDB9cmV0dXJuIGN9ZnVuY3Rpb24gUChhKXt2YXIgYjtmb3IoYiBpbiBhKWlmKChcImRhdGFcIiE9PWJ8fCFtLmlzRW1wdHlPYmplY3QoYVtiXSkpJiZcInRvSlNPTlwiIT09YilyZXR1cm4hMTtcblxucmV0dXJuITB9ZnVuY3Rpb24gUShhLGIsZCxlKXtpZihtLmFjY2VwdERhdGEoYSkpe3ZhciBmLGcsaD1tLmV4cGFuZG8saT1hLm5vZGVUeXBlLGo9aT9tLmNhY2hlOmEsaz1pP2FbaF06YVtoXSYmaDtpZihrJiZqW2tdJiYoZXx8altrXS5kYXRhKXx8dm9pZCAwIT09ZHx8XCJzdHJpbmdcIiE9dHlwZW9mIGIpcmV0dXJuIGt8fChrPWk/YVtoXT1jLnBvcCgpfHxtLmd1aWQrKzpoKSxqW2tdfHwoaltrXT1pP3t9Ont0b0pTT046bS5ub29wfSksKFwib2JqZWN0XCI9PXR5cGVvZiBifHxcImZ1bmN0aW9uXCI9PXR5cGVvZiBiKSYmKGU/altrXT1tLmV4dGVuZChqW2tdLGIpOmpba10uZGF0YT1tLmV4dGVuZChqW2tdLmRhdGEsYikpLGc9altrXSxlfHwoZy5kYXRhfHwoZy5kYXRhPXt9KSxnPWcuZGF0YSksdm9pZCAwIT09ZCYmKGdbbS5jYW1lbENhc2UoYildPWQpLFwic3RyaW5nXCI9PXR5cGVvZiBiPyhmPWdbYl0sbnVsbD09ZiYmKGY9Z1ttLmNhbWVsQ2FzZShiKV0pKTpmPWcsZn19ZnVuY3Rpb24gUihhLGIsYyl7aWYobS5hY2NlcHREYXRhKGEpKXt2YXIgZCxlLGY9YS5ub2RlVHlwZSxnPWY/bS5jYWNoZTphLGg9Zj9hW20uZXhwYW5kb106bS5leHBhbmRvO2lmKGdbaF0pe2lmKGImJihkPWM/Z1toXTpnW2hdLmRhdGEpKXttLmlzQXJyYXkoYik/Yj1iLmNvbmNhdChtLm1hcChiLG0uY2FtZWxDYXNlKSk6YiBpbiBkP2I9W2JdOihiPW0uY2FtZWxDYXNlKGIpLGI9YiBpbiBkP1tiXTpiLnNwbGl0KFwiIFwiKSksZT1iLmxlbmd0aDt3aGlsZShlLS0pZGVsZXRlIGRbYltlXV07aWYoYz8hUChkKTohbS5pc0VtcHR5T2JqZWN0KGQpKXJldHVybn0oY3x8KGRlbGV0ZSBnW2hdLmRhdGEsUChnW2hdKSkpJiYoZj9tLmNsZWFuRGF0YShbYV0sITApOmsuZGVsZXRlRXhwYW5kb3x8ZyE9Zy53aW5kb3c/ZGVsZXRlIGdbaF06Z1toXT1udWxsKX19fW0uZXh0ZW5kKHtjYWNoZTp7fSxub0RhdGE6e1wiYXBwbGV0IFwiOiEwLFwiZW1iZWQgXCI6ITAsXCJvYmplY3QgXCI6XCJjbHNpZDpEMjdDREI2RS1BRTZELTExY2YtOTZCOC00NDQ1NTM1NDAwMDBcIn0saGFzRGF0YTpmdW5jdGlvbihhKXtyZXR1cm4gYT1hLm5vZGVUeXBlP20uY2FjaGVbYVttLmV4cGFuZG9dXTphW20uZXhwYW5kb10sISFhJiYhUChhKX0sZGF0YTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIFEoYSxiLGMpfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEsYil7cmV0dXJuIFIoYSxiKX0sX2RhdGE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBRKGEsYixjLCEwKX0sX3JlbW92ZURhdGE6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gUihhLGIsITApfX0pLG0uZm4uZXh0ZW5kKHtkYXRhOmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9dGhpc1swXSxnPWYmJmYuYXR0cmlidXRlcztpZih2b2lkIDA9PT1hKXtpZih0aGlzLmxlbmd0aCYmKGU9bS5kYXRhKGYpLDE9PT1mLm5vZGVUeXBlJiYhbS5fZGF0YShmLFwicGFyc2VkQXR0cnNcIikpKXtjPWcubGVuZ3RoO3doaWxlKGMtLSlnW2NdJiYoZD1nW2NdLm5hbWUsMD09PWQuaW5kZXhPZihcImRhdGEtXCIpJiYoZD1tLmNhbWVsQ2FzZShkLnNsaWNlKDUpKSxPKGYsZCxlW2RdKSkpO20uX2RhdGEoZixcInBhcnNlZEF0dHJzXCIsITApfXJldHVybiBlfXJldHVyblwib2JqZWN0XCI9PXR5cGVvZiBhP3RoaXMuZWFjaChmdW5jdGlvbigpe20uZGF0YSh0aGlzLGEpfSk6YXJndW1lbnRzLmxlbmd0aD4xP3RoaXMuZWFjaChmdW5jdGlvbigpe20uZGF0YSh0aGlzLGEsYil9KTpmP08oZixhLG0uZGF0YShmLGEpKTp2b2lkIDB9LHJlbW92ZURhdGE6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe20ucmVtb3ZlRGF0YSh0aGlzLGEpfSl9fSksbS5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtyZXR1cm4gYT8oYj0oYnx8XCJmeFwiKStcInF1ZXVlXCIsZD1tLl9kYXRhKGEsYiksYyYmKCFkfHxtLmlzQXJyYXkoYyk/ZD1tLl9kYXRhKGEsYixtLm1ha2VBcnJheShjKSk6ZC5wdXNoKGMpKSxkfHxbXSk6dm9pZCAwfSxkZXF1ZXVlOmZ1bmN0aW9uKGEsYil7Yj1ifHxcImZ4XCI7dmFyIGM9bS5xdWV1ZShhLGIpLGQ9Yy5sZW5ndGgsZT1jLnNoaWZ0KCksZj1tLl9xdWV1ZUhvb2tzKGEsYiksZz1mdW5jdGlvbigpe20uZGVxdWV1ZShhLGIpfTtcImlucHJvZ3Jlc3NcIj09PWUmJihlPWMuc2hpZnQoKSxkLS0pLGUmJihcImZ4XCI9PT1iJiZjLnVuc2hpZnQoXCJpbnByb2dyZXNzXCIpLGRlbGV0ZSBmLnN0b3AsZS5jYWxsKGEsZyxmKSksIWQmJmYmJmYuZW1wdHkuZmlyZSgpfSxfcXVldWVIb29rczpmdW5jdGlvbihhLGIpe3ZhciBjPWIrXCJxdWV1ZUhvb2tzXCI7cmV0dXJuIG0uX2RhdGEoYSxjKXx8bS5fZGF0YShhLGMse2VtcHR5Om0uQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIikuYWRkKGZ1bmN0aW9uKCl7bS5fcmVtb3ZlRGF0YShhLGIrXCJxdWV1ZVwiKSxtLl9yZW1vdmVEYXRhKGEsYyl9KX0pfX0pLG0uZm4uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGIpe3ZhciBjPTI7cmV0dXJuXCJzdHJpbmdcIiE9dHlwZW9mIGEmJihiPWEsYT1cImZ4XCIsYy0tKSxhcmd1bWVudHMubGVuZ3RoPGM/bS5xdWV1ZSh0aGlzWzBdLGEpOnZvaWQgMD09PWI/dGhpczp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYz1tLnF1ZXVlKHRoaXMsYSxiKTttLl9xdWV1ZUhvb2tzKHRoaXMsYSksXCJmeFwiPT09YSYmXCJpbnByb2dyZXNzXCIhPT1jWzBdJiZtLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXttLmRlcXVldWUodGhpcyxhKX0pfSxjbGVhclF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGF8fFwiZnhcIixbXSl9LHByb21pc2U6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPTEsZT1tLkRlZmVycmVkKCksZj10aGlzLGc9dGhpcy5sZW5ndGgsaD1mdW5jdGlvbigpey0tZHx8ZS5yZXNvbHZlV2l0aChmLFtmXSl9O1wic3RyaW5nXCIhPXR5cGVvZiBhJiYoYj1hLGE9dm9pZCAwKSxhPWF8fFwiZnhcIjt3aGlsZShnLS0pYz1tLl9kYXRhKGZbZ10sYStcInF1ZXVlSG9va3NcIiksYyYmYy5lbXB0eSYmKGQrKyxjLmVtcHR5LmFkZChoKSk7cmV0dXJuIGgoKSxlLnByb21pc2UoYil9fSk7dmFyIFM9L1srLV0/KD86XFxkKlxcLnwpXFxkKyg/OltlRV1bKy1dP1xcZCt8KS8uc291cmNlLFQ9W1wiVG9wXCIsXCJSaWdodFwiLFwiQm90dG9tXCIsXCJMZWZ0XCJdLFU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYT1ifHxhLFwibm9uZVwiPT09bS5jc3MoYSxcImRpc3BsYXlcIil8fCFtLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudCxhKX0sVj1tLmFjY2Vzcz1mdW5jdGlvbihhLGIsYyxkLGUsZixnKXt2YXIgaD0wLGk9YS5sZW5ndGgsaj1udWxsPT1jO2lmKFwib2JqZWN0XCI9PT1tLnR5cGUoYykpe2U9ITA7Zm9yKGggaW4gYyltLmFjY2VzcyhhLGIsaCxjW2hdLCEwLGYsZyl9ZWxzZSBpZih2b2lkIDAhPT1kJiYoZT0hMCxtLmlzRnVuY3Rpb24oZCl8fChnPSEwKSxqJiYoZz8oYi5jYWxsKGEsZCksYj1udWxsKTooaj1iLGI9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBqLmNhbGwobShhKSxjKX0pKSxiKSlmb3IoO2k+aDtoKyspYihhW2hdLGMsZz9kOmQuY2FsbChhW2hdLGgsYihhW2hdLGMpKSk7cmV0dXJuIGU/YTpqP2IuY2FsbChhKTppP2IoYVswXSxjKTpmfSxXPS9eKD86Y2hlY2tib3h8cmFkaW8pJC9pOyFmdW5jdGlvbigpe3ZhciBhPXkuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLGI9eS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGM9eS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7aWYoYi5pbm5lckhUTUw9XCIgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYSc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz5cIixrLmxlYWRpbmdXaGl0ZXNwYWNlPTM9PT1iLmZpcnN0Q2hpbGQubm9kZVR5cGUsay50Ym9keT0hYi5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRib2R5XCIpLmxlbmd0aCxrLmh0bWxTZXJpYWxpemU9ISFiLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwibGlua1wiKS5sZW5ndGgsay5odG1sNUNsb25lPVwiPDpuYXY+PC86bmF2PlwiIT09eS5jcmVhdGVFbGVtZW50KFwibmF2XCIpLmNsb25lTm9kZSghMCkub3V0ZXJIVE1MLGEudHlwZT1cImNoZWNrYm94XCIsYS5jaGVja2VkPSEwLGMuYXBwZW5kQ2hpbGQoYSksay5hcHBlbmRDaGVja2VkPWEuY2hlY2tlZCxiLmlubmVySFRNTD1cIjx0ZXh0YXJlYT54PC90ZXh0YXJlYT5cIixrLm5vQ2xvbmVDaGVja2VkPSEhYi5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5kZWZhdWx0VmFsdWUsYy5hcHBlbmRDaGlsZChiKSxiLmlubmVySFRNTD1cIjxpbnB1dCB0eXBlPSdyYWRpbycgY2hlY2tlZD0nY2hlY2tlZCcgbmFtZT0ndCcvPlwiLGsuY2hlY2tDbG9uZT1iLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxrLm5vQ2xvbmVFdmVudD0hMCxiLmF0dGFjaEV2ZW50JiYoYi5hdHRhY2hFdmVudChcIm9uY2xpY2tcIixmdW5jdGlvbigpe2subm9DbG9uZUV2ZW50PSExfSksYi5jbG9uZU5vZGUoITApLmNsaWNrKCkpLG51bGw9PWsuZGVsZXRlRXhwYW5kbyl7ay5kZWxldGVFeHBhbmRvPSEwO3RyeXtkZWxldGUgYi50ZXN0fWNhdGNoKGQpe2suZGVsZXRlRXhwYW5kbz0hMX19fSgpLGZ1bmN0aW9uKCl7dmFyIGIsYyxkPXkuY3JlYXRlRWxlbWVudChcImRpdlwiKTtmb3IoYiBpbntzdWJtaXQ6ITAsY2hhbmdlOiEwLGZvY3VzaW46ITB9KWM9XCJvblwiK2IsKGtbYitcIkJ1YmJsZXNcIl09YyBpbiBhKXx8KGQuc2V0QXR0cmlidXRlKGMsXCJ0XCIpLGtbYitcIkJ1YmJsZXNcIl09ZC5hdHRyaWJ1dGVzW2NdLmV4cGFuZG89PT0hMSk7ZD1udWxsfSgpO3ZhciBYPS9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhKSQvaSxZPS9ea2V5LyxaPS9eKD86bW91c2V8cG9pbnRlcnxjb250ZXh0bWVudSl8Y2xpY2svLCQ9L14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLF89L14oW14uXSopKD86XFwuKC4rKXwpJC87ZnVuY3Rpb24gYWEoKXtyZXR1cm4hMH1mdW5jdGlvbiBiYSgpe3JldHVybiExfWZ1bmN0aW9uIGNhKCl7dHJ5e3JldHVybiB5LmFjdGl2ZUVsZW1lbnR9Y2F0Y2goYSl7fX1tLmV2ZW50PXtnbG9iYWw6e30sYWRkOmZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGYsZyxoLGksaixrLGwsbixvLHAscSxyPW0uX2RhdGEoYSk7aWYocil7Yy5oYW5kbGVyJiYoaT1jLGM9aS5oYW5kbGVyLGU9aS5zZWxlY3RvciksYy5ndWlkfHwoYy5ndWlkPW0uZ3VpZCsrKSwoZz1yLmV2ZW50cyl8fChnPXIuZXZlbnRzPXt9KSwoaz1yLmhhbmRsZSl8fChrPXIuaGFuZGxlPWZ1bmN0aW9uKGEpe3JldHVybiB0eXBlb2YgbT09PUt8fGEmJm0uZXZlbnQudHJpZ2dlcmVkPT09YS50eXBlP3ZvaWQgMDptLmV2ZW50LmRpc3BhdGNoLmFwcGx5KGsuZWxlbSxhcmd1bWVudHMpfSxrLmVsZW09YSksYj0oYnx8XCJcIikubWF0Y2goRSl8fFtcIlwiXSxoPWIubGVuZ3RoO3doaWxlKGgtLSlmPV8uZXhlYyhiW2hdKXx8W10sbz1xPWZbMV0scD0oZlsyXXx8XCJcIikuc3BsaXQoXCIuXCIpLnNvcnQoKSxvJiYoaj1tLmV2ZW50LnNwZWNpYWxbb118fHt9LG89KGU/ai5kZWxlZ2F0ZVR5cGU6ai5iaW5kVHlwZSl8fG8saj1tLmV2ZW50LnNwZWNpYWxbb118fHt9LGw9bS5leHRlbmQoe3R5cGU6byxvcmlnVHlwZTpxLGRhdGE6ZCxoYW5kbGVyOmMsZ3VpZDpjLmd1aWQsc2VsZWN0b3I6ZSxuZWVkc0NvbnRleHQ6ZSYmbS5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KGUpLG5hbWVzcGFjZTpwLmpvaW4oXCIuXCIpfSxpKSwobj1nW29dKXx8KG49Z1tvXT1bXSxuLmRlbGVnYXRlQ291bnQ9MCxqLnNldHVwJiZqLnNldHVwLmNhbGwoYSxkLHAsaykhPT0hMXx8KGEuYWRkRXZlbnRMaXN0ZW5lcj9hLmFkZEV2ZW50TGlzdGVuZXIobyxrLCExKTphLmF0dGFjaEV2ZW50JiZhLmF0dGFjaEV2ZW50KFwib25cIitvLGspKSksai5hZGQmJihqLmFkZC5jYWxsKGEsbCksbC5oYW5kbGVyLmd1aWR8fChsLmhhbmRsZXIuZ3VpZD1jLmd1aWQpKSxlP24uc3BsaWNlKG4uZGVsZWdhdGVDb3VudCsrLDAsbCk6bi5wdXNoKGwpLG0uZXZlbnQuZ2xvYmFsW29dPSEwKTthPW51bGx9fSxyZW1vdmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZixnLGgsaSxqLGssbCxuLG8scCxxLHI9bS5oYXNEYXRhKGEpJiZtLl9kYXRhKGEpO2lmKHImJihrPXIuZXZlbnRzKSl7Yj0oYnx8XCJcIikubWF0Y2goRSl8fFtcIlwiXSxqPWIubGVuZ3RoO3doaWxlKGotLSlpZihoPV8uZXhlYyhiW2pdKXx8W10sbz1xPWhbMV0scD0oaFsyXXx8XCJcIikuc3BsaXQoXCIuXCIpLnNvcnQoKSxvKXtsPW0uZXZlbnQuc3BlY2lhbFtvXXx8e30sbz0oZD9sLmRlbGVnYXRlVHlwZTpsLmJpbmRUeXBlKXx8byxuPWtbb118fFtdLGg9aFsyXSYmbmV3IFJlZ0V4cChcIihefFxcXFwuKVwiK3Auam9pbihcIlxcXFwuKD86LipcXFxcLnwpXCIpK1wiKFxcXFwufCQpXCIpLGk9Zj1uLmxlbmd0aDt3aGlsZShmLS0pZz1uW2ZdLCFlJiZxIT09Zy5vcmlnVHlwZXx8YyYmYy5ndWlkIT09Zy5ndWlkfHxoJiYhaC50ZXN0KGcubmFtZXNwYWNlKXx8ZCYmZCE9PWcuc2VsZWN0b3ImJihcIioqXCIhPT1kfHwhZy5zZWxlY3Rvcil8fChuLnNwbGljZShmLDEpLGcuc2VsZWN0b3ImJm4uZGVsZWdhdGVDb3VudC0tLGwucmVtb3ZlJiZsLnJlbW92ZS5jYWxsKGEsZykpO2kmJiFuLmxlbmd0aCYmKGwudGVhcmRvd24mJmwudGVhcmRvd24uY2FsbChhLHAsci5oYW5kbGUpIT09ITF8fG0ucmVtb3ZlRXZlbnQoYSxvLHIuaGFuZGxlKSxkZWxldGUga1tvXSl9ZWxzZSBmb3IobyBpbiBrKW0uZXZlbnQucmVtb3ZlKGEsbytiW2pdLGMsZCwhMCk7bS5pc0VtcHR5T2JqZWN0KGspJiYoZGVsZXRlIHIuaGFuZGxlLG0uX3JlbW92ZURhdGEoYSxcImV2ZW50c1wiKSl9fSx0cmlnZ2VyOmZ1bmN0aW9uKGIsYyxkLGUpe3ZhciBmLGcsaCxpLGssbCxuLG89W2R8fHldLHA9ai5jYWxsKGIsXCJ0eXBlXCIpP2IudHlwZTpiLHE9ai5jYWxsKGIsXCJuYW1lc3BhY2VcIik/Yi5uYW1lc3BhY2Uuc3BsaXQoXCIuXCIpOltdO2lmKGg9bD1kPWR8fHksMyE9PWQubm9kZVR5cGUmJjghPT1kLm5vZGVUeXBlJiYhJC50ZXN0KHArbS5ldmVudC50cmlnZ2VyZWQpJiYocC5pbmRleE9mKFwiLlwiKT49MCYmKHE9cC5zcGxpdChcIi5cIikscD1xLnNoaWZ0KCkscS5zb3J0KCkpLGc9cC5pbmRleE9mKFwiOlwiKTwwJiZcIm9uXCIrcCxiPWJbbS5leHBhbmRvXT9iOm5ldyBtLkV2ZW50KHAsXCJvYmplY3RcIj09dHlwZW9mIGImJmIpLGIuaXNUcmlnZ2VyPWU/MjozLGIubmFtZXNwYWNlPXEuam9pbihcIi5cIiksYi5uYW1lc3BhY2VfcmU9Yi5uYW1lc3BhY2U/bmV3IFJlZ0V4cChcIihefFxcXFwuKVwiK3Euam9pbihcIlxcXFwuKD86LipcXFxcLnwpXCIpK1wiKFxcXFwufCQpXCIpOm51bGwsYi5yZXN1bHQ9dm9pZCAwLGIudGFyZ2V0fHwoYi50YXJnZXQ9ZCksYz1udWxsPT1jP1tiXTptLm1ha2VBcnJheShjLFtiXSksaz1tLmV2ZW50LnNwZWNpYWxbcF18fHt9LGV8fCFrLnRyaWdnZXJ8fGsudHJpZ2dlci5hcHBseShkLGMpIT09ITEpKXtpZighZSYmIWsubm9CdWJibGUmJiFtLmlzV2luZG93KGQpKXtmb3IoaT1rLmRlbGVnYXRlVHlwZXx8cCwkLnRlc3QoaStwKXx8KGg9aC5wYXJlbnROb2RlKTtoO2g9aC5wYXJlbnROb2RlKW8ucHVzaChoKSxsPWg7bD09PShkLm93bmVyRG9jdW1lbnR8fHkpJiZvLnB1c2gobC5kZWZhdWx0Vmlld3x8bC5wYXJlbnRXaW5kb3d8fGEpfW49MDt3aGlsZSgoaD1vW24rK10pJiYhYi5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKWIudHlwZT1uPjE/aTprLmJpbmRUeXBlfHxwLGY9KG0uX2RhdGEoaCxcImV2ZW50c1wiKXx8e30pW2IudHlwZV0mJm0uX2RhdGEoaCxcImhhbmRsZVwiKSxmJiZmLmFwcGx5KGgsYyksZj1nJiZoW2ddLGYmJmYuYXBwbHkmJm0uYWNjZXB0RGF0YShoKSYmKGIucmVzdWx0PWYuYXBwbHkoaCxjKSxiLnJlc3VsdD09PSExJiZiLnByZXZlbnREZWZhdWx0KCkpO2lmKGIudHlwZT1wLCFlJiYhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmKCFrLl9kZWZhdWx0fHxrLl9kZWZhdWx0LmFwcGx5KG8ucG9wKCksYyk9PT0hMSkmJm0uYWNjZXB0RGF0YShkKSYmZyYmZFtwXSYmIW0uaXNXaW5kb3coZCkpe2w9ZFtnXSxsJiYoZFtnXT1udWxsKSxtLmV2ZW50LnRyaWdnZXJlZD1wO3RyeXtkW3BdKCl9Y2F0Y2gocil7fW0uZXZlbnQudHJpZ2dlcmVkPXZvaWQgMCxsJiYoZFtnXT1sKX1yZXR1cm4gYi5yZXN1bHR9fSxkaXNwYXRjaDpmdW5jdGlvbihhKXthPW0uZXZlbnQuZml4KGEpO3ZhciBiLGMsZSxmLGcsaD1bXSxpPWQuY2FsbChhcmd1bWVudHMpLGo9KG0uX2RhdGEodGhpcyxcImV2ZW50c1wiKXx8e30pW2EudHlwZV18fFtdLGs9bS5ldmVudC5zcGVjaWFsW2EudHlwZV18fHt9O2lmKGlbMF09YSxhLmRlbGVnYXRlVGFyZ2V0PXRoaXMsIWsucHJlRGlzcGF0Y2h8fGsucHJlRGlzcGF0Y2guY2FsbCh0aGlzLGEpIT09ITEpe2g9bS5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsYSxqKSxiPTA7d2hpbGUoKGY9aFtiKytdKSYmIWEuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSl7YS5jdXJyZW50VGFyZ2V0PWYuZWxlbSxnPTA7d2hpbGUoKGU9Zi5oYW5kbGVyc1tnKytdKSYmIWEuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkoIWEubmFtZXNwYWNlX3JlfHxhLm5hbWVzcGFjZV9yZS50ZXN0KGUubmFtZXNwYWNlKSkmJihhLmhhbmRsZU9iaj1lLGEuZGF0YT1lLmRhdGEsYz0oKG0uZXZlbnQuc3BlY2lhbFtlLm9yaWdUeXBlXXx8e30pLmhhbmRsZXx8ZS5oYW5kbGVyKS5hcHBseShmLmVsZW0saSksdm9pZCAwIT09YyYmKGEucmVzdWx0PWMpPT09ITEmJihhLnByZXZlbnREZWZhdWx0KCksYS5zdG9wUHJvcGFnYXRpb24oKSkpfXJldHVybiBrLnBvc3REaXNwYXRjaCYmay5wb3N0RGlzcGF0Y2guY2FsbCh0aGlzLGEpLGEucmVzdWx0fX0saGFuZGxlcnM6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZixnPVtdLGg9Yi5kZWxlZ2F0ZUNvdW50LGk9YS50YXJnZXQ7aWYoaCYmaS5ub2RlVHlwZSYmKCFhLmJ1dHRvbnx8XCJjbGlja1wiIT09YS50eXBlKSlmb3IoO2khPXRoaXM7aT1pLnBhcmVudE5vZGV8fHRoaXMpaWYoMT09PWkubm9kZVR5cGUmJihpLmRpc2FibGVkIT09ITB8fFwiY2xpY2tcIiE9PWEudHlwZSkpe2ZvcihlPVtdLGY9MDtoPmY7ZisrKWQ9YltmXSxjPWQuc2VsZWN0b3IrXCIgXCIsdm9pZCAwPT09ZVtjXSYmKGVbY109ZC5uZWVkc0NvbnRleHQ/bShjLHRoaXMpLmluZGV4KGkpPj0wOm0uZmluZChjLHRoaXMsbnVsbCxbaV0pLmxlbmd0aCksZVtjXSYmZS5wdXNoKGQpO2UubGVuZ3RoJiZnLnB1c2goe2VsZW06aSxoYW5kbGVyczplfSl9cmV0dXJuIGg8Yi5sZW5ndGgmJmcucHVzaCh7ZWxlbTp0aGlzLGhhbmRsZXJzOmIuc2xpY2UoaCl9KSxnfSxmaXg6ZnVuY3Rpb24oYSl7aWYoYVttLmV4cGFuZG9dKXJldHVybiBhO3ZhciBiLGMsZCxlPWEudHlwZSxmPWEsZz10aGlzLmZpeEhvb2tzW2VdO2d8fCh0aGlzLmZpeEhvb2tzW2VdPWc9Wi50ZXN0KGUpP3RoaXMubW91c2VIb29rczpZLnRlc3QoZSk/dGhpcy5rZXlIb29rczp7fSksZD1nLnByb3BzP3RoaXMucHJvcHMuY29uY2F0KGcucHJvcHMpOnRoaXMucHJvcHMsYT1uZXcgbS5FdmVudChmKSxiPWQubGVuZ3RoO3doaWxlKGItLSljPWRbYl0sYVtjXT1mW2NdO3JldHVybiBhLnRhcmdldHx8KGEudGFyZ2V0PWYuc3JjRWxlbWVudHx8eSksMz09PWEudGFyZ2V0Lm5vZGVUeXBlJiYoYS50YXJnZXQ9YS50YXJnZXQucGFyZW50Tm9kZSksYS5tZXRhS2V5PSEhYS5tZXRhS2V5LGcuZmlsdGVyP2cuZmlsdGVyKGEsZik6YX0scHJvcHM6XCJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2hcIi5zcGxpdChcIiBcIiksZml4SG9va3M6e30sa2V5SG9va3M6e3Byb3BzOlwiY2hhciBjaGFyQ29kZSBrZXkga2V5Q29kZVwiLnNwbGl0KFwiIFwiKSxmaWx0ZXI6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbnVsbD09YS53aGljaCYmKGEud2hpY2g9bnVsbCE9Yi5jaGFyQ29kZT9iLmNoYXJDb2RlOmIua2V5Q29kZSksYX19LG1vdXNlSG9va3M6e3Byb3BzOlwiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIGZyb21FbGVtZW50IG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50XCIuc3BsaXQoXCIgXCIpLGZpbHRlcjpmdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmPWIuYnV0dG9uLGc9Yi5mcm9tRWxlbWVudDtyZXR1cm4gbnVsbD09YS5wYWdlWCYmbnVsbCE9Yi5jbGllbnRYJiYoZD1hLnRhcmdldC5vd25lckRvY3VtZW50fHx5LGU9ZC5kb2N1bWVudEVsZW1lbnQsYz1kLmJvZHksYS5wYWdlWD1iLmNsaWVudFgrKGUmJmUuc2Nyb2xsTGVmdHx8YyYmYy5zY3JvbGxMZWZ0fHwwKS0oZSYmZS5jbGllbnRMZWZ0fHxjJiZjLmNsaWVudExlZnR8fDApLGEucGFnZVk9Yi5jbGllbnRZKyhlJiZlLnNjcm9sbFRvcHx8YyYmYy5zY3JvbGxUb3B8fDApLShlJiZlLmNsaWVudFRvcHx8YyYmYy5jbGllbnRUb3B8fDApKSwhYS5yZWxhdGVkVGFyZ2V0JiZnJiYoYS5yZWxhdGVkVGFyZ2V0PWc9PT1hLnRhcmdldD9iLnRvRWxlbWVudDpnKSxhLndoaWNofHx2b2lkIDA9PT1mfHwoYS53aGljaD0xJmY/MToyJmY/Mzo0JmY/MjowKSxhfX0sc3BlY2lhbDp7bG9hZDp7bm9CdWJibGU6ITB9LGZvY3VzOnt0cmlnZ2VyOmZ1bmN0aW9uKCl7aWYodGhpcyE9PWNhKCkmJnRoaXMuZm9jdXMpdHJ5e3JldHVybiB0aGlzLmZvY3VzKCksITF9Y2F0Y2goYSl7fX0sZGVsZWdhdGVUeXBlOlwiZm9jdXNpblwifSxibHVyOnt0cmlnZ2VyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXM9PT1jYSgpJiZ0aGlzLmJsdXI/KHRoaXMuYmx1cigpLCExKTp2b2lkIDB9LGRlbGVnYXRlVHlwZTpcImZvY3Vzb3V0XCJ9LGNsaWNrOnt0cmlnZ2VyOmZ1bmN0aW9uKCl7cmV0dXJuIG0ubm9kZU5hbWUodGhpcyxcImlucHV0XCIpJiZcImNoZWNrYm94XCI9PT10aGlzLnR5cGUmJnRoaXMuY2xpY2s/KHRoaXMuY2xpY2soKSwhMSk6dm9pZCAwfSxfZGVmYXVsdDpmdW5jdGlvbihhKXtyZXR1cm4gbS5ub2RlTmFtZShhLnRhcmdldCxcImFcIil9fSxiZWZvcmV1bmxvYWQ6e3Bvc3REaXNwYXRjaDpmdW5jdGlvbihhKXt2b2lkIDAhPT1hLnJlc3VsdCYmYS5vcmlnaW5hbEV2ZW50JiYoYS5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlPWEucmVzdWx0KX19fSxzaW11bGF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1tLmV4dGVuZChuZXcgbS5FdmVudCxjLHt0eXBlOmEsaXNTaW11bGF0ZWQ6ITAsb3JpZ2luYWxFdmVudDp7fX0pO2Q/bS5ldmVudC50cmlnZ2VyKGUsbnVsbCxiKTptLmV2ZW50LmRpc3BhdGNoLmNhbGwoYixlKSxlLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZjLnByZXZlbnREZWZhdWx0KCl9fSxtLnJlbW92ZUV2ZW50PXkucmVtb3ZlRXZlbnRMaXN0ZW5lcj9mdW5jdGlvbihhLGIsYyl7YS5yZW1vdmVFdmVudExpc3RlbmVyJiZhLnJlbW92ZUV2ZW50TGlzdGVuZXIoYixjLCExKX06ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVwib25cIitiO2EuZGV0YWNoRXZlbnQmJih0eXBlb2YgYVtkXT09PUsmJihhW2RdPW51bGwpLGEuZGV0YWNoRXZlbnQoZCxjKSl9LG0uRXZlbnQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcyBpbnN0YW5jZW9mIG0uRXZlbnQ/KGEmJmEudHlwZT8odGhpcy5vcmlnaW5hbEV2ZW50PWEsdGhpcy50eXBlPWEudHlwZSx0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1hLmRlZmF1bHRQcmV2ZW50ZWR8fHZvaWQgMD09PWEuZGVmYXVsdFByZXZlbnRlZCYmYS5yZXR1cm5WYWx1ZT09PSExP2FhOmJhKTp0aGlzLnR5cGU9YSxiJiZtLmV4dGVuZCh0aGlzLGIpLHRoaXMudGltZVN0YW1wPWEmJmEudGltZVN0YW1wfHxtLm5vdygpLHZvaWQodGhpc1ttLmV4cGFuZG9dPSEwKSk6bmV3IG0uRXZlbnQoYSxiKX0sbS5FdmVudC5wcm90b3R5cGU9e2lzRGVmYXVsdFByZXZlbnRlZDpiYSxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpiYSxpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDpiYSxwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1hYSxhJiYoYS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6YS5yZXR1cm5WYWx1ZT0hMSl9LHN0b3BQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkPWFhLGEmJihhLnN0b3BQcm9wYWdhdGlvbiYmYS5zdG9wUHJvcGFnYXRpb24oKSxhLmNhbmNlbEJ1YmJsZT0hMCl9LHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkPWFhLGEmJmEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uJiZhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHRoaXMuc3RvcFByb3BhZ2F0aW9uKCl9fSxtLmVhY2goe21vdXNlZW50ZXI6XCJtb3VzZW92ZXJcIixtb3VzZWxlYXZlOlwibW91c2VvdXRcIixwb2ludGVyZW50ZXI6XCJwb2ludGVyb3ZlclwiLHBvaW50ZXJsZWF2ZTpcInBvaW50ZXJvdXRcIn0sZnVuY3Rpb24oYSxiKXttLmV2ZW50LnNwZWNpYWxbYV09e2RlbGVnYXRlVHlwZTpiLGJpbmRUeXBlOmIsaGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBjLGQ9dGhpcyxlPWEucmVsYXRlZFRhcmdldCxmPWEuaGFuZGxlT2JqO3JldHVybighZXx8ZSE9PWQmJiFtLmNvbnRhaW5zKGQsZSkpJiYoYS50eXBlPWYub3JpZ1R5cGUsYz1mLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGEudHlwZT1iKSxjfX19KSxrLnN1Ym1pdEJ1YmJsZXN8fChtLmV2ZW50LnNwZWNpYWwuc3VibWl0PXtzZXR1cDpmdW5jdGlvbigpe3JldHVybiBtLm5vZGVOYW1lKHRoaXMsXCJmb3JtXCIpPyExOnZvaWQgbS5ldmVudC5hZGQodGhpcyxcImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdFwiLGZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0LGM9bS5ub2RlTmFtZShiLFwiaW5wdXRcIil8fG0ubm9kZU5hbWUoYixcImJ1dHRvblwiKT9iLmZvcm06dm9pZCAwO2MmJiFtLl9kYXRhKGMsXCJzdWJtaXRCdWJibGVzXCIpJiYobS5ldmVudC5hZGQoYyxcInN1Ym1pdC5fc3VibWl0XCIsZnVuY3Rpb24oYSl7YS5fc3VibWl0X2J1YmJsZT0hMH0pLG0uX2RhdGEoYyxcInN1Ym1pdEJ1YmJsZXNcIiwhMCkpfSl9LHBvc3REaXNwYXRjaDpmdW5jdGlvbihhKXthLl9zdWJtaXRfYnViYmxlJiYoZGVsZXRlIGEuX3N1Ym1pdF9idWJibGUsdGhpcy5wYXJlbnROb2RlJiYhYS5pc1RyaWdnZXImJm0uZXZlbnQuc2ltdWxhdGUoXCJzdWJtaXRcIix0aGlzLnBhcmVudE5vZGUsYSwhMCkpfSx0ZWFyZG93bjpmdW5jdGlvbigpe3JldHVybiBtLm5vZGVOYW1lKHRoaXMsXCJmb3JtXCIpPyExOnZvaWQgbS5ldmVudC5yZW1vdmUodGhpcyxcIi5fc3VibWl0XCIpfX0pLGsuY2hhbmdlQnViYmxlc3x8KG0uZXZlbnQuc3BlY2lhbC5jaGFuZ2U9e3NldHVwOmZ1bmN0aW9uKCl7cmV0dXJuIFgudGVzdCh0aGlzLm5vZGVOYW1lKT8oKFwiY2hlY2tib3hcIj09PXRoaXMudHlwZXx8XCJyYWRpb1wiPT09dGhpcy50eXBlKSYmKG0uZXZlbnQuYWRkKHRoaXMsXCJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlXCIsZnVuY3Rpb24oYSl7XCJjaGVja2VkXCI9PT1hLm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lJiYodGhpcy5fanVzdF9jaGFuZ2VkPSEwKX0pLG0uZXZlbnQuYWRkKHRoaXMsXCJjbGljay5fY2hhbmdlXCIsZnVuY3Rpb24oYSl7dGhpcy5fanVzdF9jaGFuZ2VkJiYhYS5pc1RyaWdnZXImJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITEpLG0uZXZlbnQuc2ltdWxhdGUoXCJjaGFuZ2VcIix0aGlzLGEsITApfSkpLCExKTp2b2lkIG0uZXZlbnQuYWRkKHRoaXMsXCJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlXCIsZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQ7WC50ZXN0KGIubm9kZU5hbWUpJiYhbS5fZGF0YShiLFwiY2hhbmdlQnViYmxlc1wiKSYmKG0uZXZlbnQuYWRkKGIsXCJjaGFuZ2UuX2NoYW5nZVwiLGZ1bmN0aW9uKGEpeyF0aGlzLnBhcmVudE5vZGV8fGEuaXNTaW11bGF0ZWR8fGEuaXNUcmlnZ2VyfHxtLmV2ZW50LnNpbXVsYXRlKFwiY2hhbmdlXCIsdGhpcy5wYXJlbnROb2RlLGEsITApfSksbS5fZGF0YShiLFwiY2hhbmdlQnViYmxlc1wiLCEwKSl9KX0saGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0O3JldHVybiB0aGlzIT09Ynx8YS5pc1NpbXVsYXRlZHx8YS5pc1RyaWdnZXJ8fFwicmFkaW9cIiE9PWIudHlwZSYmXCJjaGVja2JveFwiIT09Yi50eXBlP2EuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpOnZvaWQgMH0sdGVhcmRvd246ZnVuY3Rpb24oKXtyZXR1cm4gbS5ldmVudC5yZW1vdmUodGhpcyxcIi5fY2hhbmdlXCIpLCFYLnRlc3QodGhpcy5ub2RlTmFtZSl9fSksay5mb2N1c2luQnViYmxlc3x8bS5lYWNoKHtmb2N1czpcImZvY3VzaW5cIixibHVyOlwiZm9jdXNvdXRcIn0sZnVuY3Rpb24oYSxiKXt2YXIgYz1mdW5jdGlvbihhKXttLmV2ZW50LnNpbXVsYXRlKGIsYS50YXJnZXQsbS5ldmVudC5maXgoYSksITApfTttLmV2ZW50LnNwZWNpYWxbYl09e3NldHVwOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vd25lckRvY3VtZW50fHx0aGlzLGU9bS5fZGF0YShkLGIpO2V8fGQuYWRkRXZlbnRMaXN0ZW5lcihhLGMsITApLG0uX2RhdGEoZCxiLChlfHwwKSsxKX0sdGVhcmRvd246ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm93bmVyRG9jdW1lbnR8fHRoaXMsZT1tLl9kYXRhKGQsYiktMTtlP20uX2RhdGEoZCxiLGUpOihkLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSxjLCEwKSxtLl9yZW1vdmVEYXRhKGQsYikpfX19KSxtLmZuLmV4dGVuZCh7b246ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZixnO2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhKXtcInN0cmluZ1wiIT10eXBlb2YgYiYmKGM9Y3x8YixiPXZvaWQgMCk7Zm9yKGYgaW4gYSl0aGlzLm9uKGYsYixjLGFbZl0sZSk7cmV0dXJuIHRoaXN9aWYobnVsbD09YyYmbnVsbD09ZD8oZD1iLGM9Yj12b2lkIDApOm51bGw9PWQmJihcInN0cmluZ1wiPT10eXBlb2YgYj8oZD1jLGM9dm9pZCAwKTooZD1jLGM9YixiPXZvaWQgMCkpLGQ9PT0hMSlkPWJhO2Vsc2UgaWYoIWQpcmV0dXJuIHRoaXM7cmV0dXJuIDE9PT1lJiYoZz1kLGQ9ZnVuY3Rpb24oYSl7cmV0dXJuIG0oKS5vZmYoYSksZy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGQuZ3VpZD1nLmd1aWR8fChnLmd1aWQ9bS5ndWlkKyspKSx0aGlzLmVhY2goZnVuY3Rpb24oKXttLmV2ZW50LmFkZCh0aGlzLGEsZCxjLGIpfSl9LG9uZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5vbihhLGIsYyxkLDEpfSxvZmY6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU7aWYoYSYmYS5wcmV2ZW50RGVmYXVsdCYmYS5oYW5kbGVPYmopcmV0dXJuIGQ9YS5oYW5kbGVPYmosbShhLmRlbGVnYXRlVGFyZ2V0KS5vZmYoZC5uYW1lc3BhY2U/ZC5vcmlnVHlwZStcIi5cIitkLm5hbWVzcGFjZTpkLm9yaWdUeXBlLGQuc2VsZWN0b3IsZC5oYW5kbGVyKSx0aGlzO2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhKXtmb3IoZSBpbiBhKXRoaXMub2ZmKGUsYixhW2VdKTtyZXR1cm4gdGhpc31yZXR1cm4oYj09PSExfHxcImZ1bmN0aW9uXCI9PXR5cGVvZiBiKSYmKGM9YixiPXZvaWQgMCksYz09PSExJiYoYz1iYSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7bS5ldmVudC5yZW1vdmUodGhpcyxhLGMsYil9KX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXttLmV2ZW50LnRyaWdnZXIoYSxiLHRoaXMpfSl9LHRyaWdnZXJIYW5kbGVyOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpc1swXTtyZXR1cm4gYz9tLmV2ZW50LnRyaWdnZXIoYSxiLGMsITApOnZvaWQgMH19KTtmdW5jdGlvbiBkYShhKXt2YXIgYj1lYS5zcGxpdChcInxcIiksYz1hLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtpZihjLmNyZWF0ZUVsZW1lbnQpd2hpbGUoYi5sZW5ndGgpYy5jcmVhdGVFbGVtZW50KGIucG9wKCkpO3JldHVybiBjfXZhciBlYT1cImFiYnJ8YXJ0aWNsZXxhc2lkZXxhdWRpb3xiZGl8Y2FudmFzfGRhdGF8ZGF0YWxpc3R8ZGV0YWlsc3xmaWdjYXB0aW9ufGZpZ3VyZXxmb290ZXJ8aGVhZGVyfGhncm91cHxtYXJrfG1ldGVyfG5hdnxvdXRwdXR8cHJvZ3Jlc3N8c2VjdGlvbnxzdW1tYXJ5fHRpbWV8dmlkZW9cIixmYT0vIGpRdWVyeVxcZCs9XCIoPzpudWxsfFxcZCspXCIvZyxnYT1uZXcgUmVnRXhwKFwiPCg/OlwiK2VhK1wiKVtcXFxccy8+XVwiLFwiaVwiKSxoYT0vXlxccysvLGlhPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcXHc6XSspW14+XSopXFwvPi9naSxqYT0vPChbXFx3Ol0rKS8sa2E9Lzx0Ym9keS9pLGxhPS88fCYjP1xcdys7LyxtYT0vPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLG5hPS9jaGVja2VkXFxzKig/OltePV18PVxccyouY2hlY2tlZC4pL2ksb2E9L14kfFxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSxwYT0vXnRydWVcXC8oLiopLyxxYT0vXlxccyo8ISg/OlxcW0NEQVRBXFxbfC0tKXwoPzpcXF1cXF18LS0pPlxccyokL2cscmE9e29wdGlvbjpbMSxcIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz5cIixcIjwvc2VsZWN0PlwiXSxsZWdlbmQ6WzEsXCI8ZmllbGRzZXQ+XCIsXCI8L2ZpZWxkc2V0PlwiXSxhcmVhOlsxLFwiPG1hcD5cIixcIjwvbWFwPlwiXSxwYXJhbTpbMSxcIjxvYmplY3Q+XCIsXCI8L29iamVjdD5cIl0sdGhlYWQ6WzEsXCI8dGFibGU+XCIsXCI8L3RhYmxlPlwiXSx0cjpbMixcIjx0YWJsZT48dGJvZHk+XCIsXCI8L3Rib2R5PjwvdGFibGU+XCJdLGNvbDpbMixcIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+XCIsXCI8L2NvbGdyb3VwPjwvdGFibGU+XCJdLHRkOlszLFwiPHRhYmxlPjx0Ym9keT48dHI+XCIsXCI8L3RyPjwvdGJvZHk+PC90YWJsZT5cIl0sX2RlZmF1bHQ6ay5odG1sU2VyaWFsaXplP1swLFwiXCIsXCJcIl06WzEsXCJYPGRpdj5cIixcIjwvZGl2PlwiXX0sc2E9ZGEoeSksdGE9c2EuYXBwZW5kQ2hpbGQoeS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpKTtyYS5vcHRncm91cD1yYS5vcHRpb24scmEudGJvZHk9cmEudGZvb3Q9cmEuY29sZ3JvdXA9cmEuY2FwdGlvbj1yYS50aGVhZCxyYS50aD1yYS50ZDtmdW5jdGlvbiB1YShhLGIpe3ZhciBjLGQsZT0wLGY9dHlwZW9mIGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPT1LP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYnx8XCIqXCIpOnR5cGVvZiBhLnF1ZXJ5U2VsZWN0b3JBbGwhPT1LP2EucXVlcnlTZWxlY3RvckFsbChifHxcIipcIik6dm9pZCAwO2lmKCFmKWZvcihmPVtdLGM9YS5jaGlsZE5vZGVzfHxhO251bGwhPShkPWNbZV0pO2UrKykhYnx8bS5ub2RlTmFtZShkLGIpP2YucHVzaChkKTptLm1lcmdlKGYsdWEoZCxiKSk7cmV0dXJuIHZvaWQgMD09PWJ8fGImJm0ubm9kZU5hbWUoYSxiKT9tLm1lcmdlKFthXSxmKTpmfWZ1bmN0aW9uIHZhKGEpe1cudGVzdChhLnR5cGUpJiYoYS5kZWZhdWx0Q2hlY2tlZD1hLmNoZWNrZWQpfWZ1bmN0aW9uIHdhKGEsYil7cmV0dXJuIG0ubm9kZU5hbWUoYSxcInRhYmxlXCIpJiZtLm5vZGVOYW1lKDExIT09Yi5ub2RlVHlwZT9iOmIuZmlyc3RDaGlsZCxcInRyXCIpP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXXx8YS5hcHBlbmRDaGlsZChhLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRib2R5XCIpKTphfWZ1bmN0aW9uIHhhKGEpe3JldHVybiBhLnR5cGU9KG51bGwhPT1tLmZpbmQuYXR0cihhLFwidHlwZVwiKSkrXCIvXCIrYS50eXBlLGF9ZnVuY3Rpb24geWEoYSl7dmFyIGI9cGEuZXhlYyhhLnR5cGUpO3JldHVybiBiP2EudHlwZT1iWzFdOmEucmVtb3ZlQXR0cmlidXRlKFwidHlwZVwiKSxhfWZ1bmN0aW9uIHphKGEsYil7Zm9yKHZhciBjLGQ9MDtudWxsIT0oYz1hW2RdKTtkKyspbS5fZGF0YShjLFwiZ2xvYmFsRXZhbFwiLCFifHxtLl9kYXRhKGJbZF0sXCJnbG9iYWxFdmFsXCIpKX1mdW5jdGlvbiBBYShhLGIpe2lmKDE9PT1iLm5vZGVUeXBlJiZtLmhhc0RhdGEoYSkpe3ZhciBjLGQsZSxmPW0uX2RhdGEoYSksZz1tLl9kYXRhKGIsZiksaD1mLmV2ZW50cztpZihoKXtkZWxldGUgZy5oYW5kbGUsZy5ldmVudHM9e307Zm9yKGMgaW4gaClmb3IoZD0wLGU9aFtjXS5sZW5ndGg7ZT5kO2QrKyltLmV2ZW50LmFkZChiLGMsaFtjXVtkXSl9Zy5kYXRhJiYoZy5kYXRhPW0uZXh0ZW5kKHt9LGcuZGF0YSkpfX1mdW5jdGlvbiBCYShhLGIpe3ZhciBjLGQsZTtpZigxPT09Yi5ub2RlVHlwZSl7aWYoYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIWsubm9DbG9uZUV2ZW50JiZiW20uZXhwYW5kb10pe2U9bS5fZGF0YShiKTtmb3IoZCBpbiBlLmV2ZW50cyltLnJlbW92ZUV2ZW50KGIsZCxlLmhhbmRsZSk7Yi5yZW1vdmVBdHRyaWJ1dGUobS5leHBhbmRvKX1cInNjcmlwdFwiPT09YyYmYi50ZXh0IT09YS50ZXh0Pyh4YShiKS50ZXh0PWEudGV4dCx5YShiKSk6XCJvYmplY3RcIj09PWM/KGIucGFyZW50Tm9kZSYmKGIub3V0ZXJIVE1MPWEub3V0ZXJIVE1MKSxrLmh0bWw1Q2xvbmUmJmEuaW5uZXJIVE1MJiYhbS50cmltKGIuaW5uZXJIVE1MKSYmKGIuaW5uZXJIVE1MPWEuaW5uZXJIVE1MKSk6XCJpbnB1dFwiPT09YyYmVy50ZXN0KGEudHlwZSk/KGIuZGVmYXVsdENoZWNrZWQ9Yi5jaGVja2VkPWEuY2hlY2tlZCxiLnZhbHVlIT09YS52YWx1ZSYmKGIudmFsdWU9YS52YWx1ZSkpOlwib3B0aW9uXCI9PT1jP2IuZGVmYXVsdFNlbGVjdGVkPWIuc2VsZWN0ZWQ9YS5kZWZhdWx0U2VsZWN0ZWQ6KFwiaW5wdXRcIj09PWN8fFwidGV4dGFyZWFcIj09PWMpJiYoYi5kZWZhdWx0VmFsdWU9YS5kZWZhdWx0VmFsdWUpfX1tLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZixnLGgsaT1tLmNvbnRhaW5zKGEub3duZXJEb2N1bWVudCxhKTtpZihrLmh0bWw1Q2xvbmV8fG0uaXNYTUxEb2MoYSl8fCFnYS50ZXN0KFwiPFwiK2Eubm9kZU5hbWUrXCI+XCIpP2Y9YS5jbG9uZU5vZGUoITApOih0YS5pbm5lckhUTUw9YS5vdXRlckhUTUwsdGEucmVtb3ZlQ2hpbGQoZj10YS5maXJzdENoaWxkKSksIShrLm5vQ2xvbmVFdmVudCYmay5ub0Nsb25lQ2hlY2tlZHx8MSE9PWEubm9kZVR5cGUmJjExIT09YS5ub2RlVHlwZXx8bS5pc1hNTERvYyhhKSkpZm9yKGQ9dWEoZiksaD11YShhKSxnPTA7bnVsbCE9KGU9aFtnXSk7KytnKWRbZ10mJkJhKGUsZFtnXSk7aWYoYilpZihjKWZvcihoPWh8fHVhKGEpLGQ9ZHx8dWEoZiksZz0wO251bGwhPShlPWhbZ10pO2crKylBYShlLGRbZ10pO2Vsc2UgQWEoYSxmKTtyZXR1cm4gZD11YShmLFwic2NyaXB0XCIpLGQubGVuZ3RoPjAmJnphKGQsIWkmJnVhKGEsXCJzY3JpcHRcIikpLGQ9aD1lPW51bGwsZn0sYnVpbGRGcmFnbWVudDpmdW5jdGlvbihhLGIsYyxkKXtmb3IodmFyIGUsZixnLGgsaSxqLGwsbj1hLmxlbmd0aCxvPWRhKGIpLHA9W10scT0wO24+cTtxKyspaWYoZj1hW3FdLGZ8fDA9PT1mKWlmKFwib2JqZWN0XCI9PT1tLnR5cGUoZikpbS5tZXJnZShwLGYubm9kZVR5cGU/W2ZdOmYpO2Vsc2UgaWYobGEudGVzdChmKSl7aD1ofHxvLmFwcGVuZENoaWxkKGIuY3JlYXRlRWxlbWVudChcImRpdlwiKSksaT0oamEuZXhlYyhmKXx8W1wiXCIsXCJcIl0pWzFdLnRvTG93ZXJDYXNlKCksbD1yYVtpXXx8cmEuX2RlZmF1bHQsaC5pbm5lckhUTUw9bFsxXStmLnJlcGxhY2UoaWEsXCI8JDE+PC8kMj5cIikrbFsyXSxlPWxbMF07d2hpbGUoZS0tKWg9aC5sYXN0Q2hpbGQ7aWYoIWsubGVhZGluZ1doaXRlc3BhY2UmJmhhLnRlc3QoZikmJnAucHVzaChiLmNyZWF0ZVRleHROb2RlKGhhLmV4ZWMoZilbMF0pKSwhay50Ym9keSl7Zj1cInRhYmxlXCIhPT1pfHxrYS50ZXN0KGYpP1wiPHRhYmxlPlwiIT09bFsxXXx8a2EudGVzdChmKT8wOmg6aC5maXJzdENoaWxkLGU9ZiYmZi5jaGlsZE5vZGVzLmxlbmd0aDt3aGlsZShlLS0pbS5ub2RlTmFtZShqPWYuY2hpbGROb2Rlc1tlXSxcInRib2R5XCIpJiYhai5jaGlsZE5vZGVzLmxlbmd0aCYmZi5yZW1vdmVDaGlsZChqKX1tLm1lcmdlKHAsaC5jaGlsZE5vZGVzKSxoLnRleHRDb250ZW50PVwiXCI7d2hpbGUoaC5maXJzdENoaWxkKWgucmVtb3ZlQ2hpbGQoaC5maXJzdENoaWxkKTtoPW8ubGFzdENoaWxkfWVsc2UgcC5wdXNoKGIuY3JlYXRlVGV4dE5vZGUoZikpO2gmJm8ucmVtb3ZlQ2hpbGQoaCksay5hcHBlbmRDaGVja2VkfHxtLmdyZXAodWEocCxcImlucHV0XCIpLHZhKSxxPTA7d2hpbGUoZj1wW3ErK10paWYoKCFkfHwtMT09PW0uaW5BcnJheShmLGQpKSYmKGc9bS5jb250YWlucyhmLm93bmVyRG9jdW1lbnQsZiksaD11YShvLmFwcGVuZENoaWxkKGYpLFwic2NyaXB0XCIpLGcmJnphKGgpLGMpKXtlPTA7d2hpbGUoZj1oW2UrK10pb2EudGVzdChmLnR5cGV8fFwiXCIpJiZjLnB1c2goZil9cmV0dXJuIGg9bnVsbCxvfSxjbGVhbkRhdGE6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGQsZSxmLGcsaD0wLGk9bS5leHBhbmRvLGo9bS5jYWNoZSxsPWsuZGVsZXRlRXhwYW5kbyxuPW0uZXZlbnQuc3BlY2lhbDtudWxsIT0oZD1hW2hdKTtoKyspaWYoKGJ8fG0uYWNjZXB0RGF0YShkKSkmJihmPWRbaV0sZz1mJiZqW2ZdKSl7aWYoZy5ldmVudHMpZm9yKGUgaW4gZy5ldmVudHMpbltlXT9tLmV2ZW50LnJlbW92ZShkLGUpOm0ucmVtb3ZlRXZlbnQoZCxlLGcuaGFuZGxlKTtqW2ZdJiYoZGVsZXRlIGpbZl0sbD9kZWxldGUgZFtpXTp0eXBlb2YgZC5yZW1vdmVBdHRyaWJ1dGUhPT1LP2QucmVtb3ZlQXR0cmlidXRlKGkpOmRbaV09bnVsbCxjLnB1c2goZikpfX19KSxtLmZuLmV4dGVuZCh7dGV4dDpmdW5jdGlvbihhKXtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGEpe3JldHVybiB2b2lkIDA9PT1hP20udGV4dCh0aGlzKTp0aGlzLmVtcHR5KCkuYXBwZW5kKCh0aGlzWzBdJiZ0aGlzWzBdLm93bmVyRG9jdW1lbnR8fHkpLmNyZWF0ZVRleHROb2RlKGEpKX0sbnVsbCxhLGFyZ3VtZW50cy5sZW5ndGgpfSxhcHBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7aWYoMT09PXRoaXMubm9kZVR5cGV8fDExPT09dGhpcy5ub2RlVHlwZXx8OT09PXRoaXMubm9kZVR5cGUpe3ZhciBiPXdhKHRoaXMsYSk7Yi5hcHBlbmRDaGlsZChhKX19KX0scHJlcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cyxmdW5jdGlvbihhKXtpZigxPT09dGhpcy5ub2RlVHlwZXx8MTE9PT10aGlzLm5vZGVUeXBlfHw5PT09dGhpcy5ub2RlVHlwZSl7dmFyIGI9d2EodGhpcyxhKTtiLmluc2VydEJlZm9yZShhLGIuZmlyc3RDaGlsZCl9fSl9LGJlZm9yZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cyxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUmJnRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSx0aGlzKX0pfSxhZnRlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cyxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUmJnRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSx0aGlzLm5leHRTaWJsaW5nKX0pfSxyZW1vdmU6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGMsZD1hP20uZmlsdGVyKGEsdGhpcyk6dGhpcyxlPTA7bnVsbCE9KGM9ZFtlXSk7ZSsrKWJ8fDEhPT1jLm5vZGVUeXBlfHxtLmNsZWFuRGF0YSh1YShjKSksYy5wYXJlbnROb2RlJiYoYiYmbS5jb250YWlucyhjLm93bmVyRG9jdW1lbnQsYykmJnphKHVhKGMsXCJzY3JpcHRcIikpLGMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjKSk7cmV0dXJuIHRoaXN9LGVtcHR5OmZ1bmN0aW9uKCl7Zm9yKHZhciBhLGI9MDtudWxsIT0oYT10aGlzW2JdKTtiKyspezE9PT1hLm5vZGVUeXBlJiZtLmNsZWFuRGF0YSh1YShhLCExKSk7d2hpbGUoYS5maXJzdENoaWxkKWEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKTthLm9wdGlvbnMmJm0ubm9kZU5hbWUoYSxcInNlbGVjdFwiKSYmKGEub3B0aW9ucy5sZW5ndGg9MCl9cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGE9bnVsbD09YT8hMTphLGI9bnVsbD09Yj9hOmIsdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gbS5jbG9uZSh0aGlzLGEsYil9KX0saHRtbDpmdW5jdGlvbihhKXtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF18fHt9LGM9MCxkPXRoaXMubGVuZ3RoO2lmKHZvaWQgMD09PWEpcmV0dXJuIDE9PT1iLm5vZGVUeXBlP2IuaW5uZXJIVE1MLnJlcGxhY2UoZmEsXCJcIik6dm9pZCAwO2lmKCEoXCJzdHJpbmdcIiE9dHlwZW9mIGF8fG1hLnRlc3QoYSl8fCFrLmh0bWxTZXJpYWxpemUmJmdhLnRlc3QoYSl8fCFrLmxlYWRpbmdXaGl0ZXNwYWNlJiZoYS50ZXN0KGEpfHxyYVsoamEuZXhlYyhhKXx8W1wiXCIsXCJcIl0pWzFdLnRvTG93ZXJDYXNlKCldKSl7YT1hLnJlcGxhY2UoaWEsXCI8JDE+PC8kMj5cIik7dHJ5e2Zvcig7ZD5jO2MrKyliPXRoaXNbY118fHt9LDE9PT1iLm5vZGVUeXBlJiYobS5jbGVhbkRhdGEodWEoYiwhMSkpLGIuaW5uZXJIVE1MPWEpO2I9MH1jYXRjaChlKXt9fWImJnRoaXMuZW1wdHkoKS5hcHBlbmQoYSl9LG51bGwsYSxhcmd1bWVudHMubGVuZ3RoKX0scmVwbGFjZVdpdGg6ZnVuY3Rpb24oKXt2YXIgYT1hcmd1bWVudHNbMF07cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLGZ1bmN0aW9uKGIpe2E9dGhpcy5wYXJlbnROb2RlLG0uY2xlYW5EYXRhKHVhKHRoaXMpKSxhJiZhLnJlcGxhY2VDaGlsZChiLHRoaXMpfSksYSYmKGEubGVuZ3RofHxhLm5vZGVUeXBlKT90aGlzOnRoaXMucmVtb3ZlKCl9LGRldGFjaDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5yZW1vdmUoYSwhMCl9LGRvbU1hbmlwOmZ1bmN0aW9uKGEsYil7YT1lLmFwcGx5KFtdLGEpO3ZhciBjLGQsZixnLGgsaSxqPTAsbD10aGlzLmxlbmd0aCxuPXRoaXMsbz1sLTEscD1hWzBdLHE9bS5pc0Z1bmN0aW9uKHApO2lmKHF8fGw+MSYmXCJzdHJpbmdcIj09dHlwZW9mIHAmJiFrLmNoZWNrQ2xvbmUmJm5hLnRlc3QocCkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXt2YXIgZD1uLmVxKGMpO3EmJihhWzBdPXAuY2FsbCh0aGlzLGMsZC5odG1sKCkpKSxkLmRvbU1hbmlwKGEsYil9KTtpZihsJiYoaT1tLmJ1aWxkRnJhZ21lbnQoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQsITEsdGhpcyksYz1pLmZpcnN0Q2hpbGQsMT09PWkuY2hpbGROb2Rlcy5sZW5ndGgmJihpPWMpLGMpKXtmb3IoZz1tLm1hcCh1YShpLFwic2NyaXB0XCIpLHhhKSxmPWcubGVuZ3RoO2w+ajtqKyspZD1pLGohPT1vJiYoZD1tLmNsb25lKGQsITAsITApLGYmJm0ubWVyZ2UoZyx1YShkLFwic2NyaXB0XCIpKSksYi5jYWxsKHRoaXNbal0sZCxqKTtpZihmKWZvcihoPWdbZy5sZW5ndGgtMV0ub3duZXJEb2N1bWVudCxtLm1hcChnLHlhKSxqPTA7Zj5qO2orKylkPWdbal0sb2EudGVzdChkLnR5cGV8fFwiXCIpJiYhbS5fZGF0YShkLFwiZ2xvYmFsRXZhbFwiKSYmbS5jb250YWlucyhoLGQpJiYoZC5zcmM/bS5fZXZhbFVybCYmbS5fZXZhbFVybChkLnNyYyk6bS5nbG9iYWxFdmFsKChkLnRleHR8fGQudGV4dENvbnRlbnR8fGQuaW5uZXJIVE1MfHxcIlwiKS5yZXBsYWNlKHFhLFwiXCIpKSk7aT1jPW51bGx9cmV0dXJuIHRoaXN9fSksbS5lYWNoKHthcHBlbmRUbzpcImFwcGVuZFwiLHByZXBlbmRUbzpcInByZXBlbmRcIixpbnNlcnRCZWZvcmU6XCJiZWZvcmVcIixpbnNlcnRBZnRlcjpcImFmdGVyXCIscmVwbGFjZUFsbDpcInJlcGxhY2VXaXRoXCJ9LGZ1bmN0aW9uKGEsYil7bS5mblthXT1mdW5jdGlvbihhKXtmb3IodmFyIGMsZD0wLGU9W10sZz1tKGEpLGg9Zy5sZW5ndGgtMTtoPj1kO2QrKyljPWQ9PT1oP3RoaXM6dGhpcy5jbG9uZSghMCksbShnW2RdKVtiXShjKSxmLmFwcGx5KGUsYy5nZXQoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGUpfX0pO3ZhciBDYSxEYT17fTtmdW5jdGlvbiBFYShiLGMpe3ZhciBkLGU9bShjLmNyZWF0ZUVsZW1lbnQoYikpLmFwcGVuZFRvKGMuYm9keSksZj1hLmdldERlZmF1bHRDb21wdXRlZFN0eWxlJiYoZD1hLmdldERlZmF1bHRDb21wdXRlZFN0eWxlKGVbMF0pKT9kLmRpc3BsYXk6bS5jc3MoZVswXSxcImRpc3BsYXlcIik7cmV0dXJuIGUuZGV0YWNoKCksZn1mdW5jdGlvbiBGYShhKXt2YXIgYj15LGM9RGFbYV07cmV0dXJuIGN8fChjPUVhKGEsYiksXCJub25lXCIhPT1jJiZjfHwoQ2E9KENhfHxtKFwiPGlmcmFtZSBmcmFtZWJvcmRlcj0nMCcgd2lkdGg9JzAnIGhlaWdodD0nMCcvPlwiKSkuYXBwZW5kVG8oYi5kb2N1bWVudEVsZW1lbnQpLGI9KENhWzBdLmNvbnRlbnRXaW5kb3d8fENhWzBdLmNvbnRlbnREb2N1bWVudCkuZG9jdW1lbnQsYi53cml0ZSgpLGIuY2xvc2UoKSxjPUVhKGEsYiksQ2EuZGV0YWNoKCkpLERhW2FdPWMpLGN9IWZ1bmN0aW9uKCl7dmFyIGE7ay5zaHJpbmtXcmFwQmxvY2tzPWZ1bmN0aW9uKCl7aWYobnVsbCE9YSlyZXR1cm4gYTthPSExO3ZhciBiLGMsZDtyZXR1cm4gYz15LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYm9keVwiKVswXSxjJiZjLnN0eWxlPyhiPXkuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkPXkuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkLnN0eWxlLmNzc1RleHQ9XCJwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweFwiLGMuYXBwZW5kQ2hpbGQoZCkuYXBwZW5kQ2hpbGQoYiksdHlwZW9mIGIuc3R5bGUuem9vbSE9PUsmJihiLnN0eWxlLmNzc1RleHQ9XCItd2Via2l0LWJveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94O2JveC1zaXppbmc6Y29udGVudC1ib3g7ZGlzcGxheTpibG9jazttYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjFweDt3aWR0aDoxcHg7em9vbToxXCIsYi5hcHBlbmRDaGlsZCh5LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpLnN0eWxlLndpZHRoPVwiNXB4XCIsYT0zIT09Yi5vZmZzZXRXaWR0aCksYy5yZW1vdmVDaGlsZChkKSxhKTp2b2lkIDB9fSgpO3ZhciBHYT0vXm1hcmdpbi8sSGE9bmV3IFJlZ0V4cChcIl4oXCIrUytcIikoPyFweClbYS16JV0rJFwiLFwiaVwiKSxJYSxKYSxLYT0vXih0b3B8cmlnaHR8Ym90dG9tfGxlZnQpJC87YS5nZXRDb21wdXRlZFN0eWxlPyhJYT1mdW5jdGlvbihiKXtyZXR1cm4gYi5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Lm9wZW5lcj9iLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmEuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpfSxKYT1mdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmLGcsaD1hLnN0eWxlO3JldHVybiBjPWN8fElhKGEpLGc9Yz9jLmdldFByb3BlcnR5VmFsdWUoYil8fGNbYl06dm9pZCAwLGMmJihcIlwiIT09Z3x8bS5jb250YWlucyhhLm93bmVyRG9jdW1lbnQsYSl8fChnPW0uc3R5bGUoYSxiKSksSGEudGVzdChnKSYmR2EudGVzdChiKSYmKGQ9aC53aWR0aCxlPWgubWluV2lkdGgsZj1oLm1heFdpZHRoLGgubWluV2lkdGg9aC5tYXhXaWR0aD1oLndpZHRoPWcsZz1jLndpZHRoLGgud2lkdGg9ZCxoLm1pbldpZHRoPWUsaC5tYXhXaWR0aD1mKSksdm9pZCAwPT09Zz9nOmcrXCJcIn0pOnkuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSYmKElhPWZ1bmN0aW9uKGEpe3JldHVybiBhLmN1cnJlbnRTdHlsZX0sSmE9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZixnLGg9YS5zdHlsZTtyZXR1cm4gYz1jfHxJYShhKSxnPWM/Y1tiXTp2b2lkIDAsbnVsbD09ZyYmaCYmaFtiXSYmKGc9aFtiXSksSGEudGVzdChnKSYmIUthLnRlc3QoYikmJihkPWgubGVmdCxlPWEucnVudGltZVN0eWxlLGY9ZSYmZS5sZWZ0LGYmJihlLmxlZnQ9YS5jdXJyZW50U3R5bGUubGVmdCksaC5sZWZ0PVwiZm9udFNpemVcIj09PWI/XCIxZW1cIjpnLGc9aC5waXhlbExlZnQrXCJweFwiLGgubGVmdD1kLGYmJihlLmxlZnQ9ZikpLHZvaWQgMD09PWc/ZzpnK1wiXCJ8fFwiYXV0b1wifSk7ZnVuY3Rpb24gTGEoYSxiKXtyZXR1cm57Z2V0OmZ1bmN0aW9uKCl7dmFyIGM9YSgpO2lmKG51bGwhPWMpcmV0dXJuIGM/dm9pZCBkZWxldGUgdGhpcy5nZXQ6KHRoaXMuZ2V0PWIpLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19fSFmdW5jdGlvbigpe3ZhciBiLGMsZCxlLGYsZyxoO2lmKGI9eS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGIuaW5uZXJIVE1MPVwiICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnPmE8L2E+PGlucHV0IHR5cGU9J2NoZWNrYm94Jy8+XCIsZD1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYVwiKVswXSxjPWQmJmQuc3R5bGUpe2MuY3NzVGV4dD1cImZsb2F0OmxlZnQ7b3BhY2l0eTouNVwiLGsub3BhY2l0eT1cIjAuNVwiPT09Yy5vcGFjaXR5LGsuY3NzRmxvYXQ9ISFjLmNzc0Zsb2F0LGIuc3R5bGUuYmFja2dyb3VuZENsaXA9XCJjb250ZW50LWJveFwiLGIuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD1cIlwiLGsuY2xlYXJDbG9uZVN0eWxlPVwiY29udGVudC1ib3hcIj09PWIuc3R5bGUuYmFja2dyb3VuZENsaXAsay5ib3hTaXppbmc9XCJcIj09PWMuYm94U2l6aW5nfHxcIlwiPT09Yy5Nb3pCb3hTaXppbmd8fFwiXCI9PT1jLldlYmtpdEJveFNpemluZyxtLmV4dGVuZChrLHtyZWxpYWJsZUhpZGRlbk9mZnNldHM6ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09ZyYmaSgpLGd9LGJveFNpemluZ1JlbGlhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWYmJmkoKSxmfSxwaXhlbFBvc2l0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWUmJmkoKSxlfSxyZWxpYWJsZU1hcmdpblJpZ2h0OmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PWgmJmkoKSxofX0pO2Z1bmN0aW9uIGkoKXt2YXIgYixjLGQsaTtjPXkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdLGMmJmMuc3R5bGUmJihiPXkuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkPXkuY3JlYXRlRWxlbWVudChcImRpdlwiKSxkLnN0eWxlLmNzc1RleHQ9XCJwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweFwiLGMuYXBwZW5kQ2hpbGQoZCkuYXBwZW5kQ2hpbGQoYiksYi5zdHlsZS5jc3NUZXh0PVwiLXdlYmtpdC1ib3gtc2l6aW5nOmJvcmRlci1ib3g7LW1vei1ib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6YmxvY2s7bWFyZ2luLXRvcDoxJTt0b3A6MSU7Ym9yZGVyOjFweDtwYWRkaW5nOjFweDt3aWR0aDo0cHg7cG9zaXRpb246YWJzb2x1dGVcIixlPWY9ITEsaD0hMCxhLmdldENvbXB1dGVkU3R5bGUmJihlPVwiMSVcIiE9PShhLmdldENvbXB1dGVkU3R5bGUoYixudWxsKXx8e30pLnRvcCxmPVwiNHB4XCI9PT0oYS5nZXRDb21wdXRlZFN0eWxlKGIsbnVsbCl8fHt3aWR0aDpcIjRweFwifSkud2lkdGgsaT1iLmFwcGVuZENoaWxkKHkuY3JlYXRlRWxlbWVudChcImRpdlwiKSksaS5zdHlsZS5jc3NUZXh0PWIuc3R5bGUuY3NzVGV4dD1cIi13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7Ym94LXNpemluZzpjb250ZW50LWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbjowO2JvcmRlcjowO3BhZGRpbmc6MFwiLGkuc3R5bGUubWFyZ2luUmlnaHQ9aS5zdHlsZS53aWR0aD1cIjBcIixiLnN0eWxlLndpZHRoPVwiMXB4XCIsaD0hcGFyc2VGbG9hdCgoYS5nZXRDb21wdXRlZFN0eWxlKGksbnVsbCl8fHt9KS5tYXJnaW5SaWdodCksYi5yZW1vdmVDaGlsZChpKSksYi5pbm5lckhUTUw9XCI8dGFibGU+PHRyPjx0ZD48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+XCIsaT1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGRcIiksaVswXS5zdHlsZS5jc3NUZXh0PVwibWFyZ2luOjA7Ym9yZGVyOjA7cGFkZGluZzowO2Rpc3BsYXk6bm9uZVwiLGc9MD09PWlbMF0ub2Zmc2V0SGVpZ2h0LGcmJihpWzBdLnN0eWxlLmRpc3BsYXk9XCJcIixpWzFdLnN0eWxlLmRpc3BsYXk9XCJub25lXCIsZz0wPT09aVswXS5vZmZzZXRIZWlnaHQpLGMucmVtb3ZlQ2hpbGQoZCkpfX19KCksbS5zd2FwPWZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlLGYsZz17fTtmb3IoZiBpbiBiKWdbZl09YS5zdHlsZVtmXSxhLnN0eWxlW2ZdPWJbZl07ZT1jLmFwcGx5KGEsZHx8W10pO2ZvcihmIGluIGIpYS5zdHlsZVtmXT1nW2ZdO3JldHVybiBlfTt2YXIgTWE9L2FscGhhXFwoW14pXSpcXCkvaSxOYT0vb3BhY2l0eVxccyo9XFxzKihbXildKikvLE9hPS9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLyxQYT1uZXcgUmVnRXhwKFwiXihcIitTK1wiKSguKikkXCIsXCJpXCIpLFFhPW5ldyBSZWdFeHAoXCJeKFsrLV0pPShcIitTK1wiKVwiLFwiaVwiKSxSYT17cG9zaXRpb246XCJhYnNvbHV0ZVwiLHZpc2liaWxpdHk6XCJoaWRkZW5cIixkaXNwbGF5OlwiYmxvY2tcIn0sU2E9e2xldHRlclNwYWNpbmc6XCIwXCIsZm9udFdlaWdodDpcIjQwMFwifSxUYT1bXCJXZWJraXRcIixcIk9cIixcIk1velwiLFwibXNcIl07ZnVuY3Rpb24gVWEoYSxiKXtpZihiIGluIGEpcmV0dXJuIGI7dmFyIGM9Yi5jaGFyQXQoMCkudG9VcHBlckNhc2UoKStiLnNsaWNlKDEpLGQ9YixlPVRhLmxlbmd0aDt3aGlsZShlLS0paWYoYj1UYVtlXStjLGIgaW4gYSlyZXR1cm4gYjtyZXR1cm4gZH1mdW5jdGlvbiBWYShhLGIpe2Zvcih2YXIgYyxkLGUsZj1bXSxnPTAsaD1hLmxlbmd0aDtoPmc7ZysrKWQ9YVtnXSxkLnN0eWxlJiYoZltnXT1tLl9kYXRhKGQsXCJvbGRkaXNwbGF5XCIpLGM9ZC5zdHlsZS5kaXNwbGF5LGI/KGZbZ118fFwibm9uZVwiIT09Y3x8KGQuc3R5bGUuZGlzcGxheT1cIlwiKSxcIlwiPT09ZC5zdHlsZS5kaXNwbGF5JiZVKGQpJiYoZltnXT1tLl9kYXRhKGQsXCJvbGRkaXNwbGF5XCIsRmEoZC5ub2RlTmFtZSkpKSk6KGU9VShkKSwoYyYmXCJub25lXCIhPT1jfHwhZSkmJm0uX2RhdGEoZCxcIm9sZGRpc3BsYXlcIixlP2M6bS5jc3MoZCxcImRpc3BsYXlcIikpKSk7Zm9yKGc9MDtoPmc7ZysrKWQ9YVtnXSxkLnN0eWxlJiYoYiYmXCJub25lXCIhPT1kLnN0eWxlLmRpc3BsYXkmJlwiXCIhPT1kLnN0eWxlLmRpc3BsYXl8fChkLnN0eWxlLmRpc3BsYXk9Yj9mW2ddfHxcIlwiOlwibm9uZVwiKSk7cmV0dXJuIGF9ZnVuY3Rpb24gV2EoYSxiLGMpe3ZhciBkPVBhLmV4ZWMoYik7cmV0dXJuIGQ/TWF0aC5tYXgoMCxkWzFdLShjfHwwKSkrKGRbMl18fFwicHhcIik6Yn1mdW5jdGlvbiBYYShhLGIsYyxkLGUpe2Zvcih2YXIgZj1jPT09KGQ/XCJib3JkZXJcIjpcImNvbnRlbnRcIik/NDpcIndpZHRoXCI9PT1iPzE6MCxnPTA7ND5mO2YrPTIpXCJtYXJnaW5cIj09PWMmJihnKz1tLmNzcyhhLGMrVFtmXSwhMCxlKSksZD8oXCJjb250ZW50XCI9PT1jJiYoZy09bS5jc3MoYSxcInBhZGRpbmdcIitUW2ZdLCEwLGUpKSxcIm1hcmdpblwiIT09YyYmKGctPW0uY3NzKGEsXCJib3JkZXJcIitUW2ZdK1wiV2lkdGhcIiwhMCxlKSkpOihnKz1tLmNzcyhhLFwicGFkZGluZ1wiK1RbZl0sITAsZSksXCJwYWRkaW5nXCIhPT1jJiYoZys9bS5jc3MoYSxcImJvcmRlclwiK1RbZl0rXCJXaWR0aFwiLCEwLGUpKSk7cmV0dXJuIGd9ZnVuY3Rpb24gWWEoYSxiLGMpe3ZhciBkPSEwLGU9XCJ3aWR0aFwiPT09Yj9hLm9mZnNldFdpZHRoOmEub2Zmc2V0SGVpZ2h0LGY9SWEoYSksZz1rLmJveFNpemluZyYmXCJib3JkZXItYm94XCI9PT1tLmNzcyhhLFwiYm94U2l6aW5nXCIsITEsZik7aWYoMD49ZXx8bnVsbD09ZSl7aWYoZT1KYShhLGIsZiksKDA+ZXx8bnVsbD09ZSkmJihlPWEuc3R5bGVbYl0pLEhhLnRlc3QoZSkpcmV0dXJuIGU7ZD1nJiYoay5ib3hTaXppbmdSZWxpYWJsZSgpfHxlPT09YS5zdHlsZVtiXSksZT1wYXJzZUZsb2F0KGUpfHwwfXJldHVybiBlK1hhKGEsYixjfHwoZz9cImJvcmRlclwiOlwiY29udGVudFwiKSxkLGYpK1wicHhcIn1tLmV4dGVuZCh7Y3NzSG9va3M6e29wYWNpdHk6e2dldDpmdW5jdGlvbihhLGIpe2lmKGIpe3ZhciBjPUphKGEsXCJvcGFjaXR5XCIpO3JldHVyblwiXCI9PT1jP1wiMVwiOmN9fX19LGNzc051bWJlcjp7Y29sdW1uQ291bnQ6ITAsZmlsbE9wYWNpdHk6ITAsZmxleEdyb3c6ITAsZmxleFNocmluazohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcmRlcjohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6e1wiZmxvYXRcIjprLmNzc0Zsb2F0P1wiY3NzRmxvYXRcIjpcInN0eWxlRmxvYXRcIn0sc3R5bGU6ZnVuY3Rpb24oYSxiLGMsZCl7aWYoYSYmMyE9PWEubm9kZVR5cGUmJjghPT1hLm5vZGVUeXBlJiZhLnN0eWxlKXt2YXIgZSxmLGcsaD1tLmNhbWVsQ2FzZShiKSxpPWEuc3R5bGU7aWYoYj1tLmNzc1Byb3BzW2hdfHwobS5jc3NQcm9wc1toXT1VYShpLGgpKSxnPW0uY3NzSG9va3NbYl18fG0uY3NzSG9va3NbaF0sdm9pZCAwPT09YylyZXR1cm4gZyYmXCJnZXRcImluIGcmJnZvaWQgMCE9PShlPWcuZ2V0KGEsITEsZCkpP2U6aVtiXTtpZihmPXR5cGVvZiBjLFwic3RyaW5nXCI9PT1mJiYoZT1RYS5leGVjKGMpKSYmKGM9KGVbMV0rMSkqZVsyXStwYXJzZUZsb2F0KG0uY3NzKGEsYikpLGY9XCJudW1iZXJcIiksbnVsbCE9YyYmYz09PWMmJihcIm51bWJlclwiIT09Znx8bS5jc3NOdW1iZXJbaF18fChjKz1cInB4XCIpLGsuY2xlYXJDbG9uZVN0eWxlfHxcIlwiIT09Y3x8MCE9PWIuaW5kZXhPZihcImJhY2tncm91bmRcIil8fChpW2JdPVwiaW5oZXJpdFwiKSwhKGcmJlwic2V0XCJpbiBnJiZ2b2lkIDA9PT0oYz1nLnNldChhLGMsZCkpKSkpdHJ5e2lbYl09Y31jYXRjaChqKXt9fX0sY3NzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlLGYsZyxoPW0uY2FtZWxDYXNlKGIpO3JldHVybiBiPW0uY3NzUHJvcHNbaF18fChtLmNzc1Byb3BzW2hdPVVhKGEuc3R5bGUsaCkpLGc9bS5jc3NIb29rc1tiXXx8bS5jc3NIb29rc1toXSxnJiZcImdldFwiaW4gZyYmKGY9Zy5nZXQoYSwhMCxjKSksdm9pZCAwPT09ZiYmKGY9SmEoYSxiLGQpKSxcIm5vcm1hbFwiPT09ZiYmYiBpbiBTYSYmKGY9U2FbYl0pLFwiXCI9PT1jfHxjPyhlPXBhcnNlRmxvYXQoZiksYz09PSEwfHxtLmlzTnVtZXJpYyhlKT9lfHwwOmYpOmZ9fSksbS5lYWNoKFtcImhlaWdodFwiLFwid2lkdGhcIl0sZnVuY3Rpb24oYSxiKXttLmNzc0hvb2tzW2JdPXtnZXQ6ZnVuY3Rpb24oYSxjLGQpe3JldHVybiBjP09hLnRlc3QobS5jc3MoYSxcImRpc3BsYXlcIikpJiYwPT09YS5vZmZzZXRXaWR0aD9tLnN3YXAoYSxSYSxmdW5jdGlvbigpe3JldHVybiBZYShhLGIsZCl9KTpZYShhLGIsZCk6dm9pZCAwfSxzZXQ6ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPWQmJklhKGEpO3JldHVybiBXYShhLGMsZD9YYShhLGIsZCxrLmJveFNpemluZyYmXCJib3JkZXItYm94XCI9PT1tLmNzcyhhLFwiYm94U2l6aW5nXCIsITEsZSksZSk6MCl9fX0pLGsub3BhY2l0eXx8KG0uY3NzSG9va3Mub3BhY2l0eT17Z2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIE5hLnRlc3QoKGImJmEuY3VycmVudFN0eWxlP2EuY3VycmVudFN0eWxlLmZpbHRlcjphLnN0eWxlLmZpbHRlcil8fFwiXCIpPy4wMSpwYXJzZUZsb2F0KFJlZ0V4cC4kMSkrXCJcIjpiP1wiMVwiOlwiXCJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZSxlPW0uaXNOdW1lcmljKGIpP1wiYWxwaGEob3BhY2l0eT1cIisxMDAqYitcIilcIjpcIlwiLGY9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHxcIlwiO2Muem9vbT0xLChiPj0xfHxcIlwiPT09YikmJlwiXCI9PT1tLnRyaW0oZi5yZXBsYWNlKE1hLFwiXCIpKSYmYy5yZW1vdmVBdHRyaWJ1dGUmJihjLnJlbW92ZUF0dHJpYnV0ZShcImZpbHRlclwiKSxcIlwiPT09Ynx8ZCYmIWQuZmlsdGVyKXx8KGMuZmlsdGVyPU1hLnRlc3QoZik/Zi5yZXBsYWNlKE1hLGUpOmYrXCIgXCIrZSl9fSksbS5jc3NIb29rcy5tYXJnaW5SaWdodD1MYShrLnJlbGlhYmxlTWFyZ2luUmlnaHQsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYj9tLnN3YXAoYSx7ZGlzcGxheTpcImlubGluZS1ibG9ja1wifSxKYSxbYSxcIm1hcmdpblJpZ2h0XCJdKTp2b2lkIDB9KSxtLmVhY2goe21hcmdpbjpcIlwiLHBhZGRpbmc6XCJcIixib3JkZXI6XCJXaWR0aFwifSxmdW5jdGlvbihhLGIpe20uY3NzSG9va3NbYStiXT17ZXhwYW5kOmZ1bmN0aW9uKGMpe2Zvcih2YXIgZD0wLGU9e30sZj1cInN0cmluZ1wiPT10eXBlb2YgYz9jLnNwbGl0KFwiIFwiKTpbY107ND5kO2QrKyllW2ErVFtkXStiXT1mW2RdfHxmW2QtMl18fGZbMF07cmV0dXJuIGV9fSxHYS50ZXN0KGEpfHwobS5jc3NIb29rc1thK2JdLnNldD1XYSl9KSxtLmZuLmV4dGVuZCh7Y3NzOmZ1bmN0aW9uKGEsYil7cmV0dXJuIFYodGhpcyxmdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmPXt9LGc9MDtpZihtLmlzQXJyYXkoYikpe2ZvcihkPUlhKGEpLGU9Yi5sZW5ndGg7ZT5nO2crKylmW2JbZ11dPW0uY3NzKGEsYltnXSwhMSxkKTtyZXR1cm4gZn1yZXR1cm4gdm9pZCAwIT09Yz9tLnN0eWxlKGEsYixjKTptLmNzcyhhLGIpfSxhLGIsYXJndW1lbnRzLmxlbmd0aD4xKX0sc2hvdzpmdW5jdGlvbigpe3JldHVybiBWYSh0aGlzLCEwKX0saGlkZTpmdW5jdGlvbigpe3JldHVybiBWYSh0aGlzKX0sdG9nZ2xlOmZ1bmN0aW9uKGEpe3JldHVyblwiYm9vbGVhblwiPT10eXBlb2YgYT9hP3RoaXMuc2hvdygpOnRoaXMuaGlkZSgpOnRoaXMuZWFjaChmdW5jdGlvbigpe1UodGhpcyk/bSh0aGlzKS5zaG93KCk6bSh0aGlzKS5oaWRlKCl9KX19KTtmdW5jdGlvbiBaYShhLGIsYyxkLGUpe1xucmV0dXJuIG5ldyBaYS5wcm90b3R5cGUuaW5pdChhLGIsYyxkLGUpfW0uVHdlZW49WmEsWmEucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpaYSxpbml0OmZ1bmN0aW9uKGEsYixjLGQsZSxmKXt0aGlzLmVsZW09YSx0aGlzLnByb3A9Yyx0aGlzLmVhc2luZz1lfHxcInN3aW5nXCIsdGhpcy5vcHRpb25zPWIsdGhpcy5zdGFydD10aGlzLm5vdz10aGlzLmN1cigpLHRoaXMuZW5kPWQsdGhpcy51bml0PWZ8fChtLmNzc051bWJlcltjXT9cIlwiOlwicHhcIil9LGN1cjpmdW5jdGlvbigpe3ZhciBhPVphLnByb3BIb29rc1t0aGlzLnByb3BdO3JldHVybiBhJiZhLmdldD9hLmdldCh0aGlzKTpaYS5wcm9wSG9va3MuX2RlZmF1bHQuZ2V0KHRoaXMpfSxydW46ZnVuY3Rpb24oYSl7dmFyIGIsYz1aYS5wcm9wSG9va3NbdGhpcy5wcm9wXTtyZXR1cm4gdGhpcy5vcHRpb25zLmR1cmF0aW9uP3RoaXMucG9zPWI9bS5lYXNpbmdbdGhpcy5lYXNpbmddKGEsdGhpcy5vcHRpb25zLmR1cmF0aW9uKmEsMCwxLHRoaXMub3B0aW9ucy5kdXJhdGlvbik6dGhpcy5wb3M9Yj1hLHRoaXMubm93PSh0aGlzLmVuZC10aGlzLnN0YXJ0KSpiK3RoaXMuc3RhcnQsdGhpcy5vcHRpb25zLnN0ZXAmJnRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLHRoaXMubm93LHRoaXMpLGMmJmMuc2V0P2Muc2V0KHRoaXMpOlphLnByb3BIb29rcy5fZGVmYXVsdC5zZXQodGhpcyksdGhpc319LFphLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZT1aYS5wcm90b3R5cGUsWmEucHJvcEhvb2tzPXtfZGVmYXVsdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiO3JldHVybiBudWxsPT1hLmVsZW1bYS5wcm9wXXx8YS5lbGVtLnN0eWxlJiZudWxsIT1hLmVsZW0uc3R5bGVbYS5wcm9wXT8oYj1tLmNzcyhhLmVsZW0sYS5wcm9wLFwiXCIpLGImJlwiYXV0b1wiIT09Yj9iOjApOmEuZWxlbVthLnByb3BdfSxzZXQ6ZnVuY3Rpb24oYSl7bS5meC5zdGVwW2EucHJvcF0/bS5meC5zdGVwW2EucHJvcF0oYSk6YS5lbGVtLnN0eWxlJiYobnVsbCE9YS5lbGVtLnN0eWxlW20uY3NzUHJvcHNbYS5wcm9wXV18fG0uY3NzSG9va3NbYS5wcm9wXSk/bS5zdHlsZShhLmVsZW0sYS5wcm9wLGEubm93K2EudW5pdCk6YS5lbGVtW2EucHJvcF09YS5ub3d9fX0sWmEucHJvcEhvb2tzLnNjcm9sbFRvcD1aYS5wcm9wSG9va3Muc2Nyb2xsTGVmdD17c2V0OmZ1bmN0aW9uKGEpe2EuZWxlbS5ub2RlVHlwZSYmYS5lbGVtLnBhcmVudE5vZGUmJihhLmVsZW1bYS5wcm9wXT1hLm5vdyl9fSxtLmVhc2luZz17bGluZWFyOmZ1bmN0aW9uKGEpe3JldHVybiBhfSxzd2luZzpmdW5jdGlvbihhKXtyZXR1cm4uNS1NYXRoLmNvcyhhKk1hdGguUEkpLzJ9fSxtLmZ4PVphLnByb3RvdHlwZS5pbml0LG0uZnguc3RlcD17fTt2YXIgJGEsX2EsYWI9L14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLGJiPW5ldyBSZWdFeHAoXCJeKD86KFsrLV0pPXwpKFwiK1MrXCIpKFthLXolXSopJFwiLFwiaVwiKSxjYj0vcXVldWVIb29rcyQvLGRiPVtpYl0sZWI9e1wiKlwiOltmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuY3JlYXRlVHdlZW4oYSxiKSxkPWMuY3VyKCksZT1iYi5leGVjKGIpLGY9ZSYmZVszXXx8KG0uY3NzTnVtYmVyW2FdP1wiXCI6XCJweFwiKSxnPShtLmNzc051bWJlclthXXx8XCJweFwiIT09ZiYmK2QpJiZiYi5leGVjKG0uY3NzKGMuZWxlbSxhKSksaD0xLGk9MjA7aWYoZyYmZ1szXSE9PWYpe2Y9Znx8Z1szXSxlPWV8fFtdLGc9K2R8fDE7ZG8gaD1ofHxcIi41XCIsZy89aCxtLnN0eWxlKGMuZWxlbSxhLGcrZik7d2hpbGUoaCE9PShoPWMuY3VyKCkvZCkmJjEhPT1oJiYtLWkpfXJldHVybiBlJiYoZz1jLnN0YXJ0PStnfHwrZHx8MCxjLnVuaXQ9ZixjLmVuZD1lWzFdP2crKGVbMV0rMSkqZVsyXTorZVsyXSksY31dfTtmdW5jdGlvbiBmYigpe3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7JGE9dm9pZCAwfSksJGE9bS5ub3coKX1mdW5jdGlvbiBnYihhLGIpe3ZhciBjLGQ9e2hlaWdodDphfSxlPTA7Zm9yKGI9Yj8xOjA7ND5lO2UrPTItYiljPVRbZV0sZFtcIm1hcmdpblwiK2NdPWRbXCJwYWRkaW5nXCIrY109YTtyZXR1cm4gYiYmKGQub3BhY2l0eT1kLndpZHRoPWEpLGR9ZnVuY3Rpb24gaGIoYSxiLGMpe2Zvcih2YXIgZCxlPShlYltiXXx8W10pLmNvbmNhdChlYltcIipcIl0pLGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspaWYoZD1lW2ZdLmNhbGwoYyxiLGEpKXJldHVybiBkfWZ1bmN0aW9uIGliKGEsYixjKXt2YXIgZCxlLGYsZyxoLGksaixsLG49dGhpcyxvPXt9LHA9YS5zdHlsZSxxPWEubm9kZVR5cGUmJlUoYSkscj1tLl9kYXRhKGEsXCJmeHNob3dcIik7Yy5xdWV1ZXx8KGg9bS5fcXVldWVIb29rcyhhLFwiZnhcIiksbnVsbD09aC51bnF1ZXVlZCYmKGgudW5xdWV1ZWQ9MCxpPWguZW1wdHkuZmlyZSxoLmVtcHR5LmZpcmU9ZnVuY3Rpb24oKXtoLnVucXVldWVkfHxpKCl9KSxoLnVucXVldWVkKyssbi5hbHdheXMoZnVuY3Rpb24oKXtuLmFsd2F5cyhmdW5jdGlvbigpe2gudW5xdWV1ZWQtLSxtLnF1ZXVlKGEsXCJmeFwiKS5sZW5ndGh8fGguZW1wdHkuZmlyZSgpfSl9KSksMT09PWEubm9kZVR5cGUmJihcImhlaWdodFwiaW4gYnx8XCJ3aWR0aFwiaW4gYikmJihjLm92ZXJmbG93PVtwLm92ZXJmbG93LHAub3ZlcmZsb3dYLHAub3ZlcmZsb3dZXSxqPW0uY3NzKGEsXCJkaXNwbGF5XCIpLGw9XCJub25lXCI9PT1qP20uX2RhdGEoYSxcIm9sZGRpc3BsYXlcIil8fEZhKGEubm9kZU5hbWUpOmosXCJpbmxpbmVcIj09PWwmJlwibm9uZVwiPT09bS5jc3MoYSxcImZsb2F0XCIpJiYoay5pbmxpbmVCbG9ja05lZWRzTGF5b3V0JiZcImlubGluZVwiIT09RmEoYS5ub2RlTmFtZSk/cC56b29tPTE6cC5kaXNwbGF5PVwiaW5saW5lLWJsb2NrXCIpKSxjLm92ZXJmbG93JiYocC5vdmVyZmxvdz1cImhpZGRlblwiLGsuc2hyaW5rV3JhcEJsb2NrcygpfHxuLmFsd2F5cyhmdW5jdGlvbigpe3Aub3ZlcmZsb3c9Yy5vdmVyZmxvd1swXSxwLm92ZXJmbG93WD1jLm92ZXJmbG93WzFdLHAub3ZlcmZsb3dZPWMub3ZlcmZsb3dbMl19KSk7Zm9yKGQgaW4gYilpZihlPWJbZF0sYWIuZXhlYyhlKSl7aWYoZGVsZXRlIGJbZF0sZj1mfHxcInRvZ2dsZVwiPT09ZSxlPT09KHE/XCJoaWRlXCI6XCJzaG93XCIpKXtpZihcInNob3dcIiE9PWV8fCFyfHx2b2lkIDA9PT1yW2RdKWNvbnRpbnVlO3E9ITB9b1tkXT1yJiZyW2RdfHxtLnN0eWxlKGEsZCl9ZWxzZSBqPXZvaWQgMDtpZihtLmlzRW1wdHlPYmplY3QobykpXCJpbmxpbmVcIj09PShcIm5vbmVcIj09PWo/RmEoYS5ub2RlTmFtZSk6aikmJihwLmRpc3BsYXk9aik7ZWxzZXtyP1wiaGlkZGVuXCJpbiByJiYocT1yLmhpZGRlbik6cj1tLl9kYXRhKGEsXCJmeHNob3dcIix7fSksZiYmKHIuaGlkZGVuPSFxKSxxP20oYSkuc2hvdygpOm4uZG9uZShmdW5jdGlvbigpe20oYSkuaGlkZSgpfSksbi5kb25lKGZ1bmN0aW9uKCl7dmFyIGI7bS5fcmVtb3ZlRGF0YShhLFwiZnhzaG93XCIpO2ZvcihiIGluIG8pbS5zdHlsZShhLGIsb1tiXSl9KTtmb3IoZCBpbiBvKWc9aGIocT9yW2RdOjAsZCxuKSxkIGluIHJ8fChyW2RdPWcuc3RhcnQscSYmKGcuZW5kPWcuc3RhcnQsZy5zdGFydD1cIndpZHRoXCI9PT1kfHxcImhlaWdodFwiPT09ZD8xOjApKX19ZnVuY3Rpb24gamIoYSxiKXt2YXIgYyxkLGUsZixnO2ZvcihjIGluIGEpaWYoZD1tLmNhbWVsQ2FzZShjKSxlPWJbZF0sZj1hW2NdLG0uaXNBcnJheShmKSYmKGU9ZlsxXSxmPWFbY109ZlswXSksYyE9PWQmJihhW2RdPWYsZGVsZXRlIGFbY10pLGc9bS5jc3NIb29rc1tkXSxnJiZcImV4cGFuZFwiaW4gZyl7Zj1nLmV4cGFuZChmKSxkZWxldGUgYVtkXTtmb3IoYyBpbiBmKWMgaW4gYXx8KGFbY109ZltjXSxiW2NdPWUpfWVsc2UgYltkXT1lfWZ1bmN0aW9uIGtiKGEsYixjKXt2YXIgZCxlLGY9MCxnPWRiLmxlbmd0aCxoPW0uRGVmZXJyZWQoKS5hbHdheXMoZnVuY3Rpb24oKXtkZWxldGUgaS5lbGVtfSksaT1mdW5jdGlvbigpe2lmKGUpcmV0dXJuITE7Zm9yKHZhciBiPSRhfHxmYigpLGM9TWF0aC5tYXgoMCxqLnN0YXJ0VGltZStqLmR1cmF0aW9uLWIpLGQ9Yy9qLmR1cmF0aW9ufHwwLGY9MS1kLGc9MCxpPWoudHdlZW5zLmxlbmd0aDtpPmc7ZysrKWoudHdlZW5zW2ddLnJ1bihmKTtyZXR1cm4gaC5ub3RpZnlXaXRoKGEsW2osZixjXSksMT5mJiZpP2M6KGgucmVzb2x2ZVdpdGgoYSxbal0pLCExKX0saj1oLnByb21pc2Uoe2VsZW06YSxwcm9wczptLmV4dGVuZCh7fSxiKSxvcHRzOm0uZXh0ZW5kKCEwLHtzcGVjaWFsRWFzaW5nOnt9fSxjKSxvcmlnaW5hbFByb3BlcnRpZXM6YixvcmlnaW5hbE9wdGlvbnM6YyxzdGFydFRpbWU6JGF8fGZiKCksZHVyYXRpb246Yy5kdXJhdGlvbix0d2VlbnM6W10sY3JlYXRlVHdlZW46ZnVuY3Rpb24oYixjKXt2YXIgZD1tLlR3ZWVuKGEsai5vcHRzLGIsYyxqLm9wdHMuc3BlY2lhbEVhc2luZ1tiXXx8ai5vcHRzLmVhc2luZyk7cmV0dXJuIGoudHdlZW5zLnB1c2goZCksZH0sc3RvcDpmdW5jdGlvbihiKXt2YXIgYz0wLGQ9Yj9qLnR3ZWVucy5sZW5ndGg6MDtpZihlKXJldHVybiB0aGlzO2ZvcihlPSEwO2Q+YztjKyspai50d2VlbnNbY10ucnVuKDEpO3JldHVybiBiP2gucmVzb2x2ZVdpdGgoYSxbaixiXSk6aC5yZWplY3RXaXRoKGEsW2osYl0pLHRoaXN9fSksaz1qLnByb3BzO2ZvcihqYihrLGoub3B0cy5zcGVjaWFsRWFzaW5nKTtnPmY7ZisrKWlmKGQ9ZGJbZl0uY2FsbChqLGEsayxqLm9wdHMpKXJldHVybiBkO3JldHVybiBtLm1hcChrLGhiLGopLG0uaXNGdW5jdGlvbihqLm9wdHMuc3RhcnQpJiZqLm9wdHMuc3RhcnQuY2FsbChhLGopLG0uZngudGltZXIobS5leHRlbmQoaSx7ZWxlbTphLGFuaW06aixxdWV1ZTpqLm9wdHMucXVldWV9KSksai5wcm9ncmVzcyhqLm9wdHMucHJvZ3Jlc3MpLmRvbmUoai5vcHRzLmRvbmUsai5vcHRzLmNvbXBsZXRlKS5mYWlsKGoub3B0cy5mYWlsKS5hbHdheXMoai5vcHRzLmFsd2F5cyl9bS5BbmltYXRpb249bS5leHRlbmQoa2Ise3R3ZWVuZXI6ZnVuY3Rpb24oYSxiKXttLmlzRnVuY3Rpb24oYSk/KGI9YSxhPVtcIipcIl0pOmE9YS5zcGxpdChcIiBcIik7Zm9yKHZhciBjLGQ9MCxlPWEubGVuZ3RoO2U+ZDtkKyspYz1hW2RdLGViW2NdPWViW2NdfHxbXSxlYltjXS51bnNoaWZ0KGIpfSxwcmVmaWx0ZXI6ZnVuY3Rpb24oYSxiKXtiP2RiLnVuc2hpZnQoYSk6ZGIucHVzaChhKX19KSxtLnNwZWVkPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hJiZcIm9iamVjdFwiPT10eXBlb2YgYT9tLmV4dGVuZCh7fSxhKTp7Y29tcGxldGU6Y3x8IWMmJmJ8fG0uaXNGdW5jdGlvbihhKSYmYSxkdXJhdGlvbjphLGVhc2luZzpjJiZifHxiJiYhbS5pc0Z1bmN0aW9uKGIpJiZifTtyZXR1cm4gZC5kdXJhdGlvbj1tLmZ4Lm9mZj8wOlwibnVtYmVyXCI9PXR5cGVvZiBkLmR1cmF0aW9uP2QuZHVyYXRpb246ZC5kdXJhdGlvbiBpbiBtLmZ4LnNwZWVkcz9tLmZ4LnNwZWVkc1tkLmR1cmF0aW9uXTptLmZ4LnNwZWVkcy5fZGVmYXVsdCwobnVsbD09ZC5xdWV1ZXx8ZC5xdWV1ZT09PSEwKSYmKGQucXVldWU9XCJmeFwiKSxkLm9sZD1kLmNvbXBsZXRlLGQuY29tcGxldGU9ZnVuY3Rpb24oKXttLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWUmJm0uZGVxdWV1ZSh0aGlzLGQucXVldWUpfSxkfSxtLmZuLmV4dGVuZCh7ZmFkZVRvOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmZpbHRlcihVKS5jc3MoXCJvcGFjaXR5XCIsMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoe29wYWNpdHk6Yn0sYSxjLGQpfSxhbmltYXRlOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPW0uaXNFbXB0eU9iamVjdChhKSxmPW0uc3BlZWQoYixjLGQpLGc9ZnVuY3Rpb24oKXt2YXIgYj1rYih0aGlzLG0uZXh0ZW5kKHt9LGEpLGYpOyhlfHxtLl9kYXRhKHRoaXMsXCJmaW5pc2hcIikpJiZiLnN0b3AoITApfTtyZXR1cm4gZy5maW5pc2g9ZyxlfHxmLnF1ZXVlPT09ITE/dGhpcy5lYWNoKGcpOnRoaXMucXVldWUoZi5xdWV1ZSxnKX0sc3RvcDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5zdG9wO2RlbGV0ZSBhLnN0b3AsYihjKX07cmV0dXJuXCJzdHJpbmdcIiE9dHlwZW9mIGEmJihjPWIsYj1hLGE9dm9pZCAwKSxiJiZhIT09ITEmJnRoaXMucXVldWUoYXx8XCJmeFwiLFtdKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj0hMCxlPW51bGwhPWEmJmErXCJxdWV1ZUhvb2tzXCIsZj1tLnRpbWVycyxnPW0uX2RhdGEodGhpcyk7aWYoZSlnW2VdJiZnW2VdLnN0b3AmJmQoZ1tlXSk7ZWxzZSBmb3IoZSBpbiBnKWdbZV0mJmdbZV0uc3RvcCYmY2IudGVzdChlKSYmZChnW2VdKTtmb3IoZT1mLmxlbmd0aDtlLS07KWZbZV0uZWxlbSE9PXRoaXN8fG51bGwhPWEmJmZbZV0ucXVldWUhPT1hfHwoZltlXS5hbmltLnN0b3AoYyksYj0hMSxmLnNwbGljZShlLDEpKTsoYnx8IWMpJiZtLmRlcXVldWUodGhpcyxhKX0pfSxmaW5pc2g6ZnVuY3Rpb24oYSl7cmV0dXJuIGEhPT0hMSYmKGE9YXx8XCJmeFwiKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYixjPW0uX2RhdGEodGhpcyksZD1jW2ErXCJxdWV1ZVwiXSxlPWNbYStcInF1ZXVlSG9va3NcIl0sZj1tLnRpbWVycyxnPWQ/ZC5sZW5ndGg6MDtmb3IoYy5maW5pc2g9ITAsbS5xdWV1ZSh0aGlzLGEsW10pLGUmJmUuc3RvcCYmZS5zdG9wLmNhbGwodGhpcywhMCksYj1mLmxlbmd0aDtiLS07KWZbYl0uZWxlbT09PXRoaXMmJmZbYl0ucXVldWU9PT1hJiYoZltiXS5hbmltLnN0b3AoITApLGYuc3BsaWNlKGIsMSkpO2ZvcihiPTA7Zz5iO2IrKylkW2JdJiZkW2JdLmZpbmlzaCYmZFtiXS5maW5pc2guY2FsbCh0aGlzKTtkZWxldGUgYy5maW5pc2h9KX19KSxtLmVhY2goW1widG9nZ2xlXCIsXCJzaG93XCIsXCJoaWRlXCJdLGZ1bmN0aW9uKGEsYil7dmFyIGM9bS5mbltiXTttLmZuW2JdPWZ1bmN0aW9uKGEsZCxlKXtyZXR1cm4gbnVsbD09YXx8XCJib29sZWFuXCI9PXR5cGVvZiBhP2MuYXBwbHkodGhpcyxhcmd1bWVudHMpOnRoaXMuYW5pbWF0ZShnYihiLCEwKSxhLGQsZSl9fSksbS5lYWNoKHtzbGlkZURvd246Z2IoXCJzaG93XCIpLHNsaWRlVXA6Z2IoXCJoaWRlXCIpLHNsaWRlVG9nZ2xlOmdiKFwidG9nZ2xlXCIpLGZhZGVJbjp7b3BhY2l0eTpcInNob3dcIn0sZmFkZU91dDp7b3BhY2l0eTpcImhpZGVcIn0sZmFkZVRvZ2dsZTp7b3BhY2l0eTpcInRvZ2dsZVwifX0sZnVuY3Rpb24oYSxiKXttLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLG0udGltZXJzPVtdLG0uZngudGljaz1mdW5jdGlvbigpe3ZhciBhLGI9bS50aW1lcnMsYz0wO2ZvcigkYT1tLm5vdygpO2M8Yi5sZW5ndGg7YysrKWE9YltjXSxhKCl8fGJbY10hPT1hfHxiLnNwbGljZShjLS0sMSk7Yi5sZW5ndGh8fG0uZnguc3RvcCgpLCRhPXZvaWQgMH0sbS5meC50aW1lcj1mdW5jdGlvbihhKXttLnRpbWVycy5wdXNoKGEpLGEoKT9tLmZ4LnN0YXJ0KCk6bS50aW1lcnMucG9wKCl9LG0uZnguaW50ZXJ2YWw9MTMsbS5meC5zdGFydD1mdW5jdGlvbigpe19hfHwoX2E9c2V0SW50ZXJ2YWwobS5meC50aWNrLG0uZnguaW50ZXJ2YWwpKX0sbS5meC5zdG9wPWZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChfYSksX2E9bnVsbH0sbS5meC5zcGVlZHM9e3Nsb3c6NjAwLGZhc3Q6MjAwLF9kZWZhdWx0OjQwMH0sbS5mbi5kZWxheT1mdW5jdGlvbihhLGIpe3JldHVybiBhPW0uZng/bS5meC5zcGVlZHNbYV18fGE6YSxiPWJ8fFwiZnhcIix0aGlzLnF1ZXVlKGIsZnVuY3Rpb24oYixjKXt2YXIgZD1zZXRUaW1lb3V0KGIsYSk7Yy5zdG9wPWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KGQpfX0pfSxmdW5jdGlvbigpe3ZhciBhLGIsYyxkLGU7Yj15LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksYi5zZXRBdHRyaWJ1dGUoXCJjbGFzc05hbWVcIixcInRcIiksYi5pbm5lckhUTUw9XCIgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYSc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz5cIixkPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJhXCIpWzBdLGM9eS5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpLGU9Yy5hcHBlbmRDaGlsZCh5LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIikpLGE9Yi5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpWzBdLGQuc3R5bGUuY3NzVGV4dD1cInRvcDoxcHhcIixrLmdldFNldEF0dHJpYnV0ZT1cInRcIiE9PWIuY2xhc3NOYW1lLGsuc3R5bGU9L3RvcC8udGVzdChkLmdldEF0dHJpYnV0ZShcInN0eWxlXCIpKSxrLmhyZWZOb3JtYWxpemVkPVwiL2FcIj09PWQuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKSxrLmNoZWNrT249ISFhLnZhbHVlLGsub3B0U2VsZWN0ZWQ9ZS5zZWxlY3RlZCxrLmVuY3R5cGU9ISF5LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpLmVuY3R5cGUsYy5kaXNhYmxlZD0hMCxrLm9wdERpc2FibGVkPSFlLmRpc2FibGVkLGE9eS5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksYS5zZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiLFwiXCIpLGsuaW5wdXQ9XCJcIj09PWEuZ2V0QXR0cmlidXRlKFwidmFsdWVcIiksYS52YWx1ZT1cInRcIixhLnNldEF0dHJpYnV0ZShcInR5cGVcIixcInJhZGlvXCIpLGsucmFkaW9WYWx1ZT1cInRcIj09PWEudmFsdWV9KCk7dmFyIGxiPS9cXHIvZzttLmZuLmV4dGVuZCh7dmFsOmZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlPXRoaXNbMF07e2lmKGFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGQ9bS5pc0Z1bmN0aW9uKGEpLHRoaXMuZWFjaChmdW5jdGlvbihjKXt2YXIgZTsxPT09dGhpcy5ub2RlVHlwZSYmKGU9ZD9hLmNhbGwodGhpcyxjLG0odGhpcykudmFsKCkpOmEsbnVsbD09ZT9lPVwiXCI6XCJudW1iZXJcIj09dHlwZW9mIGU/ZSs9XCJcIjptLmlzQXJyYXkoZSkmJihlPW0ubWFwKGUsZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PWE/XCJcIjphK1wiXCJ9KSksYj1tLnZhbEhvb2tzW3RoaXMudHlwZV18fG0udmFsSG9va3NbdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSxiJiZcInNldFwiaW4gYiYmdm9pZCAwIT09Yi5zZXQodGhpcyxlLFwidmFsdWVcIil8fCh0aGlzLnZhbHVlPWUpKX0pO2lmKGUpcmV0dXJuIGI9bS52YWxIb29rc1tlLnR5cGVdfHxtLnZhbEhvb2tzW2Uubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0sYiYmXCJnZXRcImluIGImJnZvaWQgMCE9PShjPWIuZ2V0KGUsXCJ2YWx1ZVwiKSk/YzooYz1lLnZhbHVlLFwic3RyaW5nXCI9PXR5cGVvZiBjP2MucmVwbGFjZShsYixcIlwiKTpudWxsPT1jP1wiXCI6Yyl9fX0pLG0uZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9bS5maW5kLmF0dHIoYSxcInZhbHVlXCIpO3JldHVybiBudWxsIT1iP2I6bS50cmltKG0udGV4dChhKSl9fSxzZWxlY3Q6e2dldDpmdW5jdGlvbihhKXtmb3IodmFyIGIsYyxkPWEub3B0aW9ucyxlPWEuc2VsZWN0ZWRJbmRleCxmPVwic2VsZWN0LW9uZVwiPT09YS50eXBlfHwwPmUsZz1mP251bGw6W10saD1mP2UrMTpkLmxlbmd0aCxpPTA+ZT9oOmY/ZTowO2g+aTtpKyspaWYoYz1kW2ldLCEoIWMuc2VsZWN0ZWQmJmkhPT1lfHwoay5vcHREaXNhYmxlZD9jLmRpc2FibGVkOm51bGwhPT1jLmdldEF0dHJpYnV0ZShcImRpc2FibGVkXCIpKXx8Yy5wYXJlbnROb2RlLmRpc2FibGVkJiZtLm5vZGVOYW1lKGMucGFyZW50Tm9kZSxcIm9wdGdyb3VwXCIpKSl7aWYoYj1tKGMpLnZhbCgpLGYpcmV0dXJuIGI7Zy5wdXNoKGIpfXJldHVybiBnfSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGU9YS5vcHRpb25zLGY9bS5tYWtlQXJyYXkoYiksZz1lLmxlbmd0aDt3aGlsZShnLS0paWYoZD1lW2ddLG0uaW5BcnJheShtLnZhbEhvb2tzLm9wdGlvbi5nZXQoZCksZik+PTApdHJ5e2Quc2VsZWN0ZWQ9Yz0hMH1jYXRjaChoKXtkLnNjcm9sbEhlaWdodH1lbHNlIGQuc2VsZWN0ZWQ9ITE7cmV0dXJuIGN8fChhLnNlbGVjdGVkSW5kZXg9LTEpLGV9fX19KSxtLmVhY2goW1wicmFkaW9cIixcImNoZWNrYm94XCJdLGZ1bmN0aW9uKCl7bS52YWxIb29rc1t0aGlzXT17c2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uaXNBcnJheShiKT9hLmNoZWNrZWQ9bS5pbkFycmF5KG0oYSkudmFsKCksYik+PTA6dm9pZCAwfX0say5jaGVja09ufHwobS52YWxIb29rc1t0aGlzXS5nZXQ9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PT1hLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpP1wib25cIjphLnZhbHVlfSl9KTt2YXIgbWIsbmIsb2I9bS5leHByLmF0dHJIYW5kbGUscGI9L14oPzpjaGVja2VkfHNlbGVjdGVkKSQvaSxxYj1rLmdldFNldEF0dHJpYnV0ZSxyYj1rLmlucHV0O20uZm4uZXh0ZW5kKHthdHRyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIFYodGhpcyxtLmF0dHIsYSxiLGFyZ3VtZW50cy5sZW5ndGg+MSl9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe20ucmVtb3ZlQXR0cih0aGlzLGEpfSl9fSksbS5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZj1hLm5vZGVUeXBlO2lmKGEmJjMhPT1mJiY4IT09ZiYmMiE9PWYpcmV0dXJuIHR5cGVvZiBhLmdldEF0dHJpYnV0ZT09PUs/bS5wcm9wKGEsYixjKTooMT09PWYmJm0uaXNYTUxEb2MoYSl8fChiPWIudG9Mb3dlckNhc2UoKSxkPW0uYXR0ckhvb2tzW2JdfHwobS5leHByLm1hdGNoLmJvb2wudGVzdChiKT9uYjptYikpLHZvaWQgMD09PWM/ZCYmXCJnZXRcImluIGQmJm51bGwhPT0oZT1kLmdldChhLGIpKT9lOihlPW0uZmluZC5hdHRyKGEsYiksbnVsbD09ZT92b2lkIDA6ZSk6bnVsbCE9PWM/ZCYmXCJzZXRcImluIGQmJnZvaWQgMCE9PShlPWQuc2V0KGEsYyxiKSk/ZTooYS5zZXRBdHRyaWJ1dGUoYixjK1wiXCIpLGMpOnZvaWQgbS5yZW1vdmVBdHRyKGEsYikpfSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlPTAsZj1iJiZiLm1hdGNoKEUpO2lmKGYmJjE9PT1hLm5vZGVUeXBlKXdoaWxlKGM9ZltlKytdKWQ9bS5wcm9wRml4W2NdfHxjLG0uZXhwci5tYXRjaC5ib29sLnRlc3QoYyk/cmImJnFifHwhcGIudGVzdChjKT9hW2RdPSExOmFbbS5jYW1lbENhc2UoXCJkZWZhdWx0LVwiK2MpXT1hW2RdPSExOm0uYXR0cihhLGMsXCJcIiksYS5yZW1vdmVBdHRyaWJ1dGUocWI/YzpkKX0sYXR0ckhvb2tzOnt0eXBlOntzZXQ6ZnVuY3Rpb24oYSxiKXtpZighay5yYWRpb1ZhbHVlJiZcInJhZGlvXCI9PT1iJiZtLm5vZGVOYW1lKGEsXCJpbnB1dFwiKSl7dmFyIGM9YS52YWx1ZTtyZXR1cm4gYS5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsYiksYyYmKGEudmFsdWU9YyksYn19fX19KSxuYj17c2V0OmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYj09PSExP20ucmVtb3ZlQXR0cihhLGMpOnJiJiZxYnx8IXBiLnRlc3QoYyk/YS5zZXRBdHRyaWJ1dGUoIXFiJiZtLnByb3BGaXhbY118fGMsYyk6YVttLmNhbWVsQ2FzZShcImRlZmF1bHQtXCIrYyldPWFbY109ITAsY319LG0uZWFjaChtLmV4cHIubWF0Y2guYm9vbC5zb3VyY2UubWF0Y2goL1xcdysvZyksZnVuY3Rpb24oYSxiKXt2YXIgYz1vYltiXXx8bS5maW5kLmF0dHI7b2JbYl09cmImJnFifHwhcGIudGVzdChiKT9mdW5jdGlvbihhLGIsZCl7dmFyIGUsZjtyZXR1cm4gZHx8KGY9b2JbYl0sb2JbYl09ZSxlPW51bGwhPWMoYSxiLGQpP2IudG9Mb3dlckNhc2UoKTpudWxsLG9iW2JdPWYpLGV9OmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYz92b2lkIDA6YVttLmNhbWVsQ2FzZShcImRlZmF1bHQtXCIrYildP2IudG9Mb3dlckNhc2UoKTpudWxsfX0pLHJiJiZxYnx8KG0uYXR0ckhvb2tzLnZhbHVlPXtzZXQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBtLm5vZGVOYW1lKGEsXCJpbnB1dFwiKT92b2lkKGEuZGVmYXVsdFZhbHVlPWIpOm1iJiZtYi5zZXQoYSxiLGMpfX0pLHFifHwobWI9e3NldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkfHxhLnNldEF0dHJpYnV0ZU5vZGUoZD1hLm93bmVyRG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKGMpKSxkLnZhbHVlPWIrPVwiXCIsXCJ2YWx1ZVwiPT09Y3x8Yj09PWEuZ2V0QXR0cmlidXRlKGMpP2I6dm9pZCAwfX0sb2IuaWQ9b2IubmFtZT1vYi5jb29yZHM9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO3JldHVybiBjP3ZvaWQgMDooZD1hLmdldEF0dHJpYnV0ZU5vZGUoYikpJiZcIlwiIT09ZC52YWx1ZT9kLnZhbHVlOm51bGx9LG0udmFsSG9va3MuYnV0dG9uPXtnZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmdldEF0dHJpYnV0ZU5vZGUoYik7cmV0dXJuIGMmJmMuc3BlY2lmaWVkP2MudmFsdWU6dm9pZCAwfSxzZXQ6bWIuc2V0fSxtLmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGU9e3NldDpmdW5jdGlvbihhLGIsYyl7bWIuc2V0KGEsXCJcIj09PWI/ITE6YixjKX19LG0uZWFjaChbXCJ3aWR0aFwiLFwiaGVpZ2h0XCJdLGZ1bmN0aW9uKGEsYil7bS5hdHRySG9va3NbYl09e3NldDpmdW5jdGlvbihhLGMpe3JldHVyblwiXCI9PT1jPyhhLnNldEF0dHJpYnV0ZShiLFwiYXV0b1wiKSxjKTp2b2lkIDB9fX0pKSxrLnN0eWxlfHwobS5hdHRySG9va3Muc3R5bGU9e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5zdHlsZS5jc3NUZXh0fHx2b2lkIDB9LHNldDpmdW5jdGlvbihhLGIpe3JldHVybiBhLnN0eWxlLmNzc1RleHQ9YitcIlwifX0pO3ZhciBzYj0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSx0Yj0vXig/OmF8YXJlYSkkL2k7bS5mbi5leHRlbmQoe3Byb3A6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gVih0aGlzLG0ucHJvcCxhLGIsYXJndW1lbnRzLmxlbmd0aD4xKX0scmVtb3ZlUHJvcDpmdW5jdGlvbihhKXtyZXR1cm4gYT1tLnByb3BGaXhbYV18fGEsdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dHJ5e3RoaXNbYV09dm9pZCAwLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGIpe319KX19KSxtLmV4dGVuZCh7cHJvcEZpeDp7XCJmb3JcIjpcImh0bWxGb3JcIixcImNsYXNzXCI6XCJjbGFzc05hbWVcIn0scHJvcDpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmLGc9YS5ub2RlVHlwZTtpZihhJiYzIT09ZyYmOCE9PWcmJjIhPT1nKXJldHVybiBmPTEhPT1nfHwhbS5pc1hNTERvYyhhKSxmJiYoYj1tLnByb3BGaXhbYl18fGIsZT1tLnByb3BIb29rc1tiXSksdm9pZCAwIT09Yz9lJiZcInNldFwiaW4gZSYmdm9pZCAwIT09KGQ9ZS5zZXQoYSxjLGIpKT9kOmFbYl09YzplJiZcImdldFwiaW4gZSYmbnVsbCE9PShkPWUuZ2V0KGEsYikpP2Q6YVtiXX0scHJvcEhvb2tzOnt0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiPW0uZmluZC5hdHRyKGEsXCJ0YWJpbmRleFwiKTtyZXR1cm4gYj9wYXJzZUludChiLDEwKTpzYi50ZXN0KGEubm9kZU5hbWUpfHx0Yi50ZXN0KGEubm9kZU5hbWUpJiZhLmhyZWY/MDotMX19fX0pLGsuaHJlZk5vcm1hbGl6ZWR8fG0uZWFjaChbXCJocmVmXCIsXCJzcmNcIl0sZnVuY3Rpb24oYSxiKXttLnByb3BIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZShiLDQpfX19KSxrLm9wdFNlbGVjdGVkfHwobS5wcm9wSG9va3Muc2VsZWN0ZWQ9e2dldDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJihiLnNlbGVjdGVkSW5kZXgsYi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCksbnVsbH19KSxtLmVhY2goW1widGFiSW5kZXhcIixcInJlYWRPbmx5XCIsXCJtYXhMZW5ndGhcIixcImNlbGxTcGFjaW5nXCIsXCJjZWxsUGFkZGluZ1wiLFwicm93U3BhblwiLFwiY29sU3BhblwiLFwidXNlTWFwXCIsXCJmcmFtZUJvcmRlclwiLFwiY29udGVudEVkaXRhYmxlXCJdLGZ1bmN0aW9uKCl7bS5wcm9wRml4W3RoaXMudG9Mb3dlckNhc2UoKV09dGhpc30pLGsuZW5jdHlwZXx8KG0ucHJvcEZpeC5lbmN0eXBlPVwiZW5jb2RpbmdcIik7dmFyIHViPS9bXFx0XFxyXFxuXFxmXS9nO20uZm4uZXh0ZW5kKHthZGRDbGFzczpmdW5jdGlvbihhKXt2YXIgYixjLGQsZSxmLGcsaD0wLGk9dGhpcy5sZW5ndGgsaj1cInN0cmluZ1wiPT10eXBlb2YgYSYmYTtpZihtLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXttKHRoaXMpLmFkZENsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGopZm9yKGI9KGF8fFwiXCIpLm1hdGNoKEUpfHxbXTtpPmg7aCsrKWlmKGM9dGhpc1toXSxkPTE9PT1jLm5vZGVUeXBlJiYoYy5jbGFzc05hbWU/KFwiIFwiK2MuY2xhc3NOYW1lK1wiIFwiKS5yZXBsYWNlKHViLFwiIFwiKTpcIiBcIikpe2Y9MDt3aGlsZShlPWJbZisrXSlkLmluZGV4T2YoXCIgXCIrZStcIiBcIik8MCYmKGQrPWUrXCIgXCIpO2c9bS50cmltKGQpLGMuY2xhc3NOYW1lIT09ZyYmKGMuY2xhc3NOYW1lPWcpfXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYixjLGQsZSxmLGcsaD0wLGk9dGhpcy5sZW5ndGgsaj0wPT09YXJndW1lbnRzLmxlbmd0aHx8XCJzdHJpbmdcIj09dHlwZW9mIGEmJmE7aWYobS5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7bSh0aGlzKS5yZW1vdmVDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihqKWZvcihiPShhfHxcIlwiKS5tYXRjaChFKXx8W107aT5oO2grKylpZihjPXRoaXNbaF0sZD0xPT09Yy5ub2RlVHlwZSYmKGMuY2xhc3NOYW1lPyhcIiBcIitjLmNsYXNzTmFtZStcIiBcIikucmVwbGFjZSh1YixcIiBcIik6XCJcIikpe2Y9MDt3aGlsZShlPWJbZisrXSl3aGlsZShkLmluZGV4T2YoXCIgXCIrZStcIiBcIik+PTApZD1kLnJlcGxhY2UoXCIgXCIrZStcIiBcIixcIiBcIik7Zz1hP20udHJpbShkKTpcIlwiLGMuY2xhc3NOYW1lIT09ZyYmKGMuY2xhc3NOYW1lPWcpfXJldHVybiB0aGlzfSx0b2dnbGVDbGFzczpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBhO3JldHVyblwiYm9vbGVhblwiPT10eXBlb2YgYiYmXCJzdHJpbmdcIj09PWM/Yj90aGlzLmFkZENsYXNzKGEpOnRoaXMucmVtb3ZlQ2xhc3MoYSk6dGhpcy5lYWNoKG0uaXNGdW5jdGlvbihhKT9mdW5jdGlvbihjKXttKHRoaXMpLnRvZ2dsZUNsYXNzKGEuY2FsbCh0aGlzLGMsdGhpcy5jbGFzc05hbWUsYiksYil9OmZ1bmN0aW9uKCl7aWYoXCJzdHJpbmdcIj09PWMpe3ZhciBiLGQ9MCxlPW0odGhpcyksZj1hLm1hdGNoKEUpfHxbXTt3aGlsZShiPWZbZCsrXSllLmhhc0NsYXNzKGIpP2UucmVtb3ZlQ2xhc3MoYik6ZS5hZGRDbGFzcyhiKX1lbHNlKGM9PT1LfHxcImJvb2xlYW5cIj09PWMpJiYodGhpcy5jbGFzc05hbWUmJm0uX2RhdGEodGhpcyxcIl9fY2xhc3NOYW1lX19cIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT9cIlwiOm0uX2RhdGEodGhpcyxcIl9fY2xhc3NOYW1lX19cIil8fFwiXCIpfSl9LGhhc0NsYXNzOmZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1cIiBcIithK1wiIFwiLGM9MCxkPXRoaXMubGVuZ3RoO2Q+YztjKyspaWYoMT09PXRoaXNbY10ubm9kZVR5cGUmJihcIiBcIit0aGlzW2NdLmNsYXNzTmFtZStcIiBcIikucmVwbGFjZSh1YixcIiBcIikuaW5kZXhPZihiKT49MClyZXR1cm4hMDtyZXR1cm4hMX19KSxtLmVhY2goXCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGVycm9yIGNvbnRleHRtZW51XCIuc3BsaXQoXCIgXCIpLGZ1bmN0aW9uKGEsYil7bS5mbltiXT1mdW5jdGlvbihhLGMpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjA/dGhpcy5vbihiLG51bGwsYSxjKTp0aGlzLnRyaWdnZXIoYil9fSksbS5mbi5leHRlbmQoe2hvdmVyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMubW91c2VlbnRlcihhKS5tb3VzZWxlYXZlKGJ8fGEpfSxiaW5kOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5vbihhLG51bGwsYixjKX0sdW5iaW5kOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMub2ZmKGEsbnVsbCxiKX0sZGVsZWdhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMub24oYixhLGMsZCl9LHVuZGVsZWdhdGU6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD90aGlzLm9mZihhLFwiKipcIik6dGhpcy5vZmYoYixhfHxcIioqXCIsYyl9fSk7dmFyIHZiPW0ubm93KCksd2I9L1xcPy8seGI9LygsKXwoXFxbfHspfCh9fF0pfFwiKD86W15cIlxcXFxcXHJcXG5dfFxcXFxbXCJcXFxcXFwvYmZucnRdfFxcXFx1W1xcZGEtZkEtRl17NH0pKlwiXFxzKjo/fHRydWV8ZmFsc2V8bnVsbHwtPyg/ITBcXGQpXFxkKyg/OlxcLlxcZCt8KSg/OltlRV1bKy1dP1xcZCt8KS9nO20ucGFyc2VKU09OPWZ1bmN0aW9uKGIpe2lmKGEuSlNPTiYmYS5KU09OLnBhcnNlKXJldHVybiBhLkpTT04ucGFyc2UoYitcIlwiKTt2YXIgYyxkPW51bGwsZT1tLnRyaW0oYitcIlwiKTtyZXR1cm4gZSYmIW0udHJpbShlLnJlcGxhY2UoeGIsZnVuY3Rpb24oYSxiLGUsZil7cmV0dXJuIGMmJmImJihkPTApLDA9PT1kP2E6KGM9ZXx8YixkKz0hZi0hZSxcIlwiKX0pKT9GdW5jdGlvbihcInJldHVybiBcIitlKSgpOm0uZXJyb3IoXCJJbnZhbGlkIEpTT046IFwiK2IpfSxtLnBhcnNlWE1MPWZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoIWJ8fFwic3RyaW5nXCIhPXR5cGVvZiBiKXJldHVybiBudWxsO3RyeXthLkRPTVBhcnNlcj8oZD1uZXcgRE9NUGFyc2VyLGM9ZC5wYXJzZUZyb21TdHJpbmcoYixcInRleHQveG1sXCIpKTooYz1uZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxET01cIiksYy5hc3luYz1cImZhbHNlXCIsYy5sb2FkWE1MKGIpKX1jYXRjaChlKXtjPXZvaWQgMH1yZXR1cm4gYyYmYy5kb2N1bWVudEVsZW1lbnQmJiFjLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwicGFyc2VyZXJyb3JcIikubGVuZ3RofHxtLmVycm9yKFwiSW52YWxpZCBYTUw6IFwiK2IpLGN9O3ZhciB5Yix6YixBYj0vIy4qJC8sQmI9LyhbPyZdKV89W14mXSovLENiPS9eKC4qPyk6WyBcXHRdKihbXlxcclxcbl0qKVxccj8kL2dtLERiPS9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLEViPS9eKD86R0VUfEhFQUQpJC8sRmI9L15cXC9cXC8vLEdiPS9eKFtcXHcuKy1dKzopKD86XFwvXFwvKD86W15cXC8/I10qQHwpKFteXFwvPyM6XSopKD86OihcXGQrKXwpfCkvLEhiPXt9LEliPXt9LEpiPVwiKi9cIi5jb25jYXQoXCIqXCIpO3RyeXt6Yj1sb2NhdGlvbi5ocmVmfWNhdGNoKEtiKXt6Yj15LmNyZWF0ZUVsZW1lbnQoXCJhXCIpLHpiLmhyZWY9XCJcIix6Yj16Yi5ocmVmfXliPUdiLmV4ZWMoemIudG9Mb3dlckNhc2UoKSl8fFtdO2Z1bmN0aW9uIExiKGEpe3JldHVybiBmdW5jdGlvbihiLGMpe1wic3RyaW5nXCIhPXR5cGVvZiBiJiYoYz1iLGI9XCIqXCIpO3ZhciBkLGU9MCxmPWIudG9Mb3dlckNhc2UoKS5tYXRjaChFKXx8W107aWYobS5pc0Z1bmN0aW9uKGMpKXdoaWxlKGQ9ZltlKytdKVwiK1wiPT09ZC5jaGFyQXQoMCk/KGQ9ZC5zbGljZSgxKXx8XCIqXCIsKGFbZF09YVtkXXx8W10pLnVuc2hpZnQoYykpOihhW2RdPWFbZF18fFtdKS5wdXNoKGMpfX1mdW5jdGlvbiBNYihhLGIsYyxkKXt2YXIgZT17fSxmPWE9PT1JYjtmdW5jdGlvbiBnKGgpe3ZhciBpO3JldHVybiBlW2hdPSEwLG0uZWFjaChhW2hdfHxbXSxmdW5jdGlvbihhLGgpe3ZhciBqPWgoYixjLGQpO3JldHVyblwic3RyaW5nXCIhPXR5cGVvZiBqfHxmfHxlW2pdP2Y/IShpPWopOnZvaWQgMDooYi5kYXRhVHlwZXMudW5zaGlmdChqKSxnKGopLCExKX0pLGl9cmV0dXJuIGcoYi5kYXRhVHlwZXNbMF0pfHwhZVtcIipcIl0mJmcoXCIqXCIpfWZ1bmN0aW9uIE5iKGEsYil7dmFyIGMsZCxlPW0uYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IoZCBpbiBiKXZvaWQgMCE9PWJbZF0mJigoZVtkXT9hOmN8fChjPXt9KSlbZF09YltkXSk7cmV0dXJuIGMmJm0uZXh0ZW5kKCEwLGEsYyksYX1mdW5jdGlvbiBPYihhLGIsYyl7dmFyIGQsZSxmLGcsaD1hLmNvbnRlbnRzLGk9YS5kYXRhVHlwZXM7d2hpbGUoXCIqXCI9PT1pWzBdKWkuc2hpZnQoKSx2b2lkIDA9PT1lJiYoZT1hLm1pbWVUeXBlfHxiLmdldFJlc3BvbnNlSGVhZGVyKFwiQ29udGVudC1UeXBlXCIpKTtpZihlKWZvcihnIGluIGgpaWYoaFtnXSYmaFtnXS50ZXN0KGUpKXtpLnVuc2hpZnQoZyk7YnJlYWt9aWYoaVswXWluIGMpZj1pWzBdO2Vsc2V7Zm9yKGcgaW4gYyl7aWYoIWlbMF18fGEuY29udmVydGVyc1tnK1wiIFwiK2lbMF1dKXtmPWc7YnJlYWt9ZHx8KGQ9Zyl9Zj1mfHxkfXJldHVybiBmPyhmIT09aVswXSYmaS51bnNoaWZ0KGYpLGNbZl0pOnZvaWQgMH1mdW5jdGlvbiBQYihhLGIsYyxkKXt2YXIgZSxmLGcsaCxpLGo9e30saz1hLmRhdGFUeXBlcy5zbGljZSgpO2lmKGtbMV0pZm9yKGcgaW4gYS5jb252ZXJ0ZXJzKWpbZy50b0xvd2VyQ2FzZSgpXT1hLmNvbnZlcnRlcnNbZ107Zj1rLnNoaWZ0KCk7d2hpbGUoZilpZihhLnJlc3BvbnNlRmllbGRzW2ZdJiYoY1thLnJlc3BvbnNlRmllbGRzW2ZdXT1iKSwhaSYmZCYmYS5kYXRhRmlsdGVyJiYoYj1hLmRhdGFGaWx0ZXIoYixhLmRhdGFUeXBlKSksaT1mLGY9ay5zaGlmdCgpKWlmKFwiKlwiPT09ZilmPWk7ZWxzZSBpZihcIipcIiE9PWkmJmkhPT1mKXtpZihnPWpbaStcIiBcIitmXXx8altcIiogXCIrZl0sIWcpZm9yKGUgaW4gailpZihoPWUuc3BsaXQoXCIgXCIpLGhbMV09PT1mJiYoZz1qW2krXCIgXCIraFswXV18fGpbXCIqIFwiK2hbMF1dKSl7Zz09PSEwP2c9altlXTpqW2VdIT09ITAmJihmPWhbMF0say51bnNoaWZ0KGhbMV0pKTticmVha31pZihnIT09ITApaWYoZyYmYVtcInRocm93c1wiXSliPWcoYik7ZWxzZSB0cnl7Yj1nKGIpfWNhdGNoKGwpe3JldHVybntzdGF0ZTpcInBhcnNlcmVycm9yXCIsZXJyb3I6Zz9sOlwiTm8gY29udmVyc2lvbiBmcm9tIFwiK2krXCIgdG8gXCIrZn19fXJldHVybntzdGF0ZTpcInN1Y2Nlc3NcIixkYXRhOmJ9fW0uZXh0ZW5kKHthY3RpdmU6MCxsYXN0TW9kaWZpZWQ6e30sZXRhZzp7fSxhamF4U2V0dGluZ3M6e3VybDp6Yix0eXBlOlwiR0VUXCIsaXNMb2NhbDpEYi50ZXN0KHliWzFdKSxnbG9iYWw6ITAscHJvY2Vzc0RhdGE6ITAsYXN5bmM6ITAsY29udGVudFR5cGU6XCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLThcIixhY2NlcHRzOntcIipcIjpKYix0ZXh0OlwidGV4dC9wbGFpblwiLGh0bWw6XCJ0ZXh0L2h0bWxcIix4bWw6XCJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sXCIsanNvbjpcImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdFwifSxjb250ZW50czp7eG1sOi94bWwvLGh0bWw6L2h0bWwvLGpzb246L2pzb24vfSxyZXNwb25zZUZpZWxkczp7eG1sOlwicmVzcG9uc2VYTUxcIix0ZXh0OlwicmVzcG9uc2VUZXh0XCIsanNvbjpcInJlc3BvbnNlSlNPTlwifSxjb252ZXJ0ZXJzOntcIiogdGV4dFwiOlN0cmluZyxcInRleHQgaHRtbFwiOiEwLFwidGV4dCBqc29uXCI6bS5wYXJzZUpTT04sXCJ0ZXh0IHhtbFwiOm0ucGFyc2VYTUx9LGZsYXRPcHRpb25zOnt1cmw6ITAsY29udGV4dDohMH19LGFqYXhTZXR1cDpmdW5jdGlvbihhLGIpe3JldHVybiBiP05iKE5iKGEsbS5hamF4U2V0dGluZ3MpLGIpOk5iKG0uYWpheFNldHRpbmdzLGEpfSxhamF4UHJlZmlsdGVyOkxiKEhiKSxhamF4VHJhbnNwb3J0OkxiKEliKSxhamF4OmZ1bmN0aW9uKGEsYil7XCJvYmplY3RcIj09dHlwZW9mIGEmJihiPWEsYT12b2lkIDApLGI9Ynx8e307dmFyIGMsZCxlLGYsZyxoLGksaixrPW0uYWpheFNldHVwKHt9LGIpLGw9ay5jb250ZXh0fHxrLG49ay5jb250ZXh0JiYobC5ub2RlVHlwZXx8bC5qcXVlcnkpP20obCk6bS5ldmVudCxvPW0uRGVmZXJyZWQoKSxwPW0uQ2FsbGJhY2tzKFwib25jZSBtZW1vcnlcIikscT1rLnN0YXR1c0NvZGV8fHt9LHI9e30scz17fSx0PTAsdT1cImNhbmNlbGVkXCIsdj17cmVhZHlTdGF0ZTowLGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGEpe3ZhciBiO2lmKDI9PT10KXtpZighail7aj17fTt3aGlsZShiPUNiLmV4ZWMoZikpaltiWzFdLnRvTG93ZXJDYXNlKCldPWJbMl19Yj1qW2EudG9Mb3dlckNhc2UoKV19cmV0dXJuIG51bGw9PWI/bnVsbDpifSxnZXRBbGxSZXNwb25zZUhlYWRlcnM6ZnVuY3Rpb24oKXtyZXR1cm4gMj09PXQ/ZjpudWxsfSxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGEsYil7dmFyIGM9YS50b0xvd2VyQ2FzZSgpO3JldHVybiB0fHwoYT1zW2NdPXNbY118fGEsclthXT1iKSx0aGlzfSxvdmVycmlkZU1pbWVUeXBlOmZ1bmN0aW9uKGEpe3JldHVybiB0fHwoay5taW1lVHlwZT1hKSx0aGlzfSxzdGF0dXNDb2RlOmZ1bmN0aW9uKGEpe3ZhciBiO2lmKGEpaWYoMj50KWZvcihiIGluIGEpcVtiXT1bcVtiXSxhW2JdXTtlbHNlIHYuYWx3YXlzKGFbdi5zdGF0dXNdKTtyZXR1cm4gdGhpc30sYWJvcnQ6ZnVuY3Rpb24oYSl7dmFyIGI9YXx8dTtyZXR1cm4gaSYmaS5hYm9ydChiKSx4KDAsYiksdGhpc319O2lmKG8ucHJvbWlzZSh2KS5jb21wbGV0ZT1wLmFkZCx2LnN1Y2Nlc3M9di5kb25lLHYuZXJyb3I9di5mYWlsLGsudXJsPSgoYXx8ay51cmx8fHpiKStcIlwiKS5yZXBsYWNlKEFiLFwiXCIpLnJlcGxhY2UoRmIseWJbMV0rXCIvL1wiKSxrLnR5cGU9Yi5tZXRob2R8fGIudHlwZXx8ay5tZXRob2R8fGsudHlwZSxrLmRhdGFUeXBlcz1tLnRyaW0oay5kYXRhVHlwZXx8XCIqXCIpLnRvTG93ZXJDYXNlKCkubWF0Y2goRSl8fFtcIlwiXSxudWxsPT1rLmNyb3NzRG9tYWluJiYoYz1HYi5leGVjKGsudXJsLnRvTG93ZXJDYXNlKCkpLGsuY3Jvc3NEb21haW49ISghY3x8Y1sxXT09PXliWzFdJiZjWzJdPT09eWJbMl0mJihjWzNdfHwoXCJodHRwOlwiPT09Y1sxXT9cIjgwXCI6XCI0NDNcIikpPT09KHliWzNdfHwoXCJodHRwOlwiPT09eWJbMV0/XCI4MFwiOlwiNDQzXCIpKSkpLGsuZGF0YSYmay5wcm9jZXNzRGF0YSYmXCJzdHJpbmdcIiE9dHlwZW9mIGsuZGF0YSYmKGsuZGF0YT1tLnBhcmFtKGsuZGF0YSxrLnRyYWRpdGlvbmFsKSksTWIoSGIsayxiLHYpLDI9PT10KXJldHVybiB2O2g9bS5ldmVudCYmay5nbG9iYWwsaCYmMD09PW0uYWN0aXZlKysmJm0uZXZlbnQudHJpZ2dlcihcImFqYXhTdGFydFwiKSxrLnR5cGU9ay50eXBlLnRvVXBwZXJDYXNlKCksay5oYXNDb250ZW50PSFFYi50ZXN0KGsudHlwZSksZT1rLnVybCxrLmhhc0NvbnRlbnR8fChrLmRhdGEmJihlPWsudXJsKz0od2IudGVzdChlKT9cIiZcIjpcIj9cIikray5kYXRhLGRlbGV0ZSBrLmRhdGEpLGsuY2FjaGU9PT0hMSYmKGsudXJsPUJiLnRlc3QoZSk/ZS5yZXBsYWNlKEJiLFwiJDFfPVwiK3ZiKyspOmUrKHdiLnRlc3QoZSk/XCImXCI6XCI/XCIpK1wiXz1cIit2YisrKSksay5pZk1vZGlmaWVkJiYobS5sYXN0TW9kaWZpZWRbZV0mJnYuc2V0UmVxdWVzdEhlYWRlcihcIklmLU1vZGlmaWVkLVNpbmNlXCIsbS5sYXN0TW9kaWZpZWRbZV0pLG0uZXRhZ1tlXSYmdi5zZXRSZXF1ZXN0SGVhZGVyKFwiSWYtTm9uZS1NYXRjaFwiLG0uZXRhZ1tlXSkpLChrLmRhdGEmJmsuaGFzQ29udGVudCYmay5jb250ZW50VHlwZSE9PSExfHxiLmNvbnRlbnRUeXBlKSYmdi5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsay5jb250ZW50VHlwZSksdi5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0XCIsay5kYXRhVHlwZXNbMF0mJmsuYWNjZXB0c1trLmRhdGFUeXBlc1swXV0/ay5hY2NlcHRzW2suZGF0YVR5cGVzWzBdXSsoXCIqXCIhPT1rLmRhdGFUeXBlc1swXT9cIiwgXCIrSmIrXCI7IHE9MC4wMVwiOlwiXCIpOmsuYWNjZXB0c1tcIipcIl0pO2ZvcihkIGluIGsuaGVhZGVycyl2LnNldFJlcXVlc3RIZWFkZXIoZCxrLmhlYWRlcnNbZF0pO2lmKGsuYmVmb3JlU2VuZCYmKGsuYmVmb3JlU2VuZC5jYWxsKGwsdixrKT09PSExfHwyPT09dCkpcmV0dXJuIHYuYWJvcnQoKTt1PVwiYWJvcnRcIjtmb3IoZCBpbntzdWNjZXNzOjEsZXJyb3I6MSxjb21wbGV0ZToxfSl2W2RdKGtbZF0pO2lmKGk9TWIoSWIsayxiLHYpKXt2LnJlYWR5U3RhdGU9MSxoJiZuLnRyaWdnZXIoXCJhamF4U2VuZFwiLFt2LGtdKSxrLmFzeW5jJiZrLnRpbWVvdXQ+MCYmKGc9c2V0VGltZW91dChmdW5jdGlvbigpe3YuYWJvcnQoXCJ0aW1lb3V0XCIpfSxrLnRpbWVvdXQpKTt0cnl7dD0xLGkuc2VuZChyLHgpfWNhdGNoKHcpe2lmKCEoMj50KSl0aHJvdyB3O3goLTEsdyl9fWVsc2UgeCgtMSxcIk5vIFRyYW5zcG9ydFwiKTtmdW5jdGlvbiB4KGEsYixjLGQpe3ZhciBqLHIscyx1LHcseD1iOzIhPT10JiYodD0yLGcmJmNsZWFyVGltZW91dChnKSxpPXZvaWQgMCxmPWR8fFwiXCIsdi5yZWFkeVN0YXRlPWE+MD80OjAsaj1hPj0yMDAmJjMwMD5hfHwzMDQ9PT1hLGMmJih1PU9iKGssdixjKSksdT1QYihrLHUsdixqKSxqPyhrLmlmTW9kaWZpZWQmJih3PXYuZ2V0UmVzcG9uc2VIZWFkZXIoXCJMYXN0LU1vZGlmaWVkXCIpLHcmJihtLmxhc3RNb2RpZmllZFtlXT13KSx3PXYuZ2V0UmVzcG9uc2VIZWFkZXIoXCJldGFnXCIpLHcmJihtLmV0YWdbZV09dykpLDIwND09PWF8fFwiSEVBRFwiPT09ay50eXBlP3g9XCJub2NvbnRlbnRcIjozMDQ9PT1hP3g9XCJub3Rtb2RpZmllZFwiOih4PXUuc3RhdGUscj11LmRhdGEscz11LmVycm9yLGo9IXMpKToocz14LChhfHwheCkmJih4PVwiZXJyb3JcIiwwPmEmJihhPTApKSksdi5zdGF0dXM9YSx2LnN0YXR1c1RleHQ9KGJ8fHgpK1wiXCIsaj9vLnJlc29sdmVXaXRoKGwsW3IseCx2XSk6by5yZWplY3RXaXRoKGwsW3YseCxzXSksdi5zdGF0dXNDb2RlKHEpLHE9dm9pZCAwLGgmJm4udHJpZ2dlcihqP1wiYWpheFN1Y2Nlc3NcIjpcImFqYXhFcnJvclwiLFt2LGssaj9yOnNdKSxwLmZpcmVXaXRoKGwsW3YseF0pLGgmJihuLnRyaWdnZXIoXCJhamF4Q29tcGxldGVcIixbdixrXSksLS1tLmFjdGl2ZXx8bS5ldmVudC50cmlnZ2VyKFwiYWpheFN0b3BcIikpKX1yZXR1cm4gdn0sZ2V0SlNPTjpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIG0uZ2V0KGEsYixjLFwianNvblwiKX0sZ2V0U2NyaXB0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uZ2V0KGEsdm9pZCAwLGIsXCJzY3JpcHRcIil9fSksbS5lYWNoKFtcImdldFwiLFwicG9zdFwiXSxmdW5jdGlvbihhLGIpe21bYl09ZnVuY3Rpb24oYSxjLGQsZSl7cmV0dXJuIG0uaXNGdW5jdGlvbihjKSYmKGU9ZXx8ZCxkPWMsYz12b2lkIDApLG0uYWpheCh7dXJsOmEsdHlwZTpiLGRhdGFUeXBlOmUsZGF0YTpjLHN1Y2Nlc3M6ZH0pfX0pLG0uX2V2YWxVcmw9ZnVuY3Rpb24oYSl7cmV0dXJuIG0uYWpheCh7dXJsOmEsdHlwZTpcIkdFVFwiLGRhdGFUeXBlOlwic2NyaXB0XCIsYXN5bmM6ITEsZ2xvYmFsOiExLFwidGhyb3dzXCI6ITB9KX0sbS5mbi5leHRlbmQoe3dyYXBBbGw6ZnVuY3Rpb24oYSl7aWYobS5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7bSh0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLGIpKX0pO2lmKHRoaXNbMF0pe3ZhciBiPW0oYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKTt0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0Q2hpbGQmJjE9PT1hLmZpcnN0Q2hpbGQubm9kZVR5cGUpYT1hLmZpcnN0Q2hpbGQ7cmV0dXJuIGF9KS5hcHBlbmQodGhpcyl9cmV0dXJuIHRoaXN9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKG0uaXNGdW5jdGlvbihhKT9mdW5jdGlvbihiKXttKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9OmZ1bmN0aW9uKCl7dmFyIGI9bSh0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXt2YXIgYj1tLmlzRnVuY3Rpb24oYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXttKHRoaXMpLndyYXBBbGwoYj9hLmNhbGwodGhpcyxjKTphKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7bS5ub2RlTmFtZSh0aGlzLFwiYm9keVwiKXx8bSh0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpfSkuZW5kKCl9fSksbS5leHByLmZpbHRlcnMuaGlkZGVuPWZ1bmN0aW9uKGEpe3JldHVybiBhLm9mZnNldFdpZHRoPD0wJiZhLm9mZnNldEhlaWdodDw9MHx8IWsucmVsaWFibGVIaWRkZW5PZmZzZXRzKCkmJlwibm9uZVwiPT09KGEuc3R5bGUmJmEuc3R5bGUuZGlzcGxheXx8bS5jc3MoYSxcImRpc3BsYXlcIikpfSxtLmV4cHIuZmlsdGVycy52aXNpYmxlPWZ1bmN0aW9uKGEpe3JldHVybiFtLmV4cHIuZmlsdGVycy5oaWRkZW4oYSl9O3ZhciBRYj0vJTIwL2csUmI9L1xcW1xcXSQvLFNiPS9cXHI/XFxuL2csVGI9L14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLFViPS9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGtleWdlbikvaTtmdW5jdGlvbiBWYihhLGIsYyxkKXt2YXIgZTtpZihtLmlzQXJyYXkoYikpbS5lYWNoKGIsZnVuY3Rpb24oYixlKXtjfHxSYi50ZXN0KGEpP2QoYSxlKTpWYihhK1wiW1wiKyhcIm9iamVjdFwiPT10eXBlb2YgZT9iOlwiXCIpK1wiXVwiLGUsYyxkKX0pO2Vsc2UgaWYoY3x8XCJvYmplY3RcIiE9PW0udHlwZShiKSlkKGEsYik7ZWxzZSBmb3IoZSBpbiBiKVZiKGErXCJbXCIrZStcIl1cIixiW2VdLGMsZCl9bS5wYXJhbT1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9W10sZT1mdW5jdGlvbihhLGIpe2I9bS5pc0Z1bmN0aW9uKGIpP2IoKTpudWxsPT1iP1wiXCI6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGIpfTtpZih2b2lkIDA9PT1iJiYoYj1tLmFqYXhTZXR0aW5ncyYmbS5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpLG0uaXNBcnJheShhKXx8YS5qcXVlcnkmJiFtLmlzUGxhaW5PYmplY3QoYSkpbS5lYWNoKGEsZnVuY3Rpb24oKXtlKHRoaXMubmFtZSx0aGlzLnZhbHVlKX0pO2Vsc2UgZm9yKGMgaW4gYSlWYihjLGFbY10sYixlKTtyZXR1cm4gZC5qb2luKFwiJlwiKS5yZXBsYWNlKFFiLFwiK1wiKX0sbS5mbi5leHRlbmQoe3NlcmlhbGl6ZTpmdW5jdGlvbigpe3JldHVybiBtLnBhcmFtKHRoaXMuc2VyaWFsaXplQXJyYXkoKSl9LHNlcmlhbGl6ZUFycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGE9bS5wcm9wKHRoaXMsXCJlbGVtZW50c1wiKTtyZXR1cm4gYT9tLm1ha2VBcnJheShhKTp0aGlzfSkuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy50eXBlO3JldHVybiB0aGlzLm5hbWUmJiFtKHRoaXMpLmlzKFwiOmRpc2FibGVkXCIpJiZVYi50ZXN0KHRoaXMubm9kZU5hbWUpJiYhVGIudGVzdChhKSYmKHRoaXMuY2hlY2tlZHx8IVcudGVzdChhKSl9KS5tYXAoZnVuY3Rpb24oYSxiKXt2YXIgYz1tKHRoaXMpLnZhbCgpO3JldHVybiBudWxsPT1jP251bGw6bS5pc0FycmF5KGMpP20ubWFwKGMsZnVuY3Rpb24oYSl7cmV0dXJue25hbWU6Yi5uYW1lLHZhbHVlOmEucmVwbGFjZShTYixcIlxcclxcblwiKX19KTp7bmFtZTpiLm5hbWUsdmFsdWU6Yy5yZXBsYWNlKFNiLFwiXFxyXFxuXCIpfX0pLmdldCgpfX0pLG0uYWpheFNldHRpbmdzLnhocj12b2lkIDAhPT1hLkFjdGl2ZVhPYmplY3Q/ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5pc0xvY2FsJiYvXihnZXR8cG9zdHxoZWFkfHB1dHxkZWxldGV8b3B0aW9ucykkL2kudGVzdCh0aGlzLnR5cGUpJiZaYigpfHwkYigpfTpaYjt2YXIgV2I9MCxYYj17fSxZYj1tLmFqYXhTZXR0aW5ncy54aHIoKTthLmF0dGFjaEV2ZW50JiZhLmF0dGFjaEV2ZW50KFwib251bmxvYWRcIixmdW5jdGlvbigpe2Zvcih2YXIgYSBpbiBYYilYYlthXSh2b2lkIDAsITApfSksay5jb3JzPSEhWWImJlwid2l0aENyZWRlbnRpYWxzXCJpbiBZYixZYj1rLmFqYXg9ISFZYixZYiYmbS5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKGEpe2lmKCFhLmNyb3NzRG9tYWlufHxrLmNvcnMpe3ZhciBiO3JldHVybntzZW5kOmZ1bmN0aW9uKGMsZCl7dmFyIGUsZj1hLnhocigpLGc9KytXYjtpZihmLm9wZW4oYS50eXBlLGEudXJsLGEuYXN5bmMsYS51c2VybmFtZSxhLnBhc3N3b3JkKSxhLnhockZpZWxkcylmb3IoZSBpbiBhLnhockZpZWxkcylmW2VdPWEueGhyRmllbGRzW2VdO2EubWltZVR5cGUmJmYub3ZlcnJpZGVNaW1lVHlwZSYmZi5vdmVycmlkZU1pbWVUeXBlKGEubWltZVR5cGUpLGEuY3Jvc3NEb21haW58fGNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdfHwoY1tcIlgtUmVxdWVzdGVkLVdpdGhcIl09XCJYTUxIdHRwUmVxdWVzdFwiKTtmb3IoZSBpbiBjKXZvaWQgMCE9PWNbZV0mJmYuc2V0UmVxdWVzdEhlYWRlcihlLGNbZV0rXCJcIik7Zi5zZW5kKGEuaGFzQ29udGVudCYmYS5kYXRhfHxudWxsKSxiPWZ1bmN0aW9uKGMsZSl7dmFyIGgsaSxqO2lmKGImJihlfHw0PT09Zi5yZWFkeVN0YXRlKSlpZihkZWxldGUgWGJbZ10sYj12b2lkIDAsZi5vbnJlYWR5c3RhdGVjaGFuZ2U9bS5ub29wLGUpNCE9PWYucmVhZHlTdGF0ZSYmZi5hYm9ydCgpO2Vsc2V7aj17fSxoPWYuc3RhdHVzLFwic3RyaW5nXCI9PXR5cGVvZiBmLnJlc3BvbnNlVGV4dCYmKGoudGV4dD1mLnJlc3BvbnNlVGV4dCk7dHJ5e2k9Zi5zdGF0dXNUZXh0fWNhdGNoKGspe2k9XCJcIn1ofHwhYS5pc0xvY2FsfHxhLmNyb3NzRG9tYWluPzEyMjM9PT1oJiYoaD0yMDQpOmg9ai50ZXh0PzIwMDo0MDR9aiYmZChoLGksaixmLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKX0sYS5hc3luYz80PT09Zi5yZWFkeVN0YXRlP3NldFRpbWVvdXQoYik6Zi5vbnJlYWR5c3RhdGVjaGFuZ2U9WGJbZ109YjpiKCl9LGFib3J0OmZ1bmN0aW9uKCl7YiYmYih2b2lkIDAsITApfX19fSk7ZnVuY3Rpb24gWmIoKXt0cnl7cmV0dXJuIG5ldyBhLlhNTEh0dHBSZXF1ZXN0fWNhdGNoKGIpe319ZnVuY3Rpb24gJGIoKXt0cnl7cmV0dXJuIG5ldyBhLkFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MSFRUUFwiKX1jYXRjaChiKXt9fW0uYWpheFNldHVwKHthY2NlcHRzOntzY3JpcHQ6XCJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdFwifSxjb250ZW50czp7c2NyaXB0Oi8oPzpqYXZhfGVjbWEpc2NyaXB0L30sY29udmVydGVyczp7XCJ0ZXh0IHNjcmlwdFwiOmZ1bmN0aW9uKGEpe3JldHVybiBtLmdsb2JhbEV2YWwoYSksYX19fSksbS5hamF4UHJlZmlsdGVyKFwic2NyaXB0XCIsZnVuY3Rpb24oYSl7dm9pZCAwPT09YS5jYWNoZSYmKGEuY2FjaGU9ITEpLGEuY3Jvc3NEb21haW4mJihhLnR5cGU9XCJHRVRcIixhLmdsb2JhbD0hMSl9KSxtLmFqYXhUcmFuc3BvcnQoXCJzY3JpcHRcIixmdW5jdGlvbihhKXtpZihhLmNyb3NzRG9tYWluKXt2YXIgYixjPXkuaGVhZHx8bShcImhlYWRcIilbMF18fHkuZG9jdW1lbnRFbGVtZW50O3JldHVybntzZW5kOmZ1bmN0aW9uKGQsZSl7Yj15LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIiksYi5hc3luYz0hMCxhLnNjcmlwdENoYXJzZXQmJihiLmNoYXJzZXQ9YS5zY3JpcHRDaGFyc2V0KSxiLnNyYz1hLnVybCxiLm9ubG9hZD1iLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbihhLGMpeyhjfHwhYi5yZWFkeVN0YXRlfHwvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KGIucmVhZHlTdGF0ZSkpJiYoYi5vbmxvYWQ9Yi5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxiLnBhcmVudE5vZGUmJmIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChiKSxiPW51bGwsY3x8ZSgyMDAsXCJzdWNjZXNzXCIpKX0sYy5pbnNlcnRCZWZvcmUoYixjLmZpcnN0Q2hpbGQpfSxhYm9ydDpmdW5jdGlvbigpe2ImJmIub25sb2FkKHZvaWQgMCwhMCl9fX19KTt2YXIgX2I9W10sYWM9Lyg9KVxcPyg/PSZ8JCl8XFw/XFw/LzttLmFqYXhTZXR1cCh7anNvbnA6XCJjYWxsYmFja1wiLGpzb25wQ2FsbGJhY2s6ZnVuY3Rpb24oKXt2YXIgYT1fYi5wb3AoKXx8bS5leHBhbmRvK1wiX1wiK3ZiKys7cmV0dXJuIHRoaXNbYV09ITAsYX19KSxtLmFqYXhQcmVmaWx0ZXIoXCJqc29uIGpzb25wXCIsZnVuY3Rpb24oYixjLGQpe3ZhciBlLGYsZyxoPWIuanNvbnAhPT0hMSYmKGFjLnRlc3QoYi51cmwpP1widXJsXCI6XCJzdHJpbmdcIj09dHlwZW9mIGIuZGF0YSYmIShiLmNvbnRlbnRUeXBlfHxcIlwiKS5pbmRleE9mKFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpJiZhYy50ZXN0KGIuZGF0YSkmJlwiZGF0YVwiKTtyZXR1cm4gaHx8XCJqc29ucFwiPT09Yi5kYXRhVHlwZXNbMF0/KGU9Yi5qc29ucENhbGxiYWNrPW0uaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxoP2JbaF09YltoXS5yZXBsYWNlKGFjLFwiJDFcIitlKTpiLmpzb25wIT09ITEmJihiLnVybCs9KHdiLnRlc3QoYi51cmwpP1wiJlwiOlwiP1wiKStiLmpzb25wK1wiPVwiK2UpLGIuY29udmVydGVyc1tcInNjcmlwdCBqc29uXCJdPWZ1bmN0aW9uKCl7cmV0dXJuIGd8fG0uZXJyb3IoZStcIiB3YXMgbm90IGNhbGxlZFwiKSxnWzBdfSxiLmRhdGFUeXBlc1swXT1cImpzb25cIixmPWFbZV0sYVtlXT1mdW5jdGlvbigpe2c9YXJndW1lbnRzfSxkLmFsd2F5cyhmdW5jdGlvbigpe2FbZV09ZixiW2VdJiYoYi5qc29ucENhbGxiYWNrPWMuanNvbnBDYWxsYmFjayxfYi5wdXNoKGUpKSxnJiZtLmlzRnVuY3Rpb24oZikmJmYoZ1swXSksZz1mPXZvaWQgMH0pLFwic2NyaXB0XCIpOnZvaWQgMH0pLG0ucGFyc2VIVE1MPWZ1bmN0aW9uKGEsYixjKXtpZighYXx8XCJzdHJpbmdcIiE9dHlwZW9mIGEpcmV0dXJuIG51bGw7XCJib29sZWFuXCI9PXR5cGVvZiBiJiYoYz1iLGI9ITEpLGI9Ynx8eTt2YXIgZD11LmV4ZWMoYSksZT0hYyYmW107cmV0dXJuIGQ/W2IuY3JlYXRlRWxlbWVudChkWzFdKV06KGQ9bS5idWlsZEZyYWdtZW50KFthXSxiLGUpLGUmJmUubGVuZ3RoJiZtKGUpLnJlbW92ZSgpLG0ubWVyZ2UoW10sZC5jaGlsZE5vZGVzKSl9O3ZhciBiYz1tLmZuLmxvYWQ7bS5mbi5sb2FkPWZ1bmN0aW9uKGEsYixjKXtpZihcInN0cmluZ1wiIT10eXBlb2YgYSYmYmMpcmV0dXJuIGJjLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgZCxlLGYsZz10aGlzLGg9YS5pbmRleE9mKFwiIFwiKTtyZXR1cm4gaD49MCYmKGQ9bS50cmltKGEuc2xpY2UoaCxhLmxlbmd0aCkpLGE9YS5zbGljZSgwLGgpKSxtLmlzRnVuY3Rpb24oYik/KGM9YixiPXZvaWQgMCk6YiYmXCJvYmplY3RcIj09dHlwZW9mIGImJihmPVwiUE9TVFwiKSxnLmxlbmd0aD4wJiZtLmFqYXgoe3VybDphLHR5cGU6ZixkYXRhVHlwZTpcImh0bWxcIixkYXRhOmJ9KS5kb25lKGZ1bmN0aW9uKGEpe2U9YXJndW1lbnRzLGcuaHRtbChkP20oXCI8ZGl2PlwiKS5hcHBlbmQobS5wYXJzZUhUTUwoYSkpLmZpbmQoZCk6YSl9KS5jb21wbGV0ZShjJiZmdW5jdGlvbihhLGIpe2cuZWFjaChjLGV8fFthLnJlc3BvbnNlVGV4dCxiLGFdKX0pLHRoaXN9LG0uZWFjaChbXCJhamF4U3RhcnRcIixcImFqYXhTdG9wXCIsXCJhamF4Q29tcGxldGVcIixcImFqYXhFcnJvclwiLFwiYWpheFN1Y2Nlc3NcIixcImFqYXhTZW5kXCJdLGZ1bmN0aW9uKGEsYil7bS5mbltiXT1mdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5vbihiLGEpfX0pLG0uZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGEpe3JldHVybiBtLmdyZXAobS50aW1lcnMsZnVuY3Rpb24oYil7cmV0dXJuIGE9PT1iLmVsZW19KS5sZW5ndGh9O3ZhciBjYz1hLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtmdW5jdGlvbiBkYyhhKXtyZXR1cm4gbS5pc1dpbmRvdyhhKT9hOjk9PT1hLm5vZGVUeXBlP2EuZGVmYXVsdFZpZXd8fGEucGFyZW50V2luZG93OiExfW0ub2Zmc2V0PXtzZXRPZmZzZXQ6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZixnLGgsaSxqLGs9bS5jc3MoYSxcInBvc2l0aW9uXCIpLGw9bShhKSxuPXt9O1wic3RhdGljXCI9PT1rJiYoYS5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCIpLGg9bC5vZmZzZXQoKSxmPW0uY3NzKGEsXCJ0b3BcIiksaT1tLmNzcyhhLFwibGVmdFwiKSxqPShcImFic29sdXRlXCI9PT1rfHxcImZpeGVkXCI9PT1rKSYmbS5pbkFycmF5KFwiYXV0b1wiLFtmLGldKT4tMSxqPyhkPWwucG9zaXRpb24oKSxnPWQudG9wLGU9ZC5sZWZ0KTooZz1wYXJzZUZsb2F0KGYpfHwwLGU9cGFyc2VGbG9hdChpKXx8MCksbS5pc0Z1bmN0aW9uKGIpJiYoYj1iLmNhbGwoYSxjLGgpKSxudWxsIT1iLnRvcCYmKG4udG9wPWIudG9wLWgudG9wK2cpLG51bGwhPWIubGVmdCYmKG4ubGVmdD1iLmxlZnQtaC5sZWZ0K2UpLFwidXNpbmdcImluIGI/Yi51c2luZy5jYWxsKGEsbik6bC5jc3Mobil9fSxtLmZuLmV4dGVuZCh7b2Zmc2V0OmZ1bmN0aW9uKGEpe2lmKGFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIHZvaWQgMD09PWE/dGhpczp0aGlzLmVhY2goZnVuY3Rpb24oYil7bS5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsYSxiKX0pO3ZhciBiLGMsZD17dG9wOjAsbGVmdDowfSxlPXRoaXNbMF0sZj1lJiZlLm93bmVyRG9jdW1lbnQ7aWYoZilyZXR1cm4gYj1mLmRvY3VtZW50RWxlbWVudCxtLmNvbnRhaW5zKGIsZSk/KHR5cGVvZiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCE9PUsmJihkPWUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLGM9ZGMoZikse3RvcDpkLnRvcCsoYy5wYWdlWU9mZnNldHx8Yi5zY3JvbGxUb3ApLShiLmNsaWVudFRvcHx8MCksbGVmdDpkLmxlZnQrKGMucGFnZVhPZmZzZXR8fGIuc2Nyb2xsTGVmdCktKGIuY2xpZW50TGVmdHx8MCl9KTpkfSxwb3NpdGlvbjpmdW5jdGlvbigpe2lmKHRoaXNbMF0pe3ZhciBhLGIsYz17dG9wOjAsbGVmdDowfSxkPXRoaXNbMF07cmV0dXJuXCJmaXhlZFwiPT09bS5jc3MoZCxcInBvc2l0aW9uXCIpP2I9ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTooYT10aGlzLm9mZnNldFBhcmVudCgpLGI9dGhpcy5vZmZzZXQoKSxtLm5vZGVOYW1lKGFbMF0sXCJodG1sXCIpfHwoYz1hLm9mZnNldCgpKSxjLnRvcCs9bS5jc3MoYVswXSxcImJvcmRlclRvcFdpZHRoXCIsITApLGMubGVmdCs9bS5jc3MoYVswXSxcImJvcmRlckxlZnRXaWR0aFwiLCEwKSkse3RvcDpiLnRvcC1jLnRvcC1tLmNzcyhkLFwibWFyZ2luVG9wXCIsITApLGxlZnQ6Yi5sZWZ0LWMubGVmdC1tLmNzcyhkLFwibWFyZ2luTGVmdFwiLCEwKX19fSxvZmZzZXRQYXJlbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9mZnNldFBhcmVudHx8Y2M7d2hpbGUoYSYmIW0ubm9kZU5hbWUoYSxcImh0bWxcIikmJlwic3RhdGljXCI9PT1tLmNzcyhhLFwicG9zaXRpb25cIikpYT1hLm9mZnNldFBhcmVudDtyZXR1cm4gYXx8Y2N9KX19KSxtLmVhY2goe3Njcm9sbExlZnQ6XCJwYWdlWE9mZnNldFwiLHNjcm9sbFRvcDpcInBhZ2VZT2Zmc2V0XCJ9LGZ1bmN0aW9uKGEsYil7dmFyIGM9L1kvLnRlc3QoYik7bS5mblthXT1mdW5jdGlvbihkKXtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGEsZCxlKXt2YXIgZj1kYyhhKTtyZXR1cm4gdm9pZCAwPT09ZT9mP2IgaW4gZj9mW2JdOmYuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50W2RdOmFbZF06dm9pZChmP2Yuc2Nyb2xsVG8oYz9tKGYpLnNjcm9sbExlZnQoKTplLGM/ZTptKGYpLnNjcm9sbFRvcCgpKTphW2RdPWUpfSxhLGQsYXJndW1lbnRzLmxlbmd0aCxudWxsKX19KSxtLmVhY2goW1widG9wXCIsXCJsZWZ0XCJdLGZ1bmN0aW9uKGEsYil7bS5jc3NIb29rc1tiXT1MYShrLnBpeGVsUG9zaXRpb24sZnVuY3Rpb24oYSxjKXtyZXR1cm4gYz8oYz1KYShhLGIpLEhhLnRlc3QoYyk/bShhKS5wb3NpdGlvbigpW2JdK1wicHhcIjpjKTp2b2lkIDB9KX0pLG0uZWFjaCh7SGVpZ2h0OlwiaGVpZ2h0XCIsV2lkdGg6XCJ3aWR0aFwifSxmdW5jdGlvbihhLGIpe20uZWFjaCh7cGFkZGluZzpcImlubmVyXCIrYSxjb250ZW50OmIsXCJcIjpcIm91dGVyXCIrYX0sZnVuY3Rpb24oYyxkKXttLmZuW2RdPWZ1bmN0aW9uKGQsZSl7dmFyIGY9YXJndW1lbnRzLmxlbmd0aCYmKGN8fFwiYm9vbGVhblwiIT10eXBlb2YgZCksZz1jfHwoZD09PSEwfHxlPT09ITA/XCJtYXJnaW5cIjpcImJvcmRlclwiKTtyZXR1cm4gVih0aGlzLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZTtyZXR1cm4gbS5pc1dpbmRvdyhiKT9iLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFtcImNsaWVudFwiK2FdOjk9PT1iLm5vZGVUeXBlPyhlPWIuZG9jdW1lbnRFbGVtZW50LE1hdGgubWF4KGIuYm9keVtcInNjcm9sbFwiK2FdLGVbXCJzY3JvbGxcIithXSxiLmJvZHlbXCJvZmZzZXRcIithXSxlW1wib2Zmc2V0XCIrYV0sZVtcImNsaWVudFwiK2FdKSk6dm9pZCAwPT09ZD9tLmNzcyhiLGMsZyk6bS5zdHlsZShiLGMsZCxnKX0sYixmP2Q6dm9pZCAwLGYsbnVsbCl9fSl9KSxtLmZuLnNpemU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sZW5ndGh9LG0uZm4uYW5kU2VsZj1tLmZuLmFkZEJhY2ssXCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUoXCJqcXVlcnlcIixbXSxmdW5jdGlvbigpe3JldHVybiBtfSk7dmFyIGVjPWEualF1ZXJ5LGZjPWEuJDtyZXR1cm4gbS5ub0NvbmZsaWN0PWZ1bmN0aW9uKGIpe3JldHVybiBhLiQ9PT1tJiYoYS4kPWZjKSxiJiZhLmpRdWVyeT09PW0mJihhLmpRdWVyeT1lYyksbX0sdHlwZW9mIGI9PT1LJiYoYS5qUXVlcnk9YS4kPW0pLG19KTtcbiIsIi8qIVxuICogQGF1dGhvciAgICBBbmdlbG8gRGluaVxuICogQHZlcnNpb24gICAxLjBcbiAqIEBjb3B5cmlnaHQgRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBMaWNlbnNlLlxuICovXG4oZnVuY3Rpb24oKXt2YXIgZD1cIjEuMFwiO3ZhciBjPXdpbmRvdy5DbGFzczt2YXIgYj13aW5kb3cuQ2xhc3M9ZnVuY3Rpb24obil7bj1ufHx7fTt2YXIgbT1mdW5jdGlvbigpe3JldHVybih0aGlzLmluaXRpYWxpemUpP3RoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6an07aWYobi5pbXBsZW1lbnQpe3ZhciBqPXdpbmRvdz09PXRoaXM/ZyhtLnByb3RvdHlwZSk6dGhpczt2YXIgbD1uLmltcGxlbWVudDthKG4sXCJpbXBsZW1lbnRcIik7bj1mKG4sZShsKSl9bS5wcm90b3R5cGU9ZyhuKTttLmNvbnN0cnVjdG9yPW07bS5fcGFyZW50PWcobik7Zm9yKHZhciBrPTAsaD1bXCJleHRlbmRcIixcImltcGxlbWVudFwiLFwiZ2V0T3B0aW9uc1wiLFwic2V0T3B0aW9uc1wiXTtrPGgubGVuZ3RoO2srKyl7bVtoW2tdXT1iW2hba11dfXJldHVybiBtfTtiLmV4dGVuZD1mdW5jdGlvbihqKXt2YXIgaD10aGlzO2lmKGouaW1wbGVtZW50KXt0aGlzLnByb3RvdHlwZT1mKHRoaXMucHJvdG90eXBlLGUoai5pbXBsZW1lbnQpKTthKGosXCJpbXBsZW1lbnRcIil9Zm9yKHZhciBpIGluIGope2pbaV09dHlwZW9mIGpbaV09PT1cImZ1bmN0aW9uXCImJi9wYXJlbnQvLnRlc3QoaltpXS50b1N0cmluZygpKT8oZnVuY3Rpb24obCxrKXtyZXR1cm4gZnVuY3Rpb24oKXt0aGlzLnBhcmVudD1oLl9wYXJlbnRba107cmV0dXJuIGwuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0pKGpbaV0saSk6altpXX10aGlzLl9wYXJlbnQ9Zih0aGlzLl9wYXJlbnQsaix0cnVlKTt0aGlzLnByb3RvdHlwZT1mKHRoaXMucHJvdG90eXBlLGopO3JldHVybiB0aGlzfTtiLmltcGxlbWVudD1mdW5jdGlvbihoKXtyZXR1cm4gdGhpcy5wcm90b3R5cGU9Zih0aGlzLnByb3RvdHlwZSxlKGgpKX07Yi5nZXRPcHRpb25zPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJvdG90eXBlLm9wdGlvbnN8fHt9fTtiLnNldE9wdGlvbnM9ZnVuY3Rpb24oaCl7cmV0dXJuIHRoaXMucHJvdG90eXBlLm9wdGlvbnM9Zih0aGlzLnByb3RvdHlwZS5vcHRpb25zLGgpfTtiLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXt3aW5kb3cuQ2xhc3M9YztyZXR1cm4gYn07Yi52ZXJzaW9uPWQ7ZnVuY3Rpb24gZyhpKXt2YXIgaD1mdW5jdGlvbigpe307aC5wcm90b3R5cGU9aS5wcm90b3R5cGV8fGk7cmV0dXJuIG5ldyBoKCl9ZnVuY3Rpb24gYShsLGksayl7aWYoayl7dmFyIGg9e307Zm9yKHZhciBqIGluIGwpe2lmKGohPT1pKXtoW2pdPWxbal19fX1lbHNle2RlbGV0ZSBsW2ldfXJldHVybiBofHxsfWZ1bmN0aW9uIGYoaCxpLGspe2lmKCFofHwhaSl7cmV0dXJuIGh8fGl8fHt9fWg9ZyhoKTtpPWcoaSk7Zm9yKHZhciBqIGluIGkpe2lmKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpW2pdKT09PVwiW29iamVjdCBPYmplY3RdXCIpe2YoaFtqXSxpW2pdKX1lbHNle2hbal09KGsmJmhbal0pP2hbal06aVtqXX19cmV0dXJuIGh9ZnVuY3Rpb24gZShsKXt2YXIgaz17fTtmb3IodmFyIGg9MDtoPGwubGVuZ3RoO2grKyl7aWYodHlwZW9mKGxbaF0pPT09XCJmdW5jdGlvblwiKXtsW2hdPWxbaF0ucHJvdG90eXBlfXZhciBqPWEobFtoXSxcImluaXRpYWxpemVcIix0cnVlKTtpZihqLmltcGxlbWVudCl7az1lKGouaW1wbGVtZW50KX1lbHNle2s9ZihrLGopfX1yZXR1cm4ga319KSgpOyIsIi8qIVxuICogUEVQIHYwLjMuMCB8IGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvUEVQXG4gKiBDb3B5cmlnaHQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyB8IGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2VcbiAqXG4gKiBUaGlzIGZpbGUgaXMgbW9kaWZpZWQgZm9yIENNUy4gQWxsIGB0b3VjaC1hY3Rpb25gIGF0dHJpYnV0ZXMgYXJlIG5vdyBgZGF0YS10b3VjaC1hY3Rpb25gXG4gKi9cbihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG4gIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcbiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDpcbiAgZ2xvYmFsLlBvaW50ZXJFdmVudHNQb2x5ZmlsbCA9IGZhY3RvcnkoKVxufSh0aGlzLCBmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JztcblxuICAvKipcbiAgICogVGhpcyBtb2R1bGUgaW1wbGVtZW50cyBhbiBtYXAgb2YgcG9pbnRlciBzdGF0ZXNcbiAgICovXG4gIHZhciBVU0VfTUFQID0gd2luZG93Lk1hcCAmJiB3aW5kb3cuTWFwLnByb3RvdHlwZS5mb3JFYWNoO1xuICB2YXIgUE9JTlRFUlNfRk4gPSBmdW5jdGlvbigpeyByZXR1cm4gdGhpcy5zaXplOyB9O1xuICBmdW5jdGlvbiBQb2ludGVyTWFwKCkge1xuICAgIGlmIChVU0VfTUFQKSB7XG4gICAgICB2YXIgbSA9IG5ldyBNYXAoKTtcbiAgICAgIG0ucG9pbnRlcnMgPSBQT0lOVEVSU19GTjtcbiAgICAgIHJldHVybiBtO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmtleXMgPSBbXTtcbiAgICAgIHRoaXMudmFsdWVzID0gW107XG4gICAgfVxuICB9XG5cbiAgUG9pbnRlck1hcC5wcm90b3R5cGUgPSB7XG4gICAgc2V0OiBmdW5jdGlvbihpbklkLCBpbkV2ZW50KSB7XG4gICAgICB2YXIgaSA9IHRoaXMua2V5cy5pbmRleE9mKGluSWQpO1xuICAgICAgaWYgKGkgPiAtMSkge1xuICAgICAgICB0aGlzLnZhbHVlc1tpXSA9IGluRXZlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmtleXMucHVzaChpbklkKTtcbiAgICAgICAgdGhpcy52YWx1ZXMucHVzaChpbkV2ZW50KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhhczogZnVuY3Rpb24oaW5JZCkge1xuICAgICAgcmV0dXJuIHRoaXMua2V5cy5pbmRleE9mKGluSWQpID4gLTE7XG4gICAgfSxcbiAgICAnZGVsZXRlJzogZnVuY3Rpb24oaW5JZCkge1xuICAgICAgdmFyIGkgPSB0aGlzLmtleXMuaW5kZXhPZihpbklkKTtcbiAgICAgIGlmIChpID4gLTEpIHtcbiAgICAgICAgdGhpcy5rZXlzLnNwbGljZShpLCAxKTtcbiAgICAgICAgdGhpcy52YWx1ZXMuc3BsaWNlKGksIDEpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbihpbklkKSB7XG4gICAgICB2YXIgaSA9IHRoaXMua2V5cy5pbmRleE9mKGluSWQpO1xuICAgICAgcmV0dXJuIHRoaXMudmFsdWVzW2ldO1xuICAgIH0sXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5rZXlzLmxlbmd0aCA9IDA7XG4gICAgICB0aGlzLnZhbHVlcy5sZW5ndGggPSAwO1xuICAgIH0sXG4gICAgLy8gcmV0dXJuIHZhbHVlLCBrZXksIG1hcFxuICAgIGZvckVhY2g6IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aGlzQXJnKSB7XG4gICAgICB0aGlzLnZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzQXJnLCB2LCB0aGlzLmtleXNbaV0sIHRoaXMpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgfSxcbiAgICBwb2ludGVyczogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5rZXlzLmxlbmd0aDtcbiAgICB9XG4gIH07XG5cbiAgdmFyIF9wb2ludGVybWFwID0gUG9pbnRlck1hcDtcblxuICB2YXIgQ0xPTkVfUFJPUFMgPSBbXG4gICAgLy8gTW91c2VFdmVudFxuICAgICdidWJibGVzJyxcbiAgICAnY2FuY2VsYWJsZScsXG4gICAgJ3ZpZXcnLFxuICAgICdkZXRhaWwnLFxuICAgICdzY3JlZW5YJyxcbiAgICAnc2NyZWVuWScsXG4gICAgJ2NsaWVudFgnLFxuICAgICdjbGllbnRZJyxcbiAgICAnY3RybEtleScsXG4gICAgJ2FsdEtleScsXG4gICAgJ3NoaWZ0S2V5JyxcbiAgICAnbWV0YUtleScsXG4gICAgJ2J1dHRvbicsXG4gICAgJ3JlbGF0ZWRUYXJnZXQnLFxuICAgIC8vIERPTSBMZXZlbCAzXG4gICAgJ2J1dHRvbnMnLFxuICAgIC8vIFBvaW50ZXJFdmVudFxuICAgICdwb2ludGVySWQnLFxuICAgICd3aWR0aCcsXG4gICAgJ2hlaWdodCcsXG4gICAgJ3ByZXNzdXJlJyxcbiAgICAndGlsdFgnLFxuICAgICd0aWx0WScsXG4gICAgJ3BvaW50ZXJUeXBlJyxcbiAgICAnaHdUaW1lc3RhbXAnLFxuICAgICdpc1ByaW1hcnknLFxuICAgIC8vIGV2ZW50IGluc3RhbmNlXG4gICAgJ3R5cGUnLFxuICAgICd0YXJnZXQnLFxuICAgICdjdXJyZW50VGFyZ2V0JyxcbiAgICAnd2hpY2gnLFxuICAgICdwYWdlWCcsXG4gICAgJ3BhZ2VZJyxcbiAgICAndGltZVN0YW1wJ1xuICBdO1xuXG4gIHZhciBDTE9ORV9ERUZBVUxUUyA9IFtcbiAgICAvLyBNb3VzZUV2ZW50XG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIDAsXG4gICAgMCxcbiAgICAwLFxuICAgIDAsXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgMCxcbiAgICBudWxsLFxuICAgIC8vIERPTSBMZXZlbCAzXG4gICAgMCxcbiAgICAvLyBQb2ludGVyRXZlbnRcbiAgICAwLFxuICAgIDAsXG4gICAgMCxcbiAgICAwLFxuICAgIDAsXG4gICAgMCxcbiAgICAnJyxcbiAgICAwLFxuICAgIGZhbHNlLFxuICAgIC8vIGV2ZW50IGluc3RhbmNlXG4gICAgJycsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIDAsXG4gICAgMCxcbiAgICAwLFxuICAgIDBcbiAgXTtcblxuICB2YXIgSEFTX1NWR19JTlNUQU5DRSA9ICh0eXBlb2YgU1ZHRWxlbWVudEluc3RhbmNlICE9PSAndW5kZWZpbmVkJyk7XG5cbiAgLyoqXG4gICAqIFRoaXMgbW9kdWxlIGlzIGZvciBub3JtYWxpemluZyBldmVudHMuIE1vdXNlIGFuZCBUb3VjaCBldmVudHMgd2lsbCBiZVxuICAgKiBjb2xsZWN0ZWQgaGVyZSwgYW5kIGZpcmUgUG9pbnRlckV2ZW50cyB0aGF0IGhhdmUgdGhlIHNhbWUgc2VtYW50aWNzLCBub1xuICAgKiBtYXR0ZXIgdGhlIHNvdXJjZS5cbiAgICogRXZlbnRzIGZpcmVkOlxuICAgKiAgIC0gcG9pbnRlcmRvd246IGEgcG9pbnRpbmcgaXMgYWRkZWRcbiAgICogICAtIHBvaW50ZXJ1cDogYSBwb2ludGVyIGlzIHJlbW92ZWRcbiAgICogICAtIHBvaW50ZXJtb3ZlOiBhIHBvaW50ZXIgaXMgbW92ZWRcbiAgICogICAtIHBvaW50ZXJvdmVyOiBhIHBvaW50ZXIgY3Jvc3NlcyBpbnRvIGFuIGVsZW1lbnRcbiAgICogICAtIHBvaW50ZXJvdXQ6IGEgcG9pbnRlciBsZWF2ZXMgYW4gZWxlbWVudFxuICAgKiAgIC0gcG9pbnRlcmNhbmNlbDogYSBwb2ludGVyIHdpbGwgbm8gbG9uZ2VyIGdlbmVyYXRlIGV2ZW50c1xuICAgKi9cbiAgdmFyIGRpc3BhdGNoZXIgPSB7XG4gICAgcG9pbnRlcm1hcDogbmV3IF9wb2ludGVybWFwKCksXG4gICAgZXZlbnRNYXA6IE9iamVjdC5jcmVhdGUobnVsbCksXG4gICAgY2FwdHVyZUluZm86IE9iamVjdC5jcmVhdGUobnVsbCksXG4gICAgLy8gU2NvcGUgb2JqZWN0cyBmb3IgbmF0aXZlIGV2ZW50cy5cbiAgICAvLyBUaGlzIGV4aXN0cyBmb3IgZWFzZSBvZiB0ZXN0aW5nLlxuICAgIGV2ZW50U291cmNlczogT2JqZWN0LmNyZWF0ZShudWxsKSxcbiAgICBldmVudFNvdXJjZUxpc3Q6IFtdLFxuICAgIC8qKlxuICAgICAqIEFkZCBhIG5ldyBldmVudCBzb3VyY2UgdGhhdCB3aWxsIGdlbmVyYXRlIHBvaW50ZXIgZXZlbnRzLlxuICAgICAqXG4gICAgICogYGluU291cmNlYCBtdXN0IGNvbnRhaW4gYW4gYXJyYXkgb2YgZXZlbnQgbmFtZXMgbmFtZWQgYGV2ZW50c2AsIGFuZFxuICAgICAqIGZ1bmN0aW9ucyB3aXRoIHRoZSBuYW1lcyBzcGVjaWZpZWQgaW4gdGhlIGBldmVudHNgIGFycmF5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIEEgbmFtZSBmb3IgdGhlIGV2ZW50IHNvdXJjZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgQSBuZXcgc291cmNlIG9mIHBsYXRmb3JtIGV2ZW50cy5cbiAgICAgKi9cbiAgICByZWdpc3RlclNvdXJjZTogZnVuY3Rpb24obmFtZSwgc291cmNlKSB7XG4gICAgICB2YXIgcyA9IHNvdXJjZTtcbiAgICAgIHZhciBuZXdFdmVudHMgPSBzLmV2ZW50cztcbiAgICAgIGlmIChuZXdFdmVudHMpIHtcbiAgICAgICAgbmV3RXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGlmIChzW2VdKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TWFwW2VdID0gc1tlXS5iaW5kKHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHRoaXMuZXZlbnRTb3VyY2VzW25hbWVdID0gcztcbiAgICAgICAgdGhpcy5ldmVudFNvdXJjZUxpc3QucHVzaChzKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlZ2lzdGVyOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICB2YXIgbCA9IHRoaXMuZXZlbnRTb3VyY2VMaXN0Lmxlbmd0aDtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBlczsgKGkgPCBsKSAmJiAoZXMgPSB0aGlzLmV2ZW50U291cmNlTGlzdFtpXSk7IGkrKykge1xuICAgICAgICAvLyBjYWxsIGV2ZW50c291cmNlIHJlZ2lzdGVyXG4gICAgICAgIGVzLnJlZ2lzdGVyLmNhbGwoZXMsIGVsZW1lbnQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdW5yZWdpc3RlcjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgdmFyIGwgPSB0aGlzLmV2ZW50U291cmNlTGlzdC5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMCwgZXM7IChpIDwgbCkgJiYgKGVzID0gdGhpcy5ldmVudFNvdXJjZUxpc3RbaV0pOyBpKyspIHtcbiAgICAgICAgLy8gY2FsbCBldmVudHNvdXJjZSByZWdpc3RlclxuICAgICAgICBlcy51bnJlZ2lzdGVyLmNhbGwoZXMsIGVsZW1lbnQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgY29udGFpbnM6IC8qc2NvcGUuZXh0ZXJuYWwuY29udGFpbnMgfHwgKi9mdW5jdGlvbihjb250YWluZXIsIGNvbnRhaW5lZCkge1xuICAgICAgcmV0dXJuIGNvbnRhaW5lci5jb250YWlucyhjb250YWluZWQpO1xuICAgIH0sXG4gICAgLy8gRVZFTlRTXG4gICAgZG93bjogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgaW5FdmVudC5idWJibGVzID0gdHJ1ZTtcbiAgICAgIHRoaXMuZmlyZUV2ZW50KCdwb2ludGVyZG93bicsIGluRXZlbnQpO1xuICAgIH0sXG4gICAgbW92ZTogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgaW5FdmVudC5idWJibGVzID0gdHJ1ZTtcbiAgICAgIHRoaXMuZmlyZUV2ZW50KCdwb2ludGVybW92ZScsIGluRXZlbnQpO1xuICAgIH0sXG4gICAgdXA6IGZ1bmN0aW9uKGluRXZlbnQpIHtcbiAgICAgIGluRXZlbnQuYnViYmxlcyA9IHRydWU7XG4gICAgICB0aGlzLmZpcmVFdmVudCgncG9pbnRlcnVwJywgaW5FdmVudCk7XG4gICAgfSxcbiAgICBlbnRlcjogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgaW5FdmVudC5idWJibGVzID0gZmFsc2U7XG4gICAgICB0aGlzLmZpcmVFdmVudCgncG9pbnRlcmVudGVyJywgaW5FdmVudCk7XG4gICAgfSxcbiAgICBsZWF2ZTogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgaW5FdmVudC5idWJibGVzID0gZmFsc2U7XG4gICAgICB0aGlzLmZpcmVFdmVudCgncG9pbnRlcmxlYXZlJywgaW5FdmVudCk7XG4gICAgfSxcbiAgICBvdmVyOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBpbkV2ZW50LmJ1YmJsZXMgPSB0cnVlO1xuICAgICAgdGhpcy5maXJlRXZlbnQoJ3BvaW50ZXJvdmVyJywgaW5FdmVudCk7XG4gICAgfSxcbiAgICBvdXQ6IGZ1bmN0aW9uKGluRXZlbnQpIHtcbiAgICAgIGluRXZlbnQuYnViYmxlcyA9IHRydWU7XG4gICAgICB0aGlzLmZpcmVFdmVudCgncG9pbnRlcm91dCcsIGluRXZlbnQpO1xuICAgIH0sXG4gICAgY2FuY2VsOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBpbkV2ZW50LmJ1YmJsZXMgPSB0cnVlO1xuICAgICAgdGhpcy5maXJlRXZlbnQoJ3BvaW50ZXJjYW5jZWwnLCBpbkV2ZW50KTtcbiAgICB9LFxuICAgIGxlYXZlT3V0OiBmdW5jdGlvbihldmVudCkge1xuICAgICAgdGhpcy5vdXQoZXZlbnQpO1xuICAgICAgaWYgKCF0aGlzLmNvbnRhaW5zKGV2ZW50LnRhcmdldCwgZXZlbnQucmVsYXRlZFRhcmdldCkpIHtcbiAgICAgICAgdGhpcy5sZWF2ZShldmVudCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBlbnRlck92ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB0aGlzLm92ZXIoZXZlbnQpO1xuICAgICAgaWYgKCF0aGlzLmNvbnRhaW5zKGV2ZW50LnRhcmdldCwgZXZlbnQucmVsYXRlZFRhcmdldCkpIHtcbiAgICAgICAgdGhpcy5lbnRlcihldmVudCk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvLyBMSVNURU5FUiBMT0dJQ1xuICAgIGV2ZW50SGFuZGxlcjogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgLy8gVGhpcyBpcyB1c2VkIHRvIHByZXZlbnQgbXVsdGlwbGUgZGlzcGF0Y2ggb2YgcG9pbnRlcmV2ZW50cyBmcm9tXG4gICAgICAvLyBwbGF0Zm9ybSBldmVudHMuIFRoaXMgY2FuIGhhcHBlbiB3aGVuIHR3byBlbGVtZW50cyBpbiBkaWZmZXJlbnQgc2NvcGVzXG4gICAgICAvLyBhcmUgc2V0IHVwIHRvIGNyZWF0ZSBwb2ludGVyIGV2ZW50cywgd2hpY2ggaXMgcmVsZXZhbnQgdG8gU2hhZG93IERPTS5cbiAgICAgIGlmIChpbkV2ZW50Ll9oYW5kbGVkQnlQRSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgdHlwZSA9IGluRXZlbnQudHlwZTtcbiAgICAgIHZhciBmbiA9IHRoaXMuZXZlbnRNYXAgJiYgdGhpcy5ldmVudE1hcFt0eXBlXTtcbiAgICAgIGlmIChmbikge1xuICAgICAgICBmbihpbkV2ZW50KTtcbiAgICAgIH1cbiAgICAgIGluRXZlbnQuX2hhbmRsZWRCeVBFID0gdHJ1ZTtcbiAgICB9LFxuICAgIC8vIHNldCB1cCBldmVudCBsaXN0ZW5lcnNcbiAgICBsaXN0ZW46IGZ1bmN0aW9uKHRhcmdldCwgZXZlbnRzKSB7XG4gICAgICBldmVudHMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgIHRoaXMuYWRkRXZlbnQodGFyZ2V0LCBlKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG4gICAgLy8gcmVtb3ZlIGV2ZW50IGxpc3RlbmVyc1xuICAgIHVubGlzdGVuOiBmdW5jdGlvbih0YXJnZXQsIGV2ZW50cykge1xuICAgICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICB0aGlzLnJlbW92ZUV2ZW50KHRhcmdldCwgZSk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9LFxuICAgIGFkZEV2ZW50OiAvKnNjb3BlLmV4dGVybmFsLmFkZEV2ZW50IHx8ICovZnVuY3Rpb24odGFyZ2V0LCBldmVudE5hbWUpIHtcbiAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdGhpcy5ib3VuZEhhbmRsZXIpO1xuICAgIH0sXG4gICAgcmVtb3ZlRXZlbnQ6IC8qc2NvcGUuZXh0ZXJuYWwucmVtb3ZlRXZlbnQgfHwgKi9mdW5jdGlvbih0YXJnZXQsIGV2ZW50TmFtZSkge1xuICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLmJvdW5kSGFuZGxlcik7XG4gICAgfSxcbiAgICAvLyBFVkVOVCBDUkVBVElPTiBBTkQgVFJBQ0tJTkdcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IEV2ZW50IG9mIHR5cGUgYGluVHlwZWAsIGJhc2VkIG9uIHRoZSBpbmZvcm1hdGlvbiBpblxuICAgICAqIGBpbkV2ZW50YC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpblR5cGUgQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSB0eXBlIG9mIGV2ZW50IHRvIGNyZWF0ZVxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGluRXZlbnQgQSBwbGF0Zm9ybSBldmVudCB3aXRoIGEgdGFyZ2V0XG4gICAgICogQHJldHVybiB7RXZlbnR9IEEgUG9pbnRlckV2ZW50IG9mIHR5cGUgYGluVHlwZWBcbiAgICAgKi9cbiAgICBtYWtlRXZlbnQ6IGZ1bmN0aW9uKGluVHlwZSwgaW5FdmVudCkge1xuICAgICAgLy8gcmVsYXRlZFRhcmdldCBtdXN0IGJlIG51bGwgaWYgcG9pbnRlciBpcyBjYXB0dXJlZFxuICAgICAgaWYgKHRoaXMuY2FwdHVyZUluZm9baW5FdmVudC5wb2ludGVySWRdKSB7XG4gICAgICAgIGluRXZlbnQucmVsYXRlZFRhcmdldCA9IG51bGw7XG4gICAgICB9XG4gICAgICB2YXIgZSA9IG5ldyBQb2ludGVyRXZlbnQoaW5UeXBlLCBpbkV2ZW50KTtcbiAgICAgIGlmIChpbkV2ZW50LnByZXZlbnREZWZhdWx0KSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQgPSBpbkV2ZW50LnByZXZlbnREZWZhdWx0O1xuICAgICAgfVxuICAgICAgZS5fdGFyZ2V0ID0gZS5fdGFyZ2V0IHx8IGluRXZlbnQudGFyZ2V0O1xuICAgICAgcmV0dXJuIGU7XG4gICAgfSxcbiAgICAvLyBtYWtlIGFuZCBkaXNwYXRjaCBhbiBldmVudCBpbiBvbmUgY2FsbFxuICAgIGZpcmVFdmVudDogZnVuY3Rpb24oaW5UeXBlLCBpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IHRoaXMubWFrZUV2ZW50KGluVHlwZSwgaW5FdmVudCk7XG4gICAgICByZXR1cm4gdGhpcy5kaXNwYXRjaEV2ZW50KGUpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHNuYXBzaG90IG9mIGluRXZlbnQsIHdpdGggd3JpdGFibGUgcHJvcGVydGllcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGluRXZlbnQgQW4gZXZlbnQgdGhhdCBjb250YWlucyBwcm9wZXJ0aWVzIHRvIGNvcHkuXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBBbiBvYmplY3QgY29udGFpbmluZyBzaGFsbG93IGNvcGllcyBvZiBgaW5FdmVudGAnc1xuICAgICAqICAgIHByb3BlcnRpZXMuXG4gICAgICovXG4gICAgY2xvbmVFdmVudDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgdmFyIGV2ZW50Q29weSA9IE9iamVjdC5jcmVhdGUobnVsbCksIHA7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IENMT05FX1BST1BTLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHAgPSBDTE9ORV9QUk9QU1tpXTtcbiAgICAgICAgZXZlbnRDb3B5W3BdID0gaW5FdmVudFtwXSB8fCBDTE9ORV9ERUZBVUxUU1tpXTtcbiAgICAgICAgLy8gV29yayBhcm91bmQgU1ZHSW5zdGFuY2VFbGVtZW50IHNoYWRvdyB0cmVlXG4gICAgICAgIC8vIFJldHVybiB0aGUgPHVzZT4gZWxlbWVudCB0aGF0IGlzIHJlcHJlc2VudGVkIGJ5IHRoZSBpbnN0YW5jZSBmb3IgU2FmYXJpLCBDaHJvbWUsIElFLlxuICAgICAgICAvLyBUaGlzIGlzIHRoZSBiZWhhdmlvciBpbXBsZW1lbnRlZCBieSBGaXJlZm94LlxuICAgICAgICBpZiAoSEFTX1NWR19JTlNUQU5DRSAmJiAocCA9PT0gJ3RhcmdldCcgfHwgcCA9PT0gJ3JlbGF0ZWRUYXJnZXQnKSkge1xuICAgICAgICAgIGlmIChldmVudENvcHlbcF0gaW5zdGFuY2VvZiBTVkdFbGVtZW50SW5zdGFuY2UpIHtcbiAgICAgICAgICAgIGV2ZW50Q29weVtwXSA9IGV2ZW50Q29weVtwXS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGtlZXAgdGhlIHNlbWFudGljcyBvZiBwcmV2ZW50RGVmYXVsdFxuICAgICAgaWYgKGluRXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgZXZlbnRDb3B5LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaW5FdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGV2ZW50Q29weTtcbiAgICB9LFxuICAgIGdldFRhcmdldDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgLy8gaWYgcG9pbnRlciBjYXB0dXJlIGlzIHNldCwgcm91dGUgYWxsIGV2ZW50cyBmb3IgdGhlIHNwZWNpZmllZCBwb2ludGVySWRcbiAgICAgIC8vIHRvIHRoZSBjYXB0dXJlIHRhcmdldFxuICAgICAgcmV0dXJuIHRoaXMuY2FwdHVyZUluZm9baW5FdmVudC5wb2ludGVySWRdIHx8IGluRXZlbnQuX3RhcmdldDtcbiAgICB9LFxuICAgIHNldENhcHR1cmU6IGZ1bmN0aW9uKGluUG9pbnRlcklkLCBpblRhcmdldCkge1xuICAgICAgaWYgKHRoaXMuY2FwdHVyZUluZm9baW5Qb2ludGVySWRdKSB7XG4gICAgICAgIHRoaXMucmVsZWFzZUNhcHR1cmUoaW5Qb2ludGVySWQpO1xuICAgICAgfVxuICAgICAgdGhpcy5jYXB0dXJlSW5mb1tpblBvaW50ZXJJZF0gPSBpblRhcmdldDtcbiAgICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XG4gICAgICBlLmluaXRFdmVudCgnZ290cG9pbnRlcmNhcHR1cmUnLCB0cnVlLCBmYWxzZSk7XG4gICAgICBlLnBvaW50ZXJJZCA9IGluUG9pbnRlcklkO1xuICAgICAgdGhpcy5pbXBsaWNpdFJlbGVhc2UgPSB0aGlzLnJlbGVhc2VDYXB0dXJlLmJpbmQodGhpcywgaW5Qb2ludGVySWQpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgdGhpcy5pbXBsaWNpdFJlbGVhc2UpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmNhbmNlbCcsIHRoaXMuaW1wbGljaXRSZWxlYXNlKTtcbiAgICAgIGUuX3RhcmdldCA9IGluVGFyZ2V0O1xuICAgICAgdGhpcy5hc3luY0Rpc3BhdGNoRXZlbnQoZSk7XG4gICAgfSxcbiAgICByZWxlYXNlQ2FwdHVyZTogZnVuY3Rpb24oaW5Qb2ludGVySWQpIHtcbiAgICAgIHZhciB0ID0gdGhpcy5jYXB0dXJlSW5mb1tpblBvaW50ZXJJZF07XG4gICAgICBpZiAodCkge1xuICAgICAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpO1xuICAgICAgICBlLmluaXRFdmVudCgnbG9zdHBvaW50ZXJjYXB0dXJlJywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICBlLnBvaW50ZXJJZCA9IGluUG9pbnRlcklkO1xuICAgICAgICB0aGlzLmNhcHR1cmVJbmZvW2luUG9pbnRlcklkXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgdGhpcy5pbXBsaWNpdFJlbGVhc2UpO1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb2ludGVyY2FuY2VsJywgdGhpcy5pbXBsaWNpdFJlbGVhc2UpO1xuICAgICAgICBlLl90YXJnZXQgPSB0O1xuICAgICAgICB0aGlzLmFzeW5jRGlzcGF0Y2hFdmVudChlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIERpc3BhdGNoZXMgdGhlIGV2ZW50IHRvIGl0cyB0YXJnZXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBpbkV2ZW50IFRoZSBldmVudCB0byBiZSBkaXNwYXRjaGVkLlxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUgaWYgYW4gZXZlbnQgaGFuZGxlciByZXR1cm5zIHRydWUsIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBkaXNwYXRjaEV2ZW50OiAvKnNjb3BlLmV4dGVybmFsLmRpc3BhdGNoRXZlbnQgfHwgKi9mdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgdCA9IHRoaXMuZ2V0VGFyZ2V0KGluRXZlbnQpO1xuICAgICAgaWYgKHQpIHtcbiAgICAgICAgcmV0dXJuIHQuZGlzcGF0Y2hFdmVudChpbkV2ZW50KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGFzeW5jRGlzcGF0Y2hFdmVudDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZGlzcGF0Y2hFdmVudC5iaW5kKHRoaXMsIGluRXZlbnQpKTtcbiAgICB9XG4gIH07XG4gIGRpc3BhdGNoZXIuYm91bmRIYW5kbGVyID0gZGlzcGF0Y2hlci5ldmVudEhhbmRsZXIuYmluZChkaXNwYXRjaGVyKTtcblxuICB2YXIgX2Rpc3BhdGNoZXIgPSBkaXNwYXRjaGVyO1xuXG4gIHZhciB0YXJnZXRpbmcgPSB7XG4gICAgc2hhZG93OiBmdW5jdGlvbihpbkVsKSB7XG4gICAgICBpZiAoaW5FbCkge1xuICAgICAgICByZXR1cm4gaW5FbC5zaGFkb3dSb290IHx8IGluRWwud2Via2l0U2hhZG93Um9vdDtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNhblRhcmdldDogZnVuY3Rpb24oc2hhZG93KSB7XG4gICAgICByZXR1cm4gc2hhZG93ICYmIEJvb2xlYW4oc2hhZG93LmVsZW1lbnRGcm9tUG9pbnQpO1xuICAgIH0sXG4gICAgdGFyZ2V0aW5nU2hhZG93OiBmdW5jdGlvbihpbkVsKSB7XG4gICAgICB2YXIgcyA9IHRoaXMuc2hhZG93KGluRWwpO1xuICAgICAgaWYgKHRoaXMuY2FuVGFyZ2V0KHMpKSB7XG4gICAgICAgIHJldHVybiBzO1xuICAgICAgfVxuICAgIH0sXG4gICAgb2xkZXJTaGFkb3c6IGZ1bmN0aW9uKHNoYWRvdykge1xuICAgICAgdmFyIG9zID0gc2hhZG93Lm9sZGVyU2hhZG93Um9vdDtcbiAgICAgIGlmICghb3MpIHtcbiAgICAgICAgdmFyIHNlID0gc2hhZG93LnF1ZXJ5U2VsZWN0b3IoJ3NoYWRvdycpO1xuICAgICAgICBpZiAoc2UpIHtcbiAgICAgICAgICBvcyA9IHNlLm9sZGVyU2hhZG93Um9vdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG9zO1xuICAgIH0sXG4gICAgYWxsU2hhZG93czogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgdmFyIHNoYWRvd3MgPSBbXSwgcyA9IHRoaXMuc2hhZG93KGVsZW1lbnQpO1xuICAgICAgd2hpbGUocykge1xuICAgICAgICBzaGFkb3dzLnB1c2gocyk7XG4gICAgICAgIHMgPSB0aGlzLm9sZGVyU2hhZG93KHMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNoYWRvd3M7XG4gICAgfSxcbiAgICBzZWFyY2hSb290OiBmdW5jdGlvbihpblJvb3QsIHgsIHkpIHtcbiAgICAgIGlmIChpblJvb3QpIHtcbiAgICAgICAgdmFyIHQgPSBpblJvb3QuZWxlbWVudEZyb21Qb2ludCh4LCB5KTtcbiAgICAgICAgdmFyIHN0LCBzciwgb3M7XG4gICAgICAgIC8vIGlzIGVsZW1lbnQgYSBzaGFkb3cgaG9zdD9cbiAgICAgICAgc3IgPSB0aGlzLnRhcmdldGluZ1NoYWRvdyh0KTtcbiAgICAgICAgd2hpbGUgKHNyKSB7XG4gICAgICAgICAgLy8gZmluZCB0aGUgdGhlIGVsZW1lbnQgaW5zaWRlIHRoZSBzaGFkb3cgcm9vdFxuICAgICAgICAgIHN0ID0gc3IuZWxlbWVudEZyb21Qb2ludCh4LCB5KTtcbiAgICAgICAgICBpZiAoIXN0KSB7XG4gICAgICAgICAgICAvLyBjaGVjayBmb3Igb2xkZXIgc2hhZG93c1xuICAgICAgICAgICAgc3IgPSB0aGlzLm9sZGVyU2hhZG93KHNyKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gc2hhZG93ZWQgZWxlbWVudCBtYXkgY29udGFpbiBhIHNoYWRvdyByb290XG4gICAgICAgICAgICB2YXIgc3NyID0gdGhpcy50YXJnZXRpbmdTaGFkb3coc3QpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VhcmNoUm9vdChzc3IsIHgsIHkpIHx8IHN0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBsaWdodCBkb20gZWxlbWVudCBpcyB0aGUgdGFyZ2V0XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfVxuICAgIH0sXG4gICAgb3duZXI6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIHZhciBzID0gZWxlbWVudDtcbiAgICAgIC8vIHdhbGsgdXAgdW50aWwgeW91IGhpdCB0aGUgc2hhZG93IHJvb3Qgb3IgZG9jdW1lbnRcbiAgICAgIHdoaWxlIChzLnBhcmVudE5vZGUpIHtcbiAgICAgICAgcyA9IHMucGFyZW50Tm9kZTtcbiAgICAgIH1cbiAgICAgIC8vIHRoZSBvd25lciBlbGVtZW50IGlzIGV4cGVjdGVkIHRvIGJlIGEgRG9jdW1lbnQgb3IgU2hhZG93Um9vdFxuICAgICAgaWYgKHMubm9kZVR5cGUgIT0gTm9kZS5ET0NVTUVOVF9OT0RFICYmIHMubm9kZVR5cGUgIT0gTm9kZS5ET0NVTUVOVF9GUkFHTUVOVF9OT0RFKSB7XG4gICAgICAgIHMgPSBkb2N1bWVudDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzO1xuICAgIH0sXG4gICAgZmluZFRhcmdldDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgdmFyIHggPSBpbkV2ZW50LmNsaWVudFgsIHkgPSBpbkV2ZW50LmNsaWVudFk7XG4gICAgICAvLyBpZiB0aGUgbGlzdGVuZXIgaXMgaW4gdGhlIHNoYWRvdyByb290LCBpdCBpcyBtdWNoIGZhc3RlciB0byBzdGFydCB0aGVyZVxuICAgICAgdmFyIHMgPSB0aGlzLm93bmVyKGluRXZlbnQudGFyZ2V0KTtcbiAgICAgIC8vIGlmIHgsIHkgaXMgbm90IGluIHRoaXMgcm9vdCwgZmFsbCBiYWNrIHRvIGRvY3VtZW50IHNlYXJjaFxuICAgICAgaWYgKCFzLmVsZW1lbnRGcm9tUG9pbnQoeCwgeSkpIHtcbiAgICAgICAgcyA9IGRvY3VtZW50O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuc2VhcmNoUm9vdChzLCB4LCB5KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoaXMgbW9kdWxlIHVzZXMgTXV0YXRpb24gT2JzZXJ2ZXJzIHRvIGR5bmFtaWNhbGx5IGFkanVzdCB3aGljaCBub2RlcyB3aWxsXG4gICAqIGdlbmVyYXRlIFBvaW50ZXIgRXZlbnRzLlxuICAgKlxuICAgKiBBbGwgbm9kZXMgdGhhdCB3aXNoIHRvIGdlbmVyYXRlIFBvaW50ZXIgRXZlbnRzIG11c3QgaGF2ZSB0aGUgYXR0cmlidXRlXG4gICAqIGBkYXRhLXRvdWNoLWFjdGlvbmAgc2V0IHRvIGBub25lYC5cbiAgICovXG4gIHZhciBmb3JFYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5mb3JFYWNoKTtcbiAgdmFyIG1hcCA9IEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5tYXApO1xuICB2YXIgdG9BcnJheSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLnNsaWNlKTtcbiAgdmFyIGZpbHRlciA9IEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5maWx0ZXIpO1xuICB2YXIgTU8gPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjtcbiAgdmFyIFNFTEVDVE9SID0gJ1tkYXRhLXRvdWNoLWFjdGlvbl0nO1xuICB2YXIgT0JTRVJWRVJfSU5JVCA9IHtcbiAgICBzdWJ0cmVlOiB0cnVlLFxuICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICBhdHRyaWJ1dGVzOiB0cnVlLFxuICAgIGF0dHJpYnV0ZU9sZFZhbHVlOiB0cnVlLFxuICAgIGF0dHJpYnV0ZUZpbHRlcjogWydkYXRhLXRvdWNoLWFjdGlvbiddXG4gIH07XG5cbiAgZnVuY3Rpb24gSW5zdGFsbGVyKGFkZCwgcmVtb3ZlLCBjaGFuZ2VkLCBiaW5kZXIpIHtcbiAgICB0aGlzLmFkZENhbGxiYWNrID0gYWRkLmJpbmQoYmluZGVyKTtcbiAgICB0aGlzLnJlbW92ZUNhbGxiYWNrID0gcmVtb3ZlLmJpbmQoYmluZGVyKTtcbiAgICB0aGlzLmNoYW5nZWRDYWxsYmFjayA9IGNoYW5nZWQuYmluZChiaW5kZXIpO1xuICAgIGlmIChNTykge1xuICAgICAgdGhpcy5vYnNlcnZlciA9IG5ldyBNTyh0aGlzLm11dGF0aW9uV2F0Y2hlci5iaW5kKHRoaXMpKTtcbiAgICB9XG4gIH1cblxuICBJbnN0YWxsZXIucHJvdG90eXBlID0ge1xuICAgIHdhdGNoU3VidHJlZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAvLyBPbmx5IHdhdGNoIHNjb3BlcyB0aGF0IGNhbiB0YXJnZXQgZmluZCwgYXMgdGhlc2UgYXJlIHRvcC1sZXZlbC5cbiAgICAgIC8vIE90aGVyd2lzZSB3ZSBjYW4gc2VlIGR1cGxpY2F0ZSBhZGRpdGlvbnMgYW5kIHJlbW92YWxzIHRoYXQgYWRkIG5vaXNlLlxuICAgICAgLy9cbiAgICAgIC8vIFRPRE8oZGZyZWVkbWFuKTogRm9yIHNvbWUgaW5zdGFuY2VzIHdpdGggU2hhZG93RE9NUG9seWZpbGwsIHdlIGNhbiBzZWVcbiAgICAgIC8vIGEgcmVtb3ZhbCB3aXRob3V0IGFuIGluc2VydGlvbiB3aGVuIGEgbm9kZSBpcyByZWRpc3RyaWJ1dGVkIGFtb25nXG4gICAgICAvLyBzaGFkb3dzLiBTaW5jZSBpdCBhbGwgZW5kcyB1cCBjb3JyZWN0IGluIHRoZSBkb2N1bWVudCwgd2F0Y2hpbmcgb25seVxuICAgICAgLy8gdGhlIGRvY3VtZW50IHdpbGwgeWllbGQgdGhlIGNvcnJlY3QgbXV0YXRpb25zIHRvIHdhdGNoLlxuICAgICAgaWYgKHRhcmdldGluZy5jYW5UYXJnZXQodGFyZ2V0KSkge1xuICAgICAgICB0aGlzLm9ic2VydmVyLm9ic2VydmUodGFyZ2V0LCBPQlNFUlZFUl9JTklUKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGVuYWJsZU9uU3VidHJlZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB0aGlzLndhdGNoU3VidHJlZSh0YXJnZXQpO1xuICAgICAgaWYgKHRhcmdldCA9PT0gZG9jdW1lbnQgJiYgZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xuICAgICAgICB0aGlzLmluc3RhbGxPbkxvYWQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaW5zdGFsbE5ld1N1YnRyZWUodGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGluc3RhbGxOZXdTdWJ0cmVlOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgIGZvckVhY2godGhpcy5maW5kRWxlbWVudHModGFyZ2V0KSwgdGhpcy5hZGRFbGVtZW50LCB0aGlzKTtcbiAgICB9LFxuICAgIGZpbmRFbGVtZW50czogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICBpZiAodGFyZ2V0LnF1ZXJ5U2VsZWN0b3JBbGwpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldC5xdWVyeVNlbGVjdG9yQWxsKFNFTEVDVE9SKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBbXTtcbiAgICB9LFxuICAgIHJlbW92ZUVsZW1lbnQ6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICB0aGlzLnJlbW92ZUNhbGxiYWNrKGVsKTtcbiAgICB9LFxuICAgIGFkZEVsZW1lbnQ6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICB0aGlzLmFkZENhbGxiYWNrKGVsKTtcbiAgICB9LFxuICAgIGVsZW1lbnRDaGFuZ2VkOiBmdW5jdGlvbihlbCwgb2xkVmFsdWUpIHtcbiAgICAgIHRoaXMuY2hhbmdlZENhbGxiYWNrKGVsLCBvbGRWYWx1ZSk7XG4gICAgfSxcbiAgICBjb25jYXRMaXN0czogZnVuY3Rpb24oYWNjdW0sIGxpc3QpIHtcbiAgICAgIHJldHVybiBhY2N1bS5jb25jYXQodG9BcnJheShsaXN0KSk7XG4gICAgfSxcbiAgICAvLyByZWdpc3RlciBhbGwgZGF0YS10b3VjaC1hY3Rpb24gPSBub25lIG5vZGVzIG9uIGRvY3VtZW50IGxvYWRcbiAgICBpbnN0YWxsT25Mb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgICB0aGlzLmluc3RhbGxOZXdTdWJ0cmVlKGRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuICAgIGlzRWxlbWVudDogZnVuY3Rpb24obikge1xuICAgICAgcmV0dXJuIG4ubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFO1xuICAgIH0sXG4gICAgZmxhdHRlbk11dGF0aW9uVHJlZTogZnVuY3Rpb24oaW5Ob2Rlcykge1xuICAgICAgLy8gZmluZCBjaGlsZHJlbiB3aXRoIGRhdGEtdG91Y2gtYWN0aW9uXG4gICAgICB2YXIgdHJlZSA9IG1hcChpbk5vZGVzLCB0aGlzLmZpbmRFbGVtZW50cywgdGhpcyk7XG4gICAgICAvLyBtYWtlIHN1cmUgdGhlIGFkZGVkIG5vZGVzIGFyZSBhY2NvdW50ZWQgZm9yXG4gICAgICB0cmVlLnB1c2goZmlsdGVyKGluTm9kZXMsIHRoaXMuaXNFbGVtZW50KSk7XG4gICAgICAvLyBmbGF0dGVuIHRoZSBsaXN0XG4gICAgICByZXR1cm4gdHJlZS5yZWR1Y2UodGhpcy5jb25jYXRMaXN0cywgW10pO1xuICAgIH0sXG4gICAgbXV0YXRpb25XYXRjaGVyOiBmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgIG11dGF0aW9ucy5mb3JFYWNoKHRoaXMubXV0YXRpb25IYW5kbGVyLCB0aGlzKTtcbiAgICB9LFxuICAgIG11dGF0aW9uSGFuZGxlcjogZnVuY3Rpb24obSkge1xuICAgICAgaWYgKG0udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIHtcbiAgICAgICAgdmFyIGFkZGVkID0gdGhpcy5mbGF0dGVuTXV0YXRpb25UcmVlKG0uYWRkZWROb2Rlcyk7XG4gICAgICAgIGFkZGVkLmZvckVhY2godGhpcy5hZGRFbGVtZW50LCB0aGlzKTtcbiAgICAgICAgdmFyIHJlbW92ZWQgPSB0aGlzLmZsYXR0ZW5NdXRhdGlvblRyZWUobS5yZW1vdmVkTm9kZXMpO1xuICAgICAgICByZW1vdmVkLmZvckVhY2godGhpcy5yZW1vdmVFbGVtZW50LCB0aGlzKTtcbiAgICAgIH0gZWxzZSBpZiAobS50eXBlID09PSAnYXR0cmlidXRlcycpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Q2hhbmdlZChtLnRhcmdldCwgbS5vbGRWYWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGlmICghTU8pIHtcbiAgICBJbnN0YWxsZXIucHJvdG90eXBlLndhdGNoU3VidHJlZSA9IGZ1bmN0aW9uKCl7XG4gICAgICBjb25zb2xlLndhcm4oJ1BvaW50ZXJFdmVudHNQb2x5ZmlsbDogTXV0YXRpb25PYnNlcnZlcnMgbm90IGZvdW5kLCBkYXRhLXRvdWNoLWFjdGlvbiB3aWxsIG5vdCBiZSBkeW5hbWljYWxseSBkZXRlY3RlZCcpO1xuICAgIH07XG4gIH1cblxuICB2YXIgaW5zdGFsbGVyID0gSW5zdGFsbGVyO1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHRoZSBjb25zdHJ1Y3RvciBmb3IgbmV3IFBvaW50ZXJFdmVudHMuXG4gICAqXG4gICAqIE5ldyBQb2ludGVyIEV2ZW50cyBtdXN0IGJlIGdpdmVuIGEgdHlwZSwgYW5kIGFuIG9wdGlvbmFsIGRpY3Rpb25hcnkgb2ZcbiAgICogaW5pdGlhbGl6YXRpb24gcHJvcGVydGllcy5cbiAgICpcbiAgICogRHVlIHRvIGNlcnRhaW4gcGxhdGZvcm0gcmVxdWlyZW1lbnRzLCBldmVudHMgcmV0dXJuZWQgZnJvbSB0aGUgY29uc3RydWN0b3JcbiAgICogaWRlbnRpZnkgYXMgTW91c2VFdmVudHMuXG4gICAqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge1N0cmluZ30gaW5UeXBlIFRoZSB0eXBlIG9mIHRoZSBldmVudCB0byBjcmVhdGUuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbaW5EaWN0XSBBbiBvcHRpb25hbCBkaWN0aW9uYXJ5IG9mIGluaXRpYWwgZXZlbnQgcHJvcGVydGllcy5cbiAgICogQHJldHVybiB7RXZlbnR9IEEgbmV3IFBvaW50ZXJFdmVudCBvZiB0eXBlIGBpblR5cGVgIGFuZCBpbml0aWFsaXplZCB3aXRoIHByb3BlcnRpZXMgZnJvbSBgaW5EaWN0YC5cbiAgICovXG4gIHZhciBNT1VTRV9QUk9QUyA9IFtcbiAgICAnYnViYmxlcycsXG4gICAgJ2NhbmNlbGFibGUnLFxuICAgICd2aWV3JyxcbiAgICAnZGV0YWlsJyxcbiAgICAnc2NyZWVuWCcsXG4gICAgJ3NjcmVlblknLFxuICAgICdjbGllbnRYJyxcbiAgICAnY2xpZW50WScsXG4gICAgJ2N0cmxLZXknLFxuICAgICdhbHRLZXknLFxuICAgICdzaGlmdEtleScsXG4gICAgJ21ldGFLZXknLFxuICAgICdidXR0b24nLFxuICAgICdyZWxhdGVkVGFyZ2V0JyxcbiAgICAncGFnZVgnLFxuICAgICdwYWdlWSdcbiAgXTtcblxuICB2YXIgTU9VU0VfREVGQVVMVFMgPSBbXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIDAsXG4gICAgMCxcbiAgICAwLFxuICAgIDAsXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgZmFsc2UsXG4gICAgMCxcbiAgICBudWxsLFxuICAgIDAsXG4gICAgMFxuICBdO1xuXG4gIGZ1bmN0aW9uIF9Qb2ludGVyRXZlbnRfX1BvaW50ZXJFdmVudChpblR5cGUsIGluRGljdCkge1xuICAgIGluRGljdCA9IGluRGljdCB8fCBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTtcbiAgICBlLmluaXRFdmVudChpblR5cGUsIGluRGljdC5idWJibGVzIHx8IGZhbHNlLCBpbkRpY3QuY2FuY2VsYWJsZSB8fCBmYWxzZSk7XG5cbiAgICAvLyBkZWZpbmUgaW5oZXJpdGVkIE1vdXNlRXZlbnQgcHJvcGVydGllc1xuICAgIC8vIHNraXAgYnViYmxlcyBhbmQgY2FuY2VsYWJsZSBzaW5jZSB0aGV5J3JlIHNldCBhYm92ZSBpbiBpbml0RXZlbnQoKVxuICAgIGZvcih2YXIgaSA9IDIsIHA7IGkgPCBNT1VTRV9QUk9QUy5sZW5ndGg7IGkrKykge1xuICAgICAgcCA9IE1PVVNFX1BST1BTW2ldO1xuICAgICAgZVtwXSA9IGluRGljdFtwXSB8fCBNT1VTRV9ERUZBVUxUU1tpXTtcbiAgICB9XG4gICAgZS5idXR0b25zID0gaW5EaWN0LmJ1dHRvbnMgfHwgMDtcblxuICAgIC8vIFNwZWMgcmVxdWlyZXMgdGhhdCBwb2ludGVycyB3aXRob3V0IHByZXNzdXJlIHNwZWNpZmllZCB1c2UgMC41IGZvciBkb3duXG4gICAgLy8gc3RhdGUgYW5kIDAgZm9yIHVwIHN0YXRlLlxuICAgIHZhciBwcmVzc3VyZSA9IDA7XG4gICAgaWYgKGluRGljdC5wcmVzc3VyZSkge1xuICAgICAgcHJlc3N1cmUgPSBpbkRpY3QucHJlc3N1cmU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByZXNzdXJlID0gZS5idXR0b25zID8gMC41IDogMDtcbiAgICB9XG5cbiAgICAvLyBhZGQgeC95IHByb3BlcnRpZXMgYWxpYXNlZCB0byBjbGllbnRYL1lcbiAgICBlLnggPSBlLmNsaWVudFg7XG4gICAgZS55ID0gZS5jbGllbnRZO1xuXG4gICAgLy8gZGVmaW5lIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBQb2ludGVyRXZlbnQgaW50ZXJmYWNlXG4gICAgZS5wb2ludGVySWQgPSBpbkRpY3QucG9pbnRlcklkIHx8IDA7XG4gICAgZS53aWR0aCA9IGluRGljdC53aWR0aCB8fCAwO1xuICAgIGUuaGVpZ2h0ID0gaW5EaWN0LmhlaWdodCB8fCAwO1xuICAgIGUucHJlc3N1cmUgPSBwcmVzc3VyZTtcbiAgICBlLnRpbHRYID0gaW5EaWN0LnRpbHRYIHx8IDA7XG4gICAgZS50aWx0WSA9IGluRGljdC50aWx0WSB8fCAwO1xuICAgIGUucG9pbnRlclR5cGUgPSBpbkRpY3QucG9pbnRlclR5cGUgfHwgJyc7XG4gICAgZS5od1RpbWVzdGFtcCA9IGluRGljdC5od1RpbWVzdGFtcCB8fCAwO1xuICAgIGUuaXNQcmltYXJ5ID0gaW5EaWN0LmlzUHJpbWFyeSB8fCBmYWxzZTtcbiAgICByZXR1cm4gZTtcbiAgfVxuXG4gIHZhciBfUG9pbnRlckV2ZW50ID0gX1BvaW50ZXJFdmVudF9fUG9pbnRlckV2ZW50O1xuXG4gIGZ1bmN0aW9uIHNoYWRvd1NlbGVjdG9yKHYpIHtcbiAgICByZXR1cm4gJ2JvZHkgL3NoYWRvdy1kZWVwLyAnICsgc2VsZWN0b3Iodik7XG4gIH1cbiAgZnVuY3Rpb24gc2VsZWN0b3Iodikge1xuICAgIHJldHVybiAnW2RhdGEtdG91Y2gtYWN0aW9uPVwiJyArIHYgKyAnXCJdJztcbiAgfVxuICBmdW5jdGlvbiBydWxlKHYpIHtcbiAgICByZXR1cm4gJ3sgLW1zLXRvdWNoLWFjdGlvbjogJyArIHYgKyAnOyB0b3VjaC1hY3Rpb246ICcgKyB2ICsgJzsgdG91Y2gtYWN0aW9uLWRlbGF5OiBub25lOyB9JztcbiAgfVxuICB2YXIgYXR0cmliMmNzcyA9IFtcbiAgICAnbm9uZScsXG4gICAgJ2F1dG8nLFxuICAgICdwYW4teCcsXG4gICAgJ3Bhbi15JyxcbiAgICB7XG4gICAgICBydWxlOiAncGFuLXggcGFuLXknLFxuICAgICAgc2VsZWN0b3JzOiBbXG4gICAgICAgICdwYW4teCBwYW4teScsXG4gICAgICAgICdwYW4teSBwYW4teCdcbiAgICAgIF1cbiAgICB9XG4gIF07XG4gIHZhciBzdHlsZXMgPSAnJztcbiAgLy8gb25seSBpbnN0YWxsIHN0eWxlc2hlZXQgaWYgdGhlIGJyb3dzZXIgaGFzIHRvdWNoIGFjdGlvbiBzdXBwb3J0XG4gIHZhciBoZWFkID0gZG9jdW1lbnQuaGVhZDtcbiAgdmFyIGhhc05hdGl2ZVBFID0gd2luZG93LlBvaW50ZXJFdmVudCB8fCB3aW5kb3cuTVNQb2ludGVyRXZlbnQ7XG4gIC8vIG9ubHkgYWRkIHNoYWRvdyBzZWxlY3RvcnMgaWYgc2hhZG93ZG9tIGlzIHN1cHBvcnRlZFxuICB2YXIgaGFzU2hhZG93Um9vdCA9ICF3aW5kb3cuU2hhZG93RE9NUG9seWZpbGwgJiYgZG9jdW1lbnQuaGVhZC5jcmVhdGVTaGFkb3dSb290O1xuXG4gIGZ1bmN0aW9uIGFwcGx5QXR0cmlidXRlU3R5bGVzKCkge1xuICAgIGlmIChoYXNOYXRpdmVQRSkge1xuICAgICAgYXR0cmliMmNzcy5mb3JFYWNoKGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgaWYgKFN0cmluZyhyKSA9PT0gcikge1xuICAgICAgICAgIHN0eWxlcyArPSBzZWxlY3RvcihyKSArIHJ1bGUocikgKyAnXFxuJztcbiAgICAgICAgICBpZiAoaGFzU2hhZG93Um9vdCkge1xuICAgICAgICAgICAgc3R5bGVzICs9IHNoYWRvd1NlbGVjdG9yKHIpICsgcnVsZShyKSArICdcXG4nO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdHlsZXMgKz0gci5zZWxlY3RvcnMubWFwKHNlbGVjdG9yKSArIHJ1bGUoci5ydWxlKSArICdcXG4nO1xuICAgICAgICAgIGlmIChoYXNTaGFkb3dSb290KSB7XG4gICAgICAgICAgICBzdHlsZXMgKz0gci5zZWxlY3RvcnMubWFwKHNoYWRvd1NlbGVjdG9yKSArIHJ1bGUoci5ydWxlKSArICdcXG4nO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG4gICAgICBlbC50ZXh0Q29udGVudCA9IHN0eWxlcztcbiAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZWwpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBtb3VzZV9fcG9pbnRlcm1hcCA9IF9kaXNwYXRjaGVyLnBvaW50ZXJtYXA7XG4gIC8vIHJhZGl1cyBhcm91bmQgdG91Y2hlbmQgdGhhdCBzd2FsbG93cyBtb3VzZSBldmVudHNcbiAgdmFyIERFRFVQX0RJU1QgPSAyNTtcblxuICB2YXIgV0hJQ0hfVE9fQlVUVE9OUyA9IFswLCAxLCA0LCAyXTtcblxuICB2YXIgSEFTX0JVVFRPTlMgPSBmYWxzZTtcbiAgdHJ5IHtcbiAgICBIQVNfQlVUVE9OUyA9IG5ldyBNb3VzZUV2ZW50KCd0ZXN0Jywge2J1dHRvbnM6IDF9KS5idXR0b25zID09PSAxO1xuICB9IGNhdGNoIChlKSB7fVxuXG4gIC8vIGhhbmRsZXIgYmxvY2sgZm9yIG5hdGl2ZSBtb3VzZSBldmVudHNcbiAgdmFyIG1vdXNlRXZlbnRzID0ge1xuICAgIFBPSU5URVJfSUQ6IDEsXG4gICAgUE9JTlRFUl9UWVBFOiAnbW91c2UnLFxuICAgIGV2ZW50czogW1xuICAgICAgJ21vdXNlZG93bicsXG4gICAgICAnbW91c2Vtb3ZlJyxcbiAgICAgICdtb3VzZXVwJyxcbiAgICAgICdtb3VzZW92ZXInLFxuICAgICAgJ21vdXNlb3V0J1xuICAgIF0sXG4gICAgcmVnaXN0ZXI6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgX2Rpc3BhdGNoZXIubGlzdGVuKHRhcmdldCwgdGhpcy5ldmVudHMpO1xuICAgIH0sXG4gICAgdW5yZWdpc3RlcjogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICBfZGlzcGF0Y2hlci51bmxpc3Rlbih0YXJnZXQsIHRoaXMuZXZlbnRzKTtcbiAgICB9LFxuICAgIGxhc3RUb3VjaGVzOiBbXSxcbiAgICAvLyBjb2xsaWRlIHdpdGggdGhlIGdsb2JhbCBtb3VzZSBsaXN0ZW5lclxuICAgIGlzRXZlbnRTaW11bGF0ZWRGcm9tVG91Y2g6IGZ1bmN0aW9uKGluRXZlbnQpIHtcbiAgICAgIHZhciBsdHMgPSB0aGlzLmxhc3RUb3VjaGVzO1xuICAgICAgdmFyIHggPSBpbkV2ZW50LmNsaWVudFgsIHkgPSBpbkV2ZW50LmNsaWVudFk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGx0cy5sZW5ndGgsIHQ7IGkgPCBsICYmICh0ID0gbHRzW2ldKTsgaSsrKSB7XG4gICAgICAgIC8vIHNpbXVsYXRlZCBtb3VzZSBldmVudHMgd2lsbCBiZSBzd2FsbG93ZWQgbmVhciBhIHByaW1hcnkgdG91Y2hlbmRcbiAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnMoeCAtIHQueCksIGR5ID0gTWF0aC5hYnMoeSAtIHQueSk7XG4gICAgICAgIGlmIChkeCA8PSBERURVUF9ESVNUICYmIGR5IDw9IERFRFVQX0RJU1QpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgcHJlcGFyZUV2ZW50OiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IF9kaXNwYXRjaGVyLmNsb25lRXZlbnQoaW5FdmVudCk7XG4gICAgICAvLyBmb3J3YXJkIG1vdXNlIHByZXZlbnREZWZhdWx0XG4gICAgICB2YXIgcGQgPSBlLnByZXZlbnREZWZhdWx0O1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpbkV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHBkKCk7XG4gICAgICB9O1xuICAgICAgZS5wb2ludGVySWQgPSB0aGlzLlBPSU5URVJfSUQ7XG4gICAgICBlLmlzUHJpbWFyeSA9IHRydWU7XG4gICAgICBlLnBvaW50ZXJUeXBlID0gdGhpcy5QT0lOVEVSX1RZUEU7XG4gICAgICBpZiAoIUhBU19CVVRUT05TKSB7XG4gICAgICAgIGUuYnV0dG9ucyA9IFdISUNIX1RPX0JVVFRPTlNbZS53aGljaF0gfHwgMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlO1xuICAgIH0sXG4gICAgbW91c2Vkb3duOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBpZiAoIXRoaXMuaXNFdmVudFNpbXVsYXRlZEZyb21Ub3VjaChpbkV2ZW50KSkge1xuICAgICAgICB2YXIgcCA9IG1vdXNlX19wb2ludGVybWFwLmhhcyh0aGlzLlBPSU5URVJfSUQpO1xuICAgICAgICAvLyBUT0RPKGRmcmVlZG1hbikgd29ya2Fyb3VuZCBmb3Igc29tZSBlbGVtZW50cyBub3Qgc2VuZGluZyBtb3VzZXVwXG4gICAgICAgIC8vIGh0dHA6Ly9jcmJ1Zy8xNDkwOTFcbiAgICAgICAgaWYgKHApIHtcbiAgICAgICAgICB0aGlzLmNhbmNlbChpbkV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgICBtb3VzZV9fcG9pbnRlcm1hcC5zZXQodGhpcy5QT0lOVEVSX0lELCBpbkV2ZW50KTtcbiAgICAgICAgX2Rpc3BhdGNoZXIuZG93bihlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1vdXNlbW92ZTogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgaWYgKCF0aGlzLmlzRXZlbnRTaW11bGF0ZWRGcm9tVG91Y2goaW5FdmVudCkpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzLnByZXBhcmVFdmVudChpbkV2ZW50KTtcbiAgICAgICAgX2Rpc3BhdGNoZXIubW92ZShlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1vdXNldXA6IGZ1bmN0aW9uKGluRXZlbnQpIHtcbiAgICAgIGlmICghdGhpcy5pc0V2ZW50U2ltdWxhdGVkRnJvbVRvdWNoKGluRXZlbnQpKSB7XG4gICAgICAgIHZhciBwID0gbW91c2VfX3BvaW50ZXJtYXAuZ2V0KHRoaXMuUE9JTlRFUl9JRCk7XG4gICAgICAgIGlmIChwICYmIHAuYnV0dG9uID09PSBpbkV2ZW50LmJ1dHRvbikge1xuICAgICAgICAgIHZhciBlID0gdGhpcy5wcmVwYXJlRXZlbnQoaW5FdmVudCk7XG4gICAgICAgICAgX2Rpc3BhdGNoZXIudXAoZSk7XG4gICAgICAgICAgdGhpcy5jbGVhbnVwTW91c2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgbW91c2VvdmVyOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBpZiAoIXRoaXMuaXNFdmVudFNpbXVsYXRlZEZyb21Ub3VjaChpbkV2ZW50KSkge1xuICAgICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgICBfZGlzcGF0Y2hlci5lbnRlck92ZXIoZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3VzZW91dDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgaWYgKCF0aGlzLmlzRXZlbnRTaW11bGF0ZWRGcm9tVG91Y2goaW5FdmVudCkpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzLnByZXBhcmVFdmVudChpbkV2ZW50KTtcbiAgICAgICAgX2Rpc3BhdGNoZXIubGVhdmVPdXQoZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBjYW5jZWw6IGZ1bmN0aW9uKGluRXZlbnQpIHtcbiAgICAgIHZhciBlID0gdGhpcy5wcmVwYXJlRXZlbnQoaW5FdmVudCk7XG4gICAgICBfZGlzcGF0Y2hlci5jYW5jZWwoZSk7XG4gICAgICB0aGlzLmNsZWFudXBNb3VzZSgpO1xuICAgIH0sXG4gICAgY2xlYW51cE1vdXNlOiBmdW5jdGlvbigpIHtcbiAgICAgIG1vdXNlX19wb2ludGVybWFwWydkZWxldGUnXSh0aGlzLlBPSU5URVJfSUQpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgbW91c2UgPSBtb3VzZUV2ZW50cztcblxuICB2YXIgY2FwdHVyZUluZm8gPSBfZGlzcGF0Y2hlci5jYXB0dXJlSW5mbztcbiAgdmFyIGZpbmRUYXJnZXQgPSB0YXJnZXRpbmcuZmluZFRhcmdldC5iaW5kKHRhcmdldGluZyk7XG4gIHZhciBhbGxTaGFkb3dzID0gdGFyZ2V0aW5nLmFsbFNoYWRvd3MuYmluZCh0YXJnZXRpbmcpO1xuICB2YXIgdG91Y2hfX3BvaW50ZXJtYXAgPSBfZGlzcGF0Y2hlci5wb2ludGVybWFwO1xuICB2YXIgdG91Y2hNYXAgPSBBcnJheS5wcm90b3R5cGUubWFwLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUubWFwKTtcbiAgLy8gVGhpcyBzaG91bGQgYmUgbG9uZyBlbm91Z2ggdG8gaWdub3JlIGNvbXBhdCBtb3VzZSBldmVudHMgbWFkZSBieSB0b3VjaFxuICB2YXIgREVEVVBfVElNRU9VVCA9IDI1MDA7XG4gIHZhciBDTElDS19DT1VOVF9USU1FT1VUID0gMjAwO1xuICB2YXIgQVRUUklCID0gJ2RhdGEtdG91Y2gtYWN0aW9uJztcbiAgdmFyIElOU1RBTExFUjtcbiAgLy8gVGhlIHByZXNlbmNlIG9mIHRvdWNoIGV2ZW50IGhhbmRsZXJzIGJsb2NrcyBzY3JvbGxpbmcsIGFuZCBzbyB3ZSBtdXN0IGJlIGNhcmVmdWwgdG9cbiAgLy8gYXZvaWQgYWRkaW5nIGhhbmRsZXJzIHVubmVjZXNzYXJpbHkuICBDaHJvbWUgcGxhbnMgdG8gYWRkIGEgdG91Y2gtYWN0aW9uLWRlbGF5IHByb3BlcnR5XG4gIC8vIChjcmJ1Zy5jb20vMzI5NTU5KSB0byBhZGRyZXNzIHRoaXMsIGFuZCBvbmNlIHdlIGhhdmUgdGhhdCB3ZSBjYW4gb3B0LWluIHRvIGEgc2ltcGxlclxuICAvLyBoYW5kbGVyIHJlZ2lzdHJhdGlvbiBtZWNoYW5pc20uICBSYXRoZXIgdGhhbiB0cnkgdG8gcHJlZGljdCBob3cgZXhhY3RseSB0byBvcHQtaW4gdG9cbiAgLy8gdGhhdCB3ZSdsbCBqdXN0IGxlYXZlIHRoaXMgZGlzYWJsZWQgdW50aWwgdGhlcmUgaXMgYSBidWlsZCBvZiBDaHJvbWUgdG8gdGVzdC5cbiAgdmFyIEhBU19UT1VDSF9BQ1RJT05fREVMQVkgPSBmYWxzZTtcblxuICAvLyBoYW5kbGVyIGJsb2NrIGZvciBuYXRpdmUgdG91Y2ggZXZlbnRzXG4gIHZhciB0b3VjaEV2ZW50cyA9IHtcbiAgICBldmVudHM6IFtcbiAgICAgICd0b3VjaHN0YXJ0JyxcbiAgICAgICd0b3VjaG1vdmUnLFxuICAgICAgJ3RvdWNoZW5kJyxcbiAgICAgICd0b3VjaGNhbmNlbCdcbiAgICBdLFxuICAgIHJlZ2lzdGVyOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgIGlmIChIQVNfVE9VQ0hfQUNUSU9OX0RFTEFZKSB7XG4gICAgICAgIF9kaXNwYXRjaGVyLmxpc3Rlbih0YXJnZXQsIHRoaXMuZXZlbnRzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIElOU1RBTExFUi5lbmFibGVPblN1YnRyZWUodGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHVucmVnaXN0ZXI6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgaWYgKEhBU19UT1VDSF9BQ1RJT05fREVMQVkpIHtcbiAgICAgICAgX2Rpc3BhdGNoZXIudW5saXN0ZW4odGFyZ2V0LCB0aGlzLmV2ZW50cyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUT0RPKGRmcmVlZG1hbik6IGlzIGl0IHdvcnRoIGl0IHRvIGRpc2Nvbm5lY3QgdGhlIE1PP1xuICAgICAgfVxuICAgIH0sXG4gICAgZWxlbWVudEFkZGVkOiBmdW5jdGlvbihlbCkge1xuICAgICAgdmFyIGEgPSBlbC5nZXRBdHRyaWJ1dGUoQVRUUklCKTtcbiAgICAgIHZhciBzdCA9IHRoaXMudG91Y2hBY3Rpb25Ub1Njcm9sbFR5cGUoYSk7XG4gICAgICBpZiAoc3QpIHtcbiAgICAgICAgZWwuX3Njcm9sbFR5cGUgPSBzdDtcbiAgICAgICAgX2Rpc3BhdGNoZXIubGlzdGVuKGVsLCB0aGlzLmV2ZW50cyk7XG4gICAgICAgIC8vIHNldCBkYXRhLXRvdWNoLWFjdGlvbiBvbiBzaGFkb3dzIGFzIHdlbGxcbiAgICAgICAgYWxsU2hhZG93cyhlbCkuZm9yRWFjaChmdW5jdGlvbihzKSB7XG4gICAgICAgICAgcy5fc2Nyb2xsVHlwZSA9IHN0O1xuICAgICAgICAgIF9kaXNwYXRjaGVyLmxpc3RlbihzLCB0aGlzLmV2ZW50cyk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZWxlbWVudFJlbW92ZWQ6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICBlbC5fc2Nyb2xsVHlwZSA9IHVuZGVmaW5lZDtcbiAgICAgIF9kaXNwYXRjaGVyLnVubGlzdGVuKGVsLCB0aGlzLmV2ZW50cyk7XG4gICAgICAvLyByZW1vdmUgZGF0YS10b3VjaC1hY3Rpb24gZnJvbSBzaGFkb3dcbiAgICAgIGFsbFNoYWRvd3MoZWwpLmZvckVhY2goZnVuY3Rpb24ocykge1xuICAgICAgICBzLl9zY3JvbGxUeXBlID0gdW5kZWZpbmVkO1xuICAgICAgICBfZGlzcGF0Y2hlci51bmxpc3RlbihzLCB0aGlzLmV2ZW50cyk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9LFxuICAgIGVsZW1lbnRDaGFuZ2VkOiBmdW5jdGlvbihlbCwgb2xkVmFsdWUpIHtcbiAgICAgIHZhciBhID0gZWwuZ2V0QXR0cmlidXRlKEFUVFJJQik7XG4gICAgICB2YXIgc3QgPSB0aGlzLnRvdWNoQWN0aW9uVG9TY3JvbGxUeXBlKGEpO1xuICAgICAgdmFyIG9sZFN0ID0gdGhpcy50b3VjaEFjdGlvblRvU2Nyb2xsVHlwZShvbGRWYWx1ZSk7XG4gICAgICAvLyBzaW1wbHkgdXBkYXRlIHNjcm9sbFR5cGUgaWYgbGlzdGVuZXJzIGFyZSBhbHJlYWR5IGVzdGFibGlzaGVkXG4gICAgICBpZiAoc3QgJiYgb2xkU3QpIHtcbiAgICAgICAgZWwuX3Njcm9sbFR5cGUgPSBzdDtcbiAgICAgICAgYWxsU2hhZG93cyhlbCkuZm9yRWFjaChmdW5jdGlvbihzKSB7XG4gICAgICAgICAgcy5fc2Nyb2xsVHlwZSA9IHN0O1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgIH0gZWxzZSBpZiAob2xkU3QpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50UmVtb3ZlZChlbCk7XG4gICAgICB9IGVsc2UgaWYgKHN0KSB7XG4gICAgICAgIHRoaXMuZWxlbWVudEFkZGVkKGVsKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNjcm9sbFR5cGVzOiB7XG4gICAgICBFTUlUVEVSOiAnbm9uZScsXG4gICAgICBYU0NST0xMRVI6ICdwYW4teCcsXG4gICAgICBZU0NST0xMRVI6ICdwYW4teScsXG4gICAgICBTQ1JPTExFUjogL14oPzpwYW4teCBwYW4teSl8KD86cGFuLXkgcGFuLXgpfGF1dG8kL1xuICAgIH0sXG4gICAgdG91Y2hBY3Rpb25Ub1Njcm9sbFR5cGU6IGZ1bmN0aW9uKHRvdWNoQWN0aW9uKSB7XG4gICAgICB2YXIgdCA9IHRvdWNoQWN0aW9uO1xuICAgICAgdmFyIHN0ID0gdGhpcy5zY3JvbGxUeXBlcztcbiAgICAgIGlmICh0ID09PSAnbm9uZScpIHtcbiAgICAgICAgcmV0dXJuICdub25lJztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gc3QuWFNDUk9MTEVSKSB7XG4gICAgICAgIHJldHVybiAnWCc7XG4gICAgICB9IGVsc2UgaWYgKHQgPT09IHN0LllTQ1JPTExFUikge1xuICAgICAgICByZXR1cm4gJ1knO1xuICAgICAgfSBlbHNlIGlmIChzdC5TQ1JPTExFUi5leGVjKHQpKSB7XG4gICAgICAgIHJldHVybiAnWFknO1xuICAgICAgfVxuICAgIH0sXG4gICAgUE9JTlRFUl9UWVBFOiAndG91Y2gnLFxuICAgIGZpcnN0VG91Y2g6IG51bGwsXG4gICAgaXNQcmltYXJ5VG91Y2g6IGZ1bmN0aW9uKGluVG91Y2gpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpcnN0VG91Y2ggPT09IGluVG91Y2guaWRlbnRpZmllcjtcbiAgICB9LFxuICAgIHNldFByaW1hcnlUb3VjaDogZnVuY3Rpb24oaW5Ub3VjaCkge1xuICAgICAgLy8gc2V0IHByaW1hcnkgdG91Y2ggaWYgdGhlcmUgbm8gcG9pbnRlcnMsIG9yIHRoZSBvbmx5IHBvaW50ZXIgaXMgdGhlIG1vdXNlXG4gICAgICBpZiAodG91Y2hfX3BvaW50ZXJtYXAucG9pbnRlcnMoKSA9PT0gMCB8fCAodG91Y2hfX3BvaW50ZXJtYXAucG9pbnRlcnMoKSA9PT0gMSAmJiB0b3VjaF9fcG9pbnRlcm1hcC5oYXMoMSkpKSB7XG4gICAgICAgIHRoaXMuZmlyc3RUb3VjaCA9IGluVG91Y2guaWRlbnRpZmllcjtcbiAgICAgICAgdGhpcy5maXJzdFhZID0ge1g6IGluVG91Y2guY2xpZW50WCwgWTogaW5Ub3VjaC5jbGllbnRZfTtcbiAgICAgICAgdGhpcy5zY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW5jZWxSZXNldENsaWNrQ291bnQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZVByaW1hcnlQb2ludGVyOiBmdW5jdGlvbihpblBvaW50ZXIpIHtcbiAgICAgIGlmIChpblBvaW50ZXIuaXNQcmltYXJ5KSB7XG4gICAgICAgIHRoaXMuZmlyc3RUb3VjaCA9IG51bGw7XG4gICAgICAgIHRoaXMuZmlyc3RYWSA9IG51bGw7XG4gICAgICAgIHRoaXMucmVzZXRDbGlja0NvdW50KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBjbGlja0NvdW50OiAwLFxuICAgIHJlc2V0SWQ6IG51bGwsXG4gICAgcmVzZXRDbGlja0NvdW50OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNsaWNrQ291bnQgPSAwO1xuICAgICAgICB0aGlzLnJlc2V0SWQgPSBudWxsO1xuICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy5yZXNldElkID0gc2V0VGltZW91dChmbiwgQ0xJQ0tfQ09VTlRfVElNRU9VVCk7XG4gICAgfSxcbiAgICBjYW5jZWxSZXNldENsaWNrQ291bnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMucmVzZXRJZCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5yZXNldElkKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHR5cGVUb0J1dHRvbnM6IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgIHZhciByZXQgPSAwO1xuICAgICAgaWYgKHR5cGUgPT09ICd0b3VjaHN0YXJ0JyB8fCB0eXBlID09PSAndG91Y2htb3ZlJykge1xuICAgICAgICByZXQgPSAxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJldDtcbiAgICB9LFxuICAgIHRvdWNoVG9Qb2ludGVyOiBmdW5jdGlvbihpblRvdWNoKSB7XG4gICAgICB2YXIgY3RlID0gdGhpcy5jdXJyZW50VG91Y2hFdmVudDtcbiAgICAgIHZhciBlID0gX2Rpc3BhdGNoZXIuY2xvbmVFdmVudChpblRvdWNoKTtcbiAgICAgIC8vIFNwZWMgc3BlY2lmaWVzIHRoYXQgcG9pbnRlcklkIDEgaXMgcmVzZXJ2ZWQgZm9yIE1vdXNlLlxuICAgICAgLy8gVG91Y2ggaWRlbnRpZmllcnMgY2FuIHN0YXJ0IGF0IDAuXG4gICAgICAvLyBBZGQgMiB0byB0aGUgdG91Y2ggaWRlbnRpZmllciBmb3IgY29tcGF0aWJpbGl0eS5cbiAgICAgIHZhciBpZCA9IGUucG9pbnRlcklkID0gaW5Ub3VjaC5pZGVudGlmaWVyICsgMjtcbiAgICAgIGUudGFyZ2V0ID0gY2FwdHVyZUluZm9baWRdIHx8IGZpbmRUYXJnZXQoZSk7XG4gICAgICBlLmJ1YmJsZXMgPSB0cnVlO1xuICAgICAgZS5jYW5jZWxhYmxlID0gdHJ1ZTtcbiAgICAgIGUuZGV0YWlsID0gdGhpcy5jbGlja0NvdW50O1xuICAgICAgZS5idXR0b24gPSAwO1xuICAgICAgZS5idXR0b25zID0gdGhpcy50eXBlVG9CdXR0b25zKGN0ZS50eXBlKTtcbiAgICAgIGUud2lkdGggPSBpblRvdWNoLndlYmtpdFJhZGl1c1ggfHwgaW5Ub3VjaC5yYWRpdXNYIHx8IDA7XG4gICAgICBlLmhlaWdodCA9IGluVG91Y2gud2Via2l0UmFkaXVzWSB8fCBpblRvdWNoLnJhZGl1c1kgfHwgMDtcbiAgICAgIGUucHJlc3N1cmUgPSBpblRvdWNoLndlYmtpdEZvcmNlIHx8IGluVG91Y2guZm9yY2UgfHwgMC41O1xuICAgICAgZS5pc1ByaW1hcnkgPSB0aGlzLmlzUHJpbWFyeVRvdWNoKGluVG91Y2gpO1xuICAgICAgZS5wb2ludGVyVHlwZSA9IHRoaXMuUE9JTlRFUl9UWVBFO1xuICAgICAgLy8gZm9yd2FyZCB0b3VjaCBwcmV2ZW50RGVmYXVsdHNcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIGUucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5zY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgICAgc2VsZi5maXJzdFhZID0gbnVsbDtcbiAgICAgICAgY3RlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGU7XG4gICAgfSxcbiAgICBwcm9jZXNzVG91Y2hlczogZnVuY3Rpb24oaW5FdmVudCwgaW5GdW5jdGlvbikge1xuICAgICAgdmFyIHRsID0gaW5FdmVudC5jaGFuZ2VkVG91Y2hlcztcbiAgICAgIHRoaXMuY3VycmVudFRvdWNoRXZlbnQgPSBpbkV2ZW50O1xuICAgICAgZm9yICh2YXIgaSA9IDAsIHQ7IGkgPCB0bC5sZW5ndGg7IGkrKykge1xuICAgICAgICB0ID0gdGxbaV07XG4gICAgICAgIGluRnVuY3Rpb24uY2FsbCh0aGlzLCB0aGlzLnRvdWNoVG9Qb2ludGVyKHQpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIEZvciBzaW5nbGUgYXhpcyBzY3JvbGxlcnMsIGRldGVybWluZXMgd2hldGhlciB0aGUgZWxlbWVudCBzaG91bGQgZW1pdFxuICAgIC8vIHBvaW50ZXIgZXZlbnRzIG9yIGJlaGF2ZSBhcyBhIHNjcm9sbGVyXG4gICAgc2hvdWxkU2Nyb2xsOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBpZiAodGhpcy5maXJzdFhZKSB7XG4gICAgICAgIHZhciByZXQ7XG4gICAgICAgIHZhciBzY3JvbGxBeGlzID0gaW5FdmVudC5jdXJyZW50VGFyZ2V0Ll9zY3JvbGxUeXBlO1xuICAgICAgICBpZiAoc2Nyb2xsQXhpcyA9PT0gJ25vbmUnKSB7XG4gICAgICAgICAgLy8gdGhpcyBlbGVtZW50IGlzIGEgdG91Y2gtYWN0aW9uOiBub25lLCBzaG91bGQgbmV2ZXIgc2Nyb2xsXG4gICAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Nyb2xsQXhpcyA9PT0gJ1hZJykge1xuICAgICAgICAgIC8vIHRoaXMgZWxlbWVudCBzaG91bGQgYWx3YXlzIHNjcm9sbFxuICAgICAgICAgIHJldCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHQgPSBpbkV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgICAgIC8vIGNoZWNrIHRoZSBpbnRlbmRlZCBzY3JvbGwgYXhpcywgYW5kIG90aGVyIGF4aXNcbiAgICAgICAgICB2YXIgYSA9IHNjcm9sbEF4aXM7XG4gICAgICAgICAgdmFyIG9hID0gc2Nyb2xsQXhpcyA9PT0gJ1knID8gJ1gnIDogJ1knO1xuICAgICAgICAgIHZhciBkYSA9IE1hdGguYWJzKHRbJ2NsaWVudCcgKyBhXSAtIHRoaXMuZmlyc3RYWVthXSk7XG4gICAgICAgICAgdmFyIGRvYSA9IE1hdGguYWJzKHRbJ2NsaWVudCcgKyBvYV0gLSB0aGlzLmZpcnN0WFlbb2FdKTtcbiAgICAgICAgICAvLyBpZiBkZWx0YSBpbiB0aGUgc2Nyb2xsIGF4aXMgPiBkZWx0YSBvdGhlciBheGlzLCBzY3JvbGwgaW5zdGVhZCBvZlxuICAgICAgICAgIC8vIG1ha2luZyBldmVudHNcbiAgICAgICAgICByZXQgPSBkYSA+PSBkb2E7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maXJzdFhZID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZpbmRUb3VjaDogZnVuY3Rpb24oaW5UTCwgaW5JZCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBpblRMLmxlbmd0aCwgdDsgaSA8IGwgJiYgKHQgPSBpblRMW2ldKTsgaSsrKSB7XG4gICAgICAgIGlmICh0LmlkZW50aWZpZXIgPT09IGluSWQpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgLy8gSW4gc29tZSBpbnN0YW5jZXMsIGEgdG91Y2hzdGFydCBjYW4gaGFwcGVuIHdpdGhvdXQgYSB0b3VjaGVuZC4gVGhpc1xuICAgIC8vIGxlYXZlcyB0aGUgcG9pbnRlcm1hcCBpbiBhIGJyb2tlbiBzdGF0ZS5cbiAgICAvLyBUaGVyZWZvcmUsIG9uIGV2ZXJ5IHRvdWNoc3RhcnQsIHdlIHJlbW92ZSB0aGUgdG91Y2hlcyB0aGF0IGRpZCBub3QgZmlyZSBhXG4gICAgLy8gdG91Y2hlbmQgZXZlbnQuXG4gICAgLy8gVG8ga2VlcCBzdGF0ZSBnbG9iYWxseSBjb25zaXN0ZW50LCB3ZSBmaXJlIGFcbiAgICAvLyBwb2ludGVyY2FuY2VsIGZvciB0aGlzIFwiYWJhbmRvbmVkXCIgdG91Y2hcbiAgICB2YWN1dW1Ub3VjaGVzOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgdGwgPSBpbkV2ZW50LnRvdWNoZXM7XG4gICAgICAvLyBwb2ludGVybWFwLnBvaW50ZXJzKCkgc2hvdWxkIGJlIDwgdGwubGVuZ3RoIGhlcmUsIGFzIHRoZSB0b3VjaHN0YXJ0IGhhcyBub3RcbiAgICAgIC8vIGJlZW4gcHJvY2Vzc2VkIHlldC5cbiAgICAgIGlmICh0b3VjaF9fcG9pbnRlcm1hcC5wb2ludGVycygpID49IHRsLmxlbmd0aCkge1xuICAgICAgICB2YXIgZCA9IFtdO1xuICAgICAgICB0b3VjaF9fcG9pbnRlcm1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAvLyBOZXZlciByZW1vdmUgcG9pbnRlcklkID09IDEsIHdoaWNoIGlzIG1vdXNlLlxuICAgICAgICAgIC8vIFRvdWNoIGlkZW50aWZpZXJzIGFyZSAyIHNtYWxsZXIgdGhhbiB0aGVpciBwb2ludGVySWQsIHdoaWNoIGlzIHRoZVxuICAgICAgICAgIC8vIGluZGV4IGluIHBvaW50ZXJtYXAuXG4gICAgICAgICAgaWYgKGtleSAhPT0gMSAmJiAhdGhpcy5maW5kVG91Y2godGwsIGtleSAtIDIpKSB7XG4gICAgICAgICAgICB2YXIgcCA9IHZhbHVlLm91dDtcbiAgICAgICAgICAgIGQucHVzaChwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBkLmZvckVhY2godGhpcy5jYW5jZWxPdXQsIHRoaXMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdG91Y2hzdGFydDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgdGhpcy52YWN1dW1Ub3VjaGVzKGluRXZlbnQpO1xuICAgICAgdGhpcy5zZXRQcmltYXJ5VG91Y2goaW5FdmVudC5jaGFuZ2VkVG91Y2hlc1swXSk7XG4gICAgICB0aGlzLmRlZHVwU3ludGhNb3VzZShpbkV2ZW50KTtcbiAgICAgIGlmICghdGhpcy5zY3JvbGxpbmcpIHtcbiAgICAgICAgdGhpcy5jbGlja0NvdW50Kys7XG4gICAgICAgIHRoaXMucHJvY2Vzc1RvdWNoZXMoaW5FdmVudCwgdGhpcy5vdmVyRG93bik7XG4gICAgICB9XG4gICAgfSxcbiAgICBvdmVyRG93bjogZnVuY3Rpb24oaW5Qb2ludGVyKSB7XG4gICAgICB2YXIgcCA9IHRvdWNoX19wb2ludGVybWFwLnNldChpblBvaW50ZXIucG9pbnRlcklkLCB7XG4gICAgICAgIHRhcmdldDogaW5Qb2ludGVyLnRhcmdldCxcbiAgICAgICAgb3V0OiBpblBvaW50ZXIsXG4gICAgICAgIG91dFRhcmdldDogaW5Qb2ludGVyLnRhcmdldFxuICAgICAgfSk7XG4gICAgICBfZGlzcGF0Y2hlci5vdmVyKGluUG9pbnRlcik7XG4gICAgICBfZGlzcGF0Y2hlci5lbnRlcihpblBvaW50ZXIpO1xuICAgICAgX2Rpc3BhdGNoZXIuZG93bihpblBvaW50ZXIpO1xuICAgIH0sXG4gICAgdG91Y2htb3ZlOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBpZiAoIXRoaXMuc2Nyb2xsaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLnNob3VsZFNjcm9sbChpbkV2ZW50KSkge1xuICAgICAgICAgIHRoaXMuc2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnRvdWNoY2FuY2VsKGluRXZlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGluRXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0aGlzLnByb2Nlc3NUb3VjaGVzKGluRXZlbnQsIHRoaXMubW92ZU92ZXJPdXQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3ZlT3Zlck91dDogZnVuY3Rpb24oaW5Qb2ludGVyKSB7XG4gICAgICB2YXIgZXZlbnQgPSBpblBvaW50ZXI7XG4gICAgICB2YXIgcG9pbnRlciA9IHRvdWNoX19wb2ludGVybWFwLmdldChldmVudC5wb2ludGVySWQpO1xuICAgICAgLy8gYSBmaW5nZXIgZHJpZnRlZCBvZmYgdGhlIHNjcmVlbiwgaWdub3JlIGl0XG4gICAgICBpZiAoIXBvaW50ZXIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIG91dEV2ZW50ID0gcG9pbnRlci5vdXQ7XG4gICAgICB2YXIgb3V0VGFyZ2V0ID0gcG9pbnRlci5vdXRUYXJnZXQ7XG4gICAgICBfZGlzcGF0Y2hlci5tb3ZlKGV2ZW50KTtcbiAgICAgIGlmIChvdXRFdmVudCAmJiBvdXRUYXJnZXQgIT09IGV2ZW50LnRhcmdldCkge1xuICAgICAgICBvdXRFdmVudC5yZWxhdGVkVGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBldmVudC5yZWxhdGVkVGFyZ2V0ID0gb3V0VGFyZ2V0O1xuICAgICAgICAvLyByZWNvdmVyIGZyb20gcmV0YXJnZXRpbmcgYnkgc2hhZG93XG4gICAgICAgIG91dEV2ZW50LnRhcmdldCA9IG91dFRhcmdldDtcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldCkge1xuICAgICAgICAgIF9kaXNwYXRjaGVyLmxlYXZlT3V0KG91dEV2ZW50KTtcbiAgICAgICAgICBfZGlzcGF0Y2hlci5lbnRlck92ZXIoZXZlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGNsZWFuIHVwIGNhc2Ugd2hlbiBmaW5nZXIgbGVhdmVzIHRoZSBzY3JlZW5cbiAgICAgICAgICBldmVudC50YXJnZXQgPSBvdXRUYXJnZXQ7XG4gICAgICAgICAgZXZlbnQucmVsYXRlZFRhcmdldCA9IG51bGw7XG4gICAgICAgICAgdGhpcy5jYW5jZWxPdXQoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBwb2ludGVyLm91dCA9IGV2ZW50O1xuICAgICAgcG9pbnRlci5vdXRUYXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgfSxcbiAgICB0b3VjaGVuZDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgdGhpcy5kZWR1cFN5bnRoTW91c2UoaW5FdmVudCk7XG4gICAgICB0aGlzLnByb2Nlc3NUb3VjaGVzKGluRXZlbnQsIHRoaXMudXBPdXQpO1xuICAgIH0sXG4gICAgdXBPdXQ6IGZ1bmN0aW9uKGluUG9pbnRlcikge1xuICAgICAgaWYgKCF0aGlzLnNjcm9sbGluZykge1xuICAgICAgICBfZGlzcGF0Y2hlci51cChpblBvaW50ZXIpO1xuICAgICAgICBfZGlzcGF0Y2hlci5vdXQoaW5Qb2ludGVyKTtcbiAgICAgICAgX2Rpc3BhdGNoZXIubGVhdmUoaW5Qb2ludGVyKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2xlYW5VcFBvaW50ZXIoaW5Qb2ludGVyKTtcbiAgICB9LFxuICAgIHRvdWNoY2FuY2VsOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB0aGlzLnByb2Nlc3NUb3VjaGVzKGluRXZlbnQsIHRoaXMuY2FuY2VsT3V0KTtcbiAgICB9LFxuICAgIGNhbmNlbE91dDogZnVuY3Rpb24oaW5Qb2ludGVyKSB7XG4gICAgICBfZGlzcGF0Y2hlci5jYW5jZWwoaW5Qb2ludGVyKTtcbiAgICAgIF9kaXNwYXRjaGVyLm91dChpblBvaW50ZXIpO1xuICAgICAgX2Rpc3BhdGNoZXIubGVhdmUoaW5Qb2ludGVyKTtcbiAgICAgIHRoaXMuY2xlYW5VcFBvaW50ZXIoaW5Qb2ludGVyKTtcbiAgICB9LFxuICAgIGNsZWFuVXBQb2ludGVyOiBmdW5jdGlvbihpblBvaW50ZXIpIHtcbiAgICAgIHRvdWNoX19wb2ludGVybWFwWydkZWxldGUnXShpblBvaW50ZXIucG9pbnRlcklkKTtcbiAgICAgIHRoaXMucmVtb3ZlUHJpbWFyeVBvaW50ZXIoaW5Qb2ludGVyKTtcbiAgICB9LFxuICAgIC8vIHByZXZlbnQgc3ludGggbW91c2UgZXZlbnRzIGZyb20gY3JlYXRpbmcgcG9pbnRlciBldmVudHNcbiAgICBkZWR1cFN5bnRoTW91c2U6IGZ1bmN0aW9uKGluRXZlbnQpIHtcbiAgICAgIHZhciBsdHMgPSBtb3VzZS5sYXN0VG91Y2hlcztcbiAgICAgIHZhciB0ID0gaW5FdmVudC5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgIC8vIG9ubHkgdGhlIHByaW1hcnkgZmluZ2VyIHdpbGwgc3ludGggbW91c2UgZXZlbnRzXG4gICAgICBpZiAodGhpcy5pc1ByaW1hcnlUb3VjaCh0KSkge1xuICAgICAgICAvLyByZW1lbWJlciB4L3kgb2YgbGFzdCB0b3VjaFxuICAgICAgICB2YXIgbHQgPSB7eDogdC5jbGllbnRYLCB5OiB0LmNsaWVudFl9O1xuICAgICAgICBsdHMucHVzaChsdCk7XG4gICAgICAgIHZhciBmbiA9IChmdW5jdGlvbihsdHMsIGx0KXtcbiAgICAgICAgICB2YXIgaSA9IGx0cy5pbmRleE9mKGx0KTtcbiAgICAgICAgICBpZiAoaSA+IC0xKSB7XG4gICAgICAgICAgICBsdHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkuYmluZChudWxsLCBsdHMsIGx0KTtcbiAgICAgICAgc2V0VGltZW91dChmbiwgREVEVVBfVElNRU9VVCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGlmICghSEFTX1RPVUNIX0FDVElPTl9ERUxBWSkge1xuICAgIElOU1RBTExFUiA9IG5ldyBpbnN0YWxsZXIodG91Y2hFdmVudHMuZWxlbWVudEFkZGVkLCB0b3VjaEV2ZW50cy5lbGVtZW50UmVtb3ZlZCwgdG91Y2hFdmVudHMuZWxlbWVudENoYW5nZWQsIHRvdWNoRXZlbnRzKTtcbiAgfVxuXG4gIHZhciB0b3VjaCA9IHRvdWNoRXZlbnRzO1xuXG4gIHZhciBtc19fcG9pbnRlcm1hcCA9IF9kaXNwYXRjaGVyLnBvaW50ZXJtYXA7XG4gIHZhciBIQVNfQklUTUFQX1RZUEUgPSB3aW5kb3cuTVNQb2ludGVyRXZlbnQgJiYgdHlwZW9mIHdpbmRvdy5NU1BvaW50ZXJFdmVudC5NU1BPSU5URVJfVFlQRV9NT1VTRSA9PT0gJ251bWJlcic7XG4gIHZhciBtc0V2ZW50cyA9IHtcbiAgICBldmVudHM6IFtcbiAgICAgICdNU1BvaW50ZXJEb3duJyxcbiAgICAgICdNU1BvaW50ZXJNb3ZlJyxcbiAgICAgICdNU1BvaW50ZXJVcCcsXG4gICAgICAnTVNQb2ludGVyT3V0JyxcbiAgICAgICdNU1BvaW50ZXJPdmVyJyxcbiAgICAgICdNU1BvaW50ZXJDYW5jZWwnLFxuICAgICAgJ01TR290UG9pbnRlckNhcHR1cmUnLFxuICAgICAgJ01TTG9zdFBvaW50ZXJDYXB0dXJlJ1xuICAgIF0sXG4gICAgcmVnaXN0ZXI6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgX2Rpc3BhdGNoZXIubGlzdGVuKHRhcmdldCwgdGhpcy5ldmVudHMpO1xuICAgIH0sXG4gICAgdW5yZWdpc3RlcjogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICBfZGlzcGF0Y2hlci51bmxpc3Rlbih0YXJnZXQsIHRoaXMuZXZlbnRzKTtcbiAgICB9LFxuICAgIFBPSU5URVJfVFlQRVM6IFtcbiAgICAgICcnLFxuICAgICAgJ3VuYXZhaWxhYmxlJyxcbiAgICAgICd0b3VjaCcsXG4gICAgICAncGVuJyxcbiAgICAgICdtb3VzZSdcbiAgICBdLFxuICAgIHByZXBhcmVFdmVudDogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgdmFyIGUgPSBpbkV2ZW50O1xuICAgICAgaWYgKEhBU19CSVRNQVBfVFlQRSkge1xuICAgICAgICBlID0gX2Rpc3BhdGNoZXIuY2xvbmVFdmVudChpbkV2ZW50KTtcbiAgICAgICAgZS5wb2ludGVyVHlwZSA9IHRoaXMuUE9JTlRFUl9UWVBFU1tpbkV2ZW50LnBvaW50ZXJUeXBlXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlO1xuICAgIH0sXG4gICAgY2xlYW51cDogZnVuY3Rpb24oaWQpIHtcbiAgICAgIG1zX19wb2ludGVybWFwWydkZWxldGUnXShpZCk7XG4gICAgfSxcbiAgICBNU1BvaW50ZXJEb3duOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICBtc19fcG9pbnRlcm1hcC5zZXQoaW5FdmVudC5wb2ludGVySWQsIGluRXZlbnQpO1xuICAgICAgdmFyIGUgPSB0aGlzLnByZXBhcmVFdmVudChpbkV2ZW50KTtcbiAgICAgIF9kaXNwYXRjaGVyLmRvd24oZSk7XG4gICAgfSxcbiAgICBNU1BvaW50ZXJNb3ZlOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgX2Rpc3BhdGNoZXIubW92ZShlKTtcbiAgICB9LFxuICAgIE1TUG9pbnRlclVwOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgX2Rpc3BhdGNoZXIudXAoZSk7XG4gICAgICB0aGlzLmNsZWFudXAoaW5FdmVudC5wb2ludGVySWQpO1xuICAgIH0sXG4gICAgTVNQb2ludGVyT3V0OiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgX2Rpc3BhdGNoZXIubGVhdmVPdXQoZSk7XG4gICAgfSxcbiAgICBNU1BvaW50ZXJPdmVyOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgX2Rpc3BhdGNoZXIuZW50ZXJPdmVyKGUpO1xuICAgIH0sXG4gICAgTVNQb2ludGVyQ2FuY2VsOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IHRoaXMucHJlcGFyZUV2ZW50KGluRXZlbnQpO1xuICAgICAgX2Rpc3BhdGNoZXIuY2FuY2VsKGUpO1xuICAgICAgdGhpcy5jbGVhbnVwKGluRXZlbnQucG9pbnRlcklkKTtcbiAgICB9LFxuICAgIE1TTG9zdFBvaW50ZXJDYXB0dXJlOiBmdW5jdGlvbihpbkV2ZW50KSB7XG4gICAgICB2YXIgZSA9IF9kaXNwYXRjaGVyLm1ha2VFdmVudCgnbG9zdHBvaW50ZXJjYXB0dXJlJywgaW5FdmVudCk7XG4gICAgICBfZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGUpO1xuICAgIH0sXG4gICAgTVNHb3RQb2ludGVyQ2FwdHVyZTogZnVuY3Rpb24oaW5FdmVudCkge1xuICAgICAgdmFyIGUgPSBfZGlzcGF0Y2hlci5tYWtlRXZlbnQoJ2dvdHBvaW50ZXJjYXB0dXJlJywgaW5FdmVudCk7XG4gICAgICBfZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGUpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgbXMgPSBtc0V2ZW50cztcblxuICBmdW5jdGlvbiBwbGF0Zm9ybV9ldmVudHNfX2FwcGx5UG9seWZpbGwoKSB7XG4gICAgLy8gb25seSBhY3RpdmF0ZSBpZiB0aGlzIHBsYXRmb3JtIGRvZXMgbm90IGhhdmUgcG9pbnRlciBldmVudHNcbiAgICBpZiAoIXdpbmRvdy5Qb2ludGVyRXZlbnQpIHtcbiAgICAgIHdpbmRvdy5Qb2ludGVyRXZlbnQgPSBfUG9pbnRlckV2ZW50O1xuXG4gICAgICBpZiAod2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKSB7XG4gICAgICAgIHZhciB0cCA9IHdpbmRvdy5uYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cztcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5uYXZpZ2F0b3IsICdtYXhUb3VjaFBvaW50cycsIHtcbiAgICAgICAgICB2YWx1ZTogdHAsXG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgX2Rpc3BhdGNoZXIucmVnaXN0ZXJTb3VyY2UoJ21zJywgbXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2Rpc3BhdGNoZXIucmVnaXN0ZXJTb3VyY2UoJ21vdXNlJywgbW91c2UpO1xuICAgICAgICBpZiAod2luZG93Lm9udG91Y2hzdGFydCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgX2Rpc3BhdGNoZXIucmVnaXN0ZXJTb3VyY2UoJ3RvdWNoJywgdG91Y2gpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIF9kaXNwYXRjaGVyLnJlZ2lzdGVyKGRvY3VtZW50KTtcbiAgICB9XG4gIH1cblxuICB2YXIgbiA9IHdpbmRvdy5uYXZpZ2F0b3I7XG4gIHZhciBzLCByO1xuICBmdW5jdGlvbiBhc3NlcnREb3duKGlkKSB7XG4gICAgaWYgKCFfZGlzcGF0Y2hlci5wb2ludGVybWFwLmhhcyhpZCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZFBvaW50ZXJJZCcpO1xuICAgIH1cbiAgfVxuICBpZiAobi5tc1BvaW50ZXJFbmFibGVkKSB7XG4gICAgcyA9IGZ1bmN0aW9uKHBvaW50ZXJJZCkge1xuICAgICAgYXNzZXJ0RG93bihwb2ludGVySWQpO1xuICAgICAgdGhpcy5tc1NldFBvaW50ZXJDYXB0dXJlKHBvaW50ZXJJZCk7XG4gICAgfTtcbiAgICByID0gZnVuY3Rpb24ocG9pbnRlcklkKSB7XG4gICAgICBhc3NlcnREb3duKHBvaW50ZXJJZCk7XG4gICAgICB0aGlzLm1zUmVsZWFzZVBvaW50ZXJDYXB0dXJlKHBvaW50ZXJJZCk7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBzID0gZnVuY3Rpb24gc2V0UG9pbnRlckNhcHR1cmUocG9pbnRlcklkKSB7XG4gICAgICBhc3NlcnREb3duKHBvaW50ZXJJZCk7XG4gICAgICBfZGlzcGF0Y2hlci5zZXRDYXB0dXJlKHBvaW50ZXJJZCwgdGhpcyk7XG4gICAgfTtcbiAgICByID0gZnVuY3Rpb24gcmVsZWFzZVBvaW50ZXJDYXB0dXJlKHBvaW50ZXJJZCkge1xuICAgICAgYXNzZXJ0RG93bihwb2ludGVySWQpO1xuICAgICAgX2Rpc3BhdGNoZXIucmVsZWFzZUNhcHR1cmUocG9pbnRlcklkLCB0aGlzKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gY2FwdHVyZV9fYXBwbHlQb2x5ZmlsbCgpIHtcbiAgICBpZiAod2luZG93LkVsZW1lbnQgJiYgIUVsZW1lbnQucHJvdG90eXBlLnNldFBvaW50ZXJDYXB0dXJlKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhFbGVtZW50LnByb3RvdHlwZSwge1xuICAgICAgICAnc2V0UG9pbnRlckNhcHR1cmUnOiB7XG4gICAgICAgICAgdmFsdWU6IHNcbiAgICAgICAgfSxcbiAgICAgICAgJ3JlbGVhc2VQb2ludGVyQ2FwdHVyZSc6IHtcbiAgICAgICAgICB2YWx1ZTogclxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBhcHBseUF0dHJpYnV0ZVN0eWxlcygpO1xuICBwbGF0Zm9ybV9ldmVudHNfX2FwcGx5UG9seWZpbGwoKTtcbiAgY2FwdHVyZV9fYXBwbHlQb2x5ZmlsbCgpO1xuXG4gIHZhciBwb2ludGVyZXZlbnRzID0ge1xuICAgIGRpc3BhdGNoZXI6IF9kaXNwYXRjaGVyLFxuICAgIEluc3RhbGxlcjogaW5zdGFsbGVyLFxuICAgIFBvaW50ZXJFdmVudDogX1BvaW50ZXJFdmVudCxcbiAgICBQb2ludGVyTWFwOiBfcG9pbnRlcm1hcCxcbiAgICB0YXJnZXRGaW5kaW5nOiB0YXJnZXRpbmdcbiAgfTtcblxuICByZXR1cm4gcG9pbnRlcmV2ZW50cztcblxufSkpO1xuIiwiLyohIGpRdWVyeSBVSSAtIHYxLjExLjQgLSAyMDE1LTExLTEzXG4qIGh0dHA6Ly9qcXVlcnl1aS5jb21cbiogSW5jbHVkZXM6IGNvcmUuanMsIHdpZGdldC5qcywgbW91c2UuanMsIHNvcnRhYmxlLmpzLCBlZmZlY3QuanNcbiogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVCAqL1xuXG4oZnVuY3Rpb24oZSl7XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXCJqcXVlcnlcIl0sZSk6ZShqUXVlcnkpfSkoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCh0LHMpe3ZhciBuLGEsbyxyPXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm5cImFyZWFcIj09PXI/KG49dC5wYXJlbnROb2RlLGE9bi5uYW1lLHQuaHJlZiYmYSYmXCJtYXBcIj09PW4ubm9kZU5hbWUudG9Mb3dlckNhc2UoKT8obz1lKFwiaW1nW3VzZW1hcD0nI1wiK2ErXCInXVwiKVswXSwhIW8mJmkobykpOiExKTooL14oaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QpJC8udGVzdChyKT8hdC5kaXNhYmxlZDpcImFcIj09PXI/dC5ocmVmfHxzOnMpJiZpKHQpfWZ1bmN0aW9uIGkodCl7cmV0dXJuIGUuZXhwci5maWx0ZXJzLnZpc2libGUodCkmJiFlKHQpLnBhcmVudHMoKS5hZGRCYWNrKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuXCJoaWRkZW5cIj09PWUuY3NzKHRoaXMsXCJ2aXNpYmlsaXR5XCIpfSkubGVuZ3RofWUudWk9ZS51aXx8e30sZS5leHRlbmQoZS51aSx7dmVyc2lvbjpcIjEuMTEuNFwiLGtleUNvZGU6e0JBQ0tTUEFDRTo4LENPTU1BOjE4OCxERUxFVEU6NDYsRE9XTjo0MCxFTkQ6MzUsRU5URVI6MTMsRVNDQVBFOjI3LEhPTUU6MzYsTEVGVDozNyxQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFJJR0hUOjM5LFNQQUNFOjMyLFRBQjo5LFVQOjM4fX0pLGUuZm4uZXh0ZW5kKHtzY3JvbGxQYXJlbnQ6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5jc3MoXCJwb3NpdGlvblwiKSxzPVwiYWJzb2x1dGVcIj09PWksbj10Py8oYXV0b3xzY3JvbGx8aGlkZGVuKS86LyhhdXRvfHNjcm9sbCkvLGE9dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIHQ9ZSh0aGlzKTtyZXR1cm4gcyYmXCJzdGF0aWNcIj09PXQuY3NzKFwicG9zaXRpb25cIik/ITE6bi50ZXN0KHQuY3NzKFwib3ZlcmZsb3dcIikrdC5jc3MoXCJvdmVyZmxvdy15XCIpK3QuY3NzKFwib3ZlcmZsb3cteFwiKSl9KS5lcSgwKTtyZXR1cm5cImZpeGVkXCIhPT1pJiZhLmxlbmd0aD9hOmUodGhpc1swXS5vd25lckRvY3VtZW50fHxkb2N1bWVudCl9LHVuaXF1ZUlkOmZ1bmN0aW9uKCl7dmFyIGU9MDtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5pZHx8KHRoaXMuaWQ9XCJ1aS1pZC1cIisgKytlKX0pfX0oKSxyZW1vdmVVbmlxdWVJZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsvXnVpLWlkLVxcZCskLy50ZXN0KHRoaXMuaWQpJiZlKHRoaXMpLnJlbW92ZUF0dHIoXCJpZFwiKX0pfX0pLGUuZXh0ZW5kKGUuZXhwcltcIjpcIl0se2RhdGE6ZS5leHByLmNyZWF0ZVBzZXVkbz9lLmV4cHIuY3JlYXRlUHNldWRvKGZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4hIWUuZGF0YShpLHQpfX0pOmZ1bmN0aW9uKHQsaSxzKXtyZXR1cm4hIWUuZGF0YSh0LHNbM10pfSxmb2N1c2FibGU6ZnVuY3Rpb24oaSl7cmV0dXJuIHQoaSwhaXNOYU4oZS5hdHRyKGksXCJ0YWJpbmRleFwiKSkpfSx0YWJiYWJsZTpmdW5jdGlvbihpKXt2YXIgcz1lLmF0dHIoaSxcInRhYmluZGV4XCIpLG49aXNOYU4ocyk7cmV0dXJuKG58fHM+PTApJiZ0KGksIW4pfX0pLGUoXCI8YT5cIikub3V0ZXJXaWR0aCgxKS5qcXVlcnl8fGUuZWFjaChbXCJXaWR0aFwiLFwiSGVpZ2h0XCJdLGZ1bmN0aW9uKHQsaSl7ZnVuY3Rpb24gcyh0LGkscyxhKXtyZXR1cm4gZS5lYWNoKG4sZnVuY3Rpb24oKXtpLT1wYXJzZUZsb2F0KGUuY3NzKHQsXCJwYWRkaW5nXCIrdGhpcykpfHwwLHMmJihpLT1wYXJzZUZsb2F0KGUuY3NzKHQsXCJib3JkZXJcIit0aGlzK1wiV2lkdGhcIikpfHwwKSxhJiYoaS09cGFyc2VGbG9hdChlLmNzcyh0LFwibWFyZ2luXCIrdGhpcykpfHwwKX0pLGl9dmFyIG49XCJXaWR0aFwiPT09aT9bXCJMZWZ0XCIsXCJSaWdodFwiXTpbXCJUb3BcIixcIkJvdHRvbVwiXSxhPWkudG9Mb3dlckNhc2UoKSxvPXtpbm5lcldpZHRoOmUuZm4uaW5uZXJXaWR0aCxpbm5lckhlaWdodDplLmZuLmlubmVySGVpZ2h0LG91dGVyV2lkdGg6ZS5mbi5vdXRlcldpZHRoLG91dGVySGVpZ2h0OmUuZm4ub3V0ZXJIZWlnaHR9O2UuZm5bXCJpbm5lclwiK2ldPWZ1bmN0aW9uKHQpe3JldHVybiB2b2lkIDA9PT10P29bXCJpbm5lclwiK2ldLmNhbGwodGhpcyk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZSh0aGlzKS5jc3MoYSxzKHRoaXMsdCkrXCJweFwiKX0pfSxlLmZuW1wib3V0ZXJcIitpXT1mdW5jdGlvbih0LG4pe3JldHVyblwibnVtYmVyXCIhPXR5cGVvZiB0P29bXCJvdXRlclwiK2ldLmNhbGwodGhpcyx0KTp0aGlzLmVhY2goZnVuY3Rpb24oKXtlKHRoaXMpLmNzcyhhLHModGhpcyx0LCEwLG4pK1wicHhcIil9KX19KSxlLmZuLmFkZEJhY2t8fChlLmZuLmFkZEJhY2s9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuYWRkKG51bGw9PWU/dGhpcy5wcmV2T2JqZWN0OnRoaXMucHJldk9iamVjdC5maWx0ZXIoZSkpfSksZShcIjxhPlwiKS5kYXRhKFwiYS1iXCIsXCJhXCIpLnJlbW92ZURhdGEoXCJhLWJcIikuZGF0YShcImEtYlwiKSYmKGUuZm4ucmVtb3ZlRGF0YT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dC5jYWxsKHRoaXMsZS5jYW1lbENhc2UoaSkpOnQuY2FsbCh0aGlzKX19KGUuZm4ucmVtb3ZlRGF0YSkpLGUudWkuaWU9ISEvbXNpZSBbXFx3Ll0rLy5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSksZS5mbi5leHRlbmQoe2ZvY3VzOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihpLHMpe3JldHVyblwibnVtYmVyXCI9PXR5cGVvZiBpP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PXRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe2UodCkuZm9jdXMoKSxzJiZzLmNhbGwodCl9LGkpfSk6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fShlLmZuLmZvY3VzKSxkaXNhYmxlU2VsZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGU9XCJvbnNlbGVjdHN0YXJ0XCJpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpP1wic2VsZWN0c3RhcnRcIjpcIm1vdXNlZG93blwiO3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmJpbmQoZStcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIsZnVuY3Rpb24oZSl7ZS5wcmV2ZW50RGVmYXVsdCgpfSl9fSgpLGVuYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVuYmluZChcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIpfSx6SW5kZXg6ZnVuY3Rpb24odCl7aWYodm9pZCAwIT09dClyZXR1cm4gdGhpcy5jc3MoXCJ6SW5kZXhcIix0KTtpZih0aGlzLmxlbmd0aClmb3IodmFyIGkscyxuPWUodGhpc1swXSk7bi5sZW5ndGgmJm5bMF0hPT1kb2N1bWVudDspe2lmKGk9bi5jc3MoXCJwb3NpdGlvblwiKSwoXCJhYnNvbHV0ZVwiPT09aXx8XCJyZWxhdGl2ZVwiPT09aXx8XCJmaXhlZFwiPT09aSkmJihzPXBhcnNlSW50KG4uY3NzKFwiekluZGV4XCIpLDEwKSwhaXNOYU4ocykmJjAhPT1zKSlyZXR1cm4gcztuPW4ucGFyZW50KCl9cmV0dXJuIDB9fSksZS51aS5wbHVnaW49e2FkZDpmdW5jdGlvbih0LGkscyl7dmFyIG4sYT1lLnVpW3RdLnByb3RvdHlwZTtmb3IobiBpbiBzKWEucGx1Z2luc1tuXT1hLnBsdWdpbnNbbl18fFtdLGEucGx1Z2luc1tuXS5wdXNoKFtpLHNbbl1dKX0sY2FsbDpmdW5jdGlvbihlLHQsaSxzKXt2YXIgbixhPWUucGx1Z2luc1t0XTtpZihhJiYoc3x8ZS5lbGVtZW50WzBdLnBhcmVudE5vZGUmJjExIT09ZS5lbGVtZW50WzBdLnBhcmVudE5vZGUubm9kZVR5cGUpKWZvcihuPTA7YS5sZW5ndGg+bjtuKyspZS5vcHRpb25zW2Fbbl1bMF1dJiZhW25dWzFdLmFwcGx5KGUuZWxlbWVudCxpKX19O3ZhciBzPTAsbj1BcnJheS5wcm90b3R5cGUuc2xpY2U7ZS5jbGVhbkRhdGE9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkpe3ZhciBzLG4sYTtmb3IoYT0wO251bGwhPShuPWlbYV0pO2ErKyl0cnl7cz1lLl9kYXRhKG4sXCJldmVudHNcIikscyYmcy5yZW1vdmUmJmUobikudHJpZ2dlckhhbmRsZXIoXCJyZW1vdmVcIil9Y2F0Y2gobyl7fXQoaSl9fShlLmNsZWFuRGF0YSksZS53aWRnZXQ9ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGEsbyxyLGg9e30sbD10LnNwbGl0KFwiLlwiKVswXTtyZXR1cm4gdD10LnNwbGl0KFwiLlwiKVsxXSxuPWwrXCItXCIrdCxzfHwocz1pLGk9ZS5XaWRnZXQpLGUuZXhwcltcIjpcIl1bbi50b0xvd2VyQ2FzZSgpXT1mdW5jdGlvbih0KXtyZXR1cm4hIWUuZGF0YSh0LG4pfSxlW2xdPWVbbF18fHt9LGE9ZVtsXVt0XSxvPWVbbF1bdF09ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5fY3JlYXRlV2lkZ2V0Pyhhcmd1bWVudHMubGVuZ3RoJiZ0aGlzLl9jcmVhdGVXaWRnZXQoZSx0KSx2b2lkIDApOm5ldyBvKGUsdCl9LGUuZXh0ZW5kKG8sYSx7dmVyc2lvbjpzLnZlcnNpb24sX3Byb3RvOmUuZXh0ZW5kKHt9LHMpLF9jaGlsZENvbnN0cnVjdG9yczpbXX0pLHI9bmV3IGksci5vcHRpb25zPWUud2lkZ2V0LmV4dGVuZCh7fSxyLm9wdGlvbnMpLGUuZWFjaChzLGZ1bmN0aW9uKHQscyl7cmV0dXJuIGUuaXNGdW5jdGlvbihzKT8oaFt0XT1mdW5jdGlvbigpe3ZhciBlPWZ1bmN0aW9uKCl7cmV0dXJuIGkucHJvdG90eXBlW3RdLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sbj1mdW5jdGlvbihlKXtyZXR1cm4gaS5wcm90b3R5cGVbdF0uYXBwbHkodGhpcyxlKX07cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIHQsaT10aGlzLl9zdXBlcixhPXRoaXMuX3N1cGVyQXBwbHk7cmV0dXJuIHRoaXMuX3N1cGVyPWUsdGhpcy5fc3VwZXJBcHBseT1uLHQ9cy5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fc3VwZXI9aSx0aGlzLl9zdXBlckFwcGx5PWEsdH19KCksdm9pZCAwKTooaFt0XT1zLHZvaWQgMCl9KSxvLnByb3RvdHlwZT1lLndpZGdldC5leHRlbmQocix7d2lkZ2V0RXZlbnRQcmVmaXg6YT9yLndpZGdldEV2ZW50UHJlZml4fHx0OnR9LGgse2NvbnN0cnVjdG9yOm8sbmFtZXNwYWNlOmwsd2lkZ2V0TmFtZTp0LHdpZGdldEZ1bGxOYW1lOm59KSxhPyhlLmVhY2goYS5fY2hpbGRDb25zdHJ1Y3RvcnMsZnVuY3Rpb24odCxpKXt2YXIgcz1pLnByb3RvdHlwZTtlLndpZGdldChzLm5hbWVzcGFjZStcIi5cIitzLndpZGdldE5hbWUsbyxpLl9wcm90byl9KSxkZWxldGUgYS5fY2hpbGRDb25zdHJ1Y3RvcnMpOmkuX2NoaWxkQ29uc3RydWN0b3JzLnB1c2gobyksZS53aWRnZXQuYnJpZGdlKHQsbyksb30sZS53aWRnZXQuZXh0ZW5kPWZ1bmN0aW9uKHQpe2Zvcih2YXIgaSxzLGE9bi5jYWxsKGFyZ3VtZW50cywxKSxvPTAscj1hLmxlbmd0aDtyPm87bysrKWZvcihpIGluIGFbb10pcz1hW29dW2ldLGFbb10uaGFzT3duUHJvcGVydHkoaSkmJnZvaWQgMCE9PXMmJih0W2ldPWUuaXNQbGFpbk9iamVjdChzKT9lLmlzUGxhaW5PYmplY3QodFtpXSk/ZS53aWRnZXQuZXh0ZW5kKHt9LHRbaV0scyk6ZS53aWRnZXQuZXh0ZW5kKHt9LHMpOnMpO3JldHVybiB0fSxlLndpZGdldC5icmlkZ2U9ZnVuY3Rpb24odCxpKXt2YXIgcz1pLnByb3RvdHlwZS53aWRnZXRGdWxsTmFtZXx8dDtlLmZuW3RdPWZ1bmN0aW9uKGEpe3ZhciBvPVwic3RyaW5nXCI9PXR5cGVvZiBhLHI9bi5jYWxsKGFyZ3VtZW50cywxKSxoPXRoaXM7cmV0dXJuIG8/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGksbj1lLmRhdGEodGhpcyxzKTtyZXR1cm5cImluc3RhbmNlXCI9PT1hPyhoPW4sITEpOm4/ZS5pc0Z1bmN0aW9uKG5bYV0pJiZcIl9cIiE9PWEuY2hhckF0KDApPyhpPW5bYV0uYXBwbHkobixyKSxpIT09biYmdm9pZCAwIT09aT8oaD1pJiZpLmpxdWVyeT9oLnB1c2hTdGFjayhpLmdldCgpKTppLCExKTp2b2lkIDApOmUuZXJyb3IoXCJubyBzdWNoIG1ldGhvZCAnXCIrYStcIicgZm9yIFwiK3QrXCIgd2lkZ2V0IGluc3RhbmNlXCIpOmUuZXJyb3IoXCJjYW5ub3QgY2FsbCBtZXRob2RzIG9uIFwiK3QrXCIgcHJpb3IgdG8gaW5pdGlhbGl6YXRpb247IFwiK1wiYXR0ZW1wdGVkIHRvIGNhbGwgbWV0aG9kICdcIithK1wiJ1wiKX0pOihyLmxlbmd0aCYmKGE9ZS53aWRnZXQuZXh0ZW5kLmFwcGx5KG51bGwsW2FdLmNvbmNhdChyKSkpLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PWUuZGF0YSh0aGlzLHMpO3Q/KHQub3B0aW9uKGF8fHt9KSx0Ll9pbml0JiZ0Ll9pbml0KCkpOmUuZGF0YSh0aGlzLHMsbmV3IGkoYSx0aGlzKSl9KSksaH19LGUuV2lkZ2V0PWZ1bmN0aW9uKCl7fSxlLldpZGdldC5fY2hpbGRDb25zdHJ1Y3RvcnM9W10sZS5XaWRnZXQucHJvdG90eXBlPXt3aWRnZXROYW1lOlwid2lkZ2V0XCIsd2lkZ2V0RXZlbnRQcmVmaXg6XCJcIixkZWZhdWx0RWxlbWVudDpcIjxkaXY+XCIsb3B0aW9uczp7ZGlzYWJsZWQ6ITEsY3JlYXRlOm51bGx9LF9jcmVhdGVXaWRnZXQ6ZnVuY3Rpb24odCxpKXtpPWUoaXx8dGhpcy5kZWZhdWx0RWxlbWVudHx8dGhpcylbMF0sdGhpcy5lbGVtZW50PWUoaSksdGhpcy51dWlkPXMrKyx0aGlzLmV2ZW50TmFtZXNwYWNlPVwiLlwiK3RoaXMud2lkZ2V0TmFtZSt0aGlzLnV1aWQsdGhpcy5iaW5kaW5ncz1lKCksdGhpcy5ob3ZlcmFibGU9ZSgpLHRoaXMuZm9jdXNhYmxlPWUoKSxpIT09dGhpcyYmKGUuZGF0YShpLHRoaXMud2lkZ2V0RnVsbE5hbWUsdGhpcyksdGhpcy5fb24oITAsdGhpcy5lbGVtZW50LHtyZW1vdmU6ZnVuY3Rpb24oZSl7ZS50YXJnZXQ9PT1pJiZ0aGlzLmRlc3Ryb3koKX19KSx0aGlzLmRvY3VtZW50PWUoaS5zdHlsZT9pLm93bmVyRG9jdW1lbnQ6aS5kb2N1bWVudHx8aSksdGhpcy53aW5kb3c9ZSh0aGlzLmRvY3VtZW50WzBdLmRlZmF1bHRWaWV3fHx0aGlzLmRvY3VtZW50WzBdLnBhcmVudFdpbmRvdykpLHRoaXMub3B0aW9ucz1lLndpZGdldC5leHRlbmQoe30sdGhpcy5vcHRpb25zLHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSx0KSx0aGlzLl9jcmVhdGUoKSx0aGlzLl90cmlnZ2VyKFwiY3JlYXRlXCIsbnVsbCx0aGlzLl9nZXRDcmVhdGVFdmVudERhdGEoKSksdGhpcy5faW5pdCgpfSxfZ2V0Q3JlYXRlT3B0aW9uczplLm5vb3AsX2dldENyZWF0ZUV2ZW50RGF0YTplLm5vb3AsX2NyZWF0ZTplLm5vb3AsX2luaXQ6ZS5ub29wLGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLl9kZXN0cm95KCksdGhpcy5lbGVtZW50LnVuYmluZCh0aGlzLmV2ZW50TmFtZXNwYWNlKS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0RnVsbE5hbWUpLnJlbW92ZURhdGEoZS5jYW1lbENhc2UodGhpcy53aWRnZXRGdWxsTmFtZSkpLHRoaXMud2lkZ2V0KCkudW5iaW5kKHRoaXMuZXZlbnROYW1lc3BhY2UpLnJlbW92ZUF0dHIoXCJhcmlhLWRpc2FibGVkXCIpLnJlbW92ZUNsYXNzKHRoaXMud2lkZ2V0RnVsbE5hbWUrXCItZGlzYWJsZWQgXCIrXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKSx0aGlzLmJpbmRpbmdzLnVuYmluZCh0aGlzLmV2ZW50TmFtZXNwYWNlKSx0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLHRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9LF9kZXN0cm95OmUubm9vcCx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50fSxvcHRpb246ZnVuY3Rpb24odCxpKXt2YXIgcyxuLGEsbz10O2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKXJldHVybiBlLndpZGdldC5leHRlbmQoe30sdGhpcy5vcHRpb25zKTtpZihcInN0cmluZ1wiPT10eXBlb2YgdClpZihvPXt9LHM9dC5zcGxpdChcIi5cIiksdD1zLnNoaWZ0KCkscy5sZW5ndGgpe2ZvcihuPW9bdF09ZS53aWRnZXQuZXh0ZW5kKHt9LHRoaXMub3B0aW9uc1t0XSksYT0wO3MubGVuZ3RoLTE+YTthKyspbltzW2FdXT1uW3NbYV1dfHx7fSxuPW5bc1thXV07aWYodD1zLnBvcCgpLDE9PT1hcmd1bWVudHMubGVuZ3RoKXJldHVybiB2b2lkIDA9PT1uW3RdP251bGw6blt0XTtuW3RdPWl9ZWxzZXtpZigxPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4gdm9pZCAwPT09dGhpcy5vcHRpb25zW3RdP251bGw6dGhpcy5vcHRpb25zW3RdO29bdF09aX1yZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyhvKSx0aGlzfSxfc2V0T3B0aW9uczpmdW5jdGlvbihlKXt2YXIgdDtmb3IodCBpbiBlKXRoaXMuX3NldE9wdGlvbih0LGVbdF0pO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMub3B0aW9uc1tlXT10LFwiZGlzYWJsZWRcIj09PWUmJih0aGlzLndpZGdldCgpLnRvZ2dsZUNsYXNzKHRoaXMud2lkZ2V0RnVsbE5hbWUrXCItZGlzYWJsZWRcIiwhIXQpLHQmJih0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLHRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIikpKSx0aGlzfSxlbmFibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyh7ZGlzYWJsZWQ6ITF9KX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb25zKHtkaXNhYmxlZDohMH0pfSxfb246ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGE9dGhpcztcImJvb2xlYW5cIiE9dHlwZW9mIHQmJihzPWksaT10LHQ9ITEpLHM/KGk9bj1lKGkpLHRoaXMuYmluZGluZ3M9dGhpcy5iaW5kaW5ncy5hZGQoaSkpOihzPWksaT10aGlzLmVsZW1lbnQsbj10aGlzLndpZGdldCgpKSxlLmVhY2gocyxmdW5jdGlvbihzLG8pe2Z1bmN0aW9uIHIoKXtyZXR1cm4gdHx8YS5vcHRpb25zLmRpc2FibGVkIT09ITAmJiFlKHRoaXMpLmhhc0NsYXNzKFwidWktc3RhdGUtZGlzYWJsZWRcIik/KFwic3RyaW5nXCI9PXR5cGVvZiBvP2Fbb106bykuYXBwbHkoYSxhcmd1bWVudHMpOnZvaWQgMH1cInN0cmluZ1wiIT10eXBlb2YgbyYmKHIuZ3VpZD1vLmd1aWQ9by5ndWlkfHxyLmd1aWR8fGUuZ3VpZCsrKTt2YXIgaD1zLm1hdGNoKC9eKFtcXHc6LV0qKVxccyooLiopJC8pLGw9aFsxXSthLmV2ZW50TmFtZXNwYWNlLHU9aFsyXTt1P24uZGVsZWdhdGUodSxsLHIpOmkuYmluZChsLHIpfSl9LF9vZmY6ZnVuY3Rpb24odCxpKXtpPShpfHxcIlwiKS5zcGxpdChcIiBcIikuam9pbih0aGlzLmV2ZW50TmFtZXNwYWNlK1wiIFwiKSt0aGlzLmV2ZW50TmFtZXNwYWNlLHQudW5iaW5kKGkpLnVuZGVsZWdhdGUoaSksdGhpcy5iaW5kaW5ncz1lKHRoaXMuYmluZGluZ3Mubm90KHQpLmdldCgpKSx0aGlzLmZvY3VzYWJsZT1lKHRoaXMuZm9jdXNhYmxlLm5vdCh0KS5nZXQoKSksdGhpcy5ob3ZlcmFibGU9ZSh0aGlzLmhvdmVyYWJsZS5ub3QodCkuZ2V0KCkpfSxfZGVsYXk6ZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKCl7cmV0dXJuKFwic3RyaW5nXCI9PXR5cGVvZiBlP3NbZV06ZSkuYXBwbHkocyxhcmd1bWVudHMpfXZhciBzPXRoaXM7cmV0dXJuIHNldFRpbWVvdXQoaSx0fHwwKX0sX2hvdmVyYWJsZTpmdW5jdGlvbih0KXt0aGlzLmhvdmVyYWJsZT10aGlzLmhvdmVyYWJsZS5hZGQodCksdGhpcy5fb24odCx7bW91c2VlbnRlcjpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sbW91c2VsZWF2ZTpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX19KX0sX2ZvY3VzYWJsZTpmdW5jdGlvbih0KXt0aGlzLmZvY3VzYWJsZT10aGlzLmZvY3VzYWJsZS5hZGQodCksdGhpcy5fb24odCx7Zm9jdXNpbjpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0sZm9jdXNvdXQ6ZnVuY3Rpb24odCl7ZSh0LmN1cnJlbnRUYXJnZXQpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9fSl9LF90cmlnZ2VyOmZ1bmN0aW9uKHQsaSxzKXt2YXIgbixhLG89dGhpcy5vcHRpb25zW3RdO2lmKHM9c3x8e30saT1lLkV2ZW50KGkpLGkudHlwZT0odD09PXRoaXMud2lkZ2V0RXZlbnRQcmVmaXg/dDp0aGlzLndpZGdldEV2ZW50UHJlZml4K3QpLnRvTG93ZXJDYXNlKCksaS50YXJnZXQ9dGhpcy5lbGVtZW50WzBdLGE9aS5vcmlnaW5hbEV2ZW50KWZvcihuIGluIGEpbiBpbiBpfHwoaVtuXT1hW25dKTtyZXR1cm4gdGhpcy5lbGVtZW50LnRyaWdnZXIoaSxzKSwhKGUuaXNGdW5jdGlvbihvKSYmby5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2ldLmNvbmNhdChzKSk9PT0hMXx8aS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fSxlLmVhY2goe3Nob3c6XCJmYWRlSW5cIixoaWRlOlwiZmFkZU91dFwifSxmdW5jdGlvbih0LGkpe2UuV2lkZ2V0LnByb3RvdHlwZVtcIl9cIit0XT1mdW5jdGlvbihzLG4sYSl7XCJzdHJpbmdcIj09dHlwZW9mIG4mJihuPXtlZmZlY3Q6bn0pO3ZhciBvLHI9bj9uPT09ITB8fFwibnVtYmVyXCI9PXR5cGVvZiBuP2k6bi5lZmZlY3R8fGk6dDtuPW58fHt9LFwibnVtYmVyXCI9PXR5cGVvZiBuJiYobj17ZHVyYXRpb246bn0pLG89IWUuaXNFbXB0eU9iamVjdChuKSxuLmNvbXBsZXRlPWEsbi5kZWxheSYmcy5kZWxheShuLmRlbGF5KSxvJiZlLmVmZmVjdHMmJmUuZWZmZWN0cy5lZmZlY3Rbcl0/c1t0XShuKTpyIT09dCYmc1tyXT9zW3JdKG4uZHVyYXRpb24sbi5lYXNpbmcsYSk6cy5xdWV1ZShmdW5jdGlvbihpKXtlKHRoaXMpW3RdKCksYSYmYS5jYWxsKHNbMF0pLGkoKX0pfX0pLGUud2lkZ2V0O3ZhciBhPSExO2UoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24oKXthPSExfSksZS53aWRnZXQoXCJ1aS5tb3VzZVwiLHt2ZXJzaW9uOlwiMS4xMS40XCIsb3B0aW9uczp7Y2FuY2VsOlwiaW5wdXQsdGV4dGFyZWEsYnV0dG9uLHNlbGVjdCxvcHRpb25cIixkaXN0YW5jZToxLGRlbGF5OjB9LF9tb3VzZUluaXQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzO3RoaXMuZWxlbWVudC5iaW5kKFwibW91c2Vkb3duLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihlKXtyZXR1cm4gdC5fbW91c2VEb3duKGUpfSkuYmluZChcImNsaWNrLlwiK3RoaXMud2lkZ2V0TmFtZSxmdW5jdGlvbihpKXtyZXR1cm4hMD09PWUuZGF0YShpLnRhcmdldCx0LndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIik/KGUucmVtb3ZlRGF0YShpLnRhcmdldCx0LndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIiksaS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwhMSk6dm9pZCAwfSksdGhpcy5zdGFydGVkPSExfSxfbW91c2VEZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnVuYmluZChcIi5cIit0aGlzLndpZGdldE5hbWUpLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlJiZ0aGlzLmRvY3VtZW50LnVuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSl9LF9tb3VzZURvd246ZnVuY3Rpb24odCl7aWYoIWEpe3RoaXMuX21vdXNlTW92ZWQ9ITEsdGhpcy5fbW91c2VTdGFydGVkJiZ0aGlzLl9tb3VzZVVwKHQpLHRoaXMuX21vdXNlRG93bkV2ZW50PXQ7dmFyIGk9dGhpcyxzPTE9PT10LndoaWNoLG49XCJzdHJpbmdcIj09dHlwZW9mIHRoaXMub3B0aW9ucy5jYW5jZWwmJnQudGFyZ2V0Lm5vZGVOYW1lP2UodC50YXJnZXQpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmNhbmNlbCkubGVuZ3RoOiExO3JldHVybiBzJiYhbiYmdGhpcy5fbW91c2VDYXB0dXJlKHQpPyh0aGlzLm1vdXNlRGVsYXlNZXQ9IXRoaXMub3B0aW9ucy5kZWxheSx0aGlzLm1vdXNlRGVsYXlNZXR8fCh0aGlzLl9tb3VzZURlbGF5VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2kubW91c2VEZWxheU1ldD0hMH0sdGhpcy5vcHRpb25zLmRlbGF5KSksdGhpcy5fbW91c2VEaXN0YW5jZU1ldCh0KSYmdGhpcy5fbW91c2VEZWxheU1ldCh0KSYmKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHQpIT09ITEsIXRoaXMuX21vdXNlU3RhcnRlZCk/KHQucHJldmVudERlZmF1bHQoKSwhMCk6KCEwPT09ZS5kYXRhKHQudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSYmZS5yZW1vdmVEYXRhKHQudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZT1mdW5jdGlvbihlKXtyZXR1cm4gaS5fbW91c2VNb3ZlKGUpfSx0aGlzLl9tb3VzZVVwRGVsZWdhdGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGkuX21vdXNlVXAoZSl9LHRoaXMuZG9jdW1lbnQuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLmJpbmQoXCJtb3VzZXVwLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpLHQucHJldmVudERlZmF1bHQoKSxhPSEwLCEwKSk6ITB9fSxfbW91c2VNb3ZlOmZ1bmN0aW9uKHQpe2lmKHRoaXMuX21vdXNlTW92ZWQpe2lmKGUudWkuaWUmJighZG9jdW1lbnQuZG9jdW1lbnRNb2RlfHw5PmRvY3VtZW50LmRvY3VtZW50TW9kZSkmJiF0LmJ1dHRvbilyZXR1cm4gdGhpcy5fbW91c2VVcCh0KTtpZighdC53aGljaClyZXR1cm4gdGhpcy5fbW91c2VVcCh0KX1yZXR1cm4odC53aGljaHx8dC5idXR0b24pJiYodGhpcy5fbW91c2VNb3ZlZD0hMCksdGhpcy5fbW91c2VTdGFydGVkPyh0aGlzLl9tb3VzZURyYWcodCksdC5wcmV2ZW50RGVmYXVsdCgpKToodGhpcy5fbW91c2VEaXN0YW5jZU1ldCh0KSYmdGhpcy5fbW91c2VEZWxheU1ldCh0KSYmKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LHQpIT09ITEsdGhpcy5fbW91c2VTdGFydGVkP3RoaXMuX21vdXNlRHJhZyh0KTp0aGlzLl9tb3VzZVVwKHQpKSwhdGhpcy5fbW91c2VTdGFydGVkKX0sX21vdXNlVXA6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuZG9jdW1lbnQudW5iaW5kKFwibW91c2Vtb3ZlLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkudW5iaW5kKFwibW91c2V1cC5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKSx0aGlzLl9tb3VzZVN0YXJ0ZWQmJih0aGlzLl9tb3VzZVN0YXJ0ZWQ9ITEsdC50YXJnZXQ9PT10aGlzLl9tb3VzZURvd25FdmVudC50YXJnZXQmJmUuZGF0YSh0LnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIiwhMCksdGhpcy5fbW91c2VTdG9wKHQpKSxhPSExLCExfSxfbW91c2VEaXN0YW5jZU1ldDpmdW5jdGlvbihlKXtyZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVgtZS5wYWdlWCksTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVktZS5wYWdlWSkpPj10aGlzLm9wdGlvbnMuZGlzdGFuY2V9LF9tb3VzZURlbGF5TWV0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubW91c2VEZWxheU1ldH0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oKXt9LF9tb3VzZURyYWc6ZnVuY3Rpb24oKXt9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oKXt9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oKXtyZXR1cm4hMH19KSxlLndpZGdldChcInVpLnNvcnRhYmxlXCIsZS51aS5tb3VzZSx7dmVyc2lvbjpcIjEuMTEuNFwiLHdpZGdldEV2ZW50UHJlZml4Olwic29ydFwiLHJlYWR5OiExLG9wdGlvbnM6e2FwcGVuZFRvOlwicGFyZW50XCIsYXhpczohMSxjb25uZWN0V2l0aDohMSxjb250YWlubWVudDohMSxjdXJzb3I6XCJhdXRvXCIsY3Vyc29yQXQ6ITEsZHJvcE9uRW1wdHk6ITAsZm9yY2VQbGFjZWhvbGRlclNpemU6ITEsZm9yY2VIZWxwZXJTaXplOiExLGdyaWQ6ITEsaGFuZGxlOiExLGhlbHBlcjpcIm9yaWdpbmFsXCIsaXRlbXM6XCI+ICpcIixvcGFjaXR5OiExLHBsYWNlaG9sZGVyOiExLHJldmVydDohMSxzY3JvbGw6ITAsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc2NvcGU6XCJkZWZhdWx0XCIsdG9sZXJhbmNlOlwiaW50ZXJzZWN0XCIsekluZGV4OjFlMyxhY3RpdmF0ZTpudWxsLGJlZm9yZVN0b3A6bnVsbCxjaGFuZ2U6bnVsbCxkZWFjdGl2YXRlOm51bGwsb3V0Om51bGwsb3ZlcjpudWxsLHJlY2VpdmU6bnVsbCxyZW1vdmU6bnVsbCxzb3J0Om51bGwsc3RhcnQ6bnVsbCxzdG9wOm51bGwsdXBkYXRlOm51bGx9LF9pc092ZXJBeGlzOmZ1bmN0aW9uKGUsdCxpKXtyZXR1cm4gZT49dCYmdCtpPmV9LF9pc0Zsb2F0aW5nOmZ1bmN0aW9uKGUpe3JldHVybi9sZWZ0fHJpZ2h0Ly50ZXN0KGUuY3NzKFwiZmxvYXRcIikpfHwvaW5saW5lfHRhYmxlLWNlbGwvLnRlc3QoZS5jc3MoXCJkaXNwbGF5XCIpKX0sX2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMuY29udGFpbmVyQ2FjaGU9e30sdGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktc29ydGFibGVcIiksdGhpcy5yZWZyZXNoKCksdGhpcy5vZmZzZXQ9dGhpcy5lbGVtZW50Lm9mZnNldCgpLHRoaXMuX21vdXNlSW5pdCgpLHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpLHRoaXMucmVhZHk9ITB9LF9zZXRPcHRpb246ZnVuY3Rpb24oZSx0KXt0aGlzLl9zdXBlcihlLHQpLFwiaGFuZGxlXCI9PT1lJiZ0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKX0sX3NldEhhbmRsZUNsYXNzTmFtZTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5maW5kKFwiLnVpLXNvcnRhYmxlLWhhbmRsZVwiKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhhbmRsZVwiKSxlLmVhY2godGhpcy5pdGVtcyxmdW5jdGlvbigpeyh0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGFuZGxlP3RoaXMuaXRlbS5maW5kKHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oYW5kbGUpOnRoaXMuaXRlbSkuYWRkQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oYW5kbGVcIil9KX0sX2Rlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZSB1aS1zb3J0YWJsZS1kaXNhYmxlZFwiKS5maW5kKFwiLnVpLXNvcnRhYmxlLWhhbmRsZVwiKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhhbmRsZVwiKSx0aGlzLl9tb3VzZURlc3Ryb3koKTtmb3IodmFyIGU9dGhpcy5pdGVtcy5sZW5ndGgtMTtlPj0wO2UtLSl0aGlzLml0ZW1zW2VdLml0ZW0ucmVtb3ZlRGF0YSh0aGlzLndpZGdldE5hbWUrXCItaXRlbVwiKTtyZXR1cm4gdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbih0LGkpe3ZhciBzPW51bGwsbj0hMSxhPXRoaXM7cmV0dXJuIHRoaXMucmV2ZXJ0aW5nPyExOnRoaXMub3B0aW9ucy5kaXNhYmxlZHx8XCJzdGF0aWNcIj09PXRoaXMub3B0aW9ucy50eXBlPyExOih0aGlzLl9yZWZyZXNoSXRlbXModCksZSh0LnRhcmdldCkucGFyZW50cygpLmVhY2goZnVuY3Rpb24oKXtyZXR1cm4gZS5kYXRhKHRoaXMsYS53aWRnZXROYW1lK1wiLWl0ZW1cIik9PT1hPyhzPWUodGhpcyksITEpOnZvaWQgMH0pLGUuZGF0YSh0LnRhcmdldCxhLndpZGdldE5hbWUrXCItaXRlbVwiKT09PWEmJihzPWUodC50YXJnZXQpKSxzPyF0aGlzLm9wdGlvbnMuaGFuZGxlfHxpfHwoZSh0aGlzLm9wdGlvbnMuaGFuZGxlLHMpLmZpbmQoXCIqXCIpLmFkZEJhY2soKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcz09PXQudGFyZ2V0JiYobj0hMCl9KSxuKT8odGhpcy5jdXJyZW50SXRlbT1zLHRoaXMuX3JlbW92ZUN1cnJlbnRzRnJvbUl0ZW1zKCksITApOiExOiExKX0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGEsbz10aGlzLm9wdGlvbnM7aWYodGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMsdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksdGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKHQpLHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSx0aGlzLl9jYWNoZU1hcmdpbnMoKSx0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKSx0aGlzLm9mZnNldD10aGlzLmN1cnJlbnRJdGVtLm9mZnNldCgpLHRoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fSxlLmV4dGVuZCh0aGlzLm9mZnNldCx7Y2xpY2s6e2xlZnQ6dC5wYWdlWC10aGlzLm9mZnNldC5sZWZ0LHRvcDp0LnBhZ2VZLXRoaXMub2Zmc2V0LnRvcH0scGFyZW50OnRoaXMuX2dldFBhcmVudE9mZnNldCgpLHJlbGF0aXZlOnRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCl9KSx0aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiLFwiYWJzb2x1dGVcIiksdGhpcy5jc3NQb3NpdGlvbj10aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiKSx0aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLm9yaWdpbmFsUGFnZVg9dC5wYWdlWCx0aGlzLm9yaWdpbmFsUGFnZVk9dC5wYWdlWSxvLmN1cnNvckF0JiZ0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKG8uY3Vyc29yQXQpLHRoaXMuZG9tUG9zaXRpb249e3ByZXY6dGhpcy5jdXJyZW50SXRlbS5wcmV2KClbMF0scGFyZW50OnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF19LHRoaXMuaGVscGVyWzBdIT09dGhpcy5jdXJyZW50SXRlbVswXSYmdGhpcy5jdXJyZW50SXRlbS5oaWRlKCksdGhpcy5fY3JlYXRlUGxhY2Vob2xkZXIoKSxvLmNvbnRhaW5tZW50JiZ0aGlzLl9zZXRDb250YWlubWVudCgpLG8uY3Vyc29yJiZcImF1dG9cIiE9PW8uY3Vyc29yJiYoYT10aGlzLmRvY3VtZW50LmZpbmQoXCJib2R5XCIpLHRoaXMuc3RvcmVkQ3Vyc29yPWEuY3NzKFwiY3Vyc29yXCIpLGEuY3NzKFwiY3Vyc29yXCIsby5jdXJzb3IpLHRoaXMuc3RvcmVkU3R5bGVzaGVldD1lKFwiPHN0eWxlPip7IGN1cnNvcjogXCIrby5jdXJzb3IrXCIgIWltcG9ydGFudDsgfTwvc3R5bGU+XCIpLmFwcGVuZFRvKGEpKSxvLm9wYWNpdHkmJih0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpJiYodGhpcy5fc3RvcmVkT3BhY2l0eT10aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIpKSx0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsby5vcGFjaXR5KSksby56SW5kZXgmJih0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIikmJih0aGlzLl9zdG9yZWRaSW5kZXg9dGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIpKSx0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIixvLnpJbmRleCkpLHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmXCJIVE1MXCIhPT10aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lJiYodGhpcy5vdmVyZmxvd09mZnNldD10aGlzLnNjcm9sbFBhcmVudC5vZmZzZXQoKSksdGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsdCx0aGlzLl91aUhhc2goKSksdGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpLCFzKWZvcihuPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtuPj0wO24tLSl0aGlzLmNvbnRhaW5lcnNbbl0uX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKTtyZXR1cm4gZS51aS5kZG1hbmFnZXImJihlLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXMpLGUudWkuZGRtYW5hZ2VyJiYhby5kcm9wQmVoYXZpb3VyJiZlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLHQpLHRoaXMuZHJhZ2dpbmc9ITAsdGhpcy5oZWxwZXIuYWRkQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIiksdGhpcy5fbW91c2VEcmFnKHQpLCEwfSxfbW91c2VEcmFnOmZ1bmN0aW9uKHQpe3ZhciBpLHMsbixhLG89dGhpcy5vcHRpb25zLHI9ITE7Zm9yKHRoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIiksdGhpcy5sYXN0UG9zaXRpb25BYnN8fCh0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzKSx0aGlzLm9wdGlvbnMuc2Nyb2xsJiYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPT10aGlzLmRvY3VtZW50WzBdJiZcIkhUTUxcIiE9PXRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWU/KHRoaXMub3ZlcmZsb3dPZmZzZXQudG9wK3RoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodC10LnBhZ2VZPG8uc2Nyb2xsU2Vuc2l0aXZpdHk/dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPXI9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wK28uc2Nyb2xsU3BlZWQ6dC5wYWdlWS10aGlzLm92ZXJmbG93T2Zmc2V0LnRvcDxvLnNjcm9sbFNlbnNpdGl2aXR5JiYodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPXI9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wLW8uc2Nyb2xsU3BlZWQpLHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC10LnBhZ2VYPG8uc2Nyb2xsU2Vuc2l0aXZpdHk/dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1yPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrby5zY3JvbGxTcGVlZDp0LnBhZ2VYLXRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdDxvLnNjcm9sbFNlbnNpdGl2aXR5JiYodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1yPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtby5zY3JvbGxTcGVlZCkpOih0LnBhZ2VZLXRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCk8by5zY3JvbGxTZW5zaXRpdml0eT9yPXRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCktby5zY3JvbGxTcGVlZCk6dGhpcy53aW5kb3cuaGVpZ2h0KCktKHQucGFnZVktdGhpcy5kb2N1bWVudC5zY3JvbGxUb3AoKSk8by5zY3JvbGxTZW5zaXRpdml0eSYmKHI9dGhpcy5kb2N1bWVudC5zY3JvbGxUb3AodGhpcy5kb2N1bWVudC5zY3JvbGxUb3AoKStvLnNjcm9sbFNwZWVkKSksdC5wYWdlWC10aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKTxvLnNjcm9sbFNlbnNpdGl2aXR5P3I9dGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KHRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpLW8uc2Nyb2xsU3BlZWQpOnRoaXMud2luZG93LndpZHRoKCktKHQucGFnZVgtdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KCkpPG8uc2Nyb2xsU2Vuc2l0aXZpdHkmJihyPXRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCh0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKStvLnNjcm9sbFNwZWVkKSkpLHIhPT0hMSYmZS51aS5kZG1hbmFnZXImJiFvLmRyb3BCZWhhdmlvdXImJmUudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsdCkpLHRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oXCJhYnNvbHV0ZVwiKSx0aGlzLm9wdGlvbnMuYXhpcyYmXCJ5XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8KHRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIiksdGhpcy5vcHRpb25zLmF4aXMmJlwieFwiPT09dGhpcy5vcHRpb25zLmF4aXN8fCh0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiKSxpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aT49MDtpLS0paWYocz10aGlzLml0ZW1zW2ldLG49cy5pdGVtWzBdLGE9dGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKHMpLGEmJnMuaW5zdGFuY2U9PT10aGlzLmN1cnJlbnRDb250YWluZXImJm4hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLnBsYWNlaG9sZGVyWzE9PT1hP1wibmV4dFwiOlwicHJldlwiXSgpWzBdIT09biYmIWUuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSxuKSYmKFwic2VtaS1keW5hbWljXCI9PT10aGlzLm9wdGlvbnMudHlwZT8hZS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sbik6ITApKXtpZih0aGlzLmRpcmVjdGlvbj0xPT09YT9cImRvd25cIjpcInVwXCIsXCJwb2ludGVyXCIhPT10aGlzLm9wdGlvbnMudG9sZXJhbmNlJiYhdGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhzKSlicmVhazt0aGlzLl9yZWFycmFuZ2UodCxzKSx0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsdCx0aGlzLl91aUhhc2goKSk7YnJlYWt9cmV0dXJuIHRoaXMuX2NvbnRhY3RDb250YWluZXJzKHQpLGUudWkuZGRtYW5hZ2VyJiZlLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsdCksdGhpcy5fdHJpZ2dlcihcInNvcnRcIix0LHRoaXMuX3VpSGFzaCgpKSx0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzLCExfSxfbW91c2VTdG9wOmZ1bmN0aW9uKHQsaSl7aWYodCl7aWYoZS51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmZS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLHQpLHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBzPXRoaXMsbj10aGlzLnBsYWNlaG9sZGVyLm9mZnNldCgpLGE9dGhpcy5vcHRpb25zLmF4aXMsbz17fTthJiZcInhcIiE9PWF8fChvLmxlZnQ9bi5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0Kyh0aGlzLm9mZnNldFBhcmVudFswXT09PXRoaXMuZG9jdW1lbnRbMF0uYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbExlZnQpKSxhJiZcInlcIiE9PWF8fChvLnRvcD1uLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLXRoaXMubWFyZ2lucy50b3ArKHRoaXMub2Zmc2V0UGFyZW50WzBdPT09dGhpcy5kb2N1bWVudFswXS5ib2R5PzA6dGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsVG9wKSksdGhpcy5yZXZlcnRpbmc9ITAsZSh0aGlzLmhlbHBlcikuYW5pbWF0ZShvLHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnQsMTApfHw1MDAsZnVuY3Rpb24oKXtzLl9jbGVhcih0KX0pfWVsc2UgdGhpcy5fY2xlYXIodCxpKTtyZXR1cm4hMX19LGNhbmNlbDpmdW5jdGlvbigpe2lmKHRoaXMuZHJhZ2dpbmcpe3RoaXMuX21vdXNlVXAoe3RhcmdldDpudWxsfSksXCJvcmlnaW5hbFwiPT09dGhpcy5vcHRpb25zLmhlbHBlcj90aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpOnRoaXMuY3VycmVudEl0ZW0uc2hvdygpO2Zvcih2YXIgdD10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7dD49MDt0LS0pdGhpcy5jb250YWluZXJzW3RdLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLG51bGwsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbdF0uY29udGFpbmVyQ2FjaGUub3ZlciYmKHRoaXMuY29udGFpbmVyc1t0XS5fdHJpZ2dlcihcIm91dFwiLG51bGwsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbdF0uY29udGFpbmVyQ2FjaGUub3Zlcj0wKX1yZXR1cm4gdGhpcy5wbGFjZWhvbGRlciYmKHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pLFwib3JpZ2luYWxcIiE9PXRoaXMub3B0aW9ucy5oZWxwZXImJnRoaXMuaGVscGVyJiZ0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlJiZ0aGlzLmhlbHBlci5yZW1vdmUoKSxlLmV4dGVuZCh0aGlzLHtoZWxwZXI6bnVsbCxkcmFnZ2luZzohMSxyZXZlcnRpbmc6ITEsX25vRmluYWxTb3J0Om51bGx9KSx0aGlzLmRvbVBvc2l0aW9uLnByZXY/ZSh0aGlzLmRvbVBvc2l0aW9uLnByZXYpLmFmdGVyKHRoaXMuY3VycmVudEl0ZW0pOmUodGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQpLnByZXBlbmQodGhpcy5jdXJyZW50SXRlbSkpLHRoaXN9LHNlcmlhbGl6ZTpmdW5jdGlvbih0KXt2YXIgaT10aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KHQmJnQuY29ubmVjdGVkKSxzPVtdO3JldHVybiB0PXR8fHt9LGUoaSkuZWFjaChmdW5jdGlvbigpe3ZhciBpPShlKHQuaXRlbXx8dGhpcykuYXR0cih0LmF0dHJpYnV0ZXx8XCJpZFwiKXx8XCJcIikubWF0Y2godC5leHByZXNzaW9ufHwvKC4rKVtcXC09X10oLispLyk7aSYmcy5wdXNoKCh0LmtleXx8aVsxXStcIltdXCIpK1wiPVwiKyh0LmtleSYmdC5leHByZXNzaW9uP2lbMV06aVsyXSkpfSksIXMubGVuZ3RoJiZ0LmtleSYmcy5wdXNoKHQua2V5K1wiPVwiKSxzLmpvaW4oXCImXCIpfSx0b0FycmF5OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkodCYmdC5jb25uZWN0ZWQpLHM9W107cmV0dXJuIHQ9dHx8e30saS5lYWNoKGZ1bmN0aW9uKCl7cy5wdXNoKGUodC5pdGVtfHx0aGlzKS5hdHRyKHQuYXR0cmlidXRlfHxcImlkXCIpfHxcIlwiKX0pLHN9LF9pbnRlcnNlY3RzV2l0aDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLnBvc2l0aW9uQWJzLmxlZnQsaT10K3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgscz10aGlzLnBvc2l0aW9uQWJzLnRvcCxuPXMrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsYT1lLmxlZnQsbz1hK2Uud2lkdGgscj1lLnRvcCxoPXIrZS5oZWlnaHQsbD10aGlzLm9mZnNldC5jbGljay50b3AsdT10aGlzLm9mZnNldC5jbGljay5sZWZ0LGQ9XCJ4XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8cytsPnImJmg+cytsLGM9XCJ5XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8dCt1PmEmJm8+dCt1LHA9ZCYmYztyZXR1cm5cInBvaW50ZXJcIj09PXRoaXMub3B0aW9ucy50b2xlcmFuY2V8fHRoaXMub3B0aW9ucy5mb3JjZVBvaW50ZXJGb3JDb250YWluZXJzfHxcInBvaW50ZXJcIiE9PXRoaXMub3B0aW9ucy50b2xlcmFuY2UmJnRoaXMuaGVscGVyUHJvcG9ydGlvbnNbdGhpcy5mbG9hdGluZz9cIndpZHRoXCI6XCJoZWlnaHRcIl0+ZVt0aGlzLmZsb2F0aW5nP1wid2lkdGhcIjpcImhlaWdodFwiXT9wOnQrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yPmEmJm8+aS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzImJnMrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMj5yJiZoPm4tdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMn0sX2ludGVyc2VjdHNXaXRoUG9pbnRlcjpmdW5jdGlvbihlKXt2YXIgdD1cInhcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCxlLnRvcCxlLmhlaWdodCksaT1cInlcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGUubGVmdCxlLndpZHRoKSxzPXQmJmksbj10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSxhPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7cmV0dXJuIHM/dGhpcy5mbG9hdGluZz9hJiZcInJpZ2h0XCI9PT1hfHxcImRvd25cIj09PW4/MjoxOm4mJihcImRvd25cIj09PW4/MjoxKTohMX0sX2ludGVyc2VjdHNXaXRoU2lkZXM6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCt0aGlzLm9mZnNldC5jbGljay50b3AsZS50b3ArZS5oZWlnaHQvMixlLmhlaWdodCksaT10aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGUubGVmdCtlLndpZHRoLzIsZS53aWR0aCkscz10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSxuPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7cmV0dXJuIHRoaXMuZmxvYXRpbmcmJm4/XCJyaWdodFwiPT09biYmaXx8XCJsZWZ0XCI9PT1uJiYhaTpzJiYoXCJkb3duXCI9PT1zJiZ0fHxcInVwXCI9PT1zJiYhdCl9LF9nZXREcmFnVmVydGljYWxEaXJlY3Rpb246ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnBvc2l0aW9uQWJzLnRvcC10aGlzLmxhc3RQb3NpdGlvbkFicy50b3A7cmV0dXJuIDAhPT1lJiYoZT4wP1wiZG93blwiOlwidXBcIil9LF9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbjpmdW5jdGlvbigpe3ZhciBlPXRoaXMucG9zaXRpb25BYnMubGVmdC10aGlzLmxhc3RQb3NpdGlvbkFicy5sZWZ0O3JldHVybiAwIT09ZSYmKGU+MD9cInJpZ2h0XCI6XCJsZWZ0XCIpfSxyZWZyZXNoOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9yZWZyZXNoSXRlbXMoZSksdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCksdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksdGhpc30sX2Nvbm5lY3RXaXRoOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcHRpb25zO3JldHVybiBlLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yPT09U3RyaW5nP1tlLmNvbm5lY3RXaXRoXTplLmNvbm5lY3RXaXRofSxfZ2V0SXRlbXNBc2pRdWVyeTpmdW5jdGlvbih0KXtmdW5jdGlvbiBpKCl7ci5wdXNoKHRoaXMpfXZhciBzLG4sYSxvLHI9W10saD1bXSxsPXRoaXMuX2Nvbm5lY3RXaXRoKCk7aWYobCYmdClmb3Iocz1sLmxlbmd0aC0xO3M+PTA7cy0tKWZvcihhPWUobFtzXSx0aGlzLmRvY3VtZW50WzBdKSxuPWEubGVuZ3RoLTE7bj49MDtuLS0pbz1lLmRhdGEoYVtuXSx0aGlzLndpZGdldEZ1bGxOYW1lKSxvJiZvIT09dGhpcyYmIW8ub3B0aW9ucy5kaXNhYmxlZCYmaC5wdXNoKFtlLmlzRnVuY3Rpb24oby5vcHRpb25zLml0ZW1zKT9vLm9wdGlvbnMuaXRlbXMuY2FsbChvLmVsZW1lbnQpOmUoby5vcHRpb25zLml0ZW1zLG8uZWxlbWVudCkubm90KFwiLnVpLXNvcnRhYmxlLWhlbHBlclwiKS5ub3QoXCIudWktc29ydGFibGUtcGxhY2Vob2xkZXJcIiksb10pO2ZvcihoLnB1c2goW2UuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCxudWxsLHtvcHRpb25zOnRoaXMub3B0aW9ucyxpdGVtOnRoaXMuY3VycmVudEl0ZW19KTplKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLHRoaXNdKSxzPWgubGVuZ3RoLTE7cz49MDtzLS0paFtzXVswXS5lYWNoKGkpO3JldHVybiBlKHIpfSxfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmN1cnJlbnRJdGVtLmZpbmQoXCI6ZGF0YShcIit0aGlzLndpZGdldE5hbWUrXCItaXRlbSlcIik7dGhpcy5pdGVtcz1lLmdyZXAodGhpcy5pdGVtcyxmdW5jdGlvbihlKXtmb3IodmFyIGk9MDt0Lmxlbmd0aD5pO2krKylpZih0W2ldPT09ZS5pdGVtWzBdKXJldHVybiExO3JldHVybiEwfSl9LF9yZWZyZXNoSXRlbXM6ZnVuY3Rpb24odCl7dGhpcy5pdGVtcz1bXSx0aGlzLmNvbnRhaW5lcnM9W3RoaXNdO3ZhciBpLHMsbixhLG8scixoLGwsdT10aGlzLml0ZW1zLGQ9W1tlLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sdCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KSx0aGlzXV0sYz10aGlzLl9jb25uZWN0V2l0aCgpO2lmKGMmJnRoaXMucmVhZHkpZm9yKGk9Yy5sZW5ndGgtMTtpPj0wO2ktLSlmb3Iobj1lKGNbaV0sdGhpcy5kb2N1bWVudFswXSkscz1uLmxlbmd0aC0xO3M+PTA7cy0tKWE9ZS5kYXRhKG5bc10sdGhpcy53aWRnZXRGdWxsTmFtZSksYSYmYSE9PXRoaXMmJiFhLm9wdGlvbnMuZGlzYWJsZWQmJihkLnB1c2goW2UuaXNGdW5jdGlvbihhLm9wdGlvbnMuaXRlbXMpP2Eub3B0aW9ucy5pdGVtcy5jYWxsKGEuZWxlbWVudFswXSx0LHtpdGVtOnRoaXMuY3VycmVudEl0ZW19KTplKGEub3B0aW9ucy5pdGVtcyxhLmVsZW1lbnQpLGFdKSx0aGlzLmNvbnRhaW5lcnMucHVzaChhKSk7Zm9yKGk9ZC5sZW5ndGgtMTtpPj0wO2ktLSlmb3Iobz1kW2ldWzFdLHI9ZFtpXVswXSxzPTAsbD1yLmxlbmd0aDtsPnM7cysrKWg9ZShyW3NdKSxoLmRhdGEodGhpcy53aWRnZXROYW1lK1wiLWl0ZW1cIixvKSx1LnB1c2goe2l0ZW06aCxpbnN0YW5jZTpvLHdpZHRoOjAsaGVpZ2h0OjAsbGVmdDowLHRvcDowfSl9LHJlZnJlc2hQb3NpdGlvbnM6ZnVuY3Rpb24odCl7dGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD9cInhcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuaXRlbXNbMF0uaXRlbSk6ITEsdGhpcy5vZmZzZXRQYXJlbnQmJnRoaXMuaGVscGVyJiYodGhpcy5vZmZzZXQucGFyZW50PXRoaXMuX2dldFBhcmVudE9mZnNldCgpKTt2YXIgaSxzLG4sYTtmb3IoaT10aGlzLml0ZW1zLmxlbmd0aC0xO2k+PTA7aS0tKXM9dGhpcy5pdGVtc1tpXSxzLmluc3RhbmNlIT09dGhpcy5jdXJyZW50Q29udGFpbmVyJiZ0aGlzLmN1cnJlbnRDb250YWluZXImJnMuaXRlbVswXSE9PXRoaXMuY3VycmVudEl0ZW1bMF18fChuPXRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50P2UodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQscy5pdGVtKTpzLml0ZW0sdHx8KHMud2lkdGg9bi5vdXRlcldpZHRoKCkscy5oZWlnaHQ9bi5vdXRlckhlaWdodCgpKSxhPW4ub2Zmc2V0KCkscy5sZWZ0PWEubGVmdCxzLnRvcD1hLnRvcCk7aWYodGhpcy5vcHRpb25zLmN1c3RvbSYmdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycyl0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzLmNhbGwodGhpcyk7ZWxzZSBmb3IoaT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aT49MDtpLS0pYT10aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudC5vZmZzZXQoKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUubGVmdD1hLmxlZnQsdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLnRvcD1hLnRvcCx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUud2lkdGg9dGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub3V0ZXJXaWR0aCgpLHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5oZWlnaHQ9dGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub3V0ZXJIZWlnaHQoKTtyZXR1cm4gdGhpc30sX2NyZWF0ZVBsYWNlaG9sZGVyOmZ1bmN0aW9uKHQpe3Q9dHx8dGhpczt2YXIgaSxzPXQub3B0aW9ucztzLnBsYWNlaG9sZGVyJiZzLnBsYWNlaG9sZGVyLmNvbnN0cnVjdG9yIT09U3RyaW5nfHwoaT1zLnBsYWNlaG9sZGVyLHMucGxhY2Vob2xkZXI9e2VsZW1lbnQ6ZnVuY3Rpb24oKXt2YXIgcz10LmN1cnJlbnRJdGVtWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksbj1lKFwiPFwiK3MrXCI+XCIsdC5kb2N1bWVudFswXSkuYWRkQ2xhc3MoaXx8dC5jdXJyZW50SXRlbVswXS5jbGFzc05hbWUrXCIgdWktc29ydGFibGUtcGxhY2Vob2xkZXJcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIik7cmV0dXJuXCJ0Ym9keVwiPT09cz90Ll9jcmVhdGVUclBsYWNlaG9sZGVyKHQuY3VycmVudEl0ZW0uZmluZChcInRyXCIpLmVxKDApLGUoXCI8dHI+XCIsdC5kb2N1bWVudFswXSkuYXBwZW5kVG8obikpOlwidHJcIj09PXM/dC5fY3JlYXRlVHJQbGFjZWhvbGRlcih0LmN1cnJlbnRJdGVtLG4pOlwiaW1nXCI9PT1zJiZuLmF0dHIoXCJzcmNcIix0LmN1cnJlbnRJdGVtLmF0dHIoXCJzcmNcIikpLGl8fG4uY3NzKFwidmlzaWJpbGl0eVwiLFwiaGlkZGVuXCIpLG59LHVwZGF0ZTpmdW5jdGlvbihlLG4peyghaXx8cy5mb3JjZVBsYWNlaG9sZGVyU2l6ZSkmJihuLmhlaWdodCgpfHxuLmhlaWdodCh0LmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nVG9wXCIpfHwwLDEwKS1wYXJzZUludCh0LmN1cnJlbnRJdGVtLmNzcyhcInBhZGRpbmdCb3R0b21cIil8fDAsMTApKSxuLndpZHRoKCl8fG4ud2lkdGgodC5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nTGVmdFwiKXx8MCwxMCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nUmlnaHRcIil8fDAsMTApKSl9fSksdC5wbGFjZWhvbGRlcj1lKHMucGxhY2Vob2xkZXIuZWxlbWVudC5jYWxsKHQuZWxlbWVudCx0LmN1cnJlbnRJdGVtKSksdC5jdXJyZW50SXRlbS5hZnRlcih0LnBsYWNlaG9sZGVyKSxzLnBsYWNlaG9sZGVyLnVwZGF0ZSh0LHQucGxhY2Vob2xkZXIpfSxfY3JlYXRlVHJQbGFjZWhvbGRlcjpmdW5jdGlvbih0LGkpe3ZhciBzPXRoaXM7dC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKXtlKFwiPHRkPiYjMTYwOzwvdGQ+XCIscy5kb2N1bWVudFswXSkuYXR0cihcImNvbHNwYW5cIixlKHRoaXMpLmF0dHIoXCJjb2xzcGFuXCIpfHwxKS5hcHBlbmRUbyhpKX0pfSxfY29udGFjdENvbnRhaW5lcnM6ZnVuY3Rpb24odCl7dmFyIGkscyxuLGEsbyxyLGgsbCx1LGQsYz1udWxsLHA9bnVsbDtmb3IoaT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aT49MDtpLS0paWYoIWUuY29udGFpbnModGhpcy5jdXJyZW50SXRlbVswXSx0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudFswXSkpaWYodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlKSl7aWYoYyYmZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudFswXSxjLmVsZW1lbnRbMF0pKWNvbnRpbnVlO2M9dGhpcy5jb250YWluZXJzW2ldLHA9aX1lbHNlIHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyJiYodGhpcy5jb250YWluZXJzW2ldLl90cmlnZ2VyKFwib3V0XCIsdCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyPTApO2lmKGMpaWYoMT09PXRoaXMuY29udGFpbmVycy5sZW5ndGgpdGhpcy5jb250YWluZXJzW3BdLmNvbnRhaW5lckNhY2hlLm92ZXJ8fCh0aGlzLmNvbnRhaW5lcnNbcF0uX3RyaWdnZXIoXCJvdmVyXCIsdCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1twXS5jb250YWluZXJDYWNoZS5vdmVyPTEpO2Vsc2V7Zm9yKG49MWU0LGE9bnVsbCx1PWMuZmxvYXRpbmd8fHRoaXMuX2lzRmxvYXRpbmcodGhpcy5jdXJyZW50SXRlbSksbz11P1wibGVmdFwiOlwidG9wXCIscj11P1wid2lkdGhcIjpcImhlaWdodFwiLGQ9dT9cImNsaWVudFhcIjpcImNsaWVudFlcIixzPXRoaXMuaXRlbXMubGVuZ3RoLTE7cz49MDtzLS0pZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbcF0uZWxlbWVudFswXSx0aGlzLml0ZW1zW3NdLml0ZW1bMF0pJiZ0aGlzLml0ZW1zW3NdLml0ZW1bMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiYoaD10aGlzLml0ZW1zW3NdLml0ZW0ub2Zmc2V0KClbb10sbD0hMSx0W2RdLWg+dGhpcy5pdGVtc1tzXVtyXS8yJiYobD0hMCksbj5NYXRoLmFicyh0W2RdLWgpJiYobj1NYXRoLmFicyh0W2RdLWgpLGE9dGhpcy5pdGVtc1tzXSx0aGlzLmRpcmVjdGlvbj1sP1widXBcIjpcImRvd25cIikpO2lmKCFhJiYhdGhpcy5vcHRpb25zLmRyb3BPbkVtcHR5KXJldHVybjtpZih0aGlzLmN1cnJlbnRDb250YWluZXI9PT10aGlzLmNvbnRhaW5lcnNbcF0pcmV0dXJuIHRoaXMuY3VycmVudENvbnRhaW5lci5jb250YWluZXJDYWNoZS5vdmVyfHwodGhpcy5jb250YWluZXJzW3BdLl90cmlnZ2VyKFwib3ZlclwiLHQsdGhpcy5fdWlIYXNoKCkpLHRoaXMuY3VycmVudENvbnRhaW5lci5jb250YWluZXJDYWNoZS5vdmVyPTEpLHZvaWQgMDthP3RoaXMuX3JlYXJyYW5nZSh0LGEsbnVsbCwhMCk6dGhpcy5fcmVhcnJhbmdlKHQsbnVsbCx0aGlzLmNvbnRhaW5lcnNbcF0uZWxlbWVudCwhMCksdGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLHQsdGhpcy5fdWlIYXNoKCkpLHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcihcImNoYW5nZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpcy5jb250YWluZXJzW3BdLHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlci51cGRhdGUodGhpcy5jdXJyZW50Q29udGFpbmVyLHRoaXMucGxhY2Vob2xkZXIpLHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcihcIm92ZXJcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSksdGhpcy5jb250YWluZXJzW3BdLmNvbnRhaW5lckNhY2hlLm92ZXI9MX19LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5vcHRpb25zLHM9ZS5pc0Z1bmN0aW9uKGkuaGVscGVyKT9lKGkuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSxbdCx0aGlzLmN1cnJlbnRJdGVtXSkpOlwiY2xvbmVcIj09PWkuaGVscGVyP3RoaXMuY3VycmVudEl0ZW0uY2xvbmUoKTp0aGlzLmN1cnJlbnRJdGVtO3JldHVybiBzLnBhcmVudHMoXCJib2R5XCIpLmxlbmd0aHx8ZShcInBhcmVudFwiIT09aS5hcHBlbmRUbz9pLmFwcGVuZFRvOnRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSlbMF0uYXBwZW5kQ2hpbGQoc1swXSksc1swXT09PXRoaXMuY3VycmVudEl0ZW1bMF0mJih0aGlzLl9zdG9yZWRDU1M9e3dpZHRoOnRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUud2lkdGgsaGVpZ2h0OnRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUuaGVpZ2h0LHBvc2l0aW9uOnRoaXMuY3VycmVudEl0ZW0uY3NzKFwicG9zaXRpb25cIiksdG9wOnRoaXMuY3VycmVudEl0ZW0uY3NzKFwidG9wXCIpLGxlZnQ6dGhpcy5jdXJyZW50SXRlbS5jc3MoXCJsZWZ0XCIpfSksKCFzWzBdLnN0eWxlLndpZHRofHxpLmZvcmNlSGVscGVyU2l6ZSkmJnMud2lkdGgodGhpcy5jdXJyZW50SXRlbS53aWR0aCgpKSwoIXNbMF0uc3R5bGUuaGVpZ2h0fHxpLmZvcmNlSGVscGVyU2l6ZSkmJnMuaGVpZ2h0KHRoaXMuY3VycmVudEl0ZW0uaGVpZ2h0KCkpLHN9LF9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOmZ1bmN0aW9uKHQpe1wic3RyaW5nXCI9PXR5cGVvZiB0JiYodD10LnNwbGl0KFwiIFwiKSksZS5pc0FycmF5KHQpJiYodD17bGVmdDordFswXSx0b3A6K3RbMV18fDB9KSxcImxlZnRcImluIHQmJih0aGlzLm9mZnNldC5jbGljay5sZWZ0PXQubGVmdCt0aGlzLm1hcmdpbnMubGVmdCksXCJyaWdodFwiaW4gdCYmKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10LnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0KSxcInRvcFwiaW4gdCYmKHRoaXMub2Zmc2V0LmNsaWNrLnRvcD10LnRvcCt0aGlzLm1hcmdpbnMudG9wKSxcImJvdHRvbVwiaW4gdCYmKHRoaXMub2Zmc2V0LmNsaWNrLnRvcD10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10LmJvdHRvbSt0aGlzLm1hcmdpbnMudG9wKX0sX2dldFBhcmVudE9mZnNldDpmdW5jdGlvbigpe3RoaXMub2Zmc2V0UGFyZW50PXRoaXMuaGVscGVyLm9mZnNldFBhcmVudCgpO3ZhciB0PXRoaXMub2Zmc2V0UGFyZW50Lm9mZnNldCgpO3JldHVyblwiYWJzb2x1dGVcIj09PXRoaXMuY3NzUG9zaXRpb24mJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSkmJih0LmxlZnQrPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSx0LnRvcCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCkpLCh0aGlzLm9mZnNldFBhcmVudFswXT09PXRoaXMuZG9jdW1lbnRbMF0uYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmXCJodG1sXCI9PT10aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkmJmUudWkuaWUpJiYodD17dG9wOjAsbGVmdDowfSkse3RvcDp0LnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OnQubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZihcInJlbGF0aXZlXCI9PT10aGlzLmNzc1Bvc2l0aW9uKXt2YXIgZT10aGlzLmN1cnJlbnRJdGVtLnBvc2l0aW9uKCk7cmV0dXJue3RvcDplLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDplLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fXJldHVybnt0b3A6MCxsZWZ0OjB9fSxfY2FjaGVNYXJnaW5zOmZ1bmN0aW9uKCl7dGhpcy5tYXJnaW5zPXtsZWZ0OnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luTGVmdFwiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MH19LF9jYWNoZUhlbHBlclByb3BvcnRpb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXJQcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpfX0sX3NldENvbnRhaW5tZW50OmZ1bmN0aW9uKCl7dmFyIHQsaSxzLG49dGhpcy5vcHRpb25zO1wicGFyZW50XCI9PT1uLmNvbnRhaW5tZW50JiYobi5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlKSwoXCJkb2N1bWVudFwiPT09bi5jb250YWlubWVudHx8XCJ3aW5kb3dcIj09PW4uY29udGFpbm1lbnQpJiYodGhpcy5jb250YWlubWVudD1bMC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LDAtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsXCJkb2N1bWVudFwiPT09bi5jb250YWlubWVudD90aGlzLmRvY3VtZW50LndpZHRoKCk6dGhpcy53aW5kb3cud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChcImRvY3VtZW50XCI9PT1uLmNvbnRhaW5tZW50P3RoaXMuZG9jdW1lbnQud2lkdGgoKTp0aGlzLndpbmRvdy5oZWlnaHQoKXx8dGhpcy5kb2N1bWVudFswXS5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXSksL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KG4uY29udGFpbm1lbnQpfHwodD1lKG4uY29udGFpbm1lbnQpWzBdLGk9ZShuLmNvbnRhaW5tZW50KS5vZmZzZXQoKSxzPVwiaGlkZGVuXCIhPT1lKHQpLmNzcyhcIm92ZXJmbG93XCIpLHRoaXMuY29udGFpbm1lbnQ9W2kubGVmdCsocGFyc2VJbnQoZSh0KS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoZSh0KS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy5sZWZ0LGkudG9wKyhwYXJzZUludChlKHQpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ1RvcFwiKSwxMCl8fDApLXRoaXMubWFyZ2lucy50b3AsaS5sZWZ0KyhzP01hdGgubWF4KHQuc2Nyb2xsV2lkdGgsdC5vZmZzZXRXaWR0aCk6dC5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGUodCkuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ1JpZ2h0XCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCxpLnRvcCsocz9NYXRoLm1heCh0LnNjcm9sbEhlaWdodCx0Lm9mZnNldEhlaWdodCk6dC5vZmZzZXRIZWlnaHQpLShwYXJzZUludChlKHQpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCktKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ0JvdHRvbVwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LXRoaXMubWFyZ2lucy50b3BdKVxufSxfY29udmVydFBvc2l0aW9uVG86ZnVuY3Rpb24odCxpKXtpfHwoaT10aGlzLnBvc2l0aW9uKTt2YXIgcz1cImFic29sdXRlXCI9PT10PzE6LTEsbj1cImFic29sdXRlXCIhPT10aGlzLmNzc1Bvc2l0aW9ufHx0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMuZG9jdW1lbnRbMF0mJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pP3RoaXMuc2Nyb2xsUGFyZW50OnRoaXMub2Zmc2V0UGFyZW50LGE9LyhodG1sfGJvZHkpL2kudGVzdChuWzBdLnRhZ05hbWUpO3JldHVybnt0b3A6aS50b3ArdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wKnMrdGhpcy5vZmZzZXQucGFyZW50LnRvcCpzLShcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTphPzA6bi5zY3JvbGxUb3AoKSkqcyxsZWZ0OmkubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KnMrdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqcy0oXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmE/MDpuLnNjcm9sbExlZnQoKSkqc319LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpLHMsbj10aGlzLm9wdGlvbnMsYT10LnBhZ2VYLG89dC5wYWdlWSxyPVwiYWJzb2x1dGVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSk/dGhpcy5zY3JvbGxQYXJlbnQ6dGhpcy5vZmZzZXRQYXJlbnQsaD0vKGh0bWx8Ym9keSkvaS50ZXN0KHJbMF0udGFnTmFtZSk7cmV0dXJuXCJyZWxhdGl2ZVwiIT09dGhpcy5jc3NQb3NpdGlvbnx8dGhpcy5zY3JvbGxQYXJlbnRbMF0hPT10aGlzLmRvY3VtZW50WzBdJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMub2Zmc2V0UGFyZW50WzBdfHwodGhpcy5vZmZzZXQucmVsYXRpdmU9dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKSksdGhpcy5vcmlnaW5hbFBvc2l0aW9uJiYodGhpcy5jb250YWlubWVudCYmKHQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDx0aGlzLmNvbnRhaW5tZW50WzBdJiYoYT10aGlzLmNvbnRhaW5tZW50WzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLHQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV0mJihvPXRoaXMuY29udGFpbm1lbnRbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wKSx0LnBhZ2VYLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+dGhpcy5jb250YWlubWVudFsyXSYmKGE9dGhpcy5jb250YWlubWVudFsyXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0KSx0LnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD50aGlzLmNvbnRhaW5tZW50WzNdJiYobz10aGlzLmNvbnRhaW5tZW50WzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCkpLG4uZ3JpZCYmKGk9dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKG8tdGhpcy5vcmlnaW5hbFBhZ2VZKS9uLmdyaWRbMV0pKm4uZ3JpZFsxXSxvPXRoaXMuY29udGFpbm1lbnQ/aS10aGlzLm9mZnNldC5jbGljay50b3A+PXRoaXMuY29udGFpbm1lbnRbMV0mJmktdGhpcy5vZmZzZXQuY2xpY2sudG9wPD10aGlzLmNvbnRhaW5tZW50WzNdP2k6aS10aGlzLm9mZnNldC5jbGljay50b3A+PXRoaXMuY29udGFpbm1lbnRbMV0/aS1uLmdyaWRbMV06aStuLmdyaWRbMV06aSxzPXRoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChhLXRoaXMub3JpZ2luYWxQYWdlWCkvbi5ncmlkWzBdKSpuLmdyaWRbMF0sYT10aGlzLmNvbnRhaW5tZW50P3MtdGhpcy5vZmZzZXQuY2xpY2subGVmdD49dGhpcy5jb250YWlubWVudFswXSYmcy10aGlzLm9mZnNldC5jbGljay5sZWZ0PD10aGlzLmNvbnRhaW5tZW50WzJdP3M6cy10aGlzLm9mZnNldC5jbGljay5sZWZ0Pj10aGlzLmNvbnRhaW5tZW50WzBdP3Mtbi5ncmlkWzBdOnMrbi5ncmlkWzBdOnMpKSx7dG9wOm8tdGhpcy5vZmZzZXQuY2xpY2sudG9wLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wKyhcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpoPzA6ci5zY3JvbGxUb3AoKSksbGVmdDphLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmg/MDpyLnNjcm9sbExlZnQoKSl9fSxfcmVhcnJhbmdlOmZ1bmN0aW9uKGUsdCxpLHMpe2k/aVswXS5hcHBlbmRDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTp0Lml0ZW1bMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlclswXSxcImRvd25cIj09PXRoaXMuZGlyZWN0aW9uP3QuaXRlbVswXTp0Lml0ZW1bMF0ubmV4dFNpYmxpbmcpLHRoaXMuY291bnRlcj10aGlzLmNvdW50ZXI/Kyt0aGlzLmNvdW50ZXI6MTt2YXIgbj10aGlzLmNvdW50ZXI7dGhpcy5fZGVsYXkoZnVuY3Rpb24oKXtuPT09dGhpcy5jb3VudGVyJiZ0aGlzLnJlZnJlc2hQb3NpdGlvbnMoIXMpfSl9LF9jbGVhcjpmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIGkoZSx0LGkpe3JldHVybiBmdW5jdGlvbihzKXtpLl90cmlnZ2VyKGUscyx0Ll91aUhhc2godCkpfX10aGlzLnJldmVydGluZz0hMTt2YXIgcyxuPVtdO2lmKCF0aGlzLl9ub0ZpbmFsU29ydCYmdGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKS5sZW5ndGgmJnRoaXMucGxhY2Vob2xkZXIuYmVmb3JlKHRoaXMuY3VycmVudEl0ZW0pLHRoaXMuX25vRmluYWxTb3J0PW51bGwsdGhpcy5oZWxwZXJbMF09PT10aGlzLmN1cnJlbnRJdGVtWzBdKXtmb3IocyBpbiB0aGlzLl9zdG9yZWRDU1MpKFwiYXV0b1wiPT09dGhpcy5fc3RvcmVkQ1NTW3NdfHxcInN0YXRpY1wiPT09dGhpcy5fc3RvcmVkQ1NTW3NdKSYmKHRoaXMuX3N0b3JlZENTU1tzXT1cIlwiKTt0aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpfWVsc2UgdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7Zm9yKHRoaXMuZnJvbU91dHNpZGUmJiF0JiZuLnB1c2goZnVuY3Rpb24oZSl7dGhpcy5fdHJpZ2dlcihcInJlY2VpdmVcIixlLHRoaXMuX3VpSGFzaCh0aGlzLmZyb21PdXRzaWRlKSl9KSwhdGhpcy5mcm9tT3V0c2lkZSYmdGhpcy5kb21Qb3NpdGlvbi5wcmV2PT09dGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KFwiLnVpLXNvcnRhYmxlLWhlbHBlclwiKVswXSYmdGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQ9PT10aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdfHx0fHxuLnB1c2goZnVuY3Rpb24oZSl7dGhpcy5fdHJpZ2dlcihcInVwZGF0ZVwiLGUsdGhpcy5fdWlIYXNoKCkpfSksdGhpcyE9PXRoaXMuY3VycmVudENvbnRhaW5lciYmKHR8fChuLnB1c2goZnVuY3Rpb24oZSl7dGhpcy5fdHJpZ2dlcihcInJlbW92ZVwiLGUsdGhpcy5fdWlIYXNoKCkpfSksbi5wdXNoKGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtlLl90cmlnZ2VyKFwicmVjZWl2ZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmN1cnJlbnRDb250YWluZXIpKSxuLnB1c2goZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe2UuX3RyaWdnZXIoXCJ1cGRhdGVcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jdXJyZW50Q29udGFpbmVyKSkpKSxzPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtzPj0wO3MtLSl0fHxuLnB1c2goaShcImRlYWN0aXZhdGVcIix0aGlzLHRoaXMuY29udGFpbmVyc1tzXSkpLHRoaXMuY29udGFpbmVyc1tzXS5jb250YWluZXJDYWNoZS5vdmVyJiYobi5wdXNoKGkoXCJvdXRcIix0aGlzLHRoaXMuY29udGFpbmVyc1tzXSkpLHRoaXMuY29udGFpbmVyc1tzXS5jb250YWluZXJDYWNoZS5vdmVyPTApO2lmKHRoaXMuc3RvcmVkQ3Vyc29yJiYodGhpcy5kb2N1bWVudC5maW5kKFwiYm9keVwiKS5jc3MoXCJjdXJzb3JcIix0aGlzLnN0b3JlZEN1cnNvciksdGhpcy5zdG9yZWRTdHlsZXNoZWV0LnJlbW92ZSgpKSx0aGlzLl9zdG9yZWRPcGFjaXR5JiZ0aGlzLmhlbHBlci5jc3MoXCJvcGFjaXR5XCIsdGhpcy5fc3RvcmVkT3BhY2l0eSksdGhpcy5fc3RvcmVkWkluZGV4JiZ0aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIixcImF1dG9cIj09PXRoaXMuX3N0b3JlZFpJbmRleD9cIlwiOnRoaXMuX3N0b3JlZFpJbmRleCksdGhpcy5kcmFnZ2luZz0hMSx0fHx0aGlzLl90cmlnZ2VyKFwiYmVmb3JlU3RvcFwiLGUsdGhpcy5fdWlIYXNoKCkpLHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKSx0aGlzLmNhbmNlbEhlbHBlclJlbW92YWx8fCh0aGlzLmhlbHBlclswXSE9PXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMuaGVscGVyLnJlbW92ZSgpLHRoaXMuaGVscGVyPW51bGwpLCF0KXtmb3Iocz0wO24ubGVuZ3RoPnM7cysrKW5bc10uY2FsbCh0aGlzLGUpO3RoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZSx0aGlzLl91aUhhc2goKSl9cmV0dXJuIHRoaXMuZnJvbU91dHNpZGU9ITEsIXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbH0sX3RyaWdnZXI6ZnVuY3Rpb24oKXtlLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpPT09ITEmJnRoaXMuY2FuY2VsKCl9LF91aUhhc2g6ZnVuY3Rpb24odCl7dmFyIGk9dHx8dGhpcztyZXR1cm57aGVscGVyOmkuaGVscGVyLHBsYWNlaG9sZGVyOmkucGxhY2Vob2xkZXJ8fGUoW10pLHBvc2l0aW9uOmkucG9zaXRpb24sb3JpZ2luYWxQb3NpdGlvbjppLm9yaWdpbmFsUG9zaXRpb24sb2Zmc2V0OmkucG9zaXRpb25BYnMsaXRlbTppLmN1cnJlbnRJdGVtLHNlbmRlcjp0P3QuZWxlbWVudDpudWxsfX19KTt2YXIgbz1cInVpLWVmZmVjdHMtXCIscj1lO2UuZWZmZWN0cz17ZWZmZWN0Ont9fSxmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIGkoZSx0LGkpe3ZhciBzPWRbdC50eXBlXXx8e307cmV0dXJuIG51bGw9PWU/aXx8IXQuZGVmP251bGw6dC5kZWY6KGU9cy5mbG9vcj9+fmU6cGFyc2VGbG9hdChlKSxpc05hTihlKT90LmRlZjpzLm1vZD8oZStzLm1vZCklcy5tb2Q6MD5lPzA6ZT5zLm1heD9zLm1heDplKX1mdW5jdGlvbiBzKGkpe3ZhciBzPWwoKSxuPXMuX3JnYmE9W107cmV0dXJuIGk9aS50b0xvd2VyQ2FzZSgpLGYoaCxmdW5jdGlvbihlLGEpe3ZhciBvLHI9YS5yZS5leGVjKGkpLGg9ciYmYS5wYXJzZShyKSxsPWEuc3BhY2V8fFwicmdiYVwiO3JldHVybiBoPyhvPXNbbF0oaCksc1t1W2xdLmNhY2hlXT1vW3VbbF0uY2FjaGVdLG49cy5fcmdiYT1vLl9yZ2JhLCExKTp0fSksbi5sZW5ndGg/KFwiMCwwLDAsMFwiPT09bi5qb2luKCkmJmUuZXh0ZW5kKG4sYS50cmFuc3BhcmVudCkscyk6YVtpXX1mdW5jdGlvbiBuKGUsdCxpKXtyZXR1cm4gaT0oaSsxKSUxLDE+NippP2UrNioodC1lKSppOjE+MippP3Q6Mj4zKmk/ZSs2Kih0LWUpKigyLzMtaSk6ZX12YXIgYSxvPVwiYmFja2dyb3VuZENvbG9yIGJvcmRlckJvdHRvbUNvbG9yIGJvcmRlckxlZnRDb2xvciBib3JkZXJSaWdodENvbG9yIGJvcmRlclRvcENvbG9yIGNvbG9yIGNvbHVtblJ1bGVDb2xvciBvdXRsaW5lQ29sb3IgdGV4dERlY29yYXRpb25Db2xvciB0ZXh0RW1waGFzaXNDb2xvclwiLHI9L14oW1xcLStdKT1cXHMqKFxcZCtcXC4/XFxkKikvLGg9W3tyZTovcmdiYT9cXChcXHMqKFxcZHsxLDN9KVxccyosXFxzKihcXGR7MSwzfSlcXHMqLFxccyooXFxkezEsM30pXFxzKig/OixcXHMqKFxcZD8oPzpcXC5cXGQrKT8pXFxzKik/XFwpLyxwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bZVsxXSxlWzJdLGVbM10sZVs0XV19fSx7cmU6L3JnYmE/XFwoXFxzKihcXGQrKD86XFwuXFxkKyk/KVxcJVxccyosXFxzKihcXGQrKD86XFwuXFxkKyk/KVxcJVxccyosXFxzKihcXGQrKD86XFwuXFxkKyk/KVxcJVxccyooPzosXFxzKihcXGQ/KD86XFwuXFxkKyk/KVxccyopP1xcKS8scGFyc2U6ZnVuY3Rpb24oZSl7cmV0dXJuWzIuNTUqZVsxXSwyLjU1KmVbMl0sMi41NSplWzNdLGVbNF1dfX0se3JlOi8jKFthLWYwLTldezJ9KShbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pLyxwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bcGFyc2VJbnQoZVsxXSwxNikscGFyc2VJbnQoZVsyXSwxNikscGFyc2VJbnQoZVszXSwxNildfX0se3JlOi8jKFthLWYwLTldKShbYS1mMC05XSkoW2EtZjAtOV0pLyxwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bcGFyc2VJbnQoZVsxXStlWzFdLDE2KSxwYXJzZUludChlWzJdK2VbMl0sMTYpLHBhcnNlSW50KGVbM10rZVszXSwxNildfX0se3JlOi9oc2xhP1xcKFxccyooXFxkKyg/OlxcLlxcZCspPylcXHMqLFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqLFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqKD86LFxccyooXFxkPyg/OlxcLlxcZCspPylcXHMqKT9cXCkvLHNwYWNlOlwiaHNsYVwiLHBhcnNlOmZ1bmN0aW9uKGUpe3JldHVybltlWzFdLGVbMl0vMTAwLGVbM10vMTAwLGVbNF1dfX1dLGw9ZS5Db2xvcj1mdW5jdGlvbih0LGkscyxuKXtyZXR1cm4gbmV3IGUuQ29sb3IuZm4ucGFyc2UodCxpLHMsbil9LHU9e3JnYmE6e3Byb3BzOntyZWQ6e2lkeDowLHR5cGU6XCJieXRlXCJ9LGdyZWVuOntpZHg6MSx0eXBlOlwiYnl0ZVwifSxibHVlOntpZHg6Mix0eXBlOlwiYnl0ZVwifX19LGhzbGE6e3Byb3BzOntodWU6e2lkeDowLHR5cGU6XCJkZWdyZWVzXCJ9LHNhdHVyYXRpb246e2lkeDoxLHR5cGU6XCJwZXJjZW50XCJ9LGxpZ2h0bmVzczp7aWR4OjIsdHlwZTpcInBlcmNlbnRcIn19fX0sZD17XCJieXRlXCI6e2Zsb29yOiEwLG1heDoyNTV9LHBlcmNlbnQ6e21heDoxfSxkZWdyZWVzOnttb2Q6MzYwLGZsb29yOiEwfX0sYz1sLnN1cHBvcnQ9e30scD1lKFwiPHA+XCIpWzBdLGY9ZS5lYWNoO3Auc3R5bGUuY3NzVGV4dD1cImJhY2tncm91bmQtY29sb3I6cmdiYSgxLDEsMSwuNSlcIixjLnJnYmE9cC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IuaW5kZXhPZihcInJnYmFcIik+LTEsZih1LGZ1bmN0aW9uKGUsdCl7dC5jYWNoZT1cIl9cIitlLHQucHJvcHMuYWxwaGE9e2lkeDozLHR5cGU6XCJwZXJjZW50XCIsZGVmOjF9fSksbC5mbj1lLmV4dGVuZChsLnByb3RvdHlwZSx7cGFyc2U6ZnVuY3Rpb24obixvLHIsaCl7aWYobj09PXQpcmV0dXJuIHRoaXMuX3JnYmE9W251bGwsbnVsbCxudWxsLG51bGxdLHRoaXM7KG4uanF1ZXJ5fHxuLm5vZGVUeXBlKSYmKG49ZShuKS5jc3Mobyksbz10KTt2YXIgZD10aGlzLGM9ZS50eXBlKG4pLHA9dGhpcy5fcmdiYT1bXTtyZXR1cm4gbyE9PXQmJihuPVtuLG8scixoXSxjPVwiYXJyYXlcIiksXCJzdHJpbmdcIj09PWM/dGhpcy5wYXJzZShzKG4pfHxhLl9kZWZhdWx0KTpcImFycmF5XCI9PT1jPyhmKHUucmdiYS5wcm9wcyxmdW5jdGlvbihlLHQpe3BbdC5pZHhdPWkoblt0LmlkeF0sdCl9KSx0aGlzKTpcIm9iamVjdFwiPT09Yz8obiBpbnN0YW5jZW9mIGw/Zih1LGZ1bmN0aW9uKGUsdCl7blt0LmNhY2hlXSYmKGRbdC5jYWNoZV09blt0LmNhY2hlXS5zbGljZSgpKX0pOmYodSxmdW5jdGlvbih0LHMpe3ZhciBhPXMuY2FjaGU7ZihzLnByb3BzLGZ1bmN0aW9uKGUsdCl7aWYoIWRbYV0mJnMudG8pe2lmKFwiYWxwaGFcIj09PWV8fG51bGw9PW5bZV0pcmV0dXJuO2RbYV09cy50byhkLl9yZ2JhKX1kW2FdW3QuaWR4XT1pKG5bZV0sdCwhMCl9KSxkW2FdJiYwPmUuaW5BcnJheShudWxsLGRbYV0uc2xpY2UoMCwzKSkmJihkW2FdWzNdPTEscy5mcm9tJiYoZC5fcmdiYT1zLmZyb20oZFthXSkpKX0pLHRoaXMpOnR9LGlzOmZ1bmN0aW9uKGUpe3ZhciBpPWwoZSkscz0hMCxuPXRoaXM7cmV0dXJuIGYodSxmdW5jdGlvbihlLGEpe3ZhciBvLHI9aVthLmNhY2hlXTtyZXR1cm4gciYmKG89blthLmNhY2hlXXx8YS50byYmYS50byhuLl9yZ2JhKXx8W10sZihhLnByb3BzLGZ1bmN0aW9uKGUsaSl7cmV0dXJuIG51bGwhPXJbaS5pZHhdP3M9cltpLmlkeF09PT1vW2kuaWR4XTp0fSkpLHN9KSxzfSxfc3BhY2U6ZnVuY3Rpb24oKXt2YXIgZT1bXSx0PXRoaXM7cmV0dXJuIGYodSxmdW5jdGlvbihpLHMpe3Rbcy5jYWNoZV0mJmUucHVzaChpKX0pLGUucG9wKCl9LHRyYW5zaXRpb246ZnVuY3Rpb24oZSx0KXt2YXIgcz1sKGUpLG49cy5fc3BhY2UoKSxhPXVbbl0sbz0wPT09dGhpcy5hbHBoYSgpP2woXCJ0cmFuc3BhcmVudFwiKTp0aGlzLHI9b1thLmNhY2hlXXx8YS50byhvLl9yZ2JhKSxoPXIuc2xpY2UoKTtyZXR1cm4gcz1zW2EuY2FjaGVdLGYoYS5wcm9wcyxmdW5jdGlvbihlLG4pe3ZhciBhPW4uaWR4LG89clthXSxsPXNbYV0sdT1kW24udHlwZV18fHt9O251bGwhPT1sJiYobnVsbD09PW8/aFthXT1sOih1Lm1vZCYmKGwtbz51Lm1vZC8yP28rPXUubW9kOm8tbD51Lm1vZC8yJiYoby09dS5tb2QpKSxoW2FdPWkoKGwtbykqdCtvLG4pKSl9KSx0aGlzW25dKGgpfSxibGVuZDpmdW5jdGlvbih0KXtpZigxPT09dGhpcy5fcmdiYVszXSlyZXR1cm4gdGhpczt2YXIgaT10aGlzLl9yZ2JhLnNsaWNlKCkscz1pLnBvcCgpLG49bCh0KS5fcmdiYTtyZXR1cm4gbChlLm1hcChpLGZ1bmN0aW9uKGUsdCl7cmV0dXJuKDEtcykqblt0XStzKmV9KSl9LHRvUmdiYVN0cmluZzpmdW5jdGlvbigpe3ZhciB0PVwicmdiYShcIixpPWUubWFwKHRoaXMuX3JnYmEsZnVuY3Rpb24oZSx0KXtyZXR1cm4gbnVsbD09ZT90PjI/MTowOmV9KTtyZXR1cm4gMT09PWlbM10mJihpLnBvcCgpLHQ9XCJyZ2IoXCIpLHQraS5qb2luKCkrXCIpXCJ9LHRvSHNsYVN0cmluZzpmdW5jdGlvbigpe3ZhciB0PVwiaHNsYShcIixpPWUubWFwKHRoaXMuaHNsYSgpLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGw9PWUmJihlPXQ+Mj8xOjApLHQmJjM+dCYmKGU9TWF0aC5yb3VuZCgxMDAqZSkrXCIlXCIpLGV9KTtyZXR1cm4gMT09PWlbM10mJihpLnBvcCgpLHQ9XCJoc2woXCIpLHQraS5qb2luKCkrXCIpXCJ9LHRvSGV4U3RyaW5nOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuX3JnYmEuc2xpY2UoKSxzPWkucG9wKCk7cmV0dXJuIHQmJmkucHVzaCh+figyNTUqcykpLFwiI1wiK2UubWFwKGksZnVuY3Rpb24oZSl7cmV0dXJuIGU9KGV8fDApLnRvU3RyaW5nKDE2KSwxPT09ZS5sZW5ndGg/XCIwXCIrZTplfSkuam9pbihcIlwiKX0sdG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gMD09PXRoaXMuX3JnYmFbM10/XCJ0cmFuc3BhcmVudFwiOnRoaXMudG9SZ2JhU3RyaW5nKCl9fSksbC5mbi5wYXJzZS5wcm90b3R5cGU9bC5mbix1LmhzbGEudG89ZnVuY3Rpb24oZSl7aWYobnVsbD09ZVswXXx8bnVsbD09ZVsxXXx8bnVsbD09ZVsyXSlyZXR1cm5bbnVsbCxudWxsLG51bGwsZVszXV07dmFyIHQsaSxzPWVbMF0vMjU1LG49ZVsxXS8yNTUsYT1lWzJdLzI1NSxvPWVbM10scj1NYXRoLm1heChzLG4sYSksaD1NYXRoLm1pbihzLG4sYSksbD1yLWgsdT1yK2gsZD0uNSp1O3JldHVybiB0PWg9PT1yPzA6cz09PXI/NjAqKG4tYSkvbCszNjA6bj09PXI/NjAqKGEtcykvbCsxMjA6NjAqKHMtbikvbCsyNDAsaT0wPT09bD8wOi41Pj1kP2wvdTpsLygyLXUpLFtNYXRoLnJvdW5kKHQpJTM2MCxpLGQsbnVsbD09bz8xOm9dfSx1LmhzbGEuZnJvbT1mdW5jdGlvbihlKXtpZihudWxsPT1lWzBdfHxudWxsPT1lWzFdfHxudWxsPT1lWzJdKXJldHVybltudWxsLG51bGwsbnVsbCxlWzNdXTt2YXIgdD1lWzBdLzM2MCxpPWVbMV0scz1lWzJdLGE9ZVszXSxvPS41Pj1zP3MqKDEraSk6cytpLXMqaSxyPTIqcy1vO3JldHVybltNYXRoLnJvdW5kKDI1NSpuKHIsbyx0KzEvMykpLE1hdGgucm91bmQoMjU1Km4ocixvLHQpKSxNYXRoLnJvdW5kKDI1NSpuKHIsbyx0LTEvMykpLGFdfSxmKHUsZnVuY3Rpb24ocyxuKXt2YXIgYT1uLnByb3BzLG89bi5jYWNoZSxoPW4udG8sdT1uLmZyb207bC5mbltzXT1mdW5jdGlvbihzKXtpZihoJiYhdGhpc1tvXSYmKHRoaXNbb109aCh0aGlzLl9yZ2JhKSkscz09PXQpcmV0dXJuIHRoaXNbb10uc2xpY2UoKTt2YXIgbixyPWUudHlwZShzKSxkPVwiYXJyYXlcIj09PXJ8fFwib2JqZWN0XCI9PT1yP3M6YXJndW1lbnRzLGM9dGhpc1tvXS5zbGljZSgpO3JldHVybiBmKGEsZnVuY3Rpb24oZSx0KXt2YXIgcz1kW1wib2JqZWN0XCI9PT1yP2U6dC5pZHhdO251bGw9PXMmJihzPWNbdC5pZHhdKSxjW3QuaWR4XT1pKHMsdCl9KSx1PyhuPWwodShjKSksbltvXT1jLG4pOmwoYyl9LGYoYSxmdW5jdGlvbih0LGkpe2wuZm5bdF18fChsLmZuW3RdPWZ1bmN0aW9uKG4pe3ZhciBhLG89ZS50eXBlKG4pLGg9XCJhbHBoYVwiPT09dD90aGlzLl9oc2xhP1wiaHNsYVwiOlwicmdiYVwiOnMsbD10aGlzW2hdKCksdT1sW2kuaWR4XTtyZXR1cm5cInVuZGVmaW5lZFwiPT09bz91OihcImZ1bmN0aW9uXCI9PT1vJiYobj1uLmNhbGwodGhpcyx1KSxvPWUudHlwZShuKSksbnVsbD09biYmaS5lbXB0eT90aGlzOihcInN0cmluZ1wiPT09byYmKGE9ci5leGVjKG4pLGEmJihuPXUrcGFyc2VGbG9hdChhWzJdKSooXCIrXCI9PT1hWzFdPzE6LTEpKSksbFtpLmlkeF09bix0aGlzW2hdKGwpKSl9KX0pfSksbC5ob29rPWZ1bmN0aW9uKHQpe3ZhciBpPXQuc3BsaXQoXCIgXCIpO2YoaSxmdW5jdGlvbih0LGkpe2UuY3NzSG9va3NbaV09e3NldDpmdW5jdGlvbih0LG4pe3ZhciBhLG8scj1cIlwiO2lmKFwidHJhbnNwYXJlbnRcIiE9PW4mJihcInN0cmluZ1wiIT09ZS50eXBlKG4pfHwoYT1zKG4pKSkpe2lmKG49bChhfHxuKSwhYy5yZ2JhJiYxIT09bi5fcmdiYVszXSl7Zm9yKG89XCJiYWNrZ3JvdW5kQ29sb3JcIj09PWk/dC5wYXJlbnROb2RlOnQ7KFwiXCI9PT1yfHxcInRyYW5zcGFyZW50XCI9PT1yKSYmbyYmby5zdHlsZTspdHJ5e3I9ZS5jc3MobyxcImJhY2tncm91bmRDb2xvclwiKSxvPW8ucGFyZW50Tm9kZX1jYXRjaChoKXt9bj1uLmJsZW5kKHImJlwidHJhbnNwYXJlbnRcIiE9PXI/cjpcIl9kZWZhdWx0XCIpfW49bi50b1JnYmFTdHJpbmcoKX10cnl7dC5zdHlsZVtpXT1ufWNhdGNoKGgpe319fSxlLmZ4LnN0ZXBbaV09ZnVuY3Rpb24odCl7dC5jb2xvckluaXR8fCh0LnN0YXJ0PWwodC5lbGVtLGkpLHQuZW5kPWwodC5lbmQpLHQuY29sb3JJbml0PSEwKSxlLmNzc0hvb2tzW2ldLnNldCh0LmVsZW0sdC5zdGFydC50cmFuc2l0aW9uKHQuZW5kLHQucG9zKSl9fSl9LGwuaG9vayhvKSxlLmNzc0hvb2tzLmJvcmRlckNvbG9yPXtleHBhbmQ6ZnVuY3Rpb24oZSl7dmFyIHQ9e307cmV0dXJuIGYoW1wiVG9wXCIsXCJSaWdodFwiLFwiQm90dG9tXCIsXCJMZWZ0XCJdLGZ1bmN0aW9uKGkscyl7dFtcImJvcmRlclwiK3MrXCJDb2xvclwiXT1lfSksdH19LGE9ZS5Db2xvci5uYW1lcz17YXF1YTpcIiMwMGZmZmZcIixibGFjazpcIiMwMDAwMDBcIixibHVlOlwiIzAwMDBmZlwiLGZ1Y2hzaWE6XCIjZmYwMGZmXCIsZ3JheTpcIiM4MDgwODBcIixncmVlbjpcIiMwMDgwMDBcIixsaW1lOlwiIzAwZmYwMFwiLG1hcm9vbjpcIiM4MDAwMDBcIixuYXZ5OlwiIzAwMDA4MFwiLG9saXZlOlwiIzgwODAwMFwiLHB1cnBsZTpcIiM4MDAwODBcIixyZWQ6XCIjZmYwMDAwXCIsc2lsdmVyOlwiI2MwYzBjMFwiLHRlYWw6XCIjMDA4MDgwXCIsd2hpdGU6XCIjZmZmZmZmXCIseWVsbG93OlwiI2ZmZmYwMFwiLHRyYW5zcGFyZW50OltudWxsLG51bGwsbnVsbCwwXSxfZGVmYXVsdDpcIiNmZmZmZmZcIn19KHIpLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXt2YXIgaSxzLG49dC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3P3Qub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHQsbnVsbCk6dC5jdXJyZW50U3R5bGUsYT17fTtpZihuJiZuLmxlbmd0aCYmblswXSYmbltuWzBdXSlmb3Iocz1uLmxlbmd0aDtzLS07KWk9bltzXSxcInN0cmluZ1wiPT10eXBlb2YgbltpXSYmKGFbZS5jYW1lbENhc2UoaSldPW5baV0pO2Vsc2UgZm9yKGkgaW4gbilcInN0cmluZ1wiPT10eXBlb2YgbltpXSYmKGFbaV09bltpXSk7cmV0dXJuIGF9ZnVuY3Rpb24gaSh0LGkpe3ZhciBzLGEsbz17fTtmb3IocyBpbiBpKWE9aVtzXSx0W3NdIT09YSYmKG5bc118fChlLmZ4LnN0ZXBbc118fCFpc05hTihwYXJzZUZsb2F0KGEpKSkmJihvW3NdPWEpKTtyZXR1cm4gb312YXIgcz1bXCJhZGRcIixcInJlbW92ZVwiLFwidG9nZ2xlXCJdLG49e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2UuZWFjaChbXCJib3JkZXJMZWZ0U3R5bGVcIixcImJvcmRlclJpZ2h0U3R5bGVcIixcImJvcmRlckJvdHRvbVN0eWxlXCIsXCJib3JkZXJUb3BTdHlsZVwiXSxmdW5jdGlvbih0LGkpe2UuZnguc3RlcFtpXT1mdW5jdGlvbihlKXsoXCJub25lXCIhPT1lLmVuZCYmIWUuc2V0QXR0cnx8MT09PWUucG9zJiYhZS5zZXRBdHRyKSYmKHIuc3R5bGUoZS5lbGVtLGksZS5lbmQpLGUuc2V0QXR0cj0hMCl9fSksZS5mbi5hZGRCYWNrfHwoZS5mbi5hZGRCYWNrPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmFkZChudWxsPT1lP3RoaXMucHJldk9iamVjdDp0aGlzLnByZXZPYmplY3QuZmlsdGVyKGUpKX0pLGUuZWZmZWN0cy5hbmltYXRlQ2xhc3M9ZnVuY3Rpb24obixhLG8scil7dmFyIGg9ZS5zcGVlZChhLG8scik7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYSxvPWUodGhpcykscj1vLmF0dHIoXCJjbGFzc1wiKXx8XCJcIixsPWguY2hpbGRyZW4/by5maW5kKFwiKlwiKS5hZGRCYWNrKCk6bztsPWwubWFwKGZ1bmN0aW9uKCl7dmFyIGk9ZSh0aGlzKTtyZXR1cm57ZWw6aSxzdGFydDp0KHRoaXMpfX0pLGE9ZnVuY3Rpb24oKXtlLmVhY2gocyxmdW5jdGlvbihlLHQpe25bdF0mJm9bdCtcIkNsYXNzXCJdKG5bdF0pfSl9LGEoKSxsPWwubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZW5kPXQodGhpcy5lbFswXSksdGhpcy5kaWZmPWkodGhpcy5zdGFydCx0aGlzLmVuZCksdGhpc30pLG8uYXR0cihcImNsYXNzXCIsciksbD1sLm1hcChmdW5jdGlvbigpe3ZhciB0PXRoaXMsaT1lLkRlZmVycmVkKCkscz1lLmV4dGVuZCh7fSxoLHtxdWV1ZTohMSxjb21wbGV0ZTpmdW5jdGlvbigpe2kucmVzb2x2ZSh0KX19KTtyZXR1cm4gdGhpcy5lbC5hbmltYXRlKHRoaXMuZGlmZixzKSxpLnByb21pc2UoKX0pLGUud2hlbi5hcHBseShlLGwuZ2V0KCkpLmRvbmUoZnVuY3Rpb24oKXthKCksZS5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbigpe3ZhciB0PXRoaXMuZWw7ZS5lYWNoKHRoaXMuZGlmZixmdW5jdGlvbihlKXt0LmNzcyhlLFwiXCIpfSl9KSxoLmNvbXBsZXRlLmNhbGwob1swXSl9KX0pfSxlLmZuLmV4dGVuZCh7YWRkQ2xhc3M6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkscyxuLGEpe3JldHVybiBzP2UuZWZmZWN0cy5hbmltYXRlQ2xhc3MuY2FsbCh0aGlzLHthZGQ6aX0scyxuLGEpOnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oZS5mbi5hZGRDbGFzcykscmVtb3ZlQ2xhc3M6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkscyxuLGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjE/ZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMse3JlbW92ZTppfSxzLG4sYSk6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fShlLmZuLnJlbW92ZUNsYXNzKSx0b2dnbGVDbGFzczpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSxzLG4sYSxvKXtyZXR1cm5cImJvb2xlYW5cIj09dHlwZW9mIHN8fHZvaWQgMD09PXM/bj9lLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyxzP3thZGQ6aX06e3JlbW92ZTppfSxuLGEsbyk6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMse3RvZ2dsZTppfSxzLG4sYSl9fShlLmZuLnRvZ2dsZUNsYXNzKSxzd2l0Y2hDbGFzczpmdW5jdGlvbih0LGkscyxuLGEpe3JldHVybiBlLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyx7YWRkOmkscmVtb3ZlOnR9LHMsbixhKX19KX0oKSxmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxpLHMsbil7cmV0dXJuIGUuaXNQbGFpbk9iamVjdCh0KSYmKGk9dCx0PXQuZWZmZWN0KSx0PXtlZmZlY3Q6dH0sbnVsbD09aSYmKGk9e30pLGUuaXNGdW5jdGlvbihpKSYmKG49aSxzPW51bGwsaT17fSksKFwibnVtYmVyXCI9PXR5cGVvZiBpfHxlLmZ4LnNwZWVkc1tpXSkmJihuPXMscz1pLGk9e30pLGUuaXNGdW5jdGlvbihzKSYmKG49cyxzPW51bGwpLGkmJmUuZXh0ZW5kKHQsaSkscz1zfHxpLmR1cmF0aW9uLHQuZHVyYXRpb249ZS5meC5vZmY/MDpcIm51bWJlclwiPT10eXBlb2Ygcz9zOnMgaW4gZS5meC5zcGVlZHM/ZS5meC5zcGVlZHNbc106ZS5meC5zcGVlZHMuX2RlZmF1bHQsdC5jb21wbGV0ZT1ufHxpLmNvbXBsZXRlLHR9ZnVuY3Rpb24gaSh0KXtyZXR1cm4hdHx8XCJudW1iZXJcIj09dHlwZW9mIHR8fGUuZnguc3BlZWRzW3RdPyEwOlwic3RyaW5nXCIhPXR5cGVvZiB0fHxlLmVmZmVjdHMuZWZmZWN0W3RdP2UuaXNGdW5jdGlvbih0KT8hMDpcIm9iamVjdFwiIT10eXBlb2YgdHx8dC5lZmZlY3Q/ITE6ITA6ITB9ZS5leHRlbmQoZS5lZmZlY3RzLHt2ZXJzaW9uOlwiMS4xMS40XCIsc2F2ZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgaT0wO3QubGVuZ3RoPmk7aSsrKW51bGwhPT10W2ldJiZlLmRhdGEobyt0W2ldLGVbMF0uc3R5bGVbdFtpXV0pfSxyZXN0b3JlOmZ1bmN0aW9uKGUsdCl7dmFyIGkscztmb3Iocz0wO3QubGVuZ3RoPnM7cysrKW51bGwhPT10W3NdJiYoaT1lLmRhdGEobyt0W3NdKSx2b2lkIDA9PT1pJiYoaT1cIlwiKSxlLmNzcyh0W3NdLGkpKX0sc2V0TW9kZTpmdW5jdGlvbihlLHQpe3JldHVyblwidG9nZ2xlXCI9PT10JiYodD1lLmlzKFwiOmhpZGRlblwiKT9cInNob3dcIjpcImhpZGVcIiksdH0sZ2V0QmFzZWxpbmU6ZnVuY3Rpb24oZSx0KXt2YXIgaSxzO3N3aXRjaChlWzBdKXtjYXNlXCJ0b3BcIjppPTA7YnJlYWs7Y2FzZVwibWlkZGxlXCI6aT0uNTticmVhaztjYXNlXCJib3R0b21cIjppPTE7YnJlYWs7ZGVmYXVsdDppPWVbMF0vdC5oZWlnaHR9c3dpdGNoKGVbMV0pe2Nhc2VcImxlZnRcIjpzPTA7YnJlYWs7Y2FzZVwiY2VudGVyXCI6cz0uNTticmVhaztjYXNlXCJyaWdodFwiOnM9MTticmVhaztkZWZhdWx0OnM9ZVsxXS90LndpZHRofXJldHVybnt4OnMseTppfX0sY3JlYXRlV3JhcHBlcjpmdW5jdGlvbih0KXtpZih0LnBhcmVudCgpLmlzKFwiLnVpLWVmZmVjdHMtd3JhcHBlclwiKSlyZXR1cm4gdC5wYXJlbnQoKTt2YXIgaT17d2lkdGg6dC5vdXRlcldpZHRoKCEwKSxoZWlnaHQ6dC5vdXRlckhlaWdodCghMCksXCJmbG9hdFwiOnQuY3NzKFwiZmxvYXRcIil9LHM9ZShcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwidWktZWZmZWN0cy13cmFwcGVyXCIpLmNzcyh7Zm9udFNpemU6XCIxMDAlXCIsYmFja2dyb3VuZDpcInRyYW5zcGFyZW50XCIsYm9yZGVyOlwibm9uZVwiLG1hcmdpbjowLHBhZGRpbmc6MH0pLG49e3dpZHRoOnQud2lkdGgoKSxoZWlnaHQ6dC5oZWlnaHQoKX0sYT1kb2N1bWVudC5hY3RpdmVFbGVtZW50O3RyeXthLmlkfWNhdGNoKG8pe2E9ZG9jdW1lbnQuYm9keX1yZXR1cm4gdC53cmFwKHMpLCh0WzBdPT09YXx8ZS5jb250YWlucyh0WzBdLGEpKSYmZShhKS5mb2N1cygpLHM9dC5wYXJlbnQoKSxcInN0YXRpY1wiPT09dC5jc3MoXCJwb3NpdGlvblwiKT8ocy5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIn0pLHQuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCJ9KSk6KGUuZXh0ZW5kKGkse3Bvc2l0aW9uOnQuY3NzKFwicG9zaXRpb25cIiksekluZGV4OnQuY3NzKFwiei1pbmRleFwiKX0pLGUuZWFjaChbXCJ0b3BcIixcImxlZnRcIixcImJvdHRvbVwiLFwicmlnaHRcIl0sZnVuY3Rpb24oZSxzKXtpW3NdPXQuY3NzKHMpLGlzTmFOKHBhcnNlSW50KGlbc10sMTApKSYmKGlbc109XCJhdXRvXCIpfSksdC5jc3Moe3Bvc2l0aW9uOlwicmVsYXRpdmVcIix0b3A6MCxsZWZ0OjAscmlnaHQ6XCJhdXRvXCIsYm90dG9tOlwiYXV0b1wifSkpLHQuY3NzKG4pLHMuY3NzKGkpLnNob3coKX0scmVtb3ZlV3JhcHBlcjpmdW5jdGlvbih0KXt2YXIgaT1kb2N1bWVudC5hY3RpdmVFbGVtZW50O3JldHVybiB0LnBhcmVudCgpLmlzKFwiLnVpLWVmZmVjdHMtd3JhcHBlclwiKSYmKHQucGFyZW50KCkucmVwbGFjZVdpdGgodCksKHRbMF09PT1pfHxlLmNvbnRhaW5zKHRbMF0saSkpJiZlKGkpLmZvY3VzKCkpLHR9LHNldFRyYW5zaXRpb246ZnVuY3Rpb24odCxpLHMsbil7cmV0dXJuIG49bnx8e30sZS5lYWNoKGksZnVuY3Rpb24oZSxpKXt2YXIgYT10LmNzc1VuaXQoaSk7YVswXT4wJiYobltpXT1hWzBdKnMrYVsxXSl9KSxufX0pLGUuZm4uZXh0ZW5kKHtlZmZlY3Q6ZnVuY3Rpb24oKXtmdW5jdGlvbiBpKHQpe2Z1bmN0aW9uIGkoKXtlLmlzRnVuY3Rpb24oYSkmJmEuY2FsbChuWzBdKSxlLmlzRnVuY3Rpb24odCkmJnQoKX12YXIgbj1lKHRoaXMpLGE9cy5jb21wbGV0ZSxyPXMubW9kZTsobi5pcyhcIjpoaWRkZW5cIik/XCJoaWRlXCI9PT1yOlwic2hvd1wiPT09cik/KG5bcl0oKSxpKCkpOm8uY2FsbChuWzBdLHMsaSl9dmFyIHM9dC5hcHBseSh0aGlzLGFyZ3VtZW50cyksbj1zLm1vZGUsYT1zLnF1ZXVlLG89ZS5lZmZlY3RzLmVmZmVjdFtzLmVmZmVjdF07cmV0dXJuIGUuZngub2ZmfHwhbz9uP3RoaXNbbl0ocy5kdXJhdGlvbixzLmNvbXBsZXRlKTp0aGlzLmVhY2goZnVuY3Rpb24oKXtzLmNvbXBsZXRlJiZzLmNvbXBsZXRlLmNhbGwodGhpcyl9KTphPT09ITE/dGhpcy5lYWNoKGkpOnRoaXMucXVldWUoYXx8XCJmeFwiLGkpfSxzaG93OmZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbihzKXtpZihpKHMpKXJldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgbj10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbi5tb2RlPVwic2hvd1wiLHRoaXMuZWZmZWN0LmNhbGwodGhpcyxuKX19KGUuZm4uc2hvdyksaGlkZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24ocyl7aWYoaShzKSlyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIG4ubW9kZT1cImhpZGVcIix0aGlzLmVmZmVjdC5jYWxsKHRoaXMsbil9fShlLmZuLmhpZGUpLHRvZ2dsZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24ocyl7aWYoaShzKXx8XCJib29sZWFuXCI9PXR5cGVvZiBzKXJldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgbj10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbi5tb2RlPVwidG9nZ2xlXCIsdGhpcy5lZmZlY3QuY2FsbCh0aGlzLG4pfX0oZS5mbi50b2dnbGUpLGNzc1VuaXQ6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5jc3ModCkscz1bXTtyZXR1cm4gZS5lYWNoKFtcImVtXCIsXCJweFwiLFwiJVwiLFwicHRcIl0sZnVuY3Rpb24oZSx0KXtpLmluZGV4T2YodCk+MCYmKHM9W3BhcnNlRmxvYXQoaSksdF0pfSksc319KX0oKSxmdW5jdGlvbigpe3ZhciB0PXt9O2UuZWFjaChbXCJRdWFkXCIsXCJDdWJpY1wiLFwiUXVhcnRcIixcIlF1aW50XCIsXCJFeHBvXCJdLGZ1bmN0aW9uKGUsaSl7dFtpXT1mdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5wb3codCxlKzIpfX0pLGUuZXh0ZW5kKHQse1NpbmU6ZnVuY3Rpb24oZSl7cmV0dXJuIDEtTWF0aC5jb3MoZSpNYXRoLlBJLzIpfSxDaXJjOmZ1bmN0aW9uKGUpe3JldHVybiAxLU1hdGguc3FydCgxLWUqZSl9LEVsYXN0aWM6ZnVuY3Rpb24oZSl7cmV0dXJuIDA9PT1lfHwxPT09ZT9lOi1NYXRoLnBvdygyLDgqKGUtMSkpKk1hdGguc2luKCg4MCooZS0xKS03LjUpKk1hdGguUEkvMTUpfSxCYWNrOmZ1bmN0aW9uKGUpe3JldHVybiBlKmUqKDMqZS0yKX0sQm91bmNlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxpPTQ7KCh0PU1hdGgucG93KDIsLS1pKSktMSkvMTE+ZTspO3JldHVybiAxL01hdGgucG93KDQsMy1pKS03LjU2MjUqTWF0aC5wb3coKDMqdC0yKS8yMi1lLDIpfX0pLGUuZWFjaCh0LGZ1bmN0aW9uKHQsaSl7ZS5lYXNpbmdbXCJlYXNlSW5cIit0XT1pLGUuZWFzaW5nW1wiZWFzZU91dFwiK3RdPWZ1bmN0aW9uKGUpe3JldHVybiAxLWkoMS1lKX0sZS5lYXNpbmdbXCJlYXNlSW5PdXRcIit0XT1mdW5jdGlvbihlKXtyZXR1cm4uNT5lP2koMiplKS8yOjEtaSgtMiplKzIpLzJ9fSl9KCksZS5lZmZlY3RzfSk7XG4iLCIvKiFcbiAqIGpRdWVyeSBVSSBUb3VjaCBQdW5jaCAwLjIuM1xuICpcbiAqIENvcHlyaWdodCAyMDEx4oCTMjAxNCwgRGF2ZSBGdXJmZXJvXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy5cbiAqXG4gKiBEZXBlbmRzOlxuICogIGpxdWVyeS51aS53aWRnZXQuanNcbiAqICBqcXVlcnkudWkubW91c2UuanNcbiAqL1xuIWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGYoYSxiKXtpZighKGEub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aD4xKSl7YS5wcmV2ZW50RGVmYXVsdCgpO3ZhciBjPWEub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSxkPWRvY3VtZW50LmNyZWF0ZUV2ZW50KFwiTW91c2VFdmVudHNcIik7ZC5pbml0TW91c2VFdmVudChiLCEwLCEwLHdpbmRvdywxLGMuc2NyZWVuWCxjLnNjcmVlblksYy5jbGllbnRYLGMuY2xpZW50WSwhMSwhMSwhMSwhMSwwLG51bGwpLGEudGFyZ2V0LmRpc3BhdGNoRXZlbnQoZCl9fWlmKGEuc3VwcG9ydC50b3VjaD1cIm9udG91Y2hlbmRcImluIGRvY3VtZW50LGEuc3VwcG9ydC50b3VjaCl7dmFyIGUsYj1hLnVpLm1vdXNlLnByb3RvdHlwZSxjPWIuX21vdXNlSW5pdCxkPWIuX21vdXNlRGVzdHJveTtiLl90b3VjaFN0YXJ0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7IWUmJmIuX21vdXNlQ2FwdHVyZShhLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0pJiYoZT0hMCxiLl90b3VjaE1vdmVkPSExLGYoYSxcIm1vdXNlb3ZlclwiKSxmKGEsXCJtb3VzZW1vdmVcIiksZihhLFwibW91c2Vkb3duXCIpKX0sYi5fdG91Y2hNb3ZlPWZ1bmN0aW9uKGEpe2UmJih0aGlzLl90b3VjaE1vdmVkPSEwLGYoYSxcIm1vdXNlbW92ZVwiKSl9LGIuX3RvdWNoRW5kPWZ1bmN0aW9uKGEpe2UmJihmKGEsXCJtb3VzZXVwXCIpLGYoYSxcIm1vdXNlb3V0XCIpLHRoaXMuX3RvdWNoTW92ZWR8fGYoYSxcImNsaWNrXCIpLGU9ITEpfSxiLl9tb3VzZUluaXQ9ZnVuY3Rpb24oKXt2YXIgYj10aGlzO2IuZWxlbWVudC5iaW5kKHt0b3VjaHN0YXJ0OmEucHJveHkoYixcIl90b3VjaFN0YXJ0XCIpLHRvdWNobW92ZTphLnByb3h5KGIsXCJfdG91Y2hNb3ZlXCIpLHRvdWNoZW5kOmEucHJveHkoYixcIl90b3VjaEVuZFwiKX0pLGMuY2FsbChiKX0sYi5fbW91c2VEZXN0cm95PWZ1bmN0aW9uKCl7dmFyIGI9dGhpcztiLmVsZW1lbnQudW5iaW5kKHt0b3VjaHN0YXJ0OmEucHJveHkoYixcIl90b3VjaFN0YXJ0XCIpLHRvdWNobW92ZTphLnByb3h5KGIsXCJfdG91Y2hNb3ZlXCIpLHRvdWNoZW5kOmEucHJveHkoYixcIl90b3VjaEVuZFwiKX0pLGQuY2FsbChiKX19fShqUXVlcnkpO1xuIiwiLypcbiAqIGpRdWVyeSBVSSBOZXN0ZWQgU29ydGFibGVcbiAqIHYgMi4wIC8gMjkgb2N0IDIwMTJcbiAqIGh0dHA6Ly9tanNhcmZhdHRpLmNvbS9zYW5kYm94L25lc3RlZFNvcnRhYmxlXG4gKlxuICogRGVwZW5kcyBvbjpcbiAqIGpxdWVyeS51aS5zb3J0YWJsZS5qcyAxLjEwK1xuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDEzIE1hbnVlbGUgSiBTYXJmYXR0aVxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlXG4gKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICovXG5cbihmdW5jdGlvbigkKSB7XG5cbiAgICBmdW5jdGlvbiBpc092ZXJBeGlzKCB4LCByZWZlcmVuY2UsIHNpemUgKSB7XG4gICAgICAgIHJldHVybiAoIHggPiByZWZlcmVuY2UgKSAmJiAoIHggPCAoIHJlZmVyZW5jZSArIHNpemUgKSApO1xuICAgIH1cblxuICAgICQud2lkZ2V0KFwibWpzLm5lc3RlZFNvcnRhYmxlXCIsICQuZXh0ZW5kKHt9LCAkLnVpLnNvcnRhYmxlLnByb3RvdHlwZSwge1xuXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIGRvTm90Q2xlYXI6IGZhbHNlLFxuICAgICAgICAgICAgZXhwYW5kT25Ib3ZlcjogNzAwLFxuICAgICAgICAgICAgaXNBbGxvd2VkOiBmdW5jdGlvbihwbGFjZWhvbGRlciwgcGxhY2Vob2xkZXJQYXJlbnQsIG9yaWdpbmFsSXRlbSkgeyByZXR1cm4gdHJ1ZTsgfSxcbiAgICAgICAgICAgIGlzVHJlZTogZmFsc2UsXG4gICAgICAgICAgICBsaXN0VHlwZTogJ29sJyxcbiAgICAgICAgICAgIG1heExldmVsczogMCxcbiAgICAgICAgICAgIHByb3RlY3RSb290OiBmYWxzZSxcbiAgICAgICAgICAgIHJvb3RJRDogbnVsbCxcbiAgICAgICAgICAgIHJ0bDogZmFsc2UsXG4gICAgICAgICAgICBzdGFydENvbGxhcHNlZDogZmFsc2UsXG4gICAgICAgICAgICB0YWJTaXplOiAyMCxcblxuICAgICAgICAgICAgYnJhbmNoQ2xhc3M6ICdtanMtbmVzdGVkU29ydGFibGUtYnJhbmNoJyxcbiAgICAgICAgICAgIGNvbGxhcHNlZENsYXNzOiAnbWpzLW5lc3RlZFNvcnRhYmxlLWNvbGxhcHNlZCcsXG4gICAgICAgICAgICBkaXNhYmxlTmVzdGluZ0NsYXNzOiAnbWpzLW5lc3RlZFNvcnRhYmxlLW5vLW5lc3RpbmcnLFxuICAgICAgICAgICAgZXJyb3JDbGFzczogJ21qcy1uZXN0ZWRTb3J0YWJsZS1lcnJvcicsXG4gICAgICAgICAgICBleHBhbmRlZENsYXNzOiAnbWpzLW5lc3RlZFNvcnRhYmxlLWV4cGFuZGVkJyxcbiAgICAgICAgICAgIGhvdmVyaW5nQ2xhc3M6ICdtanMtbmVzdGVkU29ydGFibGUtaG92ZXJpbmcnLFxuICAgICAgICAgICAgbGVhZkNsYXNzOiAnbWpzLW5lc3RlZFNvcnRhYmxlLWxlYWYnXG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZGF0YSgndWktc29ydGFibGUnLCB0aGlzLmVsZW1lbnQuZGF0YSgnbWpzLW5lc3RlZFNvcnRhYmxlJykpO1xuXG4gICAgICAgICAgICAvLyBtanMgLSBwcmV2ZW50IGJyb3dzZXIgZnJvbSBmcmVlemluZyBpZiB0aGUgSFRNTCBpcyBub3QgY29ycmVjdFxuICAgICAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnQuaXModGhpcy5vcHRpb25zLmxpc3RUeXBlKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25lc3RlZFNvcnRhYmxlOiBQbGVhc2UgY2hlY2sgdGhhdCB0aGUgbGlzdFR5cGUgb3B0aW9uIGlzIHNldCB0byB5b3VyIGFjdHVhbCBsaXN0IHR5cGUnKTtcblxuICAgICAgICAgICAgLy8gbWpzIC0gZm9yY2UgJ2ludGVyc2VjdCcgdG9sZXJhbmNlIG1ldGhvZCBpZiB3ZSBoYXZlIGEgdHJlZSB3aXRoIGV4cGFuZGluZy9jb2xsYXBzaW5nIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaXNUcmVlICYmIHRoaXMub3B0aW9ucy5leHBhbmRPbkhvdmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSA9ICdpbnRlcnNlY3QnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLnVpLnNvcnRhYmxlLnByb3RvdHlwZS5fY3JlYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgICAgIC8vIG1qcyAtIHByZXBhcmUgdGhlIHRyZWUgYnkgYXBwbHlpbmcgdGhlIHJpZ2h0IGNsYXNzZXMgKHRoZSBDU1MgaXMgcmVzcG9uc2libGUgZm9yIGFjdHVhbCBoaWRlL3Nob3cgZnVuY3Rpb25hbGl0eSlcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaXNUcmVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgICQodGhpcy5pdGVtcykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRsaSA9IHRoaXMuaXRlbTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRsaS5jaGlsZHJlbihzZWxmLm9wdGlvbnMubGlzdFR5cGUpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxpLmFkZENsYXNzKHNlbGYub3B0aW9ucy5icmFuY2hDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBleHBhbmQvY29sbGFwc2UgY2xhc3Mgb25seSBpZiB0aGV5IGhhdmUgY2hpbGRyZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuc3RhcnRDb2xsYXBzZWQpICRsaS5hZGRDbGFzcyhzZWxmLm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAkbGkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLmV4cGFuZGVkQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxpLmFkZENsYXNzKHNlbGYub3B0aW9ucy5sZWFmQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAucmVtb3ZlRGF0YShcIm1qcy1uZXN0ZWRTb3J0YWJsZVwiKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVEYXRhKFwidWktc29ydGFibGVcIik7XG4gICAgICAgICAgICByZXR1cm4gJC51aS5zb3J0YWJsZS5wcm90b3R5cGUuX2Rlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfbW91c2VEcmFnOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyIGksIGl0ZW0sIGl0ZW1FbGVtZW50LCBpbnRlcnNlY3Rpb24sXG4gICAgICAgICAgICAgICAgbyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBzY3JvbGxlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvL0NvbXB1dGUgdGhlIGhlbHBlcnMgcG9zaXRpb25cbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25BYnMgPSB0aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMubGFzdFBvc2l0aW9uQWJzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0UG9zaXRpb25BYnMgPSB0aGlzLnBvc2l0aW9uQWJzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL0RvIHNjcm9sbGluZ1xuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNjcm9sbCkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9IGRvY3VtZW50ICYmIHRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUgIT0gJ0hUTUwnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoKHRoaXMub3ZlcmZsb3dPZmZzZXQudG9wICsgdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0KSAtIGV2ZW50LnBhZ2VZIDwgby5zY3JvbGxTZW5zaXRpdml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wID0gc2Nyb2xsZWQgPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgKyBvLnNjcm9sbFNwZWVkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoZXZlbnQucGFnZVkgLSB0aGlzLm92ZXJmbG93T2Zmc2V0LnRvcCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCA9IHNjcm9sbGVkID0gdGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wIC0gby5zY3JvbGxTcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKCh0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQgKyB0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aCkgLSBldmVudC5wYWdlWCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgPSBzY3JvbGxlZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgKyBvLnNjcm9sbFNwZWVkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoZXZlbnQucGFnZVggLSB0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQgPCBvLnNjcm9sbFNlbnNpdGl2aXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSB0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0IC0gby5zY3JvbGxTcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBpZihldmVudC5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIDwgby5zY3JvbGxTZW5zaXRpdml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgLSBvLnNjcm9sbFNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCQod2luZG93KS5oZWlnaHQoKSAtIChldmVudC5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpICsgby5zY3JvbGxTcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihldmVudC5wYWdlWCAtICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgLSBvLnNjcm9sbFNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCQod2luZG93KS53aWR0aCgpIC0gKGV2ZW50LnBhZ2VYIC0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgKyBvLnNjcm9sbFNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoc2Nyb2xsZWQgIT09IGZhbHNlICYmICQudWkuZGRtYW5hZ2VyICYmICFvLmRyb3BCZWhhdmlvdXIpXG4gICAgICAgICAgICAgICAgICAgICQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9SZWdlbmVyYXRlIHRoZSBhYnNvbHV0ZSBwb3NpdGlvbiB1c2VkIGZvciBwb3NpdGlvbiBjaGVja3NcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb25BYnMgPSB0aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpO1xuXG4gICAgICAgICAgICAvLyBtanMgLSBmaW5kIHRoZSB0b3Agb2Zmc2V0IGJlZm9yZSByZWFycmFuZ2VtZW50LFxuICAgICAgICAgICAgdmFyIHByZXZpb3VzVG9wT2Zmc2V0ID0gdGhpcy5wbGFjZWhvbGRlci5vZmZzZXQoKS50b3A7XG5cbiAgICAgICAgICAgIC8vU2V0IHRoZSBoZWxwZXIgcG9zaXRpb25cbiAgICAgICAgICAgIGlmKCF0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLm9wdGlvbnMuYXhpcyAhPT0gXCJ5XCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlbHBlclswXS5zdHlsZS5sZWZ0ID0gdGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCF0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLm9wdGlvbnMuYXhpcyAhPT0gXCJ4XCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlbHBlclswXS5zdHlsZS50b3AgPSB0aGlzLnBvc2l0aW9uLnRvcCtcInB4XCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG1qcyAtIGNoZWNrIGFuZCByZXNldCBob3ZlcmluZyBzdGF0ZSBhdCBlYWNoIGN5Y2xlXG4gICAgICAgICAgICB0aGlzLmhvdmVyaW5nID0gdGhpcy5ob3ZlcmluZyA/IHRoaXMuaG92ZXJpbmcgOiBudWxsO1xuICAgICAgICAgICAgdGhpcy5tb3VzZWVudGVyZWQgPSB0aGlzLm1vdXNlZW50ZXJlZCA/IHRoaXMubW91c2VlbnRlcmVkIDogZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIG1qcyAtIGxldCdzIHN0YXJ0IGNhY2hpbmcgc29tZSB2YXJpYWJsZXNcbiAgICAgICAgICAgIHZhciBwYXJlbnRJdGVtID0gKHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnBhcmVudE5vZGUpLmNsb3Nlc3QoJy51aS1zb3J0YWJsZScpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAkKHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgbGV2ZWwgPSB0aGlzLl9nZXRMZXZlbCh0aGlzLnBsYWNlaG9sZGVyKSxcbiAgICAgICAgICAgICAgICBjaGlsZExldmVscyA9IHRoaXMuX2dldENoaWxkTGV2ZWxzKHRoaXMuaGVscGVyKTtcblxuICAgICAgICAgICAgdmFyIG5ld0xpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG8ubGlzdFR5cGUpO1xuXG4gICAgICAgICAgICAvL1JlYXJyYW5nZVxuICAgICAgICAgICAgZm9yIChpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXG4gICAgICAgICAgICAgICAgLy9DYWNoZSB2YXJpYWJsZXMgYW5kIGludGVyc2VjdGlvbiwgY29udGludWUgaWYgbm8gaW50ZXJzZWN0aW9uXG4gICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuaXRlbXNbaV07XG4gICAgICAgICAgICAgICAgaXRlbUVsZW1lbnQgPSBpdGVtLml0ZW1bMF07XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uID0gdGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKGl0ZW0pO1xuICAgICAgICAgICAgICAgIGlmICghaW50ZXJzZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE9ubHkgcHV0IHRoZSBwbGFjZWhvbGRlciBpbnNpZGUgdGhlIGN1cnJlbnQgQ29udGFpbmVyLCBza2lwIGFsbFxuICAgICAgICAgICAgICAgIC8vIGl0ZW1zIGZvcm0gb3RoZXIgY29udGFpbmVycy4gVGhpcyB3b3JrcyBiZWNhdXNlIHdoZW4gbW92aW5nXG4gICAgICAgICAgICAgICAgLy8gYW4gaXRlbSBmcm9tIG9uZSBjb250YWluZXIgdG8gYW5vdGhlciB0aGVcbiAgICAgICAgICAgICAgICAvLyBjdXJyZW50Q29udGFpbmVyIGlzIHN3aXRjaGVkIGJlZm9yZSB0aGUgcGxhY2Vob2xkZXIgaXMgbW92ZWQuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBXaXRob3V0IHRoaXMgbW92aW5nIGl0ZW1zIGluIFwic3ViLXNvcnRhYmxlc1wiIGNhbiBjYXVzZSB0aGUgcGxhY2Vob2xkZXIgdG8gaml0dGVyXG4gICAgICAgICAgICAgICAgLy8gYmVldHdlZW4gdGhlIG91dGVyIGFuZCBpbm5lciBjb250YWluZXIuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaW5zdGFuY2UgIT09IHRoaXMuY3VycmVudENvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBjYW5ub3QgaW50ZXJzZWN0IHdpdGggaXRzZWxmXG4gICAgICAgICAgICAgICAgLy8gbm8gdXNlbGVzcyBhY3Rpb25zIHRoYXQgaGF2ZSBiZWVuIGRvbmUgYmVmb3JlXG4gICAgICAgICAgICAgICAgLy8gbm8gYWN0aW9uIGlmIHRoZSBpdGVtIG1vdmVkIGlzIHRoZSBwYXJlbnQgb2YgdGhlIGl0ZW0gY2hlY2tlZFxuICAgICAgICAgICAgICAgIGlmIChpdGVtRWxlbWVudCAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSAmJlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyW2ludGVyc2VjdGlvbiA9PT0gMSA/IFwibmV4dFwiIDogXCJwcmV2XCJdKClbMF0gIT09IGl0ZW1FbGVtZW50ICYmXG4gICAgICAgICAgICAgICAgICAgICEkLmNvbnRhaW5zKHRoaXMucGxhY2Vob2xkZXJbMF0sIGl0ZW1FbGVtZW50KSAmJlxuICAgICAgICAgICAgICAgICAgICAodGhpcy5vcHRpb25zLnR5cGUgPT09IFwic2VtaS1keW5hbWljXCIgPyAhJC5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sIGl0ZW1FbGVtZW50KSA6IHRydWUpXG4gICAgICAgICAgICAgICAgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbWpzIC0gd2UgYXJlIGludGVyc2VjdGluZyBhbiBlbGVtZW50OiB0cmlnZ2VyIHRoZSBtb3VzZWVudGVyIGV2ZW50IGFuZCBzdG9yZSB0aGlzIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5tb3VzZWVudGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbUVsZW1lbnQpLm1vdXNlZW50ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW91c2VlbnRlcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIG1qcyAtIGlmIHRoZSBlbGVtZW50IGhhcyBjaGlsZHJlbiBhbmQgdGhleSBhcmUgaGlkZGVuLCBzaG93IHRoZW0gYWZ0ZXIgYSBkZWxheSAoQ1NTIHJlc3BvbnNpYmxlKVxuICAgICAgICAgICAgICAgICAgICBpZiAoby5pc1RyZWUgJiYgJChpdGVtRWxlbWVudCkuaGFzQ2xhc3Moby5jb2xsYXBzZWRDbGFzcykgJiYgby5leHBhbmRPbkhvdmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaG92ZXJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW1FbGVtZW50KS5hZGRDbGFzcyhvLmhvdmVyaW5nQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhvdmVyaW5nID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbUVsZW1lbnQpLnJlbW92ZUNsYXNzKG8uY29sbGFwc2VkQ2xhc3MpLmFkZENsYXNzKG8uZXhwYW5kZWRDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVmcmVzaFBvc2l0aW9ucygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl90cmlnZ2VyKFwiZXhwYW5kXCIsIGV2ZW50LCBzZWxmLl91aUhhc2goKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgby5leHBhbmRPbkhvdmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gaW50ZXJzZWN0aW9uID09IDEgPyBcImRvd25cIiA6IFwidXBcIjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBtanMgLSByZWFycmFuZ2UgdGhlIGVsZW1lbnRzIGFuZCByZXNldCB0aW1lb3V0cyBhbmQgaG92ZXJpbmcgc3RhdGVcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50b2xlcmFuY2UgPT0gXCJwb2ludGVyXCIgfHwgdGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChpdGVtRWxlbWVudCkubW91c2VsZWF2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3VzZWVudGVyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbUVsZW1lbnQpLnJlbW92ZUNsYXNzKG8uaG92ZXJpbmdDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhvdmVyaW5nICYmIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5ob3ZlcmluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhvdmVyaW5nID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWpzIC0gZG8gbm90IHN3aXRjaCBjb250YWluZXIgaWYgaXQncyBhIHJvb3QgaXRlbSBhbmQgJ3Byb3RlY3RSb290JyBpcyB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvciBpZiBpdCdzIG5vdCBhIHJvb3QgaXRlbSBidXQgd2UgYXJlIHRyeWluZyB0byBtYWtlIGl0IHJvb3RcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLnByb3RlY3RSb290XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgISAodGhpcy5jdXJyZW50SXRlbVswXS5wYXJlbnROb2RlID09IHRoaXMuZWxlbWVudFswXSAvLyBpdCdzIGEgcm9vdCBpdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgaXRlbUVsZW1lbnQucGFyZW50Tm9kZSAhPSB0aGlzLmVsZW1lbnRbMF0pIC8vIGl0J3MgaW50ZXJzZWN0aW5nIGEgbm9uLXJvb3QgaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSAhPSB0aGlzLmVsZW1lbnRbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgaXRlbUVsZW1lbnQucGFyZW50Tm9kZSA9PSB0aGlzLmVsZW1lbnRbMF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEgJChpdGVtRWxlbWVudCkuY2hpbGRyZW4oby5saXN0VHlwZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtRWxlbWVudC5hcHBlbmRDaGlsZChuZXdMaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uaXNUcmVlICYmICQoaXRlbUVsZW1lbnQpLnJlbW92ZUNsYXNzKG8ubGVhZkNsYXNzKS5hZGRDbGFzcyhvLmJyYW5jaENsYXNzICsgJyAnICsgby5leHBhbmRlZENsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5kaXJlY3Rpb24gPT09IFwiZG93blwiID8gJChpdGVtRWxlbWVudCkucHJldigpLmNoaWxkcmVuKG8ubGlzdFR5cGUpIDogJChpdGVtRWxlbWVudCkuY2hpbGRyZW4oby5saXN0VHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhWzBdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYXJyYW5nZShldmVudCwgbnVsbCwgYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYXJyYW5nZShldmVudCwgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggISBvLnByb3RlY3RSb290KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhcnJhbmdlKGV2ZW50LCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgZW10cHkgdWwncy9vbCdzXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyRW1wdHkoaXRlbUVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBtanMgLSB0byBmaW5kIHRoZSBwcmV2aW91cyBzaWJsaW5nIGluIHRoZSBsaXN0LCBrZWVwIGJhY2t0cmFja2luZyB1bnRpbCB3ZSBoaXQgYSB2YWxpZCBsaXN0IGl0ZW0uXG4gICAgICAgICAgICB2YXIgcHJldmlvdXNJdGVtID0gdGhpcy5wbGFjZWhvbGRlclswXS5wcmV2aW91c1NpYmxpbmcgPyAkKHRoaXMucGxhY2Vob2xkZXJbMF0ucHJldmlvdXNTaWJsaW5nKSA6IG51bGw7XG4gICAgICAgICAgICBpZiAocHJldmlvdXNJdGVtICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAocHJldmlvdXNJdGVtWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT0gJChvLmxpc3RUeXBlKVswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIHx8IHByZXZpb3VzSXRlbVswXSA9PSB0aGlzLmN1cnJlbnRJdGVtWzBdIHx8IHByZXZpb3VzSXRlbVswXSA9PSB0aGlzLmhlbHBlclswXSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNJdGVtWzBdLnByZXZpb3VzU2libGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNJdGVtID0gJChwcmV2aW91c0l0ZW1bMF0ucHJldmlvdXNTaWJsaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzSXRlbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbWpzIC0gdG8gZmluZCB0aGUgbmV4dCBzaWJsaW5nIGluIHRoZSBsaXN0LCBrZWVwIHN0ZXBwaW5nIGZvcndhcmQgdW50aWwgd2UgaGl0IGEgdmFsaWQgbGlzdCBpdGVtLlxuICAgICAgICAgICAgdmFyIG5leHRJdGVtID0gdGhpcy5wbGFjZWhvbGRlclswXS5uZXh0U2libGluZyA/ICQodGhpcy5wbGFjZWhvbGRlclswXS5uZXh0U2libGluZykgOiBudWxsO1xuICAgICAgICAgICAgaWYgKG5leHRJdGVtICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAobmV4dEl0ZW1bMF0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPSAkKG8ubGlzdFR5cGUpWzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgfHwgbmV4dEl0ZW1bMF0gPT0gdGhpcy5jdXJyZW50SXRlbVswXSB8fCBuZXh0SXRlbVswXSA9PSB0aGlzLmhlbHBlclswXSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dEl0ZW1bMF0ubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJdGVtID0gJChuZXh0SXRlbVswXS5uZXh0U2libGluZyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0SXRlbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5iZXlvbmRNYXhMZXZlbHMgPSAwO1xuXG4gICAgICAgICAgICAvLyBtanMgLSBpZiB0aGUgaXRlbSBpcyBtb3ZlZCB0byB0aGUgbGVmdCwgc2VuZCBpdCBvbmUgbGV2ZWwgdXAgYnV0IG9ubHkgaWYgaXQncyBhdCB0aGUgYm90dG9tIG9mIHRoZSBsaXN0XG4gICAgICAgICAgICBpZiAocGFyZW50SXRlbSAhPSBudWxsXG4gICAgICAgICAgICAgICAgJiYgbmV4dEl0ZW0gPT0gbnVsbFxuICAgICAgICAgICAgICAgICYmICEgKG8ucHJvdGVjdFJvb3QgJiYgcGFyZW50SXRlbVswXS5wYXJlbnROb2RlID09IHRoaXMuZWxlbWVudFswXSlcbiAgICAgICAgICAgICAgICAmJlxuICAgICAgICAgICAgICAgICAgICAoby5ydGwgJiYgKHRoaXMucG9zaXRpb25BYnMubGVmdCArIHRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSA+IHBhcmVudEl0ZW0ub2Zmc2V0KCkubGVmdCArIHBhcmVudEl0ZW0ub3V0ZXJXaWR0aCgpKVxuICAgICAgICAgICAgICAgICAgICAgfHwgISBvLnJ0bCAmJiAodGhpcy5wb3NpdGlvbkFicy5sZWZ0IDwgcGFyZW50SXRlbS5vZmZzZXQoKS5sZWZ0KSlcbiAgICAgICAgICAgICkge1xuXG4gICAgICAgICAgICAgICAgcGFyZW50SXRlbS5hZnRlcih0aGlzLnBsYWNlaG9sZGVyWzBdKTtcbiAgICAgICAgICAgICAgICBpZiAoby5pc1RyZWUgJiYgcGFyZW50SXRlbS5jaGlsZHJlbihvLmxpc3RJdGVtKS5jaGlsZHJlbihvLmxpc3RJdGVtICsgJzp2aXNpYmxlOm5vdCgudWktc29ydGFibGUtaGVscGVyKScpLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SXRlbS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuYnJhbmNoQ2xhc3MgKyAnICcgKyB0aGlzLm9wdGlvbnMuZXhwYW5kZWRDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubGVhZkNsYXNzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fY2xlYXJFbXB0eShwYXJlbnRJdGVtWzBdKTtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBtanMgLSBpZiB0aGUgaXRlbSBpcyBiZWxvdyBhIHNpYmxpbmcgYW5kIGlzIG1vdmVkIHRvIHRoZSByaWdodCwgbWFrZSBpdCBhIGNoaWxkIG9mIHRoYXQgc2libGluZ1xuICAgICAgICAgICAgZWxzZSBpZiAocHJldmlvdXNJdGVtICE9IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICYmICEgcHJldmlvdXNJdGVtLmhhc0NsYXNzKG8uZGlzYWJsZU5lc3RpbmdDbGFzcylcbiAgICAgICAgICAgICAgICAgICAgICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAocHJldmlvdXNJdGVtLmNoaWxkcmVuKG8ubGlzdFR5cGUpLmxlbmd0aCAmJiBwcmV2aW91c0l0ZW0uY2hpbGRyZW4oby5saXN0VHlwZSkuaXMoJzp2aXNpYmxlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICB8fCAhIHByZXZpb3VzSXRlbS5jaGlsZHJlbihvLmxpc3RUeXBlKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAmJiAhIChvLnByb3RlY3RSb290ICYmIHRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSA9PSB0aGlzLmVsZW1lbnRbMF0pXG4gICAgICAgICAgICAgICAgICAgICAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgKG8ucnRsICYmICh0aGlzLnBvc2l0aW9uQWJzLmxlZnQgKyB0aGlzLmhlbHBlci5vdXRlcldpZHRoKCkgPCBwcmV2aW91c0l0ZW0ub2Zmc2V0KCkubGVmdCArIHByZXZpb3VzSXRlbS5vdXRlcldpZHRoKCkgLSBvLnRhYlNpemUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgfHwgISBvLnJ0bCAmJiAodGhpcy5wb3NpdGlvbkFicy5sZWZ0ID4gcHJldmlvdXNJdGVtLm9mZnNldCgpLmxlZnQgKyBvLnRhYlNpemUpKVxuICAgICAgICAgICAgKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9pc0FsbG93ZWQocHJldmlvdXNJdGVtLCBsZXZlbCwgbGV2ZWwrY2hpbGRMZXZlbHMrMSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXByZXZpb3VzSXRlbS5jaGlsZHJlbihvLmxpc3RUeXBlKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNJdGVtWzBdLmFwcGVuZENoaWxkKG5ld0xpc3QpO1xuICAgICAgICAgICAgICAgICAgICBvLmlzVHJlZSAmJiBwcmV2aW91c0l0ZW0ucmVtb3ZlQ2xhc3Moby5sZWFmQ2xhc3MpLmFkZENsYXNzKG8uYnJhbmNoQ2xhc3MgKyAnICcgKyBvLmV4cGFuZGVkQ2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIG1qcyAtIGlmIHRoaXMgaXRlbSBpcyBiZWluZyBtb3ZlZCBmcm9tIHRoZSB0b3AsIGFkZCBpdCB0byB0aGUgdG9wIG9mIHRoZSBsaXN0LlxuICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c1RvcE9mZnNldCAmJiAocHJldmlvdXNUb3BPZmZzZXQgPD0gcHJldmlvdXNJdGVtLm9mZnNldCgpLnRvcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNJdGVtLmNoaWxkcmVuKG8ubGlzdFR5cGUpLnByZXBlbmQodGhpcy5wbGFjZWhvbGRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIG1qcyAtIG90aGVyd2lzZSwgYWRkIGl0IHRvIHRoZSBib3R0b20gb2YgdGhlIGxpc3QuXG4gICAgICAgICAgICAgICAgZWxzZSBpZihwcmV2aW91c0l0ZW0uY2hpbGRyZW4oby5saXN0VHlwZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzSXRlbS5jaGlsZHJlbihvLmxpc3RUeXBlKVswXS5hcHBlbmRDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc0FsbG93ZWQocGFyZW50SXRlbSwgbGV2ZWwsIGxldmVsK2NoaWxkTGV2ZWxzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9Qb3N0IGV2ZW50cyB0byBjb250YWluZXJzXG4gICAgICAgICAgICB0aGlzLl9jb250YWN0Q29udGFpbmVycyhldmVudCk7XG5cbiAgICAgICAgICAgIC8vSW50ZXJjb25uZWN0IHdpdGggZHJvcHBhYmxlc1xuICAgICAgICAgICAgaWYoJC51aS5kZG1hbmFnZXIpIHtcbiAgICAgICAgICAgICAgICAkLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9DYWxsIGNhbGxiYWNrc1xuICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcignc29ydCcsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7XG5cbiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uQWJzID0gdGhpcy5wb3NpdGlvbkFicztcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIF9tb3VzZVN0b3A6IGZ1bmN0aW9uKGV2ZW50LCBub1Byb3BhZ2F0aW9uKSB7XG5cbiAgICAgICAgICAgIC8vIG1qcyAtIGlmIHRoZSBpdGVtIGlzIGluIGEgcG9zaXRpb24gbm90IGFsbG93ZWQsIHNlbmQgaXQgYmFja1xuICAgICAgICAgICAgaWYgKHRoaXMuYmV5b25kTWF4TGV2ZWxzKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5lcnJvckNsYXNzKTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbVBvc2l0aW9uLnByZXYpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzLmRvbVBvc2l0aW9uLnByZXYpLmFmdGVyKHRoaXMucGxhY2Vob2xkZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQpLnByZXBlbmQodGhpcy5wbGFjZWhvbGRlcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcihcInJldmVydFwiLCBldmVudCwgdGhpcy5fdWlIYXNoKCkpO1xuXG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgLy8gbWpzIC0gY2xlYXIgdGhlIGhvdmVyaW5nIHRpbWVvdXQsIGp1c3QgdG8gYmUgc3VyZVxuICAgICAgICAgICAgJCgnLicrdGhpcy5vcHRpb25zLmhvdmVyaW5nQ2xhc3MpLm1vdXNlbGVhdmUoKS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJpbmdDbGFzcyk7XG4gICAgICAgICAgICB0aGlzLm1vdXNlZW50ZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5ob3ZlcmluZyAmJiB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuaG92ZXJpbmcpO1xuICAgICAgICAgICAgdGhpcy5ob3ZlcmluZyA9IG51bGw7XG5cbiAgICAgICAgICAgICQudWkuc29ydGFibGUucHJvdG90eXBlLl9tb3VzZVN0b3AuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIC8vIG1qcyAtIHRoaXMgZnVuY3Rpb24gaXMgc2xpZ2h0bHkgbW9kaWZpZWQgdG8gbWFrZSBpdCBlYXNpZXIgdG8gaG92ZXIgb3ZlciBhIGNvbGxhcHNlZCBlbGVtZW50IGFuZCBoYXZlIGl0IGV4cGFuZFxuICAgICAgICBfaW50ZXJzZWN0c1dpdGhTaWRlczogZnVuY3Rpb24oaXRlbSkge1xuXG4gICAgICAgICAgICB2YXIgaGFsZiA9IHRoaXMub3B0aW9ucy5pc1RyZWUgPyAuOCA6IC41O1xuXG4gICAgICAgICAgICB2YXIgaXNPdmVyQm90dG9tSGFsZiA9IGlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3AgKyB0aGlzLm9mZnNldC5jbGljay50b3AsIGl0ZW0udG9wICsgKGl0ZW0uaGVpZ2h0KmhhbGYpLCBpdGVtLmhlaWdodCksXG4gICAgICAgICAgICAgICAgaXNPdmVyVG9wSGFsZiA9IGlzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3AgKyB0aGlzLm9mZnNldC5jbGljay50b3AsIGl0ZW0udG9wIC0gKGl0ZW0uaGVpZ2h0KmhhbGYpLCBpdGVtLmhlaWdodCksXG4gICAgICAgICAgICAgICAgaXNPdmVyUmlnaHRIYWxmID0gaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQgKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0LCBpdGVtLmxlZnQgKyAoaXRlbS53aWR0aC8yKSwgaXRlbS53aWR0aCksXG4gICAgICAgICAgICAgICAgdmVydGljYWxEaXJlY3Rpb24gPSB0aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSxcbiAgICAgICAgICAgICAgICBob3Jpem9udGFsRGlyZWN0aW9uID0gdGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmcgJiYgaG9yaXpvbnRhbERpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoKGhvcml6b250YWxEaXJlY3Rpb24gPT0gXCJyaWdodFwiICYmIGlzT3ZlclJpZ2h0SGFsZikgfHwgKGhvcml6b250YWxEaXJlY3Rpb24gPT0gXCJsZWZ0XCIgJiYgIWlzT3ZlclJpZ2h0SGFsZikpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmVydGljYWxEaXJlY3Rpb24gJiYgKCh2ZXJ0aWNhbERpcmVjdGlvbiA9PSBcImRvd25cIiAmJiBpc092ZXJCb3R0b21IYWxmKSB8fCAodmVydGljYWxEaXJlY3Rpb24gPT0gXCJ1cFwiICYmIGlzT3ZlclRvcEhhbGYpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIF9jb250YWN0Q29udGFpbmVyczogZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wcm90ZWN0Um9vdCAmJiB0aGlzLmN1cnJlbnRJdGVtWzBdLnBhcmVudE5vZGUgPT0gdGhpcy5lbGVtZW50WzBdICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC51aS5zb3J0YWJsZS5wcm90b3R5cGUuX2NvbnRhY3RDb250YWluZXJzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBfY2xlYXI6IGZ1bmN0aW9uKGV2ZW50LCBub1Byb3BhZ2F0aW9uKSB7XG5cbiAgICAgICAgICAgICQudWkuc29ydGFibGUucHJvdG90eXBlLl9jbGVhci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG4gICAgICAgICAgICAvLyBtanMgLSBjbGVhbiBsYXN0IGVtcHR5IHVsL29sXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5pdGVtc1tpXS5pdGVtWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyRW1wdHkoaXRlbSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgICAgICAgICAgdmFyIG8gPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKSxcbiAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuX2dldEl0ZW1zQXNqUXVlcnkobyAmJiBvLmNvbm5lY3RlZCksXG4gICAgICAgICAgICAgICAgc3RyID0gW107XG5cbiAgICAgICAgICAgICQoaXRlbXMpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9ICgkKG8uaXRlbSB8fCB0aGlzKS5hdHRyKG8uYXR0cmlidXRlIHx8ICdpZCcpIHx8ICcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbLT1fXSguKykvKSksXG4gICAgICAgICAgICAgICAgICAgIHBpZCA9ICgkKG8uaXRlbSB8fCB0aGlzKS5wYXJlbnQoby5saXN0VHlwZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoby5pdGVtcylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKG8uYXR0cmlidXRlIHx8ICdpZCcpIHx8ICcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbLT1fXSguKykvKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ci5wdXNoKCgoby5rZXkgfHwgcmVzWzFdKSArICdbJyArIChvLmtleSAmJiBvLmV4cHJlc3Npb24gPyByZXNbMV0gOiByZXNbMl0pICsgJ10nKVxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPSdcbiAgICAgICAgICAgICAgICAgICAgICAgICsgKHBpZCA/IChvLmtleSAmJiBvLmV4cHJlc3Npb24gPyBwaWRbMV0gOiBwaWRbMl0pIDogby5yb290SUQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYoIXN0ci5sZW5ndGggJiYgby5rZXkpIHtcbiAgICAgICAgICAgICAgICBzdHIucHVzaChvLmtleSArICc9Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzdHIuam9pbignJicpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9IaWVyYXJjaHk6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgICAgICAgICAgdmFyIG8gPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKSxcbiAgICAgICAgICAgICAgICBzRGVwdGggPSBvLnN0YXJ0RGVwdGhDb3VudCB8fCAwLFxuICAgICAgICAgICAgICAgIHJldCA9IFtdO1xuXG4gICAgICAgICAgICAkKHRoaXMuZWxlbWVudCkuY2hpbGRyZW4oby5pdGVtcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxldmVsID0gX3JlY3Vyc2l2ZUl0ZW1zKHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldC5wdXNoKGxldmVsKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBfcmVjdXJzaXZlSXRlbXMoaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9ICgkKGl0ZW0pLmF0dHIoby5hdHRyaWJ1dGUgfHwgJ2lkJykgfHwgJycpLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbLT1fXSguKykvKSk7XG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHtcImlkXCIgOiBpZFsyXX07XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKGl0ZW0pLmNoaWxkcmVuKG8ubGlzdFR5cGUpLmNoaWxkcmVuKG8uaXRlbXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtLmNoaWxkcmVuID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmNoaWxkcmVuKG8ubGlzdFR5cGUpLmNoaWxkcmVuKG8uaXRlbXMpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxldmVsID0gX3JlY3Vyc2l2ZUl0ZW1zKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtLmNoaWxkcmVuLnB1c2gobGV2ZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRJdGVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICAgICAgICAgIHZhciBvID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyksXG4gICAgICAgICAgICAgICAgc0RlcHRoID0gby5zdGFydERlcHRoQ291bnQgfHwgMCxcbiAgICAgICAgICAgICAgICByZXQgPSBbXSxcbiAgICAgICAgICAgICAgICBsZWZ0ID0gMTtcblxuICAgICAgICAgICAgaWYgKCFvLmV4Y2x1ZGVSb290KSB7XG4gICAgICAgICAgICAgICAgcmV0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBcIml0ZW1faWRcIjogby5yb290SUQsXG4gICAgICAgICAgICAgICAgICAgIFwicGFyZW50X2lkXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIFwiZGVwdGhcIjogc0RlcHRoLFxuICAgICAgICAgICAgICAgICAgICBcImxlZnRcIjogbGVmdCxcbiAgICAgICAgICAgICAgICAgICAgXCJyaWdodFwiOiAoJChvLml0ZW1zLCB0aGlzLmVsZW1lbnQpLmxlbmd0aCArIDEpICogMlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxlZnQrK1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKHRoaXMuZWxlbWVudCkuY2hpbGRyZW4oby5pdGVtcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbGVmdCA9IF9yZWN1cnNpdmVBcnJheSh0aGlzLCBzRGVwdGggKyAxLCBsZWZ0KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXQgPSByZXQuc29ydChmdW5jdGlvbihhLGIpeyByZXR1cm4gKGEubGVmdCAtIGIubGVmdCk7IH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBfcmVjdXJzaXZlQXJyYXkoaXRlbSwgZGVwdGgsIGxlZnQpIHtcblxuICAgICAgICAgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyAxLFxuICAgICAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgICAgICAgcGlkO1xuXG4gICAgICAgICAgICAgICAgaWYgKCQoaXRlbSkuY2hpbGRyZW4oby5saXN0VHlwZSkuY2hpbGRyZW4oby5pdGVtcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZXB0aCArKztcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jaGlsZHJlbihvLmxpc3RUeXBlKS5jaGlsZHJlbihvLml0ZW1zKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0gX3JlY3Vyc2l2ZUFycmF5KCQodGhpcyksIGRlcHRoLCByaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBkZXB0aCAtLTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZCA9ICgkKGl0ZW0pLmF0dHIoby5hdHRyaWJ1dGUgfHwgJ2lkJykpLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbLT1fXSguKykvKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT09IHNEZXB0aCArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcGlkID0gby5yb290SUQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudEl0ZW0gPSAoJChpdGVtKS5wYXJlbnQoby5saXN0VHlwZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoby5pdGVtcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKG8uYXR0cmlidXRlIHx8ICdpZCcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbLT1fXSguKykvKSk7XG4gICAgICAgICAgICAgICAgICAgIHBpZCA9IHBhcmVudEl0ZW1bMl07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQucHVzaCh7XCJpdGVtX2lkXCI6IGlkWzJdLCBcInBhcmVudF9pZFwiOiBwaWQsIFwiZGVwdGhcIjogZGVwdGgsIFwibGVmdFwiOiBsZWZ0LCBcInJpZ2h0XCI6IHJpZ2h0fSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGVmdCA9IHJpZ2h0ICsgMTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIF9jbGVhckVtcHR5OiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgdmFyIGVtcHR5TGlzdCA9ICQoaXRlbSkuY2hpbGRyZW4oby5saXN0VHlwZSk7XG5cbiAgICAgICAgICAgIGlmIChlbXB0eUxpc3QubGVuZ3RoICYmICFlbXB0eUxpc3QuY2hpbGRyZW4oKS5sZW5ndGggJiYgIW8uZG9Ob3RDbGVhcikge1xuICAgICAgICAgICAgICAgIG8uaXNUcmVlICYmICQoaXRlbSkucmVtb3ZlQ2xhc3Moby5icmFuY2hDbGFzcyArICcgJyArIG8uZXhwYW5kZWRDbGFzcykuYWRkQ2xhc3Moby5sZWFmQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGVtcHR5TGlzdC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoby5pc1RyZWUgJiYgZW1wdHlMaXN0Lmxlbmd0aCAmJiBlbXB0eUxpc3QuY2hpbGRyZW4oKS5sZW5ndGggJiYgZW1wdHlMaXN0LmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgJChpdGVtKS5yZW1vdmVDbGFzcyhvLmxlYWZDbGFzcykuYWRkQ2xhc3Moby5icmFuY2hDbGFzcyArICcgJyArIG8uZXhwYW5kZWRDbGFzcyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG8uaXNUcmVlICYmIGVtcHR5TGlzdC5sZW5ndGggJiYgZW1wdHlMaXN0LmNoaWxkcmVuKCkubGVuZ3RoICYmICFlbXB0eUxpc3QuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAkKGl0ZW0pLnJlbW92ZUNsYXNzKG8ubGVhZkNsYXNzKS5hZGRDbGFzcyhvLmJyYW5jaENsYXNzICsgJyAnICsgby5jb2xsYXBzZWRDbGFzcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0TGV2ZWw6IGZ1bmN0aW9uKGl0ZW0pIHtcblxuICAgICAgICAgICAgdmFyIGxldmVsID0gMTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5saXN0VHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gaXRlbS5jbG9zZXN0KHRoaXMub3B0aW9ucy5saXN0VHlwZSk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGxpc3QgJiYgbGlzdC5sZW5ndGggPiAwICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAhbGlzdC5pcygnLnVpLXNvcnRhYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV2ZWwrKztcbiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QucGFyZW50KCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMubGlzdFR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGxldmVsO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRDaGlsZExldmVsczogZnVuY3Rpb24ocGFyZW50LCBkZXB0aCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAgICAgICAgIG8gPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gMDtcbiAgICAgICAgICAgIGRlcHRoID0gZGVwdGggfHwgMDtcblxuICAgICAgICAgICAgJChwYXJlbnQpLmNoaWxkcmVuKG8ubGlzdFR5cGUpLmNoaWxkcmVuKG8uaXRlbXMpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBNYXRoLm1heChzZWxmLl9nZXRDaGlsZExldmVscyhjaGlsZCwgZGVwdGggKyAxKSwgcmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVwdGggPyByZXN1bHQgKyAxIDogcmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIF9pc0FsbG93ZWQ6IGZ1bmN0aW9uKHBhcmVudEl0ZW0sIGxldmVsLCBsZXZlbHMpIHtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIG1heExldmVscyA9IHRoaXMucGxhY2Vob2xkZXIuY2xvc2VzdCgnLnVpLXNvcnRhYmxlJykubmVzdGVkU29ydGFibGUoJ29wdGlvbicsICdtYXhMZXZlbHMnKTsgLy8gdGhpcyB0YWtlcyBpbnRvIGFjY291bnQgdGhlIG1heExldmVscyBzZXQgdG8gdGhlIHJlY2lwaWVudCBsaXN0XG5cbiAgICAgICAgICAgIC8vIG1qcyAtIGlzIHRoZSByb290IHByb3RlY3RlZD9cbiAgICAgICAgICAgIC8vIG1qcyAtIGFyZSB3ZSBuZXN0aW5nIHRvbyBkZWVwP1xuICAgICAgICAgICAgaWYgKCAhIG8uaXNBbGxvd2VkKHRoaXMucGxhY2Vob2xkZXIsIHBhcmVudEl0ZW0sIHRoaXMuY3VycmVudEl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIuYWRkQ2xhc3Moby5lcnJvckNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heExldmVscyA8IGxldmVscyAmJiBtYXhMZXZlbHMgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iZXlvbmRNYXhMZXZlbHMgPSBsZXZlbHMgLSBtYXhMZXZlbHM7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJleW9uZE1heExldmVscyA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG1heExldmVscyA8IGxldmVscyAmJiBtYXhMZXZlbHMgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLmFkZENsYXNzKG8uZXJyb3JDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmV5b25kTWF4TGV2ZWxzID0gbGV2ZWxzIC0gbWF4TGV2ZWxzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIucmVtb3ZlQ2xhc3Moby5lcnJvckNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iZXlvbmRNYXhMZXZlbHMgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSkpO1xuXG4gICAgJC5tanMubmVzdGVkU29ydGFibGUucHJvdG90eXBlLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC51aS5zb3J0YWJsZS5wcm90b3R5cGUub3B0aW9ucywgJC5tanMubmVzdGVkU29ydGFibGUucHJvdG90eXBlLm9wdGlvbnMpO1xufSkoalF1ZXJ5KTsiLCIvKiFcbiAqIENNUy5BUEkuSGVscGVyc1xuICogTXVsdGlwbGUgaGVscGVycyB1c2VkIGFjcm9zcyBhbGwgQ01TIGZlYXR1cmVzXG4gKi9cblxuLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbi8vIENPTVBBVElCSUxJVFlcblxuLy8gZW5zdXJpbmcgZGphbmdvIG5hbWVzcGFjZSBpcyBzZXQgY29ycmVjdGx5XG53aW5kb3cuZGphbmdvID0gd2luZG93LmRqYW5nbyB8fCB1bmRlZmluZWQ7XG5cbi8vIGVuc3VyaW5nIGpRdWVyeSBuYW1lc3BhY2UgaXMgc2V0IGNvcnJlY3RseVxuLy8gaXN0YW5idWwgaWdub3JlIG5leHRcbndpbmRvdy5qUXVlcnkgPSAod2luZG93LmRqYW5nbyAmJiB3aW5kb3cuZGphbmdvLmpRdWVyeSkgPyB3aW5kb3cuZGphbmdvLmpRdWVyeSA6IHdpbmRvdy5qUXVlcnkgfHwgdW5kZWZpbmVkO1xuXG4vLyBlbnN1cmluZyBDbGFzcyBuYW1lc3BhY2UgaXMgc2V0IGNvcnJlY3RseVxuLy8gaXN0YW5idWwgaWdub3JlIG5leHRcbndpbmRvdy5DbGFzcyA9IHdpbmRvdy5DbGFzcyB8fCB1bmRlZmluZWQ7XG5cbi8vIGVuc3VyaW5nIENNUyBuYW1lc3BhY2UgaXMgc2V0IGNvcnJlY3RseVxuLyoqXG4gKiBAbW9kdWxlIENNU1xuICovXG52YXIgQ01TID0ge1xuICAgICQ6ICh0eXBlb2Ygd2luZG93LmpRdWVyeSA9PT0gJ2Z1bmN0aW9uJykgPyB3aW5kb3cualF1ZXJ5IDovKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyB1bmRlZmluZWQsXG4gICAgQ2xhc3M6ICh0eXBlb2Ygd2luZG93LkNsYXNzID09PSAnZnVuY3Rpb24nKSA/IHdpbmRvdy5DbGFzcyA6LyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gdW5kZWZpbmVkLFxuICAgIC8qKlxuICAgICAqIEBtb2R1bGUgQ01TXG4gICAgICogQHN1Ym1vZHVsZSBDTVMuQVBJXG4gICAgICovXG4gICAgQVBJOiB7fSxcbiAgICAvKipcbiAgICAgKiBQcm92aWRlcyBrZXkgY29kZXMgZm9yIGNvbW1vbiBrZXlzLlxuICAgICAqXG4gICAgICogQG1vZHVsZSBDTVNcbiAgICAgKiBAc3VibW9kdWxlIENNUy5LRVlTXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAgICAgaWYgKGUua2V5Q29kZSA9PT0gQ01TLktFWVMuRU5URVIpIHsgLi4uIH07XG4gICAgICovXG4gICAgS0VZUzoge1xuICAgICAgICBTSElGVDogMTYsXG4gICAgICAgIFRBQjogOSxcbiAgICAgICAgVVA6IDM4LFxuICAgICAgICBET1dOOiA0MCxcbiAgICAgICAgRU5URVI6IDEzLFxuICAgICAgICBTUEFDRTogMzIsXG4gICAgICAgIEVTQzogMjcsXG4gICAgICAgIENNRF9MRUZUOiA5MSxcbiAgICAgICAgQ01EX1JJR0hUOiA5MyxcbiAgICAgICAgQ01EX0ZJUkVGT1g6IDIyNCxcbiAgICAgICAgQ1RSTDogMTdcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGJyZWFrcG9pbnRzIGZvciBjZXJ0YWluIGRldmljZSB3aWR0aHNcbiAgICAgKlxuICAgICAqIEBtb2R1bGUgQ01TXG4gICAgICogQHN1Ym1vZHVsZSBDTVMuQlJFQUtQT0lOVFNcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqICAgICBpZiAod2luZG93LndpZHRoID49IENNUy5CUkVBS1BPSU5UUy5tb2JpbGUpIHsgLi4uIH07XG4gICAgICovXG4gICAgQlJFQUtQT0lOVFM6IHtcbiAgICAgICAgbW9iaWxlOiA0MjBcbiAgICB9XG59O1xuXG4vLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gQ01TLkFQSVxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvbiBfbnNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudHMgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50IG5hbWVzIHRvIGJlIG5hbWVzcGFjZXNcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHN0cmluZyBjb250YWluaW5nIHNwYWNlIHNlcGFyYXRlZCBuYW1lc3BhY2VkIGV2ZW50IG5hbWVzXG4gICAgICovXG4gICAgdmFyIF9ucyA9IGZ1bmN0aW9uIG5hbWVTcGFjZUV2ZW50KGV2ZW50cykge1xuICAgICAgICByZXR1cm4gZXZlbnRzLnNwbGl0KC9cXHMrL2cpLm1hcChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2Ntcy0nICsgZXZlbnROYW1lO1xuICAgICAgICB9KS5qb2luKCcgJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIHZhcmlvdXMgaGVscGVycyB0aGF0IGFyZSBtaXhlZCBpbiBhbGwgQ01TIGNsYXNzZXMuXG4gICAgICpcbiAgICAgKiBAY2xhc3MgSGVscGVyc1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbW9kdWxlIENNU1xuICAgICAqIEBzdWJtb2R1bGUgQ01TLkFQSVxuICAgICAqIEBuYW1lc3BhY2UgQ01TLkFQSVxuICAgICAqL1xuICAgIENNUy5BUEkuSGVscGVycyA9IHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVkaXJlY3RzIHRvIGEgc3BlY2lmaWMgdXJsIG9yIHJlbG9hZHMgYnJvd3Nlci5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCByZWxvYWRCcm93c2VyXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgd2hlcmUgdG8gcmVkaXJlY3QuIGlmIGVxdWFsIHRvIGBSRUZSRVNIX1BBR0VgIHdpbGwgcmVsb2FkIHBhZ2UgaW5zdGVhZFxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZW91dD0wIHRpbWVvdXQgaW4gbXNcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBhamF4IGlmIHNldCB0byB0cnVlIGZpcnN0IGluaXRpYXRlcyAqKnN5bmNocm9ub3VzKipcbiAgICAgICAgICogICAgIGFqYXggcmVxdWVzdCB0byBmaWd1cmUgb3V0IGlmIHRoZSBicm93c2VyIHNob3VsZCByZWxvYWQgY3VycmVudCBwYWdlLFxuICAgICAgICAgKiAgICAgbW92ZSB0byBhbm90aGVyIG9uZSwgb3IgZG8gbm90aGluZy5cbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtkYXRhXSBvcHRpb25hbCBkYXRhIHRvIGJlIHBhc3NlZCBpbnN0ZWFkIG9mIG9uZSBwcm92aWRlZCBieSByZXF1ZXN0IGNvbmZpZ1xuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RhdGEubW9kZWw9Q01TLmNvbmZpZy5yZXF1ZXN0Lm1vZGVsXVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xOdW1iZXJ9IFtkYXRhLnBrPUNNUy5jb25maWcucmVxdWVzdC5wa11cbiAgICAgICAgICovXG4gICAgICAgIHJlbG9hZEJyb3dzZXI6IGZ1bmN0aW9uICh1cmwsIHRpbWVvdXQsIGFqYXgsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIC8vIGlzIHRoZXJlIGEgcGFyZW50IHdpbmRvdz9cbiAgICAgICAgICAgIHZhciB3aW4gPSB0aGlzLl9nZXRXaW5kb3coKTtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSAod2luLnBhcmVudCkgPyB3aW4ucGFyZW50IDogd2luO1xuXG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhbiBhamF4IHJlbG9hZCwgcHJpb3JpdGl6ZVxuICAgICAgICAgICAgaWYgKGFqYXgpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQuQ01TLkFQSS5sb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB1cmwgaGFzIGNoYW5nZWQsIGlmIHRydWUgcmVkaXJlY3QgdG8gdGhlIG5ldyBwYXRoXG4gICAgICAgICAgICAgICAgLy8gdGhpcyByZXF1aXJlcyBhbiBhamF4IHJlcXVlc3RcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHBhcmVudC5DTVMuY29uZmlnLnJlcXVlc3QudXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhIHx8IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiBwYXJlbnQuQ01TLmNvbmZpZy5yZXF1ZXN0Lm1vZGVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGs6IHBhcmVudC5DTVMuY29uZmlnLnJlcXVlc3QucGtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuQ01TLkFQSS5sb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlID09PSAnJyAmJiAhdXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHJlc3BvbnNlIGlzIGVtcHR5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJlbnQubG9jYXRpb24ucGF0aG5hbWUgIT09IHJlc3BvbnNlICYmIHJlc3BvbnNlICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFwaSBjYWxsIHRvIHRoZSBiYWNrZW5kIHRvIGNoZWNrIGlmIHRoZSBjdXJyZW50IHBhdGggaXMgc3RpbGwgdGhlIHNhbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnJlbG9hZEJyb3dzZXIocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cmwgPT09ICdSRUZSRVNIX1BBR0UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgb25fY2xvc2UgcHJvdmlkZXMgUkVGUkVTSF9QQUdFLCBvbmx5IGRvIGEgcmVsb2FkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uX2Nsb3NlIGNhbiBhbHNvIHByb3ZpZGUgYSB1cmwsIHJlbG9hZCB0byB0aGUgbmV3IGRlc3RpbmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5yZWxvYWRCcm93c2VyKHVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQucmVsb2FkQnJvd3NlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBjYW5jZWwgZnVydGhlciBvcGVyYXRpb25zXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhZGQgdGltZW91dCBpZiBwcm92aWRlZFxuICAgICAgICAgICAgcGFyZW50LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh1cmwgJiYgdXJsICE9PSBwYXJlbnQubG9jYXRpb24uaHJlZikge1xuICAgICAgICAgICAgICAgICAgICAvLyBsb2NhdGlvbi5yZWxvYWQoKSB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgdGhpcywgc28gd2VcbiAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3Qgd2FudCB0byByZWxvYWQgdGhlIHBhZ2UgaWYgd2UgbmVlZCBhIHJlZGlyZWN0XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5sb2NhdGlvbi5ocmVmID0gdXJsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVuc3VyZSBwYWdlIGlzIGFsd2F5cyByZWxvYWRlZCAjMzQxM1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGltZW91dCB8fCAwKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQXNzaWducyBhbiBldmVudCBoYW5kbGVyIHRvIGZvcm1zIGxvY2F0ZWQgaW4gdGhlIHRvb2xiYXJcbiAgICAgICAgICogdG8gcHJldmVudCBtdWx0aXBsZSBzdWJtaXNzaW9ucy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBwcmV2ZW50U3VibWl0XG4gICAgICAgICAqL1xuICAgICAgICBwcmV2ZW50U3VibWl0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZm9ybXMgPSAkKCcuY21zLXRvb2xiYXInKS5maW5kKCdmb3JtJyk7XG4gICAgICAgICAgICBmb3Jtcy5zdWJtaXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIHNob3cgbG9hZGVyXG4gICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLnNob3dMb2FkZXIoKTtcbiAgICAgICAgICAgICAgICAvLyB3ZSBjYW5ub3QgdXNlIGRpc2FibGVkIGFzIHRoZSBuYW1lIGFjdGlvbiB3aWxsIGJlIGlnbm9yZWRcbiAgICAgICAgICAgICAgICAkKCdpbnB1dFt0eXBlPVwic3VibWl0XCJdJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH0pLmNzcygnb3BhY2l0eScsIDAuNSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyBjc3JmIHRva2VuIGhlYWRlciBvbiBhamF4IHJlcXVlc3RzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIGNzcmZcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNzcmZfdG9rZW5cbiAgICAgICAgICovXG4gICAgICAgIGNzcmY6IGZ1bmN0aW9uIChjc3JmX3Rva2VuKSB7XG4gICAgICAgICAgICAkLmFqYXhTZXR1cCh7XG4gICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKHhocikge1xuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1DU1JGVG9rZW4nLCBjc3JmX3Rva2VuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VuZHMgb3IgcmV0cmlldmVzIGEgSlNPTiBmcm9tIGxvY2FsU3RvcmFnZVxuICAgICAgICAgKiBvciB0aGUgc2Vzc2lvbiAodGhyb3VnaCBzeW5jaHJvbm91cyBhamF4IHJlcXVlc3QpXG4gICAgICAgICAqIGlmIGxvY2FsU3RvcmFnZSBpcyBub3QgYXZhaWxhYmxlLiBEb2VzIG5vdCBtZXJnZSB3aXRoXG4gICAgICAgICAqIHByZXZpb3VzIHNldFNldHRpbmdzIGNhbGxzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHNldFNldHRpbmdzXG4gICAgICAgICAqIEBwYXJhbSBzZXR0aW5nc1xuICAgICAgICAgKi9cbiAgICAgICAgc2V0U2V0dGluZ3M6IGZ1bmN0aW9uIChzZXR0aW5ncykge1xuICAgICAgICAgICAgLy8gbWVyZ2Ugc2V0dGluZ3NcbiAgICAgICAgICAgIHNldHRpbmdzID0gSlNPTi5zdHJpbmdpZnkoJC5leHRlbmQoe30sIENNUy5jb25maWcuc2V0dGluZ3MsIHNldHRpbmdzKSk7XG4gICAgICAgICAgICAvLyBzZXQgbG9hZGVyXG4gICAgICAgICAgICBpZiAoQ01TLkFQSS5Ub29sYmFyKSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLnNob3dMb2FkZXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdXNlIGxvY2FsIHN0b3JhZ2Ugb3Igc2Vzc2lvblxuICAgICAgICAgICAgaWYgKHRoaXMuX2lzU3RvcmFnZVN1cHBvcnRlZCkge1xuICAgICAgICAgICAgICAgIC8vIHNhdmUgd2l0aGluIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY21zX2Nvb2tpZScsIHNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICBpZiAoQ01TLkFQSS5Ub29sYmFyKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5oaWRlTG9hZGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHdpdGhpbiBzZXNzaW9uXG4gICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogQ01TLmNvbmZpZy51cmxzLnNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjc3JmbWlkZGxld2FyZXRva2VuOiBDTVMuY29uZmlnLmNzcmYsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczogc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkubG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZXRlcm1pbmUgaWYgbG9nZ2VkIGluIG9yIG5vdFxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MgPSAoZGF0YSkgPyBKU09OLnBhcnNlKGRhdGEpIDogQ01TLmNvbmZpZy5zZXR0aW5ncztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChDTVMuQVBJLlRvb2xiYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuaGlkZUxvYWRlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLk1lc3NhZ2VzLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGpxWEhSLnJlc3BvbnNlVGV4dCArICcgfCAnICsganFYSFIuc3RhdHVzICsgJyAnICsganFYSFIuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2F2ZSBzZXR0aW5nc1xuICAgICAgICAgICAgQ01TLnNldHRpbmdzID0gdHlwZW9mIHNldHRpbmdzID09PSAnb2JqZWN0JyA/IHNldHRpbmdzIDogSlNPTi5wYXJzZShzZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIC8vIGVuc3VyZSBuZXcgc2V0dGluZ3MgYXJlIHJldHVybmVkXG4gICAgICAgICAgICByZXR1cm4gQ01TLnNldHRpbmdzO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIHVzZXIgc2V0dGluZ3MgKGZyb20gSlNPTiBvciB0aGUgc2Vzc2lvbilcbiAgICAgICAgICogaW4gdGhlIHNhbWUgd2F5IGFzIHNldFNldHRpbmdzIHNldHMgdGhlbS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBnZXRTZXR0aW5nc1xuICAgICAgICAgKi9cbiAgICAgICAgZ2V0U2V0dGluZ3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncztcbiAgICAgICAgICAgIC8vIHNldCBsb2FkZXJcbiAgICAgICAgICAgIGlmIChDTVMuQVBJLlRvb2xiYXIpIHtcbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuc2hvd0xvYWRlcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB1c2UgbG9jYWwgc3RvcmFnZSBvciBzZXNzaW9uXG4gICAgICAgICAgICBpZiAodGhpcy5faXNTdG9yYWdlU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IGZyb20gbG9jYWwgc3RvcmFnZVxuICAgICAgICAgICAgICAgIHNldHRpbmdzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY21zX2Nvb2tpZScpKTtcbiAgICAgICAgICAgICAgICBpZiAoQ01TLkFQSS5Ub29sYmFyKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5oaWRlTG9hZGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBDTVMuQVBJLmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IGZyb20gc2Vzc2lvblxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogQ01TLmNvbmZpZy51cmxzLnNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRldGVybWluZSBpZiBsb2dnZWQgaW4gb3Igbm90XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IChkYXRhKSA/IEpTT04ucGFyc2UoZGF0YSkgOiBDTVMuY29uZmlnLnNldHRpbmdzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENNUy5BUEkuVG9vbGJhcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5oaWRlTG9hZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoanFYSFIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZToganFYSFIucmVzcG9uc2VUZXh0ICsgJyB8ICcgKyBqcVhIUi5zdGF0dXMgKyAnICcgKyBqcVhIUi5zdGF0dXNUZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSB0aGlzLnNldFNldHRpbmdzKENNUy5jb25maWcuc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzYXZlIHNldHRpbmdzXG4gICAgICAgICAgICBDTVMuc2V0dGluZ3MgPSBzZXR0aW5ncztcblxuICAgICAgICAgICAgLy8gZW5zdXJlIG5ldyBzZXR0aW5ncyBhcmUgcmV0dXJuZWRcbiAgICAgICAgICAgIHJldHVybiBDTVMuc2V0dGluZ3M7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1vZGlmaWVzIHRoZSB1cmwgd2l0aCBuZXcgcGFyYW1zIGFuZCBzYW5pdGlzZXNcbiAgICAgICAgICogdGhlIGFtcGVyc2FuZCB3aXRoaW4gdGhlIHVybCBmb3IgIzM0MDQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgbWFrZVVSTFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIG9yaWdpbmFsIHVybFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBbcGFyYW1zXSBhcnJheSBvZiBgcGFyYW09dmFsdWVgIHN0cmluZ3MgdG8gdXBkYXRlIHRoZSB1cmxcbiAgICAgICAgICovXG4gICAgICAgIG1ha2VVUkw6IGZ1bmN0aW9uIG1ha2VVUkwodXJsLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgICAgIHZhciBrZXlzID0gW107XG4gICAgICAgICAgICB2YXIgdmFsdWVzID0gW107XG4gICAgICAgICAgICB2YXIgdG1wID0gJyc7XG4gICAgICAgICAgICB2YXIgdXJsQXJyYXkgPSBbXTtcbiAgICAgICAgICAgIHZhciB1cmxQYXJhbXMgPSBbXTtcbiAgICAgICAgICAgIHZhciBvcmlnaW4gPSB1cmw7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiB1cmwgaWYgdGhlcmUgaXMgbm8gcGFyYW1cbiAgICAgICAgICAgIGlmICh1cmwuc3BsaXQoJz8nKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgLy8gc2V0dXAgbG9jYWwgdmFyc1xuICAgICAgICAgICAgICAgIHVybEFycmF5ID0gdXJsLnNwbGl0KCc/Jyk7XG4gICAgICAgICAgICAgICAgdXJsUGFyYW1zID0gdXJsQXJyYXlbMV0ucmVwbGFjZSgvJig/OmFtcDspL2csICcmJykuc3BsaXQoJyYnKTtcbiAgICAgICAgICAgICAgICBvcmlnaW4gPSB1cmxBcnJheVswXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIHRoZSBhdmFpbGFibGUgcGFyYW1zXG4gICAgICAgICAgICAkLmVhY2godXJsUGFyYW1zLCBmdW5jdGlvbiAoaW5kZXgsIHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgYXJyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBwYXJhbTogcGFyYW0uc3BsaXQoJz0nKVswXSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcmFtLnNwbGl0KCc9JylbMV1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIHRoZSBuZXcgcGFyYW1zXG4gICAgICAgICAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGFyYW1zLCBmdW5jdGlvbiAoaW5kZXgsIHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtOiBwYXJhbS5zcGxpdCgnPScpWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcmFtLnNwbGl0KCc9JylbMV1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG1lcmdlIG1hbnVhbGx5IGJlY2F1c2UganF1ZXJ5Li4uXG4gICAgICAgICAgICAkLmVhY2goYXJyLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9ICQuaW5BcnJheShpdGVtLnBhcmFtLCBrZXlzKTtcblxuICAgICAgICAgICAgICAgIGlmIChpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBrZXlzLnB1c2goaXRlbS5wYXJhbSk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGl0ZW0udmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpXSA9IGl0ZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIG1lcmdlIG5ldyB1cmxcbiAgICAgICAgICAgICQuZWFjaChrZXlzLCBmdW5jdGlvbiAoaW5kZXgsIGtleSkge1xuICAgICAgICAgICAgICAgIHRtcCArPSAnJicgKyBrZXkgKyAnPScgKyB2YWx1ZXNbaW5kZXhdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0bXAgPSB0bXAucmVwbGFjZSgnJicsICc/Jyk7XG4gICAgICAgICAgICB1cmwgPSBvcmlnaW4gKyB0bXA7XG4gICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgvJi9nLCAnJmFtcDsnKTtcblxuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ3JlYXRlcyBhIGRlYm91bmNlZCBmdW5jdGlvbiB0aGF0IGRlbGF5cyBpbnZva2luZyBgZnVuY2BcbiAgICAgICAgICogdW50aWwgYWZ0ZXIgYHdhaXRgIG1pbGxpc2Vjb25kcyBoYXZlIGVsYXBzZWQgc2luY2VcbiAgICAgICAgICogdGhlIGxhc3QgdGltZSB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uIHdhcyBpbnZva2VkLlxuICAgICAgICAgKiBPcHRpb25hbGx5IGNhbiBiZSBpbnZva2VkIGZpcnN0IHRpbWUgaW1tZWRpYXRlbHkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgZGVib3VuY2VcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBmdW5jdGlvbiB0byBkZWJvdW5jZVxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gd2FpdCB0aW1lIGluIG1zIHRvIHdhaXRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRzXVxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRzLmltbWVkaWF0ZV0gdHJpZ2dlciBmdW5jIGltbWVkaWF0ZWx5P1xuICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIGRlYm91bmNlOiBmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBvcHRzKSB7XG4gICAgICAgICAgICB2YXIgdGltZW91dDtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmICghb3B0cyB8fCAhb3B0cy5pbW1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciBjYWxsTm93ID0gb3B0cyAmJiBvcHRzLmltbWVkaWF0ZSAmJiAhdGltZW91dDtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsTm93KSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2hlbiBpbnZva2VkLCB3aWxsIG9ubHkgYmUgdHJpZ2dlcmVkXG4gICAgICAgICAqIGF0IG1vc3Qgb25jZSBkdXJpbmcgYSBnaXZlbiB3aW5kb3cgb2YgdGltZS4gTm9ybWFsbHksIHRoZVxuICAgICAgICAgKiB0aHJvdHRsZWQgZnVuY3Rpb24gd2lsbCBydW4gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlclxuICAgICAgICAgKiBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uLCBidXQgaWYgeW914oCZZCBsaWtlIHRvXG4gICAgICAgICAqIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzIGB7bGVhZGluZzogZmFsc2V9YC5cbiAgICAgICAgICogVG8gZGlzYWJsZSBleGVjdXRpb24gb24gdGhlIHRyYWlsaW5nIGVkZ2UsIGRpdHRvLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHRocm90dGxlXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgZnVuY3Rpb24gdG8gdGhyb3R0bGVcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHdhaXQgdGltZSB3aW5kb3dcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRzXVxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRzLmxlYWRpbmc9dHJ1ZV0gZXhlY3V0ZSBvbiB0aGUgbGVhZGluZyBlZGdlXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdHMudHJhaWxpbmc9dHJ1ZV0gZXhlY3V0ZSBvbiB0aGUgdHJhaWxpbmcgZWRnZVxuICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIHRocm90dGxlOiBmdW5jdGlvbiB0aHJvdHRsZShmdW5jLCB3YWl0LCBvcHRzKSB7XG4gICAgICAgICAgICB2YXIgY29udGV4dCwgYXJncywgcmVzdWx0O1xuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgdmFyIHByZXZpb3VzID0gMDtcbiAgICAgICAgICAgIGlmICghb3B0cykge1xuICAgICAgICAgICAgICAgIG9wdHMgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBwcmV2aW91cyA9IG9wdHMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogJC5ub3coKTtcbiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIGlmICghdGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vdyA9ICQubm93KCk7XG4gICAgICAgICAgICAgICAgaWYgKCFwcmV2aW91cyAmJiBvcHRzLmxlYWRpbmcgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbm93O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7XG4gICAgICAgICAgICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nIDw9IDAgfHwgcmVtYWluaW5nID4gd2FpdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBpc3RhbmJ1bCBpZ25vcmUgaWZcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbm93O1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0cy50cmFpbGluZyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHJlbWFpbmluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCcm93c2VycyBhbGxvdyB0byBcIlByZXZlbnQgdGhpcyBwYWdlIGZvcm0gY3JlYXRpbmcgYWRkaXRpb25hbFxuICAgICAgICAgKiBkaWFsb2dzLlwiIGNoZWNrYm94IHdoaWNoIHByZXZlbnRzIGZ1cnRoZXIgaW5wdXQgZnJvbSBjb25maXJtIG1lc3NhZ2VzLlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBmYWxscyBiYWNrIHRvIFwidHJ1ZVwiIG9uY2UgdGhlIHVzZXIgY2hvb3NlcyB0aGlzIG9wdGlvbi5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBzZWN1cmVDb25maXJtXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIHRvIGJlIGRpc3BsYXllZFxuICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgc2VjdXJlQ29uZmlybTogZnVuY3Rpb24gc2VjdXJlQ29uZmlybShtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSBOdW1iZXIobmV3IERhdGUoKSk7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gY29uZmlybShtZXNzYWdlKTtcbiAgICAgICAgICAgIHZhciBlbmQgPSBOdW1iZXIobmV3IERhdGUoKSk7XG5cbiAgICAgICAgICAgIHJldHVybiAoZW5kIDwgKHN0YXJ0ICsgMTApIHx8IHJlc3VsdCA9PT0gdHJ1ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIElzIGxvY2FsU3RvcmFnZSB0cnVseSBzdXBwb3J0ZWQ/XG4gICAgICAgICAqIENoZWNrIGlzIHRha2VuIGZyb20gbW9kZXJuaXpyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcHJvcGVydHkgX2lzU3RvcmFnZVN1cHBvcnRlZFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIF9pc1N0b3JhZ2VTdXBwb3J0ZWQ6IChmdW5jdGlvbiBsb2NhbFN0b3JhZ2VDaGVjaygpIHtcbiAgICAgICAgICAgIHZhciBtb2QgPSAnbW9kZXJuaXpyJztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0obW9kLCBtb2QpO1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKG1vZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gaXN0YW5idWwgaWdub3JlIG5leHRcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oKSksXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIFwiQ01TXCIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgYWRkRXZlbnRMaXN0ZW5lclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIHN0cmluZyBjb250YWluaW5nIHNwYWNlIHNlcGFyYXRlZCBldmVudCBuYW1lc1xuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBjYWxsYmFjayB0byBydW4gd2hlbiB0aGUgZXZlbnQgaGFwcGVuc1xuICAgICAgICAgKi9cbiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZuKSB7XG4gICAgICAgICAgICByZXR1cm4gQ01TLl9ldmVudFJvb3Qub24oX25zKGV2ZW50TmFtZSksIGZuKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVtb3ZlcyB0aGUgZXZlbnQgbGlzdGVuZXIgZnJvbSB0aGUgXCJDTVNcIi4gSWYgYSBjYWxsYmFjayBpcyBwcm92aWRlZCAtIHJlbW92ZXMgb25seSB0aGF0IGNhbGxiYWNrLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHJlbW92ZUV2ZW50TGlzdGVuZXJcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZSBzdHJpbmcgY29udGFpbmluZyBzcGFjZSBzZXBhcmF0ZWQgZXZlbnQgbmFtZXNcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2ZuXSBzcGVjaWZpYyBjYWxsYmFjayB0byBiZSByZW1vdmVkXG4gICAgICAgICAqL1xuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZm4pIHtcbiAgICAgICAgICAgIHJldHVybiBDTVMuX2V2ZW50Um9vdC5vZmYoX25zKGV2ZW50TmFtZSksIGZuKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzcGF0Y2hlcyBhbiBldmVudFxuICAgICAgICAgKiBAbWV0aG9kIGRpc3BhdGNoRXZlbnRcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZSAgc3RyaW5nIGNvbnRhaW5pbmcgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50IG5hbWVzXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXlsb2FkIHdoYXRldmVyIHBheWxvYWQgcmVxdWlyZWQgZm9yIHRoZSBjb25zdW1lclxuICAgICAgICAgKi9cbiAgICAgICAgZGlzcGF0Y2hFdmVudDogZnVuY3Rpb24gZGlzcGF0Y2hFdmVudChldmVudE5hbWUsIHBheWxvYWQpIHtcbiAgICAgICAgICAgIHJldHVybiBDTVMuX2V2ZW50Um9vdC50cmlnZ2VyKF9ucyhldmVudE5hbWUpLCBbcGF5bG9hZF0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3cmFwcyB0aGUgcGFzc2VkIGZ1bmN0aW9uIHNvIHRoZSB3cmFwcGVkIGZ1bmN0aW9uXG4gICAgICAgICAqIGlzIGV4ZWN1dGVkIG9ubHkgb25jZSwgbm8gbWF0dGVyIGhvdyBtYW55IHRpbWVzIHRoZSB3cmFwcGVyIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIG9uY2VcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgb25seSBvbmNlXG4gICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICAgICAgICAgKi9cbiAgICAgICAgb25jZTogZnVuY3Rpb24gb25jZShmbikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICAgIHZhciBkaWRSdW5PbmNlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpZFJ1bk9uY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZm4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlkUnVuT25jZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQcmV2ZW50cyBzY3JvbGxpbmcgd2l0aCB0b3VjaCBpbiBhbiBlbGVtZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHByZXZlbnRUb3VjaFNjcm9sbGluZ1xuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWxlbWVudCBlbGVtZW50IHdoZXJlIHdlIGFyZSBwcmV2ZW50aW5nIHRoZSBzY3JvbGxcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVzcGFjZSBzbyB3ZSBkb24ndCBtaXggZXZlbnRzIGZyb20gdHdvIGRpZmZlcmVudCBwbGFjZXMgb24gdGhlIHNhbWUgZWxlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgcHJldmVudFRvdWNoU2Nyb2xsaW5nOiBmdW5jdGlvbiBwcmV2ZW50VG91Y2hTY3JvbGxpbmcoZWxlbWVudCwgbmFtZXNwYWNlKSB7XG4gICAgICAgICAgICBlbGVtZW50Lm9uKCd0b3VjaG1vdmUuY21zLnByZXZlbnRzY3JvbGwuJyArIG5hbWVzcGFjZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgKiBBbGxvd3Mgc2Nyb2xsaW5nIHdpdGggdG91Y2ggaW4gYW4gZWxlbWVudC5cbiAgICAgICAgKlxuICAgICAgICAqIEBtZXRob2QgYWxsb3dUb3VjaFNjcm9sbGluZ1xuICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbGVtZW50IGVsZW1lbnQgd2hlcmUgd2UgYXJlIGFsbG93aW5nIHRoZSBzY3JvbGwgYWdhaW5cbiAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZXNwYWNlIHNvIHdlIGRvbid0IGFjY2lkZW50YWxseSByZW1vdmUgZXZlbnRzIGZyb20gYSBkaWZmZXJlbnQgaGFuZGxlclxuICAgICAgICAqL1xuICAgICAgICBhbGxvd1RvdWNoU2Nyb2xsaW5nOiBmdW5jdGlvbiBhbGxvd1RvdWNoU2Nyb2xsaW5nKGVsZW1lbnQsIG5hbWVzcGFjZSkge1xuICAgICAgICAgICAgZWxlbWVudC5vZmYoJ3RvdWNobW92ZS5jbXMucHJldmVudHNjcm9sbC4nICsgbmFtZXNwYWNlKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJucyB3aW5kb3cgb2JqZWN0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nZXRXaW5kb3dcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHJldHVybnMge1dpbmRvd31cbiAgICAgICAgICovXG4gICAgICAgIF9nZXRXaW5kb3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3c7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICAvLyBzaG9ydGhhbmQgZm9yIGpRdWVyeShkb2N1bWVudCkucmVhZHkoKTtcbiAgICAkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQ01TLl9ldmVudFJvb3QgPSAkKCcjY21zLXRvcCcpO1xuICAgICAgICAvLyBhdXRvaW5pdHNcbiAgICAgICAgQ01TLkFQSS5IZWxwZXJzLnByZXZlbnRTdWJtaXQoKTtcbiAgICB9KTtcbn0pKENNUy4kKTtcbiIsIi8qIT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogT3JpZ2luYWxseSB0YWtlbiBmcm9tXG4gKiBCb290c3RyYXA6IHRyYW5zaXRpb24uanMgdjMuMy41XG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyN0cmFuc2l0aW9uc1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cbi8qIGdsb2JhbCBDTVMgKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLy8gQ1NTIFRSQU5TSVRJT04gU1VQUE9SVCAoU2hvdXRvdXQ6IGh0dHA6Ly93d3cubW9kZXJuaXpyLmNvbS8pXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICBmdW5jdGlvbiB0cmFuc2l0aW9uRW5kKCkge1xuICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjbXMnKTtcblxuICAgICAgICB2YXIgdHJhbnNFbmRFdmVudE5hbWVzID0ge1xuICAgICAgICAgICAgV2Via2l0VHJhbnNpdGlvbjogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLFxuICAgICAgICAgICAgTW96VHJhbnNpdGlvbjogJ3RyYW5zaXRpb25lbmQnLFxuICAgICAgICAgICAgT1RyYW5zaXRpb246ICdvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCdcbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHRyYW5zRW5kRXZlbnROYW1lcykge1xuICAgICAgICAgICAgaWYgKGVsLnN0eWxlW25hbWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBlbmQ6IHRyYW5zRW5kRXZlbnROYW1lc1tuYW1lXSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBleHBsaWNpdCBmb3IgaWU4ICggIC5fLilcbiAgICB9XG5cbiAgICAvLyBodHRwOi8vYmxvZy5hbGV4bWFjY2F3LmNvbS9jc3MtdHJhbnNpdGlvbnNcbiAgICAkLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24gKGR1cmF0aW9uKSB7XG4gICAgICAgIHZhciBjYWxsZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyICRlbCA9IHRoaXM7XG4gICAgICAgICQodGhpcykub25lKCdjbXNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghY2FsbGVkKSB7XG4gICAgICAgICAgICAgICAgJCgkZWwpLnRyaWdnZXIoJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKSA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIGR1cmF0aW9uICsgMTApO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgJChmdW5jdGlvbiAoKSB7XG4gICAgICAgICQuc3VwcG9ydC50cmFuc2l0aW9uID0gdHJhbnNpdGlvbkVuZCgpO1xuXG4gICAgICAgIGlmICghJC5zdXBwb3J0LnRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgICQuZXZlbnQuc3BlY2lhbC5jbXNUcmFuc2l0aW9uRW5kID0ge1xuICAgICAgICAgICAgYmluZFR5cGU6ICQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxcbiAgICAgICAgICAgIGRlbGVnYXRlVHlwZTogJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLFxuICAgICAgICAgICAgaGFuZGxlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmICgkKGUudGFyZ2V0KS5pcyh0aGlzKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIC8vIGhhcyB0byBiZSBhdHRhY2hlZCB0byBDTVNcbn0oQ01TLiQpKTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gTkFNRVNQQUNFU1xuLyoqXG4gKiBAbW9kdWxlIENNU1xuICovXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xudmFyIENNUyA9IHdpbmRvdy5DTVMgfHwge307XG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBNT0RBTFxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLyoqXG4gICAgICogRGlzcGxheXMgYSBtZXNzYWdlIHVuZGVybmVhdGggdGhlIHRvb2xiYXIuXG4gICAgICpcbiAgICAgKiBAY2xhc3MgTWVzc2FnZXNcbiAgICAgKiBAbmFtZXNwYWNlIENNU1xuICAgICAqL1xuICAgIENNUy5NZXNzYWdlcyA9IG5ldyBDTVMuQ2xhc3Moe1xuXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIG1lc3NhZ2VEdXJhdGlvbjogMzAwLFxuICAgICAgICAgICAgbWVzc2FnZURlbGF5OiAzMDAwXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgLy8gc3RhdGVzIGFuZCBldmVudHNcbiAgICAgICAgICAgIHRoaXMuY2xpY2sgPSAnY2xpY2suY21zLm1lc3NhZ2UnO1xuXG4gICAgICAgICAgICAvLyBlbGVtZW50c1xuICAgICAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdG9yZXMgYWxsIGpRdWVyeSByZWZlcmVuY2VzIHdpdGhpbiBgdGhpcy51aWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwVUlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cFVJOiBmdW5jdGlvbiBfc2V0dXBVSSgpIHtcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKCcuY21zJyk7XG4gICAgICAgICAgICB0aGlzLnVpID0ge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgICAgIGJvZHk6ICQoJ2h0bWwnKSxcbiAgICAgICAgICAgICAgICB0b29sYmFyOiBjb250YWluZXIuZmluZCgnLmNtcy10b29sYmFyJyksXG4gICAgICAgICAgICAgICAgbWVzc2FnZXM6IGNvbnRhaW5lci5maW5kKCcuY21zLW1lc3NhZ2VzJylcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW5zIGEgbWVzc2FnZSB3aW5kb3cgdW5kZXJuZWF0aCB0aGUgdG9vbGJhci5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBvcGVuXG4gICAgICAgICAqIEBwYXJhbSBvcHRzXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfEhUTUxOb2RlfSBvcHRzLm1lc3NhZ2UgbWVzc2FnZSB0byBiZSBkaXNwbGF5ZWRcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRzLmRpcj0nY2VudGVyJ10gZGlyZWN0aW9uIHRvIGJlIGRpc3BsYXllZCBgY2VudGVyYCBgbGVmdGAgb3IgYHJpZ2h0YFxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW29wdHMuZGVsYXk9dGhpcy5vcHRpb25zLm1lc3NhZ2VEZWxheV0gZGVsYXkgdW50aWwgbWVzc2FnZSBpcyBjbG9zZWQsIDAgbGVhdmVzIGl0IG9wZW5cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0cy5lcnJvcl0gaWYgdHJ1ZSBzZXRzIHRoZSBzdHlsZSB0byBgLmNtcy1tZXNzYWdlcy1lcnJvcmBcbiAgICAgICAgICovXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4ob3B0cykge1xuICAgICAgICAgICAgaWYgKCEob3B0cyAmJiBvcHRzLm1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgYXJndW1lbnRzIHBhc3NlZCB0byBcIm9wZW5cIiB3ZXJlIGludmFsaWQuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG1zZyA9IG9wdHMubWVzc2FnZTtcbiAgICAgICAgICAgIHZhciBkaXIgPSBvcHRzLmRpciA9PT0gdW5kZWZpbmVkID8gJ2NlbnRlcicgOiBvcHRzLmRpcjtcbiAgICAgICAgICAgIHZhciBkZWxheSA9IG9wdHMuZGVsYXkgPT09IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5tZXNzYWdlRGVsYXkgOiBvcHRzLmRlbGF5O1xuICAgICAgICAgICAgdmFyIGVycm9yID0gb3B0cy5lcnJvciA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRzLmVycm9yO1xuXG4gICAgICAgICAgICB2YXIgd2lkdGggPSAzMjA7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy51aS5tZXNzYWdlcy5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgICAgIHZhciB0b3AgPSB0aGlzLnVpLnRvb2xiYXIub3V0ZXJIZWlnaHQodHJ1ZSk7XG4gICAgICAgICAgICB2YXIgY2xvc2UgPSB0aGlzLnVpLm1lc3NhZ2VzLmZpbmQoJy5jbXMtbWVzc2FnZXMtY2xvc2UnKTtcblxuICAgICAgICAgICAgLy8gYWRkIGNvbnRlbnQgdG8gZWxlbWVudFxuICAgICAgICAgICAgdGhpcy51aS5tZXNzYWdlcy5maW5kKCcuY21zLW1lc3NhZ2VzLWlubmVyJykuaHRtbChtc2cpO1xuXG4gICAgICAgICAgICAvLyBlcnJvciBoYW5kbGluZ1xuICAgICAgICAgICAgdGhpcy51aS5tZXNzYWdlcy5yZW1vdmVDbGFzcygnY21zLW1lc3NhZ2VzLWVycm9yJyk7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmFkZENsYXNzKCdjbXMtbWVzc2FnZXMtZXJyb3InKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY2xlYXIgdGltZW91dFxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpO1xuXG4gICAgICAgICAgICBjbG9zZS5oaWRlKCk7XG4gICAgICAgICAgICBjbG9zZS5vZmYodGhpcy5jbGljaykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBzZXQgdG9wIHRvIDAgaWYgdG9vbGJhciBpcyBjb2xsYXBzZWRcbiAgICAgICAgICAgIGlmIChDTVMuc2V0dGluZ3MudG9vbGJhciA9PT0gJ2NvbGxhcHNlZCcpIHtcbiAgICAgICAgICAgICAgICB0b3AgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzZXQgY29ycmVjdCBwb3NpdGlvbiBhbmQgc2hvd1xuICAgICAgICAgICAgdGhpcy51aS5tZXNzYWdlcy5jc3MoJ3RvcCcsIC1oZWlnaHQpLnNob3coKTtcblxuICAgICAgICAgICAgLy8gc2V0IGNvcnJlY3QgZGlyZWN0aW9uIGFuZCBhbmltYXRpb25cbiAgICAgICAgICAgIHN3aXRjaCAoZGlyKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkubWVzc2FnZXMuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICd0b3AnOiB0b3AsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbGVmdCc6IC13aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdyaWdodCc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdtYXJnaW4tbGVmdCc6IDBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkubWVzc2FnZXMuYW5pbWF0ZSh7ICdsZWZ0JzogMCB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAndG9wJzogdG9wLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3JpZ2h0JzogLXdpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2xlZnQnOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbWFyZ2luLWxlZnQnOiAwXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmFuaW1hdGUoeyAncmlnaHQnOiAwIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbGVmdCc6ICc1MCUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3JpZ2h0JzogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ21hcmdpbi1sZWZ0JzogLSh3aWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmFuaW1hdGUoeyAndG9wJzogdG9wIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjYW5jZWwgYXV0b2hpZGUgaWYgZGVsYXkgaXMgPD0gMFxuICAgICAgICAgICAgaWYgKGRlbGF5IDw9IDApIHtcbiAgICAgICAgICAgICAgICBjbG9zZS5zaG93KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGFkZCBkZWxheSB0byBoaWRlIGlmIGRlbGF5ID4gMFxuICAgICAgICAgICAgICAgIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xvc2VzIHRoZSBtZXNzYWdlIHdpbmRvdyB1bmRlcm5lYXRoIHRoZSB0b29sYmFyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIGNsb3NlXG4gICAgICAgICAqL1xuICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmZhZGVPdXQodGhpcy5vcHRpb25zLm1lc3NhZ2VEdXJhdGlvbik7XG4gICAgICAgIH1cblxuICAgIH0pO1xufSkoQ01TLiQpO1xuIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOQU1FU1BBQ0VTXG4vKipcbiAqIEBtb2R1bGUgQ01TXG4gKi9cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG52YXIgQ01TID0gd2luZG93LkNNUyB8fCB7fTtcblxuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbi8vIE1PREFMXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbW9kYWwgaXMgdHJpZ2dlcmVkIHZpYSBBUEkgY2FsbHMgZnJvbSB0aGUgYmFja2VuZCBlaXRoZXJcbiAgICAgKiB0aHJvdWdoIHRoZSB0b29sYmFyIG5hdmlnYXRpb24gb3IgZnJvbSBwbHVnaW5zLiBUaGUgQVBJcyBhbGxvdyB0b1xuICAgICAqIG9wZW4gY29udGVudCBmcm9tIGEgdXJsIChpZnJhbWUpIG9yIGluamVjdCBodG1sIGRpcmVjdGx5LlxuICAgICAqXG4gICAgICogQGNsYXNzIE1vZGFsXG4gICAgICogQG5hbWVzcGFjZSBDTVNcbiAgICAgKiBAdXNlcyBDTVMuQVBJLkhlbHBlcnNcbiAgICAgKi9cbiAgICBDTVMuTW9kYWwgPSBuZXcgQ01TLkNsYXNzKHtcblxuICAgICAgICBpbXBsZW1lbnQ6IFtDTVMuQVBJLkhlbHBlcnNdLFxuXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIG9uQ2xvc2U6IGZhbHNlLFxuICAgICAgICAgICAgbWluSGVpZ2h0OiA0MDAsXG4gICAgICAgICAgICBtaW5XaWR0aDogODAwLFxuICAgICAgICAgICAgbW9kYWxEdXJhdGlvbjogMjAwLFxuICAgICAgICAgICAgbmV3UGx1Z2luOiBmYWxzZSxcbiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIG1heGltaXphYmxlOiB0cnVlLFxuICAgICAgICAgICAgbWluaW1pemFibGU6IHRydWVcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAvLyBlbGVtZW50c1xuICAgICAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICAgICAgLy8gZXZlbnQgZW1pdHRlclxuICAgICAgICAgICAgdGhpcy5fc2V0dXBFdmVudEVtaXR0ZXIoKTtcblxuICAgICAgICAgICAgLy8gc3RhdGVzIGFuZCBldmVudHNcbiAgICAgICAgICAgIHRoaXMuY2xpY2sgPSAnY2xpY2suY21zLm1vZGFsJztcbiAgICAgICAgICAgIHRoaXMucG9pbnRlckRvd24gPSAncG9pbnRlcmRvd24uY21zLm1vZGFsIGNvbnRleHRtZW51LmNtcy5tb2RhbCc7XG4gICAgICAgICAgICB0aGlzLnBvaW50ZXJVcCA9ICdwb2ludGVydXAuY21zLm1vZGFsIHBvaW50ZXJjYW5jZWwuY21zLm1vZGFsJztcbiAgICAgICAgICAgIHRoaXMucG9pbnRlck1vdmUgPSAncG9pbnRlcm1vdmUuY21zLm1vZGFsJztcbiAgICAgICAgICAgIHRoaXMuZG91YmxlQ2xpY2sgPSAnZGJsY2xpY2suY21zLm1vZGFsJztcbiAgICAgICAgICAgIHRoaXMudG91Y2hFbmQgPSAndG91Y2hlbmQuY21zLm1vZGFsJztcbiAgICAgICAgICAgIHRoaXMubWF4aW1pemVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm1pbmltaXplZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWF4aW1pemVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNhdmVkID0gZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHVwIGV2ZW50IHB1YnN1YiBtZWNoYW5pc20gZm9yIHRoZSBpbnN0YW5jZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBFdmVudEVtaXR0ZXJcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cEV2ZW50RW1pdHRlcjogZnVuY3Rpb24gX3NldHVwRXZlbnRFbWl0dGVyKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGJ1cyA9ICQoe30pO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm94eShuYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVzW25hbWVdLmFwcGx5KGJ1cywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQ7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyID0gcHJveHkoJ3RyaWdnZXInKTtcbiAgICAgICAgICAgIHRoaXMub25lID0gcHJveHkoJ29uZScpO1xuICAgICAgICAgICAgdGhpcy5vbiA9IHByb3h5KCdvbicpO1xuICAgICAgICAgICAgdGhpcy5vZmYgPSBwcm94eSgnb2ZmJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyBhbGwgalF1ZXJ5IHJlZmVyZW5jZXMgd2l0aGluIGB0aGlzLnVpYC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsID0gJCgnLmNtcy1tb2RhbCcpO1xuICAgICAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgICAgICBtb2RhbDogbW9kYWwsXG4gICAgICAgICAgICAgICAgYm9keTogJCgnaHRtbCcpLFxuICAgICAgICAgICAgICAgIHdpbmRvdzogJCh3aW5kb3cpLFxuICAgICAgICAgICAgICAgIHRvb2xiYXJMZWZ0UGFydDogJCgnLmNtcy10b29sYmFyLWxlZnQnKSxcbiAgICAgICAgICAgICAgICBtaW5pbWl6ZUJ1dHRvbjogbW9kYWwuZmluZCgnLmNtcy1tb2RhbC1taW5pbWl6ZScpLFxuICAgICAgICAgICAgICAgIG1heGltaXplQnV0dG9uOiBtb2RhbC5maW5kKCcuY21zLW1vZGFsLW1heGltaXplJyksXG4gICAgICAgICAgICAgICAgdGl0bGU6IG1vZGFsLmZpbmQoJy5jbXMtbW9kYWwtdGl0bGUnKSxcbiAgICAgICAgICAgICAgICB0aXRsZVByZWZpeDogbW9kYWwuZmluZCgnLmNtcy1tb2RhbC10aXRsZS1wcmVmaXgnKSxcbiAgICAgICAgICAgICAgICB0aXRsZVN1ZmZpeDogbW9kYWwuZmluZCgnLmNtcy1tb2RhbC10aXRsZS1zdWZmaXgnKSxcbiAgICAgICAgICAgICAgICByZXNpemU6IG1vZGFsLmZpbmQoJy5jbXMtbW9kYWwtcmVzaXplJyksXG4gICAgICAgICAgICAgICAgYnJlYWRjcnVtYjogbW9kYWwuZmluZCgnLmNtcy1tb2RhbC1icmVhZGNydW1iJyksXG4gICAgICAgICAgICAgICAgY2xvc2VBbmRDYW5jZWw6IG1vZGFsLmZpbmQoJy5jbXMtbW9kYWwtY2xvc2UsIC5jbXMtbW9kYWwtY2FuY2VsJyksXG4gICAgICAgICAgICAgICAgbW9kYWxCdXR0b25zOiBtb2RhbC5maW5kKCcuY21zLW1vZGFsLWJ1dHRvbnMnKSxcbiAgICAgICAgICAgICAgICBtb2RhbEJvZHk6IG1vZGFsLmZpbmQoJy5jbXMtbW9kYWwtYm9keScpLFxuICAgICAgICAgICAgICAgIGZyYW1lOiBtb2RhbC5maW5kKCcuY21zLW1vZGFsLWZyYW1lJyksXG4gICAgICAgICAgICAgICAgc2hpbTogbW9kYWwuZmluZCgnLmNtcy1tb2RhbC1zaGltJylcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgYWxsIHRoZSBldmVudCBoYW5kbGVycywgc3VjaCBhcyBtYXhpbWl6ZS9taW5pbWl6ZSBhbmQgcmVzaXppbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgLy8gbW9kYWwgYmVoYXZpb3Vyc1xuICAgICAgICAgICAgdGhpcy51aS5taW5pbWl6ZUJ1dHRvbi5cbiAgICAgICAgICAgICAgICBvZmYodGhpcy5jbGljayArICcgJyArIHRoaXMudG91Y2hFbmQpXG4gICAgICAgICAgICAgICAgLm9uKHRoaXMuY2xpY2sgKyAnICcgKyB0aGlzLnRvdWNoRW5kLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGF0Lm1pbmltaXplKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMudWkubWF4aW1pemVCdXR0b25cbiAgICAgICAgICAgICAgICAub2ZmKHRoaXMuY2xpY2sgKyAnICcgKyB0aGlzLnRvdWNoRW5kKVxuICAgICAgICAgICAgICAgIC5vbih0aGlzLmNsaWNrICsgJyAnICsgdGhpcy50b3VjaEVuZCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5tYXhpbWl6ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudWkudGl0bGUub2ZmKHRoaXMucG9pbnRlckRvd24pLm9uKHRoaXMucG9pbnRlckRvd24sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3N0YXJ0TW92ZShlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy51aS50aXRsZS5vZmYodGhpcy5kb3VibGVDbGljaykub24odGhpcy5kb3VibGVDbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQubWF4aW1pemUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnVpLnJlc2l6ZS5vZmYodGhpcy5wb2ludGVyRG93bikub24odGhpcy5wb2ludGVyRG93biwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fc3RhcnRSZXNpemUoZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy51aS5jbG9zZUFuZENhbmNlbFxuICAgICAgICAgICAgICAgIC5vZmYodGhpcy5jbGljayArICcgJyArIHRoaXMudG91Y2hFbmQpXG4gICAgICAgICAgICAgICAgLm9uKHRoaXMuY2xpY2sgKyAnICcgKyB0aGlzLnRvdWNoRW5kLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5vbkNsb3NlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGVsZW1lbnRzIHdpdGhpbiB0aGUgd2luZG93XG4gICAgICAgICAgICB0aGlzLnVpLmJyZWFkY3J1bWIub2ZmKHRoaXMuY2xpY2ssICdhJykub24odGhpcy5jbGljaywgJ2EnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9jaGFuZ2VJZnJhbWUoJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT3BlbnMgdGhlIG1vZGFsIGVpdGhlciBpbiBhbiBpZnJhbWUgb3IgcmVuZGVycyBtYXJrdXAuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2Qgb3BlblxuICAgICAgICAgKiBAY2hhaW5hYmxlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIGVpdGhlciBgb3B0cy51cmxgIG9yIGBvcHRzLmh0bWxgIGFyZSByZXF1aXJlZFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBbb3B0cy5icmVhZGNydW1ic10gY29sbGVjdGlvbiBvZiBicmVhZGNydW1iIGl0ZW1zXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfEhUTUxOb2RlfGpRdWVyeX0gW29wdHMuaHRtbF0gaHRtbCBtYXJrdXAgdG8gcmVuZGVyXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0cy50aXRsZV0gbW9kYWwgd2luZG93IG1haW4gdGl0bGUgKGJvbGQpXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0cy5zdWJ0aXRsZV0gbW9kYWwgd2luZG93IHNlY29uZGFyeSB0aXRsZSAobm9ybWFsKVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdHMudXJsXSB1cmwgdG8gcmVuZGVyIGlmcmFtZSwgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGBvcHRzLmh0bWxgXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy53aWR0aF0gc2V0cyB0aGUgd2lkdGggb2YgdGhlIG1vZGFsXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy5oZWlnaHRdIHNldHMgdGhlIGhlaWdodCBvZiB0aGUgbW9kYWxcbiAgICAgICAgICovXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4ob3B0cykge1xuICAgICAgICAgICAgLy8gc2V0dXAgaW50ZXJuYWxzXG4gICAgICAgICAgICBpZiAoIShvcHRzICYmIG9wdHMudXJsIHx8IG9wdHMgJiYgb3B0cy5odG1sKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGFyZ3VtZW50cyBwYXNzZWQgdG8gXCJvcGVuXCIgd2VyZSBpbnZhbGlkLicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBoYW5kbGUgcmVtb3ZlIG9wdGlvbiB3aGVuIHBsdWdpbiBpcyBuZXdcbiAgICAgICAgICAgIC8vIGNhbmNlbCBvcGVuIHByb2Nlc3Mgd2hlbiBzd2l0Y2hpbmcgY29udGV4dFxuICAgICAgICAgICAgaWYgKENNUy5fbmV3UGx1Z2luICYmICF0aGlzLl9kZWxldGVQbHVnaW4oKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gV2UgaGF2ZSB0byByZWJpbmQgZXZlbnRzIGV2ZXJ5IHRpbWUgd2Ugb3BlbiBhIG1vZGFsXG4gICAgICAgICAgICAvLyBiZWNhdXNlIHRoZSBldmVudCBoYW5kbGVycyBjb250YWluIHJlZmVyZW5jZXMgdG8gdGhlIGluc3RhbmNlXG4gICAgICAgICAgICAvLyBhbmQgc2luY2Ugd2UgcmV1c2UgdGhlIHNhbWUgbWFya3VwIHdlIG5lZWQgdG8gdXBkYXRlXG4gICAgICAgICAgICAvLyB0aGF0IGluc3RhbmNlIHJlZmVyZW5jZSBldmVyeSB0aW1lLlxuICAgICAgICAgICAgdGhpcy5fZXZlbnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcignY21zLm1vZGFsLmxvYWQnKTtcbiAgICAgICAgICAgIC8vIHRyaWdnZXIgdGhlIGV2ZW50IGFsc28gb24gdGhlIGRvbSBlbGVtZW50LFxuICAgICAgICAgICAgLy8gYmVjYXVzZSBpZiB3ZSBsb2FkIGFub3RoZXIgbW9kYWwgd2hpbGUgb25lIGlzIGFscmVhZHkgb3BlblxuICAgICAgICAgICAgLy8gdGhlIG9sZGVyIGluc3RhbmNlIHdvbid0IHJlY2VpdmUgYW55IHVwZGF0ZXNcbiAgICAgICAgICAgIHRoaXMudWkubW9kYWwudHJpZ2dlcignY21zLm1vZGFsLmxvYWQnKTtcblxuICAgICAgICAgICAgLy8gY29tbW9uIGVsZW1lbnRzIHN0YXRlXG4gICAgICAgICAgICB0aGlzLnVpLnJlc2l6ZS50b2dnbGUodGhpcy5vcHRpb25zLnJlc2l6YWJsZSk7XG4gICAgICAgICAgICB0aGlzLnVpLm1pbmltaXplQnV0dG9uLnRvZ2dsZSh0aGlzLm9wdGlvbnMubWluaW1pemFibGUpO1xuICAgICAgICAgICAgdGhpcy51aS5tYXhpbWl6ZUJ1dHRvbi50b2dnbGUodGhpcy5vcHRpb25zLm1heGltaXphYmxlKTtcblxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gdGhpcy5fY2FsY3VsYXRlTmV3UG9zaXRpb24ob3B0cyk7XG5cbiAgICAgICAgICAgIHRoaXMudWkubWF4aW1pemVCdXR0b24ucmVtb3ZlQ2xhc3MoJ2Ntcy1tb2RhbC1tYXhpbWl6ZS1hY3RpdmUnKTtcbiAgICAgICAgICAgIHRoaXMubWF4aW1pemVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIG5ldyBwbHVnaW4gd2lsbCBmcmVlemUgdGhlIGNyZWF0aW9uIHByb2Nlc3NcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubmV3UGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgQ01TLl9uZXdQbHVnaW4gPSB0aGlzLm9wdGlvbnMubmV3UGx1Z2luO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBiZWNhdXNlIGEgbmV3IGluc3RhbmNlIGlzIGNhbGxlZCwgd2UgaGF2ZSB0byBlbnN1cmUgbWluaW1pemVkIHN0YXRlIGlzIHJlbW92ZWQgIzM2MjBcbiAgICAgICAgICAgIGlmICh0aGlzLnVpLmJvZHkuaGFzQ2xhc3MoJ2Ntcy1tb2RhbC1taW5pbWl6ZWQnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWluaW1pemVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1pbmltaXplKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNsZWFyIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLnVpLm1vZGFsQnV0dG9ucy5lbXB0eSgpO1xuICAgICAgICAgICAgdGhpcy51aS5icmVhZGNydW1iLmVtcHR5KCk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBjbGFzcyBmcm9tIG1vZGFsIHdoZW4gbm8gYnJlYWRjcnVtYnMgaXMgcmVuZGVyZWRcbiAgICAgICAgICAgIHRoaXMudWkubW9kYWwucmVtb3ZlQ2xhc3MoJ2Ntcy1tb2RhbC1oYXMtYnJlYWRjcnVtYicpO1xuXG4gICAgICAgICAgICAvLyBoaWRlIHRvb2x0aXBcbiAgICAgICAgICAgIENNUy5BUEkuVG9vbHRpcC5oaWRlKCk7XG5cbiAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIGlmcmFtZSByZW5kZXJpbmcgaWYgdXJsIGlzIHByb3ZpZGVkXG4gICAgICAgICAgICBpZiAob3B0cy51cmwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2FkSWZyYW1lKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBvcHRzLnVybCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9wdHMudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGJyZWFkY3J1bWJzOiBvcHRzLmJyZWFkY3J1bWJzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGlmIHVybCBpcyBub3QgcHJvdmlkZWQgd2UgZ28gZm9yIGh0bWxcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2FkTWFya3VwKHtcbiAgICAgICAgICAgICAgICAgICAgaHRtbDogb3B0cy5odG1sLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogb3B0cy50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc3VidGl0bGU6IG9wdHMuc3VidGl0bGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdjbXMubW9kYWwubG9hZGVkJyk7XG5cbiAgICAgICAgICAgIC8vIGRpc3BsYXkgbW9kYWxcbiAgICAgICAgICAgIHRoaXMuX3Nob3coJC5leHRlbmQoe1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLm9wdGlvbnMubW9kYWxEdXJhdGlvblxuICAgICAgICAgICAgfSwgcG9zaXRpb24pKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGN1bGF0ZXMgY29vcmRpbmF0ZXMgYW5kIGRpbWVuc2lvbnMgZm9yIG1vZGFsIHBsYWNlbWVudFxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9jYWxjdWxhdGVOZXdQb3NpdGlvblxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdHNdXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy53aWR0aF0gZGVzaXJlZCB3aWR0aCBvZiB0aGUgbW9kYWxcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLmhlaWdodF0gZGVzaXJlZCBoZWlnaHQgb2YgdGhlIG1vZGFsXG4gICAgICAgICAqL1xuICAgICAgICBfY2FsY3VsYXRlTmV3UG9zaXRpb246IGZ1bmN0aW9uIChvcHRzKSB7XG4gICAgICAgICAgICAvLyBsZXRzIHNldCB0aGUgbW9kYWwgd2lkdGggYW5kIGhlaWdodCB0byB0aGUgc2l6ZSBvZiB0aGUgYnJvd3NlclxuICAgICAgICAgICAgdmFyIHdpZHRoT2Zmc2V0ID0gMzAwOyAvLyBhZGRzIG1hcmdpbiBsZWZ0IGFuZCByaWdodFxuICAgICAgICAgICAgdmFyIGhlaWdodE9mZnNldCA9IDMwMDsgLy8gYWRkcyBtYXJnaW4gdG9wIGFuZCBib3R0b207XG4gICAgICAgICAgICB2YXIgc2NyZWVuV2lkdGggPSB0aGlzLnVpLndpbmRvdy53aWR0aCgpO1xuICAgICAgICAgICAgdmFyIHNjcmVlbkhlaWdodCA9IHRoaXMudWkud2luZG93LmhlaWdodCgpO1xuICAgICAgICAgICAgdmFyIG1vZGFsV2lkdGggPSBvcHRzLndpZHRoIHx8IHRoaXMub3B0aW9ucy5taW5XaWR0aDtcbiAgICAgICAgICAgIHZhciBtb2RhbEhlaWdodCA9IG9wdHMuaGVpZ2h0IHx8IHRoaXMub3B0aW9ucy5taW5IZWlnaHQ7XG4gICAgICAgICAgICAvLyBzY3JlZW4gd2lkdGggYW5kIGhlaWdodCBjYWxjdWxhdGlvbiwgV0MgPSB3aWR0aFxuICAgICAgICAgICAgdmFyIHNjcmVlbldpZHRoQ2FsYyA9IHNjcmVlbldpZHRoID49IChtb2RhbFdpZHRoICsgd2lkdGhPZmZzZXQpO1xuICAgICAgICAgICAgdmFyIHNjcmVlbkhlaWdodENhbGMgPSBzY3JlZW5IZWlnaHQgPj0gKG1vZGFsSGVpZ2h0ICsgaGVpZ2h0T2Zmc2V0KTtcblxuICAgICAgICAgICAgdmFyIHdpZHRoID0gc2NyZWVuV2lkdGhDYWxjICYmICFvcHRzLndpZHRoID8gc2NyZWVuV2lkdGggLSB3aWR0aE9mZnNldCA6IG1vZGFsV2lkdGg7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gc2NyZWVuSGVpZ2h0Q2FsYyAmJiAhb3B0cy5oZWlnaHQgPyBzY3JlZW5IZWlnaHQgLSBoZWlnaHRPZmZzZXQgOiBtb2RhbEhlaWdodDtcblxuICAgICAgICAgICAgdmFyIGN1cnJlbnRMZWZ0ID0gdGhpcy51aS5tb2RhbC5jc3MoJ2xlZnQnKTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50VG9wID0gdGhpcy51aS5tb2RhbC5jc3MoJ3RvcCcpO1xuICAgICAgICAgICAgdmFyIG5ld0xlZnQ7XG4gICAgICAgICAgICB2YXIgbmV3VG9wO1xuXG4gICAgICAgICAgICAvLyBqcXVlcnkgbWFkZSBtZSBkbyBpdFxuICAgICAgICAgICAgaWYgKGN1cnJlbnRMZWZ0ID09PSAnNTAlJykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRMZWZ0ID0gc2NyZWVuV2lkdGggLyAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRUb3AgPT09ICc1MCUnKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFRvcCA9IHNjcmVlbkhlaWdodCAvIDI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnRUb3AgPSBwYXJzZUludChjdXJyZW50VG9wKTtcbiAgICAgICAgICAgIGN1cnJlbnRMZWZ0ID0gcGFyc2VJbnQoY3VycmVudExlZnQpO1xuXG4gICAgICAgICAgICAvLyBpZiBuZXcgd2lkdGgvaGVpZ2h0IGdvIG91dCBvZiB0aGUgc2NyZWVuIC0gcmVzZXQgcG9zaXRpb24gdG8gY2VudGVyIG9mIHNjcmVlblxuICAgICAgICAgICAgaWYgKCh3aWR0aCAvIDIgKyBjdXJyZW50TGVmdCA+IHNjcmVlbldpZHRoKSB8fCAoaGVpZ2h0IC8gMiArIGN1cnJlbnRUb3AgPiBzY3JlZW5IZWlnaHQpIHx8XG4gICAgICAgICAgICAgICAgKGN1cnJlbnRMZWZ0IC0gd2lkdGggLyAyIDwgMCkgfHwgKGN1cnJlbnRUb3AgLSBoZWlnaHQgLyAyIDwgMCkpIHtcbiAgICAgICAgICAgICAgICBuZXdMZWZ0ID0gc2NyZWVuV2lkdGggLyAyO1xuICAgICAgICAgICAgICAgIG5ld1RvcCA9IHNjcmVlbkhlaWdodCAvIDI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGluIGNhc2UsIHRoZSBtb2RhbCBpcyBsYXJnZXIgdGhhbiB0aGUgd2luZG93LCB3ZSB0cmlnZ2VyIGZ1bGxzY3JlZW4gbW9kZVxuICAgICAgICAgICAgaWYgKHdpZHRoID49IHNjcmVlbldpZHRoIHx8IGhlaWdodCA+PSBzY3JlZW5IZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNYXhpbWl6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgICAgICB0b3A6IG5ld1RvcCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBuZXdMZWZ0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbmltYXRpb24gaGVscGVyIGZvciBvcGVuaW5nIHRoZSBzaWRlZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Nob3dcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdHMud2lkdGggd2lkdGggb2YgdGhlIG1vZGFsXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRzLmhlaWdodCBoZWlnaHQgb2YgdGhlIG1vZGFsXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRzLmxlZnQgbGVmdCBpbiBweCBvZiB0aGUgY2VudGVyIG9mIHRoZSBtb2RhbFxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gb3B0cy50b3AgdG9wIGluIHB4IG9mIHRoZSBjZW50ZXIgb2YgdGhlIG1vZGFsXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRzLmR1cmF0aW9uIHNwZWVkIG9mIG9wZW5pbmcsIG1zIChub3QgcmVhbGx5IHVzZWQgeWV0KVxuICAgICAgICAgKi9cbiAgICAgICAgX3Nob3c6IGZ1bmN0aW9uIF9zaG93KG9wdHMpIHtcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcG9zaXRpb24gdGhlIG1vZGFsIGluIHRoZSBjZW50ZXJcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IG9wdHMud2lkdGg7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gb3B0cy5oZWlnaHQ7XG4gICAgICAgICAgICAvLyBUT0RPIG1ha2UgdXNlIG9mIHRyYW5zaXRpb25EdXJhdGlvbiwgY3VycmVudGx5IGNhcHBlZCBhdCAwLjJzXG4gICAgICAgICAgICB2YXIgc3BlZWQgPSBvcHRzLmR1cmF0aW9uO1xuICAgICAgICAgICAgdmFyIHRvcCA9IG9wdHMudG9wO1xuICAgICAgICAgICAgdmFyIGxlZnQgPSBvcHRzLmxlZnQ7XG5cblxuICAgICAgICAgICAgaWYgKHRoaXMudWkubW9kYWwuaGFzQ2xhc3MoJ2Ntcy1tb2RhbC1vcGVuJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmFkZENsYXNzKCdjbXMtbW9kYWwtbW9ycGhpbmcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5jc3Moe1xuICAgICAgICAgICAgICAgICdkaXNwbGF5JzogJ2Jsb2NrJyxcbiAgICAgICAgICAgICAgICAnd2lkdGgnOiB3aWR0aCxcbiAgICAgICAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0LFxuICAgICAgICAgICAgICAgICd0b3AnOiB0b3AsXG4gICAgICAgICAgICAgICAgJ2xlZnQnOiBsZWZ0LFxuICAgICAgICAgICAgICAgIC8vIFRPRE8gYW5pbWF0ZSB0cmFuc2xhdGVYIGlmIHBvc3NpYmxlIGluc3RlYWQgb2YgbWFyZ2luXG4gICAgICAgICAgICAgICAgJ21hcmdpbi1sZWZ0JzogLSh3aWR0aCAvIDIpLFxuICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogLShoZWlnaHQgLyAyKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBzZXRJbW1lZGlhdGUgaXMgcmVxdWlyZWQgdG8gZ28gaW50byB0aGUgbmV4dCBmcmFtZVxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5tb2RhbC5hZGRDbGFzcygnY21zLW1vZGFsLW9wZW4nKTtcbiAgICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgICAgICB0aGlzLnVpLm1vZGFsLm9uZSgnY21zVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLm1vZGFsLnJlbW92ZUNsYXNzKCdjbXMtbW9kYWwtbW9ycGhpbmcnKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLm1vZGFsLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICdtYXJnaW4tbGVmdCc6IC0od2lkdGggLyAyKSxcbiAgICAgICAgICAgICAgICAgICAgJ21hcmdpbi10b3AnOiAtKGhlaWdodCAvIDIpXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBzaG91bGQgbWF4aW1pemVcbiAgICAgICAgICAgICAgICBpZiAodGhhdC50cmlnZ2VyTWF4aW1pemVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWF4aW1pemUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBjaGFuZ2VkIGxvY2tlZCBzdGF0dXMgdG8gYWxsb3cgb3RoZXIgbW9kYWxzIGFnYWluXG4gICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGF0LnRyaWdnZXIoJ2Ntcy5tb2RhbC5zaG93bicpO1xuICAgICAgICAgICAgfSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoc3BlZWQpO1xuXG4gICAgICAgICAgICAvLyBhZGQgZXNjIGNsb3NlIGV2ZW50XG4gICAgICAgICAgICB0aGlzLnVpLmJvZHkub2ZmKCdrZXlkb3duLmNtcy5jbG9zZScpLm9uKCdrZXlkb3duLmNtcy5jbG9zZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gQ01TLktFWVMuRVNDKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5vbkNsb3NlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBzZXQgZm9jdXMgdG8gbW9kYWxcbiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuZm9jdXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xvc2VzIHRoZSBjdXJyZW50IGluc3RhbmNlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIGNsb3NlXG4gICAgICAgICAqL1xuICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAgICAgICAvLyBoYW5kbGUgcmVmcmVzaCBvcHRpb25cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25DbG9zZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVsb2FkQnJvd3Nlcih0aGlzLm9wdGlvbnMub25DbG9zZSwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBoYW5kbGUgcmVtb3ZlIG9wdGlvbiB3aGVuIHBsdWdpbiBpcyBuZXdcbiAgICAgICAgICAgIGlmIChDTVMuX25ld1BsdWdpbikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlbGV0ZVBsdWdpbih7XG4gICAgICAgICAgICAgICAgICAgIGhpZGVBZnRlcjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlKHtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHRoaXMub3B0aW9ucy5tb2RhbER1cmF0aW9uIC8gMlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbmltYXRpb24gaGVscGVyIGZvciBjbG9zaW5nIHRoZSBpZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2hpZGVcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLmR1cmF0aW9uPXRoaXMub3B0aW9ucy5tb2RhbER1cmF0aW9uXSBhbmltYXRpb24gZHVyYXRpb25cbiAgICAgICAgICovXG4gICAgICAgIF9oaWRlOiBmdW5jdGlvbiBfaGlkZShvcHRzKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLm9wdGlvbnMubW9kYWxEdXJhdGlvbjtcblxuICAgICAgICAgICAgaWYgKG9wdHMgJiYgb3B0cy5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gb3B0cy5kdXJhdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy51aS5mcmFtZS5lbXB0eSgpO1xuICAgICAgICAgICAgdGhpcy51aS5tb2RhbEJvZHkucmVtb3ZlQ2xhc3MoJ2Ntcy1sb2FkZXInKTtcbiAgICAgICAgICAgIHRoaXMudWkubW9kYWwucmVtb3ZlQ2xhc3MoJ2Ntcy1tb2RhbC1vcGVuJyk7XG4gICAgICAgICAgICB0aGlzLnVpLm1vZGFsLm9uZSgnY21zVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLm1vZGFsLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICB9KS5lbXVsYXRlVHJhbnNpdGlvbkVuZChkdXJhdGlvbik7XG5cbiAgICAgICAgICAgIC8vIHJlc2V0IG1heGltaXplIG9yIG1pbmltaXplIHN0YXRlcyBmb3IgIzMxMTFcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGF0Lm1pbmltaXplZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1pbmltaXplKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGF0Lm1heGltaXplZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1heGltaXplKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQudHJpZ2dlcignY21zLm1vZGFsLmNsb3NlZCcpO1xuICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmR1cmF0aW9uKTtcblxuICAgICAgICAgICAgdGhpcy51aS5ib2R5Lm9mZigna2V5ZG93bi5jbXMuY2xvc2UnKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWluaW1pemVzIHRoZSBtb2RhbCBvbnRvIHRoZSB0b29sYmFyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIG1pbmltaXplXG4gICAgICAgICAqL1xuICAgICAgICBtaW5pbWl6ZTogZnVuY3Rpb24gbWluaW1pemUoKSB7XG4gICAgICAgICAgICAvLyBjYW5jZWwgYWN0aW9uIGlmIG1heGltaXplZFxuICAgICAgICAgICAgaWYgKHRoaXMubWF4aW1pemVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5taW5pbWl6ZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgLy8gZW5zdXJlIHRvb2xiYXIgaXMgc2hvd25cbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIub3BlbigpO1xuXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSBpbml0aWFsIHN0YXRlXG4gICAgICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5kYXRhKCdjc3MnLCB0aGlzLnVpLm1vZGFsLmNzcyhbXG4gICAgICAgICAgICAgICAgICAgICdsZWZ0JywgJ3RvcCcsICdtYXJnaW4tbGVmdCcsICdtYXJnaW4tdG9wJ1xuICAgICAgICAgICAgICAgIF0pKTtcblxuICAgICAgICAgICAgICAgIC8vIG1pbmltaXplXG4gICAgICAgICAgICAgICAgdGhpcy51aS5ib2R5LmFkZENsYXNzKCdjbXMtbW9kYWwtbWluaW1pemVkJyk7XG4gICAgICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAnbGVmdCc6IHRoaXMudWkudG9vbGJhckxlZnRQYXJ0Lm91dGVyV2lkdGgodHJ1ZSkgKyA1MFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5taW5pbWl6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBtYXhpbWl6ZVxuICAgICAgICAgICAgICAgIHRoaXMudWkuYm9keS5yZW1vdmVDbGFzcygnY21zLW1vZGFsLW1pbmltaXplZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY3NzKHRoaXMudWkubW9kYWwuZGF0YSgnY3NzJykpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5taW5pbWl6ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWF4aW1pemVzIHRoZSB3aW5kb3cgYWNjb3JkaW5nIHRvIHRoZSBicm93c2VyIHNpemUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgbWF4aW1pemVcbiAgICAgICAgICovXG4gICAgICAgIG1heGltaXplOiBmdW5jdGlvbiBtYXhpbWl6ZSgpIHtcbiAgICAgICAgICAgIC8vIGNhbmNlbCBhY3Rpb24gd2hlbiBtaW5pbWl6ZWRcbiAgICAgICAgICAgIGlmICh0aGlzLm1pbmltaXplZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMubWF4aW1pemVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIC8vIHNhdmUgaW5pdGlhbCBzdGF0ZVxuICAgICAgICAgICAgICAgIHRoaXMudWkubW9kYWwuZGF0YSgnY3NzJywgdGhpcy51aS5tb2RhbC5jc3MoW1xuICAgICAgICAgICAgICAgICAgICAnbGVmdCcsICd0b3AnLCAnbWFyZ2luLWxlZnQnLCAnbWFyZ2luLXRvcCcsXG4gICAgICAgICAgICAgICAgICAgICd3aWR0aCcsICdoZWlnaHQnXG4gICAgICAgICAgICAgICAgXSkpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5ib2R5LmFkZENsYXNzKCdjbXMtbW9kYWwtbWF4aW1pemVkJyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1heGltaXplZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdtb2RhbC1tYXhpbWl6ZWQnLCB7IGluc3RhbmNlOiB0aGlzIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBtaW5pbWl6ZVxuICAgICAgICAgICAgICAgIHRoaXMudWkuYm9keS5yZW1vdmVDbGFzcygnY21zLW1vZGFsLW1heGltaXplZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY3NzKHRoaXMudWkubW9kYWwuZGF0YSgnY3NzJykpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tYXhpbWl6ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ21vZGFsLXJlc3RvcmVkJywgeyBpbnN0YW5jZTogdGhpcyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhdGVzIHRoZSBzdGFydCBtb3ZlIGV2ZW50IGZyb20gYF9ldmVudHNgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdGFydE1vdmVcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJFdmVudCBwYXNzZXMgc3RhcnRpbmcgZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIF9zdGFydE1vdmU6IGZ1bmN0aW9uIF9zdGFydE1vdmUocG9pbnRlckV2ZW50KSB7XG4gICAgICAgICAgICAvLyBjYW5jZWwgaWYgbWF4aW1pemVkIG9yIG1pbmltaXplZFxuICAgICAgICAgICAgaWYgKHRoaXMubWF4aW1pemVkIHx8IHRoaXMubWluaW1pemVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnVpLm1vZGFsLnBvc2l0aW9uKCk7XG4gICAgICAgICAgICB2YXIgbGVmdDtcbiAgICAgICAgICAgIHZhciB0b3A7XG5cbiAgICAgICAgICAgIHRoaXMudWkuc2hpbS5zaG93KCk7XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSBldmVudCBmb3Igc3RvcHBpbmdcbiAgICAgICAgICAgIHRoaXMudWkuYm9keS5vbih0aGlzLnBvaW50ZXJVcCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9zdG9wTW92ZShlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnVpLmJvZHkub24odGhpcy5wb2ludGVyTW92ZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZWZ0ID0gcG9zaXRpb24ubGVmdCAtIChwb2ludGVyRXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWCAtIGUub3JpZ2luYWxFdmVudC5wYWdlWCk7XG4gICAgICAgICAgICAgICAgdG9wID0gcG9zaXRpb24udG9wIC0gKHBvaW50ZXJFdmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gZS5vcmlnaW5hbEV2ZW50LnBhZ2VZKTtcblxuICAgICAgICAgICAgICAgIHRoYXQudWkubW9kYWwuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgJ2xlZnQnOiBsZWZ0LFxuICAgICAgICAgICAgICAgICAgICAndG9wJzogdG9wXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5hdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicsICdub25lJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYXRlcyB0aGUgc3RvcCBtb3ZlIGV2ZW50IGZyb20gYF9zdGFydE1vdmVgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdG9wTW92ZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3N0b3BNb3ZlOiBmdW5jdGlvbiBfc3RvcE1vdmUoKSB7XG4gICAgICAgICAgICB0aGlzLnVpLnNoaW0uaGlkZSgpO1xuICAgICAgICAgICAgdGhpcy51aS5ib2R5XG4gICAgICAgICAgICAgICAgLm9mZih0aGlzLnBvaW50ZXJNb3ZlICsgJyAnICsgdGhpcy5wb2ludGVyVXApXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2RhdGEtdG91Y2gtYWN0aW9uJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYXRlcyB0aGUgc3RhcnQgcmVzaXplIGV2ZW50IGZyb20gYF9ldmVudHNgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdGFydFJlc2l6ZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlckV2ZW50IHBhc3NlcyBzdGFydGluZyBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgX3N0YXJ0UmVzaXplOiBmdW5jdGlvbiBfc3RhcnRSZXNpemUocG9pbnRlckV2ZW50KSB7XG4gICAgICAgICAgICAvLyBjYW5jZWwgaWYgaW4gZnVsbHNjcmVlblxuICAgICAgICAgICAgaWYgKHRoaXMubWF4aW1pemVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY29udGludWVcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHRoaXMudWkubW9kYWwud2lkdGgoKTtcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLnVpLm1vZGFsLmhlaWdodCgpO1xuICAgICAgICAgICAgdmFyIG1vZGFsTGVmdCA9IHRoaXMudWkubW9kYWwucG9zaXRpb24oKS5sZWZ0O1xuICAgICAgICAgICAgdmFyIG1vZGFsVG9wID0gdGhpcy51aS5tb2RhbC5wb3NpdGlvbigpLnRvcDtcblxuICAgICAgICAgICAgLy8gY3JlYXRlIGV2ZW50IGZvciBzdG9wcGluZ1xuICAgICAgICAgICAgdGhpcy51aS5ib2R5Lm9uKHRoaXMucG9pbnRlclVwLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHRoYXQuX3N0b3BSZXNpemUoZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy51aS5zaGltLnNob3coKTtcblxuICAgICAgICAgICAgdGhpcy51aS5ib2R5Lm9uKHRoaXMucG9pbnRlck1vdmUsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG12WCA9IHBvaW50ZXJFdmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VYIC0gZS5vcmlnaW5hbEV2ZW50LnBhZ2VYO1xuICAgICAgICAgICAgICAgIHZhciBtdlkgPSBwb2ludGVyRXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSAtIGUub3JpZ2luYWxFdmVudC5wYWdlWTtcbiAgICAgICAgICAgICAgICB2YXIgdyA9IHdpZHRoIC0gKG12WCAqIDIpO1xuICAgICAgICAgICAgICAgIHZhciBoID0gaGVpZ2h0IC0gKG12WSAqIDIpO1xuICAgICAgICAgICAgICAgIHZhciB3TWluID0gdGhhdC5vcHRpb25zLm1pbldpZHRoO1xuICAgICAgICAgICAgICAgIHZhciBoTWluID0gdGhhdC5vcHRpb25zLm1pbkhlaWdodDtcbiAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IG12WCArIG1vZGFsTGVmdDtcbiAgICAgICAgICAgICAgICB2YXIgdG9wID0gbXZZICsgbW9kYWxUb3A7XG5cbiAgICAgICAgICAgICAgICAvLyBhZGQgc29tZSBsaW1pdHNcbiAgICAgICAgICAgICAgICBpZiAodyA8PSB3TWluKSB7XG4gICAgICAgICAgICAgICAgICAgIHcgPSB3TWluO1xuICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gbW9kYWxMZWZ0ICsgd2lkdGggLyAyIC0gdyAvIDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChoIDw9IGhNaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgaCA9IGhNaW47XG4gICAgICAgICAgICAgICAgICAgIHRvcCA9IG1vZGFsVG9wICsgaGVpZ2h0IC8gMiAtIGggLyAyO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHNldCBjZW50ZXJlZCBhbmltYXRpb25cbiAgICAgICAgICAgICAgICB0aGF0LnVpLm1vZGFsLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3LFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGgsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogdG9wXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5hdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicsICdub25lJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYXRlcyB0aGUgc3RvcCByZXNpemUgZXZlbnQgZnJvbSBgX3N0YXJ0UmVzaXplYC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc3RvcFJlc2l6ZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3N0b3BSZXNpemU6IGZ1bmN0aW9uIF9zdG9wUmVzaXplKCkge1xuICAgICAgICAgICAgdGhpcy51aS5zaGltLmhpZGUoKTtcbiAgICAgICAgICAgIHRoaXMudWkuYm9keVxuICAgICAgICAgICAgICAgIC5vZmYodGhpcy5wb2ludGVyTW92ZSArICcgJyArIHRoaXMucG9pbnRlclVwKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHRoZSBicmVhZGNydW1iIGluc2lkZSB0aGUgbW9kYWwuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldEJyZWFkY3J1bWJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3RbXX0gYnJlYWRjcnVtYnMgcmVuZGVyZXMgYnJlYWRjcnVtYiBvbiBtb2RhbFxuICAgICAgICAgKi9cbiAgICAgICAgX3NldEJyZWFkY3J1bWI6IGZ1bmN0aW9uIF9zZXRCcmVhZGNydW1iKGJyZWFkY3J1bWJzKSB7XG4gICAgICAgICAgICB2YXIgY3J1bWIgPSAnJztcbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9ICc8YSBocmVmPVwiezF9XCIgY2xhc3M9XCJ7Mn1cIj48c3Bhbj57M308L3NwYW4+PC9hPic7XG5cbiAgICAgICAgICAgIC8vIGNhbmNlbCBpZiB0aGVyZSBpcyBubyBicmVhZGNydW1icylcbiAgICAgICAgICAgIGlmICghYnJlYWRjcnVtYnMgfHwgYnJlYWRjcnVtYnMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWJyZWFkY3J1bWJzWzBdLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhZGQgY2xhc3MgdG8gbW9kYWxcbiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuYWRkQ2xhc3MoJ2Ntcy1tb2RhbC1oYXMtYnJlYWRjcnVtYicpO1xuXG4gICAgICAgICAgICAvLyBsb2FkIGJyZWFkY3J1bWJzXG4gICAgICAgICAgICAkLmVhY2goYnJlYWRjcnVtYnMsIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkge1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBpdGVtIGlzIHRoZSBsYXN0IG9uZVxuICAgICAgICAgICAgICAgIHZhciBsYXN0ID0gKGluZGV4ID49IGJyZWFkY3J1bWJzLmxlbmd0aCAtIDEpID8gJ2FjdGl2ZScgOiAnJztcbiAgICAgICAgICAgICAgICAvLyByZW5kZXIgYnJlYWRjcnVtYnNcbiAgICAgICAgICAgICAgICBjcnVtYiArPSB0ZW1wbGF0ZVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnezF9JywgaXRlbS51cmwpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7Mn0nLCBsYXN0KVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnezN9JywgaXRlbS50aXRsZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLnVpLmJyZWFkY3J1bWIuaHRtbChjcnVtYik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIGJ1dHRvbnMgaW5zaWRlIHRoZSBtb2RhbC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0QnV0dG9uc1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gaWZyYW1lIGxvYWRlZCBpZnJhbWUgZWxlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgX3NldEJ1dHRvbnM6IGZ1bmN0aW9uIF9zZXRCdXR0b25zKGlmcmFtZSkge1xuICAgICAgICAgICAgdmFyIGRqYW5nb1N1aXQgPSBpZnJhbWUuY29udGVudHMoKS5maW5kKCcuc3VpdC1jb2x1bW5zJykubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBncm91cCA9ICQoJzxkaXYgY2xhc3M9XCJjbXMtbW9kYWwtaXRlbS1idXR0b25zXCI+PC9kaXY+Jyk7XG4gICAgICAgICAgICB2YXIgcmVuZGVyID0gJCgnPGRpdiBjbGFzcz1cImNtcy1tb2RhbC1idXR0b25zLWlubmVyXCI+PC9kaXY+Jyk7XG4gICAgICAgICAgICB2YXIgY2FuY2VsID0gJCgnPGEgaHJlZj1cIiNcIiBjbGFzcz1cImNtcy1idG5cIj4nICsgQ01TLmNvbmZpZy5sYW5nLmNhbmNlbCArICc8L2E+Jyk7XG4gICAgICAgICAgICB2YXIgcm93O1xuICAgICAgICAgICAgdmFyIHRtcDtcblxuICAgICAgICAgICAgLy8gaXN0YW5idWwgaWdub3JlIGVsc2VcbiAgICAgICAgICAgIGlmICghZGphbmdvU3VpdCkge1xuICAgICAgICAgICAgICAgIHJvdyA9IGlmcmFtZS5jb250ZW50cygpLmZpbmQoJy5zdWJtaXQtcm93OmVxKDApJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJvdyA9IGlmcmFtZS5jb250ZW50cygpLmZpbmQoJy5zYXZlLWJveDplcSgwKScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZvcm0gPSBpZnJhbWUuY29udGVudHMoKS5maW5kKCdmb3JtJyk7XG4gICAgICAgICAgICAvL2F2b2lkcyBjb25mbGljdCBiZXR3ZWVuIHRoZSBicm93c2VyJ3MgZm9ybSB2YWxpZGF0aW9uIGFuZCBEamFuZ28ncyB2YWxpZGF0aW9uXG4gICAgICAgICAgICBmb3JtLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gZGVmYXVsdCBzdWJtaXQgYnV0dG9uIHdhcyBjbGlja2VkXG4gICAgICAgICAgICAgICAgLy8gbWVhbmluZywgaWYgeW91IGhhdmUgc2F2ZSAtIGl0IHNob3VsZCBjbG9zZSB0aGUgaWZyYW1lLFxuICAgICAgICAgICAgICAgIC8vIGlmIHlvdSBoaXQgc2F2ZSBhbmQgY29udGludWUgZWRpdGluZyBpdCBzaG91bGQgYmUgZGVmYXVsdCBmb3JtIGJlaGF2aW91clxuICAgICAgICAgICAgICAgIGlmICh0aGF0LmhpZGVGcmFtZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLm1vZGFsLmZpbmQoJy5jbXMtbW9kYWwtZnJhbWUgaWZyYW1lJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBwYWdlIGhhcyBiZWVuIHNhdmVkLCBydW4gY2hlY2t1cFxuICAgICAgICAgICAgICAgICAgICB0aGF0LnNhdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBidXR0b25zID0gcm93LmZpbmQoJ2lucHV0LCBhLCBidXR0b24nKTtcbiAgICAgICAgICAgIC8vIHRoZXNlIGFyZSB0aGUgYnV0dG9ucyBfaW5zaWRlXyB0aGUgaWZyYW1lXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGxpc3RlbiB0byB0aGlzIGNsaWNrIGV2ZW50IHRvIHN1cHBvcnQgc3VibWl0dGluZ1xuICAgICAgICAgICAgLy8gYSBmb3JtIGJ5IHByZXNzaW5nIGVudGVyIGluc2lkZSBvZiBhIGZpZWxkXG4gICAgICAgICAgICAvLyBjbGljayBpcyBhY3R1YWxseSB0cmlnZ2VyZWQgYnkgc3VibWl0XG4gICAgICAgICAgICBidXR0b25zLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnZGVmYXVsdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZUZyYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaGlkZSBhbGwgc3VibWl0LXJvd3NcbiAgICAgICAgICAgIGlmcmFtZS5jb250ZW50cygpLmZpbmQoJy5zdWJtaXQtcm93JykuaGlkZSgpO1xuXG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbm8gZ2l2ZW4gYnV0dG9ucyB3aXRoaW4gdGhlIHN1Ym1pdC1yb3cgYXJlYVxuICAgICAgICAgICAgLy8gc2NhbiBkZWVwZXIgd2l0aGluIHRoZSBmb3JtIGl0c2VsZlxuICAgICAgICAgICAgLy8gaXN0YW5idWwgaWdub3JlIG5leHRcbiAgICAgICAgICAgIGlmICghYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByb3cgPSBpZnJhbWUuY29udGVudHMoKS5maW5kKCdib2R5Om5vdCguY2hhbmdlLWxpc3QpICNjb250ZW50IGZvcm06ZXEoMCknKTtcbiAgICAgICAgICAgICAgICBidXR0b25zID0gcm93LmZpbmQoJ2lucHV0W3R5cGU9XCJzdWJtaXRcIl0sIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XG4gICAgICAgICAgICAgICAgYnV0dG9ucy5hZGRDbGFzcygnZGVsZXRlbGluaycpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbG9vcCBvdmVyIGlucHV0IGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbnMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICBpdGVtLmF0dHIoJ2RhdGEtcmVsJywgJ18nICsgaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIGl0ZW0gaXMgYSBoaWRkZW4gaW5wdXRcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5hdHRyKCd0eXBlJykgPT09ICdoaWRkZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBpdGVtLmF0dHIoJ3ZhbHVlJykgfHwgaXRlbS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgdmFyIGNscyA9ICdjbXMtYnRuJztcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzKCdidXR0b24nKSkge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IGl0ZW0udGV4dCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHNldCBhZGRpdGlvbmFsIHNwZWNpYWwgY3NzIGNsYXNzZXNcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNDbGFzcygnZGVmYXVsdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNscyA9ICdjbXMtYnRuIGNtcy1idG4tYWN0aW9uJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzQ2xhc3MoJ2RlbGV0ZWxpbmsnKSkge1xuICAgICAgICAgICAgICAgICAgICBjbHMgPSAnY21zLWJ0biBjbXMtYnRuLWNhdXRpb24nO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCInICsgY2xzICsgJyAnICsgaXRlbS5hdHRyKCdjbGFzcycpICsgJ1wiPicgKyB0aXRsZSArICc8L2E+Jyk7XG5cbiAgICAgICAgICAgICAgICBlbC5vbih0aGF0LmNsaWNrICsgJyAnICsgdGhhdC50b3VjaEVuZCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzKCdhJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2xvYWRJZnJhbWUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogaXRlbS5wcm9wKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGl0bGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gdHJpZ2dlciBvbmx5IHdoZW4gYmx1ZSBhY3Rpb24gYnV0dG9ucyBhcmUgdHJpZ2dlcmVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0NsYXNzKCdkZWZhdWx0JykgfHwgaXRlbS5oYXNDbGFzcygnZGVsZXRlbGluaycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW0uaGFzQ2xhc3MoJ2RlZmF1bHQnKSkgeyAvLyBoaWRlIGlmcmFtZSB3aGVuIHVzaW5nIGJ1dHRvbnMgb3RoZXIgdGhhbiBzdWJtaXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLm1vZGFsLmZpbmQoJy5jbXMtbW9kYWwtZnJhbWUgaWZyYW1lJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhZ2UgaGFzIGJlZW4gc2F2ZWQgb3IgZGVsZXRlZCwgcnVuIGNoZWNrdXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnNhdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIHN1Ym1pdCBidXR0b24gdXNlcyB0aGUgZm9ybSdzIHN1Ym1pdCBldmVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZUZyYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzKCdpbnB1dCcpIHx8IGl0ZW0uaXMoJ2J1dHRvbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHVzZSBuYXRpdmUgYC5jbGljaygpYCBldmVudCBzcGVjaWZpY2FsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIHdlIGFyZSBpbnNpZGUgYW4gaWZyYW1lIGFuZCBtYWdpYyBpcyBoYXBwZW5pbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bMF0uY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZWwud3JhcChncm91cCk7XG5cbiAgICAgICAgICAgICAgICAvLyBhcHBlbmQgZWxlbWVudFxuICAgICAgICAgICAgICAgIHJlbmRlci5hcHBlbmQoZWwucGFyZW50KCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIG1hbnVhbGx5IGFkZCBjYW5jZWwgYnV0dG9uIGF0IHRoZSBlbmRcbiAgICAgICAgICAgIGNhbmNlbC5vbih0aGF0LmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGF0Lm9wdGlvbnMub25DbG9zZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FuY2VsLndyYXAoZ3JvdXApO1xuICAgICAgICAgICAgcmVuZGVyLmFwcGVuZChjYW5jZWwucGFyZW50KCkpO1xuXG4gICAgICAgICAgICAvLyBwcmVwYXJlIGdyb3Vwc1xuICAgICAgICAgICAgcmVuZGVyLmZpbmQoJy5jbXMtYnRuLWdyb3VwJykudW53cmFwKCk7XG4gICAgICAgICAgICB0bXAgPSByZW5kZXIuZmluZCgnLmNtcy1idG4tZ3JvdXAnKS5jbG9uZSh0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgIHJlbmRlci5maW5kKCcuY21zLWJ0bi1ncm91cCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgcmVuZGVyLmFwcGVuZCh0bXAud3JhcEFsbChncm91cC5jbG9uZSgpLmFkZENsYXNzKCdjbXMtbW9kYWwtaXRlbS1idXR0b25zLWxlZnQnKSkucGFyZW50KCkpO1xuXG4gICAgICAgICAgICAvLyByZW5kZXIgYnV0dG9uc1xuICAgICAgICAgICAgdGhpcy51aS5tb2RhbEJ1dHRvbnMuaHRtbChyZW5kZXIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWZXJzaW9uIHdoZXJlIHRoZSBtb2RhbCBsb2FkcyBhbiBpZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2xvYWRJZnJhbWVcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG9wdHMudXJsIHVybCB0byByZW5kZXIgaWZyYW1lLCB0YWtlcyBwcmVzZWRlbmNlIG92ZXIgb3B0cy5odG1sXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IFtvcHRzLmJyZWFkY3J1bWJzXSBjb2xsZWN0aW9uIG9mIGJyZWFkY3J1bWIgaXRlbXNcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRzLnRpdGxlXSBtb2RhbCB3aW5kb3cgbWFpbiB0aXRsZSAoYm9sZClcbiAgICAgICAgICovXG4gICAgICAgIF9sb2FkSWZyYW1lOiBmdW5jdGlvbiBfbG9hZElmcmFtZShvcHRzKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIG9wdHMudXJsID0gdGhpcy5tYWtlVVJMKG9wdHMudXJsKTtcbiAgICAgICAgICAgIG9wdHMudGl0bGUgPSBvcHRzLnRpdGxlIHx8ICcnO1xuICAgICAgICAgICAgb3B0cy5icmVhZGNydW1icyA9IG9wdHMuYnJlYWRjcnVtYnMgfHwgJyc7XG5cbiAgICAgICAgICAgIC8vIHNob3cgbG9hZGVyXG4gICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuc2hvd0xvYWRlcigpO1xuXG4gICAgICAgICAgICAvLyBzZXQgY2xhc3Nlc1xuICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5yZW1vdmVDbGFzcygnY21zLW1vZGFsLW1hcmt1cCcpO1xuICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5hZGRDbGFzcygnY21zLW1vZGFsLWlmcmFtZScpO1xuXG4gICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHJlbmRlciB0aGUgYnJlYWRjcnVtYlxuICAgICAgICAgICAgdGhpcy5fc2V0QnJlYWRjcnVtYihvcHRzLmJyZWFkY3J1bWJzKTtcblxuICAgICAgICAgICAgLy8gbm93IHJlZnJlc2ggdGhlIGNvbnRlbnRcbiAgICAgICAgICAgIHZhciBob2xkZXIgPSB0aGlzLnVpLmZyYW1lO1xuICAgICAgICAgICAgdmFyIGlmcmFtZSA9ICQoJzxpZnJhbWUgc3JjPVwiJyArIG9wdHMudXJsICsgJ1wiIGNsYXNzPVwiXCIgZnJhbWVib3JkZXI9XCIwXCIgLz4nKTtcblxuICAgICAgICAgICAgLy8gc2V0IGNvcnJlY3QgdGl0bGVcbiAgICAgICAgICAgIHZhciB0aXRsZVByZWZpeCA9IHRoaXMudWkudGl0bGVQcmVmaXg7XG4gICAgICAgICAgICB2YXIgdGl0bGVTdWZmaXggPSB0aGlzLnVpLnRpdGxlU3VmZml4O1xuXG4gICAgICAgICAgICBpZnJhbWUuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgICAgICAgdGl0bGVQcmVmaXgudGV4dChvcHRzLnRpdGxlIHx8ICcnKTtcbiAgICAgICAgICAgIHRpdGxlU3VmZml4LnRleHQoJycpO1xuXG4gICAgICAgICAgICAvLyBlbnN1cmUgcHJldmlvdXMgaWZyYW1lIGlzIGhpZGRlblxuICAgICAgICAgICAgaG9sZGVyLmZpbmQoJ2lmcmFtZScpLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgICAgIHRoYXQudWkubW9kYWxCb2R5LmFkZENsYXNzKCdjbXMtbG9hZGVyJyk7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCBsb2FkIGV2ZW50IGZvciBpZnJhbWUgdG8gcHJldmVudCBmbGlja2VyIGVmZmVjdHNcbiAgICAgICAgICAgIGlmcmFtZS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXM7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VMaXN0O1xuICAgICAgICAgICAgICAgIHZhciBjb250ZW50cztcbiAgICAgICAgICAgICAgICB2YXIgYm9keTtcbiAgICAgICAgICAgICAgICB2YXIgaW5uZXJUaXRsZTtcbiAgICAgICAgICAgICAgICB2YXIgYmM7XG5cbiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBpZnJhbWUgY2FuIGJlIGFjY2Vzc2VkXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICc8c3Ryb25nPicgKyBlcnJvciArICc8L3N0cm9uZz4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIENNUy5Nb2RhbC5fc2V0dXBDdHJsRW50ZXJTYXZlKGRvY3VtZW50KTtcbiAgICAgICAgICAgICAgICAvLyBpc3RhbmJ1bCBpZ25vcmUgZWxzZVxuICAgICAgICAgICAgICAgIGlmIChpZnJhbWVbMF0uY29udGVudFdpbmRvdyAmJiBpZnJhbWVbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudCkge1xuICAgICAgICAgICAgICAgICAgICBDTVMuTW9kYWwuX3NldHVwQ3RybEVudGVyU2F2ZShpZnJhbWVbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGZvciBja2VkaXRvciB3ZSBuZWVkIHRvIGdvIGRlZXBlclxuICAgICAgICAgICAgICAgIC8vIGlzdGFuYnVsIGlnbm9yZSBuZXh0XG4gICAgICAgICAgICAgICAgaWYgKGlmcmFtZVswXS5jb250ZW50V2luZG93ICYmIGlmcmFtZVswXS5jb250ZW50V2luZG93LkNNUyAmJiBpZnJhbWVbMF0uY29udGVudFdpbmRvdy5DTVMuQ0tFZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgJChpZnJhbWVbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCBpcyByZXF1aXJlZCB0byBiYXR0bGUgQ0tFZGl0b3IgaW5pdGlhbGlzYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3IgPSBpZnJhbWVbMF0uY29udGVudFdpbmRvdy5DTVMuQ0tFZGl0b3IuZWRpdG9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLm9uKCdsb2FkZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ01TLk1vZGFsLl9zZXR1cEN0cmxFbnRlclNhdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlLmVkaXRvci5jb250YWluZXIuJCkuZmluZCgnaWZyYW1lJylbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gaGlkZSBsb2FkZXJcbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuaGlkZUxvYWRlcigpO1xuXG4gICAgICAgICAgICAgICAgLy8gc2hvdyBtZXNzYWdlcyBpbiB0b29sYmFyIGlmIHByb3ZpZGVkXG4gICAgICAgICAgICAgICAgbWVzc2FnZUxpc3QgPSBpZnJhbWUuY29udGVudHMoKS5maW5kKCcubWVzc2FnZWxpc3QnKTtcbiAgICAgICAgICAgICAgICBtZXNzYWdlcyA9IG1lc3NhZ2VMaXN0LmZpbmQoJ2xpJyk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLk1lc3NhZ2VzLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZXMuZXEoMCkudGV4dCgpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtZXNzYWdlTGlzdC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBjb250ZW50cyA9IGlmcmFtZS5jb250ZW50cygpO1xuICAgICAgICAgICAgICAgIGJvZHkgPSBjb250ZW50cy5maW5kKCdib2R5Jyk7XG5cbiAgICAgICAgICAgICAgICAvLyBpbmplY3QgY3NzIGNsYXNzXG4gICAgICAgICAgICAgICAgYm9keS5hZGRDbGFzcygnY21zLWFkbWluIGNtcy1hZG1pbi1tb2RhbCcpO1xuXG4gICAgICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHdlIHNob3VsZCBjbG9zZSB0aGUgbW9kYWwgb3IgcmVsb2FkXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCAmJiB0aGF0LmVuZm9yY2VSZWxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlcy5sZW5ndGggJiYgdGhhdC5lbmZvcmNlQ2xvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gYWRkaW5nIGRqYW5nbyBoYWNrc1xuICAgICAgICAgICAgICAgIGNvbnRlbnRzLmZpbmQoJy52aWV3c2l0ZWxpbmsnKS5hdHRyKCd0YXJnZXQnLCAnX3RvcCcpO1xuXG4gICAgICAgICAgICAgICAgLy8gc2V0IG1vZGFsIGJ1dHRvbnNcbiAgICAgICAgICAgICAgICB0aGF0Ll9zZXRCdXR0b25zKCQodGhpcykpO1xuXG4gICAgICAgICAgICAgICAgLy8gd2hlbiBhbiBlcnJvciBvY2N1cnMsIHJlc2V0IHRoZSBzYXZlZCBzdGF0dXMgc28gdGhlIGZvcm0gY2FuIGJlIGNoZWNrZWQgYW5kIHZhbGlkYXRlZCBhZ2FpblxuICAgICAgICAgICAgICAgIGlmIChpZnJhbWUuY29udGVudHMoKS5maW5kKCcuZXJyb3Jub3RlJykubGVuZ3RoIHx8IGlmcmFtZS5jb250ZW50cygpLmZpbmQoJy5lcnJvcmxpc3QnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zYXZlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIHdpbmRvdyBoYXMgYmVlbiBjaGFuZ2VkIHByZXNzaW5nIHRoZSBibHVlIG9yIHJlZCBidXR0b24sIHdlIG5lZWQgdG8gcnVuIGEgcmVsb2FkIGNoZWNrXG4gICAgICAgICAgICAgICAgLy8gYWxzbyBjaGVjayB0aGF0IG5vIGRlbGV0ZS1jb25maXJtYXRpb24gaXMgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5zYXZlZCAmJiAhY29udGVudHMuZmluZCgnLmRlbGV0ZS1jb25maXJtYXRpb24nKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5yZWxvYWRCcm93c2VyKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLm9uQ2xvc2UgPyB0aGF0Lm9wdGlvbnMub25DbG9zZSA6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRpdGxlIG9mIG5vdCBwcm92aWRlZFxuICAgICAgICAgICAgICAgICAgICBpbm5lclRpdGxlID0gaWZyYW1lLmNvbnRlbnRzKCkuZmluZCgnI2NvbnRlbnQgaDE6ZXEoMCknKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjYXNlIHdoZW4gdGhlcmUgaXMgbm8gcHJlZml4XG4gICAgICAgICAgICAgICAgICAgIC8vIGlzdGFuYnVsIGlnbm9yZSBuZXh0OiBuZXZlciBoYXBwZW5zXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRzLnRpdGxlID09PSB1bmRlZmluZWQgJiYgdGhhdC51aS50aXRsZVByZWZpeC50ZXh0KCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYyA9IGlmcmFtZS5jb250ZW50cygpLmZpbmQoJy5icmVhZGNydW1icycpLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLnRpdGxlUHJlZml4LnRleHQoYmMuZXEoYmMubGVuZ3RoIC0gMSkudGV4dCgpLnJlcGxhY2UoJ+KAuicsICcnKS50cmltKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpdGxlUHJlZml4LnRleHQoKS50cmltKCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVByZWZpeC50ZXh0KGlubmVyVGl0bGUudGV4dCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlU3VmZml4LnRleHQoaW5uZXJUaXRsZS50ZXh0KCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlubmVyVGl0bGUucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gdGhhbiBzaG93XG4gICAgICAgICAgICAgICAgICAgIGlmcmFtZS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZCByZWFkeSBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICBpZnJhbWUuZGF0YSgncmVhZHknLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhdHRhY2ggY2xvc2UgZXZlbnRcbiAgICAgICAgICAgICAgICAgICAgYm9keS5vbigna2V5ZG93bi5jbXMnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gQ01TLktFWVMuRVNDKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBmaWd1cmUgb3V0IGlmIC5vYmplY3QtdG9vbHMgaXMgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50cy5maW5kKCcub2JqZWN0LXRvb2xzJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50cy5maW5kKCcjY29udGVudCcpLmNzcygncGFkZGluZy10b3AnLCAzOCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaW5qZWN0XG4gICAgICAgICAgICBob2xkZXIuaHRtbChpZnJhbWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWZXJzaW9uIHdoZXJlIHRoZSBtb2RhbCBsb2FkcyBhbiB1cmwgd2l0aGluIGFuIGlmcmFtZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfY2hhbmdlSWZyYW1lXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCBvcmlnaW5hdGVkIGVsZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgIF9jaGFuZ2VJZnJhbWU6IGZ1bmN0aW9uIF9jaGFuZ2VJZnJhbWUoZWwpIHtcbiAgICAgICAgICAgIGlmIChlbC5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYXJlbnRzID0gZWwucGFyZW50KCkuZmluZCgnYScpO1xuICAgICAgICAgICAgcGFyZW50cy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgIGVsLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgdGhpcy5fbG9hZElmcmFtZSh7XG4gICAgICAgICAgICAgICAgdXJsOiBlbC5hdHRyKCdocmVmJylcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnVpLnRpdGxlUHJlZml4LnRleHQoZWwudGV4dCgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVmVyc2lvbiB3aGVyZSB0aGUgbW9kYWwgbG9hZHMgaHRtbCBtYXJrdXAuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2xvYWRNYXJrdXBcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd8SFRNTE5vZGV8alF1ZXJ5fSBvcHRzLmh0bWwgaHRtbCBtYXJrdXAgdG8gcmVuZGVyXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvcHRzLnRpdGxlIG1vZGFsIHdpbmRvdyBtYWluIHRpdGxlIChib2xkKVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdHMuc3VidGl0bGVdIG1vZGFsIHdpbmRvdyBzZWNvbmRhcnkgdGl0bGUgKG5vcm1hbClcbiAgICAgICAgICovXG4gICAgICAgIF9sb2FkTWFya3VwOiBmdW5jdGlvbiBfbG9hZE1hcmt1cChvcHRzKSB7XG4gICAgICAgICAgICB0aGlzLnVpLm1vZGFsLnJlbW92ZUNsYXNzKCdjbXMtbW9kYWwtaWZyYW1lJyk7XG4gICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmFkZENsYXNzKCdjbXMtbW9kYWwtbWFya3VwJyk7XG4gICAgICAgICAgICB0aGlzLnVpLm1vZGFsQm9keS5yZW1vdmVDbGFzcygnY21zLWxvYWRlcicpO1xuXG4gICAgICAgICAgICAvLyBzZXQgY29udGVudFxuICAgICAgICAgICAgLy8gZW1wdHkgdG8gcmVtb3ZlIGV2ZW50cywgYXBwZW5kIHRvIGtlZXAgZXZlbnRzXG4gICAgICAgICAgICB0aGlzLnVpLmZyYW1lLmVtcHR5KCkuYXBwZW5kKG9wdHMuaHRtbCk7XG4gICAgICAgICAgICB0aGlzLnVpLnRpdGxlUHJlZml4LnRleHQob3B0cy50aXRsZSB8fCAnJyk7XG4gICAgICAgICAgICB0aGlzLnVpLnRpdGxlU3VmZml4LnRleHQob3B0cy5zdWJ0aXRsZSB8fCAnJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIF9kZWxldGVQbHVnaW4gcmVtb3ZlcyBhIHBsdWdpbiBvbmNlIGNyZWF0ZWQgd2hlbiBjbGlja2luZ1xuICAgICAgICAgKiBvbiBkZWxldGUgb3IgdGhlIGNsb3NlIGl0ZW0uIElmIHdlIGRvbid0IGRvIHRoaXMsIGFuIGVtcHR5XG4gICAgICAgICAqIHBsdWdpbiBpcyBnZW5lcmF0ZWRcbiAgICAgICAgICogaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXMvcHVsbC80MzgxIHdpbGwgZXZlbnR1YWxseVxuICAgICAgICAgKiBwcm92aWRlIGEgYmV0dGVyIHNvbHV0aW9uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2RlbGV0ZVBsdWdpblxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdHNdIGdlbmVyYWwgb2JqZWN0cyBlbGVtZW50IHRoYXQgaG9sZHMgc2V0dGluZ3NcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0cy5oaWRlQWZ0ZXJdIGhpZGVzIHRoZSBtb2RhbCBhZnRlciB0aGUgYWpheCByZXF1ZXN0cyBzdWNjZWVkc1xuICAgICAgICAgKi9cbiAgICAgICAgX2RlbGV0ZVBsdWdpbjogZnVuY3Rpb24gX2RlbGV0ZVBsdWdpbihvcHRzKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IENNUy5fbmV3UGx1Z2luO1xuICAgICAgICAgICAgdmFyIHBvc3QgPSAneyBcImNzcmZtaWRkbGV3YXJldG9rZW5cIjogXCInICsgQ01TLmNvbmZpZy5jc3JmICsgJ1wiIH0nO1xuICAgICAgICAgICAgdmFyIHRleHQgPSBDTVMuY29uZmlnLmxhbmcuY29uZmlybUVtcHR5LnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgJ3sxfScsIENNUy5fbmV3UGx1Z2luLmJyZWFkY3J1bWJbQ01TLl9uZXdQbHVnaW4uYnJlYWRjcnVtYi5sZW5ndGggLSAxXS50aXRsZVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gdHJpZ2dlciBhbiBhamF4IHJlcXVlc3RcbiAgICAgICAgICAgIHJldHVybiBDTVMuQVBJLlRvb2xiYXIub3BlbkFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogZGF0YVsnZGVsZXRlJ10sXG4gICAgICAgICAgICAgICAgcG9zdDogcG9zdCxcbiAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5fbmV3UGx1Z2luID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRzICYmIG9wdHMuaGlkZUFmdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9oaWRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGtleXVwL2tleWRvd24gbGlzdGVuZXJzIHNvIHlvdSdyZSBhYmxlIHRvIHNhdmUgd2hhdGV2ZXIgeW91J3JlXG4gICAgICogZWRpdGluZyBpbnNpZGUgb2YgYW4gaWZyYW1lIGJ5IHByZXNzaW5nIGBjdHJsICsgZW50ZXJgIG9uIHdpbmRvd3MgYW5kIGBjbWQgKyBlbnRlcmAgb24gbWFjLlxuICAgICAqXG4gICAgICogSXQgb25seSB3b3JrcyB3aXRoIGRlZmF1bHQgYnV0dG9uIChlLmcuIGFjdGlvbiksIG5vdCB0aGUgYGRlbGV0ZWAgYnV0dG9uLFxuICAgICAqIGV2ZW4gdGhvdWdoIHNvbWV0aW1lcyBpdCdzIHRoZSBvbmx5IGFjdGlvbmFibGUgYnV0dG9uIGluIHRoZSBtb2RhbC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwQ3RybEVudGVyU2F2ZVxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGRvY3VtZW50IGRvY3VtZW50IGVsZW1lbnQgKGlmcmFtZSBvciBwYXJlbnQgd2luZG93KTtcbiAgICAgKi9cbiAgICBDTVMuTW9kYWwuX3NldHVwQ3RybEVudGVyU2F2ZSA9IGZ1bmN0aW9uIF9zZXR1cEN0cmxFbnRlclNhdmUoZG9jKSB7XG4gICAgICAgIHZhciBjbWRQcmVzc2VkID0gZmFsc2U7XG4gICAgICAgIHZhciBtYWMgPSAobmF2aWdhdG9yLnBsYXRmb3JtLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignbWFjJykgKyAxKTtcblxuICAgICAgICAkKGRvYykub24oJ2tleWRvd24uY21zLnN1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5jdHJsS2V5ICYmIGUua2V5Q29kZSA9PT0gQ01TLktFWVMuRU5URVIgJiYgIW1hYykge1xuICAgICAgICAgICAgICAgICQoJy5jbXMtbW9kYWwtYnV0dG9ucyAuY21zLWJ0bi1hY3Rpb246Zmlyc3QnKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWFjKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gQ01TLktFWVMuQ01EX0xFRlQgfHxcbiAgICAgICAgICAgICAgICAgICAgZS5rZXlDb2RlID09PSBDTVMuS0VZUy5DTURfUklHSFQgfHxcbiAgICAgICAgICAgICAgICAgICAgZS5rZXlDb2RlID09PSBDTVMuS0VZUy5DTURfRklSRUZPWCkge1xuICAgICAgICAgICAgICAgICAgICBjbWRQcmVzc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5FTlRFUiAmJiBjbWRQcmVzc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5jbXMtbW9kYWwtYnV0dG9ucyAuY21zLWJ0bi1hY3Rpb246Zmlyc3QnKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkub24oJ2tleXVwLmNtcy5zdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKG1hYykge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IENNUy5LRVlTLkNNRF9MRUZUIHx8IGUua2V5Q29kZSA9PT0gQ01TLktFWVMuQ01EX1JJR0hUKSB7XG4gICAgICAgICAgICAgICAgICAgIGNtZFByZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfTtcblxufSkoQ01TLiQpO1xuIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOQU1FU1BBQ0VTXG4vKipcbiAqIEBtb2R1bGUgQ01TXG4gKi9cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG52YXIgQ01TID0gd2luZG93LkNNUyB8fCB7fTtcblxuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbi8vIFNJREVGUkFNRVxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNpZGVmcmFtZSBpcyB0cmlnZ2VyZWQgdmlhIEFQSSBjYWxscyBmcm9tIHRoZSBiYWNrZW5kIGVpdGhlclxuICAgICAqIHRocm91Z2ggdGhlIHRvb2xiYXIgbmF2aWdhdGlvbiBvciBmcm9tIHBsdWdpbnMuIFRoZSBBUElzIG9ubHkgYWxsb3cgdG9cbiAgICAgKiBvcGVuIGEgdXJsIHdpdGhpbiB0aGUgc2lkZWZyYW1lLlxuICAgICAqXG4gICAgICogQGNsYXNzIFNpZGVmcmFtZVxuICAgICAqIEBuYW1lc3BhY2UgQ01TXG4gICAgICogQHVzZXMgQ01TLkFQSS5IZWxwZXJzXG4gICAgICovXG4gICAgQ01TLlNpZGVmcmFtZSA9IG5ldyBDTVMuQ2xhc3Moe1xuXG4gICAgICAgIGltcGxlbWVudDogW0NNUy5BUEkuSGVscGVyc10sXG5cbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgb25DbG9zZTogZmFsc2UsXG4gICAgICAgICAgICBzaWRlZnJhbWVEdXJhdGlvbjogMzAwLFxuICAgICAgICAgICAgc2lkZWZyYW1lV2lkdGg6IDAuOCAvLyBtYXRjaGVzIDgwJSBvZiB3aW5kb3cgd2lkdGhcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAvLyBlbGVtZW50c1xuICAgICAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuXG4gICAgICAgICAgICAvLyBzdGF0ZXMgYW5kIGV2ZW50c1xuICAgICAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMuc2lkZWZyYW1lJztcbiAgICAgICAgICAgIHRoaXMucG9pbnRlckRvd24gPSAncG9pbnRlcmRvd24uY21zLnNpZGVmcmFtZSBjb250ZXh0bWVudS5jbXMuc2lkZWZyYW1lJztcbiAgICAgICAgICAgIHRoaXMucG9pbnRlclVwID0gJ3BvaW50ZXJ1cC5jbXMuc2lkZWZyYW1lIHBvaW50ZXJjYW5jZWwuY21zLnNpZGVmcmFtZSc7XG4gICAgICAgICAgICB0aGlzLnBvaW50ZXJNb3ZlID0gJ3BvaW50ZXJtb3ZlLmNtcy5zaWRlZnJhbWUnO1xuICAgICAgICAgICAgdGhpcy5lbmZvcmNlUmVsb2FkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzUmVmcmVzaFRpbWVyID0gNjAwO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdG9yZXMgYWxsIGpRdWVyeSByZWZlcmVuY2VzIHdpdGhpbiBgdGhpcy51aWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwVUlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cFVJOiBmdW5jdGlvbiBfc2V0dXBVSSgpIHtcbiAgICAgICAgICAgIHZhciBzaWRlZnJhbWUgPSAkKCcuY21zLXNpZGVmcmFtZScpO1xuICAgICAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgICAgICBzaWRlZnJhbWU6IHNpZGVmcmFtZSxcbiAgICAgICAgICAgICAgICBib2R5OiAkKCdodG1sJyksXG4gICAgICAgICAgICAgICAgd2luZG93OiAkKHdpbmRvdyksXG4gICAgICAgICAgICAgICAgZGltbWVyOiBzaWRlZnJhbWUuZmluZCgnLmNtcy1zaWRlZnJhbWUtZGltbWVyJyksXG4gICAgICAgICAgICAgICAgY2xvc2U6IHNpZGVmcmFtZS5maW5kKCcuY21zLXNpZGVmcmFtZS1jbG9zZScpLFxuICAgICAgICAgICAgICAgIHJlc2l6ZTogc2lkZWZyYW1lLmZpbmQoJy5jbXMtc2lkZWZyYW1lLXJlc2l6ZScpLFxuICAgICAgICAgICAgICAgIGZyYW1lOiBzaWRlZnJhbWUuZmluZCgnLmNtcy1zaWRlZnJhbWUtZnJhbWUnKSxcbiAgICAgICAgICAgICAgICBzaGltOiBzaWRlZnJhbWUuZmluZCgnLmNtcy1zaWRlZnJhbWUtc2hpbScpLFxuICAgICAgICAgICAgICAgIGhpc3RvcnlCYWNrOiBzaWRlZnJhbWUuZmluZCgnLmNtcy1zaWRlZnJhbWUtaGlzdG9yeSAuY21zLWljb24tYXJyb3ctYmFjaycpLFxuICAgICAgICAgICAgICAgIGhpc3RvcnlGb3J3YXJkOiBzaWRlZnJhbWUuZmluZCgnLmNtcy1zaWRlZnJhbWUtaGlzdG9yeSAuY21zLWljb24tYXJyb3ctZm9yd2FyZCcpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMsIHN1Y2ggYXMgY2xvc2luZyBhbmQgcmVzaXppbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzZXQgdGhlIGhpc3Rvcnkgc3RhdGUgb24gZXZlbnQgY3JlYXRpb25cbiAgICAgICAgICAgIC8vIHRvIGVuc3VyZSB3ZSBzdGFydCB3aXRoIGNsZWFuIHN0YXRlcyBpbiBuZXcgaW5zdGFuY2VzXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkgPSB7XG4gICAgICAgICAgICAgICAgYmFjazogW10sXG4gICAgICAgICAgICAgICAgZm9yd2FyZDogW11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMudWkuY2xvc2Uub2ZmKHRoaXMuY2xpY2spLm9uKHRoaXMuY2xpY2ssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gdGhlIHJlc2l6ZSBldmVudCBhdHRhY2hlcyBhbiBvZmYgZXZlbnQgdG8gdGhlIGJvZHlcbiAgICAgICAgICAgIC8vIHdoaWNoIGlzIGhhbmRsZWQgd2l0aGluIF9zdGFydFJlc2l6ZSgpXG4gICAgICAgICAgICB0aGlzLnVpLnJlc2l6ZS5vZmYodGhpcy5wb2ludGVyRG93bikub24odGhpcy5wb2ludGVyRG93biwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fc3RhcnRSZXNpemUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBjbG9zZSBzaWRlZnJhbWUgd2hlbiBjbGlja2luZyBvbiB0aGUgZGltbWVyXG4gICAgICAgICAgICB0aGlzLnVpLmRpbW1lci5vZmYodGhpcy5jbGljaykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnRzIHRvIHRoZSBiYWNrIGJ1dHRvblxuICAgICAgICAgICAgdGhpcy51aS5oaXN0b3J5QmFjay5vZmYodGhpcy5jbGljaykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LnVpLmhpc3RvcnlCYWNrLmhhc0NsYXNzKCdjbXMtaWNvbi1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhhdC5fZ29Ub0hpc3RvcnkoJ2JhY2snKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnRzIHRvIHRoZSBmb3J3YXJkIGJ1dHRvblxuICAgICAgICAgICAgdGhpcy51aS5oaXN0b3J5Rm9yd2FyZC5vZmYodGhpcy5jbGljaykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LnVpLmhpc3RvcnlGb3J3YXJkLmhhc0NsYXNzKCdjbXMtaWNvbi1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhhdC5fZ29Ub0hpc3RvcnkoJ2ZvcndhcmQnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyBhIGdpdmVuIHVybCB3aXRoaW4gYSBzaWRlZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2Qgb3BlblxuICAgICAgICAgKiBAY2hhaW5hYmxlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBvcHRzLnVybCB1cmwgdG8gcmVuZGVyIGlmcmFtZVxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRzLmFuaW1hdGVdIHNob3VsZCBzaWRlZnJhbWUgYmUgYW5pbWF0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4ob3B0cykge1xuICAgICAgICAgICAgaWYgKCEob3B0cyAmJiBvcHRzLnVybCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBhcmd1bWVudHMgcGFzc2VkIHRvIFwib3BlblwiIHdlcmUgaW52YWxpZC4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVybCA9IG9wdHMudXJsO1xuICAgICAgICAgICAgdmFyIGFuaW1hdGUgPSBvcHRzLmFuaW1hdGU7XG5cbiAgICAgICAgICAgIC8vIHNldHVwIGludGVybmFsc1xuICAgICAgICAgICAgdmFyIGxhbmd1YWdlID0gJ2xhbmd1YWdlPScgKyBDTVMuY29uZmlnLnJlcXVlc3QubGFuZ3VhZ2U7XG4gICAgICAgICAgICB2YXIgcGFnZV9pZCA9ICdwYWdlX2lkPScgKyBDTVMuY29uZmlnLnJlcXVlc3QucGFnZV9pZDtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBbXTtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRXaWR0aCA9IHRoaXMudWkuc2lkZWZyYW1lLm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgIHZhciBpc0ZyYW1lVmlzaWJsZSA9IHRoaXMudWkuc2lkZWZyYW1lLmlzKCc6dmlzaWJsZScpO1xuXG4gICAgICAgICAgICAvLyBzZXQgdGhlIHJhdGlvIGZvciBiaWdnZXIgZGV2aWNlcyB0aGFuIG1vYmlsZVxuICAgICAgICAgICAgaWYgKHRoaXMudWkuYm9keS53aWR0aCgpID49IENNUy5CUkVBS1BPSU5UUy5tb2JpbGUpIHtcbiAgICAgICAgICAgICAgICB3aWR0aCA9IENNUy5zZXR0aW5ncy5zaWRlZnJhbWUucG9zaXRpb24gfHxcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMub3B0aW9ucy5zaWRlZnJhbWVXaWR0aCAqIDEwMCArICclJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFdlIGhhdmUgdG8gcmViaW5kIGV2ZW50cyBldmVyeSB0aW1lIHdlIG9wZW4gYSBzaWRlZnJhbWVcbiAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIGV2ZW50IGhhbmRsZXJzIGNvbnRhaW4gcmVmZXJlbmNlcyB0byB0aGUgaW5zdGFuY2VcbiAgICAgICAgICAgIC8vIGFuZCBzaW5jZSB3ZSByZXVzZSB0aGUgc2FtZSBtYXJrdXAgd2UgbmVlZCB0byB1cGRhdGVcbiAgICAgICAgICAgIC8vIHRoYXQgaW5zdGFuY2UgcmVmZXJlbmNlIGV2ZXJ5IHRpbWUuXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMoKTtcblxuICAgICAgICAgICAgLy8gc2hvdyBkaW1tZXIgZXZlbiBiZWZvcmUgaWZyYW1lIGlzIGxvYWRlZFxuICAgICAgICAgICAgdGhpcy51aS5kaW1tZXIuc2hvdygpO1xuICAgICAgICAgICAgdGhpcy51aS5mcmFtZS5hZGRDbGFzcygnY21zLWxvYWRlcicpO1xuXG4gICAgICAgICAgICAvLyBzaG93IGxvYWRlclxuICAgICAgICAgICAgaWYgKENNUy5BUEkgJiYgQ01TLkFQSS5Ub29sYmFyKSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLnNob3dMb2FkZXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBtb2RpZnkgdGhlIHVybCBhcHByb3ByaWF0ZWx5IHRvIHBhc3NcbiAgICAgICAgICAgIC8vIGxhbmd1YWdlIGFuZCBwYWdlIHRvIHRoZSBwYXJhbXNcbiAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZihDTVMuY29uZmlnLnJlcXVlc3QudHJlZSkgPj0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChDTVMuY29uZmlnLnJlcXVlc3QubGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1c2gobGFuZ3VhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoQ01TLmNvbmZpZy5yZXF1ZXN0LnBhZ2VfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1c2gocGFnZV9pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1cmwgPSB0aGlzLm1ha2VVUkwodXJsLCBwYXJhbXMpO1xuXG4gICAgICAgICAgICAvLyBsb2FkIHRoZSBpZnJhbWVcbiAgICAgICAgICAgIHRoaXMuX2NvbnRlbnQodXJsKTtcblxuICAgICAgICAgICAgLy8gY2FuY2VsIGFuaW1hdGlvbiBpZiBzaWRlZnJhbWUgaXMgYWxyZWFkeSBzaG93blxuICAgICAgICAgICAgaWYgKGlzRnJhbWVWaXNpYmxlICYmIGN1cnJlbnRXaWR0aCA8IHdpZHRoKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIHVzZXIgaGFzIHBlcmZvcm1lZCBhbiBhY3Rpb24gdGhhdCByZXF1aXJlcyB0aGVcbiAgICAgICAgICAgICAgICAvLyBzaWRlZnJhbWUgdG8gYmUgc2hvd24sIHRoaXMgaW50ZW50IG91dHdlaWdocyBhbnlcbiAgICAgICAgICAgICAgICAvLyBwcmV2aW91cyBpbnRlbnQgdG8gbWluaW1pemUgdGhlIGZyYW1lLlxuICAgICAgICAgICAgICAgIENNUy5zZXR0aW5ncy5zaWRlZnJhbWUuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc0ZyYW1lVmlzaWJsZSAmJiBNYXRoLnJvdW5kKGN1cnJlbnRXaWR0aCkgPT09IE1hdGgucm91bmQod2lkdGgpKSB7XG4gICAgICAgICAgICAgICAgLy8gTWF0aC5yb3VuZCBiZWNhdXNlIHN1YnBpeGVsIHZhbHVlc1xuICAgICAgICAgICAgICAgIGFuaW1hdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2hvdyBpZnJhbWVcbiAgICAgICAgICAgIHRoaXMuX3Nob3cod2lkdGgsIGFuaW1hdGUpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyBjb250ZW50IHJlcGxhY2VtZW50IG1lY2hhbmlzbXMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NvbnRlbnRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCB2YWxpZCB1cmkgdG8gcGFzcyBvbiB0aGUgaWZyYW1lXG4gICAgICAgICAqL1xuICAgICAgICBfY29udGVudDogZnVuY3Rpb24gX2NvbnRlbnQodXJsKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaWZyYW1lID0gJCgnPGlmcmFtZSBzcmM9XCInICsgdXJsICsgJ1wiIGNsYXNzPVwiXCIgZnJhbWVib3JkZXI9XCIwXCIgLz4nKTtcbiAgICAgICAgICAgIHZhciBob2xkZXIgPSB0aGlzLnVpLmZyYW1lO1xuICAgICAgICAgICAgdmFyIGNvbnRlbnRzO1xuICAgICAgICAgICAgdmFyIGJvZHk7XG4gICAgICAgICAgICB2YXIgaU9TID0gL2lQaG9uZXxpUG9kfGlQYWQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogT24gaU9TIGlmcmFtZXMgZG8gbm90IHJlc3BlY3QgdGhlIHNpemUgc2V0IGluIGNzcyBvciBhdHRyaWJ1dGVzLCBhbmRcbiAgICAgICAgICAgICAqIGlzIGFsd2F5cyBtYXRjaGluZyB0aGUgY29udGVudC4gSG93ZXZlciwgaWYgeW91IGZpcnN0IGxvYWQgdGhlIHBhZ2VcbiAgICAgICAgICAgICAqIHdpdGggb25lIGFtb3VudCBvZiBjb250ZW50IChzbWFsbCkgYW5kIHRoZW4gZnJvbSB0aGVyZSB5b3UnZCBnbyB0byBhIHBhZ2VcbiAgICAgICAgICAgICAqIHdpdGggbG90cyBvZiBjb250ZW50IChsb25nLCBzY3JvbGwgcmVxdXJlZCkgaXQgd29uJ3QgYmUgc2Nyb2xsYWJsZSwgYmVjYXVzZVxuICAgICAgICAgICAgICogaWZyYW1lIHdvdWxkIHJldGFpbiB0aGUgc2l6ZSBvZiBwcmV2aW91cyBwYWdlLiBXaGVuIHRoaXMgaGFwcGVucyB3ZVxuICAgICAgICAgICAgICogbmVlZCB0byByZXJlbmRlciB0aGUgaWZyYW1lICh0aGF0J3Mgd2h5IHdlIGFyZSBhbmltYXRpbmcgdGhlIHdpZHRoIGhlcmUsIHNvIGZhclxuICAgICAgICAgICAgICogdGhhdCB3YXMgdGhlIG9ubHkgcmVsaWFibGUgd2F5KS4gQnV0IGFmdGVyIHRoYXQgaWYgeW91IHRyeSB0byBzY3JvbGwgdGhlIGlmcmFtZVxuICAgICAgICAgICAgICogd2hpY2ggaGVpZ2h0IHdhcyBqdXN0IGFkanVzdGVkIGl0IHdpbGwgaGlkZSBjb21wbGV0ZWx5IGZyb20gdGhlIHNjcmVlblxuICAgICAgICAgICAgICogKHRoaXMgaXMgYW4gaU9TIGdsaXRjaCwgdGhlIGNvbnRlbnQgd291bGQgc3RpbGwgYmUgdGhlcmUgYW5kIGluIGZhY3QgaXQgd291bGRcbiAgICAgICAgICAgICAqIGJlIHVzYWJsZSwgYnV0IGp1c3Qgbm90IHZpc2libGUpLiBUbyBnZXQgcmlkIG9mIHRoYXQgd2UgYnJpbmcgdXAgdGhlIHNoaW0gZWxlbWVudFxuICAgICAgICAgICAgICogdXAgYW5kIGRvd24gYWdhaW4gYW5kIHRoaXMgZml4ZXMgdGhlIGdsaXRjaC4gKHNhbWUgc2hpbSB3ZSB1c2UgZm9yIHJlc2l6aW5nIHRoZSBzaWRlZnJhbWUpXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogSXQgaXMgbm90IHJlY29tbWVuZGVkIHRvIGV4cG9zZSBpdCBhbmQgdXNlIGl0IG9uIG90aGVyIGRldmljZXMgcmF0aGVyIHRoYW4gaU9TIG9uZXMuXG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQGZ1bmN0aW9uIGZvcmNlUmVyZW5kZXJPbklPU1xuICAgICAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gZm9yY2VSZXJlbmRlck9uSU9TKCkge1xuICAgICAgICAgICAgICAgIHZhciB3ID0gdGhhdC51aS5zaWRlZnJhbWUud2lkdGgoKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLnNpZGVmcmFtZS5hbmltYXRlKHsgJ3dpZHRoJzogdyArIDEgfSwgMCk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkuc2lkZWZyYW1lLmFuaW1hdGUoeyAnd2lkdGgnOiB3IH0sIDApO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLnNoaW0uY3NzKCd6LWluZGV4JywgMjApO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudWkuc2hpbS5jc3MoJ3otaW5kZXgnLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCBsb2FkIGV2ZW50IHRvIGlmcmFtZVxuICAgICAgICAgICAgaWZyYW1lLmhpZGUoKS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBpZnJhbWUgY2FuIGJlIGFjY2Vzc2VkXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICc8c3Ryb25nPicgKyBlcnJvciArICc8L3N0cm9uZz4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnRlbnRzID0gaWZyYW1lLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgYm9keSA9IGNvbnRlbnRzLmZpbmQoJ2JvZHknKTtcblxuICAgICAgICAgICAgICAgIC8vIGluamVjdCBjc3MgY2xhc3NcbiAgICAgICAgICAgICAgICBib2R5LmFkZENsYXNzKCdjbXMtYWRtaW4gY21zLWFkbWluLXNpZGVmcmFtZScpO1xuXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGxvYWRlclxuICAgICAgICAgICAgICAgIHRoYXQudWkuZnJhbWUucmVtb3ZlQ2xhc3MoJ2Ntcy1sb2FkZXInKTtcbiAgICAgICAgICAgICAgICAvLyB0aGFuIHNob3dcbiAgICAgICAgICAgICAgICBpZnJhbWUuc2hvdygpO1xuXG4gICAgICAgICAgICAgICAgLy8gZm9yY2Ugc3R5bGUgcmVjYWxjdWxhdGlvbiBvbiBpT1NcbiAgICAgICAgICAgICAgICBpZiAoaU9TKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlUmVyZW5kZXJPbklPUygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFkZCBkZWJ1ZyBpbmZvc1xuICAgICAgICAgICAgICAgIGlmIChDTVMuY29uZmlnLmRlYnVnKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvZHkuYWRkQ2xhc3MoJ2Ntcy1kZWJ1ZycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdXJsIGluIHNldHRpbmdzXG4gICAgICAgICAgICAgICAgQ01TLnNldHRpbmdzLnNpZGVmcmFtZS51cmwgPSBpZnJhbWVbMF0uY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICAgICAgICAgIENNUy5zZXR0aW5ncyA9IHRoYXQuc2V0U2V0dGluZ3MoQ01TLnNldHRpbmdzKTtcblxuICAgICAgICAgICAgICAgIC8vIFRoaXMgZXNzZW50aWFsbHkgaGlkZXMgdGhlIHRvb2xiYXIgZHJvcGRvd24gd2hlblxuICAgICAgICAgICAgICAgIC8vIGNsaWNrIGhhcHBlbnMgaW5zaWRlIG9mIGEgc2lkZWZyYW1lIGlmcmFtZVxuICAgICAgICAgICAgICAgIGJvZHkub24odGhhdC5jbGljaywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS50cmlnZ2VyKHRoYXQuY2xpY2spO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gYXR0YWNoIGNsb3NlIGV2ZW50XG4gICAgICAgICAgICAgICAgYm9keS5vbigna2V5ZG93bi5jbXMnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5FU0MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gYWRkaW5nIGRqYW5nbyBoYWNrc1xuICAgICAgICAgICAgICAgIGNvbnRlbnRzLmZpbmQoJy52aWV3c2l0ZWxpbmsnKS5hdHRyKCd0YXJnZXQnLCAnX3RvcCcpO1xuXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIGhpc3RvcnlcbiAgICAgICAgICAgICAgICB0aGF0Ll9hZGRUb0hpc3RvcnkodGhpcy5jb250ZW50V2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGNsZWFyIHRoZSBmcmFtZSAocmVtb3ZlcyBhbGwgdGhlIGhhbmRsZXJzKVxuICAgICAgICAgICAgaG9sZGVyLmVtcHR5KCk7XG4gICAgICAgICAgICAvLyBpbmplY3QgaWZyYW1lXG4gICAgICAgICAgICBob2xkZXIuaHRtbChpZnJhbWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbmltYXRpb24gaGVscGVyIGZvciBvcGVuaW5nIHRoZSBzaWRlZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Nob3dcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIHdpZHRoIHRoYXQgdGhlIGlmcmFtZXMgb3BlbnMgdG9cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFthbmltYXRlXSBBbmltYXRpb24gZHVyYXRpb25cbiAgICAgICAgICovXG4gICAgICAgIF9zaG93OiBmdW5jdGlvbiBfc2hvdyh3aWR0aCwgYW5pbWF0ZSkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLnVpLnNpZGVmcmFtZS5zaG93KCk7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHNpZGVmcmFtZSBzaG91bGQgYmUgaGlkZGVuXG4gICAgICAgICAgICBpZiAoQ01TLnNldHRpbmdzLnNpZGVmcmFtZS5oaWRkZW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSBkbyBub3JtYWwgYmVoYXZpb3VyXG4gICAgICAgICAgICBpZiAoYW5pbWF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudWkuc2lkZWZyYW1lLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIG92ZXJmbG93OiAndmlzaWJsZSdcbiAgICAgICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMuc2lkZWZyYW1lRHVyYXRpb24pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLnNpZGVmcmFtZS5jc3MoJ3dpZHRoJywgd2lkdGgpO1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IHdpZHRoIGlmIGxhcmdlciB0aGFuIGF2YWlsYWJsZSBzcGFjZVxuICAgICAgICAgICAgICAgIGlmICh3aWR0aCA+PSB0aGlzLnVpLndpbmRvdy53aWR0aCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkuc2lkZWZyYW1lLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy51aS53aW5kb3cud2lkdGgoKSAtIDMwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICd2aXNpYmxlJ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHRyaWdnZXIgQVBJIGhhbmRsZXJzXG4gICAgICAgICAgICBpZiAoQ01TLkFQSSAmJiBDTVMuQVBJLlRvb2xiYXIpIHtcbiAgICAgICAgICAgICAgICAvLyBGSVhNRTogaW5pdGlhbGl6YXRpb24gbmVlZHMgdG8gYmUgZG9uZSBhZnRlciBvdXIgbGlicyBhcmUgbG9hZGVkXG4gICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLm9wZW4oKTtcbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuaGlkZUxvYWRlcigpO1xuICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5fbG9jayh0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYWRkIGVzYyBjbG9zZSBldmVudFxuICAgICAgICAgICAgdGhpcy51aS5ib2R5Lm9mZigna2V5ZG93bi5jbXMuY2xvc2UnKS5vbigna2V5ZG93bi5jbXMuY2xvc2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IENNUy5LRVlTLkVTQykge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9wdGlvbnMub25DbG9zZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gZGlzYWJsZSBzY3JvbGxpbmcgZm9yIHRvdWNoXG4gICAgICAgICAgICB0aGlzLnVpLmJvZHkuYWRkQ2xhc3MoJ2Ntcy1wcmV2ZW50LXNjcm9sbGluZycpO1xuICAgICAgICAgICAgdGhpcy5wcmV2ZW50VG91Y2hTY3JvbGxpbmcoJChkb2N1bWVudCksICdzaWRlZnJhbWUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xvc2VzIHRoZSBjdXJyZW50IGluc3RhbmNlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIGNsb3NlXG4gICAgICAgICAqL1xuICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAgICAgICAvLyBoaWRlIGRpbW1lciBpbW1lZGlhdGVseVxuICAgICAgICAgICAgdGhpcy51aS5kaW1tZXIuaGlkZSgpO1xuXG4gICAgICAgICAgICAvLyB1cGRhdGUgc2V0dGluZ3NcbiAgICAgICAgICAgIENNUy5zZXR0aW5ncy5zaWRlZnJhbWUgPSB7XG4gICAgICAgICAgICAgICAgdXJsOiBudWxsLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMub3B0aW9ucy5zaWRlZnJhbWVXaWR0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIENNUy5zZXR0aW5ncyA9IHRoaXMuc2V0U2V0dGluZ3MoQ01TLnNldHRpbmdzKTtcblxuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHJlbG9hZGluZ1xuICAgICAgICAgICAgdGhpcy5yZWxvYWRCcm93c2VyKHRoaXMub3B0aW9ucy5vbkNsb3NlLCBmYWxzZSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIC8vIHRyaWdnZXIgaGlkZSBhbmltYXRpb25cbiAgICAgICAgICAgIHRoaXMuX2hpZGUoe1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLm9wdGlvbnMuc2lkZWZyYW1lRHVyYXRpb24gLyAyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW5pbWF0aW9uIGhlbHBlciBmb3IgY2xvc2luZyB0aGUgaWZyYW1lLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9oaWRlXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c11cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLmR1cmF0aW9uPXRoaXMub3B0aW9ucy5zaWRlZnJhbWVEdXJhdGlvbl0gYW5pbWF0aW9uIGR1cmF0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBfaGlkZTogZnVuY3Rpb24gX2hpZGUob3B0cykge1xuICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy5vcHRpb25zLnNpZGVmcmFtZUR1cmF0aW9uO1xuICAgICAgICAgICAgaWYgKG9wdHMgJiYgdHlwZW9mIG9wdHMuZHVyYXRpb24gPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgZHVyYXRpb24gPSBvcHRzLmR1cmF0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnVpLnNpZGVmcmFtZS5hbmltYXRlKHsgd2lkdGg6IDAgfSwgZHVyYXRpb24sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy51aS5mcmFtZS5yZW1vdmVDbGFzcygnY21zLWxvYWRlcicpO1xuXG4gICAgICAgICAgICBpZiAoQ01TLkFQSSAmJiBDTVMuQVBJLlRvb2xiYXIpIHtcbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuX2xvY2soZmFsc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnVpLmJvZHkub2ZmKCdrZXlkb3duLmNtcy5jbG9zZScpO1xuXG4gICAgICAgICAgICAvLyBlbmFibGUgc2Nyb2xsaW5nIGFnYWluXG4gICAgICAgICAgICB0aGlzLnVpLmJvZHkucmVtb3ZlQ2xhc3MoJ2Ntcy1wcmV2ZW50LXNjcm9sbGluZycpO1xuICAgICAgICAgICAgdGhpcy5hbGxvd1RvdWNoU2Nyb2xsaW5nKCQoZG9jdW1lbnQpLCAnc2lkZWZyYW1lJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYXRlcyB0aGUgc3RhcnQgcmVzaXplIGV2ZW50IGZyb20gYF9ldmVudHNgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdGFydFJlc2l6ZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3N0YXJ0UmVzaXplOiBmdW5jdGlvbiBfc3RhcnRSZXNpemUoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgb3V0ZXJPZmZzZXQgPSAzMDtcbiAgICAgICAgICAgIHZhciB0aW1lciA9IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgZXZlbnQgZm9yIHN0b3BwaW5nXG4gICAgICAgICAgICB0aGlzLnVpLmJvZHkub24odGhpcy5wb2ludGVyVXAsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3N0b3BSZXNpemUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyB0aGlzIHByZXZlbnRzIHRoZSBpZnJhbWUgZnJvbSBiZWluZyBmb2N1c2FibGVcbiAgICAgICAgICAgIHRoaXMudWkuc2hpbS5jc3MoJ3otaW5kZXgnLCAyMCk7XG5cbiAgICAgICAgICAgIHRoaXMudWkuYm9keS5hdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicsICdub25lJykub24odGhpcy5wb2ludGVyTW92ZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LmNsaWVudFggPD0gMzIwKSB7XG4gICAgICAgICAgICAgICAgICAgIGUub3JpZ2luYWxFdmVudC5jbGllbnRYID0gMzIwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LmNsaWVudFggPj0gdGhhdC51aS53aW5kb3cud2lkdGgoKSAtIG91dGVyT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGUub3JpZ2luYWxFdmVudC5jbGllbnRYID0gdGhhdC51aS53aW5kb3cud2lkdGgoKSAtIG91dGVyT2Zmc2V0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQudWkuc2lkZWZyYW1lLmNzcygnd2lkdGgnLCBlLm9yaWdpbmFsRXZlbnQuY2xpZW50WCk7XG5cbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgc2V0dGluZ3NcbiAgICAgICAgICAgICAgICBDTVMuc2V0dGluZ3Muc2lkZWZyYW1lLnBvc2l0aW9uID0gZS5vcmlnaW5hbEV2ZW50LmNsaWVudFg7XG5cbiAgICAgICAgICAgICAgICAvLyBzYXZlIHBvc2l0aW9uIGludG8gb3VyIHNldHRpbmdzXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBDTVMuc2V0dGluZ3MgPSB0aGF0LnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgfSwgdGhhdC5zZXR0aW5nc1JlZnJlc2hUaW1lcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhdGVzIHRoZSBzdG9wIHJlc2l6ZSBldmVudCBmcm9tIGBfc3RhcnRSZXNpemVgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zdG9wUmVzaXplXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc3RvcFJlc2l6ZTogZnVuY3Rpb24gX3N0b3BSZXNpemUoKSB7XG4gICAgICAgICAgICB0aGlzLnVpLnNoaW0uY3NzKCd6LWluZGV4JywgMSk7XG4gICAgICAgICAgICB0aGlzLnVpLmJvZHlcbiAgICAgICAgICAgICAgICAub2ZmKHRoaXMucG9pbnRlclVwKVxuICAgICAgICAgICAgICAgIC5vZmYodGhpcy5wb2ludGVyTW92ZSlcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignZGF0YS10b3VjaC1hY3Rpb24nKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBoaXN0b3J5IHN0YXRlcyBmcm9tIGB0aGlzLmhpc3RvcnlgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nb1RvSGlzdG9yeVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBjYW4gYmUgZWl0aGVyIGBiYWNrYCBvciBgZm9yd2FyZGBcbiAgICAgICAgICovXG4gICAgICAgIF9nb1RvSGlzdG9yeTogZnVuY3Rpb24gX2dvVG9IaXN0b3J5KHR5cGUpIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWUgPSB0aGlzLnVpLmZyYW1lLmZpbmQoJ2lmcmFtZScpO1xuICAgICAgICAgICAgdmFyIHRtcDtcblxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdiYWNrJykge1xuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBsYXRlc3QgZW50cnkgKHdoaWNoIGlzIHRoZSBjdXJyZW50IHNpdGUpXG4gICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5LmZvcndhcmQucHVzaCh0aGlzLmhpc3RvcnkuYmFjay5wb3AoKSk7XG4gICAgICAgICAgICAgICAgaWZyYW1lLmF0dHIoJ3NyYycsIHRoaXMuaGlzdG9yeS5iYWNrW3RoaXMuaGlzdG9yeS5iYWNrLmxlbmd0aCAtIDFdKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdmb3J3YXJkJykge1xuICAgICAgICAgICAgICAgIHRtcCA9IHRoaXMuaGlzdG9yeS5mb3J3YXJkLnBvcCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5iYWNrLnB1c2godG1wKTtcbiAgICAgICAgICAgICAgICBpZnJhbWUuYXR0cignc3JjJywgdG1wKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGlzdG9yeUJ1dHRvbnMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmVzIHRoZSBoaXN0b3J5IHN0YXRlcyBpbiBgdGhpcy5oaXN0b3J5YC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfYWRkVG9IaXN0b3J5XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgdXJsIHRvIGJlIHN0b3JlZCBpbiBgdGhpcy5oaXN0b3J5LmJhY2tgXG4gICAgICAgICAqL1xuICAgICAgICBfYWRkVG9IaXN0b3J5OiBmdW5jdGlvbiBfYWRkVG9IaXN0b3J5KHVybCkge1xuICAgICAgICAgICAgdmFyIGlmcmFtZSA9IHRoaXMudWkuZnJhbWUuZmluZCgnaWZyYW1lJyk7XG5cbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gdXBkYXRlIGhpc3RvcnkgZmlyc3RcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5iYWNrLnB1c2godXJsKTtcbiAgICAgICAgICAgIC8vIGFuZCB0aGFuIHNldCBsb2NhbCB2YXJpYWJsZXNcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmhpc3RvcnkuYmFjay5sZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIHN0b3JlIGN1cnJlbnQgdXJsIGlmIGFycmF5IGlzIGVtcHR5XG4gICAgICAgICAgICBpZiAodGhpcy5oaXN0b3J5LmJhY2subGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkuYmFjay5wdXNoKGlmcmFtZS5hdHRyKCdzcmMnKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBkdXBsaWNhdGVzXG4gICAgICAgICAgICBpZiAodGhpcy5oaXN0b3J5LmJhY2tbbGVuZ3RoIC0gMV0gPT09IHRoaXMuaGlzdG9yeS5iYWNrW2xlbmd0aCAtIDJdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5LmJhY2sucG9wKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpc3RvcnlCdXR0b25zKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIGNvcnJlY3Qgc3RhdGVzIGZvciB0aGUgaGlzdG9yeSBVSSBlbGVtZW50cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfdXBkYXRlSGlzdG9yeUJ1dHRvbnNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF91cGRhdGVIaXN0b3J5QnV0dG9uczogZnVuY3Rpb24gX3VwZGF0ZUhpc3RvcnlCdXR0b25zKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaGlzdG9yeS5iYWNrLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLmhpc3RvcnlCYWNrLnJlbW92ZUNsYXNzKCdjbXMtaWNvbi1kaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLmhpc3RvcnlCYWNrLmFkZENsYXNzKCdjbXMtaWNvbi1kaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5oaXN0b3J5LmZvcndhcmQubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLmhpc3RvcnlGb3J3YXJkLnJlbW92ZUNsYXNzKCdjbXMtaWNvbi1kaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLmhpc3RvcnlGb3J3YXJkLmFkZENsYXNzKCdjbXMtaWNvbi1kaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KShDTVMuJCk7XG4iLCIvKlxuICogQ29weXJpZ2h0IGh0dHBzOi8vZ2l0aHViLmNvbS9kaXZpby9kamFuZ28tY21zXG4gKi9cblxuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbi8vIE5BTUVTUEFDRVNcbi8qKlxuICogQG1vZHVsZSBDTVNcbiAqL1xuLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbnZhciBDTVMgPSB3aW5kb3cuQ01TIHx8IHt9O1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gQ2xpcGJvYXJkXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIGNvcHkgJiBwYXN0ZSBpbiB0aGUgc3RydWN0dXJlYm9hcmQuXG4gICAgICpcbiAgICAgKiBAY2xhc3MgQ2xpcGJvYXJkXG4gICAgICogQG5hbWVzcGFjZSBDTVNcbiAgICAgKiBAdXNlcyBDTVMuQVBJLkhlbHBlcnNcbiAgICAgKi9cbiAgICBDTVMuQ2xpcGJvYXJkID0gbmV3IENNUy5DbGFzcyh7XG5cbiAgICAgICAgaW1wbGVtZW50OiBbQ01TLkFQSS5IZWxwZXJzXSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXR1cFVJKCk7XG5cbiAgICAgICAgICAgIC8vIHN0YXRlc1xuICAgICAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMuY2xpcGJvYXJkJztcblxuICAgICAgICAgICAgLy8gc2V0dXAgZXZlbnRzXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FjaGVzIGFsbCB0aGUgalF1ZXJ5IGVsZW1lbnQgcXVlcmllcy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICAgICAgdmFyIGNsaXBib2FyZCA9ICQoJy5jbXMtY2xpcGJvYXJkJyk7XG4gICAgICAgICAgICB0aGlzLnVpID0ge1xuICAgICAgICAgICAgICAgIGNsaXBib2FyZDogY2xpcGJvYXJkLFxuICAgICAgICAgICAgICAgIHRyaWdnZXJzOiAkKCcuY21zLWNsaXBib2FyZC10cmlnZ2VyIGEnKSxcbiAgICAgICAgICAgICAgICB0cmlnZ2VyUmVtb3ZlOiAkKCcuY21zLWNsaXBib2FyZC1lbXB0eSBhJyksXG4gICAgICAgICAgICAgICAgcGx1Z2luc0xpc3Q6IGNsaXBib2FyZC5maW5kKCcuY21zLWNsaXBib2FyZC1jb250YWluZXJzJyksXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQ6ICQoZG9jdW1lbnQpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGV2ZW50IGhhbmRsZXJzIGZvciBjbGlwYm9hcmQgdWkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2V2ZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgTUlOX1dJRFRIID0gNDAwO1xuICAgICAgICAgICAgLy8gRklYTUUga2luZCBvZiBhIG1hZ2ljIG51bWJlciBmb3IgMSBpdGVtIGluIGNsaXBib2FyZFxuICAgICAgICAgICAgdmFyIE1JTl9IRUlHSFQgPSAxMTc7XG5cbiAgICAgICAgICAgIHRoYXQubW9kYWwgPSBuZXcgQ01TLk1vZGFsKHtcbiAgICAgICAgICAgICAgICBtaW5XaWR0aDogTUlOX1dJRFRILFxuICAgICAgICAgICAgICAgIG1pbkhlaWdodDogTUlOX0hFSUdIVCxcbiAgICAgICAgICAgICAgICBtaW5pbWl6YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbWF4aW1pemFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlc2l6YWJsZTogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGF0Lm1vZGFsLm9uKCdjbXMubW9kYWwubG9hZGVkIGNtcy5tb2RhbC5jbG9zZWQnLCBmdW5jdGlvbiByZW1vdmVQbGFjZWhvbGRlcigpIHtcbiAgICAgICAgICAgICAgICAvLyBjYW5ub3QgYmUgY2FjaGVkXG4gICAgICAgICAgICAgICAgJCgnLmNtcy1hZGQtcGx1Z2luLXBsYWNlaG9sZGVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KS5vbignY21zLm1vZGFsLmNsb3NlZCBjbXMubW9kYWwubG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLnBsdWdpbnNMaXN0LnByZXBlbmRUbyh0aGF0LnVpLmNsaXBib2FyZCk7XG4gICAgICAgICAgICB9KS51aS5tb2RhbC5vbignY21zLm1vZGFsLmxvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5wbHVnaW5zTGlzdC5wcmVwZW5kVG8odGhhdC51aS5jbGlwYm9hcmQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoYXQudWkudHJpZ2dlcnMub24odGhhdC5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoKS5oYXNDbGFzcygnY21zLXRvb2xiYXItaXRlbS1uYXZpZ2F0aW9uLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQubW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IHRoYXQudWkucGx1Z2luc0xpc3QsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGF0LnVpLmNsaXBib2FyZC5kYXRhKCd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogTUlOX1dJRFRILFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1JTl9IRUlHSFRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50LnRyaWdnZXIoJ2NsaWNrLmNtcy50b29sYmFyJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYWRkIHJlbW92ZSBldmVudFxuICAgICAgICAgICAgdGhhdC51aS50cmlnZ2VyUmVtb3ZlLm9uKHRoYXQuY2xpY2ssIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykucGFyZW50KCkuaGFzQ2xhc3MoJ2Ntcy10b29sYmFyLWl0ZW0tbmF2aWdhdGlvbi1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhhdC5jbGVhcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBlbGVtZW50IG9uIHN1Y2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLnRyaWdnZXJzLnBhcmVudCgpLmFkZENsYXNzKCdjbXMtdG9vbGJhci1pdGVtLW5hdmlnYXRpb24tZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS50cmlnZ2VyUmVtb3ZlLnBhcmVudCgpLmFkZENsYXNzKCdjbXMtdG9vbGJhci1pdGVtLW5hdmlnYXRpb24tZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC50cmlnZ2VyKCdjbGljay5jbXMudG9vbGJhcicpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsZWFycyB0aGUgY2xpcGJvYXJkIGJ5IHF1ZXJpbmcgdGhlIHNlcnZlci5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgb3B0aW9uYWwsIGJ1dCBpZiBwcm92aWRlZCAtIGl0J3MgY2FsbGVkXG4gICAgICAgICAqIG5vIG1hdHRlciB3aGF0IG91dGNvbWUgd2FzIG9mIHRoZSBhamF4IGNhbGwuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgY2xlYXJcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXVxuICAgICAgICAgKi9cbiAgICAgICAgY2xlYXI6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgLy8gcG9zdCBuZWVkcyB0byBiZSBhIHN0cmluZywgaXQgd2lsbCBiZSBjb252ZXJ0ZWQgdXNpbmcgSlNPTi5wYXJzZVxuICAgICAgICAgICAgdmFyIHBvc3QgPSAneyBcImNzcmZtaWRkbGV3YXJldG9rZW5cIjogXCInICsgQ01TLmNvbmZpZy5jc3JmICsgJ1wiIH0nO1xuICAgICAgICAgICAgdmFyIHBhc3RlSXRlbXMgPSAkKCcuY21zLXN1Ym1lbnUtaXRlbSBbZGF0YS1yZWw9cGFzdGVdJykucGFyZW50KCkuXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3MoJ2Ntcy1zdWJtZW51LWl0ZW0tZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHBhc3RlSXRlbXMuZmluZCgnLmNtcy1zdWJtZW51LWl0ZW0tcGFzdGUtdG9vbHRpcCcpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICBwYXN0ZUl0ZW1zLmZpbmQoJy5jbXMtc3VibWVudS1pdGVtLXBhc3RlLXRvb2x0aXAtZW1wdHknKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcblxuICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gYWpheFxuICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLm9wZW5BamF4KHtcbiAgICAgICAgICAgICAgICB1cmw6IENNUy5jb25maWcuY2xpcGJvYXJkLnVybCxcbiAgICAgICAgICAgICAgICBwb3N0OiBwb3N0LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH0pO1xufSkoQ01TLiQpO1xuIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOQU1FU1BBQ0VTXG4vKipcbiAqIEBtb2R1bGUgQ01TXG4gKi9cbnZhciBDTVMgPSB3aW5kb3cuQ01TIHx8IHt9O1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gUGx1Z2luXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZG9jO1xuICAgIHZhciBjbGlwYm9hcmQ7XG4gICAgdmFyIGNsaXBib2FyZERyYWdnYWJsZTtcbiAgICB2YXIgY2xpcGJvYXJkUGx1Z2luO1xuXG4gICAgLyoqXG4gICAgICogQ2xhc3MgZm9yIGhhbmRsaW5nIFBsdWdpbnMgLyBQbGFjZWhvbGRlcnMgb3IgR2VuZXJpY3MuXG4gICAgICogSGFuZGxlcyBhZGRpbmcgLyBtb3ZpbmcgLyBjb3B5aW5nIC8gcGFzdGluZyAvIG1lbnVzIGV0Y1xuICAgICAqIGluIHN0cnVjdHVyZWJvYXJkLlxuICAgICAqXG4gICAgICogQGNsYXNzIFBsdWdpblxuICAgICAqIEBuYW1lc3BhY2UgQ01TXG4gICAgICogQHVzZXMgQ01TLkFQSS5IZWxwZXJzXG4gICAgICovXG4gICAgQ01TLlBsdWdpbiA9IG5ldyBDTVMuQ2xhc3Moe1xuXG4gICAgICAgIGltcGxlbWVudDogW0NNUy5BUEkuSGVscGVyc10sXG5cbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgdHlwZTogJycsIC8vIGJhciwgcGx1Z2luIG9yIGdlbmVyaWNcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyX2lkOiBudWxsLFxuICAgICAgICAgICAgcGx1Z2luX3R5cGU6ICcnLFxuICAgICAgICAgICAgcGx1Z2luX2lkOiBudWxsLFxuICAgICAgICAgICAgcGx1Z2luX2xhbmd1YWdlOiAnJyxcbiAgICAgICAgICAgIHBsdWdpbl9wYXJlbnQ6IG51bGwsXG4gICAgICAgICAgICBwbHVnaW5fb3JkZXI6IG51bGwsXG4gICAgICAgICAgICBwbHVnaW5fYnJlYWRjcnVtYjogW10sXG4gICAgICAgICAgICBwbHVnaW5fcmVzdHJpY3Rpb246IFtdLFxuICAgICAgICAgICAgcGx1Z2luX3BhcmVudF9yZXN0cmljdGlvbjogW10sXG4gICAgICAgICAgICB1cmxzOiB7XG4gICAgICAgICAgICAgICAgYWRkX3BsdWdpbjogJycsXG4gICAgICAgICAgICAgICAgZWRpdF9wbHVnaW46ICcnLFxuICAgICAgICAgICAgICAgIG1vdmVfcGx1Z2luOiAnJyxcbiAgICAgICAgICAgICAgICBjb3B5X3BsdWdpbjogJycsXG4gICAgICAgICAgICAgICAgZGVsZXRlX3BsdWdpbjogJydcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgb3B0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldHVwVUkoY29udGFpbmVyKTtcblxuICAgICAgICAgICAgLy8gc3RhdGVzXG4gICAgICAgICAgICB0aGlzLmNzcmYgPSBDTVMuY29uZmlnLmNzcmY7XG4gICAgICAgICAgICB0aGlzLmNsaWNrID0gJ2NsaWNrLmNtcy5wbHVnaW4nO1xuICAgICAgICAgICAgdGhpcy5wb2ludGVyVXAgPSAncG9pbnRlcnVwLmNtcy5wbHVnaW4nO1xuICAgICAgICAgICAgdGhpcy5wb2ludGVyRG93biA9ICdwb2ludGVyZG93bi5jbXMucGx1Z2luJztcbiAgICAgICAgICAgIHRoaXMucG9pbnRlck92ZXJBbmRPdXQgPSAncG9pbnRlcm92ZXIuY21zLnBsdWdpbiBwb2ludGVyb3V0LmNtcy5wbHVnaW4nO1xuICAgICAgICAgICAgdGhpcy5kb3VibGVDbGljayA9ICdkYmxjbGljay5jbXMucGx1Z2luJztcbiAgICAgICAgICAgIHRoaXMua2V5VXAgPSAna2V5dXAuY21zLnBsdWdpbic7XG4gICAgICAgICAgICB0aGlzLmtleURvd24gPSAna2V5ZG93bi5jbXMucGx1Z2luJztcbiAgICAgICAgICAgIHRoaXMubW91c2VFdmVudHMgPSAnbW91c2Vkb3duLmNtcy5wbHVnaW4gbW91c2Vtb3ZlLmNtcy5wbHVnaW4gbW91c2V1cC5jbXMucGx1Z2luJztcbiAgICAgICAgICAgIHRoaXMudG91Y2hTdGFydCA9ICd0b3VjaHN0YXJ0LmNtcy5wbHVnaW4nO1xuICAgICAgICAgICAgdGhpcy50b3VjaEVuZCA9ICd0b3VjaGVuZC5jbXMucGx1Z2luJztcblxuICAgICAgICAgICAgLy8gYmluZCBkYXRhIGVsZW1lbnQgdG8gdGhlIGNvbnRhaW5lclxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIuZGF0YSgnc2V0dGluZ3MnLCB0aGlzLm9wdGlvbnMpO1xuXG4gICAgICAgICAgICAvLyBkZXRlcm1pbmUgdHlwZSBvZiBwbHVnaW5cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdwbGFjZWhvbGRlcic6IC8vIGhhbmRsZXIgZm9yIHBsYWNlaG9sZGVyIGJhcnNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UGxhY2Vob2xkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29sbGFwc2FibGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ3BsdWdpbic6IC8vIGhhbmRsZXIgZm9yIGFsbCBwbHVnaW5zXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFBsdWdpbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb2xsYXBzYWJsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogLy8gaGFuZGxlciBmb3Igc3RhdGljIGNvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0R2VuZXJpYygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWNoZXMgc29tZSBqUXVlcnkgcmVmZXJlbmNlcyBhbmQgc2V0cyB1cCBzdHJ1Y3R1cmUgZm9yXG4gICAgICAgICAqIGZ1cnRoZXIgaW5pdGlhbGlzYXRpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwVUlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNvbnRhaW5lciBgY21zLXBsdWdpbi0ke2lkfWBcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cFVJOiBmdW5jdGlvbiBzZXR1cFVJKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29udGFpbmVyID0gJCgnLicgKyBjb250YWluZXIpO1xuICAgICAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICBwdWJsaXNoOiAkKCcuY21zLWJ0bi1wdWJsaXNoJyksXG4gICAgICAgICAgICAgICAgc2F2ZTogJCgnLmNtcy10b29sYmFyLWl0ZW0tc3dpdGNoLXNhdmUtZWRpdCcpLFxuICAgICAgICAgICAgICAgIHdpbmRvdzogJCh3aW5kb3cpLFxuICAgICAgICAgICAgICAgIHJldmVydDogJCgnLmNtcy10b29sYmFyLXJldmVydCcpLFxuICAgICAgICAgICAgICAgIGRyYWdiYXI6IG51bGwsXG4gICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRyYWdnYWJsZXM6IG51bGwsXG4gICAgICAgICAgICAgICAgc3VibWVudTogbnVsbCxcbiAgICAgICAgICAgICAgICBkcm9wZG93bjogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyB1cCBiZWhhdmlvdXJzIGFuZCB1aSBmb3IgcGxhY2Vob2xkZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldFBsYWNlaG9sZGVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2V0UGxhY2Vob2xkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2JhciA9ICQoJy5jbXMtZHJhZ2Jhci0nICsgdGhpcy5vcHRpb25zLnBsYWNlaG9sZGVyX2lkKTtcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2dhYmxlcyA9IHRoaXMudWkuZHJhZ2Jhci5jbG9zZXN0KCcuY21zLWRyYWdhcmVhJykuZmluZCgnPiAuY21zLWRyYWdnYWJsZXMnKTtcbiAgICAgICAgICAgIHRoaXMudWkuc3VibWVudSA9IHRoaXMudWkuZHJhZ2Jhci5maW5kKCcuY21zLXN1Ym1lbnUtc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IHRoaXMudWkuZHJhZ2Jhci5maW5kKCcuY21zLWRyYWdiYXItdGl0bGUnKTtcbiAgICAgICAgICAgIHZhciB0b2dnbGVyTGlua3MgPSB0aGlzLnVpLmRyYWdiYXIuZmluZCgnLmNtcy1kcmFnYmFyLXRvZ2dsZXIgYScpO1xuICAgICAgICAgICAgdmFyIGV4cGFuZGVkID0gJ2Ntcy1kcmFnYmFyLXRpdGxlLWV4cGFuZGVkJztcblxuICAgICAgICAgICAgLy8gcmVnaXN0ZXIgdGhlIHN1Ym5hdiBvbiB0aGUgcGxhY2Vob2xkZXJcbiAgICAgICAgICAgIHRoaXMuX3NldFNldHRpbmdzTWVudSh0aGlzLnVpLnN1Ym1lbnUpO1xuICAgICAgICAgICAgdGhpcy5fc2V0QWRkUGx1Z2luTW9kYWwodGhpcy51aS5kcmFnYmFyLmZpbmQoJy5jbXMtc3VibWVudS1hZGQnKSk7XG5cbiAgICAgICAgICAgIENNUy5zZXR0aW5ncy5kcmFnYmFycyA9IENNUy5zZXR0aW5ncy5kcmFnYmFycyB8fCBbXTsgLy8gZXhwYW5kZWQgZHJhZ2JhcnMgYXJyYXlcblxuICAgICAgICAgICAgLy8gZW5hYmxlIGV4cGFuZGluZy9jb2xsYXBzaW5nIGdsb2JhbGx5IHdpdGhpbiB0aGUgcGxhY2Vob2xkZXJcbiAgICAgICAgICAgIHRvZ2dsZXJMaW5rcy5vZmYodGhpcy5jbGljaykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHRpdGxlLmhhc0NsYXNzKGV4cGFuZGVkKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9jb2xsYXBzZUFsbCh0aXRsZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fZXhwYW5kQWxsKHRpdGxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCQuaW5BcnJheSh0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXJfaWQsIENNUy5zZXR0aW5ncy5kcmFnYmFycykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGl0bGUuYWRkQ2xhc3MoZXhwYW5kZWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jaGVja0lmUGFzdGVBbGxvd2VkKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgYmVoYXZpb3VycyBhbmQgdWkgZm9yIHBsdWdpbi5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0UGx1Z2luXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2V0UGx1Z2luOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIGFkZHMgZG91YmxlIGNsaWNrIHRvIGVkaXRcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLmFkZCh0aGlzLnVpLmRyYWdpdGVtKS5vbih0aGlzLmRvdWJsZUNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5lZGl0UGx1Z2luKFxuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9wdGlvbnMudXJscy5lZGl0X3BsdWdpbixcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLnBsdWdpbl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9wdGlvbnMucGx1Z2luX2JyZWFkY3J1bWJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGFkZHMgZWRpdCB0b29sdGlwXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLnBvaW50ZXJPdmVyQW5kT3V0ICsgJyAnICsgdGhpcy50b3VjaFN0YXJ0LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIC8vIHJlcXVpcmVkIGZvciBib3RoLCBjbGljayBhbmQgdG91Y2hcbiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgcHJvcGFnYXRpb24gd29uJ3Qgd29yayB0byB0aGUgbmVzdGVkIHBsdWdpblxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbHRpcC5fZm9yY2VUb3VjaE9uY2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGF0Lm9wdGlvbnMucGx1Z2luX25hbWU7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGhhdC5vcHRpb25zLnBsdWdpbl9pZDtcblxuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlcklkID0gdGhhdC5fZ2V0SWQodGhhdC51aS5kcmFnaXRlbS5jbG9zZXN0KCcuY21zLWRyYWdhcmVhJykpO1xuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlciA9ICQoJy5jbXMtcGxhY2Vob2xkZXItJyArIHBsYWNlaG9sZGVySWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlaG9sZGVyLmxlbmd0aCAmJiBwbGFjZWhvbGRlci5kYXRhKCdzZXR0aW5ncycpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSBwbGFjZWhvbGRlci5kYXRhKCdzZXR0aW5ncycpLm5hbWUgKyAnOiAnICsgbmFtZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2x0aXAuZGlzcGxheVRvZ2dsZShlLnR5cGUgPT09ICdwb2ludGVyb3ZlcicgfHwgZS50eXBlID09PSAndG91Y2hzdGFydCcsIGUsIG5hbWUsIGlkKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhZGRzIGxpc3RlbmVyIGZvciBhbGwgcGx1Z2luIHVwZGF0ZXNcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKCdjbXMucGx1Z2lucy51cGRhdGUnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhhdC5tb3ZlUGx1Z2luKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYWRkcyBsaXN0ZW5lciBmb3IgY29weS9wYXN0ZSB1cGRhdGVzXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbignY21zLnBsdWdpbi51cGRhdGUnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKGUuZGVsZWdhdGVUYXJnZXQpO1xuICAgICAgICAgICAgICAgIHZhciBkcmFnaXRlbSA9ICQoJy5jbXMtZHJhZ2dhYmxlLScgKyBlbC5kYXRhKCdzZXR0aW5ncycpLnBsdWdpbl9pZCk7XG4gICAgICAgICAgICAgICAgdmFyIHBsYWNlaG9sZGVyX2lkID0gdGhhdC5fZ2V0SWQoXG4gICAgICAgICAgICAgICAgICAgIGRyYWdpdGVtLnBhcmVudHMoJy5jbXMtZHJhZ2dhYmxlcycpLmxhc3QoKS5wcmV2QWxsKCcuY21zLWRyYWdiYXInKS5maXJzdCgpXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIC8vIGlmIHBsYWNlaG9sZGVyX2lkIGlzIGVtcHR5LCBjYW5jZWxcbiAgICAgICAgICAgICAgICBpZiAoIXBsYWNlaG9sZGVyX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGVsLmRhdGEoJ3NldHRpbmdzJyk7XG4gICAgICAgICAgICAgICAgZGF0YS50YXJnZXQgPSBwbGFjZWhvbGRlcl9pZDtcbiAgICAgICAgICAgICAgICBkYXRhLnBhcmVudCA9IHRoYXQuX2dldElkKGRyYWdpdGVtLnBhcmVudCgpLmNsb3Nlc3QoJy5jbXMtZHJhZ2dhYmxlJykpO1xuICAgICAgICAgICAgICAgIGRhdGEubW92ZV9hX2NvcHkgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5tb3ZlUGx1Z2luKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGZpbGxpbmcgdXAgdWkgb2JqZWN0XG4gICAgICAgICAgICB0aGlzLnVpLmRyYWdnYWJsZSA9ICQoJy5jbXMtZHJhZ2dhYmxlLScgKyB0aGlzLm9wdGlvbnMucGx1Z2luX2lkKTtcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2l0ZW0gPSB0aGlzLnVpLmRyYWdnYWJsZS5maW5kKCc+IC5jbXMtZHJhZ2l0ZW0nKTtcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2dhYmxlcyA9IHRoaXMudWkuZHJhZ2dhYmxlLmZpbmQoJz4gLmNtcy1kcmFnZ2FibGVzJyk7XG4gICAgICAgICAgICB0aGlzLnVpLnN1Ym1lbnUgPSB0aGlzLnVpLmRyYWdpdGVtLmZpbmQoJy5jbXMtc3VibWVudScpO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnQgdG8gdGhlIHBsdWdpbiBtZW51XG4gICAgICAgICAgICB0aGlzLl9zZXRTZXR0aW5nc01lbnUodGhpcy51aS5zdWJtZW51KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyBmb3IgdGhlIFwiQWRkIHBsdWdpblwiIG1vZGFsXG4gICAgICAgICAgICB0aGlzLl9zZXRBZGRQbHVnaW5Nb2RhbCh0aGlzLnVpLmRyYWdpdGVtLmZpbmQoJy5jbXMtc3VibWVudS1hZGQnKSk7XG5cbiAgICAgICAgICAgIC8vIGNsaWNrYWJpbGl0eSBvZiBcIlBhc3RlXCIgbWVudSBpdGVtXG4gICAgICAgICAgICB0aGlzLl9jaGVja0lmUGFzdGVBbGxvd2VkKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgYmVoYXZpb3VycyBhbmQgdWkgZm9yIGdlbmVyaWNzLlxuICAgICAgICAgKiBHZW5lcmljcyBkbyBub3Qgc2hvdyB1cCBpbiBzdHJ1Y3R1cmUgYm9hcmQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldEdlbmVyaWNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXRHZW5lcmljOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIGFkZHMgZG91YmxlIGNsaWNrIHRvIGVkaXRcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuZG91YmxlQ2xpY2ssIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhhdC5lZGl0UGx1Z2luKHRoYXQub3B0aW9ucy51cmxzLmVkaXRfcGx1Z2luLCB0aGF0Lm9wdGlvbnMucGx1Z2luX25hbWUsIFtdKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhZGRzIGVkaXQgdG9vbHRpcFxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5wb2ludGVyT3ZlckFuZE91dCArICcgJyArIHRoaXMudG91Y2hTdGFydCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlICE9PSAndG91Y2hzdGFydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGF0Lm9wdGlvbnMucGx1Z2luX25hbWU7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGhhdC5vcHRpb25zLnBsdWdpbl9pZDtcbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2x0aXAuZGlzcGxheVRvZ2dsZShlLnR5cGUgPT09ICdwb2ludGVyb3ZlcicgfHwgZS50eXBlID09PSAndG91Y2hzdGFydCcsIGUsIG5hbWUsIGlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVja3MgaWYgcGFzdGUgaXMgYWxsb3dlZCBpbnRvIGN1cnJlbnQgcGx1Z2luL3BsYWNlaG9sZGVyIGJhc2VkXG4gICAgICAgICAqIG9uIHJlc3RyaWN0aW9ucyB3ZSBoYXZlLiBBbHNvIGRldGVybWluZXMgd2hpY2ggdG9vbHRpcCB0byBzaG93LlxuICAgICAgICAgKlxuICAgICAgICAgKiBXQVJOSU5HOiB0aGlzIHJlbGllcyBvbiBjbGlwYm9hcmQgcGx1Z2lucyBhbHdheXMgYmVpbmcgaW5zdGFudGlhdGVkXG4gICAgICAgICAqIGZpcnN0LCBzbyB0aGV5IGhhdmUgZGF0YSgnc2V0dGluZ3MnKSBieSB0aGUgdGltZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NoZWNrSWZQYXN0ZUFsbG93ZWRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIF9jaGVja0lmUGFzdGVBbGxvd2VkOiBmdW5jdGlvbiBfY2hlY2tJZlBhc3RlQWxsb3dlZCgpIHtcbiAgICAgICAgICAgIHZhciBwYXN0ZUJ1dHRvbiA9IHRoaXMudWkuZHJvcGRvd24uZmluZCgnW2RhdGEtcmVsPXBhc3RlXScpO1xuICAgICAgICAgICAgdmFyIHBhc3RlSXRlbSA9IHBhc3RlQnV0dG9uLnBhcmVudCgpO1xuICAgICAgICAgICAgaWYgKCFjbGlwYm9hcmRQbHVnaW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcGFzdGVJdGVtLmFkZENsYXNzKCdjbXMtc3VibWVudS1pdGVtLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgcGFzdGVJdGVtLmZpbmQoJy5jbXMtc3VibWVudS1pdGVtLXBhc3RlLXRvb2x0aXAtZW1wdHknKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnVpLmRyYWdnYWJsZSAmJiB0aGlzLnVpLmRyYWdnYWJsZS5oYXNDbGFzcygnY21zLWRyYWdnYWJsZS1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgcGFzdGVJdGVtLmFkZENsYXNzKCdjbXMtc3VibWVudS1pdGVtLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgcGFzdGVJdGVtLmZpbmQoJy5jbXMtc3VibWVudS1pdGVtLXBhc3RlLXRvb2x0aXAtZGlzYWJsZWQnKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBib3VuZHMgPSB0aGlzLm9wdGlvbnMucGx1Z2luX3Jlc3RyaWN0aW9uO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSBjbGlwYm9hcmRQbHVnaW4uZGF0YSgnc2V0dGluZ3MnKS5wbHVnaW5fdHlwZTtcbiAgICAgICAgICAgIHZhciBwYXJlbnRfYm91bmRzID0gJC5ncmVwKGNsaXBib2FyZFBsdWdpbi5kYXRhKCdzZXR0aW5ncycpLnBsdWdpbl9wYXJlbnRfcmVzdHJpY3Rpb24sIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIHdoZW4gUGxhY2Vob2xkZXJQbHVnaW4gaGFzIGEgcGFyZW50IHJlc3RyaWN0aW9uIG5hbWVkIFwiMFwiXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIgIT09ICcwJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRQbHVnaW5UeXBlID0gdGhpcy5vcHRpb25zLnBsdWdpbl90eXBlO1xuXG4gICAgICAgICAgICBpZiAoKGJvdW5kcy5sZW5ndGggJiYgJC5pbkFycmF5KHR5cGUsIGJvdW5kcykgPT09IC0xKSB8fFxuICAgICAgICAgICAgICAgIChwYXJlbnRfYm91bmRzLmxlbmd0aCAmJiAkLmluQXJyYXkoY3VycmVudFBsdWdpblR5cGUsIHBhcmVudF9ib3VuZHMpID09PSAtMSkpIHtcbiAgICAgICAgICAgICAgICBwYXN0ZUl0ZW0uYWRkQ2xhc3MoJ2Ntcy1zdWJtZW51LWl0ZW0tZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICBwYXN0ZUl0ZW0uZmluZCgnLmNtcy1zdWJtZW51LWl0ZW0tcGFzdGUtdG9vbHRpcC1yZXN0cmljdGVkJykuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FsbHMgYXBpIHRvIGNyZWF0ZSBhIHBsdWdpbiBhbmQgdGhlbiBwcm9jZWVkcyB0byBlZGl0IGl0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIGFkZFBsdWdpblxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSB0eXBlIG9mIHRoZSBwbHVnaW4sIGUuZyBcIkJvb3RzdHJhcDNDb2x1bW5DTVNQbHVnaW5cIlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBuYW1lIG9mIHRoZSBwbHVnaW4sIGUuZy4gXCJDb2x1bW5cIlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGFyZW50IGlkIG9mIGEgcGFyZW50IHBsdWdpblxuICAgICAgICAgKi9cbiAgICAgICAgYWRkUGx1Z2luOiBmdW5jdGlvbiAodHlwZSwgbmFtZSwgcGFyZW50KSB7XG4gICAgICAgICAgICAvLyBjYW5jZWwgcmVxdWVzdCBpZiBhbHJlYWR5IGluIHByb2dyZXNzXG4gICAgICAgICAgICBpZiAoQ01TLkFQSS5sb2NrZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBDTVMuQVBJLmxvY2tlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyX2lkOiB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXJfaWQsXG4gICAgICAgICAgICAgICAgcGx1Z2luX3R5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgcGx1Z2luX3BhcmVudDogcGFyZW50IHx8ICcnLFxuICAgICAgICAgICAgICAgIHBsdWdpbl9sYW5ndWFnZTogdGhpcy5vcHRpb25zLnBsdWdpbl9sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICBjc3JmbWlkZGxld2FyZXRva2VuOiB0aGlzLmNzcmZcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5vcHRpb25zLnVybHMuYWRkX3BsdWdpbixcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkubG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubmV3UGx1Z2luID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5lZGl0UGx1Z2luKGRhdGEudXJsLCBuYW1lLCBkYXRhLmJyZWFkY3J1bWIpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUikge1xuICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXNnID0gQ01TLmNvbmZpZy5sYW5nLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAvLyB0cmlnZ2VyIGVycm9yXG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBtc2cgKyBqcVhIUi5yZXNwb25zZVRleHQgfHwganFYSFIuc3RhdHVzICsgJyAnICsganFYSFIuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyB0aGUgbW9kYWwgZm9yIGVkaXRpbmcgYSBwbHVnaW4uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgZWRpdFBsdWdpblxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIGVkaXRpbmcgdXJsXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIHBsdWdpbiwgZS5nLiBcIkNvbHVtblwiXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0W119IGJyZWFkY3J1bWIgYXJyYXkgb2Ygb2JqZWN0cyByZXByZXNlbnRpbmcgYSBicmVhZGNydW1iLFxuICAgICAgICAgKiAgICAgZWFjaCBpdGVtIGlzIGB7IHRpdGxlOiAnc3RyaW5nJzogdXJsOiAnc3RyaW5nJyB9YFxuICAgICAgICAgKi9cbiAgICAgICAgZWRpdFBsdWdpbjogZnVuY3Rpb24gKHVybCwgbmFtZSwgYnJlYWRjcnVtYikge1xuICAgICAgICAgICAgLy8gdHJpZ2dlciBtb2RhbCB3aW5kb3dcbiAgICAgICAgICAgIHZhciBtb2RhbCA9IG5ldyBDTVMuTW9kYWwoe1xuICAgICAgICAgICAgICAgIG5ld1BsdWdpbjogdGhpcy5uZXdQbHVnaW4gfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgb25DbG9zZTogdGhpcy5vcHRpb25zLm9uQ2xvc2UgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVkaXJlY3RPbkNsb3NlOiB0aGlzLm9wdGlvbnMucmVkaXJlY3RPbkNsb3NlIHx8IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghdGhpcy5uZXdQbHVnaW4pIHtcbiAgICAgICAgICAgICAgICBtb2RhbC5vbignY21zLm1vZGFsLmxvYWRlZCcsIGZ1bmN0aW9uIHJlbW92ZVBsYWNlaG9sZGVyKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuY21zLWFkZC1wbHVnaW4tcGxhY2Vob2xkZXInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZGFsLm9uKCdjbXMubW9kYWwuY2xvc2VkJywgZnVuY3Rpb24gcmVtb3ZlUGxhY2Vob2xkZXIoKSB7XG4gICAgICAgICAgICAgICAgJCgnLmNtcy1hZGQtcGx1Z2luLXBsYWNlaG9sZGVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBuYW1lLFxuICAgICAgICAgICAgICAgIGJyZWFkY3J1bWJzOiBicmVhZGNydW1iLFxuICAgICAgICAgICAgICAgIHdpZHRoOiA4NTBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VkIGZvciBjb3B5aW5nIF9hbmRfIHBhc3RpbmcgYSBwbHVnaW4uIElmIGVpdGhlciBvZiBwYXJhbXNcbiAgICAgICAgICogaXMgcHJlc2VudCBtZXRob2QgYXNzdW1lcyB0aGF0IGl0J3MgXCJwYXN0ZVwiIGFuZCB3aWxsIG1ha2UgYSBjYWxsXG4gICAgICAgICAqIHRvIGFwaSB0byBpbnNlcnQgY3VycmVudCBwbHVnaW4gdG8gc3BlY2lmaWVkIGBvcHRpb25zLnRhcmdldF9wbHVnaW5faWRgXG4gICAgICAgICAqIG9yIGBvcHRpb25zLnRhcmdldF9wbGFjZWhvbGRlcl9pZGAuIENvcHlpbmcgYSBwbHVnaW4gYWxzbyBmaXJzdFxuICAgICAgICAgKiBjbGVhcnMgdGhlIGNsaXBib2FyZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBjb3B5UGx1Z2luXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz10aGlzLm9wdGlvbnNdXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzb3VyY2VfbGFuZ3VhZ2VcbiAgICAgICAgICovXG4gICAgICAgIGNvcHlQbHVnaW46IGZ1bmN0aW9uIChvcHRpb25zLCBzb3VyY2VfbGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgIC8vIGNhbmNlbCByZXF1ZXN0IGlmIGFscmVhZHkgaW4gcHJvZ3Jlc3NcbiAgICAgICAgICAgIGlmIChDTVMuQVBJLmxvY2tlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIENNUy5BUEkubG9ja2VkID0gdHJ1ZTtcblxuICAgICAgICAgICAgdmFyIG1vdmUgPSAob3B0aW9ucyB8fCBzb3VyY2VfbGFuZ3VhZ2UpID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBzZXQgY29ycmVjdCBvcHRpb25zXG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICBpZiAoc291cmNlX2xhbmd1YWdlKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy50YXJnZXQgPSBvcHRpb25zLnBsYWNlaG9sZGVyX2lkO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucGx1Z2luX2lkID0gJyc7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wYXJlbnQgPSAnJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc291cmNlX2xhbmd1YWdlID0gb3B0aW9ucy5wbHVnaW5fbGFuZ3VhZ2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHNvdXJjZV9wbGFjZWhvbGRlcl9pZDogb3B0aW9ucy5wbGFjZWhvbGRlcl9pZCxcbiAgICAgICAgICAgICAgICBzb3VyY2VfcGx1Z2luX2lkOiBvcHRpb25zLnBsdWdpbl9pZCB8fCAnJyxcbiAgICAgICAgICAgICAgICBzb3VyY2VfbGFuZ3VhZ2U6IHNvdXJjZV9sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICB0YXJnZXRfcGx1Z2luX2lkOiBvcHRpb25zLnBhcmVudCB8fCAnJyxcbiAgICAgICAgICAgICAgICB0YXJnZXRfcGxhY2Vob2xkZXJfaWQ6IG9wdGlvbnMudGFyZ2V0IHx8IENNUy5jb25maWcuY2xpcGJvYXJkLmlkLFxuICAgICAgICAgICAgICAgIHRhcmdldF9sYW5ndWFnZTogb3B0aW9ucy5wYWdlX2xhbmd1YWdlIHx8IHNvdXJjZV9sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICBjc3JmbWlkZGxld2FyZXRva2VuOiB0aGlzLmNzcmZcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBvcHRpb25zLnVybHMuY29weV9wbHVnaW4sXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBDTVMuY29uZmlnLmxhbmcuc3VjY2Vzc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVsb2FkXG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkubG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtc2cgPSBDTVMuY29uZmlnLmxhbmcuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1zZyArIGpxWEhSLnJlc3BvbnNlVGV4dCB8fCBqcVhIUi5zdGF0dXMgKyAnICcgKyBqcVhIUi5zdGF0dXNUZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKG1vdmUpIHtcbiAgICAgICAgICAgICAgICAkLmFqYXgocmVxdWVzdCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGVuc3VyZSBjbGlwYm9hcmQgaXMgY2xlYW5lZFxuICAgICAgICAgICAgICAgIENNUy5BUEkuQ2xpcGJvYXJkLmNsZWFyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFc3NlbnRpYWxseSBjbGVhcnMgY2xpcGJvYXJkIGFuZCBtb3ZlcyBwbHVnaW4gdG8gYSBjbGlwYm9hcmRcbiAgICAgICAgICogcGxhY2hvbGRlciB0aHJvdWdoIGBtb3ZlUGx1Z2luYC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBjdXRQbHVnaW5cbiAgICAgICAgICovXG4gICAgICAgIGN1dFBsdWdpbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gaWYgY3V0IGlzIG9uY2UgdHJpZ2dlcmVkLCBwcmV2ZW50IGFkZGl0aW9uYWwgYWN0aW9uc1xuICAgICAgICAgICAgaWYgKENNUy5BUEkubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcl9pZDogQ01TLmNvbmZpZy5jbGlwYm9hcmQuaWQsXG4gICAgICAgICAgICAgICAgcGx1Z2luX2lkOiB0aGlzLm9wdGlvbnMucGx1Z2luX2lkLFxuICAgICAgICAgICAgICAgIHBsdWdpbl9wYXJlbnQ6ICcnLFxuICAgICAgICAgICAgICAgIHBsdWdpbl9sYW5ndWFnZTogdGhpcy5vcHRpb25zLnBhZ2VfbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgcGx1Z2luX29yZGVyOiBbdGhpcy5vcHRpb25zLnBsdWdpbl9pZF0sXG4gICAgICAgICAgICAgICAgY3NyZm1pZGRsZXdhcmV0b2tlbjogdGhpcy5jc3JmXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBlbnN1cmUgY2xpcGJvYXJkIGlzIGNsZWFuZWRcbiAgICAgICAgICAgIENNUy5BUEkuQ2xpcGJvYXJkLmNsZWFyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBjYW5jZWwgcmVxdWVzdCBpZiBhbHJlYWR5IGluIHByb2dyZXNzXG4gICAgICAgICAgICAgICAgaWYgKENNUy5BUEkubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgLy8gbW92ZSBwbHVnaW5cbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMubW92ZV9wbHVnaW4sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogQ01TLmNvbmZpZy5sYW5nLnN1Y2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgcmVzcG9uc2UgaXMgcmVsb2FkXG4gICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLkhlbHBlcnMucmVsb2FkQnJvd3NlcigpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IENNUy5jb25maWcubGFuZy5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbXNnICsganFYSFIucmVzcG9uc2VUZXh0IHx8IGpxWEhSLnN0YXR1cyArICcgJyArIGpxWEhSLnN0YXR1c1RleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWV0aG9kIGlzIGNhbGxlZCB3aGVuIHlvdSBjbGljayBvbiB0aGUgcGFzdGUgYnV0dG9uIG9uIHRoZSBwbHVnaW4uXG4gICAgICAgICAqIFVzZXMgZXhpc3Rpbmcgc29sdXRpb24gb2YgYGNvcHlQbHVnaW4ob3B0aW9ucylgXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgcGFzdGVQbHVnaW5cbiAgICAgICAgICovXG4gICAgICAgIHBhc3RlUGx1Z2luOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjbGlwYm9hcmREcmFnZ2FibGUuYXBwZW5kVG8odGhpcy51aS5kcmFnZ2FibGVzKTtcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2dhYmxlcy50cmlnZ2VyKCdjbXMudXBkYXRlJyk7XG4gICAgICAgICAgICBjbGlwYm9hcmRQbHVnaW4udHJpZ2dlcignY21zLnBsdWdpbi51cGRhdGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTW92ZXMgcGx1Z2luIGJ5IHF1ZXJ5aW5nIHRoZSBBUEkgYW5kIHRoZW4gdXBkYXRlcyBzb21lIFVJIHBhcnRzXG4gICAgICAgICAqIHRvIHJlZmxlY3QgdGhhdCB0aGUgcGFnZSBoYXMgY2hhbmdlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBtb3ZlUGx1Z2luXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz10aGlzLm9wdGlvbnNdXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5wbGFjZWhvbGRlcl9pZF1cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLnBsdWdpbl9pZF1cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLnBsdWdpbl9wYXJlbnRdXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5wbHVnaW5fbGFuZ3VhZ2VdXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMubW92ZV9hX2NvcHldXG4gICAgICAgICAqL1xuICAgICAgICBtb3ZlUGx1Z2luOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgLy8gY2FuY2VsIHJlcXVlc3QgaWYgYWxyZWFkeSBpbiBwcm9ncmVzc1xuICAgICAgICAgICAgaWYgKENNUy5BUEkubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAvLyBzZXQgY29ycmVjdCBvcHRpb25zXG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB0aGlzLm9wdGlvbnM7XG5cbiAgICAgICAgICAgIHZhciBwbHVnaW4gPSAkKCcuY21zLXBsdWdpbi0nICsgb3B0aW9ucy5wbHVnaW5faWQpO1xuICAgICAgICAgICAgdmFyIGRyYWdpdGVtID0gJCgnLmNtcy1kcmFnZ2FibGUtJyArIG9wdGlvbnMucGx1Z2luX2lkKTtcblxuICAgICAgICAgICAgLy8gU0VUVElORyBQT1NJVElPTlxuICAgICAgICAgICAgdGhpcy5fc2V0UG9zaXRpb24ob3B0aW9ucy5wbHVnaW5faWQsIHBsdWdpbiwgZHJhZ2l0ZW0pO1xuXG4gICAgICAgICAgICAvLyBTQVZJTkcgUE9TSVRJT05cbiAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlcl9pZCA9IHRoaXMuX2dldElkKFxuICAgICAgICAgICAgICAgIGRyYWdpdGVtLnBhcmVudHMoJy5jbXMtZHJhZ2dhYmxlcycpLmxhc3QoKS5wcmV2QWxsKCcuY21zLWRyYWdiYXInKS5maXJzdCgpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdmFyIHBsdWdpbl9wYXJlbnQgPSB0aGlzLl9nZXRJZChkcmFnaXRlbS5wYXJlbnQoKS5jbG9zZXN0KCcuY21zLWRyYWdnYWJsZScpKTtcbiAgICAgICAgICAgIHZhciBwbHVnaW5fb3JkZXIgPSB0aGlzLl9nZXRJZHMoZHJhZ2l0ZW0uc2libGluZ3MoJy5jbXMtZHJhZ2dhYmxlJykuYW5kU2VsZigpKTtcblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubW92ZV9hX2NvcHkpIHtcbiAgICAgICAgICAgICAgICBwbHVnaW5fb3JkZXIgPSBwbHVnaW5fb3JkZXIubWFwKGZ1bmN0aW9uIChwbHVnaW5JZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIGNvcnJlY3Qgd2F5IHdvdWxkIGJlIHRvIGNoZWNrIGlmIGl0J3MgYWN0dWFsbHkgYVxuICAgICAgICAgICAgICAgICAgICAvLyBwYXN0ZWQgcGx1Z2luIGFuZCBvbmx5IHRoZW4gcmVwbGFjZSB0aGUgaWQgd2l0aCBjb3B5IHRva2VuXG4gICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBpZiB3ZSB3b3VsZCBjb3B5IGZyb20gdGhlIHNhbWUgcGxhY2Vob2xkZXIgd2Ugd291bGQgZ2V0XG4gICAgICAgICAgICAgICAgICAgIC8vIHR3byBjb3B5IHRva2VucyBpbnN0ZWFkIG9mIG9yaWdpbmFsIGFuZCBhIGNvcHkuXG4gICAgICAgICAgICAgICAgICAgIC8vIGl0J3Mgb2sgc28gZmFyLCBhcyBsb25nIGFzIHdlIGNvcHkgb25seSBmcm9tIGNsaXBib2FyZFxuICAgICAgICAgICAgICAgICAgICBpZiAocGx1Z2luSWQgPT09IG9wdGlvbnMucGx1Z2luX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5JZCA9ICdfX0NPUFlfXyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsdWdpbklkO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjYW5jZWwgaGVyZSBpZiB3ZSBoYXZlIG5vIHBsYWNlaG9sZGVyIGlkXG4gICAgICAgICAgICBpZiAocGxhY2Vob2xkZXJfaWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBnYXRoZXIgdGhlIGRhdGEgZm9yIGFqYXggcmVxdWVzdFxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJfaWQ6IHBsYWNlaG9sZGVyX2lkLFxuICAgICAgICAgICAgICAgIHBsdWdpbl9pZDogb3B0aW9ucy5wbHVnaW5faWQsXG4gICAgICAgICAgICAgICAgcGx1Z2luX3BhcmVudDogcGx1Z2luX3BhcmVudCB8fCAnJyxcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGEgaGFjazogd2hlbiBtb3ZpbmcgdG8gZGlmZmVyZW50IGxhbmd1YWdlcyB1c2UgdGhlIGdsb2JhbCBsYW5ndWFnZVxuICAgICAgICAgICAgICAgIHBsdWdpbl9sYW5ndWFnZTogb3B0aW9ucy5wYWdlX2xhbmd1YWdlLFxuICAgICAgICAgICAgICAgIHBsdWdpbl9vcmRlcjogcGx1Z2luX29yZGVyLFxuICAgICAgICAgICAgICAgIGNzcmZtaWRkbGV3YXJldG9rZW46IHRoaXMuY3NyZixcbiAgICAgICAgICAgICAgICBtb3ZlX2FfY29weTogb3B0aW9ucy5tb3ZlX2FfY29weVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBvcHRpb25zLnVybHMubW92ZV9wbHVnaW4sXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgcmVzcG9uc2UgaXMgcmVsb2FkXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZWxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgbmV3IHVybCBzZXR0aW5ncyB3aGVuIG1vdmluZyAjNDgwM1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UudXJscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fc2V0U2V0dGluZ3Mob3B0aW9ucywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybHM6IHJlc3BvbnNlLnVybHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZW5hYmxlIGFjdGlvbnMgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBzaG93IG9ubHkgaWYgKHJlc3BvbnNlLnN0YXR1cylcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc2hvd1N1Y2Nlc3MoZHJhZ2l0ZW0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUikge1xuICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXNnID0gQ01TLmNvbmZpZy5sYW5nLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAvLyB0cmlnZ2VyIGVycm9yXG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBtc2cgKyBqcVhIUi5yZXNwb25zZVRleHQgfHwganFYSFIuc3RhdHVzICsgJyAnICsganFYSFIuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBzaG93IHB1Ymxpc2ggLyBzYXZlIGJ1dHRvbnNcbiAgICAgICAgICAgIHRoaXMudWkucHVibGlzaFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnY21zLWJ0bi1wdWJsaXNoLWFjdGl2ZScpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdjbXMtYnRuLWRpc2FibGVkJylcbiAgICAgICAgICAgICAgICAucGFyZW50KCkuc2hvdygpO1xuICAgICAgICAgICAgdGhpcy51aS53aW5kb3cudHJpZ2dlcigncmVzaXplJyk7XG5cbiAgICAgICAgICAgIC8vIGVuYWJsZSByZXZlcnQgdG8gbGl2ZVxuICAgICAgICAgICAgdGhpcy51aS5yZXZlcnQucmVtb3ZlQ2xhc3MoJ2Ntcy10b29sYmFyLWl0ZW0tbmF2aWdhdGlvbi1kaXNhYmxlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGFuZ2VzIHRoZSBzZXR0aW5ncyBhdHRyaWJ1dGVzIG9uIGFuIGluaXRpYWxpc2VkIHBsdWdpbi5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0U2V0dGluZ3NcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9sZFNldHRpbmdzIGN1cnJlbnQgc2V0dGluZ3NcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG5ld1NldHRpbmdzIG5ldyBzZXR0aW5ncyB0byBiZSBhcHBsaWVkXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2V0U2V0dGluZ3M6IGZ1bmN0aW9uIF9zZXRTZXR0aW5ncyhvbGRTZXR0aW5ncywgbmV3U2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBvbGRTZXR0aW5ncywgbmV3U2V0dGluZ3MpO1xuICAgICAgICAgICAgdmFyIHBsdWdpbiA9ICQoJy5jbXMtcGx1Z2luLScgKyBzZXR0aW5ncy5wbHVnaW5faWQpO1xuXG4gICAgICAgICAgICAvLyBzZXQgbmV3IHNldHRpbmcgb24gaW5zdGFuY2UgYW5kIHBsdWdpbiBkYXRhXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBzZXR0aW5ncztcbiAgICAgICAgICAgIHBsdWdpbi5kYXRhKCdzZXR0aW5ncycsIHNldHRpbmdzKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT3BlbnMgYSBtb2RhbCB0byBkZWxldGUgYSBwbHVnaW4uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgZGVsZXRlUGx1Z2luXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgYWRtaW4gdXJsIGZvciBkZWxldGluZyBhIHBhZ2VcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgcGx1Z2luIG5hbWUsIGUuZy4gXCJDb2x1bW5cIlxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBicmVhZGNydW1iIGFycmF5IG9mIG9iamVjdHMgcmVwcmVzZW50aW5nIGEgYnJlYWRjcnVtYixcbiAgICAgICAgICogICAgIGVhY2ggaXRlbSBpcyBgeyB0aXRsZTogJ3N0cmluZyc6IHVybDogJ3N0cmluZycgfWBcbiAgICAgICAgICovXG4gICAgICAgIGRlbGV0ZVBsdWdpbjogZnVuY3Rpb24gKHVybCwgbmFtZSwgYnJlYWRjcnVtYikge1xuICAgICAgICAgICAgLy8gdHJpZ2dlciBtb2RhbCB3aW5kb3dcbiAgICAgICAgICAgIHZhciBtb2RhbCA9IG5ldyBDTVMuTW9kYWwoe1xuICAgICAgICAgICAgICAgIG5ld1BsdWdpbjogdGhpcy5uZXdQbHVnaW4gfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgb25DbG9zZTogdGhpcy5vcHRpb25zLm9uQ2xvc2UgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVkaXJlY3RPbkNsb3NlOiB0aGlzLm9wdGlvbnMucmVkaXJlY3RPbkNsb3NlIHx8IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vZGFsLm9uKCdjbXMubW9kYWwubG9hZGVkJywgZnVuY3Rpb24gcmVtb3ZlUGxhY2Vob2xkZXIoKSB7XG4gICAgICAgICAgICAgICAgJCgnLmNtcy1hZGQtcGx1Z2luLXBsYWNlaG9sZGVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBuYW1lLFxuICAgICAgICAgICAgICAgIGJyZWFkY3J1bWJzOiBicmVhZGNydW1iXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTW92ZXMgdGhlIHBsdWdpbiBhY2NvcmRpbmcgdG8gdGhlIHBsYWNlIGl0IHNob3VsZCBoYXZlIGluIGNvbnRlbnQgbW9kZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0UG9zaXRpb25cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlkXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBwbHVnaW4gdGhlIGAuY21zLXBsdWdpbmAgZWxlbWVudFxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZHJhZ2l0ZW0gdGhlIGAuY21zLWRyYWdnYWJsZWAgb2YgdGhlIHBsdWdpblxuICAgICAgICAgKi9cbiAgICAgICAgX3NldFBvc2l0aW9uOiBmdW5jdGlvbiAoaWQsIHBsdWdpbiwgZHJhZ2l0ZW0pIHtcbiAgICAgICAgICAgIC8vIGFmdGVyIHdlIGluc2VydCB0aGUgcGx1Z2luIG9udG8gaXRzIG5ldyBwbGFjZSwgd2UgbmVlZCB0byBmaWd1cmUgb3V0IHdoZXJlIHRvIHBvc2l0aW9uIGl0XG4gICAgICAgICAgICB2YXIgcHJldkl0ZW0gPSBkcmFnaXRlbS5wcmV2KCcuY21zLWRyYWdnYWJsZScpO1xuICAgICAgICAgICAgdmFyIG5leHRJdGVtID0gZHJhZ2l0ZW0ubmV4dCgnLmNtcy1kcmFnZ2FibGUnKTtcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBkcmFnaXRlbS5wYXJlbnQoKS5jbG9zZXN0KCcuY21zLWRyYWdnYWJsZScpO1xuICAgICAgICAgICAgdmFyIGNoaWxkID0gJCgnLmNtcy1wbHVnaW4tJyArIHRoaXMuX2dldElkKHBhcmVudCkpO1xuICAgICAgICAgICAgdmFyIHBsYWNlaG9sZGVyID0gZHJhZ2l0ZW0uY2xvc2VzdCgnLmNtcy1kcmFnYXJlYScpO1xuXG4gICAgICAgICAgICAvLyBkZXRlcm1pbmUgaWYgdGhlcmUgYXJlIG90aGVyIHBsdWdpbnMgd2l0aGluIHRoZSBzYW1lIGxldmVsLCB0aGlzIG1ha2VzIHRoZSBtb3ZlIGVhc2llclxuICAgICAgICAgICAgaWYgKHByZXZJdGVtLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHBsdWdpbi5pbnNlcnRBZnRlcigkKCcuY21zLXBsdWdpbi0nICsgdGhpcy5fZ2V0SWQocHJldkl0ZW0pKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5leHRJdGVtLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHBsdWdpbi5pbnNlcnRCZWZvcmUoJCgnLmNtcy1wbHVnaW4tJyArIHRoaXMuX2dldElkKG5leHRJdGVtKSkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJlbnQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgd2UgY2FuJ3QgZmluZCBhIHBsdWdpbiBvbiB0aGUgc2FtZSBsZXZlbCwgd2UgbmVlZCB0byB0cmF2ZWwgaGlnaGVyXG4gICAgICAgICAgICAgICAgLy8gZm9yIHRoaXMgd2UgbmVlZCB0byBmaW5kIHRoZSBkZWVwZXN0IGNoaWxkXG4gICAgICAgICAgICAgICAgd2hpbGUgKGNoaWxkLmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gY2hpbGQuY2hpbGRyZW4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kKHBsdWdpbik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBsYWNlaG9sZGVyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIC8vIHdlIGFsc28gbmVlZCB0byBjb3ZlciB0aGUgY2FzZSBpZiB3ZSBtb3ZlIHRoZSBwbHVnaW4gdG8gYW4gZW1wdHkgcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgICBwbHVnaW4uaW5zZXJ0QWZ0ZXIoJCgnLmNtcy1wbGFjZWhvbGRlci0nICsgdGhpcy5fZ2V0SWQocGxhY2Vob2xkZXIpKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRpZCBub3QgZm91bmQgYSBtYXRjaCwgcmVsb2FkXG4gICAgICAgICAgICAgICAgQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FsbGVkIGFmdGVyIHBsdWdpbiBpcyBhZGRlZCB0aHJvdWdoIGFqYXguXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgZWRpdFBsdWdpblBvc3RBamF4XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b29sYmFyIENNUy5BUEkuVG9vbGJhciBpbnN0YW5jZSAobm90IHVzZWQpXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSByZXNwb25zZSBmcm9tIHNlcnZlclxuICAgICAgICAgKi9cbiAgICAgICAgZWRpdFBsdWdpblBvc3RBamF4OiBmdW5jdGlvbiAodG9vbGJhciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdFBsdWdpbihyZXNwb25zZS51cmwsIHRoaXMub3B0aW9ucy5wbHVnaW5fbmFtZSwgcmVzcG9uc2UuYnJlYWRjcnVtYik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIF9zZXRTZXR0aW5nc01lbnUgc2V0cyB1cCBldmVudCBoYW5kbGVycyBmb3Igc2V0dGluZ3MgbWVudS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0U2V0dGluZ3NNZW51XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBuYXZcbiAgICAgICAgICovXG4gICAgICAgIF9zZXRTZXR0aW5nc01lbnU6IGZ1bmN0aW9uIF9zZXRTZXR0aW5nc01lbnUobmF2KSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLnVpLmRyb3Bkb3duID0gbmF2LnNpYmxpbmdzKCcuY21zLXN1Ym1lbnUtZHJvcGRvd24tc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIHZhciBkcm9wZG93biA9IHRoaXMudWkuZHJvcGRvd247XG5cbiAgICAgICAgICAgIG5hdi5vbih0aGlzLnBvaW50ZXJVcCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlciA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKHRyaWdnZXIuaGFzQ2xhc3MoJ2Ntcy1idG4tYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgQ01TLlBsdWdpbi5faGlkZVNldHRpbmdzTWVudSh0cmlnZ2VyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBDTVMuUGx1Z2luLl9oaWRlU2V0dGluZ3NNZW51KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3Nob3dTZXR0aW5nc01lbnUodHJpZ2dlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkub24odGhpcy50b3VjaFN0YXJ0LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIC8vIHJlcXVpcmVkIG9uIHNvbWUgdG91Y2ggZGV2aWNlcyBzb1xuICAgICAgICAgICAgICAgIC8vIHVpIHRvdWNoIHB1bmNoIGlzIG5vdCB0cmlnZ2VyaW5nIG1vdXNlbW92ZVxuICAgICAgICAgICAgICAgIC8vIHdoaWNoIGluIHR1cm4gcmVzdWx0cyBpbiBwZXAgdHJpZ2dlcmluZyBwb2ludGVyY2FuY2VsXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkcm9wZG93bi5vbih0aGlzLm1vdXNlRXZlbnRzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KS5vbih0aGlzLnRvdWNoU3RhcnQsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVxdWlyZWQgZm9yIHNjcm9sbGluZyBvbiBtb2JpbGVcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoYXQuX3NldHVwQWN0aW9ucyhuYXYpO1xuICAgICAgICAgICAgLy8gcHJldmVudCBwcm9wYWdhdGlvblxuICAgICAgICAgICAgbmF2Lm9uKFt0aGlzLnBvaW50ZXJVcCwgdGhpcy5wb2ludGVyRG93biwgdGhpcy5jbGljaywgdGhpcy5kb3VibGVDbGlja10uam9pbignICcpLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbmF2LnNpYmxpbmdzKCcuY21zLXF1aWNrc2VhcmNoLCAuY21zLXN1Ym1lbnUtZHJvcGRvd24tc2V0dGluZ3MnKVxuICAgICAgICAgICAgICAgIC5vbihbdGhpcy5wb2ludGVyVXAsIHRoaXMuY2xpY2ssIHRoaXMuZG91YmxlQ2xpY2tdLmpvaW4oJyAnKSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNpbXBsaXN0aWMgaW1wbGVtZW50YXRpb24sIG9ubHkgc2Nyb2xscyBkb3duLCBvbmx5IHdvcmtzIGluIHN0cnVjdHVyZW1vZGVcbiAgICAgICAgICogYW5kIGhpZ2hseSBkZXBlbmRzIG9uIHRoZSBzdHlsZXMgb2YgdGhlIHN0cnVjdHVyZWJvYXJkIHRvIHdvcmsgY29ycmVjdGx5XG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Njcm9sbFRvRWxlbWVudFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWwgZWxlbWVudCB0byBzY3JvbGwgdG9cbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRzXVxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW29wdHMuZHVyYXRpb249MjAwXSB0aW1lIHRvIHNjcm9sbFxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW29wdHMub2Zmc2V0PTUwXSBkaXN0YW5jZSBpbiBweCB0byB0aGUgYm90dG9tIG9mIHRoZSBzY3JlZW5cbiAgICAgICAgICovXG4gICAgICAgIF9zY3JvbGxUb0VsZW1lbnQ6IGZ1bmN0aW9uIF9zY3JvbGxUb0VsZW1lbnQoZWwsIG9wdHMpIHtcbiAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IG9wdHMgJiYgb3B0cy5kdXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gb3B0cy5kdXJhdGlvbiA6IDIwMDtcbiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBvcHRzICYmIG9wdHMub2Zmc2V0ICE9PSB1bmRlZmluZWQgPyBvcHRzLm9mZnNldCA6IDUwO1xuICAgICAgICAgICAgdmFyIHNjcm9sbGFibGUgPSBlbC5vZmZzZXRQYXJlbnQoKTtcbiAgICAgICAgICAgIHZhciB3aW4gPSAkKHdpbmRvdyk7XG4gICAgICAgICAgICB2YXIgc2Nyb2xsSGVpZ2h0ID0gd2luLmhlaWdodCgpO1xuICAgICAgICAgICAgdmFyIHNjcm9sbFRvcCA9IHNjcm9sbGFibGUuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICB2YXIgZWxQb3NpdGlvbiA9IGVsLnBvc2l0aW9uKCkudG9wO1xuICAgICAgICAgICAgdmFyIGVsSGVpZ2h0ID0gZWwuaGVpZ2h0KCk7XG4gICAgICAgICAgICB2YXIgaXNJblZpZXdwb3J0ID0gKGVsUG9zaXRpb24gKyBlbEhlaWdodCArIG9mZnNldCA8PSBzY3JvbGxIZWlnaHQpO1xuXG4gICAgICAgICAgICBpZiAoIWlzSW5WaWV3cG9ydCkge1xuICAgICAgICAgICAgICAgIHNjcm9sbGFibGUuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogZWxQb3NpdGlvbiArIG9mZnNldCArIGVsSGVpZ2h0ICsgc2Nyb2xsVG9wIC0gc2Nyb2xsSGVpZ2h0XG4gICAgICAgICAgICAgICAgfSwgZHVyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyBhIG1vZGFsIHdpdGggdHJhdmVyc2FibGUgcGx1Z2lucyBsaXN0LCBhZGRzIGEgcGxhY2Vob2xkZXIgdG8gd2hlcmVcbiAgICAgICAgICogdGhlIHBsdWdpbiB3aWxsIGJlIGFkZGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXRBZGRQbHVnaW5Nb2RhbFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gbmF2IG1vZGFsIHRyaWdnZXIgZWxlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgX3NldEFkZFBsdWdpbk1vZGFsOiBmdW5jdGlvbiBfc2V0QWRkUGx1Z2luTW9kYWwobmF2KSB7XG4gICAgICAgICAgICBpZiAobmF2Lmhhc0NsYXNzKCdjbXMtYnRuLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSAkKFxuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY21zLWFkZC1wbHVnaW4tcGxhY2Vob2xkZXJcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgQ01TLmNvbmZpZy5sYW5nLmFkZFBsdWdpblBsYWNlaG9sZGVyICtcbiAgICAgICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHZhciBtb2RhbCA9IG5ldyBDTVMuTW9kYWwoe1xuICAgICAgICAgICAgICAgIG1pbldpZHRoOiA0MDAsXG4gICAgICAgICAgICAgICAgbWluSGVpZ2h0OiA0MDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGRyYWdJdGVtID0gbmF2LmNsb3Nlc3QoJy5jbXMtZHJhZ2l0ZW0nKTtcbiAgICAgICAgICAgIHZhciBpc1BsYWNlaG9sZGVyID0gIUJvb2xlYW4oZHJhZ0l0ZW0ubGVuZ3RoKTtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbkxpc3Q7XG4gICAgICAgICAgICB2YXIgaXNUb3VjaGluZztcblxuICAgICAgICAgICAgaWYgKGlzUGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbkxpc3QgPSBuYXYuY2xvc2VzdCgnLmNtcy1kcmFnYXJlYScpLmZpbmQoJz4gLmNtcy1kcmFnZ2FibGVzJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuTGlzdCA9IG5hdi5jbG9zZXN0KCcuY21zLWRyYWdnYWJsZScpLmZpbmQoJz4gLmNtcy1kcmFnZ2FibGVzJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1vZGFsLm9uKCdjbXMubW9kYWwubG9hZGVkJywgJC5wcm94eSh0aGF0Ll9zZXR1cEtleWJvYXJkVHJhdmVyc2luZywgdGhhdCkpO1xuICAgICAgICAgICAgbW9kYWwub24oJ2Ntcy5tb2RhbC5sb2FkZWQnLCBmdW5jdGlvbiBhZGRQbGFjZWhvbGRlcigpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRyZW5MaXN0Lmhhc0NsYXNzKCdjbXMtaGlkZGVuJykgJiYgIWlzUGxhY2Vob2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fdG9nZ2xlQ29sbGFwc2FibGUoZHJhZ0l0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkKCcuY21zLWFkZC1wbHVnaW4tcGxhY2Vob2xkZXInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci5hcHBlbmRUbyhjaGlsZHJlbkxpc3QpO1xuICAgICAgICAgICAgICAgIHRoYXQuX3Njcm9sbFRvRWxlbWVudChwbGFjZWhvbGRlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vZGFsLm9uKCdjbXMubW9kYWwuY2xvc2VkJywgZnVuY3Rpb24gcmVtb3ZlUGxhY2Vob2xkZXIoKSB7XG4gICAgICAgICAgICAgICAgJCgnLmNtcy1hZGQtcGx1Z2luLXBsYWNlaG9sZGVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vZGFsLm9uKCdjbXMubW9kYWwuc2hvd24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRyb3Bkb3duID0gJCgnLmNtcy1tb2RhbC1tYXJrdXAgLmNtcy1wbHVnaW4tcGlja2VyJyk7XG4gICAgICAgICAgICAgICAgaWYgKCFpc1RvdWNoaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgZm9jdXMgdGhlIGZpZWxkIGlmIHVzaW5nIG1vdXNlXG4gICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBrZXlib2FyZCBwb3BzIHVwXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLmZpbmQoJ2lucHV0JykudHJpZ2dlcignZm9jdXMnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXNUb3VjaGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgcGx1Z2lucyA9IG5hdi5zaWJsaW5ncygnLmNtcy1wbHVnaW4tcGlja2VyJyk7XG5cbiAgICAgICAgICAgIHRoYXQuX3NldHVwUXVpY2tTZWFyY2gocGx1Z2lucyk7XG5cbiAgICAgICAgICAgIG5hdi5vbih0aGlzLnRvdWNoU3RhcnQsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgaXNUb3VjaGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gcmVxdWlyZWQgb24gc29tZSB0b3VjaCBkZXZpY2VzIHNvXG4gICAgICAgICAgICAgICAgLy8gdWkgdG91Y2ggcHVuY2ggaXMgbm90IHRyaWdnZXJpbmcgbW91c2Vtb3ZlXG4gICAgICAgICAgICAgICAgLy8gd2hpY2ggaW4gdHVybiByZXN1bHRzIGluIHBlcCB0cmlnZ2VyaW5nIHBvaW50ZXJjYW5jZWxcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfSkub24odGhpcy5wb2ludGVyVXAsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICBDTVMuUGx1Z2luLl9oaWRlU2V0dGluZ3NNZW51KCk7XG5cbiAgICAgICAgICAgICAgICAvLyBzaW5jZSB3ZSBkb24ndCBrbm93IGV4YWN0IHBsdWdpbiBwYXJlbnQgKGJlY2F1c2UgZHJhZ25kcm9wKVxuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8ga25vdyB0aGUgcGFyZW50IGlkIGJ5IHRoZSB0aW1lIHdlIG9wZW4gXCJhZGQgcGx1Z2luXCIgZGlhbG9nXG4gICAgICAgICAgICAgICAgdmFyIHBsdWdpbnNDb3B5ID0gcGx1Z2lucy5jbG9uZSh0cnVlLCB0cnVlKS5kYXRhKFxuICAgICAgICAgICAgICAgICAgICAncGFyZW50SWQnLCB0aGF0Ll9nZXRJZChuYXYuY2xvc2VzdCgnLmNtcy1kcmFnZ2FibGUnKSlcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGF0Lm9wdGlvbnMuYWRkUGx1Z2luSGVscFRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBodG1sOiBwbHVnaW5zQ29weSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDUzMCxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBwcmV2ZW50IHByb3BhZ2F0aW9uXG4gICAgICAgICAgICBuYXYub24oW3RoaXMucG9pbnRlclVwLCB0aGlzLnBvaW50ZXJEb3duLCB0aGlzLmNsaWNrLCB0aGlzLmRvdWJsZUNsaWNrXS5qb2luKCcgJyksIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBuYXYuc2libGluZ3MoJy5jbXMtcXVpY2tzZWFyY2gsIC5jbXMtc3VibWVudS1kcm9wZG93bicpXG4gICAgICAgICAgICAgICAgLm9uKFt0aGlzLnBvaW50ZXJVcCwgdGhpcy5jbGljaywgdGhpcy5kb3VibGVDbGlja10uam9pbignICcpLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyB1cCBldmVudCBoYW5kbGVycyBmb3IgcXVpY2tzZWFyY2hpbmcgaW4gdGhlIHBsdWdpbiBwaWNrZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwUXVpY2tTZWFyY2hcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IHBsdWdpbnMgcGx1Z2lucyBwaWNrZXIgZWxlbWVudFxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwUXVpY2tTZWFyY2g6IGZ1bmN0aW9uIF9zZXR1cFF1aWNrU2VhcmNoKHBsdWdpbnMpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IHBsdWdpbnMuZmluZCgnPiAuY21zLXF1aWNrc2VhcmNoJykuZmluZCgnaW5wdXQnKTtcblxuICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBDTVMuQVBJLkhlbHBlcnMuZGVib3VuY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgICAgLy8gaGF2ZSB0byBhbHdheXMgZmluZCB0aGUgcGx1Z2luc1BpY2tlciBpbiB0aGUgaGFuZGxlclxuICAgICAgICAgICAgICAgIC8vIGJlY2F1c2Ugb2YgaG93IHdlIG1vdmUgdGhpbmdzIGludG8vb3V0IG9mIHRoZSBtb2RhbFxuICAgICAgICAgICAgICAgIHZhciBwbHVnaW5zUGlja2VyID0gaW5wdXQuY2xvc2VzdCgnLmNtcy1wbHVnaW4tcGlja2VyJyk7XG4gICAgICAgICAgICAgICAgdGhhdC5fZmlsdGVyUGx1Z2luc0xpc3QocGx1Z2luc1BpY2tlciwgaW5wdXQpO1xuICAgICAgICAgICAgfSwgMTAwKTtcblxuICAgICAgICAgICAgaW5wdXQub24odGhpcy5rZXlVcCwgaGFuZGxlcikub24odGhpcy5rZXlVcCwgQ01TLkFQSS5IZWxwZXJzLmRlYm91bmNlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0O1xuICAgICAgICAgICAgICAgIHZhciBwbHVnaW5zUGlja2VyO1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IENNUy5LRVlTLkVOVEVSKSB7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luc1BpY2tlciA9IGlucHV0LmNsb3Nlc3QoJy5jbXMtcGx1Z2luLXBpY2tlcicpO1xuICAgICAgICAgICAgICAgICAgICBwbHVnaW5zUGlja2VyLmZpbmQoJy5jbXMtc3VibWVudS1pdGVtJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5ub3QoJy5jbXMtc3VibWVudS1pdGVtLXRpdGxlJykuZmlsdGVyKCc6dmlzaWJsZScpLmZpcnN0KCkuZmluZCgnPiBhJykuZm9jdXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyaWdnZXIoJ2NsaWNrJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTEwKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgY2xpY2sgaGFuZGxlcnMgZm9yIHZhcmlvdXMgcGx1Z2luL3BsYWNlaG9sZGVyIGl0ZW1zLlxuICAgICAgICAgKiBJdGVtcyBjYW4gYmUgYW55d2hlcmUgaW4gdGhlIHBsdWdpbiBkcmFnaXRlbSwgbm90IG9ubHkgaW4gZHJvcGRvd24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwQWN0aW9uc1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gbmF2IGRyb3Bkb3duIHRyaWdnZXIgd2l0aCB0aGUgaXRlbXNcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cEFjdGlvbnM6IGZ1bmN0aW9uIF9zZXR1cEFjdGlvbnMobmF2KSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSAnLmNtcy1zdWJtZW51LWVkaXQsIC5jbXMtc3VibWVudS1pdGVtIGEnO1xuICAgICAgICAgICAgbmF2LnBhcmVudCgpLmZpbmQoJy5jbXMtc3VibWVudS1lZGl0Jykub24odGhpcy50b3VjaFN0YXJ0LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIC8vIHJlcXVpcmVkIG9uIHNvbWUgdG91Y2ggZGV2aWNlcyBzb1xuICAgICAgICAgICAgICAgIC8vIHVpIHRvdWNoIHB1bmNoIGlzIG5vdCB0cmlnZ2VyaW5nIG1vdXNlbW92ZVxuICAgICAgICAgICAgICAgIC8vIHdoaWNoIGluIHR1cm4gcmVzdWx0cyBpbiBwZXAgdHJpZ2dlcmluZyBwb2ludGVyY2FuY2VsXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbmF2LnBhcmVudCgpLmZpbmQoaXRlbXMpLm9uKHRoYXQuY2xpY2ssIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBzaG93IGxvYWRlciBhbmQgbWFrZSBzdXJlIHNjcm9sbCBkb2Vzbid0IGp1bXBcbiAgICAgICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuc2hvd0xvYWRlcigpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBDTVMuUGx1Z2luLl9oaWRlU2V0dGluZ3NNZW51KG5hdik7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgc3dpdGNoIGZvciBzdWJuYXYgZW50cmllc1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoZWwuYXR0cignZGF0YS1yZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5hZGRQbHVnaW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuYXR0cignaHJlZicpLnJlcGxhY2UoJyMnLCAnJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwudGV4dCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmNsb3Nlc3QoJy5jbXMtcGx1Z2luLXBpY2tlcicpLmRhdGEoJ3BhcmVudElkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWpheF9hZGQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLm9wZW5BamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGVsLmF0dHIoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0OiBKU09OLnN0cmluZ2lmeShlbC5kYXRhKCdwb3N0JykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGVsLmRhdGEoJ3RleHQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogJC5wcm94eSh0aGF0LmVkaXRQbHVnaW5Qb3N0QWpheCwgdGhhdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBlbC5kYXRhKCdvbi1zdWNjZXNzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VkaXQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5lZGl0UGx1Z2luKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3B0aW9ucy51cmxzLmVkaXRfcGx1Z2luLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5wbHVnaW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm9wdGlvbnMucGx1Z2luX2JyZWFkY3J1bWJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29weS1sYW5nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY29weVBsdWdpbih0aGlzLm9wdGlvbnMsIGVsLmF0dHIoJ2RhdGEtbGFuZ3VhZ2UnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29weSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsLnBhcmVudCgpLmhhc0NsYXNzKCdjbXMtc3VibWVudS1pdGVtLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmNvcHlQbHVnaW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLmhpZGVMb2FkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjdXQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXRQbHVnaW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdwYXN0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsLnBhcmVudCgpLmhhc0NsYXNzKCdjbXMtc3VibWVudS1pdGVtLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnBhc3RlUGx1Z2luKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5oaWRlTG9hZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZGVsZXRlUGx1Z2luKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3B0aW9ucy51cmxzLmRlbGV0ZV9wbHVnaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLnBsdWdpbl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3B0aW9ucy5wbHVnaW5fYnJlYWRjcnVtYlxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLmhpZGVMb2FkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5fZGVsZWdhdGUoZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGtleWJvYXJkIHRyYXZlcnNpbmcgb2YgcGx1Z2luIHBpY2tlci5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBLZXlib2FyZFRyYXZlcnNpbmdcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cEtleWJvYXJkVHJhdmVyc2luZzogZnVuY3Rpb24gX3NldHVwS2V5Ym9hcmRUcmF2ZXJzaW5nKCkge1xuICAgICAgICAgICAgdmFyIGRyb3Bkb3duID0gJCgnLmNtcy1tb2RhbC1tYXJrdXAgLmNtcy1wbHVnaW4tcGlja2VyJyk7XG4gICAgICAgICAgICBpZiAoIWRyb3Bkb3duLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGFkZCBrZXkgZXZlbnRzXG4gICAgICAgICAgICBkb2Mub2ZmKHRoaXMua2V5RG93biArICcudHJhdmVyc2UnKTtcbiAgICAgICAgICAgIGRvYy5vbih0aGlzLmtleURvd24gKyAnLnRyYXZlcnNlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9ycyA9IGRyb3Bkb3duLmZpbmQoJy5jbXMtc3VibWVudS1pdGVtOnZpc2libGUgYScpO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGFuY2hvcnMuaW5kZXgoYW5jaG9ycy5maWx0ZXIoJzpmb2N1cycpKTtcblxuICAgICAgICAgICAgICAgIC8vIGJpbmQgYXJyb3cgZG93biBhbmQgdGFiIGtleXNcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5ET1dOIHx8IGUua2V5Q29kZSA9PT0gQ01TLktFWVMuVEFCKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDAgJiYgaW5kZXggPCBhbmNob3JzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcnMuZXEoaW5kZXggKyAxKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9ycy5lcSgwKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gYmluZCBhcnJvdyB1cCBhbmQgc2hpZnQrdGFiIGtleXNcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5VUCB8fCAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5UQUIgJiYgZS5zaGlmdEtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYW5jaG9ycy5pcygnOmZvY3VzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcnMuZXEoaW5kZXggLSAxKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9ycy5lcShhbmNob3JzLmxlbmd0aCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyB0aGUgc2V0dGluZ3MgbWVudSBmb3IgYSBwbHVnaW4uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Nob3dTZXR0aW5nc01lbnVcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IG5hdiB0cmlnZ2VyIGVsZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgIF9zaG93U2V0dGluZ3NNZW51OiBmdW5jdGlvbiAobmF2KSB7XG4gICAgICAgICAgICB2YXIgZHJvcGRvd24gPSB0aGlzLnVpLmRyb3Bkb3duO1xuICAgICAgICAgICAgdmFyIHBhcmVudHMgPSBuYXYucGFyZW50c1VudGlsKCcuY21zLWRyYWdhcmVhJykubGFzdCgpO1xuXG4gICAgICAgICAgICBuYXYuYWRkQ2xhc3MoJ2Ntcy1idG4tYWN0aXZlJyk7XG4gICAgICAgICAgICBwYXJlbnRzLmFkZENsYXNzKCdjbXMtei1pbmRleC05OTk5Jyk7XG5cbiAgICAgICAgICAgIC8vIHNldCB2aXNpYmxlIHN0YXRlc1xuICAgICAgICAgICAgZHJvcGRvd24uc2hvdygpO1xuXG4gICAgICAgICAgICAvLyBjYWxjdWxhdGUgZHJvcGRvd24gcG9zaXRpb25pbmdcbiAgICAgICAgICAgIGlmICh0aGlzLnVpLndpbmRvdy5oZWlnaHQoKSArIHRoaXMudWkud2luZG93LnNjcm9sbFRvcCgpIC1cbiAgICAgICAgICAgICAgICBuYXYub2Zmc2V0KCkudG9wIC0gZHJvcGRvd24uaGVpZ2h0KCkgPD0gMTAgJiYgbmF2Lm9mZnNldCgpLnRvcCAtIGRyb3Bkb3duLmhlaWdodCgpID49IDApIHtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5yZW1vdmVDbGFzcygnY21zLXN1Ym1lbnUtZHJvcGRvd24tdG9wJykuYWRkQ2xhc3MoJ2Ntcy1zdWJtZW51LWRyb3Bkb3duLWJvdHRvbScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5yZW1vdmVDbGFzcygnY21zLXN1Ym1lbnUtZHJvcGRvd24tYm90dG9tJykuYWRkQ2xhc3MoJ2Ntcy1zdWJtZW51LWRyb3Bkb3duLXRvcCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaWx0ZXJzIGdpdmVuIHBsdWdpbnMgbGlzdCBieSBhIHF1ZXJ5LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9maWx0ZXJQbHVnaW5zTGlzdFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gbGlzdCBwbHVnaW5zIHBpY2tlciBlbGVtZW50XG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBpbnB1dCBpbnB1dCwgd2hpY2ggdmFsdWUgdG8gZmlsdGVyIHBsdWdpbnMgd2l0aFxuICAgICAgICAgKi9cbiAgICAgICAgX2ZpbHRlclBsdWdpbnNMaXN0OiBmdW5jdGlvbiBfZmlsdGVyUGx1Z2luc0xpc3QobGlzdCwgaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGxpc3QuZmluZCgnLmNtcy1zdWJtZW51LWl0ZW0nKTtcbiAgICAgICAgICAgIHZhciB0aXRsZXMgPSBsaXN0LmZpbmQoJy5jbXMtc3VibWVudS1pdGVtLXRpdGxlJyk7XG4gICAgICAgICAgICB2YXIgcXVlcnkgPSBpbnB1dC52YWwoKTtcblxuICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHF1ZXJ5IGlzIHplcm9cbiAgICAgICAgICAgIGlmIChxdWVyeSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICBpdGVtcy5hZGQodGl0bGVzKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggaXRlbXMgYW5kIGZpZ3VyZSBvdXQgaWYgd2UgbmVlZCB0byBoaWRlIGl0ZW1zXG4gICAgICAgICAgICBpdGVtcy5maW5kKCdhLCBzcGFuJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGl0ZW0udGV4dCgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaCA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgICAgICAodGV4dC5pbmRleE9mKHNlYXJjaCkgPj0gMCkgPyBpdGVtLnBhcmVudCgpLnNob3coKSA6IGl0ZW0ucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGEgdGl0bGUgaXMgbWF0Y2hpbmdcbiAgICAgICAgICAgIHRpdGxlcy5maWx0ZXIoJzp2aXNpYmxlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB0aXRsZXMuaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoaXRlbSkubmV4dFVudGlsKCcuY21zLXN1Ym1lbnUtaXRlbS10aXRsZScpLnNob3coKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhbHdheXMgZGlzcGxheSB0aXRsZSBvZiBhIGNhdGVnb3J5XG4gICAgICAgICAgICBpdGVtcy5maWx0ZXIoJzp2aXNpYmxlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5wcmV2KCkuaGFzQ2xhc3MoJ2Ntcy1zdWJtZW51LWl0ZW0tdGl0bGUnKSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnByZXYoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5wcmV2VW50aWwoJy5jbXMtc3VibWVudS1pdGVtLXRpdGxlJykubGFzdCgpLnByZXYoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGVsZW1lbnQgdmlzaWJsZSwgc2hvdyBvbmx5IGZpcnN0IGNhdGVnb3JpeVxuICAgICAgICAgICAgbGlzdC5zaWJsaW5ncygnLmNtcy1zdWJtZW51LWRyb3Bkb3duLWNoaWxkcmVuJykuc2hvdygpO1xuICAgICAgICAgICAgaWYgKGl0ZW1zLmFkZCh0aXRsZXMpLmZpbHRlcignOnZpc2libGUnKS5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgIGxpc3Quc2libGluZ3MoJy5jbXMtc3VibWVudS1kcm9wZG93bi1jaGlsZHJlbicpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVG9nZ2xlcyBjb2xsYXBzYWJsZSBpdGVtLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF90b2dnbGVDb2xsYXBzYWJsZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWwgZWxlbWVudCB0byB0b2dnbGVcbiAgICAgICAgICovXG4gICAgICAgIF90b2dnbGVDb2xsYXBzYWJsZTogZnVuY3Rpb24gdG9nZ2xlQ29sbGFwc2FibGUoZWwpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBpZCA9IHRoYXQuX2dldElkKGVsLnBhcmVudCgpKTtcbiAgICAgICAgICAgIHZhciBkcmFnZ2FibGUgPSB0aGlzLnVpLmRyYWdnYWJsZTtcbiAgICAgICAgICAgIHZhciBpdGVtcztcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gQ01TLnNldHRpbmdzO1xuICAgICAgICAgICAgc2V0dGluZ3Muc3RhdGVzID0gc2V0dGluZ3Muc3RhdGVzIHx8IFtdO1xuXG4gICAgICAgICAgICAvLyBjb2xsYXBzYWJsZSBmdW5jdGlvbiBhbmQgc2F2ZSBzdGF0ZXNcbiAgICAgICAgICAgIGlmIChlbC5oYXNDbGFzcygnY21zLWRyYWdpdGVtLWV4cGFuZGVkJykpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5zdGF0ZXMuc3BsaWNlKCQuaW5BcnJheShpZCwgc2V0dGluZ3Muc3RhdGVzKSwgMSk7XG4gICAgICAgICAgICAgICAgZWwucmVtb3ZlQ2xhc3MoJ2Ntcy1kcmFnaXRlbS1leHBhbmRlZCcpLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAgIC5maW5kKCc+IC5jbXMtY29sbGFwc2FibGUtY29udGFpbmVyJykuYWRkQ2xhc3MoJ2Ntcy1oaWRkZW4nKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2MuZGF0YSgnZXhwYW5kbW9kZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gZHJhZ2dhYmxlLmZpbmQoJy5jbXMtZHJhZ2dhYmxlJykuZmluZCgnLmNtcy1kcmFnaXRlbS1jb2xsYXBzYWJsZScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzQ2xhc3MoJ2Ntcy1kcmFnaXRlbS1leHBhbmRlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fdG9nZ2xlQ29sbGFwc2FibGUoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5zdGF0ZXMucHVzaChpZCk7XG4gICAgICAgICAgICAgICAgZWwuYWRkQ2xhc3MoJ2Ntcy1kcmFnaXRlbS1leHBhbmRlZCcpLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAgIC5maW5kKCc+IC5jbXMtY29sbGFwc2FibGUtY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2Ntcy1oaWRkZW4nKTtcblxuICAgICAgICAgICAgICAgIGlmIChkb2MuZGF0YSgnZXhwYW5kbW9kZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gZHJhZ2dhYmxlLmZpbmQoJy5jbXMtZHJhZ2dhYmxlJykuZmluZCgnLmNtcy1kcmFnaXRlbS1jb2xsYXBzYWJsZScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtLmhhc0NsYXNzKCdjbXMtZHJhZ2l0ZW0tZXhwYW5kZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX3RvZ2dsZUNvbGxhcHNhYmxlKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBzdHJ1Y3R1cmJvYXJkIGdldHMgdXBkYXRlZCBhZnRlciBleHBhbmRpbmdcbiAgICAgICAgICAgIHRoaXMudWkud2luZG93LnRyaWdnZXIoJ3Jlc2l6ZS5zaWRlZnJhbWUnKTtcblxuICAgICAgICAgICAgLy8gc2F2ZSBzZXR0aW5nc1xuICAgICAgICAgICAgQ01TLkFQSS5Ub29sYmFyLnNldFNldHRpbmdzKHNldHRpbmdzKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyB1cCBjb2xsYWJzcGFibGUgZXZlbnQgaGFuZGxlcnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NvbGxhcHNhYmxlc1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2NvbGxhcHNhYmxlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gb25lIHRpbWUgc2V0dXBcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2dhYmxlID0gJCgnLmNtcy1kcmFnZ2FibGUtJyArIHRoaXMub3B0aW9ucy5wbHVnaW5faWQpO1xuICAgICAgICAgICAgdmFyIGRyYWdpdGVtID0gdGhpcy51aS5kcmFnZ2FibGUuZmluZCgnPiAuY21zLWRyYWdpdGVtJyk7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIHdoaWNoIGJ1dHRvbiBzaG91bGQgYmUgc2hvd24gZm9yIGNvbGxhcHNlbWVudVxuICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxzID0gJChpdGVtKS5maW5kKCcuY21zLWRyYWdpdGVtLWNvbGxhcHNhYmxlJyk7XG4gICAgICAgICAgICAgICAgdmFyIG9wZW4gPSBlbHMuZmlsdGVyKCcuY21zLWRyYWdpdGVtLWV4cGFuZGVkJyk7XG4gICAgICAgICAgICAgICAgaWYgKGVscy5sZW5ndGggPT09IG9wZW4ubGVuZ3RoICYmIChlbHMubGVuZ3RoICsgb3Blbi5sZW5ndGggIT09IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuZmluZCgnLmNtcy1kcmFnYmFyLXRpdGxlJykuYWRkQ2xhc3MoJ2Ntcy1kcmFnYmFyLXRpdGxlLWV4cGFuZGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBjYW5jZWwgaGVyZSBpZiBpdHMgbm90IGEgZHJhZ2dhYmxlXG4gICAgICAgICAgICBpZiAoIXRoaXMudWkuZHJhZ2dhYmxlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byBkcmFnZ2FibGVcbiAgICAgICAgICAgIC8vIGRlYm91bmNlIGhlcmUgcmVxdWlyZWQgYmVjYXVzZSBvbiBzb21lIGRldmljZXMgY2xpY2sgaXMgbm90IHRyaWdnZXJlZCxcbiAgICAgICAgICAgIC8vIHNvIHdlIGNvbnNvbGlkYXRlIGxhdGVzdCBjbGljayBhbmQgdG91Y2ggZXZlbnQgdG8gcnVuIHRoZSBjb2xsYXBzZSBvbmx5IG9uY2VcbiAgICAgICAgICAgIGRyYWdpdGVtLmZpbmQoJz4gLmNtcy1kcmFnaXRlbS10ZXh0Jykub24oXG4gICAgICAgICAgICAgICAgdGhpcy50b3VjaEVuZCArICcgJyArIHRoaXMuY2xpY2ssXG4gICAgICAgICAgICAgICAgQ01TLkFQSS5IZWxwZXJzLmRlYm91bmNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkcmFnaXRlbS5oYXNDbGFzcygnY21zLWRyYWdpdGVtLWNvbGxhcHNhYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGF0Ll90b2dnbGVDb2xsYXBzYWJsZShkcmFnaXRlbSk7XG4gICAgICAgICAgICAgICAgfSwgMClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIGFkZHMgZG91YmxlIGNsaWNrIGV2ZW50XG4gICAgICAgICAgICB0aGlzLnVpLmRyYWdnYWJsZS5vbih0aGlzLmRvdWJsZUNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgJCgnLmNtcy1wbHVnaW4tJyArIHRoYXQuX2dldElkKCQodGhpcykpKS50cmlnZ2VyKCdkYmxjbGljay5jbXMnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBvbmx5IG5lZWRzIHRvIGJlIGV4Y2VjdXRlZCBvbmNlXG4gICAgICAgICAgICBpZiAoQ01TLlRvb2xiYXIucmVhZHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHJlbW92aW5nIGR1cGxpY2F0ZSBlbnRyaWVzXG4gICAgICAgICAgICB2YXIgc29ydGVkQXJyID0gQ01TLnNldHRpbmdzLnN0YXRlcy5zb3J0KCk7XG4gICAgICAgICAgICB2YXIgZmlsdGVyZWRBcnJheSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0ZWRBcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoc29ydGVkQXJyW2ldICE9PSBzb3J0ZWRBcnJbaSArIDFdKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQXJyYXkucHVzaChzb3J0ZWRBcnJbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIENNUy5zZXR0aW5ncy5zdGF0ZXMgPSBmaWx0ZXJlZEFycmF5O1xuXG4gICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIGl0ZW1zXG4gICAgICAgICAgICAkLmVhY2goQ01TLnNldHRpbmdzLnN0YXRlcywgZnVuY3Rpb24gKGluZGV4LCBpZCkge1xuICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoJy5jbXMtZHJhZ2dhYmxlLScgKyBpZCk7XG4gICAgICAgICAgICAgICAgLy8gb25seSBhZGQgdGhpcyBjbGFzcyB0byBlbGVtZW50cyB3aGljaCBoYXZlIGEgZHJhZ2dhYmxlIGFyZWFcbiAgICAgICAgICAgICAgICBpZiAoZWwuZmluZCgnLmNtcy1kcmFnZ2FibGVzJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoJz4gLmNtcy1jb2xsYXBzYWJsZS1jb250YWluZXInKS5yZW1vdmVDbGFzcygnY21zLWhpZGRlbicpO1xuICAgICAgICAgICAgICAgICAgICBlbC5maW5kKCc+IC5jbXMtZHJhZ2l0ZW0nKS5hZGRDbGFzcygnY21zLWRyYWdpdGVtLWV4cGFuZGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHNldCBnbG9iYWwgc2V0dXBcbiAgICAgICAgICAgIENNUy5Ub29sYmFyLnJlYWR5ID0gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRXhwYW5kcyBhbGwgdGhlIGNvbGxhcHNhYmxlcyBpbiB0aGUgZ2l2ZW4gcGxhY2Vob2xkZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2V4cGFuZEFsbFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWwgdHJpZ2dlciBlbGVtZW50IHRoYXQgaXMgYSBjaGlsZCBvZiBhIHBsYWNlaG9sZGVyXG4gICAgICAgICAqL1xuICAgICAgICBfZXhwYW5kQWxsOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGVsLmNsb3Nlc3QoJy5jbXMtZHJhZ2FyZWEnKS5maW5kKCcuY21zLWRyYWdpdGVtLWNvbGxhcHNhYmxlJyk7XG4gICAgICAgICAgICAvLyBjYW5jZWwgaWYgdGhlcmUgYXJlIG5vIGl0ZW1zXG4gICAgICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW0uaGFzQ2xhc3MoJ2Ntcy1kcmFnaXRlbS1leHBhbmRlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3RvZ2dsZUNvbGxhcHNhYmxlKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbC5hZGRDbGFzcygnY21zLWRyYWdiYXItdGl0bGUtZXhwYW5kZWQnKTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gQ01TLnNldHRpbmdzO1xuICAgICAgICAgICAgc2V0dGluZ3MuZHJhZ2JhcnMgPSBzZXR0aW5ncy5kcmFnYmFycyB8fCBbXTtcbiAgICAgICAgICAgIHNldHRpbmdzLmRyYWdiYXJzLnB1c2godGhpcy5vcHRpb25zLnBsYWNlaG9sZGVyX2lkKTtcbiAgICAgICAgICAgIENNUy5BUEkuVG9vbGJhci5zZXRTZXR0aW5ncyhzZXR0aW5ncyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbGxhcHNlcyBhbGwgdGhlIGNvbGxhcHNhYmxlcyBpbiB0aGUgZ2l2ZW4gcGxhY2Vob2xkZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NvbGxhcHNlQWxsXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCB0cmlnZ2VyIGVsZW1lbnQgdGhhdCBpcyBhIGNoaWxkIG9mIGEgcGxhY2Vob2xkZXJcbiAgICAgICAgICovXG4gICAgICAgIF9jb2xsYXBzZUFsbDogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBlbC5jbG9zZXN0KCcuY21zLWRyYWdhcmVhJykuZmluZCgnLmNtcy1kcmFnaXRlbS1jb2xsYXBzYWJsZScpO1xuICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0NsYXNzKCdjbXMtZHJhZ2l0ZW0tZXhwYW5kZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll90b2dnbGVDb2xsYXBzYWJsZShpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWwucmVtb3ZlQ2xhc3MoJ2Ntcy1kcmFnYmFyLXRpdGxlLWV4cGFuZGVkJyk7XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IENNUy5zZXR0aW5ncztcbiAgICAgICAgICAgIHNldHRpbmdzLmRyYWdiYXJzID0gc2V0dGluZ3MuZHJhZ2JhcnMgfHwgW107XG4gICAgICAgICAgICBzZXR0aW5ncy5kcmFnYmFycy5zcGxpY2UoJC5pbkFycmF5KHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlcl9pZCwgc2V0dGluZ3Muc3RhdGVzKSwgMSk7XG4gICAgICAgICAgICBDTVMuQVBJLlRvb2xiYXIuc2V0U2V0dGluZ3Moc2V0dGluZ3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIHRoZSBpZCBvZiB0aGUgZWxlbWVudCwgdXNlcyBDTVMuU3RydWN0dXJlQm9hcmQgaW5zdGFuY2UuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2dldElkXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCBlbGVtZW50IHRvIGdldCBpZCBmcm9tXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIF9nZXRJZDogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICByZXR1cm4gQ01TLkFQSS5TdHJ1Y3R1cmVCb2FyZC5nZXRJZChlbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldHMgdGhlIGlkcyBvZiB0aGUgbGlzdCBvZiBlbGVtZW50cywgdXNlcyBDTVMuU3RydWN0dXJlQm9hcmQgaW5zdGFuY2UuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2dldElkc1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWxzIGVsZW1lbnRzIHRvIGdldCBpZCBmcm9tXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ1tdfVxuICAgICAgICAgKi9cbiAgICAgICAgX2dldElkczogZnVuY3Rpb24gKGVscykge1xuICAgICAgICAgICAgcmV0dXJuIENNUy5BUEkuU3RydWN0dXJlQm9hcmQuZ2V0SWRzKGVscyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3dzIGFuZCBpbW1lZGlhdGVseSBmYWRlcyBvdXQgYSBzdWNjZXNzIG5vdGlmaWNhdGlvbiAod2hlblxuICAgICAgICAgKiBwbHVnaW4gd2FzIHN1Y2Nlc3NmdWxseSBtb3ZlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2hvd1N1Y2Nlc3NcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGVsIGRyYWdnYWJsZSBlbGVtZW50XG4gICAgICAgICAqL1xuICAgICAgICBfc2hvd1N1Y2Nlc3M6IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgdmFyIHRwbCA9ICQoJzxkaXYgY2xhc3M9XCJjbXMtZHJhZ2l0ZW0tc3VjY2Vzc1wiPjwvZGl2PicpO1xuICAgICAgICAgICAgZWwuYWRkQ2xhc3MoJ2Ntcy1kcmFnZ2FibGUtc3VjY2VzcycpLmFwcGVuZCh0cGwpO1xuICAgICAgICAgICAgLy8gc3RhcnQgYW5pbWF0aW9uXG4gICAgICAgICAgICB0cGwuZmFkZU91dCgxMDAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBlbC5yZW1vdmVDbGFzcygnY21zLWRyYWdnYWJsZS1zdWNjZXNzJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBzdHJ1Y3R1cmJvYXJkIGdldHMgdXBkYXRlZCBhZnRlciBzdWNjZXNzXG4gICAgICAgICAgICB0aGlzLnVpLndpbmRvdy50cmlnZ2VyKCdyZXNpemUuc2lkZWZyYW1lJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEhpZGVzIHRoZSBvcGVuZWQgc2V0dGluZ3MgbWVudS4gQnkgZGVmYXVsdCBsb29rcyBmb3IgYW55IG9wZW4gb25lcy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2hpZGVTZXR0aW5nc01lbnVcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gW25hdl0gZWxlbWVudCByZXByZXNlbnRpbmcgdGhlIHN1Ym5hdiB0cmlnZ2VyXG4gICAgICovXG4gICAgQ01TLlBsdWdpbi5faGlkZVNldHRpbmdzTWVudSA9IGZ1bmN0aW9uIChuYXYpIHtcbiAgICAgICAgbmF2ID0gbmF2IHx8ICQoJy5jbXMtc3VibWVudS1idG4uY21zLWJ0bi1hY3RpdmUnKTtcbiAgICAgICAgaWYgKCFuYXYubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbmF2LnJlbW92ZUNsYXNzKCdjbXMtYnRuLWFjdGl2ZScpO1xuXG4gICAgICAgIC8vIHNldCBjb3JyZWN0IGFjdGl2ZSBzdGF0ZVxuICAgICAgICBuYXYuY2xvc2VzdCgnLmNtcy1kcmFnZ2FibGUnKS5kYXRhKCdhY3RpdmUnLCBmYWxzZSk7XG4gICAgICAgICQoJy5jbXMtei1pbmRleC05OTk5JykucmVtb3ZlQ2xhc3MoJ2Ntcy16LWluZGV4LTk5OTknKTtcblxuICAgICAgICBuYXYuc2libGluZ3MoJy5jbXMtc3VibWVudS1kcm9wZG93bicpLmhpZGUoKTtcbiAgICAgICAgbmF2LnNpYmxpbmdzKCcuY21zLXF1aWNrc2VhcmNoJykuaGlkZSgpO1xuICAgICAgICAvLyByZXNldCBzZWFyY2hcbiAgICAgICAgbmF2LnNpYmxpbmdzKCcuY21zLXF1aWNrc2VhcmNoJylcbiAgICAgICAgICAgIC5maW5kKCdpbnB1dCcpXG4gICAgICAgICAgICAudmFsKCcnKVxuICAgICAgICAgICAgLnRyaWdnZXIodGhpcy5rZXlVcCkuYmx1cigpO1xuXG4gICAgICAgIC8vIHJlc2V0IHJlbGF0aXZpdHlcbiAgICAgICAgJCgnLmNtcy1kcmFnYmFyJykuY3NzKCdwb3NpdGlvbicsICcnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGlzZXMgaGFuZGxlcnMgdGhhdCBhZmZlY3QgYWxsIHBsdWdpbnMgYW5kIGRvbid0IG1ha2Ugc2Vuc2VcbiAgICAgKiBpbiBjb250ZXh0IG9mIGVhY2ggb3duIHBsdWdpbiBpbnN0YW5jZSwgZS5nLiBsaXN0ZW5pbmcgZm9yIGEgY2xpY2sgb24gYSBkb2N1bWVudFxuICAgICAqIHRvIGhpZGUgcGx1Z2luIHNldHRpbmdzIG1lbnUgc2hvdWxkIG9ubHkgYmUgYXBwbGllZCBvbmNlLCBhbmQgbm90IGV2ZXJ5IHRpbWVcbiAgICAgKiBDTVMuUGx1Z2luIGlzIGluc3RhbnRpYXRlZC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2luaXRpYWxpemVHbG9iYWxIYW5kbGVyc1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIENNUy5QbHVnaW4uX2luaXRpYWxpemVHbG9iYWxIYW5kbGVycyA9IGZ1bmN0aW9uIF9pbml0aWFsaXplR2xvYmFsSGFuZGxlcnMoKSB7XG4gICAgICAgIHZhciB0aW1lcjtcbiAgICAgICAgdmFyIGNsaWNrQ291bnRlciA9IDA7XG5cbiAgICAgICAgZG9jID0gJChkb2N1bWVudCk7XG4gICAgICAgIGNsaXBib2FyZCA9ICQoJy5jbXMtY2xpcGJvYXJkJyk7XG4gICAgICAgIGNsaXBib2FyZERyYWdnYWJsZSA9IGNsaXBib2FyZC5maW5kKCcuY21zLWRyYWdnYWJsZTpmaXJzdCcpO1xuICAgICAgICBjbGlwYm9hcmRQbHVnaW4gPSBjbGlwYm9hcmQuZmluZCgnLmNtcy1wbHVnaW46Zmlyc3QnKTtcblxuICAgICAgICBkb2Mub24oJ3BvaW50ZXJ1cC5jbXMucGx1Z2luJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gY2FsbCBpdCBhcyBhIHN0YXRpYyBtZXRob2QsIGJlY2F1c2Ugb3RoZXJ3aXNlIHdlIHRyaWdnZXIgaXQgdGhlXG4gICAgICAgICAgICAvLyBhbW91bnQgb2YgdGltZXMgQ01TLlBsdWdpbiBpcyBpbnN0YW50aWF0ZWQsXG4gICAgICAgICAgICAvLyB3aGljaCBkb2VzIG5vdCBtYWtlIG11Y2ggc2Vuc2UuXG4gICAgICAgICAgICBDTVMuUGx1Z2luLl9oaWRlU2V0dGluZ3NNZW51KCk7XG4gICAgICAgIH0pLm9uKCdrZXlkb3duLmNtcy5wbHVnaW4nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gQ01TLktFWVMuU0hJRlQpIHtcbiAgICAgICAgICAgICAgICBkb2MuZGF0YSgnZXhwYW5kbW9kZScsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5vbigna2V5dXAuY21zLnBsdWdpbicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5TSElGVCkge1xuICAgICAgICAgICAgICAgIGRvYy5kYXRhKCdleHBhbmRtb2RlJywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5vbignY2xpY2suY21zLnBsdWdpbicsICcuY21zLXBsdWdpbiBhLCBhOmhhcyguY21zLXBsdWdpbiknLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgLy8gcHJldmVudHMgc2luZ2xlIGNsaWNrIGZyb20gbWVzc2luZyB1cCB0aGUgZWRpdCBjYWxsXG4gICAgICAgICAgICAvLyBkb24ndCBnbyB0byB0aGUgbGluayBpZiB0aGVyZSBpcyBjdXN0b20ganMgYXR0YWNoZWQgdG8gaXRcbiAgICAgICAgICAgIC8vIG9yIGlmIGl0J3MgY2xpY2tlZCBhbG9uZyB3aXRoIHNoaWZ0LCBjdHJsLCBjbWRcbiAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSB8fCBlLm1ldGFLZXkgfHwgZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICgrK2NsaWNrQ291bnRlciA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhbmNob3IgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgIGNsaWNrQ291bnRlciA9IDA7XG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSB0YXJnZXQgYXR0cmlidXRlIGlzIGhvbm91cmVkIG9uIGxpbmtzXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGFuY2hvci5hdHRyKCdocmVmJyksIGFuY2hvci5hdHRyKCd0YXJnZXQnKSB8fCAnX3NlbGYnKTtcbiAgICAgICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICAgICAgICAgIGNsaWNrQ291bnRlciA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvLyBzaG9ydGhhbmQgZm9yIGpRdWVyeShkb2N1bWVudCkucmVhZHkoKTtcbiAgICAkKENNUy5QbHVnaW4uX2luaXRpYWxpemVHbG9iYWxIYW5kbGVycyk7XG5cbn0pKENNUy4kKTtcbiIsIi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBTVFJVQ1RVUkVCT0FSRFxuLyoqXG4gKiBAbW9kdWxlIENNU1xuICovXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xudmFyIENNUyA9IHdpbmRvdy5DTVMgfHwge307XG5cbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwbGFjZWhvbGRlcnM7XG5cbiAgICAvLyBUT0RPIG1ha2UgdGhlc2Ugc3RhdGljIG1ldGhvZHMgb24gQ01TLlN0cnVjdHVyZUJvYXJkXG4gICAgZnVuY3Rpb24gYWN0dWFsaXplRW1wdHlQbGFjZWhvbGRlcnMoKSB7XG4gICAgICAgIHBsYWNlaG9sZGVycy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlciA9ICQodGhpcyk7XG4gICAgICAgICAgICB2YXIgY29weUFsbCA9IHBsYWNlaG9sZGVyLmZpbmQoJy5jbXMtZHJhZ2JhciAuY21zLXN1Ym1lbnUtaXRlbTpoYXMoYVtkYXRhLXJlbD1cImNvcHlcIl0pOmZpcnN0Jyk7XG4gICAgICAgICAgICBpZiAocGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgICAuZmluZCgnPiAuY21zLWRyYWdnYWJsZXMnKVxuICAgICAgICAgICAgICAgIC5jaGlsZHJlbignLmNtcy1kcmFnZ2FibGU6bm90KC5jbXMtZHJhZ2dhYmxlLWlzLWRyYWdnaW5nKScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLnJlbW92ZUNsYXNzKCdjbXMtZHJhZ2FyZWEtZW1wdHknKTtcbiAgICAgICAgICAgICAgICBjb3B5QWxsLnJlbW92ZUNsYXNzKCdjbXMtc3VibWVudS1pdGVtLWRpc2FibGVkJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLmFkZENsYXNzKCdjbXMtZHJhZ2FyZWEtZW1wdHknKTtcbiAgICAgICAgICAgICAgICBjb3B5QWxsLmFkZENsYXNzKCdjbXMtc3VibWVudS1pdGVtLWRpc2FibGVkJyk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWN0dWFsaXplUGx1Z2luc0NvbGxhcHNpYmxlU3RhdHVzKGVscykge1xuICAgICAgICBlbHMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRMaXN0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgIHZhciBwbHVnaW5EcmFnSXRlbSA9IGNoaWxkTGlzdC5jbG9zZXN0KCcuY21zLWRyYWdnYWJsZScpLmZpbmQoJz4gLmNtcy1kcmFnaXRlbScpO1xuXG4gICAgICAgICAgICBpZiAoY2hpbGRMaXN0LmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcGx1Z2luRHJhZ0l0ZW0uYWRkQ2xhc3MoJ2Ntcy1kcmFnaXRlbS1jb2xsYXBzYWJsZSBjbXMtZHJhZ2l0ZW0tZXhwYW5kZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGx1Z2luRHJhZ0l0ZW0ucmVtb3ZlQ2xhc3MoJ2Ntcy1kcmFnaXRlbS1jb2xsYXBzYWJsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIGRyYWcgJiBkcm9wLCBtb2RlIHN3aXRjaGluZyBhbmQgY29sbGFwc2FibGVzLlxuICAgICAqXG4gICAgICogQGNsYXNzIFN0cnVjdHVyZUJvYXJkXG4gICAgICogQG5hbWVzcGFjZSBDTVNcbiAgICAgKiBAdXNlcyBDTVMuQVBJLkhlbHBlcnNcbiAgICAgKi9cbiAgICBDTVMuU3RydWN0dXJlQm9hcmQgPSBuZXcgQ01TLkNsYXNzKHtcblxuICAgICAgICBpbXBsZW1lbnQ6IFtDTVMuQVBJLkhlbHBlcnNdLFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLl9zZXR1cFVJKCk7XG5cbiAgICAgICAgICAgIC8vIHN0YXRlc1xuICAgICAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMnO1xuICAgICAgICAgICAgdGhpcy5wb2ludGVyVXAgPSAncG9pbnRlcnVwLmNtcyc7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIHNldHVwIGluaXRpYWwgc3R1ZmZcbiAgICAgICAgICAgIHRoaXMuX3NldHVwKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldHVwTW9kZVN3aXRjaGVyKCk7XG4gICAgICAgICAgICBhY3R1YWxpemVFbXB0eVBsYWNlaG9sZGVycygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdG9yZXMgYWxsIGpRdWVyeSByZWZlcmVuY2VzIHdpdGhpbiBgdGhpcy51aWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwVUlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cFVJOiBmdW5jdGlvbiBzZXR1cFVJKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQoJy5jbXMtc3RydWN0dXJlJyk7XG4gICAgICAgICAgICB2YXIgdG9vbGJhciA9ICQoJy5jbXMtdG9vbGJhcicpO1xuICAgICAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICBjb250ZW50OiAkKCcuY21zLXN0cnVjdHVyZS1jb250ZW50JyksXG4gICAgICAgICAgICAgICAgZG9jOiAkKGRvY3VtZW50KSxcbiAgICAgICAgICAgICAgICB3aW5kb3c6ICQod2luZG93KSxcbiAgICAgICAgICAgICAgICBodG1sOiAkKCdodG1sJyksXG4gICAgICAgICAgICAgICAgdG9vbGJhcjogdG9vbGJhcixcbiAgICAgICAgICAgICAgICBzb3J0YWJsZXM6ICQoJy5jbXMtZHJhZ2dhYmxlcycpLCAvLyBnbG9iYWwgc2NvcGUgdG8gaW5jbHVkZSBjbGlwYm9hcmRcbiAgICAgICAgICAgICAgICBwbHVnaW5zOiAkKCcuY21zLXBsdWdpbicpLFxuICAgICAgICAgICAgICAgIHJlbmRlcl9tb2RlbDogJCgnLmNtcy1yZW5kZXItbW9kZWwnKSxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcnM6ICQoJy5jbXMtcGxhY2Vob2xkZXInKSxcbiAgICAgICAgICAgICAgICBkcmFnaXRlbXM6ICQoJy5jbXMtZHJhZ2dhYmxlJyksXG4gICAgICAgICAgICAgICAgZHJhZ2FyZWFzOiAkKCcuY21zLWRyYWdhcmVhJyksXG4gICAgICAgICAgICAgICAgdG9vbGJhck1vZGVTd2l0Y2hlcjogdG9vbGJhci5maW5kKCcuY21zLXRvb2xiYXItaXRlbS1jbXMtbW9kZS1zd2l0Y2hlcicpLFxuICAgICAgICAgICAgICAgIHRvb2xiYXJNb2RlTGlua3M6IHRvb2xiYXIuZmluZCgnLmNtcy10b29sYmFyLWl0ZW0tY21zLW1vZGUtc3dpdGNoZXIgYScpLFxuICAgICAgICAgICAgICAgIHRvb2xiYXJUcmlnZ2VyOiAkKCcuY21zLXRvb2xiYXItdHJpZ2dlcicpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsIHNldHVwIChhbmQgZWFybHkgYmFpbCBpZiBzcGVjaWZpY1xuICAgICAgICAgKiBlbGVtZW50cyBkbyBub3QgZXhpc3QpLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXR1cFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAvLyBjYW5jZWwgaWYgdGhlcmUgYXJlIG5vIGRyYWdhcmVhc1xuICAgICAgICAgICAgaWYgKCF0aGlzLnVpLmRyYWdhcmVhcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNhbmNlbCBpZiB0aGVyZSBpcyBubyBzdHJ1Y3R1cmUgLyBjb250ZW50IHN3aXRjaGVyXG4gICAgICAgICAgICBpZiAoIXRoaXMudWkudG9vbGJhck1vZGVTd2l0Y2hlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNldHVwIHRvb2xiYXIgbW9kZVxuICAgICAgICAgICAgLy8gRklYTUUgdGhpcyBzZXRUaW1lb3V0IGlzIG5lZWRlZCBiZWNhdXNlXG4gICAgICAgICAgICAvLyBwbHVnaW5zIGFyZSBpbml0aWFsaXplZCBhZnRlciBhbGwgdGhlIHNjcmlwdHMgYXJlIHByb2Nlc3NlZFxuICAgICAgICAgICAgLy8gd2hpY2ggc2hvdWxkIGJlIGZpeGVkIGJ0dy4gX3Jlc2l6ZUJvYXJkIHdhbnRzIHBsdWdpbnMgdG8gYmUgaW5pdGlhbGl6ZWQsXG4gICAgICAgICAgICAvLyBvdGhlcndpc2UgdGhyb3dzIGVycm9yc1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKENNUy5zZXR0aW5ncy5tb2RlID09PSAnc3RydWN0dXJlJykge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNob3codHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJpZ2dlcmluZyBoaWRlIGhlcmUgdG8gc3dpdGNoIHByb3BlciBjbGFzc25hbWVzIG9uIHN3aXRjaGVyXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAwKTtcblxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgbW9kZXMgc2hvdWxkIGJlIHZpc2libGVcbiAgICAgICAgICAgIGlmICh0aGlzLnVpLnBsYWNlaG9sZGVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXJNb2RlU3dpdGNoZXIuc2hvdygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhZGQgZHJhZyAmIGRyb3AgZnVuY3Rpb25hbGl0eVxuICAgICAgICAgICAgdGhpcy5fZHJhZygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGV2ZW50cyBoYW5kbGVycyBmb3Igc3dpdGNoaW5nXG4gICAgICAgICAqIHN0cnVjdHVyZWJvYXJkIG1vZGVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zZXR1cE1vZGVTd2l0Y2hlclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwTW9kZVN3aXRjaGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgbW9kZXMgPSB0aGF0LnVpLnRvb2xiYXJNb2RlTGlua3M7XG5cbiAgICAgICAgICAgIC8vIHNob3cgZWRpdCBtb2RlXG4gICAgICAgICAgICBtb2Rlcy5lcSgxKS5vbih0aGF0LmNsaWNrICsgJyAnICsgdGhhdC5wb2ludGVyVXAsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIC8vIGNhbmNlbCBpZiBhbHJlYWR5IGFjdGl2ZVxuICAgICAgICAgICAgICAgIGlmIChDTVMuc2V0dGluZ3MubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGhpZGVcbiAgICAgICAgICAgICAgICB0aGF0LmhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gc2hvdyBzdHJ1Y3R1cmUgbW9kZVxuICAgICAgICAgICAgbW9kZXMuZXEoMCkub24odGhhdC5jbGljayArICcgJyArIHRoYXQucG9pbnRlclVwLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAvLyBjYW5jZWwgaWYgYWxyZWFkeSBhY3RpdmVcbiAgICAgICAgICAgICAgICBpZiAoQ01TLnNldHRpbmdzLm1vZGUgPT09ICdzdHJ1Y3R1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHNob3dcbiAgICAgICAgICAgICAgICB0aGF0LnNob3coKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBrZXlib2FyZCBoYW5kbGluZ1xuICAgICAgICAgICAgLy8gb25seSBpZiB0aGVyZSBpcyBhIHN0cnVjdHVyZSAvIGNvbnRlbnQgc3dpdGNoZXJcbiAgICAgICAgICAgIGlmICh0aGF0LnVpLnRvb2xiYXJNb2RlU3dpdGNoZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5kb2Mub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBoYXZlIGFuIGltcG9ydGFudCBmb2N1c1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGF2ZUZvY3VzZWRGaWVsZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IGRvY3VtZW50LmJvZHk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IENNUy5LRVlTLlNQQUNFICYmICFoYXZlRm9jdXNlZEZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ01TLnNldHRpbmdzLm1vZGUgPT09ICdzdHJ1Y3R1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKENNUy5zZXR0aW5ncy5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93cyB0aGUgc3RydWN0dXJlYm9hcmQuIChTdHJ1Y3R1cmUgbW9kZSlcbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBzaG93XG4gICAgICAgICAqIEBwdWJsaWNcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBpbml0IHRydWUgaWYgdGhpcyBpcyBmaXJzdCBpbml0aWFsaXphdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc2hvdzogZnVuY3Rpb24gKGluaXQpIHtcbiAgICAgICAgICAgIC8vIGNhbmNlbCBzaG93IGlmIGxpdmUgbW9kdXMgaXMgYWN0aXZlXG4gICAgICAgICAgICBpZiAoQ01TLmNvbmZpZy5tb2RlID09PSAnbGl2ZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGluIG9yZGVyIHRvIGdldCBjb25zaXN0ZW50IHBvc2l0aW9uaW5nXG4gICAgICAgICAgICAvLyBvZiB0aGUgdG9vbGJhciB3ZSBoYXZlIHRvIGtub3cgaWYgdGhlIHBhZ2VcbiAgICAgICAgICAgIC8vIGhhZCB0aGUgc2Nyb2xsYmFyIG5hZCBpZiBpdCBoYWQgLSB3ZSBhZGp1c3RcbiAgICAgICAgICAgIC8vIHRoZSB0b29sYmFyIHBvc2l0aW9uaW5nXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB0aGlzLnVpLnRvb2xiYXIud2lkdGgoKTtcbiAgICAgICAgICAgIHZhciBzY3JvbGxCYXJXaWR0aCA9IHRoaXMudWkud2luZG93WzBdLmlubmVyV2lkdGggLSB3aWR0aDtcbiAgICAgICAgICAgIGlmIChzY3JvbGxCYXJXaWR0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMudWkudG9vbGJhci5jc3MoJ3JpZ2h0Jywgc2Nyb2xsQmFyV2lkdGgpO1xuICAgICAgICAgICAgICAgIHRoaXMudWkudG9vbGJhclRyaWdnZXIuY3NzKCdyaWdodCcsIHNjcm9sbEJhcldpZHRoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2V0IGFjdGl2ZSBpdGVtXG4gICAgICAgICAgICB2YXIgbW9kZXMgPSB0aGlzLnVpLnRvb2xiYXJNb2RlTGlua3M7XG4gICAgICAgICAgICBtb2Rlcy5yZW1vdmVDbGFzcygnY21zLWJ0bi1hY3RpdmUnKS5lcSgwKS5hZGRDbGFzcygnY21zLWJ0bi1hY3RpdmUnKTtcbiAgICAgICAgICAgIHRoaXMudWkuaHRtbC5yZW1vdmVDbGFzcygnY21zLXN0cnVjdHVyZS1tb2RlLWNvbnRlbnQnKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnY21zLXN0cnVjdHVyZS1tb2RlLXN0cnVjdHVyZScpO1xuXG4gICAgICAgICAgICAvLyBhcHBseSBuZXcgc2V0dGluZ3NcbiAgICAgICAgICAgIENNUy5zZXR0aW5ncy5tb2RlID0gJ3N0cnVjdHVyZSc7XG4gICAgICAgICAgICBpZiAoIWluaXQpIHtcbiAgICAgICAgICAgICAgICBDTVMuc2V0dGluZ3MgPSB0aGlzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGVuc3VyZSBhbGwgZWxlbWVudHMgYXJlIHZpc2libGVcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2FyZWFzLnNob3coKTtcblxuICAgICAgICAgICAgLy8gc2hvdyBjYW52YXNcbiAgICAgICAgICAgIHRoaXMuX3Nob3dCb2FyZCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWRlcyB0aGUgc3RydWN0dXJlYm9hcmQuIChDb250ZW50IG1vZGUpXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgaGlkZVxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGluaXQgdHJ1ZSBpZiB0aGlzIGlzIGZpcnN0IGluaXRpYWxpemF0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBoaWRlOiBmdW5jdGlvbiAoaW5pdCkge1xuICAgICAgICAgICAgLy8gY2FuY2VsIHNob3cgaWYgbGl2ZSBtb2R1cyBpcyBhY3RpdmVcbiAgICAgICAgICAgIGlmIChDTVMuY29uZmlnLm1vZGUgPT09ICdsaXZlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gcmVzZXQgdG9vbGJhciBwb3NpdGlvbmluZ1xuICAgICAgICAgICAgdGhpcy51aS50b29sYmFyLmNzcygncmlnaHQnLCAnJyk7XG4gICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXJUcmlnZ2VyLmNzcygncmlnaHQnLCAnJyk7XG5cbiAgICAgICAgICAgIC8vIHNldCBhY3RpdmUgaXRlbVxuICAgICAgICAgICAgdmFyIG1vZGVzID0gdGhpcy51aS50b29sYmFyTW9kZUxpbmtzO1xuICAgICAgICAgICAgbW9kZXMucmVtb3ZlQ2xhc3MoJ2Ntcy1idG4tYWN0aXZlJykuZXEoMSkuYWRkQ2xhc3MoJ2Ntcy1idG4tYWN0aXZlJyk7XG4gICAgICAgICAgICB0aGlzLnVpLmh0bWwucmVtb3ZlQ2xhc3MoJ2Ntcy1zdHJ1Y3R1cmUtbW9kZS1zdHJ1Y3R1cmUnKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnY21zLXN0cnVjdHVyZS1tb2RlLWNvbnRlbnQnKTtcblxuICAgICAgICAgICAgLy8gaGlkZSBjbGlwYm9hcmQgaWYgaW4gZWRpdCBtb2RlXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuY21zLWNsaXBib2FyZCcpLmhpZGUoKTtcblxuICAgICAgICAgICAgQ01TLnNldHRpbmdzLm1vZGUgPSAnZWRpdCc7XG4gICAgICAgICAgICBpZiAoIWluaXQpIHtcbiAgICAgICAgICAgICAgICBDTVMuc2V0dGluZ3MgPSB0aGlzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGhpZGUgY2FudmFzXG4gICAgICAgICAgICB0aGlzLl9oaWRlQm9hcmQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0cyB0aGUgaWQgb2YgdGhlIGVsZW1lbnQuXG4gICAgICAgICAqIFRPRE86IHJlbGllcyBvbiBjbXMte2l0ZW19LXtpZH0gdG8gYWx3YXlzIGJlIHNlY29uZCBpbiBhIHN0cmluZyBvZiBjbGFzc2VzXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgZ2V0SWRcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGVsIGVsZW1lbnQgdG8gZ2V0IGlkIGZyb21cbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0SWQ6IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgLy8gY2FuY2VsIGlmIG5vIGVsZW1lbnQgaXMgZGVmaW5lZFxuICAgICAgICAgICAgaWYgKGVsID09PSB1bmRlZmluZWQgfHwgZWwgPT09IG51bGwgfHwgZWwubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpZCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgY2xzID0gZWwuYXR0cignY2xhc3MnKS5zcGxpdCgnICcpWzFdO1xuXG4gICAgICAgICAgICBpZiAoZWwuaGFzQ2xhc3MoJ2Ntcy1wbHVnaW4nKSkge1xuICAgICAgICAgICAgICAgIGlkID0gY2xzLnJlcGxhY2UoJ2Ntcy1wbHVnaW4tJywgJycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbC5oYXNDbGFzcygnY21zLWRyYWdnYWJsZScpKSB7XG4gICAgICAgICAgICAgICAgaWQgPSBjbHMucmVwbGFjZSgnY21zLWRyYWdnYWJsZS0nLCAnJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsLmhhc0NsYXNzKCdjbXMtcGxhY2Vob2xkZXInKSkge1xuICAgICAgICAgICAgICAgIGlkID0gY2xzLnJlcGxhY2UoJ2Ntcy1wbGFjZWhvbGRlci0nLCAnJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsLmhhc0NsYXNzKCdjbXMtZHJhZ2JhcicpKSB7XG4gICAgICAgICAgICAgICAgaWQgPSBjbHMucmVwbGFjZSgnY21zLWRyYWdiYXItJywgJycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbC5oYXNDbGFzcygnY21zLWRyYWdhcmVhJykpIHtcbiAgICAgICAgICAgICAgICBpZCA9IGNscy5yZXBsYWNlKCdjbXMtZHJhZ2FyZWEtJywgJycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldHMgdGhlIGlkcyBvZiB0aGUgbGlzdCBvZiAgZWxlbWVudHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgZ2V0SWRzXG4gICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCBlbGVtZW50cyB0byBnZXQgaWQgZnJvbVxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmdbXX1cbiAgICAgICAgICovXG4gICAgICAgIGdldElkczogZnVuY3Rpb24gKGVscykge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGFycmF5ID0gW107XG4gICAgICAgICAgICBlbHMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgYXJyYXkucHVzaCh0aGF0LmdldElkKCQodGhpcykpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBY3R1YWxseSBzaG93cyB0aGUgYm9hcmQgY2FudmFzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zaG93Qm9hcmRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zaG93Qm9hcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgLy8gc2hvdyBjb250YWluZXJcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLnNob3coKTtcbiAgICAgICAgICAgIHRoaXMudWkuZHJhZ2FyZWFzLmNzcygnb3BhY2l0eScsIDEpO1xuXG4gICAgICAgICAgICB0aGlzLnVpLnBsdWdpbnMubm90KHRoaXMudWkucmVuZGVyX21vZGVsKS5oaWRlKCk7XG4gICAgICAgICAgICB0aGlzLnVpLnBsYWNlaG9sZGVycy5zaG93KCk7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCBldmVudFxuICAgICAgICAgICAgaWYgKENNUy5jb25maWcuc2ltcGxlU3RydWN0dXJlQm9hcmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IHRoaXMudWkuY29udGVudDtcbiAgICAgICAgICAgICAgICB2YXIgYXJlYXMgPSBjb250ZW50LmZpbmQoJy5jbXMtZHJhZ2FyZWEnKTtcbiAgICAgICAgICAgICAgICAvLyBzZXQgY29ycmVjdCBjc3MgYXR0cmlidXRlcyBmb3IgdGhlIG5ldyBtb2RlXG4gICAgICAgICAgICAgICAgY29udGVudC5hZGRDbGFzcygnY21zLXN0cnVjdHVyZS1jb250ZW50LXNpbXBsZScpO1xuICAgICAgICAgICAgICAgIGFyZWFzLmFkZENsYXNzKCdjbXMtZHJhZ2FyZWEtc2ltcGxlJyk7XG4gICAgICAgICAgICAgICAgLy8gbGV0cyByZW9yZGVyIHBsYWNlaG9sZGVyc1xuICAgICAgICAgICAgICAgIGFyZWFzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKGl0ZW0pLmhhc0NsYXNzKCdjbXMtZHJhZ2FyZWEtc3RhdGljJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gbm93IGxldHMgZ2V0IHRoZSBmaXJzdCBpbnN0YW5jZSBhbmQgYWRkIHNvbWUgcGFkZGluZ1xuICAgICAgICAgICAgICAgIGFyZWFzLmZpbHRlcignLmNtcy1kcmFnYXJlYS1zdGF0aWMnKS5lcSgwKS5jc3MoJ21hcmdpbi10b3AnLCAnNTBweCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5hZGRDbGFzcygnY21zLXN0cnVjdHVyZS1keW5hbWljJyk7XG4gICAgICAgICAgICAgICAgdGhpcy51aS53aW5kb3cub24oJ3Jlc2l6ZS5zaWRlZnJhbWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3Jlc2l6ZUJvYXJkKCk7XG4gICAgICAgICAgICAgICAgfSkudHJpZ2dlcigncmVzaXplLnNpZGVmcmFtZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWRlcyB0aGUgYm9hcmQgY2FudmFzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9oaWRlQm9hcmRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9oaWRlQm9hcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGhpZGUgZWxlbWVudHNcbiAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgICAgIHRoaXMudWkucGx1Z2lucy5zaG93KCk7XG4gICAgICAgICAgICB0aGlzLnVpLnBsYWNlaG9sZGVycy5oaWRlKCk7XG5cbiAgICAgICAgICAgIC8vIGRldGFjaCBldmVudFxuICAgICAgICAgICAgdGhpcy51aS53aW5kb3cub2ZmKCdyZXNpemUuc2lkZWZyYW1lJyk7XG5cbiAgICAgICAgICAgIHRoaXMudWkud2luZG93LnRyaWdnZXIoJ3N0cnVjdHVyZWJvYXJkX2hpZGRlbi5zaWRlZnJhbWUnKTtcblxuICAgICAgICAgICAgLy8gdGhpcyBpcyBzb21ldGltZXMgcmVxdWlyZWQgZm9yIHVzZXItc2lkZSBzY3JpcHRzIHRvXG4gICAgICAgICAgICAvLyByZW5kZXIgZHluYW1pYyBlbGVtZW50cyBvbiB0aGUgcGFnZSBjb3JyZWN0bHkuXG4gICAgICAgICAgICAvLyBlLmcuIHlvdSBoYXZlIGEgcGFyYWxsYXggc2NyaXB0IHRoYXQgY2FsY3VsYXRlcyBwb3NpdGlvblxuICAgICAgICAgICAgLy8gb2YgZWxlbWVudHMgYmFzZWQgb24gZG9jdW1lbnQgaGVpZ2h0LiBidXQgaWYgdGhlIHBhZ2UgaXNcbiAgICAgICAgICAgIC8vIGxvYWRlZCB3aXRoIHN0cnVjdHVyZWJvYXJkIGFjdGl2ZSAtIHRoZSBkb2N1bWVudCBoZWlnaHRcbiAgICAgICAgICAgIC8vIHdvdWxkIGJlIHNhbWUgYXMgc2NyZWVuIGhlaWdodCwgd2hpY2ggaXMgbGlrZWx5IGluY29ycmVjdCxcbiAgICAgICAgICAgIC8vIHNvIHRyaWdnZXJpbmcgcmVzaXplIG9uIHdpbmRvdyB3b3VsZCBmb3JjZSB1c2VyIHNjcmlwdHNcbiAgICAgICAgICAgIC8vIHRvIHJlY2FsY3VsYXRlIHdoYXRldmVyIGlzIHJlcXVpcmVkIHRoZXJlXG4gICAgICAgICAgICB0aGlzLnVpLndpbmRvdy50cmlnZ2VyKCdyZXNpemUnKTtcblxuICAgICAgICAgICAgaWYgKCFDTVMuY29uZmlnLnNpbXBsZVN0cnVjdHVyZUJvYXJkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIuaGVpZ2h0KHRoaXMudWkuZG9jLm91dGVySGVpZ2h0KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXNpemVzIHRoZSBwbGFjZWhvbGRlciB0byBmaXQgdGhlaXIgcGxhY2VtZW50XG4gICAgICAgICAqIGFuZCB0aGUgc3RydWN0dXJlIGJvYXJkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9yZXNpemVCb2FyZFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAZGVwcmVjYXRlZCBhcyBvZiBDTVMgMy4yXG4gICAgICAgICAqL1xuICAgICAgICBfcmVzaXplQm9hcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwbGFjZWhvbGRlciBwb3NpdGlvblxuICAgICAgICAgICAgdmFyIGlkID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBhcmVhID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBtaW4gPSBudWxsO1xuICAgICAgICAgICAgdmFyIGFyZWFQYXJlbnRPZmZzZXQgPSBudWxsO1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBoYXZlIHRvIGRlbGF5IHNpbmNlIGhlaWdodCBjaGFuZ2VzIHdoZW4gdG9nZ2xpbmcgbW9kZXNcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQudWkuY29udGFpbmVyLmhlaWdodCh0aGF0LnVpLmRvYy5vdXRlckhlaWdodCgpKTtcbiAgICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgICAgICAvLyBzdGFydCBjYWxjdWxhdGluZ1xuICAgICAgICAgICAgdGhpcy51aS5wbGFjZWhvbGRlcnMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtID0gJChpdGVtKTtcbiAgICAgICAgICAgICAgICBpZCA9IGl0ZW0uZGF0YSgnc2V0dGluZ3MnKS5wbGFjZWhvbGRlcl9pZDtcbiAgICAgICAgICAgICAgICBhcmVhID0gJCgnLmNtcy1kcmFnYXJlYS0nICsgaWQpO1xuICAgICAgICAgICAgICAgIC8vIHRvIGNhbGN1bGF0ZSB0aGUgY29ycmVjdCBvZmZzZXQsIHdlIG5lZWQgdG8gc2V0IHRoZVxuICAgICAgICAgICAgICAgIC8vIHBsYWNlaG9sZGVycyBjb3JyZWN0IGhlaWdodHMgYW5kIHRoYW4gc2V0IHRoZSBhY2NvcmRpbmcgcG9zaXRpb25cbiAgICAgICAgICAgICAgICBpdGVtLmhlaWdodChhcmVhLm91dGVySGVpZ2h0KHRydWUpKTtcbiAgICAgICAgICAgICAgICAvLyBzZXQgbWluIHdpZHRoXG4gICAgICAgICAgICAgICAgbWluID0gKGl0ZW0ud2lkdGgoKSkgPyAwIDogMTUwO1xuICAgICAgICAgICAgICAgIC8vIGFzIGFyZWEgaXMgXCJjc3MgcG9zaXRpb25lZFwiIGFuZCBqcXVlcnkgb2Zmc2V0IGZ1bmN0aW9uIGlzIHJlbGF0aXZlIHRvIHRoZVxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50IChub3QgdGhlIGZpcnN0IHJlbGF0aXZlL2Fic29sdXRlIHBhcmVudCkgd2UgbmVlZCB0byBzdWJzdHJhY3RcbiAgICAgICAgICAgICAgICAvLyBmaXJzdCByZWxhdGl2ZS9hYnNvbHV0ZSBwYXJlbnQgb2Zmc2V0LlxuICAgICAgICAgICAgICAgIGFyZWFQYXJlbnRPZmZzZXQgPSAkKGFyZWEpLm9mZnNldFBhcmVudCgpLm9mZnNldCgpO1xuICAgICAgICAgICAgICAgIGFyZWEuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBpdGVtLm9mZnNldCgpLnRvcCAtIGFyZWFQYXJlbnRPZmZzZXQudG9wIC0gNSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogaXRlbS5vZmZzZXQoKS5sZWZ0IC0gYXJlYVBhcmVudE9mZnNldC5sZWZ0IC0gbWluLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogaXRlbS53aWR0aCgpICsgbWluXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyB1cCBhbGwgdGhlIHNvcnRhYmxlcy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfZHJhZ1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2RyYWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbFBsdWdpbkNvbnRhaW5lcjtcblxuICAgICAgICAgICAgdGhpcy51aS5zb3J0YWJsZXMubmVzdGVkU29ydGFibGUoe1xuICAgICAgICAgICAgICAgIGl0ZW1zOiAnPiAuY21zLWRyYWdnYWJsZTpub3QoLmNtcy1kcmFnZ2FibGUtZGlzYWJsZWQgLmNtcy1kcmFnZ2FibGUpJyxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ2Ntcy1kcm9wcGFibGUnLFxuICAgICAgICAgICAgICAgIGNvbm5lY3RXaXRoOiAnLmNtcy1kcmFnZ2FibGVzOm5vdCguY21zLWhpZGRlbiknLFxuICAgICAgICAgICAgICAgIHRvbGVyYW5jZTogJ2ludGVyc2VjdCcsXG4gICAgICAgICAgICAgICAgdG9sZXJhbmNlRWxlbWVudDogJz4gZGl2JyxcbiAgICAgICAgICAgICAgICBkcm9wT25FbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAvLyBjbG9uaW5nIGh1Z2Ugc3RydWN0dXJlIGlzIGEgcGVyZm9ybWFuY2UgbG9zcyBjb21wYXJlZCB0byBjbG9uaW5nIGp1c3QgYSBkcmFnaXRlbVxuICAgICAgICAgICAgICAgIGhlbHBlcjogZnVuY3Rpb24gY3JlYXRlSGVscGVyKGUsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNsb25lID0gaXRlbS5maW5kKCc+IC5jbXMtZHJhZ2l0ZW0nKS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICBjbG9uZS53cmFwKCc8ZGl2IGNsYXNzPVwiJyArIGl0ZW1bMF0uY2xhc3NOYW1lICsgJ1wiPjwvZGl2PicpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xvbmUucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhcHBlbmRUbzogJy5jbXMtc3RydWN0dXJlLWNvbnRlbnQnLFxuICAgICAgICAgICAgICAgIC8vIGFwcGVuZFRvOiAnLmNtcycsXG4gICAgICAgICAgICAgICAgY3Vyc29yOiAnbW92ZScsXG4gICAgICAgICAgICAgICAgY3Vyc29yQXQ6IHsgbGVmdDogLTE1LCB0b3A6IC0xNSB9LFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgekluZGV4OiA5OTk5OTk5LFxuICAgICAgICAgICAgICAgIGRlbGF5OiAxMDAsXG4gICAgICAgICAgICAgICAgdGFiU2l6ZTogMTUsXG4gICAgICAgICAgICAgICAgLy8gbmVzdGVkU29ydGFibGVcbiAgICAgICAgICAgICAgICBsaXN0VHlwZTogJ2Rpdi5jbXMtZHJhZ2dhYmxlcycsXG4gICAgICAgICAgICAgICAgZG9Ob3RDbGVhcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlTmVzdGluZ0NsYXNzOiAnY21zLWRyYWdnYWJsZS1kaXNhYmxlZCcsXG4gICAgICAgICAgICAgICAgZXJyb3JDbGFzczogJ2Ntcy1kcmFnZ2FibGUtZGlzYWxsb3dlZCcsXG4gICAgICAgICAgICAgICAgc2Nyb2xsU3BlZWQ6IDE1LFxuICAgICAgICAgICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiB0aGF0LnVpLndpbmRvdy5oZWlnaHQoKSAqIDAuMixcbiAgICAgICAgICAgICAgICBzdGFydDogZnVuY3Rpb24gKGUsIHVpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkuY29udGVudC5hdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicsICdub25lJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxQbHVnaW5Db250YWluZXIgPSB1aS5pdGVtLmNsb3Nlc3QoJy5jbXMtZHJhZ2dhYmxlcycpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmRyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2hvdyBlbXB0eVxuICAgICAgICAgICAgICAgICAgICBhY3R1YWxpemVFbXB0eVBsYWNlaG9sZGVycygpO1xuICAgICAgICAgICAgICAgICAgICAvLyBlbnN1cmUgYWxsIG1lbnVzIGFyZSBjbG9zZWRcbiAgICAgICAgICAgICAgICAgICAgQ01TLlBsdWdpbi5faGlkZVNldHRpbmdzTWVudSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBrZWVwIGluIG1pbmQgdGhhdCBjYWNoaW5nIGNtcy1kcmFnZ2FibGVzIHF1ZXJ5IG9ubHkgd29ya3NcbiAgICAgICAgICAgICAgICAgICAgLy8gYXMgbG9uZyBhcyB3ZSBkb24ndCBjcmVhdGUgdGhlbSBvbiB0aGUgZmx5XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkuc29ydGFibGVzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4oKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdjbXMtaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGZpeGVzIHBsYWNlaG9sZGVyIGhlaWdodFxuICAgICAgICAgICAgICAgICAgICB1aS5pdGVtLmFkZENsYXNzKCdjbXMtaXMtZHJhZ2dpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgdWkuaGVscGVyLmFkZENsYXNzKCdjbXMtZHJhZ2dhYmxlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1aS5pdGVtLmZpbmQoJz4gLmNtcy1kcmFnZ2FibGVzJykuY2hpbGRyZW4oKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVpLmhlbHBlci5hZGRDbGFzcygnY21zLWRyYWdnYWJsZS1zdGFjaycpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYXR0YWNoIGVzY2FwZSBldmVudCB0byBjYW5jZWwgZHJhZ2dpbmdcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5kb2Mub24oJ2tleXVwLmNtcy5pbnRlcnJ1cHQnLCBmdW5jdGlvbiAoZSwgY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBDTVMuS0VZUy5FU0MgJiYgdGhhdC5kcmFnZ2luZyB8fCBjYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnN0YXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC51aS5zb3J0YWJsZS5wcm90b3R5cGUuX21vdXNlU3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudWkuc29ydGFibGVzLnRyaWdnZXIoJ21vdXNldXAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGJlZm9yZVN0b3A6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB1aS5pdGVtLnJlbW92ZUNsYXNzKCdjbXMtaXMtZHJhZ2dpbmcgY21zLWRyYWdnYWJsZS1zdGFjaycpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLmRvYy5vZmYoJ2tleXVwLmNtcy5pbnRlcnJ1cHQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5jb250ZW50LmF0dHIoJ2RhdGEtdG91Y2gtYWN0aW9uJywgJ3Bhbi15Jyk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgaWYgaXNBbGxvd2VkIHJldHVybnMgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGF0LnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UGx1Z2luQ29udGFpbmVyID0gdWkuaXRlbS5jbG9zZXN0KCcuY21zLWRyYWdnYWJsZXMnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvcmlnaW5hbFBsdWdpbkNvbnRhaW5lci5pcyhuZXdQbHVnaW5Db250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3R1YWxpemVQbHVnaW5zQ29sbGFwc2libGVTdGF0dXMobmV3UGx1Z2luQ29udGFpbmVyLmFkZChvcmlnaW5hbFBsdWdpbkNvbnRhaW5lcikpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgbW92ZWQgaW5zaWRlIHNhbWUgY29udGFpbmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnV0IGV2ZW50IGlzIGZpcmVkIG9uIGEgcGFyZW50LCBkaXNjYXJkIHVwZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXdQbHVnaW5Db250YWluZXIuaXModGhpcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBwYXNzIHRoZSBpZCB0byB0aGUgdXBkYXRlciB3aGljaCBjaGVja3Mgd2l0aGluIHRoZSBiYWNrZW5kIHRoZSBjb3JyZWN0IHBsYWNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoYXQuZ2V0SWQodWkuaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwbHVnaW4gPSAkKCcuY21zLXBsdWdpbi0nICsgaWQpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHdlIGNvcHkvcGFzdGUgYSBwbHVnaW4gb3Igbm90XG4gICAgICAgICAgICAgICAgICAgIGlmIChwbHVnaW4uY2xvc2VzdCgnLmNtcy1jbGlwYm9hcmQnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbi50cmlnZ2VyKCdjbXMucGx1Z2luLnVwZGF0ZScpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGx1Z2luLnRyaWdnZXIoJ2Ntcy5wbHVnaW5zLnVwZGF0ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgcGxhY2Vob2xkZXIgd2l0aG91dCBlbnRyaWVzXG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkuc29ydGFibGVzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4oKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdjbXMtaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGFjdHVhbGl6ZUVtcHR5UGxhY2Vob2xkZXJzKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpc0FsbG93ZWQ6IGZ1bmN0aW9uIChwbGFjZWhvbGRlciwgcGxhY2Vob2xkZXJQYXJlbnQsIG9yaWdpbmFsSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgaWYgYWN0aW9uIGlzIGV4ZWN1dGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChDTVMuQVBJLmxvY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldHRpbmcgcmVzdHJpY3Rpb24gYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJvdW5kcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1tZWRpYXRlUGFyZW50VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2F2ZSBvcmlnaW5hbCBzdGF0ZSBldmVudHNcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsID0gJCgnLmNtcy1wbHVnaW4tJyArIHRoYXQuZ2V0SWQob3JpZ2luYWxJdGVtKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCBpZiBpdGVtIGhhcyBubyBzZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoID09PSAwIHx8IG9yaWdpbmFsLmRhdGEoJ3NldHRpbmdzJykgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50X2JvdW5kcyA9ICQuZ3JlcChvcmlnaW5hbC5kYXRhKCdzZXR0aW5ncycpLnBsdWdpbl9wYXJlbnRfcmVzdHJpY3Rpb24sIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGNhc2Ugd2hlbiBQbGFjZWhvbGRlclBsdWdpbiBoYXMgYSBwYXJlbnQgcmVzdHJpY3Rpb24gbmFtZWQgXCIwXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByICE9PSAnMCc7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IG9yaWdpbmFsLmRhdGEoJ3NldHRpbmdzJykucGx1Z2luX3R5cGU7XG4gICAgICAgICAgICAgICAgICAgIC8vIHByZXBhcmUgdmFyaWFibGVzIGZvciBib3VuZFxuICAgICAgICAgICAgICAgICAgICB2YXIgaG9sZGVySWQgPSB0aGF0LmdldElkKHBsYWNlaG9sZGVyLmNsb3Nlc3QoJy5jbXMtZHJhZ2FyZWEnKSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBob2xkZXIgPSAkKCcuY21zLXBsYWNlaG9sZGVyLScgKyBob2xkZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwbHVnaW47XG4gICAgICAgICAgICAgICAgICAgIGlmIChwbGFjZWhvbGRlclBhcmVudCAmJiBwbGFjZWhvbGRlclBhcmVudC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBsYWNlaG9sZGVyUGFyZW50IGlzIGFsd2F5cyBsYXRlc3QsIGl0IG1heWJlIHRoYXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzQWxsb3dlZCBpcyBjYWxsZWQgX2JlZm9yZV8gcGxhY2Vob2xkZXIgaXMgbW92ZWQgdG8gYSBjaGlsZCBwbHVnaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbiA9ICQoJy5jbXMtcGx1Z2luLScgKyB0aGF0LmdldElkKHBsYWNlaG9sZGVyUGFyZW50LmNsb3Nlc3QoJy5jbXMtZHJhZ2dhYmxlJykpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbiA9ICQoJy5jbXMtcGx1Z2luLScgKyB0aGF0LmdldElkKHBsYWNlaG9sZGVyLmNsb3Nlc3QoJy5jbXMtZHJhZ2dhYmxlJykpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdyBzZXQgdGhlIGNvcnJlY3QgYm91bmRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChob2xkZXIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBib3VuZHMgPSBob2xkZXIuZGF0YSgnc2V0dGluZ3MnKS5wbHVnaW5fcmVzdHJpY3Rpb247XG4gICAgICAgICAgICAgICAgICAgICAgICBpbW1lZGlhdGVQYXJlbnRUeXBlID0gaG9sZGVyLmRhdGEoJ3NldHRpbmdzJykucGx1Z2luX3R5cGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBsdWdpbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcyA9IHBsdWdpbi5kYXRhKCdzZXR0aW5ncycpLnBsdWdpbl9yZXN0cmljdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltbWVkaWF0ZVBhcmVudFR5cGUgPSBwbHVnaW4uZGF0YSgnc2V0dGluZ3MnKS5wbHVnaW5fdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHBhcmVudCBoYXMgY2xhc3MgZGlzYWJsZWQsIGRpc3NhbG93IGRyb3BcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBsYWNlaG9sZGVyLnBhcmVudCgpLmhhc0NsYXNzKCdjbXMtZHJhZ2dhYmxlLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHJlc3RyaWN0aW9ucyBpcyBzdGlsbCBlbXB0eSwgcHJvY2VlZFxuICAgICAgICAgICAgICAgICAgICB0aGF0LnN0YXRlID0gKCFib3VuZHMubGVuZ3RoIHx8ICQuaW5BcnJheSh0eXBlLCBib3VuZHMpICE9PSAtMSkgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgd2UgaGF2ZSBhIHBhcmVudCByZXN0cmljdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50X2JvdW5kcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc3RhdGUgPSAoJC5pbkFycmF5KGltbWVkaWF0ZVBhcmVudFR5cGUsIHBhcmVudF9ib3VuZHMpICE9PSAtMSkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC5zdGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5vbignY21zLnVwZGF0ZScsIGFjdHVhbGl6ZUVtcHR5UGxhY2Vob2xkZXJzKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBTaW1pbGFyIHRvIENNUy5QbHVnaW4gcG9wdWxhdGVzIGdsb2JhbGx5IHJlcXVpcmVkXG4gICAgICogdmFyaWFibGVzLCB0aGF0IG9ubHkgbmVlZCBxdWVyeWluZyBvbmNlLCBlLmcuIHBsYWNlaG9sZGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2luaXRpYWxpemVHbG9iYWxIYW5kbGVyc1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIENNUy5TdHJ1Y3R1cmVCb2FyZC5faW5pdGlhbGl6ZUdsb2JhbEhhbmRsZXJzID0gZnVuY3Rpb24gX2luaXRpYWxpemVHbG9iYWxIYW5kbGVycygpIHtcbiAgICAgICAgcGxhY2Vob2xkZXJzID0gJCgnLmNtcy1kcmFnYXJlYTpub3QoLmNtcy1jbGlwYm9hcmQtY29udGFpbmVycyknKTtcbiAgICB9O1xuXG4gICAgLy8gc2hvcnRoYW5kIGZvciBqUXVlcnkoZG9jdW1lbnQpLnJlYWR5KCk7XG4gICAgJChDTVMuU3RydWN0dXJlQm9hcmQuX2luaXRpYWxpemVHbG9iYWxIYW5kbGVycyk7XG5cbn0pKENNUy4kKTtcbiIsIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gTkFNRVNQQUNFU1xuLyoqXG4gKiBAbW9kdWxlIENNU1xuICovXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xudmFyIENNUyA9IHdpbmRvdy5DTVMgfHwge307XG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBUb29sYmFyXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBSZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdXNhYmxlIG5hdmlnYXRpb24gZm9yIG5hcnJvdyBzY3JlZW5zLlxuICAgICAqXG4gICAgICogQGNsYXNzIE5hdmlnYXRpb25cbiAgICAgKiBAbmFtZXNwYWNlIENNU1xuICAgICAqIEB1c2VzIENNUy5BUEkuSGVscGVyc1xuICAgICAqL1xuICAgIENNUy5OYXZpZ2F0aW9uID0gbmV3IENNUy5DbGFzcyh7XG5cbiAgICAgICAgaW1wbGVtZW50OiBbQ01TLkFQSS5IZWxwZXJzXSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICAgICAgdGhpcy5fZ2V0V2lkdGhzKCk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVGhlIHplcm8gYmFzZWQgaW5kZXggb2YgdGhlIHJpZ2h0LW1vc3QgdmlzaWJsZSBtZW51IGl0ZW0gb2YgdGhlIGxlZnQgdG9vbGJhciBwYXJ0LlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSByaWdodE1vc3RJdGVtSW5kZXgge051bWJlcn1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5yaWdodE1vc3RJdGVtSW5kZXggPSB0aGlzLml0ZW1zLmxlZnQubGVuZ3RoIC0gMTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBUaGUgemVybyBiYXNlZCBpbmRleCBvZiB0aGUgbGVmdC1tb3N0IHZpc2libGUgaXRlbSBvZiB0aGUgcmlnaHQgdG9vbGJhciBwYXJ0LlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBsZWZ0TW9zdEl0ZW1JbmRleCB7TnVtYmVyfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmxlZnRNb3N0SXRlbUluZGV4ID0gMDtcblxuICAgICAgICAgICAgdGhpcy5yZXNpemUgPSAncmVzaXplLmNtcy5uYXZpZ2F0aW9uJztcbiAgICAgICAgICAgIHRoaXMubG9hZCA9ICdsb2FkLmNtcy5uYXZpZ2F0aW9uJztcbiAgICAgICAgICAgIHRoaXMub3JpZW50YXRpb25DaGFuZ2UgPSAnb3JpZW50YXRpb25jaGFuZ2UuY21zLm5hdmlnYXRpb24nO1xuXG4gICAgICAgICAgICB0aGlzLl9ldmVudHMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FjaGUgVUkganF1ZXJ5IG9iamVjdHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3NldHVwVUlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zZXR1cFVJOiBmdW5jdGlvbiBfc2V0dXBVSSgpIHtcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSAkKCcuY21zJyk7XG4gICAgICAgICAgICB2YXIgdHJpZ2dlciA9IGNvbnRhaW5lci5maW5kKCcuY21zLXRvb2xiYXItbW9yZScpO1xuICAgICAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgICAgICB3aW5kb3c6ICQod2luZG93KSxcbiAgICAgICAgICAgICAgICB0b29sYmFyTGVmdFBhcnQ6IGNvbnRhaW5lci5maW5kKCcuY21zLXRvb2xiYXItbGVmdCcpLFxuICAgICAgICAgICAgICAgIHRvb2xiYXJSaWdodFBhcnQ6IGNvbnRhaW5lci5maW5kKCcuY21zLXRvb2xiYXItcmlnaHQnKSxcbiAgICAgICAgICAgICAgICB0cmlnZ2VyOiB0cmlnZ2VyLFxuICAgICAgICAgICAgICAgIGRyb3Bkb3duOiB0cmlnZ2VyLmZpbmQoJz4gdWwnKSxcbiAgICAgICAgICAgICAgICB0b29sYmFyVHJpZ2dlcjogY29udGFpbmVyLmZpbmQoJy5jbXMtdG9vbGJhci10cmlnZ2VyJyksXG4gICAgICAgICAgICAgICAgbG9nbzogY29udGFpbmVyLmZpbmQoJy5jbXMtdG9vbGJhci1pdGVtLWxvZ28nKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0dXAgcmVzaXplIGhhbmRsZXIgdG8gY29uc3RydWN0IHRoZSBkcm9wZG93bi5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICAgICAgdGhpcy51aS53aW5kb3cub24oXG4gICAgICAgICAgICAgICAgW3RoaXMucmVzaXplLCB0aGlzLmxvYWQsIHRoaXMub3JpZW50YXRpb25DaGFuZ2VdLmpvaW4oJyAnKSxcbiAgICAgICAgICAgICAgICBDTVMuQVBJLkhlbHBlcnMudGhyb3R0bGUoXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZVJlc2l6ZS5iaW5kKHRoaXMpLCA1MFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGN1bGF0ZXMgYWxsIHRoZSBtb3ZhYmxlIG1lbnUgaXRlbXMgd2lkdGhzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9nZXRXaWR0aHNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9nZXRXaWR0aHM6IGZ1bmN0aW9uIF9nZXRXaWR0aHMoKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0Lml0ZW1zID0ge1xuICAgICAgICAgICAgICAgIGxlZnQ6IFtdLFxuICAgICAgICAgICAgICAgIGxlZnRUb3RhbFdpZHRoOiAwLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiBbXSxcbiAgICAgICAgICAgICAgICByaWdodFRvdGFsV2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgbW9yZUJ1dHRvbldpZHRoOiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGxlZnRJdGVtcyA9IHRoYXQudWkudG9vbGJhckxlZnRQYXJ0XG4gICAgICAgICAgICAgICAgLmZpbmQoJy5jbXMtdG9vbGJhci1pdGVtLW5hdmlnYXRpb24gPiBsaTpub3QoLmNtcy10b29sYmFyLW1vcmUpJyk7XG4gICAgICAgICAgICB2YXIgcmlnaHRJdGVtcyA9IHRoYXQudWkudG9vbGJhclJpZ2h0UGFydC5maW5kKCc+IC5jbXMtdG9vbGJhci1pdGVtJyk7XG5cbiAgICAgICAgICAgIHZhciBnZXRTaXplID0gZnVuY3Rpb24gZ2V0U2l6ZShlbCwgc3RvcmUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoZWwpO1xuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9ICQoZWwpLm91dGVyV2lkdGgodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBzdG9yZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIHN1bVdpZHRocyA9IGZ1bmN0aW9uIHN1bVdpZHRocyhzdW0sIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgaXRlbS53aWR0aDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxlZnRJdGVtcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnZXRTaXplKHRoaXMsIHRoYXQuaXRlbXMubGVmdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmlnaHRJdGVtcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBnZXRTaXplKHRoaXMsIHRoYXQuaXRlbXMucmlnaHQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoYXQuaXRlbXMubGVmdFRvdGFsV2lkdGggPSB0aGF0Lml0ZW1zLmxlZnQucmVkdWNlKHN1bVdpZHRocywgMCk7XG4gICAgICAgICAgICB0aGF0Lml0ZW1zLnJpZ2h0VG90YWxXaWR0aCA9IHRoYXQuaXRlbXMucmlnaHQucmVkdWNlKHN1bVdpZHRocywgMCk7XG4gICAgICAgICAgICB0aGF0Lml0ZW1zLm1vcmVCdXR0b25XaWR0aCA9IHRoYXQudWkudHJpZ2dlci5vdXRlcldpZHRoKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGN1bGF0ZXMgYXZhaWxhYmxlIHdpZHRoIGJhc2VkIG9uIHRoZSBzdGF0ZSBvZiB0aGUgcGFnZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfY2FsY3VsYXRlQXZhaWxhYmxlV2lkdGhcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHJldHVybiB7TnVtYmVyfSBhdmFpbGFibGUgd2lkdGggaW4gcHhcbiAgICAgICAgICovXG4gICAgICAgIF9jYWxjdWxhdGVBdmFpbGFibGVXaWR0aDogZnVuY3Rpb24gX2NhbGN1bGF0ZUF2YWlsYWJsZVdpZHRoKCkge1xuICAgICAgICAgICAgdmFyIGZ1bGxXaWR0aCA9IHRoaXMudWkud2luZG93LndpZHRoKCk7XG4gICAgICAgICAgICB2YXIgcmVkdWNlID0gcGFyc2VJbnQodGhpcy51aS50b29sYmFyUmlnaHRQYXJ0LmNzcygncGFkZGluZy1yaWdodCcpLCAxMCkgKyB0aGlzLnVpLmxvZ28ub2Zmc2V0KCkubGVmdCArXG4gICAgICAgICAgICAgICAgdGhpcy51aS5sb2dvLm91dGVyV2lkdGgodHJ1ZSkgKyAxNTtcblxuICAgICAgICAgICAgcmV0dXJuIGZ1bGxXaWR0aCAtIHJlZHVjZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvd3MgdGhlIGRyb3Bkb3duLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zaG93RHJvcGRvd25cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zaG93RHJvcGRvd246IGZ1bmN0aW9uIF9zaG93RHJvcGRvd24oKSB7XG4gICAgICAgICAgICB0aGlzLnVpLnRyaWdnZXIuY3NzKCdkaXNwbGF5JywgJ2xpc3QtaXRlbScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWRlcyB0aGUgZHJvcGRvd24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2hpZGVEcm9wZG93blxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2hpZGVEcm9wZG93bjogZnVuY3Rpb24gX2hpZGVEcm9wZG93bigpIHtcbiAgICAgICAgICAgIHRoaXMudWkudHJpZ2dlci5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaWd1cmVzIG91dCBpZiB3ZSBuZWVkIHRvIHNob3cvaGlkZS9tb2RpZnkgdGhlIGRyb3Bkb3duLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9oYW5kbGVSZXNpemVcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9oYW5kbGVSZXNpemU6IGZ1bmN0aW9uIF9oYW5kbGVSZXNpemUoKSB7XG4gICAgICAgICAgICB2YXIgcmVtYWluaW5nV2lkdGg7XG4gICAgICAgICAgICB2YXIgYXZhaWxhYmxlV2lkdGggPSB0aGlzLl9jYWxjdWxhdGVBdmFpbGFibGVXaWR0aCgpO1xuXG4gICAgICAgICAgICBpZiAoYXZhaWxhYmxlV2lkdGggPiB0aGlzLml0ZW1zLmxlZnRUb3RhbFdpZHRoICsgdGhpcy5pdGVtcy5yaWdodFRvdGFsV2lkdGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93QWxsKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGZpcnN0IGhhbmRsZSB0aGUgbGVmdCBwYXJ0XG4gICAgICAgICAgICAgICAgcmVtYWluaW5nV2lkdGggPSBhdmFpbGFibGVXaWR0aCAtIHRoaXMuaXRlbXMubW9yZUJ1dHRvbldpZHRoIC0gdGhpcy5pdGVtcy5yaWdodFRvdGFsV2lkdGg7XG5cbiAgICAgICAgICAgICAgICAvLyBGaWd1cmUgb3V0IGhvdyBtYW55IG5hdiBtZW51IGl0ZW1zIGZpdCBpbnRvIHRoZSBhdmFpbGFibGUgc3BhY2UuXG4gICAgICAgICAgICAgICAgdmFyIG5ld1JpZ2h0TW9zdEl0ZW1JbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgIHdoaWxlIChyZW1haW5pbmdXaWR0aCAtIHRoaXMuaXRlbXMubGVmdFtuZXdSaWdodE1vc3RJdGVtSW5kZXggKyAxXS53aWR0aCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ1dpZHRoIC09IHRoaXMuaXRlbXMubGVmdFtuZXdSaWdodE1vc3RJdGVtSW5kZXggKyAxXS53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgbmV3UmlnaHRNb3N0SXRlbUluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5ld1JpZ2h0TW9zdEl0ZW1JbmRleCA8IHRoaXMucmlnaHRNb3N0SXRlbUluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdmVUb0Ryb3Bkb3duKHRoaXMucmlnaHRNb3N0SXRlbUluZGV4IC0gbmV3UmlnaHRNb3N0SXRlbUluZGV4KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucmlnaHRNb3N0SXRlbUluZGV4IDwgbmV3UmlnaHRNb3N0SXRlbUluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdmVPdXRPZkRyb3Bkb3duKG5ld1JpZ2h0TW9zdEl0ZW1JbmRleCAtIHRoaXMucmlnaHRNb3N0SXRlbUluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93RHJvcGRvd24oKTtcblxuICAgICAgICAgICAgICAgIC8vIGlmIHdlIGRvIG5vdCBoYXZlIGFueSB3aWR0aCBsZWZ0IGFuZCBhbGwgdGhlIGl0ZW1zIGZyb20gdGhlIGxlZnQgcGFydFxuICAgICAgICAgICAgICAgIC8vIGFyZSBhbHJlYWR5IGluIHRoZSBkcm9wZG93biAtIHN0YXJ0IHdpdGggdGhlIHJpZ2h0IHBhcnRcbiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nV2lkdGggPCAwICYmIHRoaXMucmlnaHRNb3N0SXRlbUluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdXaWR0aCArPSB0aGlzLml0ZW1zLnJpZ2h0VG90YWxXaWR0aDtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3TGVmdE1vc3RJdGVtSW5kZXggPSB0aGlzLml0ZW1zLnJpZ2h0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXN0YW5idWwgaWdub3JlIGlmOiB0aGlzIG1vdmVzIGl0ZW1zIHRvIHRoZSByaWdodCBvbmUgYnkgb25lXG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgeW91IHdhbnQgdG8gbW92ZSBpdGVtcyBmcm9tIHRoZSByaWdodCBvbmUgYnkgb25lXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVtYWluaW5nV2lkdGggLSB0aGlzLml0ZW1zLnJpZ2h0W25ld0xlZnRNb3N0SXRlbUluZGV4IC0gMV0ud2lkdGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nV2lkdGggLT0gdGhpcy5pdGVtcy5yaWdodFtuZXdMZWZ0TW9zdEl0ZW1JbmRleCAtIDFdLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0xlZnRNb3N0SXRlbUluZGV4LS07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdMZWZ0TW9zdEl0ZW1JbmRleCA+IHRoaXMubGVmdE1vc3RJdGVtSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlVG9Ecm9wZG93bihuZXdMZWZ0TW9zdEl0ZW1JbmRleCAtIHRoaXMubGVmdE1vc3RJdGVtSW5kZXgsICdyaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdMZWZ0TW9zdEl0ZW1JbmRleCA8IHRoaXMubGVmdE1vc3RJdGVtSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlT3V0T2ZEcm9wZG93bih0aGlzLmxlZnRNb3N0SXRlbUluZGV4IC0gbmV3TGVmdE1vc3RJdGVtSW5kZXgsICdyaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnV0IGZvciBub3cgd2Ugd2FudCB0byBtb3ZlIGFsbCBvZiB0aGVtIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlVG9Ecm9wZG93bihuZXdMZWZ0TW9zdEl0ZW1JbmRleCAtIHRoaXMubGVmdE1vc3RJdGVtSW5kZXgsICdyaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5kcm9wZG93bi5hZGRDbGFzcygnY21zLW1vcmUtZHJvcGRvd24tZnVsbCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd0FsbFJpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkuZHJvcGRvd24ucmVtb3ZlQ2xhc3MoJ2Ntcy1tb3JlLWRyb3Bkb3duLWZ1bGwnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpZGVzIGFuZCBlbXB0aWVzIGRyb3Bkb3duLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9zaG93QWxsXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfc2hvd0FsbDogZnVuY3Rpb24gX3Nob3dBbGwoKSB7XG4gICAgICAgICAgICB0aGlzLl9zaG93QWxsTGVmdCgpO1xuICAgICAgICAgICAgdGhpcy5fc2hvd0FsbFJpZ2h0KCk7XG4gICAgICAgICAgICB0aGlzLl9oaWRlRHJvcGRvd24oKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhbGwgaXRlbXMgaW4gdGhlIGxlZnQgcGFydCBvZiB0aGUgdG9vbGJhci5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2hvd0FsbExlZnRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zaG93QWxsTGVmdDogZnVuY3Rpb24gX3Nob3dBbGxMZWZ0KCkge1xuICAgICAgICAgICAgdGhpcy5fbW92ZU91dE9mRHJvcGRvd24oKHRoaXMuaXRlbXMubGVmdC5sZW5ndGggLSAxKSAtIHRoaXMucmlnaHRNb3N0SXRlbUluZGV4KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBhbGwgaXRlbXMgaW4gdGhlIHJpZ2h0IHBhcnQgb2YgdGhlIHRvb2xiYXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3Nob3dBbGxSaWdodFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3Nob3dBbGxSaWdodDogZnVuY3Rpb24gX3Nob3dBbGxSaWdodCgpIHtcbiAgICAgICAgICAgIHRoaXMuX21vdmVPdXRPZkRyb3Bkb3duKHRoaXMubGVmdE1vc3RJdGVtSW5kZXgsICdyaWdodCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNb3ZlcyBpdGVtcyBpbnRvIHRoZSBkcm9wZG93biwgcmVkdWNpbmcgbWVudSByaWdodC10by1sZWZ0IGluIGNhc2UgaXQncyBhIGxlZnQgcGFydCBvZiB0b29sYmFyXG4gICAgICAgICAqIGFuZCBsZWZ0LXRvLXJpZ2h0IGlmIGl0J3MgcmlnaHQgb25lLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9tb3ZlVG9Ecm9wZG93blxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gbnVtYmVyT2ZJdGVtcyBob3cgbWFueSBpdGVtcyB0byBtb3ZlIHRvIGRyb3Bkb3duXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXJ0IGZyb20gd2hpY2ggcGFydCB0byBtb3ZlIHRvIGRyb3Bkb3duIChkZWZhdWx0cyB0byBsZWZ0KVxuICAgICAgICAgKi9cbiAgICAgICAgX21vdmVUb0Ryb3Bkb3duOiBmdW5jdGlvbiBfbW92ZVRvRHJvcGRvd24obnVtYmVyT2ZJdGVtcywgcGFydCkge1xuICAgICAgICAgICAgaWYgKG51bWJlck9mSXRlbXMgPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGl0ZW07XG4gICAgICAgICAgICB2YXIgbGVmdE1vc3RJbmRleFRvTW92ZTtcbiAgICAgICAgICAgIHZhciByaWdodE1vc3RJbmRleFRvTW92ZTtcbiAgICAgICAgICAgIHZhciBpO1xuXG4gICAgICAgICAgICBpZiAocGFydCA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgICAgIC8vIE1vdmUgaXRlbXMgKHdvcmtpbmcgbGVmdC10by1yaWdodCkgZnJvbSB0aGUgdG9vbGJhciBsZWZ0IHBhcnQgdG8gdGhlIG1vcmUgbWVudS5cbiAgICAgICAgICAgICAgICBsZWZ0TW9zdEluZGV4VG9Nb3ZlID0gdGhpcy5sZWZ0TW9zdEl0ZW1JbmRleDtcbiAgICAgICAgICAgICAgICByaWdodE1vc3RJbmRleFRvTW92ZSA9IHRoaXMubGVmdE1vc3RJdGVtSW5kZXggKyBudW1iZXJPZkl0ZW1zIC0gMTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBsZWZ0TW9zdEluZGV4VG9Nb3ZlOyBpIDw9IHJpZ2h0TW9zdEluZGV4VG9Nb3ZlOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuaXRlbXMucmlnaHRbaV0uZWxlbWVudDtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmRyb3Bkb3duLnByZXBlbmQoaXRlbS53cmFwKCc8bGkgY2xhc3M9XCJjbXMtbW9yZS1idXR0b25zXCI+PC9saT4nKS5wYXJlbnQoKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5sZWZ0TW9zdEl0ZW1JbmRleCArPSBudW1iZXJPZkl0ZW1zO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBNb3ZlIGl0ZW1zICh3b3JraW5nIHJpZ2h0LXRvLWxlZnQpIGZyb20gdGhlIHRvb2xiYXIgbGVmdCBwYXJ0IHRvIHRoZSBtb3JlIG1lbnUuXG4gICAgICAgICAgICAgICAgcmlnaHRNb3N0SW5kZXhUb01vdmUgPSB0aGlzLnJpZ2h0TW9zdEl0ZW1JbmRleDtcbiAgICAgICAgICAgICAgICBsZWZ0TW9zdEluZGV4VG9Nb3ZlID0gdGhpcy5yaWdodE1vc3RJdGVtSW5kZXggLSBudW1iZXJPZkl0ZW1zICsgMTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSByaWdodE1vc3RJbmRleFRvTW92ZTsgaSA+PSBsZWZ0TW9zdEluZGV4VG9Nb3ZlOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuaXRlbXMubGVmdFtpXS5lbGVtZW50O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkuZHJvcGRvd24ucHJlcGVuZChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZmluZCgnPiB1bCcpLmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKCdjbXMtdG9vbGJhci1pdGVtLW5hdmlnYXRpb24tY2hpbGRyZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHRNb3N0SXRlbUluZGV4IC09IG51bWJlck9mSXRlbXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1vdmVzIGl0ZW1zIG91dCBvZiB0aGUgZHJvcGRvd24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX21vdmVPdXRPZkRyb3Bkb3duXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBudW1iZXJPZkl0ZW1zIGhvdyBtYW55IGl0ZW1zIHRvIG1vdmUgb3V0IG9mIHRoZSBkcm9wZG93blxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGFydCB0byB3aGljaCBwYXJ0IHRvIG1vdmUgb3V0IG9mIGRyb3Bkb3duIChkZWZhdWx0cyB0byBsZWZ0KVxuICAgICAgICAgKi9cbiAgICAgICAgX21vdmVPdXRPZkRyb3Bkb3duOiBmdW5jdGlvbiBfbW92ZU91dE9mRHJvcGRvd24obnVtYmVyT2ZJdGVtcywgcGFydCkge1xuICAgICAgICAgICAgaWYgKG51bWJlck9mSXRlbXMgPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICB2YXIgaXRlbTtcbiAgICAgICAgICAgIHZhciBsZWZ0TW9zdEluZGV4VG9Nb3ZlO1xuICAgICAgICAgICAgdmFyIHJpZ2h0TW9zdEluZGV4VG9Nb3ZlO1xuXG4gICAgICAgICAgICBpZiAocGFydCA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgICAgIC8vIE1vdmUgaXRlbXMgKHdvcmtpbmcgYm90dG9tLXRvLXRvcCkgZnJvbSB0aGUgbW9yZSBtZW51IGludG8gdGhlIHRvb2xiYXIgcmlnaHQgcGFydC5cbiAgICAgICAgICAgICAgICByaWdodE1vc3RJbmRleFRvTW92ZSA9IHRoaXMubGVmdE1vc3RJdGVtSW5kZXggLSAxO1xuICAgICAgICAgICAgICAgIGxlZnRNb3N0SW5kZXhUb01vdmUgPSB0aGlzLmxlZnRNb3N0SXRlbUluZGV4IC0gbnVtYmVyT2ZJdGVtcztcblxuICAgICAgICAgICAgICAgIGZvciAoaSA9IHJpZ2h0TW9zdEluZGV4VG9Nb3ZlOyBpID49IGxlZnRNb3N0SW5kZXhUb01vdmU7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtID0gdGhpcy5pdGVtcy5yaWdodFtpXS5lbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnVud3JhcCgnPGxpPjwvbGk+Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaXRlbS5wcmVwZW5kVG8odGhpcy51aS50b29sYmFyUmlnaHRQYXJ0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmxlZnRNb3N0SXRlbUluZGV4IC09IG51bWJlck9mSXRlbXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE1vdmUgaXRlbXMgKHdvcmtpbmcgdG9wLXRvLWJvdHRvbSkgZnJvbSB0aGUgbW9yZSBtZW51IGludG8gdGhlIHRvb2xiYXIgbGVmdCBwYXJ0LlxuICAgICAgICAgICAgICAgIGxlZnRNb3N0SW5kZXhUb01vdmUgPSB0aGlzLnJpZ2h0TW9zdEl0ZW1JbmRleCArIDE7XG4gICAgICAgICAgICAgICAgcmlnaHRNb3N0SW5kZXhUb01vdmUgPSB0aGlzLnJpZ2h0TW9zdEl0ZW1JbmRleCArIG51bWJlck9mSXRlbXM7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBsZWZ0TW9zdEluZGV4VG9Nb3ZlOyBpIDw9IHJpZ2h0TW9zdEluZGV4VG9Nb3ZlOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuaXRlbXMubGVmdFtpXS5lbGVtZW50O1xuXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uaW5zZXJ0QmVmb3JlKHRoaXMudWkudHJpZ2dlcik7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQ2xhc3MoJ2Ntcy10b29sYmFyLWl0ZW0tbmF2aWdhdGlvbi1jaGlsZHJlbicpO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmZpbmQoJz4gdWwnKS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHRNb3N0SXRlbUluZGV4ICs9IG51bWJlck9mSXRlbXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0pO1xufSkoQ01TLiQpO1xuIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOQU1FU1BBQ0VTXG4vKipcbiAqIEBtb2R1bGUgQ01TXG4gKi9cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG52YXIgQ01TID0gd2luZG93LkNNUyB8fCB7fTtcblxuLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcbi8vIFRvb2xiYXJcbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8qKlxuICAgICAqIFRoZSB0b29sYmFyIGlzIHRoZSBnZW5lcmljIGVsZW1lbnQgd2hpY2ggaG9sZHMgdmFyaW91cyBjb21wb25lbnRzXG4gICAgICogdG9nZXRoZXIgYW5kIHByb3ZpZGVzIHNldmVyYWwgY29tbW9ubHkgdXNlZCBBUEkgbWV0aG9kcyBzdWNoIGFzXG4gICAgICogc2hvdy9oaWRlLCBtZXNzYWdlIGRpc3BsYXkgb3IgbG9hZGVyIGluZGljYXRpb24uXG4gICAgICpcbiAgICAgKiBAY2xhc3MgVG9vbGJhclxuICAgICAqIEBuYW1lc3BhY2UgQ01TXG4gICAgICogQHVzZXMgQ01TLkFQSS5IZWxwZXJzXG4gICAgICovXG4gICAgQ01TLlRvb2xiYXIgPSBuZXcgQ01TLkNsYXNzKHtcblxuICAgICAgICBpbXBsZW1lbnQ6IFtDTVMuQVBJLkhlbHBlcnNdLFxuXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIHRvb2xiYXJEdXJhdGlvbjogMjAwXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgLy8gZWxlbWVudHNcbiAgICAgICAgICAgIHRoaXMuX3NldHVwVUkoKTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge0NNUy5OYXZpZ2F0aW9ufSBuYXZpZ2F0aW9uXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG5ldyBDTVMuTmF2aWdhdGlvbigpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBfcG9zaXRpb25cbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBfcG9zaXRpb24udG9wIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIHRvb2xiYXJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBfcG9zaXRpb24udG9wIHBvc2l0aW9uIHdoZW4gdG9vbGJhciBiZWNhbWUgbm9uLXN0aWNreVxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBfcG9zaXRpb24uaXNTdGlja3kgaXMgdG9vbGJhciBzdGlja3k/XG4gICAgICAgICAgICAgKiBAc2VlIF9oYW5kbGVMb25nTWVudXNcbiAgICAgICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICBzdGlja3lUb3A6IDAsXG4gICAgICAgICAgICAgICAgaXNTdGlja3k6IHRydWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIHN0YXRlc1xuICAgICAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMudG9vbGJhcic7XG4gICAgICAgICAgICB0aGlzLnRvdWNoU3RhcnQgPSAndG91Y2hzdGFydC5jbXMudG9vbGJhcic7XG4gICAgICAgICAgICB0aGlzLnBvaW50ZXJVcCA9ICdwb2ludGVydXAuY21zLnRvb2xiYXInO1xuICAgICAgICAgICAgdGhpcy5wb2ludGVyT3Zlck91dCA9ICdwb2ludGVyb3Zlci5jbXMudG9vbGJhciBwb2ludGVyb3V0LmNtcy50b29sYmFyJztcbiAgICAgICAgICAgIHRoaXMucG9pbnRlckxlYXZlID0gJ3BvaW50ZXJsZWF2ZS5jc20udG9vbGJhcic7XG4gICAgICAgICAgICB0aGlzLm1vdXNlRW50ZXIgPSAnbW91c2VlbnRlci5jbXMudG9vbGJhcic7XG4gICAgICAgICAgICB0aGlzLm1vdXNlTGVhdmUgPSAnbW91c2VsZWF2ZS5jbXMudG9vbGJhcic7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZSA9ICdyZXNpemUuY21zLnRvb2xiYXInO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGwgPSAnc2Nyb2xsLmNtcy50b29sYmFyJztcbiAgICAgICAgICAgIHRoaXMua2V5ID0gJ2tleWRvd24uY21zLnRvb2xiYXIga2V5dXAuY21zLnRvb2xiYXInO1xuXG4gICAgICAgICAgICAvLyBpc3RhbmJ1bCBpZ25vcmUgbmV4dDogZnVuY3Rpb24gaXMgYWx3YXlzIHJlYXNzaWduZWRcbiAgICAgICAgICAgIHRoaXMudGltZXIgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIHRoaXMubG9ja1Rvb2xiYXIgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy8gc2V0dXAgaW5pdGlhbCBzdHVmZlxuICAgICAgICAgICAgaWYgKCF0aGlzLnVpLnRvb2xiYXIuZGF0YSgncmVhZHknKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGSVhNRSB0aGUgZ2VuZXJhbCBpbml0aWFsaXphdGlvbiBpcyBoYW5kbGVkIHdpdGhpbiB0aGUgdG9vbGJhclxuICAgICAgICAgICAgLy8gcmF0aGVyIHRoYW4gYSBzZXBhcmF0ZSBjbXMuc2V0dXAgb3Igc2ltaWxhci4gWWV0IG90aGVyIGNvbXBvbmVudHNcbiAgICAgICAgICAgIC8vIGFyZSBsb2FkZWQgYWZ0ZXIgdGhlIHRvb2xiYXIgc28gaXQgY2FuIGNyZWF0ZSBhIGNsYXNoIHdoZXJlXG4gICAgICAgICAgICAvLyBDTVMuQVBJIGlzIG5vdCByZWFkeS4gVGhpcyBpcyBhIHdvcmthcm91bmQgdW50aWwgYSBwcm9wZXIgZml4XG4gICAgICAgICAgICAvLyB3aWxsIGJlIHJlbGVhc2VkIGluIDMueFxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5faW5pdGlhbFN0YXRlcygpO1xuICAgICAgICAgICAgfSwgMjAwKTtcblxuICAgICAgICAgICAgLy8gc2V0IGEgc3RhdGUgdG8gZGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gcmVpbml0aWFsaXplIHRoaXMuX2V2ZW50cygpO1xuICAgICAgICAgICAgdGhpcy51aS50b29sYmFyLmRhdGEoJ3JlYWR5JywgdHJ1ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyBhbGwgalF1ZXJ5IHJlZmVyZW5jZXMgd2l0aGluIGB0aGlzLnVpYC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQoJy5jbXMnKTtcbiAgICAgICAgICAgIHRoaXMudWkgPSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiBjb250YWluZXIsXG4gICAgICAgICAgICAgICAgYm9keTogJCgnaHRtbCcpLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50OiAkKGRvY3VtZW50KSxcbiAgICAgICAgICAgICAgICB3aW5kb3c6ICQod2luZG93KSxcbiAgICAgICAgICAgICAgICB0b29sYmFyOiBjb250YWluZXIuZmluZCgnLmNtcy10b29sYmFyJyksXG4gICAgICAgICAgICAgICAgdG9vbGJhclRyaWdnZXI6IGNvbnRhaW5lci5maW5kKCcuY21zLXRvb2xiYXItdHJpZ2dlcicpLFxuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25zOiBjb250YWluZXIuZmluZCgnLmNtcy10b29sYmFyLWl0ZW0tbmF2aWdhdGlvbicpLFxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IGNvbnRhaW5lci5maW5kKCcuY21zLXRvb2xiYXItaXRlbS1idXR0b25zJyksXG4gICAgICAgICAgICAgICAgbWVzc2FnZXM6IGNvbnRhaW5lci5maW5kKCcuY21zLW1lc3NhZ2VzJyksXG4gICAgICAgICAgICAgICAgc2NyZWVuQmxvY2s6IGNvbnRhaW5lci5maW5kKCcuY21zLXNjcmVlbmJsb2NrJyksXG4gICAgICAgICAgICAgICAgc3RydWN0dXJlQm9hcmQ6IGNvbnRhaW5lci5maW5kKCcuY21zLXN0cnVjdHVyZScpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMsIHN1Y2ggYXMgY2xvc2luZyBhbmQgcmVzaXppbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50IHRvIHRoZSB0cmlnZ2VyIGhhbmRsZXJcbiAgICAgICAgICAgIHRoaXMudWkudG9vbGJhclRyaWdnZXIub24odGhpcy5wb2ludGVyVXAsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoYXQudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC50cmlnZ2VyKHRoYXQuY2xpY2spO1xuICAgICAgICAgICAgfSkub24odGhpcy5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50IHRvIHRoZSBuYXZpZ2F0aW9uIGVsZW1lbnRzXG4gICAgICAgICAgICB0aGlzLnVpLm5hdmlnYXRpb25zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgbGlzdHMgPSBuYXZpZ2F0aW9uLmZpbmQoJ2xpJyk7XG4gICAgICAgICAgICAgICAgdmFyIHJvb3QgPSAnY21zLXRvb2xiYXItaXRlbS1uYXZpZ2F0aW9uJztcbiAgICAgICAgICAgICAgICB2YXIgaG92ZXIgPSAnY21zLXRvb2xiYXItaXRlbS1uYXZpZ2F0aW9uLWhvdmVyJztcbiAgICAgICAgICAgICAgICB2YXIgZGlzYWJsZWQgPSAnY21zLXRvb2xiYXItaXRlbS1uYXZpZ2F0aW9uLWRpc2FibGVkJztcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSAnY21zLXRvb2xiYXItaXRlbS1uYXZpZ2F0aW9uLWNoaWxkcmVuJztcbiAgICAgICAgICAgICAgICB2YXIgaXNUb3VjaGluZ1RvcExldmVsTWVudSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBvcGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIGNtZFByZXNzZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZXMgY2xhc3NlcyBhbmQgZXZlbnRzXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgY21kUHJlc3NlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBsaXN0cy5yZW1vdmVDbGFzcyhob3Zlcik7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RzLmZpbmQoJ3VsIHVsJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uLmZpbmQoJz4gbGknKS5vZmYodGhhdC5tb3VzZUVudGVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYodGhhdC5jbGljayk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkudG9vbGJhci5vZmYodGhhdC5jbGljaywgcmVzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLnN0cnVjdHVyZUJvYXJkLm9mZih0aGF0LmNsaWNrKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS53aW5kb3cub2ZmKHRoYXQucmVzaXplICsgJy5tZW51LnJlc2V0Jyk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX2hhbmRsZUxvbmdNZW51cygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBldmVudHMgZnJvbSBmaXJzdCBsZXZlbFxuICAgICAgICAgICAgICAgIG5hdmlnYXRpb24uZmluZCgnYScpLm9uKHRoYXQuY2xpY2sgKyAnICcgKyB0aGF0LmtleSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byByZXN0b3JlIHRoZSBkZWZhdWx0IGJlaGF2aW91ciBvbmNlIGEgdXNlclxuICAgICAgICAgICAgICAgICAgICAvLyBwcmVzc2VzIGN0cmwvY21kIGFuZCBjbGlja3Mgb24gdGhlIGVudHJ5LiBJbiB0aGlzXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhc2UgYSBuZXcgdGFiIHNob3VsZCBvcGVuLiBGaXJzdCB3ZSBkZXRlcm1pbmUgaWZcbiAgICAgICAgICAgICAgICAgICAgLy8gY3RybC9jbWQgaXMgcHJlc3NlZDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgZS5rZXlDb2RlID09PSBDTVMuS0VZUy5DTURfTEVGVCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgZS5rZXlDb2RlID09PSBDTVMuS0VZUy5DTURfUklHSFQgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIGUua2V5Q29kZSA9PT0gQ01TLktFWVMuQ01EX0ZJUkVGT1ggfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIGUua2V5Q29kZSA9PT0gQ01TLktFWVMuU0hJRlQgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIGUua2V5Q29kZSA9PT0gQ01TLktFWVMuQ1RSTFxuICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtZFByZXNzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09ICdrZXl1cCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNtZFByZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5hdHRyKCdocmVmJykgIT09ICcnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5hdHRyKCdocmVmJykgIT09ICcjJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgIWVsLnBhcmVudCgpLmhhc0NsYXNzKGRpc2FibGVkKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21kUHJlc3NlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnRyb2wgdGhlIGJlaGF2aW91ciB3aGVuIGN0cmwvY21kIGlzIHByZXNzZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLkhlbHBlcnMuX2dldFdpbmRvdygpLm9wZW4oZWwuYXR0cignaHJlZicpLCAnX2JsYW5rJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBkZWxlZ2F0ZSBhcyB1c3VhbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2RlbGVnYXRlKCQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KS5vbih0aGF0LnRvdWNoU3RhcnQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNUb3VjaGluZ1RvcExldmVsTWVudSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgY2xpY2sgc3RhdGVzXG4gICAgICAgICAgICAgICAgbGlzdHMub24odGhhdC5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsb3NlIG5hdmlnYXRpb24gb25jZSBpdCdzIHByZXNzZWQgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsLnBhcmVudCgpLmhhc0NsYXNzKHJvb3QpICYmIG9wZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQudWkuYm9keS50cmlnZ2VyKHRoYXQuY2xpY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgaWYgZWwgZG9lcyBub3QgaGF2ZSBjaGlsZHJlblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVsLmhhc0NsYXNzKGNoaWxkcmVuKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5wYXJlbnQoKS5oYXNDbGFzcyhyb290KSAmJiBlbC5oYXNDbGFzcyhob3ZlcikgfHwgZWwuaGFzQ2xhc3MoZGlzYWJsZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5hZGRDbGFzcyhob3Zlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9oYW5kbGVMb25nTWVudXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFjdGl2YXRlIGhvdmVyIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVG91Y2hpbmdUb3BMZXZlbE1lbnUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG9ubHkgc2V0IHRoZSBoYW5kbGVyIGZvciBtb3VzZW92ZXIgd2hlbiBub3QgdG91Y2hpbmcgYmVjYXVzZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1vdXNlb3ZlciBhY3R1YWxseSBpcyB0cmlnZ2VyZWQgb24gdG91Y2ggZGV2aWNlcyA6L1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbi5maW5kKCc+IGxpJykub24odGhhdC5tb3VzZUVudGVyLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIGl0ZW0gaXMgYWxyZWFkeSBhY3RpdmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcyhob3ZlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKHRoYXQuY2xpY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpc1RvdWNoaW5nVG9wTGV2ZWxNZW51ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgZG9jdW1lbnQgZXZlbnRcbiAgICAgICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vbih0aGF0LmNsaWNrLCByZXNldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudWkuc3RydWN0dXJlQm9hcmQub24odGhhdC5jbGljaywgcmVzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLnRvb2xiYXIub24odGhhdC5jbGljaywgcmVzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnVpLndpbmRvdy5vbih0aGF0LnJlc2l6ZSArICcubWVudS5yZXNldCcsIENNUy5BUEkuSGVscGVycy50aHJvdHRsZShyZXNldCwgMTAwMCkpO1xuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgc3RhdGVzXG4gICAgICAgICAgICAgICAgICAgIG9wZW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gYXR0YWNoIGhvdmVyXG4gICAgICAgICAgICAgICAgbGlzdHMub24odGhhdC5wb2ludGVyT3Zlck91dCwgJ2xpJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gZWwuY2xvc2VzdCgnLmNtcy10b29sYmFyLWl0ZW0tbmF2aWdhdGlvbi1jaGlsZHJlbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkKGVsLnBhcmVudHMoJy5jbXMtdG9vbGJhci1pdGVtLW5hdmlnYXRpb24tY2hpbGRyZW4nKSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoYXNDaGlsZHJlbiA9IGVsLmhhc0NsYXNzKGNoaWxkcmVuKSB8fCBwYXJlbnQubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBhdHRhY2ggaG92ZXIgZWZmZWN0IGlmIGRpc2FibGVkXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCBldmVudCBpZiBlbGVtZW50IGhhcyBhbHJlYWR5IGhvdmVyIGNsYXNzXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5oYXNDbGFzcyhkaXNhYmxlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwuaGFzQ2xhc3MoaG92ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc2V0XG4gICAgICAgICAgICAgICAgICAgIGxpc3RzLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoaG92ZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBob3ZlciBlZmZlY3RcbiAgICAgICAgICAgICAgICAgICAgZWwuYWRkQ2xhc3MoaG92ZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBjaGlsZHJlbiBlbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmZpbmQoJz4gdWwnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcGFyZW50IGNsYXNzXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuYWRkQ2xhc3MoaG92ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5faGFuZGxlTG9uZ01lbnVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0cy5maW5kKCd1bCB1bCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2hhbmRsZUxvbmdNZW51cygpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHN0YWxlIHN1Ym1lbnVzXG4gICAgICAgICAgICAgICAgICAgIGVsLnNpYmxpbmdzKCkuZmluZCgnPiB1bCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9KS5vbih0aGF0LmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBmaXggbGVhdmUgZXZlbnRcbiAgICAgICAgICAgICAgICBsaXN0cy5vbih0aGF0LnBvaW50ZXJMZWF2ZSwgJz4gdWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RzLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoaG92ZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCBldmVudCBmb3IgZmlyc3QgcGFnZSBwdWJsaXNoXG4gICAgICAgICAgICB0aGlzLnVpLmJ1dHRvbnMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ0biA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAvLyBpbiBjYXNlIHRoZSBidXR0b24gaGFzIGEgZGF0YS1yZWwgYXR0cmlidXRlXG4gICAgICAgICAgICAgICAgaWYgKGJ0bi5maW5kKCdhJykuYXR0cignZGF0YS1yZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBidG4ub24odGhhdC5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2RlbGVnYXRlKCQodGhpcykuZmluZCgnYScpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnRuLmZpbmQoJ2EnKS5vbih0aGF0LmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gaW4gY2FzZSBvZiB0aGUgcHVibGlzaCBidXR0b25cbiAgICAgICAgICAgICAgICBidG4uZmluZCgnLmNtcy1wdWJsaXNoLXBhZ2UnKS5vbih0aGF0LmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUNNUy5BUEkuSGVscGVycy5zZWN1cmVDb25maXJtKENNUy5jb25maWcubGFuZy5wdWJsaXNoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBidG4uZmluZCgnLmNtcy1idG4tcHVibGlzaCcpLm9uKHRoYXQuY2xpY2ssIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCBwb3N0IHJlcXVlc3QgdG8gcHJldmVudCB4c3MgYXR0YWNrc1xuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAncG9zdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogJCh0aGlzKS5wcm9wKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF0YSc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3NyZm1pZGRsZXdhcmV0b2tlbic6IENNUy5jb25maWcuY3NyZlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBDTVMuQVBJLkhlbHBlcnMubWFrZVVSTChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5IZWxwZXJzLl9nZXRXaW5kb3coKS5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtDTVMuc2V0dGluZ3MuZWRpdF9vZmYgKyAnPXRydWUnXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InOiBmdW5jdGlvbiAocmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXF1ZXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy51aS53aW5kb3cub24oXG4gICAgICAgICAgICAgICAgW3RoaXMucmVzaXplLCB0aGlzLnNjcm9sbF0uam9pbignICcpLFxuICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy50aHJvdHRsZSgkLnByb3h5KHRoaXMuX2hhbmRsZUxvbmdNZW51cywgdGhpcyksIDEwKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2UgY2hlY2sgZm9yIHZhcmlvdXMgc3RhdGVzIG9uIGxvYWQgaWYgZWxlbWVudHMgaW4gdGhlIHRvb2xiYXJcbiAgICAgICAgICogc2hvdWxkIGFwcGVhciBvciB0cmlnZ2VyIG90aGVyIGNvbXBvbmVudHMuIFRoaXMgcHJlY2VkZXMgYSB0aW1lb3V0XG4gICAgICAgICAqIHdoaWNoIGlzIG5vdCBvcHRpbWFsIGFuZCBzaG91bGQgYmUgYWRkcmVzc2VkIHNlcGFyYXRlbHkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2luaXRpYWxTdGF0ZXNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQGRlcHJlY2F0ZWQgdGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZCBub3csIGl0IHdpbGwgYmUgcmVtb3ZlZCBpbiA+IDMuMlxuICAgICAgICAgKi9cbiAgICAgICAgX2luaXRpYWxTdGF0ZXM6IGZ1bmN0aW9uIF9pbml0aWFsU3RhdGVzKCkge1xuICAgICAgICAgICAgdmFyIHB1Ymxpc2hCdG4gPSAkKCcuY21zLWJ0bi1wdWJsaXNoJykucGFyZW50KCk7XG5cbiAgICAgICAgICAgIC8vIHNldHVwIHRvb2xiYXIgdmlzaWJpbGl0eSwgd2UgbmVlZCB0byByZXZlcnNlIHRoZSBvcHRpb25zIHRvIHNldCB0aGUgY29ycmVjdCBzdGF0ZVxuICAgICAgICAgICAgaWYgKENNUy5zZXR0aW5ncy50b29sYmFyID09PSAnZXhwYW5kZWQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuKHsgZHVyYXRpb246IDAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaGlkZSBwdWJsaXNoIGJ1dHRvblxuICAgICAgICAgICAgcHVibGlzaEJ0bi5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCcuY21zLWJ0bi1wdWJsaXNoLWFjdGl2ZScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHB1Ymxpc2hCdG4uc2hvdygpO1xuICAgICAgICAgICAgICAgIHRoaXMudWkud2luZG93LnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBkZWJ1ZyBpcyB0cnVlXG4gICAgICAgICAgICBpZiAoQ01TLmNvbmZpZy5kZWJ1Zykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RlYnVnKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBtZXNzYWdlcyBhbmQgZGlzcGxheSB0aGVtXG4gICAgICAgICAgICBpZiAoQ01TLmNvbmZpZy5tZXNzYWdlcykge1xuICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IENNUy5jb25maWcubWVzc2FnZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgYXJlIGVycm9yIG1lc3NhZ2VzIGFuZCBkaXNwbGF5IHRoZW1cbiAgICAgICAgICAgIGlmIChDTVMuY29uZmlnLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogQ01TLmNvbmZpZy5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZW5mb3JjZSBvcGVuIHN0YXRlIGlmIHVzZXIgaXMgbm90IGxvZ2dlZCBpbiBidXQgcmVxdWVzdHMgdGhlIHRvb2xiYXJcbiAgICAgICAgICAgIGlmICghQ01TLmNvbmZpZy5hdXRoIHx8IENNUy5jb25maWcuc2V0dGluZ3MudmVyc2lvbiAhPT0gQ01TLnNldHRpbmdzLnZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW4oeyBkdXJhdGlvbjogMCB9KTtcbiAgICAgICAgICAgICAgICBDTVMuc2V0dGluZ3MgPSB0aGlzLnNldFNldHRpbmdzKENNUy5jb25maWcuc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzaG91bGQgc3dpdGNoZXIgaW5kaWNhdGUgdGhhdCB0aGVyZSBpcyBhbiB1bnB1Ymxpc2hlZCBwYWdlP1xuICAgICAgICAgICAgaWYgKENNUy5jb25maWcucHVibGlzaGVyKSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogQ01TLmNvbmZpZy5wdWJsaXNoZXIsXG4gICAgICAgICAgICAgICAgICAgIGRpcjogJ3JpZ2h0J1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBvcGVuIHNpZGVmcmFtZSBpZiBpdCB3YXMgcHJldmlvdXNseSBvcGVuZWRcbiAgICAgICAgICAgIGlmIChDTVMuc2V0dGluZ3Muc2lkZWZyYW1lICYmIENNUy5zZXR0aW5ncy5zaWRlZnJhbWUudXJsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNpZGVmcmFtZSA9IG5ldyBDTVMuU2lkZWZyYW1lKCk7XG4gICAgICAgICAgICAgICAgc2lkZWZyYW1lLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IENNUy5zZXR0aW5ncy5zaWRlZnJhbWUudXJsLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIHNjcmVlbmJsb2NrLCBkbyBzb21lIHJlc2l6ZSBtYWdpY1xuICAgICAgICAgICAgaWYgKHRoaXMudWkuc2NyZWVuQmxvY2subGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2NyZWVuQmxvY2soKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYWRkIHRvb2xiYXIgcmVhZHkgY2xhc3MgdG8gYm9keSBhbmQgZmlyZSBldmVudFxuICAgICAgICAgICAgdGhpcy51aS5ib2R5LmFkZENsYXNzKCdjbXMtcmVhZHknKTtcbiAgICAgICAgICAgIHRoaXMudWkuZG9jdW1lbnQudHJpZ2dlcignY21zLXJlYWR5Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvZ2dsZXMgdGhlIHRvb2xiYXIgc3RhdGU6IG9wZW4gPiBjbG9zZXMgLyBjbG9zZWQgPiBvcGVucy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCB0b2dnbGVcbiAgICAgICAgICovXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKCkge1xuICAgICAgICAgICAgLy8gdG9nZ2xlIGJhclxuICAgICAgICAgICAgaWYgKENNUy5zZXR0aW5ncy50b29sYmFyID09PSAnY29sbGFwc2VkJykge1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW5zIHRoZSB0b29sYmFyIChzbGlkZSBkb3duKS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBvcGVuXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c11cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRzLmR1cmF0aW9uXSB0aW1lIGluIG1pbGxpc2Vjb25kcyBmb3IgdG9vbGJhciB0byBhbmltYXRlXG4gICAgICAgICAqL1xuICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKG9wdHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nob3cob3B0cyk7XG5cbiAgICAgICAgICAgIC8vIHNldCBuZXcgc2V0dGluZ3NcbiAgICAgICAgICAgIENNUy5zZXR0aW5ncy50b29sYmFyID0gJ2V4cGFuZGVkJztcbiAgICAgICAgICAgIENNUy5zZXR0aW5ncyA9IHRoaXMuc2V0U2V0dGluZ3MoQ01TLnNldHRpbmdzKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW5pbWF0aW9uIGhlbHBlciBmb3Igb3BlbmluZyB0aGUgdG9vbGJhci5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2hvd1xuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdHNdXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0cy5kdXJhdGlvbl0gdGltZSBpbiBtaWxsaXNlY29uZHMgZm9yIHRvb2xiYXIgdG8gYW5pbWF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3Nob3c6IGZ1bmN0aW9uIF9zaG93KG9wdHMpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciBzcGVlZCA9IG9wdHMgJiYgb3B0cy5kdXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gb3B0cy5kdXJhdGlvbiA6IHRoaXMub3B0aW9ucy50b29sYmFyRHVyYXRpb247XG4gICAgICAgICAgICB2YXIgZGVidWdIZWlnaHQgPSAkKCcuY21zLWRlYnVnLWJhcicpLmhlaWdodCgpIHx8IDA7XG4gICAgICAgICAgICB2YXIgdG9vbGJhckhlaWdodCA9ICQoJy5jbXMtdG9vbGJhcicpLmhlaWdodCgpICsgMTA7XG5cbiAgICAgICAgICAgIHRoaXMudWkudG9vbGJhci5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uJzogJ21hcmdpbi10b3AgJyArIHNwZWVkICsgJ21zJyxcbiAgICAgICAgICAgICAgICAnbWFyZ2luLXRvcCc6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy51aS50b29sYmFyVHJpZ2dlci5hZGRDbGFzcygnY21zLXRvb2xiYXItdHJpZ2dlci1leHBhbmRlZCcpO1xuICAgICAgICAgICAgdGhpcy51aS5ib2R5LmFkZENsYXNzKCdjbXMtdG9vbGJhci1leHBhbmRpbmcnKTtcbiAgICAgICAgICAgIC8vIGFuaW1hdGUgaHRtbFxuICAgICAgICAgICAgdGhpcy51aS5ib2R5LmFuaW1hdGUoeyAnbWFyZ2luLXRvcCc6IHRvb2xiYXJIZWlnaHQgLSAxMCArIGRlYnVnSGVpZ2h0IH0sIHNwZWVkLCAnbGluZWFyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQudWkuYm9keS5yZW1vdmVDbGFzcygnY21zLXRvb2xiYXItZXhwYW5kaW5nJyk7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5ib2R5LmFkZENsYXNzKCdjbXMtdG9vbGJhci1leHBhbmRlZCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBzZXQgbWVzc2FnZXMgdG9wIHRvIHRvb2xiYXIgaGVpZ2h0XG4gICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmNzcygndG9wJywgdG9vbGJhckhlaWdodCAtIDEwKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xvc2VzIHRoZSB0b29sYmFyIChzbGlkZSB1cCkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgY2xvc2VcbiAgICAgICAgICovXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHtcbiAgICAgICAgICAgIHRoaXMuX2hpZGUoKTtcblxuICAgICAgICAgICAgLy8gc2V0IG5ldyBzZXR0aW5nc1xuICAgICAgICAgICAgQ01TLnNldHRpbmdzLnRvb2xiYXIgPSAnY29sbGFwc2VkJztcbiAgICAgICAgICAgIENNUy5zZXR0aW5ncyA9IHRoaXMuc2V0U2V0dGluZ3MoQ01TLnNldHRpbmdzKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW5pbWF0aW9uIGhlbHBlciBmb3IgY2xvc2luZyB0aGUgdG9vbGJhci5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfaGlkZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2hpZGU6IGZ1bmN0aW9uIF9oaWRlKCkge1xuICAgICAgICAgICAgdmFyIHNwZWVkID0gdGhpcy5vcHRpb25zLnRvb2xiYXJEdXJhdGlvbjtcbiAgICAgICAgICAgIHZhciB0b29sYmFySGVpZ2h0ID0gJCgnLmNtcy10b29sYmFyJykuaGVpZ2h0KCkgKyAxMDtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy51aS50b29sYmFyLmNzcygndHJhbnNpdGlvbicsICdtYXJnaW4tdG9wICcgKyBzcGVlZCArICdtcycpO1xuICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHNpZGVmcmFtZSBpcyBhY3RpdmVcbiAgICAgICAgICAgIGlmICh0aGlzLmxvY2tUb29sYmFyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIuY3NzKCdtYXJnaW4tdG9wJywgLXRvb2xiYXJIZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy51aS50b29sYmFyVHJpZ2dlci5yZW1vdmVDbGFzcygnY21zLXRvb2xiYXItdHJpZ2dlci1leHBhbmRlZCcpO1xuICAgICAgICAgICAgdGhpcy51aS5ib2R5LmFkZENsYXNzKCdjbXMtdG9vbGJhci1jb2xsYXBzaW5nJyk7XG4gICAgICAgICAgICAvLyBhbmltYXRlIGh0bWxcbiAgICAgICAgICAgIHRoaXMudWkuYm9keS5hbmltYXRlKHsgJ21hcmdpbi10b3AnOiAoQ01TLmNvbmZpZy5kZWJ1ZykgPyA1IDogMCB9LCBzcGVlZCwgJ2xpbmVhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmJvZHkucmVtb3ZlQ2xhc3MoJ2Ntcy10b29sYmFyLWV4cGFuZGVkIGNtcy10b29sYmFyLWNvbGxhcHNpbmcnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gc2V0IG1lc3NhZ2VzIHRvcCB0byAwXG4gICAgICAgICAgICB0aGlzLnVpLm1lc3NhZ2VzLmNzcygndG9wJywgMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1ha2VzIGEgcmVxdWVzdCB0byB0aGUgZ2l2ZW4gdXJsLCBydW5zIG9wdGlvbmFsIGNhbGxiYWNrcy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBvcGVuQWpheFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0c1xuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gb3B0cy51cmwgdXJsIHdoZXJlIHRoZSBhamF4IHBvaW50cyB0b1xuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdHMucG9zdF0gcG9zdCBkYXRhIHRvIGJlIHBhc3NlZCAobXVzdCBiZSBzdHJpbmdpZmllZCBKU09OKVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdHMudGV4dF0gbWVzc2FnZSB0byBiZSBkaXNwbGF5ZWRcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29wdHMuY2FsbGJhY2tdIGN1c3RvbSBjYWxsYmFjayBpbnN0ZWFkIG9mIHJlbG9hZFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdHMub25TdWNjZXNzXSByZWxvYWQgYW5kIGRpc3BsYXkgY3VzdG9tIG1lc3NhZ2VcbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbnxqUXVlcnkuRGVmZXJyZWR9IGVpdGhlciBmYWxzZSBvciBhIHByb21pc2VcbiAgICAgICAgICovXG4gICAgICAgIG9wZW5BamF4OiBmdW5jdGlvbiAob3B0cykge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgLy8gdXJsLCBwb3N0LCB0ZXh0LCBjYWxsYmFjaywgb25TdWNjZXNzXG4gICAgICAgICAgICB2YXIgdXJsID0gb3B0cy51cmw7XG4gICAgICAgICAgICB2YXIgcG9zdCA9IG9wdHMucG9zdCB8fCAne30nO1xuICAgICAgICAgICAgdmFyIHRleHQgPSBvcHRzLnRleHQgfHwgJyc7XG4gICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBvcHRzLmNhbGxiYWNrO1xuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IG9wdHMub25TdWNjZXNzO1xuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gKHRleHQpID8gQ01TLkFQSS5IZWxwZXJzLnNlY3VyZUNvbmZpcm0odGV4dCkgOiB0cnVlO1xuXG4gICAgICAgICAgICAvLyBjYW5jZWwgaWYgcXVlc3Rpb24gaGFzIGJlZW4gZGVuaWVkXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzZXQgbG9hZGVyXG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkZXIoKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04ucGFyc2UocG9zdClcbiAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0aGF0LCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZUxvYWRlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob25TdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKG9uU3VjY2VzcywgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbG9hZFxuICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLkhlbHBlcnMucmVsb2FkQnJvd3NlcihmYWxzZSwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGpxWEhSKSB7XG4gICAgICAgICAgICAgICAgQ01TLkFQSS5sb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIENNUy5BUEkuTWVzc2FnZXMub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGpxWEhSLnJlc3BvbnNlVGV4dCArICcgfCAnICsganFYSFIuc3RhdHVzICsgJyAnICsganFYSFIuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93cyB0aGUgbG9hZGVyIHNwaW5uZXIgb24gdGhlIHRyaWdnZXIga25vYiBmb3IgdGhlIHRvb2xiYXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2Qgc2hvd0xvYWRlclxuICAgICAgICAgKi9cbiAgICAgICAgc2hvd0xvYWRlcjogZnVuY3Rpb24gc2hvd0xvYWRlcigpIHtcbiAgICAgICAgICAgIHRoaXMudWkudG9vbGJhclRyaWdnZXIuYWRkQ2xhc3MoJ2Ntcy10b29sYmFyLWxvYWRlcicpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWRlcyB0aGUgbG9hZGVyIHNwaW5uZXIgb24gdGhlIHRyaWdnZXIga25vYiBmb3IgdGhlIHRvb2xiYXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgaGlkZUxvYWRlclxuICAgICAgICAgKi9cbiAgICAgICAgaGlkZUxvYWRlcjogZnVuY3Rpb24gaGlkZUxvYWRlcigpIHtcbiAgICAgICAgICAgIHRoaXMudWkudG9vbGJhclRyaWdnZXIucmVtb3ZlQ2xhc3MoJ2Ntcy10b29sYmFyLWxvYWRlcicpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWxlZ2F0ZXMgZXZlbnQgZnJvbSBlbGVtZW50IHRvIGFwcHJvcHJpYXRlIGZ1bmN0aW9uYWxpdGllcy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfZGVsZWdhdGVcbiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGVsIHRyaWdnZXIgZWxlbWVudFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2RlbGVnYXRlOiBmdW5jdGlvbiBfZGVsZWdhdGUoZWwpIHtcbiAgICAgICAgICAgIC8vIHNhdmUgbG9jYWwgdmFyc1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGVsLmRhdGEoJ3JlbCcpO1xuICAgICAgICAgICAgaWYgKGVsLmhhc0NsYXNzKCdjbXMtYnRuLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAodGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbW9kYWwnOlxuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kYWwgPSBuZXcgQ01TLk1vZGFsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGVsLmRhdGEoJ29uLWNsb3NlJylcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBlbC5hdHRyKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZWwuZGF0YSgnbmFtZScpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdtZXNzYWdlJzpcbiAgICAgICAgICAgICAgICAgICAgQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVsLmRhdGEoJ3RleHQnKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2lkZWZyYW1lJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNpZGVmcmFtZSA9IG5ldyBDTVMuU2lkZWZyYW1lKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGVsLmRhdGEoJ29uLWNsb3NlJylcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNpZGVmcmFtZS5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZWwuYXR0cignaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnYWpheCc6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbkFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBlbC5hdHRyKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0OiBKU09OLnN0cmluZ2lmeShlbC5kYXRhKCdwb3N0JykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZWwuZGF0YSgndGV4dCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBlbC5kYXRhKCdvbi1zdWNjZXNzJylcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5fZ2V0V2luZG93KCkubG9jYXRpb24uaHJlZiA9IGVsLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTG9ja3MgdGhlIHRvb2xiYXIgc28gaXQgY2Fubm90IGJlIGNsb3NlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfbG9ja1xuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGxvY2sgdHJ1ZSBpZiB0aGUgdG9vbGJhciBzaG91bGQgYmUgbG9ja2VkXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfbG9jazogZnVuY3Rpb24gX2xvY2sobG9jaykge1xuICAgICAgICAgICAgaWYgKGxvY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2tUb29sYmFyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvLyBtYWtlIGJ1dHRvbiBsb29rIGRpc2FibGVkXG4gICAgICAgICAgICAgICAgdGhpcy51aS50b29sYmFyVHJpZ2dlci5jc3MoJ29wYWNpdHknLCAwLjIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2tUb29sYmFyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgLy8gbWFrZSBidXR0b24gbG9vayBkaXNhYmxlZFxuICAgICAgICAgICAgICAgIHRoaXMudWkudG9vbGJhclRyaWdnZXIuY3NzKCdvcGFjaXR5JywgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIGRlYnVnIGJhciB3aGVuIGBERUJVRz10cnVlYCBvbiB0b3Agb2YgdGhlIHRvb2xiYXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2RlYnVnXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfZGVidWc6IGZ1bmN0aW9uIF9kZWJ1ZygpIHtcbiAgICAgICAgICAgIHZhciB0aW1lb3V0ID0gMTAwMDtcbiAgICAgICAgICAgIC8vIGlzdGFuYnVsIGlnbm9yZSBuZXh0OiBmdW5jdGlvbiBhbHdheXMgcmVhc3NpZ25lZFxuICAgICAgICAgICAgdmFyIHRpbWVyID0gZnVuY3Rpb24gKCkge307XG5cbiAgICAgICAgICAgIC8vIGJpbmQgbWVzc2FnZSBldmVudFxuICAgICAgICAgICAgdmFyIGRlYnVnID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmNtcy1kZWJ1Zy1iYXInKTtcbiAgICAgICAgICAgIGRlYnVnLm9uKHRoaXMubW91c2VFbnRlciArICcgJyArIHRoaXMubW91c2VMZWF2ZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ21vdXNlZW50ZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBDTVMuQVBJLk1lc3NhZ2VzLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IENNUy5jb25maWcubGFuZy5kZWJ1Z1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIHNob3dzIGEgZGFyayBzY3JlZW4gd2l0aCBhIG5vdGUgXCJUaGlzIHBhZ2UgaXMgYSByZWRpcmVjdFwiXG4gICAgICAgICAqIG9uIGEgcGFnZSB3aGVyZSB0aGUgc2V0dGluZ3MgaGF2ZSBiZWVuIG1vZGlmaWVkIHRvIHJlZGlyZWN0IHRvXG4gICAgICAgICAqIGFub3RoZXIgcGFnZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfc2NyZWVuQmxvY2tcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9zY3JlZW5CbG9jazogZnVuY3Rpb24gX3NjcmVlbkJsb2NrKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGludGVydmFsID0gMjA7XG4gICAgICAgICAgICB2YXIgYmxvY2tlciA9IHRoaXMudWkuc2NyZWVuQmxvY2s7XG4gICAgICAgICAgICB2YXIgc2lkZWZyYW1lID0gJCgnLmNtcy1zaWRlZnJhbWUnKTtcblxuICAgICAgICAgICAgLy8gYXV0b21hdGljYWxseSByZXNpemUgc2NyZWVuYmxvY2sgd2luZG93IGFjY29yZGluZyB0byBnaXZlbiBhdHRyaWJ1dGVzXG4gICAgICAgICAgICB0aGF0LnVpLndpbmRvdy5vbih0aGF0LnJlc2l6ZSArICcuc2NyZWVuYmxvY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgYmxvY2tlci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAnd2lkdGgnOiB0aGF0LnVpLndpbmRvdy53aWR0aCgpIC0gc2lkZWZyYW1lLndpZHRoKCksXG4gICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiB0aGF0LnVpLndpbmRvdy5oZWlnaHQoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkudHJpZ2dlcih0aGF0LnJlc2l6ZSArICcuc2NyZWVuYmxvY2snKTtcblxuICAgICAgICAgICAgLy8gc2V0IHVwZGF0ZSBpbnRlcnZhbFxuICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQudWkud2luZG93LnRyaWdnZXIodGhhdC5yZXNpemUgKyAnLnNjcmVlbmJsb2NrJyk7XG4gICAgICAgICAgICB9LCBpbnRlcnZhbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIGNhc2Ugd2hlbiBvcGVuZWQgbWVudSBkb2Vzbid0IGZpdCB0aGUgc2NyZWVuLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF9oYW5kbGVMb25nTWVudXNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9oYW5kbGVMb25nTWVudXM6IGZ1bmN0aW9uIF9oYW5kbGVMb25nTWVudXMoKSB7XG4gICAgICAgICAgICB2YXIgb3Blbk1lbnVzID0gJCgnLmNtcy10b29sYmFyLWl0ZW0tbmF2aWdhdGlvbi1ob3ZlciA+IHVsJyk7XG4gICAgICAgICAgICBpZiAoIW9wZW5NZW51cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGlja1Rvb2xiYXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwb3NpdGlvbnMgPSBvcGVuTWVudXMudG9BcnJheSgpLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoaXRlbSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQoe30sIGVsLnBvc2l0aW9uKCksIHsgaGVpZ2h0OiBlbC5oZWlnaHQoKSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHdpbmRvd0hlaWdodCA9IHRoaXMudWkud2luZG93LmhlaWdodCgpO1xuXG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbi50b3AgPSB0aGlzLnVpLndpbmRvdy5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICAgdmFyIHNob3VsZFVuc3RpY2tUb29sYmFyID0gcG9zaXRpb25zLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS50b3AgKyBpdGVtLmhlaWdodCA+IHdpbmRvd0hlaWdodDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoc2hvdWxkVW5zdGlja1Rvb2xiYXIgJiYgdGhpcy5fcG9zaXRpb24udG9wID49IHRoaXMuX3Bvc2l0aW9uLnN0aWNreVRvcCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wb3NpdGlvbi5pc1N0aWNreSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91bnN0aWNrVG9vbGJhcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RpY2tUb29sYmFyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlc2V0cyB0b29sYmFyIHRvIHRoZSBub3JtYWwgcG9zaXRpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3N0aWNrVG9vbGJhclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3N0aWNrVG9vbGJhcjogZnVuY3Rpb24gX3N0aWNrVG9vbGJhcigpIHtcbiAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uLnN0aWNreVRvcCA9IDA7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbi5pc1N0aWNreSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIucmVtb3ZlQ2xhc3MoJ2Ntcy10b29sYmFyLW5vbi1zdGlja3knKTtcbiAgICAgICAgICAgIHRoaXMudWkudG9vbGJhci5jc3Moe1xuICAgICAgICAgICAgICAgICd0b3AnOiAwLFxuICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogJydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQb3NpdGlvbnMgdG9vbGJhciBhYnNvbHV0ZWx5IHNvIHRoZSBsb25nIG1lbnVzIGNhbiBiZSBzY3JvbGxlZFxuICAgICAgICAgKiAodG9vbGJhciBnb2VzIGF3YXkgZnJvbSB0aGUgc2NyZWVuIGlmIHJlcXVpcmVkKVxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIF91bnN0aWNrVG9vbGJhclxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3Vuc3RpY2tUb29sYmFyOiBmdW5jdGlvbiBfdW5zdGlja1Rvb2xiYXIoKSB7XG4gICAgICAgICAgICB2YXIgaHRtbE1hcmdpbiA9IHBhcnNlSW50KCQoJ2h0bWwnKS5jc3MoJ21hcmdpbi10b3AnKSwgMTApO1xuXG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbi5zdGlja3lUb3AgPSB0aGlzLl9wb3NpdGlvbi50b3A7XG4gICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIuYWRkQ2xhc3MoJ2Ntcy10b29sYmFyLW5vbi1zdGlja3knKTtcbiAgICAgICAgICAgIC8vIGhhdmUgdG8gZG8gdGhlICFpbXBvcnRhbnQgYmVjYXVzZSBvZiBcImRlYnVnXCIgdG9vbGJhclxuICAgICAgICAgICAgdGhpcy51aS50b29sYmFyWzBdLnN0eWxlLnNldFByb3BlcnR5KFxuICAgICAgICAgICAgICAgICd0b3AnLFxuICAgICAgICAgICAgICAgICh0aGlzLl9wb3NpdGlvbi5zdGlja3lUb3AgKyAoQ01TLmNvbmZpZy5kZWJ1ZyA/IDUgOiAtNSkpICsgJ3B4JyxcbiAgICAgICAgICAgICAgICAnaW1wb3J0YW50J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMudWkudG9vbGJhci5jc3Moe1xuICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogLShodG1sTWFyZ2luICsgKChDTVMuY29uZmlnLmRlYnVnID8gNSA6IDApKSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24uaXNTdGlja3kgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoQ01TLiQpO1xuIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBOQU1FU1BBQ0VTXG4vKipcbiAqIEBtb2R1bGUgQ01TXG4gKi9cbnZhciBDTVMgPSB3aW5kb3cuQ01TIHx8IHt9O1xuXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gVG9vbHRpcFxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHRvb2x0aXAgaXMgdGhlIGVsZW1lbnQgd2hpY2ggc2hvd3Mgb3ZlciBwbHVnaW5zXG4gICAgICogYW5kIHN1Z2dlc3RzIGNsaWNraW5nL3RhcHBpbmcgdGhlbSB0byBlZGl0LlxuICAgICAqXG4gICAgICogQGNsYXNzIFRvb2x0aXBcbiAgICAgKiBAbmFtZXNwYWNlIENNU1xuICAgICAqL1xuICAgIENNUy5Ub29sdGlwID0gbmV3IENNUy5DbGFzcyh7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgICAgIHRoaXMuYm9keSA9ICQoJ2JvZHknKTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQXJlIHdlIG9uIHRvdWNoIGRldmljZT9cbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IGlzVG91Y2hcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5pc1RvdWNoID0gZmFsc2U7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRvb2x0aXAgRE9NIGVsZW1lbnRcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge2pRdWVyeX0gZG9tRWxlbVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmRvbUVsZW0gPSB0aGlzLl9waWNrKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2ZvcmNlVG91Y2hPbmNlID0gQ01TLkFQSS5IZWxwZXJzLm9uY2UodGhpcy5fZm9yY2VUb3VjaCk7XG4gICAgICAgICAgICB0aGlzLl9jaGVja1RvdWNoKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBmb3IgdG91Y2ggZXZlbnQgYW5kIHN3aXRjaGVzIHRvIHRvdWNoIHRvb2x0aXAgaWYgZGV0ZWN0ZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX2NoZWNrVG91Y2hcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9jaGVja1RvdWNoOiBmdW5jdGlvbiBfY2hlY2tUb3VjaCgpIHtcbiAgICAgICAgICAgIHRoaXMuYm9keS5vbmUoJ3RvdWNoc3RhcnQuY21zJywgJC5wcm94eSh0aGlzLl9mb3JjZVRvdWNoT25jZSwgdGhpcykpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGb3JjZSB0b29sdGlwIHRvIGJlIFwidG91Y2hcIi5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBfZm9yY2VUb3VjaFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX2ZvcmNlVG91Y2g6IGZ1bmN0aW9uIF9mb3JjZVRvdWNoKCkge1xuICAgICAgICAgICAgdGhpcy5pc1RvdWNoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZG9tRWxlbSA9IHRoaXMuX3BpY2soKTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIHRvb2x0aXAgZXZlbnQgZm9yIHRvdWNoIGRldmljZXNcbiAgICAgICAgICAgIHRoaXMuZG9tRWxlbS5vbigndG91Y2hzdGFydC5jbXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gJCh0aGlzKS5kYXRhKCdwbHVnaW5faWQnKTtcbiAgICAgICAgICAgICAgICB2YXIgcGx1Z2luID0gJCgnLmNtcy1wbHVnaW4tJyArIGlkKTtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBpdCBpcyBhIG5vcm1hbCBwbHVnaW4gb3IgYSBnZW5lcmljXG4gICAgICAgICAgICAgICAgaWYgKHBsdWdpbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luLnRyaWdnZXIoJ2RibGNsaWNrLmNtcycpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdlbmVyaWNzIGFyZSBhZGRlZCB0aHJvdWdoIHRoZSBjb250ZW50IG1vZGUgdmlhIHNwZWNpYWxcbiAgICAgICAgICAgICAgICAgICAgLy8gdGVtcGxhdGUgdGFncyBzb21lIGdlbmVyaWMgZWxlbWVudCBtaWdodCBiZVxuICAgICAgICAgICAgICAgICAgICAvLyBjbXMtcGx1Z2luLWNtcy1wYWdlLWNoYW5nZWxpc3QteFxuICAgICAgICAgICAgICAgICAgICB2YXIgZ2VuZXJpYyA9ICQoJy5jbXMtcGx1Z2luW2NsYXNzKj1cImNtcy1wbHVnaW4tY21zLVwiXVtjbGFzcyo9XCItJyArIGlkICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmljLmVxKDApLnRyaWdnZXIoJ2RibGNsaWNrLmNtcycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNYW5hZ2VzIHNob3cvaGlkZSBjYWxscy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBkaXNwbGF5VG9nZ2xlXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNTaG93blxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZSBldmVudCBvYmplY3RcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgY3VycmVudCBwbHVnaW4gbmFtZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgY3VycmVudCBwbHVnaW4gaWRcbiAgICAgICAgICovXG4gICAgICAgIGRpc3BsYXlUb2dnbGU6IGZ1bmN0aW9uIGRpc3BsYXlUb2dnbGUoaXNTaG93biwgZSwgbmFtZSwgaWQpIHtcbiAgICAgICAgICAgIGlzU2hvd24gPyB0aGlzLnNob3coZSwgbmFtZSwgaWQpIDogdGhpcy5oaWRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3dzIHRvb2x0aXAgd2l0aCBzcGVjaWZpYyBwbHVnaW4tcmVsYXRlZCBwYXJhbWV0ZXJzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHNob3dcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGVcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgY3VycmVudCBwbHVnaW4gbmFtZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgY3VycmVudCBwbHVnaW4gaWRcbiAgICAgICAgICovXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uIHNob3coZSwgbmFtZSwgaWQpIHtcbiAgICAgICAgICAgIHZhciB0b29sdGlwID0gdGhpcy5kb21FbGVtO1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBjaGFuZ2UgY3NzIGFuZCBhdHRyaWJ1dGVzXG4gICAgICAgICAgICB0b29sdGlwLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJylcbiAgICAgICAgICAgICAgICAuZGF0YSgncGx1Z2luX2lkJywgaWQgfHwgbnVsbClcbiAgICAgICAgICAgICAgICAuc2hvdygpXG4gICAgICAgICAgICAgICAgLmZpbmQoJ3NwYW4nKS5odG1sKG5hbWUpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbihlLm9yaWdpbmFsRXZlbnQsIHRvb2x0aXApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBhdHRhY2hlcyBtb3ZlIGV2ZW50XG4gICAgICAgICAgICAgICAgLy8gdGhpcyBzZXRzIHRoZSBjb3JyZWN0IHBvc2l0aW9uIGZvciB0aGUgZWRpdCB0b29sdGlwXG4gICAgICAgICAgICAgICAgdGhhdC5wb3NpdGlvbihlLm9yaWdpbmFsRXZlbnQsIHRvb2x0aXApO1xuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5vbignbW91c2Vtb3ZlLmNtcy50b29sdGlwJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5wb3NpdGlvbihlLCB0b29sdGlwKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlkZXMgdG9vbHRpcC5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1ldGhvZCBoaWRlXG4gICAgICAgICAqL1xuICAgICAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgICAgICAgLy8gY2hhbmdlIGNzc1xuICAgICAgICAgICAgdGhpcy5kb21FbGVtLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIC8vIHVuYmluZCBldmVudHNcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5Lm9mZignbW91c2Vtb3ZlLmNtcy50b29sdGlwJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBpY2tzIHRvb2x0aXAgdG8gc2hvdyAodG91Y2ggb3IgZGVza3RvcCkuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZXRob2QgX3BpY2tcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9waWNrOiBmdW5jdGlvbiBfcGljaygpIHtcbiAgICAgICAgICAgICQoJy5jbXMtdG9vbHRpcC10b3VjaCwgLmNtcy10b29sdGlwJykuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpLmhpZGUoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVG91Y2ggPyAkKCcuY21zLXRvb2x0aXAtdG91Y2gnKSA6ICQoJy5jbXMtdG9vbHRpcCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQb3NpdGlvbnMgdG9vbHRpcCBuZXh0IHRvIHRoZSBwb2ludGVyIGV2ZW50IGNvb3JkaW5hdGVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWV0aG9kIHBvc2l0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIGV2ZW50IG9iamVjdFxuICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gdG9vbHRpcCBlbGVtZW50XG4gICAgICAgICAqL1xuICAgICAgICBwb3NpdGlvbjogZnVuY3Rpb24gcG9zaXRpb24oZSwgdG9vbHRpcCkge1xuICAgICAgICAgICAgLy8gc28gbGV0cyBmaWd1cmUgb3V0IHdoZXJlIHdlIGFyZVxuICAgICAgICAgICAgdmFyIG9mZnNldCA9IDIwO1xuICAgICAgICAgICAgdmFyIHJlbFggPSBlLnBhZ2VYIC0gJCh0b29sdGlwKS5vZmZzZXRQYXJlbnQoKS5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgICAgdmFyIHJlbFkgPSBlLnBhZ2VZIC0gJCh0b29sdGlwKS5vZmZzZXRQYXJlbnQoKS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICB2YXIgYm91bmQgPSAkKHRvb2x0aXApLm9mZnNldFBhcmVudCgpLndpZHRoKCk7XG4gICAgICAgICAgICB2YXIgcG9zID0gcmVsWCArIHRvb2x0aXAub3V0ZXJXaWR0aCh0cnVlKSArIG9mZnNldDtcblxuICAgICAgICAgICAgdG9vbHRpcC5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQ6IChwb3MgPj0gYm91bmQpID8gcmVsWCAtIHRvb2x0aXAub3V0ZXJXaWR0aCh0cnVlKSAtIG9mZnNldCA6IHJlbFggKyBvZmZzZXQsXG4gICAgICAgICAgICAgICAgdG9wOiByZWxZIC0gMTJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59KShDTVMuJCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
=======
!function(n){"use strict";function t(){var n=document.createElement("cms"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in t)if(void 0!==n.style[i])return{end:t[i]};return!1}n.fn.emulateTransitionEnd=function(t){var i=!1,r=this;n(this).one("cmsTransitionEnd",function(){i=!0});var e=function(){i||n(r).trigger(n.support.transition.end)};return setTimeout(e,t+10),this},n(function(){n.support.transition=t(),n.support.transition&&(n.event.special.cmsTransitionEnd={bindType:n.support.transition.end,delegateType:n.support.transition.end,handle:function(t){return n(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(CMS.$);
var CMS=window.CMS||{};!function(s){"use strict";CMS.Messages=new CMS.Class({options:{messageDuration:300,messageDelay:3e3},initialize:function(e){this.options=s.extend(!0,{},this.options,e),this.click="click.cms.message",this._setupUI()},_setupUI:function(){var e=s(".cms");this.ui={container:e,body:s("html"),toolbar:e.find(".cms-toolbar"),messages:e.find(".cms-messages")}},open:function(s){if(!s||!s.message)throw new Error('The arguments passed to "open" were invalid.');var e=this,i=s.message,t=void 0===s.dir?"center":s.dir,a=void 0===s.delay?this.options.messageDelay:s.delay,o=void 0===s.error?!1:s.error,r=320,m=this.ui.messages.outerHeight(!0),n=this.ui.toolbar.outerHeight(!0),h=this.ui.messages.find(".cms-messages-close");switch(this.ui.messages.find(".cms-messages-inner").html(i),this.ui.messages.removeClass("cms-messages-error"),o&&this.ui.messages.addClass("cms-messages-error"),clearTimeout(this.timer),h.hide(),h.off(this.click).on(this.click,function(){e.close()}),"collapsed"===CMS.settings.toolbar&&(n=0),this.ui.messages.css("top",-m).show(),t){case"left":this.ui.messages.css({top:n,left:-r,right:"auto","margin-left":0}),this.ui.messages.animate({left:0});break;case"right":this.ui.messages.css({top:n,right:-r,left:"auto","margin-left":0}),this.ui.messages.animate({right:0});break;default:this.ui.messages.css({left:"50%",right:"auto","margin-left":-(r/2)}),this.ui.messages.animate({top:n})}0>=a?h.show():this.timer=setTimeout(function(){e.close()},a)},close:function(){this.ui.messages.fadeOut(this.options.messageDuration)}})}(CMS.$);
var CMS=window.CMS||{};!function(i){"use strict";CMS.Modal=new CMS.Class({implement:[CMS.API.Helpers],options:{onClose:!1,minHeight:400,minWidth:800,modalDuration:200,newPlugin:!1,resizable:!0,maximizable:!0,minimizable:!0},initialize:function(t){this.options=i.extend(!0,{},this.options,t),this._setupUI(),this._setupEventEmitter(),this.click="click.cms.modal",this.pointerDown="pointerdown.cms.modal contextmenu.cms.modal",this.pointerUp="pointerup.cms.modal pointercancel.cms.modal",this.pointerMove="pointermove.cms.modal",this.doubleClick="dblclick.cms.modal",this.touchEnd="touchend.cms.modal",this.maximized=!1,this.minimized=!1,this.triggerMaximized=!1,this.saved=!1},_setupEventEmitter:function(){function t(i){return function(){return o[i].apply(o,arguments),e}}var e=this,o=i({});this.trigger=t("trigger"),this.one=t("one"),this.on=t("on"),this.off=t("off")},_setupUI:function(){var t=i(".cms-modal");this.ui={modal:t,body:i("html"),window:i(window),toolbarLeftPart:i(".cms-toolbar-left"),minimizeButton:t.find(".cms-modal-minimize"),maximizeButton:t.find(".cms-modal-maximize"),title:t.find(".cms-modal-title"),titlePrefix:t.find(".cms-modal-title-prefix"),titleSuffix:t.find(".cms-modal-title-suffix"),resize:t.find(".cms-modal-resize"),breadcrumb:t.find(".cms-modal-breadcrumb"),closeAndCancel:t.find(".cms-modal-close, .cms-modal-cancel"),modalButtons:t.find(".cms-modal-buttons"),modalBody:t.find(".cms-modal-body"),frame:t.find(".cms-modal-frame"),shim:t.find(".cms-modal-shim")}},_events:function(){var t=this;this.ui.minimizeButton.off(this.click+" "+this.touchEnd).on(this.click+" "+this.touchEnd,function(i){i.preventDefault(),t.minimize()}),this.ui.maximizeButton.off(this.click+" "+this.touchEnd).on(this.click+" "+this.touchEnd,function(i){i.preventDefault(),t.maximize()}),this.ui.title.off(this.pointerDown).on(this.pointerDown,function(i){i.preventDefault(),t._startMove(i)}),this.ui.title.off(this.doubleClick).on(this.doubleClick,function(){t.maximize()}),this.ui.resize.off(this.pointerDown).on(this.pointerDown,function(i){i.preventDefault(),t._startResize(i)}),this.ui.closeAndCancel.off(this.click+" "+this.touchEnd).on(this.click+" "+this.touchEnd,function(i){t.options.onClose=null,i.preventDefault(),t.close()}),this.ui.breadcrumb.off(this.click,"a").on(this.click,"a",function(e){e.preventDefault(),t._changeIframe(i(this))})},open:function(t){if(!(t&&t.url||t&&t.html))throw new Error('The arguments passed to "open" were invalid.');if(CMS._newPlugin&&!this._deletePlugin())return!1;this._events(),this.trigger("cms.modal.load"),this.ui.modal.trigger("cms.modal.load"),this.ui.resize.toggle(this.options.resizable),this.ui.minimizeButton.toggle(this.options.minimizable),this.ui.maximizeButton.toggle(this.options.maximizable);var e=this._calculateNewPosition(t);return this.ui.maximizeButton.removeClass("cms-modal-maximize-active"),this.maximized=!1,this.options.newPlugin&&(CMS._newPlugin=this.options.newPlugin),this.ui.body.hasClass("cms-modal-minimized")&&(this.minimized=!0,this.minimize()),this.ui.modalButtons.empty(),this.ui.breadcrumb.empty(),this.ui.modal.removeClass("cms-modal-has-breadcrumb"),CMS.API.Tooltip.hide(),t.url?this._loadIframe({url:t.url,title:t.title,breadcrumbs:t.breadcrumbs}):this._loadMarkup({html:t.html,title:t.title,subtitle:t.subtitle}),this.trigger("cms.modal.loaded"),this._show(i.extend({duration:this.options.modalDuration},e)),this},_calculateNewPosition:function(i){var t,e,o=300,n=300,s=this.ui.window.width(),a=this.ui.window.height(),d=i.width||this.options.minWidth,l=i.height||this.options.minHeight,m=s>=d+o,r=a>=l+n,c=m&&!i.width?s-o:d,u=r&&!i.height?a-n:l,h=this.ui.modal.css("left"),f=this.ui.modal.css("top");return"50%"===h&&(h=s/2),"50%"===f&&(f=a/2),f=parseInt(f),h=parseInt(h),(c/2+h>s||u/2+f>a||0>h-c/2||0>f-u/2)&&(t=s/2,e=a/2),(c>=s||u>=a)&&(this.triggerMaximized=!0),{width:c,height:u,top:e,left:t}},_show:function(i){var t=this,e=i.width,o=i.height,n=i.duration,s=i.top,a=i.left;this.ui.modal.hasClass("cms-modal-open")&&this.ui.modal.addClass("cms-modal-morphing"),this.ui.modal.css({display:"block",width:e,height:o,top:s,left:a,"margin-left":-(e/2),"margin-top":-(o/2)}),setTimeout(function(){t.ui.modal.addClass("cms-modal-open")},0),this.ui.modal.one("cmsTransitionEnd",function(){t.ui.modal.removeClass("cms-modal-morphing"),t.ui.modal.css({"margin-left":-(e/2),"margin-top":-(o/2)}),t.triggerMaximized&&t.maximize(),CMS.API.locked=!1,t.trigger("cms.modal.shown")}).emulateTransitionEnd(n),this.ui.body.off("keydown.cms.close").on("keydown.cms.close",function(i){i.keyCode===CMS.KEYS.ESC&&(t.options.onClose=null,t.close())}),this.ui.modal.focus()},close:function(){this.options.onClose&&this.reloadBrowser(this.options.onClose,!1,!0),CMS._newPlugin?this._deletePlugin({hideAfter:!0}):this._hide({duration:this.options.modalDuration/2})},_hide:function(i){var t=this,e=this.options.modalDuration;i&&i.duration&&(e=i.duration),this.ui.frame.empty(),this.ui.modalBody.removeClass("cms-loader"),this.ui.modal.removeClass("cms-modal-open"),this.ui.modal.one("cmsTransitionEnd",function(){t.ui.modal.css("display","none")}).emulateTransitionEnd(e),setTimeout(function(){t.minimized&&t.minimize(),t.maximized&&t.maximize(),t.trigger("cms.modal.closed")},this.options.duration),this.ui.body.off("keydown.cms.close")},minimize:function(){return this.maximized?!1:void(this.minimized===!1?(CMS.API.Toolbar.open(),this.ui.modal.data("css",this.ui.modal.css(["left","top","margin-left","margin-top"])),this.ui.body.addClass("cms-modal-minimized"),this.ui.modal.css({left:this.ui.toolbarLeftPart.outerWidth(!0)+50}),this.minimized=!0):(this.ui.body.removeClass("cms-modal-minimized"),this.ui.modal.css(this.ui.modal.data("css")),this.minimized=!1))},maximize:function(){return this.minimized?!1:void(this.maximized===!1?(this.ui.modal.data("css",this.ui.modal.css(["left","top","margin-left","margin-top","width","height"])),this.ui.body.addClass("cms-modal-maximized"),this.maximized=!0,this.dispatchEvent("modal-maximized",{instance:this})):(this.ui.body.removeClass("cms-modal-maximized"),this.ui.modal.css(this.ui.modal.data("css")),this.maximized=!1,this.dispatchEvent("modal-restored",{instance:this})))},_startMove:function(i){if(this.maximized||this.minimized)return!1;var t,e,o=this,n=this.ui.modal.position();this.ui.shim.show(),this.ui.body.on(this.pointerUp,function(i){o._stopMove(i)}),this.ui.body.on(this.pointerMove,function(s){t=n.left-(i.originalEvent.pageX-s.originalEvent.pageX),e=n.top-(i.originalEvent.pageY-s.originalEvent.pageY),o.ui.modal.css({left:t,top:e})}).attr("data-touch-action","none")},_stopMove:function(){this.ui.shim.hide(),this.ui.body.off(this.pointerMove+" "+this.pointerUp).removeAttr("data-touch-action")},_startResize:function(i){if(this.maximized)return!1;var t=this,e=this.ui.modal.width(),o=this.ui.modal.height(),n=this.ui.modal.position().left,s=this.ui.modal.position().top;this.ui.body.on(this.pointerUp,function(i){t._stopResize(i)}),this.ui.shim.show(),this.ui.body.on(this.pointerMove,function(a){var d=i.originalEvent.pageX-a.originalEvent.pageX,l=i.originalEvent.pageY-a.originalEvent.pageY,m=e-2*d,r=o-2*l,c=t.options.minWidth,u=t.options.minHeight,h=d+n,f=l+s;c>=m&&(m=c,h=n+e/2-m/2),u>=r&&(r=u,f=s+o/2-r/2),t.ui.modal.css({width:m,height:r,left:h,top:f})}).attr("data-touch-action","none")},_stopResize:function(){this.ui.shim.hide(),this.ui.body.off(this.pointerMove+" "+this.pointerUp).removeAttr("data-touch-action")},_setBreadcrumb:function(t){var e="",o='<a href="{1}" class="{2}"><span>{3}</span></a>';return!t||t.length<=1?!1:t[0].title?(this.ui.modal.addClass("cms-modal-has-breadcrumb"),i.each(t,function(i,n){var s=i>=t.length-1?"active":"";e+=o.replace("{1}",n.url).replace("{2}",s).replace("{3}",n.title)}),void this.ui.breadcrumb.html(e)):!1},_setButtons:function(t){var e,o,n=t.contents().find(".suit-columns").length>0,s=this,a=i('<div class="cms-modal-item-buttons"></div>'),d=i('<div class="cms-modal-buttons-inner"></div>'),l=i('<a href="#" class="cms-btn">'+CMS.config.lang.cancel+"</a>");e=n?t.contents().find(".save-box:eq(0)"):t.contents().find(".submit-row:eq(0)");var m=t.contents().find("form");m.on("submit",function(){s.hideFrame&&(s.ui.modal.find(".cms-modal-frame iframe").hide(),s.saved=!0)});var r=e.find("input, a, button");r.on("click",function(){i(this).hasClass("default")&&(s.hideFrame=!0)}),t.contents().find(".submit-row").hide(),r.length||(e=t.contents().find("body:not(.change-list) #content form:eq(0)"),r=e.find('input[type="submit"], button[type="submit"]'),r.addClass("deletelink").hide()),r.each(function(t,e){if(e=i(e),e.attr("data-rel","_"+t),"hidden"===e.attr("type"))return!1;var o=e.attr("value")||e.text(),n="cms-btn";e.is("button")&&(o=e.text()),e.hasClass("default")&&(n="cms-btn cms-btn-action"),e.hasClass("deletelink")&&(n="cms-btn cms-btn-caution");var l=i('<a href="#" class="'+n+" "+e.attr("class")+'">'+o+"</a>");l.on(s.click+" "+s.touchEnd,function(i){i.preventDefault(),e.is("a")&&s._loadIframe({url:e.prop("href"),name:o}),(e.hasClass("default")||e.hasClass("deletelink"))&&(e.hasClass("default")?s.hideFrame=!0:(s.ui.modal.find(".cms-modal-frame iframe").hide(),s.saved=!0)),(e.is("input")||e.is("button"))&&e[0].click()}),l.wrap(a),d.append(l.parent())}),l.on(s.click,function(i){i.preventDefault(),s.options.onClose=!1,s.close()}),l.wrap(a),d.append(l.parent()),d.find(".cms-btn-group").unwrap(),o=d.find(".cms-btn-group").clone(!0,!0),d.find(".cms-btn-group").remove(),d.append(o.wrapAll(a.clone().addClass("cms-modal-item-buttons-left")).parent()),this.ui.modalButtons.html(d)},_loadIframe:function(t){var e=this;t.url=this.makeURL(t.url),t.title=t.title||"",t.breadcrumbs=t.breadcrumbs||"",CMS.API.Toolbar.showLoader(),this.ui.modal.removeClass("cms-modal-markup"),this.ui.modal.addClass("cms-modal-iframe"),this._setBreadcrumb(t.breadcrumbs);var o=this.ui.frame,n=i('<iframe src="'+t.url+'" class="" frameborder="0" />'),s=this.ui.titlePrefix,a=this.ui.titleSuffix;n.css("visibility","hidden"),s.text(t.title||""),a.text(""),o.find("iframe").css("visibility","hidden"),e.ui.modalBody.addClass("cms-loader"),n.on("load",function(){var o,d,l,m,r,c;try{n.contents()}catch(u){return CMS.API.Messages.open({message:"<strong>"+u+"</strong>",error:!0}),void e.close()}return CMS.Modal._setupCtrlEnterSave(document),n[0].contentWindow&&n[0].contentWindow.document&&CMS.Modal._setupCtrlEnterSave(n[0].contentWindow.document),n[0].contentWindow&&n[0].contentWindow.CMS&&n[0].contentWindow.CMS.CKEditor&&i(n[0].contentWindow.document).ready(function(){setTimeout(function(){var t=n[0].contentWindow.CMS.CKEditor.editor;t&&t.on("loaded",function(t){CMS.Modal._setupCtrlEnterSave(i(t.editor.container.$).find("iframe")[0].contentWindow.document)})},100)}),CMS.API.Toolbar.hideLoader(),d=n.contents().find(".messagelist"),o=d.find("li"),o.length&&CMS.API.Messages.open({message:o.eq(0).text()}),d.remove(),l=n.contents(),m=l.find("body"),m.addClass("cms-admin cms-admin-modal"),o.length&&e.enforceReload&&e.reloadBrowser(),o.length&&e.enforceClose?(e.close(),!1):(l.find(".viewsitelink").attr("target","_top"),e._setButtons(i(this)),(n.contents().find(".errornote").length||n.contents().find(".errorlist").length)&&(e.saved=!1),void(e.saved&&!l.find(".delete-confirmation").length?e.reloadBrowser(e.options.onClose?e.options.onClose:window.location.href,!1,!0):(n.show(),r=n.contents().find("#content h1:eq(0)"),void 0===t.title&&""===e.ui.titlePrefix.text()&&(c=n.contents().find(".breadcrumbs").contents(),e.ui.titlePrefix.text(c.eq(c.length-1).text().replace("›","").trim())),""===s.text().trim()?s.text(r.text()):a.text(r.text()),r.remove(),n.css("visibility","visible"),n.data("ready",!0),m.on("keydown.cms",function(i){i.keyCode===CMS.KEYS.ESC&&e.close()}),l.find(".object-tools").length&&l.find("#content").css("padding-top",38))))}),o.html(n)},_changeIframe:function(i){if(i.hasClass("active"))return!1;var t=i.parent().find("a");t.removeClass("active"),i.addClass("active"),this._loadIframe({url:i.attr("href")}),this.ui.titlePrefix.text(i.text())},_loadMarkup:function(i){this.ui.modal.removeClass("cms-modal-iframe"),this.ui.modal.addClass("cms-modal-markup"),this.ui.modalBody.removeClass("cms-loader"),this.ui.frame.empty().append(i.html),this.ui.titlePrefix.text(i.title||""),this.ui.titleSuffix.text(i.subtitle||"")},_deletePlugin:function(i){var t=this,e=CMS._newPlugin,o='{ "csrfmiddlewaretoken": "'+CMS.config.csrf+'" }',n=CMS.config.lang.confirmEmpty.replace("{1}",CMS._newPlugin.breadcrumb[CMS._newPlugin.breadcrumb.length-1].title);return CMS.API.Toolbar.openAjax({url:e["delete"],post:o,text:n,callback:function(){CMS._newPlugin=!1,i&&i.hideAfter&&t._hide({duration:100})}})}}),CMS.Modal._setupCtrlEnterSave=function(t){var e=!1,o=navigator.platform.toLowerCase().indexOf("mac")+1;i(t).on("keydown.cms.submit",function(t){t.ctrlKey&&t.keyCode===CMS.KEYS.ENTER&&!o&&i(".cms-modal-buttons .cms-btn-action:first").trigger("click"),o&&(t.keyCode!==CMS.KEYS.CMD_LEFT&&t.keyCode!==CMS.KEYS.CMD_RIGHT&&t.keyCode!==CMS.KEYS.CMD_FIREFOX||(e=!0),t.keyCode===CMS.KEYS.ENTER&&e&&i(".cms-modal-buttons .cms-btn-action:first").trigger("click"))}).on("keyup.cms.submit",function(i){o&&(i.keyCode!==CMS.KEYS.CMD_LEFT&&i.keyCode!==CMS.KEYS.CMD_RIGHT||(e=!1))})}}(CMS.$);
var CMS=window.CMS||{};!function(i){"use strict";CMS.Sideframe=new CMS.Class({implement:[CMS.API.Helpers],options:{onClose:!1,sideframeDuration:300,sideframeWidth:.8},initialize:function(s){this.options=i.extend(!0,{},this.options,s),this._setupUI(),this.click="click.cms.sideframe",this.pointerDown="pointerdown.cms.sideframe contextmenu.cms.sideframe",this.pointerUp="pointerup.cms.sideframe pointercancel.cms.sideframe",this.pointerMove="pointermove.cms.sideframe",this.enforceReload=!1,this.settingsRefreshTimer=600},_setupUI:function(){var s=i(".cms-sideframe");this.ui={sideframe:s,body:i("html"),window:i(window),dimmer:s.find(".cms-sideframe-dimmer"),close:s.find(".cms-sideframe-close"),resize:s.find(".cms-sideframe-resize"),frame:s.find(".cms-sideframe-frame"),shim:s.find(".cms-sideframe-shim"),historyBack:s.find(".cms-sideframe-history .cms-icon-arrow-back"),historyForward:s.find(".cms-sideframe-history .cms-icon-arrow-forward")}},_events:function(){var i=this;this.history={back:[],forward:[]},this.ui.close.off(this.click).on(this.click,function(){i.close()}),this.ui.resize.off(this.pointerDown).on(this.pointerDown,function(s){s.preventDefault(),i._startResize()}),this.ui.dimmer.off(this.click).on(this.click,function(){i.close()}),this.ui.historyBack.off(this.click).on(this.click,function(){return i.ui.historyBack.hasClass("cms-icon-disabled")?!1:void i._goToHistory("back")}),this.ui.historyForward.off(this.click).on(this.click,function(){return i.ui.historyForward.hasClass("cms-icon-disabled")?!1:void i._goToHistory("forward")})},open:function(i){if(!i||!i.url)throw new Error('The arguments passed to "open" were invalid.');var s=i.url,t=i.animate,e="language="+CMS.config.request.language,o="page_id="+CMS.config.request.page_id,n=[],r=window.innerWidth,a=this.ui.sideframe.outerWidth(),d=this.ui.sideframe.is(":visible");return this.ui.body.width()>=CMS.BREAKPOINTS.mobile&&(r=CMS.settings.sideframe.position||100*this.options.sideframeWidth+"%"),this._events(),this.ui.dimmer.show(),this.ui.frame.addClass("cms-loader"),CMS.API&&CMS.API.Toolbar&&CMS.API.Toolbar.showLoader(),s.indexOf(CMS.config.request.tree)>=0&&(CMS.config.request.language&&n.push(e),CMS.config.request.page_id&&n.push(o)),s=this.makeURL(s,n),this._content(s),d&&r>a&&(CMS.settings.sideframe.hidden=!1),d&&Math.round(a)===Math.round(r)&&(t=!1),this._show(r,t),this},_content:function(s){function t(){var i=n.ui.sideframe.width();n.ui.sideframe.animate({width:i+1},0),setTimeout(function(){n.ui.sideframe.animate({width:i},0),n.ui.shim.css("z-index",20),setTimeout(function(){n.ui.shim.css("z-index",1)},0)},0)}var e,o,n=this,r=i('<iframe src="'+s+'" class="" frameborder="0" />'),a=this.ui.frame,d=/iPhone|iPod|iPad/.test(navigator.userAgent);r.hide().on("load",function(){try{r.contents()}catch(s){return CMS.API.Messages.open({message:"<strong>"+s+"</strong>",error:!0}),void n.close()}e=r.contents(),o=e.find("body"),o.addClass("cms-admin cms-admin-sideframe"),n.ui.frame.removeClass("cms-loader"),r.show(),d&&t(),CMS.config.debug&&o.addClass("cms-debug"),CMS.settings.sideframe.url=r[0].contentWindow.location.href,CMS.settings=n.setSettings(CMS.settings),o.on(n.click,function(){i(document).trigger(n.click)}),o.on("keydown.cms",function(i){i.keyCode===CMS.KEYS.ESC&&n.close()}),e.find(".viewsitelink").attr("target","_top"),n._addToHistory(this.contentWindow.location.href)}),a.empty(),a.html(r)},_show:function(s,t){var e=this;this.ui.sideframe.show(),CMS.settings.sideframe.hidden&&this._hide(),t?this.ui.sideframe.animate({width:s,overflow:"visible"},this.options.sideframeDuration):(this.ui.sideframe.css("width",s),s>=this.ui.window.width()&&this.ui.sideframe.css({width:this.ui.window.width()-30,overflow:"visible"})),CMS.API&&CMS.API.Toolbar&&(CMS.API.Toolbar.open(),CMS.API.Toolbar.hideLoader(),CMS.API.Toolbar._lock(!0)),this.ui.body.off("keydown.cms.close").on("keydown.cms.close",function(i){i.keyCode===CMS.KEYS.ESC&&(e.options.onClose=null,e.close())}),this.ui.body.addClass("cms-prevent-scrolling"),this.preventTouchScrolling(i(document),"sideframe")},close:function(){this.ui.dimmer.hide(),CMS.settings.sideframe={url:null,hidden:!1,width:this.options.sideframeWidth},CMS.settings=this.setSettings(CMS.settings),this.reloadBrowser(this.options.onClose,!1,!0),this._hide({duration:this.options.sideframeDuration/2})},_hide:function(s){var t=this.options.sideframeDuration;s&&"number"==typeof s.duration&&(t=s.duration),this.ui.sideframe.animate({width:0},t,function(){i(this).hide()}),this.ui.frame.removeClass("cms-loader"),CMS.API&&CMS.API.Toolbar&&CMS.API.Toolbar._lock(!1),this.ui.body.off("keydown.cms.close"),this.ui.body.removeClass("cms-prevent-scrolling"),this.allowTouchScrolling(i(document),"sideframe")},_startResize:function(){var i,s=this,t=30;this.ui.body.on(this.pointerUp,function(i){i.preventDefault(),s._stopResize()}),this.ui.shim.css("z-index",20),this.ui.body.attr("data-touch-action","none").on(this.pointerMove,function(e){e.originalEvent.clientX<=320&&(e.originalEvent.clientX=320),e.originalEvent.clientX>=s.ui.window.width()-t&&(e.originalEvent.clientX=s.ui.window.width()-t),s.ui.sideframe.css("width",e.originalEvent.clientX),CMS.settings.sideframe.position=e.originalEvent.clientX,clearTimeout(i),i=setTimeout(function(){CMS.settings=s.setSettings(CMS.settings)},s.settingsRefreshTimer)})},_stopResize:function(){this.ui.shim.css("z-index",1),this.ui.body.off(this.pointerUp).off(this.pointerMove).removeAttr("data-touch-action")},_goToHistory:function(i){var s,t=this.ui.frame.find("iframe");"back"===i&&(this.history.forward.push(this.history.back.pop()),t.attr("src",this.history.back[this.history.back.length-1])),"forward"===i&&(s=this.history.forward.pop(),this.history.back.push(s),t.attr("src",s)),this._updateHistoryButtons()},_addToHistory:function(i){this.history.back.push(i);var s=this.history.back.length;this.history.back[s-1]===this.history.back[s-2]&&this.history.back.pop(),this._updateHistoryButtons()},_updateHistoryButtons:function(){this.history.back.length>1?this.ui.historyBack.removeClass("cms-icon-disabled"):this.ui.historyBack.addClass("cms-icon-disabled"),this.history.forward.length>=1?this.ui.historyForward.removeClass("cms-icon-disabled"):this.ui.historyForward.addClass("cms-icon-disabled")}})}(CMS.$);
var CMS=window.CMS||{};!function(i){"use strict";CMS.Clipboard=new CMS.Class({implement:[CMS.API.Helpers],initialize:function(){this._setupUI(),this.click="click.cms.clipboard",this._events()},_setupUI:function(){var t=i(".cms-clipboard");this.ui={clipboard:t,triggers:i(".cms-clipboard-trigger a"),triggerRemove:i(".cms-clipboard-empty a"),pluginsList:t.find(".cms-clipboard-containers"),document:i(document)}},_events:function(){var t=this,e=400,a=117;t.modal=new CMS.Modal({minWidth:e,minHeight:a,minimizable:!1,maximizable:!1,resizable:!1}),t.modal.on("cms.modal.loaded cms.modal.closed",function(){i(".cms-add-plugin-placeholder").remove()}).on("cms.modal.closed cms.modal.load",function(){t.ui.pluginsList.prependTo(t.ui.clipboard)}).ui.modal.on("cms.modal.load",function(){t.ui.pluginsList.prependTo(t.ui.clipboard)}),t.ui.triggers.on(t.click,function(o){return o.preventDefault(),o.stopPropagation(),i(this).parent().hasClass("cms-toolbar-item-navigation-disabled")?!1:(t.modal.open({html:t.ui.pluginsList,title:t.ui.clipboard.data("title"),width:e,height:a}),void t.ui.document.trigger("click.cms.toolbar"))}),t.ui.triggerRemove.on(t.click,function(e){return e.preventDefault(),e.stopPropagation(),i(this).parent().hasClass("cms-toolbar-item-navigation-disabled")?!1:void t.clear(function(){t.modal.close(),t.ui.triggers.parent().addClass("cms-toolbar-item-navigation-disabled"),t.ui.triggerRemove.parent().addClass("cms-toolbar-item-navigation-disabled"),t.ui.document.trigger("click.cms.toolbar")})})},clear:function(t){var e='{ "csrfmiddlewaretoken": "'+CMS.config.csrf+'" }',a=i(".cms-submenu-item [data-rel=paste]").parent().addClass("cms-submenu-item-disabled");a.find(".cms-submenu-item-paste-tooltip").css("display","none"),a.find(".cms-submenu-item-paste-tooltip-empty").css("display","block"),CMS.API.Toolbar.openAjax({url:CMS.config.clipboard.url,post:e,callback:t})}})}(CMS.$);
var CMS=window.CMS||{};!function(e){"use strict";var s,t,i,n;CMS.Plugin=new CMS.Class({implement:[CMS.API.Helpers],options:{type:"",placeholder_id:null,plugin_type:"",plugin_id:null,plugin_language:"",plugin_parent:null,plugin_order:null,plugin_breadcrumb:[],plugin_restriction:[],plugin_parent_restriction:[],urls:{add_plugin:"",edit_plugin:"",move_plugin:"",copy_plugin:"",delete_plugin:""}},initialize:function(s,t){switch(this.options=e.extend(!0,{},this.options,t),this._setupUI(s),this.csrf=CMS.config.csrf,this.click="click.cms.plugin",this.pointerUp="pointerup.cms.plugin",this.pointerDown="pointerdown.cms.plugin",this.pointerOverAndOut="pointerover.cms.plugin pointerout.cms.plugin",this.doubleClick="dblclick.cms.plugin",this.keyUp="keyup.cms.plugin",this.keyDown="keydown.cms.plugin",this.mouseEvents="mousedown.cms.plugin mousemove.cms.plugin mouseup.cms.plugin",this.touchStart="touchstart.cms.plugin",this.touchEnd="touchend.cms.plugin",this.ui.container.data("settings",this.options),this.options.type){case"placeholder":this._setPlaceholder(),this._collapsables();break;case"plugin":this._setPlugin(),this._collapsables();break;default:this._setGeneric()}},_setupUI:function(s){s=e("."+s),this.ui={container:s,publish:e(".cms-btn-publish"),save:e(".cms-toolbar-item-switch-save-edit"),window:e(window),revert:e(".cms-toolbar-revert"),dragbar:null,draggable:null,draggables:null,submenu:null,dropdown:null}},_setPlaceholder:function(){var s=this;this.ui.dragbar=e(".cms-dragbar-"+this.options.placeholder_id),this.ui.draggables=this.ui.dragbar.closest(".cms-dragarea").find("> .cms-draggables"),this.ui.submenu=this.ui.dragbar.find(".cms-submenu-settings");var t=this.ui.dragbar.find(".cms-dragbar-title"),i=this.ui.dragbar.find(".cms-dragbar-toggler a"),n="cms-dragbar-title-expanded";this._setSettingsMenu(this.ui.submenu),this._setAddPluginModal(this.ui.dragbar.find(".cms-submenu-add")),CMS.settings.dragbars=CMS.settings.dragbars||[],i.off(this.click).on(this.click,function(e){e.preventDefault(),t.hasClass(n)?s._collapseAll(t):s._expandAll(t)}),-1!==e.inArray(this.options.placeholder_id,CMS.settings.dragbars)&&t.addClass(n),this._checkIfPasteAllowed()},_setPlugin:function(){var s=this;this.ui.container.add(this.ui.dragitem).on(this.doubleClick,function(e){e.preventDefault(),e.stopPropagation(),s.editPlugin(s.options.urls.edit_plugin,s.options.plugin_name,s.options.plugin_breadcrumb)}),this.ui.container.on(this.pointerOverAndOut+" "+this.touchStart,function(t){t.stopPropagation(),"touchstart"===t.type&&CMS.API.Tooltip._forceTouchOnce();var i=s.options.plugin_name,n=s.options.plugin_id,a=s._getId(s.ui.dragitem.closest(".cms-dragarea")),o=e(".cms-placeholder-"+a);o.length&&o.data("settings")&&(i=o.data("settings").name+": "+i),CMS.API.Tooltip.displayToggle("pointerover"===t.type||"touchstart"===t.type,t,i,n)}),this.ui.container.on("cms.plugins.update",function(e){e.stopPropagation(),s.movePlugin()}),this.ui.container.on("cms.plugin.update",function(t){t.stopPropagation();var i=e(t.delegateTarget),n=e(".cms-draggable-"+i.data("settings").plugin_id),a=s._getId(n.parents(".cms-draggables").last().prevAll(".cms-dragbar").first());if(!a)return!1;var o=i.data("settings");o.target=a,o.parent=s._getId(n.parent().closest(".cms-draggable")),o.move_a_copy=!0,s.movePlugin(o)}),this.ui.draggable=e(".cms-draggable-"+this.options.plugin_id),this.ui.dragitem=this.ui.draggable.find("> .cms-dragitem"),this.ui.draggables=this.ui.draggable.find("> .cms-draggables"),this.ui.submenu=this.ui.dragitem.find(".cms-submenu"),this._setSettingsMenu(this.ui.submenu),this._setAddPluginModal(this.ui.dragitem.find(".cms-submenu-add")),this._checkIfPasteAllowed()},_setGeneric:function(){var e=this;this.ui.container.on(this.doubleClick,function(s){s.preventDefault(),s.stopPropagation(),e.editPlugin(e.options.urls.edit_plugin,e.options.plugin_name,[])}),this.ui.container.on(this.pointerOverAndOut+" "+this.touchStart,function(s){"touchstart"!==s.type&&s.stopPropagation();var t=e.options.plugin_name,i=e.options.plugin_id;CMS.API.Tooltip.displayToggle("pointerover"===s.type||"touchstart"===s.type,s,t,i)})},_checkIfPasteAllowed:function(){var s=this.ui.dropdown.find("[data-rel=paste]"),t=s.parent();if(!n.length)return t.addClass("cms-submenu-item-disabled"),t.find(".cms-submenu-item-paste-tooltip-empty").css("display","block"),!1;if(this.ui.draggable&&this.ui.draggable.hasClass("cms-draggable-disabled"))return t.addClass("cms-submenu-item-disabled"),t.find(".cms-submenu-item-paste-tooltip-disabled").css("display","block"),!1;var i=this.options.plugin_restriction;if(!n.data("settings"))return!1;var a=n.data("settings").plugin_type,o=e.grep(n.data("settings").plugin_parent_restriction,function(e){return"0"!==e}),r=this.options.plugin_type;return i.length&&-1===e.inArray(a,i)||o.length&&-1===e.inArray(r,o)?(t.addClass("cms-submenu-item-disabled"),t.find(".cms-submenu-item-paste-tooltip-restricted").css("display","block"),!1):!0},addPlugin:function(s,t,i){if(CMS.API.locked)return!1;CMS.API.locked=!0;var n=this,a={placeholder_id:this.options.placeholder_id,plugin_type:s,plugin_parent:i||"",plugin_language:this.options.plugin_language,csrfmiddlewaretoken:this.csrf};e.ajax({type:"POST",url:this.options.urls.add_plugin,data:a,success:function(e){CMS.API.locked=!1,n.newPlugin=e,n.editPlugin(e.url,t,e.breadcrumb)},error:function(e){CMS.API.locked=!1;var s=CMS.config.lang.error;CMS.API.Messages.open({message:s+e.responseText||e.status+" "+e.statusText,error:!0})}})},editPlugin:function(s,t,i){var n=new CMS.Modal({newPlugin:this.newPlugin||!1,onClose:this.options.onClose||!1,redirectOnClose:this.options.redirectOnClose||!1});this.newPlugin||n.on("cms.modal.loaded",function(){e(".cms-add-plugin-placeholder").remove()}),n.on("cms.modal.closed",function(){e(".cms-add-plugin-placeholder").remove()}),n.open({url:s,title:t,breadcrumbs:i,width:850})},copyPlugin:function(s,t){if(CMS.API.locked)return!1;CMS.API.locked=!0;var i=!(!s&&!t);s=s||this.options,t?(s.target=s.placeholder_id,s.plugin_id="",s.parent=""):t=s.plugin_language;var n={source_placeholder_id:s.placeholder_id,source_plugin_id:s.plugin_id||"",source_language:t,target_plugin_id:s.parent||"",target_placeholder_id:s.target||CMS.config.clipboard.id,target_language:s.page_language||t,csrfmiddlewaretoken:this.csrf},a={type:"POST",url:s.urls.copy_plugin,data:n,success:function(){CMS.API.Messages.open({message:CMS.config.lang.success}),CMS.API.Helpers.reloadBrowser()},error:function(e){CMS.API.locked=!1;var s=CMS.config.lang.error;CMS.API.Messages.open({message:s+e.responseText||e.status+" "+e.statusText,error:!0})}};i?e.ajax(a):CMS.API.Clipboard.clear(function(){e.ajax(a)})},cutPlugin:function(){if(CMS.API.locked)return!1;CMS.API.locked=!0;var s=this,t={placeholder_id:CMS.config.clipboard.id,plugin_id:this.options.plugin_id,plugin_parent:"",plugin_language:this.options.page_language,plugin_order:[this.options.plugin_id],csrfmiddlewaretoken:this.csrf};CMS.API.Clipboard.clear(function(){return CMS.API.locked?!1:(CMS.API.locked=!0,void e.ajax({type:"POST",url:s.options.urls.move_plugin,data:t,success:function(){CMS.API.Messages.open({message:CMS.config.lang.success}),CMS.API.Helpers.reloadBrowser()},error:function(e){CMS.API.locked=!1;var s=CMS.config.lang.error;CMS.API.Messages.open({message:s+e.responseText||e.status+" "+e.statusText,error:!0})}}))})},pastePlugin:function(){i.appendTo(this.ui.draggables),this.ui.draggables.trigger("cms.update"),n.trigger("cms.plugin.update")},movePlugin:function(s){if(CMS.API.locked)return!1;CMS.API.locked=!0;var t=this;s=s||this.options;var i=e(".cms-plugin-"+s.plugin_id),n=e(".cms-draggable-"+s.plugin_id);this._setPosition(s.plugin_id,i,n);var a=this._getId(n.parents(".cms-draggables").last().prevAll(".cms-dragbar").first()),o=this._getId(n.parent().closest(".cms-draggable")),r=this._getIds(n.siblings(".cms-draggable").andSelf());if(s.move_a_copy&&(r=r.map(function(e){return e===s.plugin_id&&(e="__COPY__"),e})),a===!1)return!1;var l={placeholder_id:a,plugin_id:s.plugin_id,plugin_parent:o||"",plugin_language:s.page_language,plugin_order:r,csrfmiddlewaretoken:this.csrf,move_a_copy:s.move_a_copy};e.ajax({type:"POST",url:s.urls.move_plugin,data:l,success:function(e){e.reload&&CMS.API.Helpers.reloadBrowser(),e.urls&&t._setSettings(s,{urls:e.urls}),CMS.API.locked=!1,t._showSuccess(n)},error:function(e){CMS.API.locked=!1;var s=CMS.config.lang.error;CMS.API.Messages.open({message:s+e.responseText||e.status+" "+e.statusText,error:!0})}}),this.ui.publish.addClass("cms-btn-publish-active").removeClass("cms-btn-disabled").parent().show(),this.ui.window.trigger("resize"),this.ui.revert.removeClass("cms-toolbar-item-navigation-disabled")},_setSettings:function(s,t){var i=e.extend(!0,{},s,t),n=e(".cms-plugin-"+i.plugin_id);this.options=i,n.data("settings",i)},deletePlugin:function(s,t,i){var n=new CMS.Modal({newPlugin:this.newPlugin||!1,onClose:this.options.onClose||!1,redirectOnClose:this.options.redirectOnClose||!1});n.on("cms.modal.loaded",function(){e(".cms-add-plugin-placeholder").remove()}),n.open({url:s,title:t,breadcrumbs:i})},_setPosition:function(s,t,i){var n=i.prev(".cms-draggable"),a=i.next(".cms-draggable"),o=i.parent().closest(".cms-draggable"),r=e(".cms-plugin-"+this._getId(o)),l=i.closest(".cms-dragarea");if(n.length)t.insertAfter(e(".cms-plugin-"+this._getId(n)));else if(a.length)t.insertBefore(e(".cms-plugin-"+this._getId(a)));else if(o.length){for(;r.children().length;)r=r.children();r.append(t)}else l.length?t.insertAfter(e(".cms-placeholder-"+this._getId(l))):CMS.API.Helpers.reloadBrowser()},editPluginPostAjax:function(e,s){this.editPlugin(s.url,this.options.plugin_name,s.breadcrumb)},_setSettingsMenu:function(s){var t=this;this.ui.dropdown=s.siblings(".cms-submenu-dropdown-settings");var i=this.ui.dropdown;s.on(this.pointerUp,function(s){s.preventDefault(),s.stopPropagation();var i=e(this);i.hasClass("cms-btn-active")?CMS.Plugin._hideSettingsMenu(i):(CMS.Plugin._hideSettingsMenu(),t._showSettingsMenu(i))}).on(this.touchStart,function(e){e.stopPropagation()}),i.on(this.mouseEvents,function(e){e.stopPropagation()}).on(this.touchStart,function(e){e.stopPropagation()}),t._setupActions(s),s.on([this.pointerUp,this.pointerDown,this.click,this.doubleClick].join(" "),function(e){e.stopPropagation()}),s.siblings(".cms-quicksearch, .cms-submenu-dropdown-settings").on([this.pointerUp,this.click,this.doubleClick].join(" "),function(e){e.stopPropagation()})},_scrollToElement:function(s,t){var i=t&&void 0!==t.duration?t.duration:200,n=t&&void 0!==t.offset?t.offset:50,a=s.offsetParent(),o=e(window),r=o.height(),l=a.scrollTop(),d=s.position().top,c=s.height(),u=r>=d+c+n;u||a.animate({scrollTop:d+n+c+l-r},i)},_setAddPluginModal:function(s){if(s.hasClass("cms-btn-disabled"))return!1;var t,i,n=this,a=e('<div class="cms-add-plugin-placeholder">'+CMS.config.lang.addPluginPlaceholder+"</div>"),o=new CMS.Modal({minWidth:400,minHeight:400}),r=s.closest(".cms-dragitem"),l=!Boolean(r.length);t=l?s.closest(".cms-dragarea").find("> .cms-draggables"):s.closest(".cms-draggable").find("> .cms-draggables"),o.on("cms.modal.loaded",e.proxy(n._setupKeyboardTraversing,n)),o.on("cms.modal.loaded",function(){t.hasClass("cms-hidden")&&!l&&n._toggleCollapsable(r),e(".cms-add-plugin-placeholder").remove(),a.appendTo(t),n._scrollToElement(a)}),o.on("cms.modal.closed",function(){e(".cms-add-plugin-placeholder").remove()}),o.on("cms.modal.shown",function(){var s=e(".cms-modal-markup .cms-plugin-picker");i||s.find("input").trigger("focus"),i=!1});var d=s.siblings(".cms-plugin-picker");n._setupQuickSearch(d),s.on(this.touchStart,function(e){i=!0,e.stopPropagation()}).on(this.pointerUp,function(e){e.preventDefault(),e.stopPropagation(),CMS.Plugin._hideSettingsMenu();var t=d.clone(!0,!0).data("parentId",n._getId(s.closest(".cms-draggable")));o.open({title:n.options.addPluginHelpTitle,html:t,width:530,height:400})}),s.on([this.pointerUp,this.pointerDown,this.click,this.doubleClick].join(" "),function(e){e.stopPropagation()}),s.siblings(".cms-quicksearch, .cms-submenu-dropdown").on([this.pointerUp,this.click,this.doubleClick].join(" "),function(e){e.stopPropagation()})},_setupQuickSearch:function(s){var t=this,i=s.find("> .cms-quicksearch").find("input"),n=CMS.API.Helpers.debounce(function(){var s=e(this),i=s.closest(".cms-plugin-picker");t._filterPluginsList(i,s)},100);i.on(this.keyUp,n).on(this.keyUp,CMS.API.Helpers.debounce(function(s){var t,i;s.keyCode===CMS.KEYS.ENTER&&(t=e(this),i=t.closest(".cms-plugin-picker"),i.find(".cms-submenu-item").not(".cms-submenu-item-title").filter(":visible").first().find("> a").focus().trigger("click"))},110))},_setupActions:function(s){var t=this,i=".cms-submenu-edit, .cms-submenu-item a";s.parent().find(".cms-submenu-edit").on(this.touchStart,function(e){e.stopPropagation()}),s.parent().find(i).on(t.click,function(i){i.preventDefault(),i.stopPropagation(),CMS.API.Toolbar.showLoader();var n=e(this);switch(CMS.Plugin._hideSettingsMenu(s),n.attr("data-rel")){case"add":t.addPlugin(n.attr("href").replace("#",""),n.text(),n.closest(".cms-plugin-picker").data("parentId"));break;case"ajax_add":CMS.API.Toolbar.openAjax({url:n.attr("href"),post:JSON.stringify(n.data("post")),text:n.data("text"),callback:e.proxy(t.editPluginPostAjax,t),onSuccess:n.data("on-success")});break;case"edit":t.editPlugin(t.options.urls.edit_plugin,t.options.plugin_name,t.options.plugin_breadcrumb);break;case"copy-lang":t.copyPlugin(this.options,n.attr("data-language"));break;case"copy":n.parent().hasClass("cms-submenu-item-disabled")?CMS.API.Toolbar.hideLoader():t.copyPlugin();break;case"cut":t.cutPlugin();break;case"paste":n.parent().hasClass("cms-submenu-item-disabled")?CMS.API.Toolbar.hideLoader():t.pastePlugin();break;case"delete":t.deletePlugin(t.options.urls.delete_plugin,t.options.plugin_name,t.options.plugin_breadcrumb);break;default:CMS.API.Toolbar.hideLoader(),CMS.API.Toolbar._delegate(n)}})},_setupKeyboardTraversing:function(){var t=e(".cms-modal-markup .cms-plugin-picker");t.length&&(s.off(this.keyDown+".traverse"),s.on(this.keyDown+".traverse",function(e){var s=t.find(".cms-submenu-item:visible a"),i=s.index(s.filter(":focus"));e.keyCode!==CMS.KEYS.DOWN&&e.keyCode!==CMS.KEYS.TAB||(e.preventDefault(),i>=0&&i<s.length-1?s.eq(i+1).focus():s.eq(0).focus()),(e.keyCode===CMS.KEYS.UP||e.keyCode===CMS.KEYS.TAB&&e.shiftKey)&&(e.preventDefault(),s.is(":focus")?s.eq(i-1).focus():s.eq(s.length).focus())}))},_showSettingsMenu:function(e){var s=this.ui.dropdown,t=e.parentsUntil(".cms-dragarea").last();e.addClass("cms-btn-active"),t.addClass("cms-z-index-9999"),s.show(),this.ui.window.height()+this.ui.window.scrollTop()-e.offset().top-s.height()<=10&&e.offset().top-s.height()>=0?s.removeClass("cms-submenu-dropdown-top").addClass("cms-submenu-dropdown-bottom"):s.removeClass("cms-submenu-dropdown-bottom").addClass("cms-submenu-dropdown-top")},_filterPluginsList:function(s,t){var i=s.find(".cms-submenu-item"),n=s.find(".cms-submenu-item-title"),a=t.val();return""===a?(i.add(n).show(),!1):(i.find("a, span").each(function(s,t){t=e(t);var i=t.text().toLowerCase(),n=a.toLowerCase();i.indexOf(n)>=0?t.parent().show():t.parent().hide()}),n.filter(":visible").each(function(s,t){n.hide(),e(t).nextUntil(".cms-submenu-item-title").show()}),i.filter(":visible").each(function(s,t){t=e(t),t.prev().hasClass("cms-submenu-item-title")?t.prev().show():t.prevUntil(".cms-submenu-item-title").last().prev().show()}),s.siblings(".cms-submenu-dropdown-children").show(),void(i.add(n).filter(":visible").length<=0&&s.siblings(".cms-submenu-dropdown-children").hide()))},_toggleCollapsable:function(t){var i,n=this,a=n._getId(t.parent()),o=this.ui.draggable,r=CMS.settings;if(r.states=r.states||[],t.hasClass("cms-dragitem-expanded")){if(r.states.splice(e.inArray(a,r.states),1),t.removeClass("cms-dragitem-expanded").parent().find("> .cms-collapsable-container").addClass("cms-hidden"),s.data("expandmode")){if(i=o.find(".cms-draggable").find(".cms-dragitem-collapsable"),!i.length)return!1;i.each(function(){var s=e(this);s.hasClass("cms-dragitem-expanded")&&n._toggleCollapsable(s)})}}else if(r.states.push(a),t.addClass("cms-dragitem-expanded").parent().find("> .cms-collapsable-container").removeClass("cms-hidden"),s.data("expandmode")){if(i=o.find(".cms-draggable").find(".cms-dragitem-collapsable"),!i.length)return!1;i.each(function(){var s=e(this);s.hasClass("cms-dragitem-expanded")||n._toggleCollapsable(s)})}this.ui.window.trigger("resize.sideframe"),CMS.API.Toolbar.setSettings(r)},_collapsables:function(){var s=this;this.ui.draggable=e(".cms-draggable-"+this.options.plugin_id);var t=this.ui.draggable.find("> .cms-dragitem");if(this.ui.container.each(function(s,t){var i=e(t).find(".cms-dragitem-collapsable"),n=i.filter(".cms-dragitem-expanded");i.length===n.length&&i.length+n.length!==0&&e(t).find(".cms-dragbar-title").addClass("cms-dragbar-title-expanded")}),!this.ui.draggable.length)return!1;if(t.find("> .cms-dragitem-text").on(this.touchEnd+" "+this.click,CMS.API.Helpers.debounce(function(){t.hasClass("cms-dragitem-collapsable")&&s._toggleCollapsable(t)},0)),this.ui.draggable.on(this.doubleClick,function(t){t.stopPropagation(),e(".cms-plugin-"+s._getId(e(this))).trigger("dblclick.cms")}),CMS.Toolbar.ready)return!1;for(var i=CMS.settings.states.sort(),n=[],a=0;a<i.length;a++)i[a]!==i[a+1]&&n.push(i[a]);CMS.settings.states=n,e.each(CMS.settings.states,function(s,t){var i=e(".cms-draggable-"+t);i.find(".cms-draggables").length&&(i.find("> .cms-collapsable-container").removeClass("cms-hidden"),i.find("> .cms-dragitem").addClass("cms-dragitem-expanded"))}),CMS.Toolbar.ready=!0},_expandAll:function(s){var t=this,i=s.closest(".cms-dragarea").find(".cms-dragitem-collapsable");if(!i.length)return!1;i.each(function(){var s=e(this);s.hasClass("cms-dragitem-expanded")||t._toggleCollapsable(s)}),s.addClass("cms-dragbar-title-expanded");var n=CMS.settings;n.dragbars=n.dragbars||[],n.dragbars.push(this.options.placeholder_id),CMS.API.Toolbar.setSettings(n)},_collapseAll:function(s){var t=this,i=s.closest(".cms-dragarea").find(".cms-dragitem-collapsable");i.each(function(){var s=e(this);s.hasClass("cms-dragitem-expanded")&&t._toggleCollapsable(s)}),s.removeClass("cms-dragbar-title-expanded");var n=CMS.settings;n.dragbars=n.dragbars||[],n.dragbars.splice(e.inArray(this.options.placeholder_id,n.states),1),CMS.API.Toolbar.setSettings(n)},_getId:function(e){return CMS.API.StructureBoard.getId(e)},_getIds:function(e){return CMS.API.StructureBoard.getIds(e)},_showSuccess:function(s){var t=e('<div class="cms-dragitem-success"></div>');s.addClass("cms-draggable-success").append(t),t.fadeOut(1e3,function(){e(this).remove(),s.removeClass("cms-draggable-success")}),this.ui.window.trigger("resize.sideframe")}}),CMS.Plugin._hideSettingsMenu=function(s){s=s||e(".cms-submenu-btn.cms-btn-active"),s.length&&(s.removeClass("cms-btn-active"),s.closest(".cms-draggable").data("active",!1),e(".cms-z-index-9999").removeClass("cms-z-index-9999"),s.siblings(".cms-submenu-dropdown").hide(),s.siblings(".cms-quicksearch").hide(),s.siblings(".cms-quicksearch").find("input").val("").trigger(this.keyUp).blur(),e(".cms-dragbar").css("position",""))},CMS.Plugin._initializeGlobalHandlers=function(){var a,o=0;s=e(document),t=e(".cms-clipboard"),i=t.find(".cms-draggable:first"),n=t.find(".cms-plugin:first"),s.on("pointerup.cms.plugin",function(){CMS.Plugin._hideSettingsMenu()}).on("keydown.cms.plugin",function(e){e.keyCode===CMS.KEYS.SHIFT&&s.data("expandmode",!0)}).on("keyup.cms.plugin",function(e){e.keyCode===CMS.KEYS.SHIFT&&s.data("expandmode",!1)}).on("click.cms.plugin",".cms-plugin a, a:has(.cms-plugin)",function(s){s.shiftKey||s.ctrlKey||s.metaKey||s.isDefaultPrevented()||(s.preventDefault(),1===++o?a=setTimeout(function(){var t=e(s.currentTarget);o=0,window.open(t.attr("href"),t.attr("target")||"_self")},300):(clearTimeout(a),o=0))})},e(CMS.Plugin._initializeGlobalHandlers)}(CMS.$);
var CMS=window.CMS||{};!function(e){"use strict";function t(){i.each(function(){var t=e(this),s=t.find('.cms-dragbar .cms-submenu-item:has(a[data-rel="copy"]):first');t.find("> .cms-draggables").children(".cms-draggable:not(.cms-draggable-is-dragging)").length?(t.removeClass("cms-dragarea-empty"),s.removeClass("cms-submenu-item-disabled")):(t.addClass("cms-dragarea-empty"),s.addClass("cms-submenu-item-disabled"))})}function s(t){t.each(function(){var t=e(this),s=t.closest(".cms-draggable").find("> .cms-dragitem");t.children().length?s.addClass("cms-dragitem-collapsable cms-dragitem-expanded"):s.removeClass("cms-dragitem-collapsable")})}var i;CMS.StructureBoard=new CMS.Class({implement:[CMS.API.Helpers],initialize:function(){this._setupUI(),this.click="click.cms",this.pointerUp="pointerup.cms",this.state=!1,this.dragging=!1,this._setup(),this._setupModeSwitcher(),t()},_setupUI:function(){var t=e(".cms-structure"),s=e(".cms-toolbar");this.ui={container:t,content:e(".cms-structure-content"),doc:e(document),window:e(window),html:e("html"),toolbar:s,sortables:e(".cms-draggables"),plugins:e(".cms-plugin"),render_model:e(".cms-render-model"),placeholders:e(".cms-placeholder"),dragitems:e(".cms-draggable"),dragareas:e(".cms-dragarea"),toolbarModeSwitcher:s.find(".cms-toolbar-item-cms-mode-switcher"),toolbarModeLinks:s.find(".cms-toolbar-item-cms-mode-switcher a"),toolbarTrigger:e(".cms-toolbar-trigger")}},_setup:function(){var e=this;return this.ui.dragareas.length&&this.ui.toolbarModeSwitcher.length?(setTimeout(function(){"structure"===CMS.settings.mode?e.show(!0):e.hide(!0)},0),this.ui.placeholders.length&&this.ui.toolbarModeSwitcher.show(),void this._drag()):!1},_setupModeSwitcher:function(){var e=this,t=e.ui.toolbarModeLinks;t.eq(1).on(e.click+" "+e.pointerUp,function(t){return t.preventDefault(),"edit"===CMS.settings.mode?!1:void e.hide()}),t.eq(0).on(e.click+" "+e.pointerUp,function(t){return t.preventDefault(),"structure"===CMS.settings.mode?!1:void e.show()}),e.ui.toolbarModeSwitcher.length&&e.ui.doc.on("keydown.cms.structureboard.switcher",function(t){var s=document.activeElement!==document.body;t.keyCode!==CMS.KEYS.SPACE||s||(t.preventDefault(),"structure"===CMS.settings.mode?e.hide():"edit"===CMS.settings.mode&&e.show())})},show:function(e){if("live"===CMS.config.mode)return!1;var t=this.ui.toolbar.width(),s=this.ui.window[0].innerWidth-t;s&&(this.ui.toolbar.css("right",s),this.ui.toolbarTrigger.css("right",s));var i=this.ui.toolbarModeLinks;i.removeClass("cms-btn-active").eq(0).addClass("cms-btn-active"),this.ui.html.removeClass("cms-structure-mode-content").addClass("cms-structure-mode-structure"),CMS.settings.mode="structure",e||(CMS.settings=this.setSettings(CMS.settings)),this.ui.dragareas.show(),this._showBoard()},hide:function(e){if("live"===CMS.config.mode)return!1;this.ui.toolbar.css("right",""),this.ui.toolbarTrigger.css("right","");var t=this.ui.toolbarModeLinks;t.removeClass("cms-btn-active").eq(1).addClass("cms-btn-active"),this.ui.html.removeClass("cms-structure-mode-structure").addClass("cms-structure-mode-content"),this.ui.container.find(".cms-clipboard").hide(),CMS.settings.mode="edit",e||(CMS.settings=this.setSettings(CMS.settings)),this._hideBoard()},getId:function(e){if(void 0===e||null===e||e.length<=0)return!1;var t=null,s=e.attr("class").split(" ")[1];return e.hasClass("cms-plugin")?t=s.replace("cms-plugin-",""):e.hasClass("cms-draggable")?t=s.replace("cms-draggable-",""):e.hasClass("cms-placeholder")?t=s.replace("cms-placeholder-",""):e.hasClass("cms-dragbar")?t=s.replace("cms-dragbar-",""):e.hasClass("cms-dragarea")&&(t=s.replace("cms-dragarea-","")),t},getIds:function(t){var s=this,i=[];return t.each(function(){i.push(s.getId(e(this)))}),i},_showBoard:function(){var t=this;if(this.ui.container.show(),this.ui.dragareas.css("opacity",1),this.ui.plugins.not(this.ui.render_model).hide(),this.ui.placeholders.show(),CMS.config.simpleStructureBoard){var s=this.ui.content,i=s.find(".cms-dragarea");s.addClass("cms-structure-content-simple"),i.addClass("cms-dragarea-simple"),i.each(function(t,i){e(i).hasClass("cms-dragarea-static")&&s.append(i)}),i.filter(".cms-dragarea-static").eq(0).css("margin-top","50px")}else this.ui.container.addClass("cms-structure-dynamic"),this.ui.window.on("resize.sideframe",function(){t._resizeBoard()}).trigger("resize.sideframe")},_hideBoard:function(){this.ui.container.hide(),this.ui.plugins.show(),this.ui.placeholders.hide(),this.ui.window.off("resize.sideframe"),this.ui.window.trigger("structureboard_hidden.sideframe"),this.ui.window.trigger("resize"),CMS.config.simpleStructureBoard||this.ui.container.height(this.ui.doc.outerHeight())},_resizeBoard:function(){var t=null,s=null,i=null,a=null,r=this;setTimeout(function(){r.ui.container.height(r.ui.doc.outerHeight())},0),this.ui.placeholders.each(function(r,n){n=e(n),t=n.data("settings").placeholder_id,s=e(".cms-dragarea-"+t),n.height(s.outerHeight(!0)),i=n.width()?0:150,a=e(s).offsetParent().offset(),s.css({top:n.offset().top-a.top-5,left:n.offset().left-a.left-i,width:n.width()+i})})},_drag:function(){var i,a=this;this.ui.sortables.nestedSortable({items:"> .cms-draggable:not(.cms-draggable-disabled .cms-draggable)",placeholder:"cms-droppable",connectWith:".cms-draggables:not(.cms-hidden)",tolerance:"intersect",toleranceElement:"> div",dropOnEmpty:!0,helper:function(e,t){var s=t.find("> .cms-dragitem").clone();return s.wrap('<div class="'+t[0].className+'"></div>'),s.parent()},appendTo:".cms-structure-content",cursor:"move",cursorAt:{left:-15,top:-15},opacity:1,zIndex:9999999,delay:100,tabSize:15,listType:"div.cms-draggables",doNotClear:!0,disableNestingClass:"cms-draggable-disabled",errorClass:"cms-draggable-disallowed",scrollSpeed:15,scrollSensitivity:.2*a.ui.window.height(),start:function(s,r){a.ui.content.attr("data-touch-action","none"),i=r.item.closest(".cms-draggables"),a.dragging=!0,t(),CMS.Plugin._hideSettingsMenu(),a.ui.sortables.each(function(){var t=e(this);0===t.children().length&&t.removeClass("cms-hidden")}),r.item.addClass("cms-is-dragging"),r.helper.addClass("cms-draggable-is-dragging"),r.item.find("> .cms-draggables").children().length&&r.helper.addClass("cms-draggable-stack"),a.ui.doc.on("keyup.cms.interrupt",function(t,s){(t.keyCode===CMS.KEYS.ESC&&a.dragging||s)&&(a.state=!1,e.ui.sortable.prototype._mouseStop(),a.ui.sortables.trigger("mouseup"))})},beforeStop:function(e,t){a.dragging=!1,t.item.removeClass("cms-is-dragging cms-draggable-stack"),a.ui.doc.off("keyup.cms.interrupt"),a.ui.content.attr("data-touch-action","pan-y")},update:function(r,n){if(!a.state)return!1;var c=n.item.closest(".cms-draggables");if(i.is(c)){if(!c.is(this))return!1}else s(c.add(i));var o=a.getId(n.item),d=e(".cms-plugin-"+o);d.closest(".cms-clipboard").length?d.trigger("cms.plugin.update"):d.trigger("cms.plugins.update"),a.ui.sortables.each(function(){var t=e(this);0===t.children().length&&t.addClass("cms-hidden")}),t()},isAllowed:function(t,s,i){if(CMS.API.locked)return!1;var r,n=[],c=e(".cms-plugin-"+a.getId(i));if(0===c.length||!c.data("settings"))return!1;var o,d=e.grep(c.data("settings").plugin_parent_restriction,function(e){return"0"!==e}),l=c.data("settings").plugin_type,u=a.getId(t.closest(".cms-dragarea")),g=e(".cms-placeholder-"+u);return o=e(s&&s.length?".cms-plugin-"+a.getId(s.closest(".cms-draggable")):".cms-plugin-"+a.getId(t.closest(".cms-draggable"))),g.length&&(n=g.data("settings").plugin_restriction,r=g.data("settings").plugin_type),o.length&&(n=o.data("settings").plugin_restriction,r=o.data("settings").plugin_type),t.parent().hasClass("cms-draggable-disabled")?!1:(a.state=!n.length||-1!==e.inArray(l,n),d.length&&(a.state=-1!==e.inArray(r,d)),a.state)}}).on("cms.update",t)}}),CMS.StructureBoard._initializeGlobalHandlers=function(){i=e(".cms-dragarea:not(.cms-clipboard-containers)")},e(CMS.StructureBoard._initializeGlobalHandlers)}(CMS.$);
var CMS=window.CMS||{};!function(t){"use strict";CMS.Navigation=new CMS.Class({implement:[CMS.API.Helpers],initialize:function(){this._setupUI(),this._getWidths(),this.rightMostItemIndex=this.items.left.length-1,this.leftMostItemIndex=0,this.resize="resize.cms.navigation",this.load="load.cms.navigation",this.orientationChange="orientationchange.cms.navigation",this._events()},_setupUI:function(){var i=t(".cms"),e=i.find(".cms-toolbar-more");this.ui={window:t(window),toolbarLeftPart:i.find(".cms-toolbar-left"),toolbarRightPart:i.find(".cms-toolbar-right"),trigger:e,dropdown:e.find("> ul"),toolbarTrigger:i.find(".cms-toolbar-trigger"),logo:i.find(".cms-toolbar-item-logo")}},_events:function(){this.ui.window.on([this.resize,this.load,this.orientationChange].join(" "),CMS.API.Helpers.throttle(this._handleResize.bind(this),50))},_getWidths:function(){var i=this;i.items={left:[],leftTotalWidth:0,right:[],rightTotalWidth:0,moreButtonWidth:0};var e=i.ui.toolbarLeftPart.find(".cms-toolbar-item-navigation > li:not(.cms-toolbar-more)"),o=i.ui.toolbarRightPart.find("> .cms-toolbar-item"),s=function(i,e){var o=t(i),s=t(i).outerWidth(!0);e.push({element:o,width:s})},h=function(t,i){return t+i.width};e.each(function(){s(this,i.items.left)}),o.each(function(){s(this,i.items.right)}),i.items.leftTotalWidth=i.items.left.reduce(h,0),i.items.rightTotalWidth=i.items.right.reduce(h,0),i.items.moreButtonWidth=i.ui.trigger.outerWidth()},_calculateAvailableWidth:function(){var t=this.ui.window.width(),i=parseInt(this.ui.toolbarRightPart.css("padding-right"),10)+this.ui.logo.offset().left+this.ui.logo.outerWidth(!0)+15;return t-i},_showDropdown:function(){this.ui.trigger.css("display","list-item")},_hideDropdown:function(){this.ui.trigger.css("display","none")},_handleResize:function(){var t,i=this._calculateAvailableWidth();if(i>this.items.leftTotalWidth+this.items.rightTotalWidth)this._showAll();else{t=i-this.items.moreButtonWidth-this.items.rightTotalWidth;for(var e=-1;t-this.items.left[e+1].width>=0;)t-=this.items.left[e+1].width,e++;if(e<this.rightMostItemIndex?this._moveToDropdown(this.rightMostItemIndex-e):this.rightMostItemIndex<e&&this._moveOutOfDropdown(e-this.rightMostItemIndex),this._showDropdown(),0>t&&-1===this.rightMostItemIndex){t+=this.items.rightTotalWidth;var o=this.items.right.length;this._moveToDropdown(o-this.leftMostItemIndex,"right"),this.ui.dropdown.addClass("cms-more-dropdown-full")}else this._showAllRight(),this.ui.dropdown.removeClass("cms-more-dropdown-full")}},_showAll:function(){this._showAllLeft(),this._showAllRight(),this._hideDropdown()},_showAllLeft:function(){this._moveOutOfDropdown(this.items.left.length-1-this.rightMostItemIndex)},_showAllRight:function(){this._moveOutOfDropdown(this.leftMostItemIndex,"right")},_moveToDropdown:function(t,i){if(!(0>=t)){var e,o,s,h;if("right"===i){for(o=this.leftMostItemIndex,s=this.leftMostItemIndex+t-1,h=o;s>=h;h++)e=this.items.right[h].element,this.ui.dropdown.prepend(e.wrap('<li class="cms-more-buttons"></li>').parent());this.leftMostItemIndex+=t}else{for(s=this.rightMostItemIndex,o=this.rightMostItemIndex-t+1,h=s;h>=o;h--)e=this.items.left[h].element,this.ui.dropdown.prepend(e),e.find("> ul").children().length&&e.addClass("cms-toolbar-item-navigation-children");this.rightMostItemIndex-=t}}},_moveOutOfDropdown:function(t,i){if(!(0>=t)){var e,o,s,h;if("right"===i){for(h=this.leftMostItemIndex-1,s=this.leftMostItemIndex-t,e=h;e>=s;e--)o=this.items.right[e].element,o.unwrap("<li></li>"),o.prependTo(this.ui.toolbarRightPart);this.leftMostItemIndex-=t}else{for(s=this.rightMostItemIndex+1,h=this.rightMostItemIndex+t,e=s;h>=e;e++)o=this.items.left[e].element,o.insertBefore(this.ui.trigger),o.removeClass("cms-toolbar-item-navigation-children"),o.find("> ul").removeAttr("style");this.rightMostItemIndex+=t}}}})}(CMS.$);
var CMS=window.CMS||{};!function(t){"use strict";CMS.Toolbar=new CMS.Class({implement:[CMS.API.Helpers],options:{toolbarDuration:200},initialize:function(i){this.options=t.extend(!0,{},this.options,i),this._setupUI(),this.navigation=new CMS.Navigation,this._position={top:0,stickyTop:0,isSticky:!0},this.click="click.cms.toolbar",this.touchStart="touchstart.cms.toolbar",this.pointerUp="pointerup.cms.toolbar",this.pointerOverOut="pointerover.cms.toolbar pointerout.cms.toolbar",this.pointerLeave="pointerleave.csm.toolbar",this.mouseEnter="mouseenter.cms.toolbar",this.mouseLeave="mouseleave.cms.toolbar",this.resize="resize.cms.toolbar",this.scroll="scroll.cms.toolbar",this.key="keydown.cms.toolbar keyup.cms.toolbar",this.timer=function(){},this.lockToolbar=!1,this.ui.toolbar.data("ready")||this._events();var o=this;setTimeout(function(){o._initialStates()},200),this.ui.toolbar.data("ready",!0)},_setupUI:function(){var i=t(".cms");this.ui={container:i,body:t("html"),document:t(document),window:t(window),toolbar:i.find(".cms-toolbar"),toolbarTrigger:i.find(".cms-toolbar-trigger"),navigations:i.find(".cms-toolbar-item-navigation"),buttons:i.find(".cms-toolbar-item-buttons"),messages:i.find(".cms-messages"),screenBlock:i.find(".cms-screenblock"),structureBoard:i.find(".cms-structure")}},_events:function(){var i=this;this.ui.toolbarTrigger.on(this.pointerUp,function(t){t.preventDefault(),i.toggle(),i.ui.document.trigger(i.click)}).on(this.click,function(t){t.preventDefault()}),this.ui.navigations.each(function(){function o(){u=!1,h=!1,e.removeClass(a),e.find("ul ul").hide(),s.find("> li").off(i.mouseEnter),i.ui.document.off(i.click),i.ui.toolbar.off(i.click,o),i.ui.structureBoard.off(i.click),i.ui.window.off(i.resize+".menu.reset"),i._handleLongMenus()}var s=t(this),e=s.find("li"),n="cms-toolbar-item-navigation",a="cms-toolbar-item-navigation-hover",r="cms-toolbar-item-navigation-disabled",l="cms-toolbar-item-navigation-children",c=!1,u=!1,h=!1;s.find("a").on(i.click+" "+i.key,function(s){var e=t(this);return s.keyCode!==CMS.KEYS.CMD_LEFT&&s.keyCode!==CMS.KEYS.CMD_RIGHT&&s.keyCode!==CMS.KEYS.CMD_FIREFOX&&s.keyCode!==CMS.KEYS.SHIFT&&s.keyCode!==CMS.KEYS.CTRL||(h=!0),"keyup"===s.type&&(h=!1),""===e.attr("href")||"#"===e.attr("href")||e.parent().hasClass(r)?void 0:(h?CMS.API.Helpers._getWindow().open(e.attr("href"),"_blank"):i._delegate(t(this)),o(),!1)}).on(i.touchStart,function(){c=!0}),e.on(i.click,function(e){e.preventDefault(),e.stopPropagation();var h=t(this);return h.parent().hasClass(n)&&u?(i.ui.body.trigger(i.click),!1):(h.hasClass(l)||o(),h.parent().hasClass(n)&&h.hasClass(a)||h.hasClass(r)?!1:(h.addClass(a),i._handleLongMenus(),c||s.find("> li").on(i.mouseEnter,function(){return t(this).hasClass(a)?!1:(u=!1,void t(this).trigger(i.click))}),c=!1,i.ui.document.on(i.click,o),i.ui.structureBoard.on(i.click,o),i.ui.toolbar.on(i.click,o),i.ui.window.on(i.resize+".menu.reset",CMS.API.Helpers.throttle(o,1e3)),void(u=!0)))}),e.on(i.pointerOverOut,"li",function(){var o=t(this),s=o.closest(".cms-toolbar-item-navigation-children").add(o.parents(".cms-toolbar-item-navigation-children")),n=o.hasClass(l)||s.length;return o.hasClass(r)?!1:o.hasClass(a)?!0:(e.find("li").removeClass(a),o.addClass(a),n?(o.find("> ul").show(),s.addClass(a),i._handleLongMenus()):(e.find("ul ul").hide(),i._handleLongMenus()),void o.siblings().find("> ul").hide())}).on(i.click,function(t){t.preventDefault(),t.stopPropagation()}),e.on(i.pointerLeave,"> ul",function(){e.find("li").removeClass(a)})}),this.ui.buttons.each(function(){var o=t(this);o.find("a").attr("data-rel")?o.on(i.click,function(o){o.preventDefault(),i._delegate(t(this).find("a"))}):o.find("a").on(i.click,function(t){t.stopPropagation()}),o.find(".cms-publish-page").on(i.click,function(t){CMS.API.Helpers.secureConfirm(CMS.config.lang.publish)||t.preventDefault()}),o.find(".cms-btn-publish").on(i.click,function(i){i.preventDefault(),t.ajax({type:"post",url:t(this).prop("href"),data:{csrfmiddlewaretoken:CMS.config.csrf},success:function(){var t=CMS.API.Helpers.makeURL(CMS.API.Helpers._getWindow().location.href.split("?")[0],[CMS.settings.edit_off+"=true"]);CMS.API.Helpers.reloadBrowser(t)},error:function(t){throw new Error(t)}})})}),this.ui.window.on([this.resize,this.scroll].join(" "),CMS.API.Helpers.throttle(t.proxy(this._handleLongMenus,this),10))},_initialStates:function(){var i=t(".cms-btn-publish").parent();if("expanded"===CMS.settings.toolbar?this.open({duration:0}):this.close(),i.hide(),t(".cms-btn-publish-active").length&&(i.show(),this.ui.window.trigger("resize")),CMS.config.debug&&this._debug(),CMS.config.messages&&CMS.API.Messages.open({message:CMS.config.messages}),CMS.config.error&&CMS.API.Messages.open({message:CMS.config.error,error:!0}),CMS.config.auth&&CMS.config.settings.version===CMS.settings.version||(this.open({duration:0}),CMS.settings=this.setSettings(CMS.config.settings)),CMS.config.publisher&&CMS.API.Messages.open({message:CMS.config.publisher,dir:"right"}),CMS.settings.sideframe&&CMS.settings.sideframe.url){var o=new CMS.Sideframe;o.open({url:CMS.settings.sideframe.url,animate:!1})}this.ui.screenBlock.length&&this._screenBlock(),this.ui.body.addClass("cms-ready"),this.ui.document.trigger("cms-ready")},toggle:function(){"collapsed"===CMS.settings.toolbar?this.open():this.close()},open:function(t){this._show(t),CMS.settings.toolbar="expanded",CMS.settings=this.setSettings(CMS.settings)},_show:function(i){var o=this,s=i&&void 0!==i.duration?i.duration:this.options.toolbarDuration,e=t(".cms-debug-bar").height()||0,n=t(".cms-toolbar").height()+10;this.ui.toolbar.css({transition:"margin-top "+s+"ms","margin-top":0}),this.ui.toolbarTrigger.addClass("cms-toolbar-trigger-expanded"),this.ui.body.addClass("cms-toolbar-expanding"),this.ui.body.animate({"margin-top":n-10+e},s,"linear",function(){o.ui.body.removeClass("cms-toolbar-expanding"),o.ui.body.addClass("cms-toolbar-expanded")}),this.ui.messages.css("top",n-10)},close:function(){this._hide(),CMS.settings.toolbar="collapsed",CMS.settings=this.setSettings(CMS.settings)},_hide:function(){var i=this.options.toolbarDuration,o=t(".cms-toolbar").height()+10,s=this;return this.ui.toolbar.css("transition","margin-top "+i+"ms"),this.lockToolbar?!1:(this.ui.toolbar.css("margin-top",-o),this.ui.toolbarTrigger.removeClass("cms-toolbar-trigger-expanded"),this.ui.body.addClass("cms-toolbar-collapsing"),this.ui.body.animate({"margin-top":CMS.config.debug?5:0},i,"linear",function(){s.ui.body.removeClass("cms-toolbar-expanded cms-toolbar-collapsing")}),void this.ui.messages.css("top",0))},openAjax:function(i){var o=this,s=i.url,e=i.post||"{}",n=i.text||"",a=i.callback,r=i.onSuccess,l=n?CMS.API.Helpers.secureConfirm(n):!0;return l?(this.showLoader(),t.ajax({type:"POST",url:s,data:JSON.parse(e)}).done(function(t){CMS.API.locked=!1,a?(a(o,t),o.hideLoader()):r?CMS.API.Helpers.reloadBrowser(r,!1,!0):CMS.API.Helpers.reloadBrowser(!1,!1,!0)}).fail(function(t){CMS.API.locked=!1,CMS.API.Messages.open({message:t.responseText+" | "+t.status+" "+t.statusText,error:!0})})):!1},showLoader:function(){this.ui.toolbarTrigger.addClass("cms-toolbar-loader")},hideLoader:function(){this.ui.toolbarTrigger.removeClass("cms-toolbar-loader")},_delegate:function(t){var i=t.data("rel");if(t.hasClass("cms-btn-disabled"))return!1;switch(i){case"modal":var o=new CMS.Modal({onClose:t.data("on-close")});o.open({url:t.attr("href"),title:t.data("name")});break;case"message":CMS.API.Messages.open({message:t.data("text")});break;case"sideframe":var s=new CMS.Sideframe({onClose:t.data("on-close")});s.open({url:t.attr("href"),animate:!0});break;case"ajax":this.openAjax({url:t.attr("href"),post:JSON.stringify(t.data("post")),text:t.data("text"),onSuccess:t.data("on-success")});break;default:CMS.API.Helpers._getWindow().location.href=t.attr("href")}},_lock:function(t){t?(this.lockToolbar=!0,this.ui.toolbarTrigger.css("opacity",.2)):(this.lockToolbar=!1,this.ui.toolbarTrigger.css("opacity",1))},_debug:function(){var t=1e3,i=function(){},o=this.ui.container.find(".cms-debug-bar");o.on(this.mouseEnter+" "+this.mouseLeave,function(o){clearTimeout(i),"mouseenter"===o.type&&(i=setTimeout(function(){CMS.API.Messages.open({message:CMS.config.lang.debug})},t))})},_screenBlock:function(){var i=this,o=20,s=this.ui.screenBlock,e=t(".cms-sideframe");i.ui.window.on(i.resize+".screenblock",function(){s.css({width:i.ui.window.width()-e.width(),height:i.ui.window.height()})}).trigger(i.resize+".screenblock"),setInterval(function(){i.ui.window.trigger(i.resize+".screenblock")},o)},_handleLongMenus:function(){var i=t(".cms-toolbar-item-navigation-hover > ul");if(!i.length)return void this._stickToolbar();var o=i.toArray().map(function(i){var o=t(i);return t.extend({},o.position(),{height:o.height()})}),s=this.ui.window.height();this._position.top=this.ui.window.scrollTop();var e=o.some(function(t){return t.top+t.height>s});e&&this._position.top>=this._position.stickyTop?this._position.isSticky&&this._unstickToolbar():this._stickToolbar()},_stickToolbar:function(){this._position.stickyTop=0,this._position.isSticky=!0,this.ui.toolbar.removeClass("cms-toolbar-non-sticky"),this.ui.toolbar.css({top:0,"margin-top":""})},_unstickToolbar:function(){var i=parseInt(t("html").css("margin-top"),10);this._position.stickyTop=this._position.top,this.ui.toolbar.addClass("cms-toolbar-non-sticky"),this.ui.toolbar[0].style.setProperty("top",this._position.stickyTop+(CMS.config.debug?5:-5)+"px","important"),this.ui.toolbar.css({"margin-top":-(i+(CMS.config.debug?5:0))}),this._position.isSticky=!1}})}(CMS.$);
var CMS=window.CMS||{};!function(i){"use strict";CMS.Tooltip=new CMS.Class({initialize:function(){this.body=i("body"),this.isTouch=!1,this.domElem=this._pick(),this._forceTouchOnce=CMS.API.Helpers.once(this._forceTouch),this._checkTouch()},_checkTouch:function(){this.body.one("touchstart.cms",i.proxy(this._forceTouchOnce,this))},_forceTouch:function(){this.isTouch=!0,this.domElem=this._pick(),this.domElem.on("touchstart.cms",function(){var t=i(this).data("plugin_id"),o=i(".cms-plugin-"+t);if(o.length)o.trigger("dblclick.cms");else{var s=i('.cms-plugin[class*="cms-plugin-cms-"][class*="-'+t+'"]');s.eq(0).trigger("dblclick.cms")}})},displayToggle:function(i,t,o,s){i?this.show(t,o,s):this.hide()},show:function(i,t,o){var s=this.domElem,c=this;s.css("visibility","visible").data("plugin_id",o||null).show().find("span").html(t),this.isTouch?this.position(i.originalEvent,s):(c.position(i.originalEvent,s),this.body.on("mousemove.cms.tooltip",function(i){c.position(i,s)}))},hide:function(){this.domElem.css("visibility","hidden").hide(),this.isTouch||this.body.off("mousemove.cms.tooltip")},_pick:function(){return i(".cms-tooltip-touch, .cms-tooltip").css("visibility","hidden").hide(),i(this.isTouch?".cms-tooltip-touch":".cms-tooltip")},position:function(t,o){var s=20,c=t.pageX-i(o).offsetParent().offset().left,h=t.pageY-i(o).offsetParent().offset().top,e=i(o).offsetParent().width(),n=c+o.outerWidth(!0)+s;o.css({left:n>=e?c-o.outerWidth(!0)-s:c+s,top:h-12})}})}(CMS.$);
>>>>>>> 98e04bebfc125fad9f9eba68f8857a884bfd7dc6
